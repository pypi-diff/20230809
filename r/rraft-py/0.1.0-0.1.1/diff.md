# Comparing `tmp/rraft_py-0.1.0.tar.gz` & `tmp/rraft_py-0.1.1.tar.gz`

## Comparing `rraft_py-0.1.0.tar` & `rraft_py-0.1.1.tar`

### file list

```diff
@@ -1,83 +1,84 @@
--rw-r--r--   0        0        0      954 1970-01-01 00:00:00.000000 rraft_py-0.1.0/Cargo.toml
--rw-r--r--   0      501       20      206 2023-07-10 02:38:59.000000 rraft_py-0.1.0/.editorconfig
--rw-r--r--   0      501       20      788 2023-07-10 02:38:59.000000 rraft_py-0.1.0/.github/workflows/test.yml
--rw-r--r--   0      501       20      700 2023-07-10 02:38:59.000000 rraft_py-0.1.0/.gitignore
--rw-r--r--   0      501       20        7 2023-07-10 02:38:59.000000 rraft_py-0.1.0/.python-version
--rw-r--r--   0      501       20    11345 2023-07-10 02:38:59.000000 rraft_py-0.1.0/LICENSE
--rw-r--r--   0      501       20      573 2023-07-10 02:38:59.000000 rraft_py-0.1.0/Makefile
--rw-r--r--   0      501       20     3014 2023-07-10 03:18:37.000000 rraft_py-0.1.0/README.md
--rw-r--r--   0      501       20      223 2023-07-10 02:38:59.000000 rraft_py-0.1.0/benches/suites/progress.py
--rw-r--r--   0      501       20     4467 2023-07-10 02:38:59.000000 rraft_py-0.1.0/benches/suites/raft.py
--rw-r--r--   0      501       20        0 2023-07-10 02:38:59.000000 rraft_py-0.1.0/benches/suites/raw_node.py
--rw-r--r--   0      501       20    12446 2023-07-10 02:38:59.000000 rraft_py-0.1.0/example/multi_mem_node/main.py
--rw-r--r--   0      501       20     6010 2023-07-10 02:38:59.000000 rraft_py-0.1.0/example/single_mem_node/use_coroutine.py
--rw-r--r--   0      501       20     6293 2023-07-10 02:38:59.000000 rraft_py-0.1.0/example/single_mem_node/use_threading.py
--rw-r--r--   0      501       20      150 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/README.md
--rw-r--r--   0      501       20     2290 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/src/interface.py
--rw-r--r--   0      501       20     6835 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/src/network.py
--rw-r--r--   0      501       20     1004 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/tests/test_failpoints.py
--rw-r--r--   0      501       20   186320 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/tests/test_raft.py
--rw-r--r--   0      501       20     7732 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/tests/test_raft_flow_control.py
--rw-r--r--   0      501       20    34562 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/tests/test_raft_paper.py
--rw-r--r--   0      501       20     6467 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/tests/test_raft_snap.py
--rw-r--r--   0      501       20    59741 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/tests/test_raw_node.py
--rw-r--r--   0      501       20     5874 2023-07-10 02:38:59.000000 rraft_py-0.1.0/harness/utils.py
--rw-r--r--   0      501       20        0 2023-07-10 02:38:59.000000 rraft_py-0.1.0/py.typed
--rw-r--r--   0      501       20      287 2023-07-10 03:22:10.000000 rraft_py-0.1.0/pyproject.toml
--rw-r--r--   0      501       20       36 2023-07-10 02:38:59.000000 rraft_py-0.1.0/pytest.ini
--rw-r--r--   0      501       20       53 2023-07-10 02:38:59.000000 rraft_py-0.1.0/requirements.txt
--rw-r--r--   0      501       20   114851 2023-07-10 02:38:59.000000 rraft_py-0.1.0/rraft.pyi
--rw-r--r--   0      501       20     9790 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/config.rs
--rw-r--r--   0      501       20     1332 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/get_entries_context.rs
--rw-r--r--   0      501       20     1906 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/global.rs
--rw-r--r--   0      501       20     3547 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/inflights.rs
--rw-r--r--   0      501       20     3716 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/joint_config.rs
--rw-r--r--   0      501       20     2989 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/light_ready.rs
--rw-r--r--   0      501       20     5194 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/majority_config.rs
--rw-r--r--   0      501       20      393 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/mod.rs
--rw-r--r--   0      501       20     1652 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/peer.rs
--rw-r--r--   0      501       20     6960 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/progress.rs
--rw-r--r--   0      501       20     1612 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/progress_state.rs
--rw-r--r--   0      501       20     5916 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/progress_tracker.rs
--rw-r--r--   0      501       20     2715 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/raft_state.rs
--rw-r--r--   0      501       20     3069 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/read_state.rs
--rw-r--r--   0      501       20     1388 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/readonly_option.rs
--rw-r--r--   0      501       20     6371 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/ready.rs
--rw-r--r--   0      501       20     1382 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/snapshot_status.rs
--rw-r--r--   0      501       20     2572 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/soft_state.rs
--rw-r--r--   0      501       20     1731 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/bindings/state_role.rs
--rw-r--r--   0      501       20     5229 2023-07-10 02:40:56.000000 rraft_py-0.1.0/src/bindings/unstable.rs
--rw-r--r--   0      501       20       14 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/external_bindings/mod.rs
--rw-r--r--   0      501       20     3571 2023-07-10 02:49:49.000000 rraft_py-0.1.0/src/external_bindings/slog.rs
--rw-r--r--   0      501       20     7929 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/lib.rs
--rw-r--r--   0      501       20     4789 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/mem_storage_bindings/mem_storage.rs
--rw-r--r--   0      501       20     4031 2023-07-10 02:39:27.000000 rraft_py-0.1.0/src/mem_storage_bindings/mem_storage_core.rs
--rw-r--r--   0      501       20       97 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/mem_storage_bindings/mod.rs
--rw-r--r--   0      501       20    19659 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/mem_storage_bindings/raft.rs
--rw-r--r--   0      501       20    11619 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/mem_storage_bindings/raft_log.rs
--rw-r--r--   0      501       20     8415 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/mem_storage_bindings/raw_node.rs
--rw-r--r--   0      501       20       70 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/py_storage_bindings/mod.rs
--rw-r--r--   0      501       20    12837 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/py_storage_bindings/py_storage.rs
--rw-r--r--   0      501       20    19463 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/py_storage_bindings/raft.rs
--rw-r--r--   0      501       20    11469 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/py_storage_bindings/raft_log.rs
--rw-r--r--   0      501       20     8271 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/py_storage_bindings/raw_node.rs
--rw-r--r--   0      501       20     6416 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/conf_change.rs
--rw-r--r--   0      501       20     4026 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/conf_change_single.rs
--rw-r--r--   0      501       20     2239 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/conf_change_transition.rs
--rw-r--r--   0      501       20     2051 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/conf_change_type.rs
--rw-r--r--   0      501       20     6419 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/conf_change_v2.rs
--rw-r--r--   0      501       20     6511 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/conf_state.rs
--rw-r--r--   0      501       20     5454 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/entry.rs
--rw-r--r--   0      501       20     1977 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/entry_type.rs
--rw-r--r--   0      501       20     4025 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/hard_state.rs
--rw-r--r--   0      501       20    10018 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/message.rs
--rw-r--r--   0      501       20     7115 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/message_type.rs
--rw-r--r--   0      501       20      290 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/mod.rs
--rw-r--r--   0      501       20     4308 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/snapshot.rs
--rw-r--r--   0      501       20     4570 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/raftpb_bindings/snapshot_metadata.rs
--rw-r--r--   0      501       20     9258 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/utils/errors.rs
--rw-r--r--   0      501       20       56 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/utils/mod.rs
--rw-r--r--   0      501       20     4407 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/utils/reference.rs
--rw-r--r--   0      501       20      409 2023-07-10 02:38:59.000000 rraft_py-0.1.0/src/utils/unsafe_cast.rs
--rw-r--r--   0      501       20    27236 2023-07-10 02:38:59.000000 rraft_py-0.1.0/Cargo.lock
--rw-r--r--   0        0        0     3586 1970-01-01 00:00:00.000000 rraft_py-0.1.0/PKG-INFO
+-rw-r--r--   0        0        0      954 1970-01-01 00:00:00.000000 rraft_py-0.1.1/Cargo.toml
+-rw-r--r--   0      501       20      206 2023-02-27 06:56:36.000000 rraft_py-0.1.1/.editorconfig
+-rw-r--r--   0      501       20      788 2023-07-31 07:01:16.000000 rraft_py-0.1.1/.github/workflows/test.yml
+-rw-r--r--   0      501       20      700 2023-04-06 07:12:36.000000 rraft_py-0.1.1/.gitignore
+-rw-r--r--   0      501       20        7 2023-08-09 02:53:53.000000 rraft_py-0.1.1/.python-version
+-rw-r--r--   0      501       20    11345 2023-07-31 07:01:16.000000 rraft_py-0.1.1/LICENSE
+-rw-r--r--   0      501       20      573 2023-07-31 07:01:16.000000 rraft_py-0.1.1/Makefile
+-rw-r--r--   0      501       20     3061 2023-08-08 00:51:37.000000 rraft_py-0.1.1/README.md
+-rw-r--r--   0      501       20      223 2023-07-31 07:01:16.000000 rraft_py-0.1.1/benches/suites/progress.py
+-rw-r--r--   0      501       20     4467 2023-07-31 07:01:16.000000 rraft_py-0.1.1/benches/suites/raft.py
+-rw-r--r--   0      501       20        0 2023-07-31 07:01:16.000000 rraft_py-0.1.1/benches/suites/raw_node.py
+-rw-r--r--   0      501       20    12446 2023-07-31 07:01:34.000000 rraft_py-0.1.1/example/multi_mem_node/main.py
+-rw-r--r--   0      501       20     6010 2023-07-31 07:01:16.000000 rraft_py-0.1.1/example/single_mem_node/use_coroutine.py
+-rw-r--r--   0      501       20     6293 2023-07-31 07:01:16.000000 rraft_py-0.1.1/example/single_mem_node/use_threading.py
+-rw-r--r--   0      501       20      150 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/README.md
+-rw-r--r--   0      501       20     2290 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/src/interface.py
+-rw-r--r--   0      501       20     6835 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/src/network.py
+-rw-r--r--   0      501       20     1004 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/tests/test_failpoints.py
+-rw-r--r--   0      501       20   186320 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/tests/test_raft.py
+-rw-r--r--   0      501       20     7732 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/tests/test_raft_flow_control.py
+-rw-r--r--   0      501       20    34562 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/tests/test_raft_paper.py
+-rw-r--r--   0      501       20     6467 2023-08-04 03:36:56.000000 rraft_py-0.1.1/harness/tests/test_raft_snap.py
+-rw-r--r--   0      501       20    59741 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/tests/test_raw_node.py
+-rw-r--r--   0      501       20     5874 2023-07-31 07:01:16.000000 rraft_py-0.1.1/harness/utils.py
+-rw-r--r--   0      501       20        0 2023-01-26 07:03:57.000000 rraft_py-0.1.1/py.typed
+-rw-r--r--   0      501       20      287 2023-07-31 07:01:16.000000 rraft_py-0.1.1/pyproject.toml
+-rw-r--r--   0      501       20       36 2023-07-31 07:01:16.000000 rraft_py-0.1.1/pytest.ini
+-rw-r--r--   0      501       20       52 2023-08-09 02:54:19.000000 rraft_py-0.1.1/requirements.txt
+-rw-r--r--   0      501       20   114587 2023-08-08 05:40:33.000000 rraft_py-0.1.1/rraft.pyi
+-rw-r--r--   0      501       20     9790 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/config.rs
+-rw-r--r--   0      501       20     1332 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/get_entries_context.rs
+-rw-r--r--   0      501       20     1906 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/global.rs
+-rw-r--r--   0      501       20     3547 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/inflights.rs
+-rw-r--r--   0      501       20     3716 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/joint_config.rs
+-rw-r--r--   0      501       20     2989 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/light_ready.rs
+-rw-r--r--   0      501       20     5194 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/majority_config.rs
+-rw-r--r--   0      501       20      393 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/mod.rs
+-rw-r--r--   0      501       20     1652 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/peer.rs
+-rw-r--r--   0      501       20     6960 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/progress.rs
+-rw-r--r--   0      501       20     1612 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/progress_state.rs
+-rw-r--r--   0      501       20     5916 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/progress_tracker.rs
+-rw-r--r--   0      501       20     2715 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/raft_state.rs
+-rw-r--r--   0      501       20     3069 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/read_state.rs
+-rw-r--r--   0      501       20     1388 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/readonly_option.rs
+-rw-r--r--   0      501       20     6371 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/ready.rs
+-rw-r--r--   0      501       20     1382 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/snapshot_status.rs
+-rw-r--r--   0      501       20     2572 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/soft_state.rs
+-rw-r--r--   0      501       20     1731 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/state_role.rs
+-rw-r--r--   0      501       20     5229 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/bindings/unstable.rs
+-rw-r--r--   0      501       20       14 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/external_bindings/mod.rs
+-rw-r--r--   0      501       20     3571 2023-08-09 02:36:39.000000 rraft_py-0.1.1/src/external_bindings/slog.rs
+-rw-r--r--   0      501       20     7929 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/lib.rs
+-rw-r--r--   0      501       20     4789 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/mem_storage_bindings/mem_storage.rs
+-rw-r--r--   0      501       20     4031 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/mem_storage_bindings/mem_storage_core.rs
+-rw-r--r--   0      501       20       97 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/mem_storage_bindings/mod.rs
+-rw-r--r--   0      501       20    19404 2023-08-09 02:47:04.000000 rraft_py-0.1.1/src/mem_storage_bindings/raft.rs
+-rw-r--r--   0      501       20    11619 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/mem_storage_bindings/raft_log.rs
+-rw-r--r--   0      501       20     8415 2023-08-08 09:59:49.000000 rraft_py-0.1.1/src/mem_storage_bindings/raw_node.rs
+-rw-r--r--   0      501       20       70 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/py_storage_bindings/mod.rs
+-rw-r--r--   0      501       20    12837 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/py_storage_bindings/py_storage.rs
+-rw-r--r--   0      501       20    19208 2023-08-09 02:48:07.000000 rraft_py-0.1.1/src/py_storage_bindings/raft.rs
+-rw-r--r--   0      501       20    11469 2023-08-08 05:35:51.000000 rraft_py-0.1.1/src/py_storage_bindings/raft_log.rs
+-rw-r--r--   0      501       20     8271 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/py_storage_bindings/raw_node.rs
+-rw-r--r--   0      501       20     6870 2023-08-08 07:53:52.000000 rraft_py-0.1.1/src/raftpb_bindings/conf_change.rs
+-rw-r--r--   0      501       20     4026 2023-08-08 05:33:36.000000 rraft_py-0.1.1/src/raftpb_bindings/conf_change_single.rs
+-rw-r--r--   0      501       20     2239 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/conf_change_transition.rs
+-rw-r--r--   0      501       20     2051 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/conf_change_type.rs
+-rw-r--r--   0      501       20     6846 2023-08-08 08:33:58.000000 rraft_py-0.1.1/src/raftpb_bindings/conf_change_v2.rs
+-rw-r--r--   0      501       20     6511 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/conf_state.rs
+-rw-r--r--   0      501       20     6038 2023-08-08 10:20:16.000000 rraft_py-0.1.1/src/raftpb_bindings/entry.rs
+-rw-r--r--   0      501       20     1977 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/entry_type.rs
+-rw-r--r--   0      501       20     4025 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/hard_state.rs
+-rw-r--r--   0      501       20    11400 2023-08-08 07:54:25.000000 rraft_py-0.1.1/src/raftpb_bindings/message.rs
+-rw-r--r--   0      501       20     7115 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/message_type.rs
+-rw-r--r--   0      501       20      290 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/mod.rs
+-rw-r--r--   0      501       20     4634 2023-08-09 02:55:14.000000 rraft_py-0.1.1/src/raftpb_bindings/snapshot.rs
+-rw-r--r--   0      501       20     4570 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/raftpb_bindings/snapshot_metadata.rs
+-rw-r--r--   0      501       20      475 2023-08-09 02:36:39.000000 rraft_py-0.1.1/src/utils/deserializer.rs
+-rw-r--r--   0      501       20     9258 2023-08-04 00:35:31.000000 rraft_py-0.1.1/src/utils/errors.rs
+-rw-r--r--   0      501       20       78 2023-08-08 05:00:26.000000 rraft_py-0.1.1/src/utils/mod.rs
+-rw-r--r--   0      501       20     4407 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/utils/reference.rs
+-rw-r--r--   0      501       20      409 2023-07-31 07:01:16.000000 rraft_py-0.1.1/src/utils/unsafe_cast.rs
+-rw-r--r--   0      501       20    27236 2023-08-09 02:55:01.000000 rraft_py-0.1.1/Cargo.lock
+-rw-r--r--   0        0        0     3633 1970-01-01 00:00:00.000000 rraft_py-0.1.1/PKG-INFO
```

### Comparing `rraft_py-0.1.0/Cargo.toml` & `rraft_py-0.1.1/Cargo.toml`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [package]
 name = "rraft-py"
-version = "0.1.0"
+version = "0.1.1"
 authors = ["Lablup Inc."]
 license = "Apache-2.0"
 repository = "https://github.com/lablup/rraft-py"
 readme = "./README.md"
 homepage = "https://github.com/lablup/rraft-py"
 description = """
 Unofficial Python Binding of the tikv/raft-rs
@@ -12,15 +12,15 @@
 keywords = ["raft", "distributed-systems", "consensus-algorithm", "replication", "distributed-database"]
 categories = ["distributed-systems", "database-implementations"]
 edition = "2021"
 
 [dependencies]
 prost = "0.11"
 protobuf = "2"
-pyo3 = { version = "0.19.1", features = ["extension-module", "multiple-pymethods"] }
+pyo3 = { version = "0.19.2", features = ["extension-module", "multiple-pymethods"] }
 raft = { version = "0.7.0", features = ["prost-codec", "default-logger"], default-features = false }
 slog = { version = "2.2", features = ["max_level_debug", "release_max_level_debug"] }
 slog-envlogger = "2.1.0"
 slog-term = "2.9.0"
 slog-stdlog = "4"
 slog-async = "2.7.0"
 fxhash = "0.2.1"
```

### Comparing `rraft_py-0.1.0/.github/workflows/test.yml` & `rraft_py-0.1.1/.github/workflows/test.yml`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/.gitignore` & `rraft_py-0.1.1/.gitignore`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/LICENSE` & `rraft_py-0.1.1/LICENSE`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/Makefile` & `rraft_py-0.1.1/Makefile`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/README.md` & `rraft_py-0.1.1/README.md`

 * *Files 5% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 
 There have been several attempts to implement a *Raft implementation* in the Python ecosystem before, but unfortunately, there is no library being used as a *de-facto* standard as of now.
 
 This binding was created to resolve this problem and to make it possible to integrate your Python code with *low-level Raft implementation*.
 
 ### When to use and when not to use
 
-This library is a binding for *tikv/raft-rs* and only contains an implementation of the consensus module. Therefore, you need to write the logic for both the transport and storage layers yourself. If you just want to quickly integrate Raft with your Python application, using this library might not be suitable. I'd personally recommend considering using [*PySyncObj*](https://github.com/bakwc/PySyncObj).
+This library is a binding for *tikv/raft-rs* and only contains an implementation of the consensus module. Therefore, you need to write the logic for both the transport and storage layers yourself. If you just want to quickly integrate Raft with your Python application, using this library might not be suitable. In this case, you can consider to using [*Raftify*](https://github.com/lablup/raftify) or [*PySyncObj*](https://github.com/bakwc/PySyncObj).
 
 However, if you want to integrate *well-tested* Raft implementation that is reliable for production-level use in Python, or want to change the transport layer to a different layer, or want to change *fine-grained* settings according to your application's specific use case, this binding could provide you a valid starting point.
 
 ### Disclaimer
 
 #### Memory management
```

### Comparing `rraft_py-0.1.0/benches/suites/raft.py` & `rraft_py-0.1.1/benches/suites/raft.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/example/multi_mem_node/main.py` & `rraft_py-0.1.1/example/multi_mem_node/main.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/example/single_mem_node/use_coroutine.py` & `rraft_py-0.1.1/example/single_mem_node/use_coroutine.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/example/single_mem_node/use_threading.py` & `rraft_py-0.1.1/example/single_mem_node/use_threading.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/src/interface.py` & `rraft_py-0.1.1/harness/src/interface.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/src/network.py` & `rraft_py-0.1.1/harness/src/network.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/tests/test_failpoints.py` & `rraft_py-0.1.1/harness/tests/test_failpoints.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/tests/test_raft.py` & `rraft_py-0.1.1/harness/tests/test_raft.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/tests/test_raft_flow_control.py` & `rraft_py-0.1.1/harness/tests/test_raft_flow_control.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/tests/test_raft_paper.py` & `rraft_py-0.1.1/harness/tests/test_raft_paper.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/tests/test_raft_snap.py` & `rraft_py-0.1.1/harness/tests/test_raft_snap.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/tests/test_raw_node.py` & `rraft_py-0.1.1/harness/tests/test_raw_node.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/harness/utils.py` & `rraft_py-0.1.1/harness/utils.py`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/rraft.pyi` & `rraft_py-0.1.1/rraft.pyi`

 * *Files 1% similar despite different names*

```diff
@@ -86,7094 +86,7077 @@
 00000550: 0a0a 636c 6173 7320 5f5f 456e 636f 6465  ..class __Encode
 00000560: 723a 0a20 2020 2064 6566 2065 6e63 6f64  r:.    def encod
 00000570: 6528 7365 6c66 2920 2d3e 2062 7974 6573  e(self) -> bytes
 00000580: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
 00000590: 220a 0a63 6c61 7373 205f 5f44 6563 6f64  "..class __Decod
 000005a0: 6572 3a0a 2020 2020 4073 7461 7469 636d  er:.    @staticm
 000005b0: 6574 686f 640a 2020 2020 6465 6620 6465  ethod.    def de
-000005c0: 636f 6465 2876 3a20 4c69 7374 5b69 6e74  code(v: List[int
-000005d0: 5d20 7c20 6279 7465 7329 202d 3e20 416e  ] | bytes) -> An
-000005e0: 793a 0a20 2020 2020 2020 2022 2222 2022  y:.        """ "
-000005f0: 2222 0a0a 636c 6173 7320 4f76 6572 666c  ""..class Overfl
-00000600: 6f77 5374 7261 7465 6779 3a0a 2020 2020  owStrategy:.    
-00000610: 2222 2220 2222 220a 0a20 2020 2042 6c6f  """ """..    Blo
-00000620: 636b 3a20 4669 6e61 6c5b 416e 795d 0a20  ck: Final[Any]. 
-00000630: 2020 2044 726f 703a 2046 696e 616c 5b41     Drop: Final[A
-00000640: 6e79 5d0a 2020 2020 4472 6f70 416e 6452  ny].    DropAndR
-00000650: 6570 6f72 743a 2046 696e 616c 5b41 6e79  eport: Final[Any
-00000660: 5d0a 0a63 6c61 7373 2053 6e61 7073 686f  ]..class Snapsho
-00000670: 7453 7461 7475 733a 0a20 2020 2022 2222  tStatus:.    """
-00000680: 5468 6520 7374 6174 7573 206f 6620 7468  The status of th
-00000690: 6520 736e 6170 7368 6f74 2e22 2222 0a0a  e snapshot."""..
-000006a0: 2020 2020 2222 220a 2020 2020 5265 7072      """.    Repr
-000006b0: 6573 656e 7473 2074 6861 7420 7468 6520  esents that the 
-000006c0: 736e 6170 7368 6f74 2069 7320 6669 6e69  snapshot is fini
-000006d0: 7368 6564 2062 6569 6e67 2063 7265 6174  shed being creat
-000006e0: 6564 2e0a 2020 2020 2222 220a 2020 2020  ed..    """.    
-000006f0: 4669 6e69 7368 3a20 4669 6e61 6c5b 416e  Finish: Final[An
-00000700: 795d 0a0a 2020 2020 2222 220a 2020 2020  y]..    """.    
-00000710: 496e 6469 6361 7465 7320 7468 6174 2074  Indicates that t
-00000720: 6865 2073 6e61 7073 686f 7420 6661 696c  he snapshot fail
-00000730: 6564 2074 6f20 6275 696c 6420 6f72 2069  ed to build or i
-00000740: 7320 6e6f 7420 7265 6164 792e 0a20 2020  s not ready..   
-00000750: 2022 2222 0a20 2020 2046 6169 6c75 7265   """.    Failure
-00000760: 3a20 4669 6e61 6c5b 416e 795d 0a0a 636c  : Final[Any]..cl
-00000770: 6173 7320 5072 6f67 7265 7373 5374 6174  ass ProgressStat
-00000780: 653a 0a20 2020 2022 2222 5468 6520 7374  e:.    """The st
-00000790: 6174 6520 6f66 2074 6865 2070 726f 6772  ate of the progr
-000007a0: 6573 732e 2222 220a 0a20 2020 2022 2222  ess."""..    """
-000007b0: 0a20 2020 2057 6865 7468 6572 2069 7427  .    Whether it'
-000007c0: 7320 7072 6f62 696e 672e 0a20 2020 2022  s probing..    "
-000007d0: 2222 0a20 2020 2050 726f 6265 3a20 4669  "".    Probe: Fi
-000007e0: 6e61 6c5b 416e 795d 0a0a 2020 2020 2222  nal[Any]..    ""
-000007f0: 220a 2020 2020 5768 6574 6865 7220 6974  ".    Whether it
-00000800: 2773 2072 6570 6c69 6361 7469 6e67 2e0a  's replicating..
-00000810: 2020 2020 2222 220a 2020 2020 5265 706c      """.    Repl
-00000820: 6963 6174 653a 2046 696e 616c 5b41 6e79  icate: Final[Any
-00000830: 5d0a 0a20 2020 2022 2222 0a20 2020 2057  ]..    """.    W
-00000840: 6865 7468 6572 2069 7427 7320 6120 736e  hether it's a sn
-00000850: 6170 7368 6f74 2e0a 2020 2020 2222 220a  apshot..    """.
-00000860: 2020 2020 536e 6170 7368 6f74 3a20 4669      Snapshot: Fi
-00000870: 6e61 6c5b 416e 795d 0a0a 636c 6173 7320  nal[Any]..class 
-00000880: 5374 6174 6552 6f6c 653a 0a20 2020 2022  StateRole:.    "
-00000890: 2222 5468 6520 726f 6c65 206f 6620 7468  ""The role of th
-000008a0: 6520 6e6f 6465 2e22 2222 0a0a 2020 2020  e node."""..    
-000008b0: 2222 220a 2020 2020 5468 6520 6e6f 6465  """.    The node
-000008c0: 2063 6f75 6c64 2062 6563 6f6d 6520 6120   could become a 
-000008d0: 6c65 6164 6572 2e0a 2020 2020 2222 220a  leader..    """.
-000008e0: 2020 2020 4361 6e64 6964 6174 653a 2046      Candidate: F
-000008f0: 696e 616c 5b41 6e79 5d0a 0a20 2020 2022  inal[Any]..    "
-00000900: 2222 0a20 2020 2054 6865 206e 6f64 6520  "".    The node 
-00000910: 6973 2061 2066 6f6c 6c6f 7765 7220 6f66  is a follower of
-00000920: 2074 6865 206c 6561 6465 722e 0a20 2020   the leader..   
-00000930: 2022 2222 0a20 2020 2046 6f6c 6c6f 7765   """.    Followe
-00000940: 723a 2046 696e 616c 5b41 6e79 5d0a 0a20  r: Final[Any].. 
-00000950: 2020 2022 2222 0a20 2020 2054 6865 206e     """.    The n
-00000960: 6f64 6520 6973 2061 206c 6561 6465 722e  ode is a leader.
-00000970: 0a20 2020 2022 2222 0a20 2020 204c 6561  .    """.    Lea
-00000980: 6465 723a 2046 696e 616c 5b41 6e79 5d0a  der: Final[Any].
-00000990: 0a20 2020 2022 2222 0a20 2020 2054 6865  .    """.    The
-000009a0: 206e 6f64 6520 636f 756c 6420 6265 636f   node could beco
-000009b0: 6d65 2061 2063 616e 6469 6461 7465 2c20  me a candidate, 
-000009c0: 6966 2060 7072 6576 6f74 6560 2069 7320  if `prevote` is 
-000009d0: 656e 6162 6c65 642e 0a20 2020 2022 2222  enabled..    """
-000009e0: 0a20 2020 2050 7265 4361 6e64 6964 6174  .    PreCandidat
-000009f0: 653a 2046 696e 616c 5b41 6e79 5d0a 0a63  e: Final[Any]..c
-00000a00: 6c61 7373 2052 6561 644f 6e6c 794f 7074  lass ReadOnlyOpt
-00000a10: 696f 6e3a 0a20 2020 2022 2222 4465 7465  ion:.    """Dete
-00000a20: 726d 696e 6573 2074 6865 2072 656c 6174  rmines the relat
-00000a30: 6976 6520 7361 6665 7479 206f 6620 616e  ive safety of an
-00000a40: 6420 636f 6e73 6973 7465 6e63 7920 6f66  d consistency of
-00000a50: 2072 6561 6420 6f6e 6c79 2072 6571 7565   read only reque
-00000a60: 7374 732e 2222 220a 0a20 2020 2022 2222  sts."""..    """
-00000a70: 0a20 2020 2053 6166 6520 6775 6172 616e  .    Safe guaran
-00000a80: 7465 6573 2074 6865 206c 696e 6561 7269  tees the lineari
-00000a90: 7a61 6269 6c69 7479 206f 6620 7468 6520  zability of the 
-00000aa0: 7265 6164 206f 6e6c 7920 7265 7175 6573  read only reques
-00000ab0: 7420 6279 0a20 2020 2063 6f6d 6d75 6e69  t by.    communi
-00000ac0: 6361 7469 6e67 2077 6974 6820 7468 6520  cating with the 
-00000ad0: 7175 6f72 756d 2e20 4974 2069 7320 7468  quorum. It is th
-00000ae0: 6520 6465 6661 756c 7420 616e 6420 7375  e default and su
-00000af0: 6767 6573 7465 6420 6f70 7469 6f6e 2e0a  ggested option..
-00000b00: 2020 2020 2222 220a 2020 2020 5361 6665      """.    Safe
-00000b10: 3a20 4669 6e61 6c5b 416e 795d 0a0a 2020  : Final[Any]..  
-00000b20: 2020 2222 220a 2020 2020 4c65 6173 6542    """.    LeaseB
-00000b30: 6173 6564 2065 6e73 7572 6573 206c 696e  ased ensures lin
-00000b40: 6561 7269 7a61 6269 6c69 7479 206f 6620  earizability of 
-00000b50: 7468 6520 7265 6164 206f 6e6c 7920 7265  the read only re
-00000b60: 7175 6573 7420 6279 0a20 2020 2072 656c  quest by.    rel
-00000b70: 7969 6e67 206f 6e20 7468 6520 6c65 6164  ying on the lead
-00000b80: 6572 206c 6561 7365 2e20 4974 2063 616e  er lease. It can
-00000b90: 2062 6520 6166 6665 6374 6564 2062 7920   be affected by 
-00000ba0: 636c 6f63 6b20 6472 6966 742e 0a20 2020  clock drift..   
-00000bb0: 2049 6620 7468 6520 636c 6f63 6b20 6472   If the clock dr
-00000bc0: 6966 7420 6973 2075 6e62 6f75 6e64 6564  ift is unbounded
-00000bd0: 2c20 6c65 6164 6572 206d 6967 6874 206b  , leader might k
-00000be0: 6565 7020 7468 6520 6c65 6173 6520 6c6f  eep the lease lo
-00000bf0: 6e67 6572 2074 6861 6e20 6974 0a20 2020  nger than it.   
-00000c00: 2073 686f 756c 6420 2863 6c6f 636b 2063   should (clock c
-00000c10: 616e 206d 6f76 6520 6261 636b 7761 7264  an move backward
-00000c20: 2f70 6175 7365 2077 6974 686f 7574 2061  /pause without a
-00000c30: 6e79 2062 6f75 6e64 292e 2052 6561 6449  ny bound). ReadI
-00000c40: 6e64 6578 2069 7320 6e6f 7420 7361 6665  ndex is not safe
-00000c50: 0a20 2020 2069 6e20 7468 6174 2063 6173  .    in that cas
-00000c60: 652e 0a20 2020 2022 2222 0a20 2020 204c  e..    """.    L
-00000c70: 6561 7365 4261 7365 643a 2046 696e 616c  easeBased: Final
-00000c80: 5b41 6e79 5d0a 0a63 6c61 7373 204d 6573  [Any]..class Mes
-00000c90: 7361 6765 5479 7065 3a0a 2020 2020 2222  sageType:.    ""
-00000ca0: 2220 2222 220a 0a20 2020 204d 7367 4875  " """..    MsgHu
-00000cb0: 703a 2046 696e 616c 5b41 6e79 5d0a 2020  p: Final[Any].  
-00000cc0: 2020 4d73 6742 6561 743a 2046 696e 616c    MsgBeat: Final
-00000cd0: 5b41 6e79 5d0a 2020 2020 4d73 6750 726f  [Any].    MsgPro
-00000ce0: 706f 7365 3a20 4669 6e61 6c5b 416e 795d  pose: Final[Any]
-00000cf0: 0a20 2020 204d 7367 4170 7065 6e64 3a20  .    MsgAppend: 
-00000d00: 4669 6e61 6c5b 416e 795d 0a20 2020 204d  Final[Any].    M
-00000d10: 7367 4170 7065 6e64 5265 7370 6f6e 7365  sgAppendResponse
-00000d20: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
-00000d30: 204d 7367 5265 7175 6573 7456 6f74 653a   MsgRequestVote:
-00000d40: 2046 696e 616c 5b41 6e79 5d0a 2020 2020   Final[Any].    
-00000d50: 4d73 6752 6571 7565 7374 566f 7465 5265  MsgRequestVoteRe
-00000d60: 7370 6f6e 7365 3a20 4669 6e61 6c5b 416e  sponse: Final[An
-00000d70: 795d 0a20 2020 204d 7367 536e 6170 7368  y].    MsgSnapsh
-00000d80: 6f74 3a20 4669 6e61 6c5b 416e 795d 0a20  ot: Final[Any]. 
-00000d90: 2020 204d 7367 4865 6172 7462 6561 743a     MsgHeartbeat:
-00000da0: 2046 696e 616c 5b41 6e79 5d0a 2020 2020   Final[Any].    
-00000db0: 4d73 6748 6561 7274 6265 6174 5265 7370  MsgHeartbeatResp
-00000dc0: 6f6e 7365 3a20 4669 6e61 6c5b 416e 795d  onse: Final[Any]
-00000dd0: 0a20 2020 204d 7367 556e 7265 6163 6861  .    MsgUnreacha
-00000de0: 626c 653a 2046 696e 616c 5b41 6e79 5d0a  ble: Final[Any].
-00000df0: 2020 2020 4d73 6753 6e61 7053 7461 7475      MsgSnapStatu
-00000e00: 733a 2046 696e 616c 5b41 6e79 5d0a 2020  s: Final[Any].  
-00000e10: 2020 4d73 6743 6865 636b 5175 6f72 756d    MsgCheckQuorum
-00000e20: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
-00000e30: 204d 7367 5472 616e 7366 6572 4c65 6164   MsgTransferLead
-00000e40: 6572 3a20 4669 6e61 6c5b 416e 795d 0a20  er: Final[Any]. 
-00000e50: 2020 204d 7367 5469 6d65 6f75 744e 6f77     MsgTimeoutNow
-00000e60: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
-00000e70: 204d 7367 5265 6164 496e 6465 783a 2046   MsgReadIndex: F
-00000e80: 696e 616c 5b41 6e79 5d0a 2020 2020 4d73  inal[Any].    Ms
-00000e90: 6752 6561 6449 6e64 6578 5265 7370 3a20  gReadIndexResp: 
-00000ea0: 4669 6e61 6c5b 416e 795d 0a20 2020 204d  Final[Any].    M
-00000eb0: 7367 5265 7175 6573 7450 7265 566f 7465  sgRequestPreVote
-00000ec0: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
-00000ed0: 204d 7367 5265 7175 6573 7450 7265 566f   MsgRequestPreVo
-00000ee0: 7465 5265 7370 6f6e 7365 3a20 4669 6e61  teResponse: Fina
-00000ef0: 6c5b 416e 795d 0a20 2020 2040 7374 6174  l[Any].    @stat
-00000f00: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00000f10: 2066 726f 6d5f 696e 7428 763a 2069 6e74   from_int(v: int
-00000f20: 2920 2d3e 2022 4d65 7373 6167 6554 7970  ) -> "MessageTyp
-00000f30: 6522 3a20 2e2e 2e0a 0a63 6c61 7373 2043  e": .....class C
-00000f40: 6f6e 6643 6861 6e67 6554 7261 6e73 6974  onfChangeTransit
-00000f50: 696f 6e3a 0a20 2020 2022 2222 2022 2222  ion:.    """ """
-00000f60: 0a0a 2020 2020 2222 220a 2020 2020 4175  ..    """.    Au
-00000f70: 746f 6d61 7469 6361 6c6c 7920 7573 6520  tomatically use 
-00000f80: 7468 6520 7369 6d70 6c65 2070 726f 746f  the simple proto
-00000f90: 636f 6c20 6966 2070 6f73 7369 626c 652c  col if possible,
-00000fa0: 206f 7468 6572 7769 7365 2066 616c 6c20   otherwise fall 
-00000fb0: 6261 636b 0a20 2020 2074 6f20 436f 6e66  back.    to Conf
-00000fc0: 4368 616e 6765 5479 7065 3a3a 496d 706c  ChangeType::Impl
-00000fd0: 6963 6974 2e20 4d6f 7374 2061 7070 6c69  icit. Most appli
-00000fe0: 6361 7469 6f6e 7320 7769 6c6c 2077 616e  cations will wan
-00000ff0: 7420 746f 2075 7365 2074 6869 732e 0a20  t to use this.. 
-00001000: 2020 2022 2222 0a20 2020 2041 7574 6f3a     """.    Auto:
-00001010: 2046 696e 616c 5b41 6e79 5d0a 0a20 2020   Final[Any]..   
-00001020: 2022 2222 0a20 2020 2055 7365 206a 6f69   """.    Use joi
-00001030: 6e74 2063 6f6e 7365 6e73 7573 2075 6e63  nt consensus unc
-00001040: 6f6e 6469 7469 6f6e 616c 6c79 2c20 616e  onditionally, an
-00001050: 6420 7472 616e 7369 7469 6f6e 206f 7574  d transition out
-00001060: 206f 6620 7468 656d 0a20 2020 2061 7574   of them.    aut
-00001070: 6f6d 6174 6963 616c 6c79 2028 6279 2070  omatically (by p
-00001080: 726f 706f 7369 6e67 2061 207a 6572 6f20  roposing a zero 
-00001090: 636f 6e66 6967 7572 6174 696f 6e20 6368  configuration ch
-000010a0: 616e 6765 292e 0a0a 2020 2020 5468 6973  ange)...    This
-000010b0: 206f 7074 696f 6e20 6973 2073 7569 7461   option is suita
-000010c0: 626c 6520 666f 7220 6170 706c 6963 6174  ble for applicat
-000010d0: 696f 6e73 2074 6861 7420 7761 6e74 2074  ions that want t
-000010e0: 6f20 6d69 6e69 6d69 7a65 2074 6865 2074  o minimize the t
-000010f0: 696d 650a 2020 2020 7370 656e 7420 696e  ime.    spent in
-00001100: 2074 6865 206a 6f69 6e74 2063 6f6e 6669   the joint confi
-00001110: 6775 7261 7469 6f6e 2061 6e64 2064 6f20  guration and do 
-00001120: 6e6f 7420 7374 6f72 6520 7468 6520 6a6f  not store the jo
-00001130: 696e 7420 636f 6e66 6967 7572 6174 696f  int configuratio
-00001140: 6e0a 2020 2020 696e 2074 6865 2073 7461  n.    in the sta
-00001150: 7465 206d 6163 6869 6e65 2028 6f75 7473  te machine (outs
-00001160: 6964 6520 6f66 2049 6e69 7469 616c 5374  ide of InitialSt
-00001170: 6174 6529 2e0a 2020 2020 2222 220a 2020  ate)..    """.  
-00001180: 2020 496d 706c 6963 6974 3a20 4669 6e61    Implicit: Fina
-00001190: 6c5b 416e 795d 0a0a 2020 2020 2222 220a  l[Any]..    """.
-000011a0: 2020 2020 5573 6520 6a6f 696e 7420 636f      Use joint co
-000011b0: 6e73 656e 7375 7320 616e 6420 7265 6d61  nsensus and rema
-000011c0: 696e 2069 6e20 7468 6520 6a6f 696e 7420  in in the joint 
-000011d0: 636f 6e66 6967 7572 6174 696f 6e20 756e  configuration un
-000011e0: 7469 6c20 7468 650a 2020 2020 6170 706c  til the.    appl
-000011f0: 6963 6174 696f 6e20 7072 6f70 6f73 6573  ication proposes
-00001200: 2061 206e 6f2d 6f70 2063 6f6e 6669 6775   a no-op configu
-00001210: 7261 7469 6f6e 2063 6861 6e67 652e 2054  ration change. T
-00001220: 6869 7320 6973 2073 7569 7461 626c 6520  his is suitable 
-00001230: 666f 720a 2020 2020 6170 706c 6963 6174  for.    applicat
-00001240: 696f 6e73 2074 6861 7420 7761 6e74 2074  ions that want t
-00001250: 6f20 6578 706c 6963 6974 6c79 2063 6f6e  o explicitly con
-00001260: 7472 6f6c 2074 6865 2074 7261 6e73 6974  trol the transit
-00001270: 696f 6e73 2c20 666f 7220 6578 616d 706c  ions, for exampl
-00001280: 650a 2020 2020 746f 2075 7365 2061 2063  e.    to use a c
-00001290: 7573 746f 6d20 7061 796c 6f61 6420 2876  ustom payload (v
-000012a0: 6961 2074 6865 2043 6f6e 7465 7874 2066  ia the Context f
-000012b0: 6965 6c64 292e 0a20 2020 2022 2222 0a20  ield)..    """. 
-000012c0: 2020 2045 7870 6c69 6369 743a 2046 696e     Explicit: Fin
-000012d0: 616c 5b41 6e79 5d0a 2020 2020 4073 7461  al[Any].    @sta
-000012e0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-000012f0: 6620 6672 6f6d 5f69 6e74 2876 3a20 696e  f from_int(v: in
-00001300: 7429 202d 3e20 2243 6f6e 6643 6861 6e67  t) -> "ConfChang
-00001310: 6554 7261 6e73 6974 696f 6e22 3a20 2e2e  eTransition": ..
-00001320: 2e0a 0a63 6c61 7373 2043 6f6e 6643 6861  ...class ConfCha
-00001330: 6e67 6554 7970 653a 0a20 2020 2022 2222  ngeType:.    """
-00001340: 2022 2222 0a0a 2020 2020 4164 644e 6f64   """..    AddNod
-00001350: 653a 2046 696e 616c 5b41 6e79 5d0a 2020  e: Final[Any].  
-00001360: 2020 4164 644c 6561 726e 6572 4e6f 6465    AddLearnerNode
-00001370: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
-00001380: 2052 656d 6f76 654e 6f64 653a 2046 696e   RemoveNode: Fin
-00001390: 616c 5b41 6e79 5d0a 2020 2020 4073 7461  al[Any].    @sta
-000013a0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-000013b0: 6620 6672 6f6d 5f69 6e74 2876 3a20 696e  f from_int(v: in
-000013c0: 7429 202d 3e20 2243 6f6e 6643 6861 6e67  t) -> "ConfChang
-000013d0: 6554 7970 6522 3a20 2e2e 2e0a 0a63 6c61  eType": .....cla
-000013e0: 7373 2045 6e74 7279 5479 7065 3a0a 2020  ss EntryType:.  
-000013f0: 2020 2222 2220 2222 220a 0a20 2020 2045    """ """..    E
-00001400: 6e74 7279 436f 6e66 4368 616e 6765 3a20  ntryConfChange: 
-00001410: 4669 6e61 6c5b 416e 795d 0a20 2020 2045  Final[Any].    E
-00001420: 6e74 7279 436f 6e66 4368 616e 6765 5632  ntryConfChangeV2
-00001430: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
-00001440: 2045 6e74 7279 4e6f 726d 616c 3a20 4669   EntryNormal: Fi
-00001450: 6e61 6c5b 416e 795d 0a20 2020 2040 7374  nal[Any].    @st
-00001460: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00001470: 6566 2066 726f 6d5f 696e 7428 763a 2069  ef from_int(v: i
-00001480: 6e74 2920 2d3e 2022 456e 7472 7954 7970  nt) -> "EntryTyp
-00001490: 6522 3a20 2e2e 2e0a 0a63 6c61 7373 205f  e": .....class _
-000014a0: 5f41 5049 5f4c 6f67 6765 723a 0a20 2020  _API_Logger:.   
-000014b0: 2064 6566 2069 6e66 6f28 7365 6c66 2c20   def info(self, 
-000014c0: 733a 2073 7472 2920 2d3e 204e 6f6e 653a  s: str) -> None:
-000014d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000014e0: 2020 2020 204c 6f67 2069 6e66 6f20 6c65       Log info le
-000014f0: 7665 6c20 7265 636f 7264 0a0a 2020 2020  vel record..    
-00001500: 2020 2020 5365 6520 6073 6c6f 675f 6c6f      See `slog_lo
-00001510: 6760 2066 6f72 2064 6f63 756d 656e 7461  g` for documenta
-00001520: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
-00001530: 220a 2020 2020 6465 6620 6465 6275 6728  ".    def debug(
-00001540: 7365 6c66 2c20 733a 2073 7472 2920 2d3e  self, s: str) ->
-00001550: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00001560: 2222 0a20 2020 2020 2020 204c 6f67 2064  "".        Log d
-00001570: 6562 7567 206c 6576 656c 2072 6563 6f72  ebug level recor
-00001580: 640a 0a20 2020 2020 2020 2053 6565 2060  d..        See `
-00001590: 6c6f 6760 2066 6f72 2064 6f63 756d 656e  log` for documen
-000015a0: 7461 7469 6f6e 2e0a 2020 2020 2020 2020  tation..        
-000015b0: 2222 220a 2020 2020 6465 6620 7472 6163  """.    def trac
-000015c0: 6528 7365 6c66 2c20 733a 2073 7472 2920  e(self, s: str) 
-000015d0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000015e0: 2022 2222 0a20 2020 2020 2020 204c 6f67   """.        Log
-000015f0: 2074 7261 6365 206c 6576 656c 2072 6563   trace level rec
-00001600: 6f72 640a 0a20 2020 2020 2020 2053 6565  ord..        See
-00001610: 2060 6c6f 6760 2066 6f72 2064 6f63 756d   `log` for docum
-00001620: 656e 7461 7469 6f6e 2e0a 2020 2020 2020  entation..      
-00001630: 2020 2222 220a 2020 2020 6465 6620 6372    """.    def cr
-00001640: 6974 2873 656c 662c 2073 3a20 7374 7229  it(self, s: str)
-00001650: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00001660: 2020 2222 220a 2020 2020 2020 2020 4c6f    """.        Lo
-00001670: 6720 6372 6974 206c 6576 656c 2072 6563  g crit level rec
-00001680: 6f72 640a 0a20 2020 2020 2020 2053 6565  ord..        See
-00001690: 2060 6c6f 6760 2066 6f72 2064 6f63 756d   `log` for docum
-000016a0: 656e 7461 7469 6f6e 2e0a 2020 2020 2020  entation..      
-000016b0: 2020 2222 220a 2020 2020 6465 6620 6572    """.    def er
-000016c0: 726f 7228 7365 6c66 2c20 733a 2073 7472  ror(self, s: str
-000016d0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000016e0: 2020 2022 2222 0a20 2020 2020 2020 204c     """.        L
-000016f0: 6f67 2065 7272 6f72 206c 6576 656c 2072  og error level r
-00001700: 6563 6f72 640a 0a20 2020 2020 2020 2053  ecord..        S
-00001710: 6565 2060 6c6f 6760 2066 6f72 2064 6f63  ee `log` for doc
-00001720: 756d 656e 7461 7469 6f6e 2e0a 2020 2020  umentation..    
-00001730: 2020 2020 2222 220a 0a63 6c61 7373 204c      """..class L
-00001740: 6f67 6765 7228 5f5f 4150 495f 4c6f 6767  ogger(__API_Logg
-00001750: 6572 293a 0a20 2020 2022 2222 2022 2222  er):.    """ """
-00001760: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00001770: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-00001780: 2c20 6368 616e 5f73 697a 653a 2069 6e74  , chan_size: int
-00001790: 2c20 6f76 6572 666c 6f77 5f73 7472 6174  , overflow_strat
-000017a0: 6567 793a 2022 4f76 6572 666c 6f77 5374  egy: "OverflowSt
-000017b0: 7261 7465 6779 220a 2020 2020 2920 2d3e  rategy".    ) ->
-000017c0: 204e 6f6e 653a 202e 2e2e 0a20 2020 2064   None: ....    d
-000017d0: 6566 206d 616b 655f 7265 6628 7365 6c66  ef make_ref(self
-000017e0: 2920 2d3e 2022 4c6f 6767 6572 5265 6622  ) -> "LoggerRef"
-000017f0: 3a20 2e2e 2e0a 0a63 6c61 7373 204c 6f67  : .....class Log
-00001800: 6765 7252 6566 285f 5f41 5049 5f4c 6f67  gerRef(__API_Log
-00001810: 6765 7229 3a0a 2020 2020 2222 2220 2222  ger):.    """ ""
-00001820: 220a 0a63 6c61 7373 205f 5f41 5049 5f52  "..class __API_R
-00001830: 6166 7453 7461 7465 285f 5f43 6c6f 6e65  aftState(__Clone
-00001840: 6162 6c65 293a 0a20 2020 2064 6566 2063  able):.    def c
-00001850: 6c6f 6e65 2873 656c 6629 202d 3e20 2252  lone(self) -> "R
-00001860: 6166 7453 7461 7465 223a 202e 2e2e 0a20  aftState": .... 
-00001870: 2020 2064 6566 2069 6e69 7469 616c 697a     def initializ
-00001880: 6564 2873 656c 6629 202d 3e20 626f 6f6c  ed(self) -> bool
-00001890: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000018a0: 2020 2020 2020 496e 6469 6361 7465 7320        Indicates 
-000018b0: 7468 6520 6052 6166 7453 7461 7465 6020  the `RaftState` 
-000018c0: 6973 2069 6e69 7469 616c 697a 6564 206f  is initialized o
-000018d0: 7220 6e6f 742e 0a20 2020 2020 2020 2022  r not..        "
-000018e0: 2222 0a20 2020 2064 6566 2067 6574 5f63  "".    def get_c
-000018f0: 6f6e 665f 7374 6174 6528 7365 6c66 2920  onf_state(self) 
-00001900: 2d3e 2022 436f 6e66 5374 6174 6552 6566  -> "ConfStateRef
-00001910: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
-00001920: 2020 2020 2020 2060 636f 6e66 5f73 7461         `conf_sta
-00001930: 7465 603a 2052 6563 6f72 6473 2074 6865  te`: Records the
-00001940: 2063 7572 7265 6e74 206e 6f64 6520 4944   current node ID
-00001950: 7320 6c69 6b65 2060 5b31 2c20 322c 2033  s like `[1, 2, 3
-00001960: 5d60 2069 6e20 7468 6520 636c 7573 7465  ]` in the cluste
-00001970: 722e 2045 7665 7279 2052 6166 7420 6e6f  r. Every Raft no
-00001980: 6465 206d 7573 7420 6861 7665 2061 0a20  de must have a. 
-00001990: 2020 2020 2020 2075 6e69 7175 6520 4944         unique ID
-000019a0: 2069 6e20 7468 6520 636c 7573 7465 723b   in the cluster;
-000019b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000019c0: 2064 6566 2073 6574 5f63 6f6e 665f 7374   def set_conf_st
-000019d0: 6174 6528 7365 6c66 2c20 6373 3a20 2243  ate(self, cs: "C
-000019e0: 6f6e 6653 7461 7465 5265 6622 2920 2d3e  onfStateRef") ->
-000019f0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00001a00: 2222 0a20 2020 2020 2020 2060 636f 6e66  "".        `conf
-00001a10: 5f73 7461 7465 603a 2052 6563 6f72 6473  _state`: Records
-00001a20: 2074 6865 2063 7572 7265 6e74 206e 6f64   the current nod
-00001a30: 6520 4944 7320 6c69 6b65 2060 5b31 2c20  e IDs like `[1, 
-00001a40: 322c 2033 5d60 2069 6e20 7468 6520 636c  2, 3]` in the cl
-00001a50: 7573 7465 722e 2045 7665 7279 2052 6166  uster. Every Raf
-00001a60: 7420 6e6f 6465 206d 7573 7420 6861 7665  t node must have
-00001a70: 2061 0a20 2020 2020 2020 2075 6e69 7175   a.        uniqu
-00001a80: 6520 4944 2069 6e20 7468 6520 636c 7573  e ID in the clus
-00001a90: 7465 723b 0a20 2020 2020 2020 2022 2222  ter;.        """
-00001aa0: 0a20 2020 2064 6566 2067 6574 5f68 6172  .    def get_har
-00001ab0: 645f 7374 6174 6528 7365 6c66 2920 2d3e  d_state(self) ->
-00001ac0: 2022 4861 7264 5374 6174 6552 6566 223a   "HardStateRef":
-00001ad0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00001ae0: 2020 2020 2060 6861 7264 5f73 7461 7465       `hard_state
-00001af0: 603a 2043 6f6e 7461 696e 7320 7468 6520  `: Contains the 
-00001b00: 6c61 7374 206d 6574 6120 696e 666f 726d  last meta inform
-00001b10: 6174 696f 6e20 696e 636c 7564 696e 6720  ation including 
-00001b20: 636f 6d6d 6974 2069 6e64 6578 2c20 7468  commit index, th
-00001b30: 6520 766f 7465 206c 6561 6465 722c 2061  e vote leader, a
-00001b40: 6e64 2074 6865 2076 6f74 6520 7465 726d  nd the vote term
-00001b50: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00001b60: 2020 6465 6620 7365 745f 6861 7264 5f73    def set_hard_s
-00001b70: 7461 7465 2873 656c 662c 2068 733a 2022  tate(self, hs: "
-00001b80: 4861 7264 5374 6174 6552 6566 2229 202d  HardStateRef") -
-00001b90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00001ba0: 2222 220a 2020 2020 2020 2020 6068 6172  """.        `har
-00001bb0: 645f 7374 6174 6560 3a20 436f 6e74 6169  d_state`: Contai
-00001bc0: 6e73 2074 6865 206c 6173 7420 6d65 7461  ns the last meta
-00001bd0: 2069 6e66 6f72 6d61 7469 6f6e 2069 6e63   information inc
-00001be0: 6c75 6469 6e67 2063 6f6d 6d69 7420 696e  luding commit in
-00001bf0: 6465 782c 2074 6865 2076 6f74 6520 6c65  dex, the vote le
-00001c00: 6164 6572 2c20 616e 6420 7468 6520 766f  ader, and the vo
-00001c10: 7465 2074 6572 6d2e 0a20 2020 2020 2020  te term..       
-00001c20: 2022 2222 0a0a 636c 6173 7320 5261 6674   """..class Raft
-00001c30: 5374 6174 6528 5f5f 4150 495f 5261 6674  State(__API_Raft
-00001c40: 5374 6174 6529 3a0a 2020 2020 2222 220a  State):.    """.
-00001c50: 2020 2020 486f 6c64 7320 626f 7468 2074      Holds both t
-00001c60: 6865 2068 6172 6420 7374 6174 6520 2863  he hard state (c
-00001c70: 6f6d 6d69 7420 696e 6465 782c 2076 6f74  ommit index, vot
-00001c80: 6520 6c65 6164 6572 2c20 7465 726d 2920  e leader, term) 
-00001c90: 616e 6420 7468 6520 636f 6e66 6967 7572  and the configur
-00001ca0: 6174 696f 6e20 7374 6174 650a 2020 2020  ation state.    
-00001cb0: 2843 7572 7265 6e74 206e 6f64 6520 4944  (Current node ID
-00001cc0: 7329 0a20 2020 2022 2222 0a0a 2020 2020  s).    """..    
-00001cd0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00001ce0: 6629 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a  f) -> None: ....
-00001cf0: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
-00001d00: 2873 656c 6629 202d 3e20 2252 6166 7453  (self) -> "RaftS
-00001d10: 7461 7465 5265 6622 3a20 2e2e 2e0a 2020  tateRef": ....  
-00001d20: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-00001d30: 2020 2020 6465 6620 6465 6661 756c 7428      def default(
-00001d40: 2920 2d3e 2022 5261 6674 5374 6174 6522  ) -> "RaftState"
-00001d50: 3a20 2e2e 2e0a 0a63 6c61 7373 2052 6166  : .....class Raf
-00001d60: 7453 7461 7465 5265 6628 5f5f 4150 495f  tStateRef(__API_
-00001d70: 5261 6674 5374 6174 6529 3a0a 2020 2020  RaftState):.    
-00001d80: 2222 220a 2020 2020 5265 6665 7265 6e63  """.    Referenc
-00001d90: 6520 7479 7065 206f 6620 3a63 6c61 7373  e type of :class
-00001da0: 3a60 5261 6674 5374 6174 6560 2e0a 2020  :`RaftState`..  
-00001db0: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
-00001dc0: 5049 5f53 746f 7261 6765 436f 7265 3a0a  PI_StorageCore:.
-00001dd0: 2020 2020 6465 6620 6170 7065 6e64 2873      def append(s
-00001de0: 656c 662c 2065 6e74 733a 204c 6973 745b  elf, ents: List[
-00001df0: 2245 6e74 7279 225d 207c 204c 6973 745b  "Entry"] | List[
-00001e00: 2245 6e74 7279 5265 6622 5d29 202d 3e20  "EntryRef"]) -> 
-00001e10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00001e20: 220a 2020 2020 2020 2020 4170 7065 6e64  ".        Append
-00001e30: 2074 6865 206e 6577 2065 6e74 7269 6573   the new entries
-00001e40: 2074 6f20 7374 6f72 6167 652e 0a0a 2020   to storage...  
-00001e50: 2020 2020 2020 2320 5061 6e69 6373 0a0a        # Panics..
-00001e60: 2020 2020 2020 2020 5061 6e69 6373 2069          Panics i
-00001e70: 6620 6065 6e74 7360 2063 6f6e 7461 696e  f `ents` contain
-00001e80: 7320 636f 6d70 6163 7465 6420 656e 7472  s compacted entr
-00001e90: 6965 732c 206f 7220 7468 6572 6527 7320  ies, or there's 
-00001ea0: 6120 6761 7020 6265 7477 6565 6e20 6065  a gap between `e
-00001eb0: 6e74 7360 2061 6e64 2074 6865 206c 6173  nts` and the las
-00001ec0: 740a 2020 2020 2020 2020 7265 6365 6976  t.        receiv
-00001ed0: 6564 2065 6e74 7279 2069 6e20 7468 6520  ed entry in the 
-00001ee0: 7374 6f72 6167 652e 0a20 2020 2020 2020  storage..       
-00001ef0: 2022 2222 0a20 2020 2064 6566 2061 7070   """.    def app
-00001f00: 6c79 5f73 6e61 7073 686f 7428 7365 6c66  ly_snapshot(self
-00001f10: 2c20 736e 6170 7368 6f74 3a20 2253 6e61  , snapshot: "Sna
-00001f20: 7073 686f 7422 207c 2022 536e 6170 7368  pshot" | "Snapsh
-00001f30: 6f74 5265 6622 2920 2d3e 204e 6f6e 653a  otRef") -> None:
-00001f40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00001f50: 2020 2020 204f 7665 7277 7269 7465 7320       Overwrites 
-00001f60: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
-00001f70: 7468 6973 2053 746f 7261 6765 206f 626a  this Storage obj
-00001f80: 6563 7420 7769 7468 2074 686f 7365 206f  ect with those o
-00001f90: 6620 7468 6520 6769 7665 6e20 736e 6170  f the given snap
-00001fa0: 7368 6f74 2e0a 0a20 2020 2020 2020 2023  shot...        #
-00001fb0: 2050 616e 6963 730a 0a20 2020 2020 2020   Panics..       
-00001fc0: 2050 616e 6963 7320 6966 2074 6865 2073   Panics if the s
-00001fd0: 6e61 7073 686f 7420 696e 6465 7820 6973  napshot index is
-00001fe0: 206c 6573 7320 7468 616e 2074 6865 2073   less than the s
-00001ff0: 746f 7261 6765 2773 2066 6972 7374 2069  torage's first i
-00002000: 6e64 6578 2e0a 2020 2020 2020 2020 2222  ndex..        ""
-00002010: 220a 2020 2020 6465 6620 636f 6d70 6163  ".    def compac
-00002020: 7428 7365 6c66 2c20 636f 6d70 6163 745f  t(self, compact_
-00002030: 696e 6465 783a 2069 6e74 2920 2d3e 204e  index: int) -> N
-00002040: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00002050: 0a20 2020 2020 2020 2044 6973 6361 7264  .        Discard
-00002060: 7320 616c 6c20 6c6f 6720 656e 7472 6965  s all log entrie
-00002070: 7320 7072 696f 7220 746f 2063 6f6d 7061  s prior to compa
-00002080: 6374 5f69 6e64 6578 2e0a 2020 2020 2020  ct_index..      
-00002090: 2020 4974 2069 7320 7468 6520 6170 706c    It is the appl
-000020a0: 6963 6174 696f 6e27 7320 7265 7370 6f6e  ication's respon
-000020b0: 7369 6269 6c69 7479 2074 6f20 6e6f 7420  sibility to not 
-000020c0: 6174 7465 6d70 7420 746f 2063 6f6d 7061  attempt to compa
-000020d0: 6374 2061 6e20 696e 6465 780a 2020 2020  ct an index.    
-000020e0: 2020 2020 6772 6561 7465 7220 7468 616e      greater than
-000020f0: 2052 6166 744c 6f67 2e61 7070 6c69 6564   RaftLog.applied
-00002100: 2e0a 0a20 2020 2020 2020 2023 2050 616e  ...        # Pan
-00002110: 6963 730a 0a20 2020 2020 2020 2050 616e  ics..        Pan
-00002120: 6963 7320 6966 2060 636f 6d70 6163 745f  ics if `compact_
-00002130: 696e 6465 7860 2069 7320 6869 6768 6572  index` is higher
-00002140: 2074 6861 6e20 6053 746f 7261 6765 3a3a   than `Storage::
-00002150: 6c61 7374 5f69 6e64 6578 2826 7365 6c66  last_index(&self
-00002160: 2920 2b20 3160 2e0a 2020 2020 2020 2020  ) + 1`..        
-00002170: 2222 220a 2020 2020 6465 6620 636f 6d6d  """.    def comm
-00002180: 6974 5f74 6f28 7365 6c66 2c20 696e 6465  it_to(self, inde
-00002190: 783a 2069 6e74 2920 2d3e 204e 6f6e 653a  x: int) -> None:
-000021a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000021b0: 2020 2020 2043 6f6d 6d69 7420 746f 2061       Commit to a
-000021c0: 6e20 696e 6465 782e 0a0a 2020 2020 2020  n index...      
-000021d0: 2020 2320 5061 6e69 6373 0a0a 2020 2020    # Panics..    
-000021e0: 2020 2020 5061 6e69 6373 2069 6620 7468      Panics if th
-000021f0: 6572 6520 6973 206e 6f20 7375 6368 2065  ere is no such e
-00002200: 6e74 7279 2069 6e20 7261 6674 206c 6f67  ntry in raft log
-00002210: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00002220: 2020 2064 6566 2063 6f6d 6d69 745f 746f     def commit_to
-00002230: 5f61 6e64 5f73 6574 5f63 6f6e 665f 7374  _and_set_conf_st
-00002240: 6174 6573 280a 2020 2020 2020 2020 7365  ates(.        se
-00002250: 6c66 2c20 6964 783a 2069 6e74 2c20 6373  lf, idx: int, cs
-00002260: 3a20 4f70 7469 6f6e 616c 5b22 436f 6e66  : Optional["Conf
-00002270: 5374 6174 6522 5d20 7c20 4f70 7469 6f6e  State"] | Option
-00002280: 616c 5b22 436f 6e66 5374 6174 6552 6566  al["ConfStateRef
-00002290: 225d 0a20 2020 2029 202d 3e20 4e6f 6e65  "].    ) -> None
-000022a0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000022b0: 2020 2020 2020 436f 6d6d 6974 2074 6f20        Commit to 
-000022c0: 6069 6478 6020 616e 6420 7365 7420 636f  `idx` and set co
-000022d0: 6e66 6967 7572 6174 696f 6e20 746f 2074  nfiguration to t
-000022e0: 6865 2067 6976 656e 2073 7461 7465 732e  he given states.
-000022f0: 204f 6e6c 7920 7573 6564 2066 6f72 2074   Only used for t
-00002300: 6573 7473 2e0a 2020 2020 2020 2020 2222  ests..        ""
-00002310: 220a 2020 2020 6465 6620 7365 745f 636f  ".    def set_co
-00002320: 6e66 5f73 7461 7465 2873 656c 662c 2063  nf_state(self, c
-00002330: 733a 2022 436f 6e66 5374 6174 6522 207c  s: "ConfState" |
-00002340: 2022 436f 6e66 5374 6174 6552 6566 2229   "ConfStateRef")
-00002350: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00002360: 2020 2222 220a 2020 2020 2020 2020 5361    """.        Sa
-00002370: 7665 7320 7468 6520 6375 7272 656e 7420  ves the current 
-00002380: 636f 6e66 2073 7461 7465 2e0a 2020 2020  conf state..    
-00002390: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-000023a0: 6861 7264 5f73 7461 7465 2873 656c 6629  hard_state(self)
-000023b0: 202d 3e20 2248 6172 6453 7461 7465 5265   -> "HardStateRe
-000023c0: 6622 3a0a 2020 2020 2020 2020 2222 220a  f":.        """.
-000023d0: 2020 2020 2020 2020 4765 7420 7468 6520          Get the 
-000023e0: 6861 7264 2073 7461 7465 2e0a 2020 2020  hard state..    
-000023f0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00002400: 7365 745f 6861 7264 7374 6174 6528 7365  set_hardstate(se
-00002410: 6c66 2c20 6873 3a20 2248 6172 6453 7461  lf, hs: "HardSta
-00002420: 7465 2220 7c20 2248 6172 6453 7461 7465  te" | "HardState
-00002430: 5265 6622 2920 2d3e 204e 6f6e 653a 0a20  Ref") -> None:. 
-00002440: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00002450: 2020 2053 6176 6573 2074 6865 2063 7572     Saves the cur
-00002460: 7265 6e74 2048 6172 6453 7461 7465 2e0a  rent HardState..
-00002470: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00002480: 6465 6620 7472 6967 6765 725f 736e 6170  def trigger_snap
-00002490: 5f75 6e61 7661 696c 6162 6c65 2873 656c  _unavailable(sel
-000024a0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000024b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000024c0: 5472 6967 6765 7220 6120 536e 6170 7368  Trigger a Snapsh
-000024d0: 6f74 5465 6d70 6f72 6172 696c 7955 6e61  otTemporarilyUna
-000024e0: 7661 696c 6162 6c65 2065 7272 6f72 2e0a  vailable error..
-000024f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00002500: 6465 6620 7472 6967 6765 725f 6c6f 675f  def trigger_log_
-00002510: 756e 6176 6169 6c61 626c 6528 7365 6c66  unavailable(self
-00002520: 2c20 763a 2062 6f6f 6c29 202d 3e20 4e6f  , v: bool) -> No
-00002530: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00002540: 2020 2020 2020 2020 5365 7420 6120 4c6f          Set a Lo
-00002550: 6754 656d 706f 7261 7269 6c79 556e 6176  gTemporarilyUnav
-00002560: 6169 6c61 626c 6520 6572 726f 722e 0a20  ailable error.. 
-00002570: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00002580: 6566 2074 616b 655f 6765 745f 656e 7472  ef take_get_entr
-00002590: 6965 735f 636f 6e74 6578 7428 7365 6c66  ies_context(self
-000025a0: 2920 2d3e 204f 7074 696f 6e61 6c5b 2247  ) -> Optional["G
-000025b0: 6574 456e 7472 6965 7343 6f6e 7465 7874  etEntriesContext
-000025c0: 225d 3a0a 2020 2020 2020 2020 2222 220a  "]:.        """.
-000025d0: 2020 2020 2020 2020 5461 6b65 2067 6574          Take get
-000025e0: 2065 6e74 7269 6573 2063 6f6e 7465 7874   entries context
-000025f0: 2e0a 2020 2020 2020 2020 2222 220a 0a63  ..        """..c
-00002600: 6c61 7373 204d 656d 5374 6f72 6167 6543  lass MemStorageC
-00002610: 6f72 6528 5f5f 4150 495f 5374 6f72 6167  ore(__API_Storag
-00002620: 6543 6f72 6529 3a0a 2020 2020 2222 220a  eCore):.    """.
-00002630: 2020 2020 5468 6520 4d65 6d6f 7279 2053      The Memory S
-00002640: 746f 7261 6765 2043 6f72 6520 696e 7374  torage Core inst
-00002650: 616e 6365 2068 6f6c 6473 2074 6865 2061  ance holds the a
-00002660: 6374 7561 6c20 7374 6174 6520 6f66 2074  ctual state of t
-00002670: 6865 2073 746f 7261 6765 2073 7472 7563  he storage struc
-00002680: 742e 2054 6f20 6163 6365 7373 2074 6869  t. To access thi
-00002690: 730a 2020 2020 7661 6c75 652c 2075 7365  s.    value, use
-000026a0: 2074 6865 2060 726c 6020 616e 6420 6077   the `rl` and `w
-000026b0: 6c60 2066 756e 6374 696f 6e73 206f 6e20  l` functions on 
-000026c0: 7468 6520 6d61 696e 204d 656d 5374 6f72  the main MemStor
-000026d0: 6167 6520 696d 706c 656d 656e 7461 7469  age implementati
-000026e0: 6f6e 2e0a 2020 2020 2222 220a 0a20 2020  on..    """..   
-000026f0: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
-00002700: 6c66 2920 2d3e 2022 4d65 6d53 746f 7261  lf) -> "MemStora
-00002710: 6765 436f 7265 5265 6622 3a20 2e2e 2e0a  geCoreRef": ....
-00002720: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00002730: 640a 2020 2020 6465 6620 6465 6661 756c  d.    def defaul
-00002740: 7428 2920 2d3e 2022 4d65 6d53 746f 7261  t() -> "MemStora
-00002750: 6765 436f 7265 223a 202e 2e2e 0a0a 636c  geCore": .....cl
-00002760: 6173 7320 4d65 6d53 746f 7261 6765 436f  ass MemStorageCo
-00002770: 7265 5265 6628 5f5f 4150 495f 5374 6f72  reRef(__API_Stor
-00002780: 6167 6543 6f72 6529 3a0a 2020 2020 2222  ageCore):.    ""
-00002790: 220a 2020 2020 5265 6665 7265 6e63 6520  ".    Reference 
-000027a0: 7479 7065 206f 6620 3a63 6c61 7373 3a60  type of :class:`
-000027b0: 4d65 6d53 746f 7261 6765 602e 0a20 2020  MemStorage`..   
-000027c0: 2022 2222 0a0a 636c 6173 7320 5374 6f72   """..class Stor
-000027d0: 6167 6543 6f72 6528 5f5f 4150 495f 5374  ageCore(__API_St
-000027e0: 6f72 6167 6543 6f72 6529 3a0a 2020 2020  orageCore):.    
-000027f0: 2222 2220 2222 220a 0a20 2020 2064 6566  """ """..    def
-00002800: 206d 616b 655f 7265 6628 7365 6c66 2920   make_ref(self) 
-00002810: 2d3e 2022 5374 6f72 6167 6543 6f72 6552  -> "StorageCoreR
-00002820: 6566 223a 202e 2e2e 0a20 2020 2040 7374  ef": ....    @st
-00002830: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00002840: 6566 2064 6566 6175 6c74 2829 202d 3e20  ef default() -> 
-00002850: 2253 746f 7261 6765 436f 7265 223a 202e  "StorageCore": .
-00002860: 2e2e 0a0a 636c 6173 7320 5374 6f72 6167  ....class Storag
-00002870: 6543 6f72 6552 6566 285f 5f41 5049 5f53  eCoreRef(__API_S
-00002880: 746f 7261 6765 436f 7265 293a 0a20 2020  torageCore):.   
-00002890: 2022 2222 0a20 2020 2052 6566 6572 656e   """.    Referen
-000028a0: 6365 2074 7970 6520 6f66 203a 636c 6173  ce type of :clas
-000028b0: 733a 6053 746f 7261 6765 436f 7265 602e  s:`StorageCore`.
-000028c0: 0a20 2020 2022 2222 0a0a 636c 6173 7320  .    """..class 
-000028d0: 5f5f 4150 495f 5374 6f72 6167 6528 5f5f  __API_Storage(__
-000028e0: 436c 6f6e 6561 626c 6529 3a0a 2020 2020  Cloneable):.    
-000028f0: 6465 6620 636c 6f6e 6528 7365 6c66 2920  def clone(self) 
-00002900: 2d3e 2041 6e79 3a20 2e2e 2e0a 2020 2020  -> Any: ....    
-00002910: 6465 6620 696e 6974 6961 6c69 7a65 5f77  def initialize_w
-00002920: 6974 685f 636f 6e66 5f73 7461 7465 280a  ith_conf_state(.
-00002930: 2020 2020 2020 2020 7365 6c66 2c20 636f          self, co
-00002940: 6e66 5f73 7461 7465 3a20 2243 6f6e 6653  nf_state: "ConfS
-00002950: 7461 7465 2220 7c20 2243 6f6e 6653 7461  tate" | "ConfSta
-00002960: 7465 5265 6622 0a20 2020 2029 202d 3e20  teRef".    ) -> 
-00002970: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00002980: 220a 2020 2020 2020 2020 496e 6974 6961  ".        Initia
-00002990: 6c69 7a65 2061 2060 4d65 6d53 746f 7261  lize a `MemStora
-000029a0: 6765 6020 7769 7468 2061 2067 6976 656e  ge` with a given
-000029b0: 2060 436f 6e66 6967 602e 0a0a 2020 2020   `Config`...    
-000029c0: 2020 2020 596f 7520 7368 6f75 6c64 2075      You should u
-000029d0: 7365 2074 6865 2073 616d 6520 696e 7075  se the same inpu
-000029e0: 7420 746f 2069 6e69 7469 616c 697a 6520  t to initialize 
-000029f0: 616c 6c20 6e6f 6465 732e 0a20 2020 2020  all nodes..     
-00002a00: 2020 2022 2222 0a20 2020 2064 6566 2069     """.    def i
-00002a10: 6e69 7469 616c 5f73 7461 7465 2873 656c  nitial_state(sel
-00002a20: 6629 202d 3e20 5261 6674 5374 6174 653a  f) -> RaftState:
-00002a30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00002a40: 2020 2020 2049 6d70 6c65 6d65 6e74 7320       Implements 
-00002a50: 7468 6520 5374 6f72 6167 6520 7472 6169  the Storage trai
-00002a60: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-00002a70: 2020 2064 6566 2065 6e74 7269 6573 280a     def entries(.
-00002a80: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00002a90: 2020 2020 2020 6c6f 773a 2069 6e74 2c0a        low: int,.
-00002aa0: 2020 2020 2020 2020 6869 6768 3a20 696e          high: in
-00002ab0: 742c 0a20 2020 2020 2020 2063 6f6e 7465  t,.        conte
-00002ac0: 7874 3a20 2247 6574 456e 7472 6965 7343  xt: "GetEntriesC
-00002ad0: 6f6e 7465 7874 5265 6622 2c0a 2020 2020  ontextRef",.    
-00002ae0: 2020 2020 6d61 785f 7369 7a65 3a20 4f70      max_size: Op
-00002af0: 7469 6f6e 616c 5b69 6e74 5d2c 0a20 2020  tional[int],.   
-00002b00: 2029 202d 3e20 4c69 7374 5b22 456e 7472   ) -> List["Entr
-00002b10: 7922 5d3a 0a20 2020 2020 2020 2022 2222  y"]:.        """
-00002b20: 0a20 2020 2020 2020 2049 6d70 6c65 6d65  .        Impleme
-00002b30: 6e74 7320 7468 6520 5374 6f72 6167 6520  nts the Storage 
-00002b40: 7472 6169 742e 0a20 2020 2020 2020 2022  trait..        "
-00002b50: 2222 0a20 2020 2064 6566 2074 6572 6d28  "".    def term(
-00002b60: 7365 6c66 2c20 6964 783a 2069 6e74 2920  self, idx: int) 
-00002b70: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00002b80: 2222 220a 2020 2020 2020 2020 496d 706c  """.        Impl
-00002b90: 656d 656e 7473 2074 6865 2053 746f 7261  ements the Stora
-00002ba0: 6765 2074 7261 6974 2e0a 2020 2020 2020  ge trait..      
-00002bb0: 2020 2222 220a 2020 2020 6465 6620 6669    """.    def fi
-00002bc0: 7273 745f 696e 6465 7828 7365 6c66 2920  rst_index(self) 
-00002bd0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00002be0: 2222 220a 2020 2020 2020 2020 496d 706c  """.        Impl
-00002bf0: 656d 656e 7473 2074 6865 2053 746f 7261  ements the Stora
-00002c00: 6765 2074 7261 6974 2e0a 2020 2020 2020  ge trait..      
-00002c10: 2020 2222 220a 2020 2020 6465 6620 6c61    """.    def la
-00002c20: 7374 5f69 6e64 6578 2873 656c 6629 202d  st_index(self) -
-00002c30: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-00002c40: 2222 0a20 2020 2020 2020 2049 6d70 6c65  "".        Imple
-00002c50: 6d65 6e74 7320 7468 6520 5374 6f72 6167  ments the Storag
-00002c60: 6520 7472 6169 742e 0a20 2020 2020 2020  e trait..       
-00002c70: 2022 2222 0a20 2020 2064 6566 2073 6e61   """.    def sna
-00002c80: 7073 686f 7428 7365 6c66 2c20 7265 7175  pshot(self, requ
-00002c90: 6573 745f 696e 6465 783a 2069 6e74 2c20  est_index: int, 
-00002ca0: 746f 3a20 696e 7429 202d 3e20 2253 6e61  to: int) -> "Sna
-00002cb0: 7073 686f 7422 3a0a 2020 2020 2020 2020  pshot":.        
-00002cc0: 2222 220a 2020 2020 2020 2020 496d 706c  """.        Impl
-00002cd0: 656d 656e 7473 2074 6865 2053 746f 7261  ements the Stora
-00002ce0: 6765 2074 7261 6974 2e0a 2020 2020 2020  ge trait..      
-00002cf0: 2020 2222 220a 0a63 6c61 7373 204d 656d    """..class Mem
-00002d00: 5374 6f72 6167 6528 5f5f 4150 495f 5374  Storage(__API_St
-00002d10: 6f72 6167 6529 3a0a 2020 2020 2222 220a  orage):.    """.
-00002d20: 2020 2020 604d 656d 5374 6f72 6167 6560      `MemStorage`
-00002d30: 2069 7320 6120 7468 7265 6164 2d73 6166   is a thread-saf
-00002d40: 6520 6275 7420 696e 636f 6d70 6c65 7465  e but incomplete
-00002d50: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
-00002d60: 6f66 2060 5374 6f72 6167 6560 2c20 6d61  of `Storage`, ma
-00002d70: 696e 6c79 2066 6f72 2074 6573 7473 2e0a  inly for tests..
-00002d80: 0a20 2020 2041 2072 6561 6c20 6053 746f  .    A real `Sto
-00002d90: 7261 6765 6020 7368 6f75 6c64 2073 6176  rage` should sav
-00002da0: 6520 626f 7468 2072 6166 7420 6c6f 6773  e both raft logs
-00002db0: 2061 6e64 2061 7070 6c69 6564 2064 6174   and applied dat
-00002dc0: 612e 2048 6f77 6576 6572 2060 4d65 6d53  a. However `MemS
-00002dd0: 746f 7261 6765 6020 6f6e 6c79 0a20 2020  torage` only.   
-00002de0: 2063 6f6e 7461 696e 7320 7261 6674 206c   contains raft l
-00002df0: 6f67 732e 2053 6f20 796f 7520 6361 6e20  ogs. So you can 
-00002e00: 6361 6c6c 2060 4d65 6d53 746f 7261 6765  call `MemStorage
-00002e10: 3a3a 6170 7065 6e64 6020 746f 2070 6572  ::append` to per
-00002e20: 7369 7374 206e 6577 2072 6563 6569 7665  sist new receive
-00002e30: 6420 756e 7374 6162 6c65 2072 6166 740a  d unstable raft.
-00002e40: 2020 2020 6c6f 6773 2061 6e64 2074 6865      logs and the
-00002e50: 6e20 6163 6365 7373 2074 6865 6d20 7769  n access them wi
-00002e60: 7468 2060 5374 6f72 6167 6560 2041 5049  th `Storage` API
-00002e70: 732e 2054 6865 206f 6e6c 7920 6578 6365  s. The only exce
-00002e80: 7074 696f 6e20 6973 2060 5374 6f72 6167  ption is `Storag
-00002e90: 653a 3a73 6e61 7073 686f 7460 2e20 5468  e::snapshot`. Th
-00002ea0: 6572 650a 2020 2020 6973 206e 6f20 6461  ere.    is no da
-00002eb0: 7461 2069 6e20 6053 6e61 7073 686f 7460  ta in `Snapshot`
-00002ec0: 2072 6574 7572 6e65 6420 6279 2060 4d65   returned by `Me
-00002ed0: 6d53 746f 7261 6765 3a3a 736e 6170 7368  mStorage::snapsh
-00002ee0: 6f74 6020 6265 6361 7573 6520 6170 706c  ot` because appl
-00002ef0: 6965 6420 6461 7461 2069 7320 6e6f 7420  ied data is not 
-00002f00: 7374 6f72 6564 0a20 2020 2069 6e20 604d  stored.    in `M
-00002f10: 656d 5374 6f72 6167 6560 2e0a 2020 2020  emStorage`..    
-00002f20: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00002f30: 6e69 745f 5f28 7365 6c66 2920 2d3e 204e  nit__(self) -> N
-00002f40: 6f6e 653a 202e 2e2e 0a20 2020 2064 6566  one: ....    def
-00002f50: 206d 616b 655f 7265 6628 7365 6c66 2920   make_ref(self) 
-00002f60: 2d3e 2022 4d65 6d53 746f 7261 6765 5265  -> "MemStorageRe
-00002f70: 6622 3a20 2e2e 2e0a 2020 2020 6465 6620  f": ....    def 
-00002f80: 636c 6f6e 6528 7365 6c66 2920 2d3e 2022  clone(self) -> "
-00002f90: 4d65 6d53 746f 7261 6765 223a 202e 2e2e  MemStorage": ...
-00002fa0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00002fb0: 6f64 0a20 2020 2064 6566 2064 6566 6175  od.    def defau
-00002fc0: 6c74 2829 202d 3e20 224d 656d 5374 6f72  lt() -> "MemStor
-00002fd0: 6167 6522 3a20 2e2e 2e0a 2020 2020 4073  age": ....    @s
-00002fe0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00002ff0: 6465 6620 6e65 775f 7769 7468 5f63 6f6e  def new_with_con
-00003000: 665f 7374 6174 6528 0a20 2020 2020 2020  f_state(.       
-00003010: 2063 6f6e 665f 7374 6174 653a 2022 436f   conf_state: "Co
-00003020: 6e66 5374 6174 6522 207c 2022 436f 6e66  nfState" | "Conf
-00003030: 5374 6174 6552 6566 222c 0a20 2020 2029  StateRef",.    )
-00003040: 202d 3e20 224d 656d 5374 6f72 6167 6522   -> "MemStorage"
-00003050: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00003060: 2020 2020 2020 4372 6561 7465 2061 206e        Create a n
-00003070: 6577 2060 4d65 6d53 746f 7261 6765 6020  ew `MemStorage` 
-00003080: 7769 7468 2061 2067 6976 656e 2060 436f  with a given `Co
-00003090: 6e66 6967 602e 2054 6865 2067 6976 656e  nfig`. The given
-000030a0: 2060 436f 6e66 6967 6020 7769 6c6c 2062   `Config` will b
-000030b0: 6520 7573 6564 2074 6f0a 2020 2020 2020  e used to.      
-000030c0: 2020 696e 6974 6961 6c69 7a65 2074 6865    initialize the
-000030d0: 2073 746f 7261 6765 2e0a 0a20 2020 2020   storage...     
-000030e0: 2020 2059 6f75 2073 686f 756c 6420 7573     You should us
-000030f0: 6520 7468 6520 7361 6d65 2069 6e70 7574  e the same input
-00003100: 2074 6f20 696e 6974 6961 6c69 7a65 2061   to initialize a
-00003110: 6c6c 206e 6f64 6573 2e0a 2020 2020 2020  ll nodes..      
-00003120: 2020 2222 220a 2020 2020 6465 6620 776c    """.    def wl
-00003130: 2873 656c 6629 202d 3e20 224d 656d 5374  (self) -> "MemSt
-00003140: 6f72 6167 6543 6f72 6552 6566 223a 0a20  orageCoreRef":. 
-00003150: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003160: 2020 204f 7065 6e73 2075 7020 6120 7772     Opens up a wr
-00003170: 6974 6520 6c6f 636b 206f 6e20 7468 6520  ite lock on the 
-00003180: 7374 6f72 6167 6520 616e 6420 7265 7475  storage and retu
-00003190: 726e 7320 6775 6172 6420 6861 6e64 6c65  rns guard handle
-000031a0: 2e20 5573 6520 7468 6973 0a20 2020 2020  . Use this.     
-000031b0: 2020 2077 6974 6820 6675 6e63 7469 6f6e     with function
-000031c0: 7320 7468 6174 2074 616b 6520 6120 6d75  s that take a mu
-000031d0: 7461 626c 6520 7265 6665 7265 6e63 6520  table reference 
-000031e0: 746f 2073 656c 662e 0a20 2020 2020 2020  to self..       
-000031f0: 2022 2222 0a20 2020 2064 6566 2072 6c28   """.    def rl(
-00003200: 7365 6c66 2920 2d3e 2022 4d65 6d53 746f  self) -> "MemSto
-00003210: 7261 6765 436f 7265 5265 6622 3a0a 2020  rageCoreRef":.  
-00003220: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00003230: 2020 4f70 656e 7320 7570 2061 2072 6561    Opens up a rea
-00003240: 6420 6c6f 636b 206f 6e20 7468 6520 7374  d lock on the st
-00003250: 6f72 6167 6520 616e 6420 7265 7475 726e  orage and return
-00003260: 7320 6120 6775 6172 6420 6861 6e64 6c65  s a guard handle
-00003270: 2e20 5573 6520 7468 6973 0a20 2020 2020  . Use this.     
-00003280: 2020 2077 6974 6820 6675 6e63 7469 6f6e     with function
-00003290: 7320 7468 6174 2064 6f6e 2774 2072 6571  s that don't req
-000032a0: 7569 7265 206d 7574 6174 696f 6e2e 0a20  uire mutation.. 
-000032b0: 2020 2020 2020 2022 2222 0a0a 636c 6173         """..clas
-000032c0: 7320 4d65 6d53 746f 7261 6765 5265 6628  s MemStorageRef(
-000032d0: 5f5f 4150 495f 5374 6f72 6167 6529 3a0a  __API_Storage):.
-000032e0: 2020 2020 2222 220a 2020 2020 5265 6665      """.    Refe
-000032f0: 7265 6e63 6520 7479 7065 206f 6620 3a63  rence type of :c
-00003300: 6c61 7373 3a60 4d65 6d53 746f 7261 6765  lass:`MemStorage
-00003310: 602e 0a20 2020 2022 2222 0a0a 2020 2020  `..    """..    
-00003320: 6465 6620 636c 6f6e 6528 7365 6c66 2920  def clone(self) 
-00003330: 2d3e 2022 4d65 6d53 746f 7261 6765 223a  -> "MemStorage":
-00003340: 202e 2e2e 0a20 2020 2064 6566 2077 6c28   ....    def wl(
-00003350: 7365 6c66 2920 2d3e 2022 4d65 6d53 746f  self) -> "MemSto
-00003360: 7261 6765 436f 7265 5265 6622 3a0a 2020  rageCoreRef":.  
-00003370: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00003380: 2020 4f70 656e 7320 7570 2061 2077 7269    Opens up a wri
-00003390: 7465 206c 6f63 6b20 6f6e 2074 6865 2073  te lock on the s
-000033a0: 746f 7261 6765 2061 6e64 2072 6574 7572  torage and retur
-000033b0: 6e73 2067 7561 7264 2068 616e 646c 652e  ns guard handle.
-000033c0: 2055 7365 2074 6869 730a 2020 2020 2020   Use this.      
-000033d0: 2020 7769 7468 2066 756e 6374 696f 6e73    with functions
-000033e0: 2074 6861 7420 7461 6b65 2061 206d 7574   that take a mut
-000033f0: 6162 6c65 2072 6566 6572 656e 6365 2074  able reference t
-00003400: 6f20 7365 6c66 2e0a 2020 2020 2020 2020  o self..        
-00003410: 2222 220a 2020 2020 6465 6620 726c 2873  """.    def rl(s
-00003420: 656c 6629 202d 3e20 224d 656d 5374 6f72  elf) -> "MemStor
-00003430: 6167 6543 6f72 6552 6566 223a 0a20 2020  ageCoreRef":.   
-00003440: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003450: 204f 7065 6e73 2075 7020 6120 7265 6164   Opens up a read
-00003460: 206c 6f63 6b20 6f6e 2074 6865 2073 746f   lock on the sto
-00003470: 7261 6765 2061 6e64 2072 6574 7572 6e73  rage and returns
-00003480: 2061 2067 7561 7264 2068 616e 646c 652e   a guard handle.
-00003490: 2055 7365 2074 6869 730a 2020 2020 2020   Use this.      
-000034a0: 2020 7769 7468 2066 756e 6374 696f 6e73    with functions
-000034b0: 2074 6861 7420 646f 6e27 7420 7265 7175   that don't requ
-000034c0: 6972 6520 6d75 7461 7469 6f6e 2e0a 2020  ire mutation..  
-000034d0: 2020 2020 2020 2222 220a 0a63 6c61 7373        """..class
-000034e0: 2053 746f 7261 6765 285f 5f41 5049 5f53   Storage(__API_S
-000034f0: 746f 7261 6765 293a 0a20 2020 2022 2222  torage):.    """
-00003500: 0a20 2020 2053 746f 7261 6765 2073 6176  .    Storage sav
-00003510: 6573 2061 6c6c 2074 6865 2069 6e66 6f72  es all the infor
-00003520: 6d61 7469 6f6e 2061 626f 7574 2074 6865  mation about the
-00003530: 2063 7572 7265 6e74 2052 6166 7420 696d   current Raft im
-00003540: 706c 656d 656e 7461 7469 6f6e 2c20 696e  plementation, in
-00003550: 636c 7564 696e 6720 5261 6674 204c 6f67  cluding Raft Log
-00003560: 2c0a 2020 2020 636f 6d6d 6974 2069 6e64  ,.    commit ind
-00003570: 6578 2c20 7468 6520 6c65 6164 6572 2074  ex, the leader t
-00003580: 6f20 766f 7465 2066 6f72 2c20 6574 632e  o vote for, etc.
-00003590: 0a0a 2020 2020 4966 2061 6e79 2053 746f  ..    If any Sto
-000035a0: 7261 6765 206d 6574 686f 6420 7265 7475  rage method retu
-000035b0: 726e 7320 616e 2065 7272 6f72 2c20 7468  rns an error, th
-000035c0: 6520 7261 6674 2069 6e73 7461 6e63 6520  e raft instance 
-000035d0: 7769 6c6c 0a20 2020 2062 6563 6f6d 6520  will.    become 
-000035e0: 696e 6f70 6572 6162 6c65 2061 6e64 2072  inoperable and r
-000035f0: 6566 7573 6520 746f 2070 6172 7469 6369  efuse to partici
-00003600: 7061 7465 2069 6e20 656c 6563 7469 6f6e  pate in election
-00003610: 733b 2074 6865 0a20 2020 2061 7070 6c69  s; the.    appli
-00003620: 6361 7469 6f6e 2069 7320 7265 7370 6f6e  cation is respon
-00003630: 7369 626c 6520 666f 7220 636c 6561 6e75  sible for cleanu
-00003640: 7020 616e 6420 7265 636f 7665 7279 2069  p and recovery i
-00003650: 6e20 7468 6973 2063 6173 652e 0a20 2020  n this case..   
-00003660: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-00003670: 696e 6974 5f5f 2873 656c 6629 202d 3e20  init__(self) -> 
-00003680: 4e6f 6e65 3a20 2e2e 2e0a 2020 2020 6465  None: ....    de
-00003690: 6620 6d61 6b65 5f72 6566 2873 656c 6629  f make_ref(self)
-000036a0: 202d 3e20 2253 746f 7261 6765 5265 6622   -> "StorageRef"
-000036b0: 3a20 2e2e 2e0a 2020 2020 6465 6620 636c  : ....    def cl
-000036c0: 6f6e 6528 7365 6c66 2920 2d3e 2022 5374  one(self) -> "St
-000036d0: 6f72 6167 6522 3a20 2e2e 2e0a 2020 2020  orage": ....    
-000036e0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-000036f0: 2020 6465 6620 6465 6661 756c 7428 2920    def default() 
-00003700: 2d3e 2022 5374 6f72 6167 6522 3a20 2e2e  -> "Storage": ..
-00003710: 2e0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00003720: 686f 640a 2020 2020 6465 6620 6e65 775f  hod.    def new_
-00003730: 7769 7468 5f63 6f6e 665f 7374 6174 6528  with_conf_state(
-00003740: 0a20 2020 2020 2020 2063 6f6e 665f 7374  .        conf_st
-00003750: 6174 653a 2022 436f 6e66 5374 6174 6522  ate: "ConfState"
-00003760: 207c 2022 436f 6e66 5374 6174 6552 6566   | "ConfStateRef
-00003770: 222c 0a20 2020 2029 202d 3e20 2253 746f  ",.    ) -> "Sto
-00003780: 7261 6765 223a 0a20 2020 2020 2020 2022  rage":.        "
-00003790: 2222 2022 2222 0a20 2020 2064 6566 2077  "" """.    def w
-000037a0: 6c28 7365 6c66 2920 2d3e 2041 6e79 3a0a  l(self) -> Any:.
-000037b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000037c0: 2020 2020 4f70 656e 7320 7570 2061 2077      Opens up a w
-000037d0: 7269 7465 206c 6f63 6b20 6f6e 2074 6865  rite lock on the
-000037e0: 2073 746f 7261 6765 2061 6e64 2072 6574   storage and ret
-000037f0: 7572 6e73 2067 7561 7264 2068 616e 646c  urns guard handl
-00003800: 652e 2055 7365 2074 6869 730a 2020 2020  e. Use this.    
-00003810: 2020 2020 7769 7468 2066 756e 6374 696f      with functio
-00003820: 6e73 2074 6861 7420 7461 6b65 2061 206d  ns that take a m
-00003830: 7574 6162 6c65 2072 6566 6572 656e 6365  utable reference
-00003840: 2074 6f20 7365 6c66 2e0a 2020 2020 2020   to self..      
-00003850: 2020 2222 220a 2020 2020 6465 6620 726c    """.    def rl
-00003860: 2873 656c 6629 202d 3e20 416e 793a 0a20  (self) -> Any:. 
-00003870: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003880: 2020 204f 7065 6e73 2075 7020 6120 7265     Opens up a re
-00003890: 6164 206c 6f63 6b20 6f6e 2074 6865 2073  ad lock on the s
-000038a0: 746f 7261 6765 2061 6e64 2072 6574 7572  torage and retur
-000038b0: 6e73 2061 2067 7561 7264 2068 616e 646c  ns a guard handl
-000038c0: 652e 2055 7365 2074 6869 730a 2020 2020  e. Use this.    
-000038d0: 2020 2020 7769 7468 2066 756e 6374 696f      with functio
-000038e0: 6e73 2074 6861 7420 646f 6e27 7420 7265  ns that don't re
-000038f0: 7175 6972 6520 6d75 7461 7469 6f6e 2e0a  quire mutation..
-00003900: 2020 2020 2020 2020 2222 220a 0a63 6c61          """..cla
-00003910: 7373 2053 746f 7261 6765 5265 6628 5f5f  ss StorageRef(__
-00003920: 4150 495f 5374 6f72 6167 6529 3a0a 2020  API_Storage):.  
-00003930: 2020 2222 220a 2020 2020 5265 6665 7265    """.    Refere
-00003940: 6e63 6520 7479 7065 206f 6620 3a63 6c61  nce type of :cla
-00003950: 7373 3a60 5374 6f72 6167 6560 2e0a 2020  ss:`Storage`..  
-00003960: 2020 2222 220a 0a20 2020 2064 6566 2063    """..    def c
-00003970: 6c6f 6e65 2873 656c 6629 202d 3e20 2253  lone(self) -> "S
-00003980: 746f 7261 6765 223a 202e 2e2e 0a20 2020  torage": ....   
-00003990: 2064 6566 2077 6c28 7365 6c66 2920 2d3e   def wl(self) ->
-000039a0: 2041 6e79 3a0a 2020 2020 2020 2020 2222   Any:.        ""
-000039b0: 220a 2020 2020 2020 2020 4f70 656e 7320  ".        Opens 
-000039c0: 7570 2061 2077 7269 7465 206c 6f63 6b20  up a write lock 
-000039d0: 6f6e 2074 6865 2073 746f 7261 6765 2061  on the storage a
-000039e0: 6e64 2072 6574 7572 6e73 2067 7561 7264  nd returns guard
-000039f0: 2068 616e 646c 652e 2055 7365 2074 6869   handle. Use thi
-00003a00: 730a 2020 2020 2020 2020 7769 7468 2066  s.        with f
-00003a10: 756e 6374 696f 6e73 2074 6861 7420 7461  unctions that ta
-00003a20: 6b65 2061 206d 7574 6162 6c65 2072 6566  ke a mutable ref
-00003a30: 6572 656e 6365 2074 6f20 7365 6c66 2e0a  erence to self..
-00003a40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003a50: 6465 6620 726c 2873 656c 6629 202d 3e20  def rl(self) -> 
-00003a60: 416e 793a 0a20 2020 2020 2020 2022 2222  Any:.        """
-00003a70: 0a20 2020 2020 2020 204f 7065 6e73 2075  .        Opens u
-00003a80: 7020 6120 7265 6164 206c 6f63 6b20 6f6e  p a read lock on
-00003a90: 2074 6865 2073 746f 7261 6765 2061 6e64   the storage and
-00003aa0: 2072 6574 7572 6e73 2061 2067 7561 7264   returns a guard
-00003ab0: 2068 616e 646c 652e 2055 7365 2074 6869   handle. Use thi
-00003ac0: 730a 2020 2020 2020 2020 7769 7468 2066  s.        with f
-00003ad0: 756e 6374 696f 6e73 2074 6861 7420 646f  unctions that do
-00003ae0: 6e27 7420 7265 7175 6972 6520 6d75 7461  n't require muta
-00003af0: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
-00003b00: 220a 0a63 6c61 7373 205f 5f41 5049 5f52  "..class __API_R
-00003b10: 6561 6479 3a0a 2020 2020 6465 6620 6873  eady:.    def hs
-00003b20: 2873 656c 6629 202d 3e20 4f70 7469 6f6e  (self) -> Option
-00003b30: 616c 5b22 4861 7264 5374 6174 6552 6566  al["HardStateRef
-00003b40: 225d 3a0a 2020 2020 2020 2020 2222 220a  "]:.        """.
-00003b50: 2020 2020 2020 2020 5468 6520 6375 7272          The curr
-00003b60: 656e 7420 7374 6174 6520 6f66 2061 204e  ent state of a N
-00003b70: 6f64 6520 746f 2062 6520 7361 7665 6420  ode to be saved 
-00003b80: 746f 2073 7461 626c 6520 7374 6f72 6167  to stable storag
-00003b90: 652e 0a20 2020 2020 2020 2048 6172 6453  e..        HardS
-00003ba0: 7461 7465 2077 696c 6c20 6265 204e 6f6e  tate will be Non
-00003bb0: 6520 7374 6174 6520 6966 2074 6865 7265  e state if there
-00003bc0: 2069 7320 6e6f 2075 7064 6174 652e 0a20   is no update.. 
-00003bd0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00003be0: 6566 2073 7328 7365 6c66 2920 2d3e 204f  ef ss(self) -> O
-00003bf0: 7074 696f 6e61 6c5b 2253 6f66 7453 7461  ptional["SoftSta
-00003c00: 7465 5265 6622 5d3a 0a20 2020 2020 2020  teRef"]:.       
-00003c10: 2022 2222 0a20 2020 2020 2020 2054 6865   """.        The
-00003c20: 2063 7572 7265 6e74 2076 6f6c 6174 696c   current volatil
-00003c30: 6520 7374 6174 6520 6f66 2061 204e 6f64  e state of a Nod
-00003c40: 652e 0a20 2020 2020 2020 2053 6f66 7453  e..        SoftS
-00003c50: 7461 7465 2077 696c 6c20 6265 204e 6f6e  tate will be Non
-00003c60: 6520 6966 2074 6865 7265 2069 7320 6e6f  e if there is no
-00003c70: 2075 7064 6174 652e 0a20 2020 2020 2020   update..       
-00003c80: 2049 7420 6973 206e 6f74 2072 6571 7569   It is not requi
-00003c90: 7265 6420 746f 2063 6f6e 7375 6d65 206f  red to consume o
-00003ca0: 7220 7374 6f72 6520 536f 6674 5374 6174  r store SoftStat
-00003cb0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00003cc0: 2020 2064 6566 206d 7573 745f 7379 6e63     def must_sync
-00003cd0: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-00003ce0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003cf0: 2020 2020 4d75 7374 5379 6e63 2069 7320      MustSync is 
-00003d00: 6661 6c73 6520 6966 2061 6e64 206f 6e6c  false if and onl
-00003d10: 7920 6966 0a20 2020 2020 2020 2031 2e20  y if.        1. 
-00003d20: 6e6f 2048 6172 6453 7461 7465 206f 7220  no HardState or 
-00003d30: 6f6e 6c79 2069 7473 2063 6f6d 6d69 7420  only its commit 
-00003d40: 6973 2064 6966 6665 7265 6e74 2066 726f  is different fro
-00003d50: 6d20 6265 666f 7265 0a20 2020 2020 2020  m before.       
-00003d60: 2032 2e20 6e6f 2045 6e74 7269 6573 2061   2. no Entries a
-00003d70: 6e64 2053 6e61 7073 686f 740a 2020 2020  nd Snapshot.    
-00003d80: 2020 2020 4966 2069 7427 7320 6661 6c73      If it's fals
-00003d90: 652c 2061 6e20 6173 796e 6368 726f 6e6f  e, an asynchrono
-00003da0: 7573 2077 7269 7465 206f 6620 4861 7264  us write of Hard
-00003db0: 5374 6174 6520 6973 2070 6572 6d69 7373  State is permiss
-00003dc0: 6962 6c65 2062 6566 6f72 6520 6361 6c6c  ible before call
-00003dd0: 696e 670a 2020 2020 2020 2020 5b60 5261  ing.        [`Ra
-00003de0: 774e 6f64 653a 3a6f 6e5f 7065 7273 6973  wNode::on_persis
-00003df0: 745f 7265 6164 7960 5d20 6f72 205b 6052  t_ready`] or [`R
-00003e00: 6177 4e6f 6465 3a3a 6164 7661 6e63 6560  awNode::advance`
-00003e10: 5d20 6f72 2069 7473 2066 616d 696c 6965  ] or its familie
-00003e20: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00003e30: 2020 2064 6566 206e 756d 6265 7228 7365     def number(se
-00003e40: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00003e50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00003e60: 5468 6520 6e75 6d62 6572 206f 6620 6375  The number of cu
-00003e70: 7272 656e 7420 5265 6164 792e 0a20 2020  rrent Ready..   
-00003e80: 2020 2020 2049 7420 6973 2075 7365 6420       It is used 
-00003e90: 666f 7220 6964 656e 7469 6679 696e 6720  for identifying 
-00003ea0: 7468 6520 6469 6666 6572 656e 7420 5265  the different Re
-00003eb0: 6164 7920 616e 6420 5265 6164 7952 6563  ady and ReadyRec
-00003ec0: 6f72 642e 0a20 2020 2020 2020 2022 2222  ord..        """
-00003ed0: 0a20 2020 2064 6566 2073 6e61 7073 686f  .    def snapsho
-00003ee0: 7428 7365 6c66 2920 2d3e 2022 536e 6170  t(self) -> "Snap
-00003ef0: 7368 6f74 5265 6622 3a0a 2020 2020 2020  shotRef":.      
-00003f00: 2020 2222 220a 2020 2020 2020 2020 536e    """.        Sn
-00003f10: 6170 7368 6f74 2073 7065 6369 6669 6573  apshot specifies
-00003f20: 2074 6865 2073 6e61 7073 686f 7420 746f   the snapshot to
-00003f30: 2062 6520 7361 7665 6420 746f 2073 7461   be saved to sta
-00003f40: 626c 6520 7374 6f72 6167 652e 0a20 2020  ble storage..   
-00003f50: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00003f60: 2063 6f6d 6d69 7474 6564 5f65 6e74 7269   committed_entri
-00003f70: 6573 2873 656c 6629 202d 3e20 4c69 7374  es(self) -> List
-00003f80: 5b22 456e 7472 7952 6566 225d 3a0a 2020  ["EntryRef"]:.  
-00003f90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00003fa0: 2020 436f 6d6d 6974 7465 6445 6e74 7269    CommittedEntri
-00003fb0: 6573 2073 7065 6369 6669 6573 2065 6e74  es specifies ent
-00003fc0: 7269 6573 2074 6f20 6265 2063 6f6d 6d69  ries to be commi
-00003fd0: 7474 6564 2074 6f20 610a 2020 2020 2020  tted to a.      
-00003fe0: 2020 7374 6f72 652f 7374 6174 652d 6d61    store/state-ma
-00003ff0: 6368 696e 652e 2054 6865 7365 2068 6176  chine. These hav
-00004000: 6520 7072 6576 696f 7573 6c79 2062 6565  e previously bee
-00004010: 6e20 636f 6d6d 6974 7465 6420 746f 2073  n committed to s
-00004020: 7461 626c 650a 2020 2020 2020 2020 7374  table.        st
-00004030: 6f72 652e 0a20 2020 2020 2020 2022 2222  ore..        """
-00004040: 0a20 2020 2064 6566 2074 616b 655f 636f  .    def take_co
-00004050: 6d6d 6974 7465 645f 656e 7472 6965 7328  mmitted_entries(
-00004060: 7365 6c66 2920 2d3e 204c 6973 745b 2245  self) -> List["E
-00004070: 6e74 7279 225d 3a0a 2020 2020 2020 2020  ntry"]:.        
-00004080: 2222 220a 2020 2020 2020 2020 5461 6b65  """.        Take
-00004090: 2074 6865 2043 6f6d 6d69 7445 6e74 7269   the CommitEntri
-000040a0: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-000040b0: 2020 2020 6465 6620 656e 7472 6965 7328      def entries(
-000040c0: 7365 6c66 2920 2d3e 204c 6973 745b 2245  self) -> List["E
-000040d0: 6e74 7279 5265 6622 5d3a 0a20 2020 2020  ntryRef"]:.     
-000040e0: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
-000040f0: 6e74 7269 6573 2073 7065 6369 6669 6573  ntries specifies
-00004100: 2065 6e74 7269 6573 2074 6f20 6265 2073   entries to be s
-00004110: 6176 6564 2074 6f20 7374 6162 6c65 2073  aved to stable s
-00004120: 746f 7261 6765 2e0a 2020 2020 2020 2020  torage..        
-00004130: 2222 220a 2020 2020 6465 6620 7461 6b65  """.    def take
-00004140: 5f65 6e74 7269 6573 2873 656c 6629 202d  _entries(self) -
-00004150: 3e20 4c69 7374 5b22 456e 7472 7922 5d3a  > List["Entry"]:
-00004160: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004170: 2020 2020 2054 616b 6520 7468 6520 456e       Take the En
-00004180: 7472 6965 732e 0a20 2020 2020 2020 2022  tries..        "
-00004190: 2222 0a20 2020 2064 6566 206d 6573 7361  "".    def messa
-000041a0: 6765 7328 7365 6c66 2920 2d3e 204c 6973  ges(self) -> Lis
-000041b0: 745b 224d 6573 7361 6765 5265 6622 5d3a  t["MessageRef"]:
-000041c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000041d0: 2020 2020 204d 6573 7361 6765 7320 7370       Messages sp
-000041e0: 6563 6966 6965 7320 6f75 7462 6f75 6e64  ecifies outbound
-000041f0: 206d 6573 7361 6765 7320 746f 2062 6520   messages to be 
-00004200: 7365 6e74 2e0a 2020 2020 2020 2020 4966  sent..        If
-00004210: 2069 7420 636f 6e74 6169 6e73 2061 204d   it contains a M
-00004220: 7367 536e 6170 206d 6573 7361 6765 2c20  sgSnap message, 
-00004230: 7468 6520 6170 706c 6963 6174 696f 6e20  the application 
-00004240: 4d55 5354 2072 6570 6f72 7420 6261 636b  MUST report back
-00004250: 2074 6f20 7261 6674 0a20 2020 2020 2020   to raft.       
-00004260: 2077 6865 6e20 7468 6520 736e 6170 7368   when the snapsh
-00004270: 6f74 2068 6173 2062 6565 6e20 7265 6365  ot has been rece
-00004280: 6976 6564 206f 7220 6861 7320 6661 696c  ived or has fail
-00004290: 6564 2062 7920 6361 6c6c 696e 6720 5265  ed by calling Re
-000042a0: 706f 7274 536e 6170 7368 6f74 2e0a 2020  portSnapshot..  
-000042b0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-000042c0: 6620 7461 6b65 5f6d 6573 7361 6765 7328  f take_messages(
-000042d0: 7365 6c66 2920 2d3e 204c 6973 745b 224d  self) -> List["M
-000042e0: 6573 7361 6765 225d 3a0a 2020 2020 2020  essage"]:.      
-000042f0: 2020 2222 220a 2020 2020 2020 2020 5461    """.        Ta
-00004300: 6b65 2074 6865 204d 6573 7361 6765 732e  ke the Messages.
-00004310: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004320: 2064 6566 2070 6572 7369 7374 6564 5f6d   def persisted_m
-00004330: 6573 7361 6765 7328 7365 6c66 2920 2d3e  essages(self) ->
-00004340: 204c 6973 745b 224d 6573 7361 6765 5265   List["MessageRe
-00004350: 6622 5d3a 0a20 2020 2020 2020 2022 2222  f"]:.        """
-00004360: 0a20 2020 2020 2020 2050 6572 7369 7374  .        Persist
-00004370: 6564 204d 6573 7361 6765 7320 7370 6563  ed Messages spec
-00004380: 6966 6965 7320 6f75 7462 6f75 6e64 206d  ifies outbound m
-00004390: 6573 7361 6765 7320 746f 2062 6520 7365  essages to be se
-000043a0: 6e74 2041 4654 4552 2074 6865 2048 6172  nt AFTER the Har
-000043b0: 6453 7461 7465 2c0a 2020 2020 2020 2020  dState,.        
-000043c0: 456e 7472 6965 7320 616e 6420 536e 6170  Entries and Snap
-000043d0: 7368 6f74 2061 7265 2070 6572 7369 7374  shot are persist
-000043e0: 6564 2074 6f20 7374 6162 6c65 2073 746f  ed to stable sto
-000043f0: 7261 6765 2e0a 2020 2020 2020 2020 2222  rage..        ""
-00004400: 220a 2020 2020 6465 6620 7461 6b65 5f70  ".    def take_p
-00004410: 6572 7369 7374 6564 5f6d 6573 7361 6765  ersisted_message
-00004420: 7328 7365 6c66 2920 2d3e 204c 6973 745b  s(self) -> List[
-00004430: 224d 6573 7361 6765 225d 3a0a 2020 2020  "Message"]:.    
-00004440: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004450: 5461 6b65 2074 6865 2050 6572 7369 7374  Take the Persist
-00004460: 6564 204d 6573 7361 6765 732e 0a20 2020  ed Messages..   
-00004470: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00004480: 2072 6561 645f 7374 6174 6573 2873 656c   read_states(sel
-00004490: 6629 202d 3e20 4c69 7374 5b22 5265 6164  f) -> List["Read
-000044a0: 5374 6174 6552 6566 225d 3a0a 2020 2020  StateRef"]:.    
-000044b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000044c0: 5265 6164 5374 6174 6573 2073 7065 6369  ReadStates speci
-000044d0: 6669 6573 2074 6865 2073 7461 7465 2066  fies the state f
-000044e0: 6f72 2072 6561 6420 6f6e 6c79 2071 7565  or read only que
-000044f0: 7279 2e0a 2020 2020 2020 2020 2222 220a  ry..        """.
-00004500: 2020 2020 6465 6620 7461 6b65 5f72 6561      def take_rea
-00004510: 645f 7374 6174 6573 2873 656c 6629 202d  d_states(self) -
-00004520: 3e20 4c69 7374 5b22 5265 6164 5374 6174  > List["ReadStat
-00004530: 6522 5d3a 0a20 2020 2020 2020 2022 2222  e"]:.        """
-00004540: 0a20 2020 2020 2020 2052 6561 6453 7461  .        ReadSta
-00004550: 7465 7320 7370 6563 6966 6965 7320 7468  tes specifies th
-00004560: 6520 7374 6174 6520 666f 7220 7265 6164  e state for read
-00004570: 206f 6e6c 7920 7175 6572 792e 0a20 2020   only query..   
-00004580: 2020 2020 2022 2222 0a0a 636c 6173 7320       """..class 
-00004590: 5265 6164 7928 5f5f 4150 495f 5265 6164  Ready(__API_Read
-000045a0: 7929 3a0a 2020 2020 2222 220a 2020 2020  y):.    """.    
-000045b0: 5265 6164 7920 656e 6361 7073 756c 6174  Ready encapsulat
-000045c0: 6573 2074 6865 2065 6e74 7269 6573 2061  es the entries a
-000045d0: 6e64 206d 6573 7361 6765 7320 7468 6174  nd messages that
-000045e0: 2061 7265 2072 6561 6479 2074 6f20 7265   are ready to re
-000045f0: 6164 2c0a 2020 2020 6265 2073 6176 6564  ad,.    be saved
-00004600: 2074 6f20 7374 6162 6c65 2073 746f 7261   to stable stora
-00004610: 6765 2c20 636f 6d6d 6974 7465 6420 6f72  ge, committed or
-00004620: 2073 656e 7420 746f 206f 7468 6572 2070   sent to other p
-00004630: 6565 7273 2e0a 2020 2020 2222 220a 0a20  eers..    """.. 
-00004640: 2020 2064 6566 206d 616b 655f 7265 6628     def make_ref(
-00004650: 7365 6c66 2920 2d3e 2022 5265 6164 7952  self) -> "ReadyR
-00004660: 6566 223a 202e 2e2e 0a20 2020 2040 7374  ef": ....    @st
-00004670: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00004680: 6566 2064 6566 6175 6c74 2829 202d 3e20  ef default() -> 
-00004690: 2252 6561 6479 223a 202e 2e2e 0a0a 636c  "Ready": .....cl
-000046a0: 6173 7320 5265 6164 7952 6566 285f 5f41  ass ReadyRef(__A
-000046b0: 5049 5f52 6561 6479 293a 0a20 2020 2022  PI_Ready):.    "
-000046c0: 2222 0a20 2020 2052 6566 6572 656e 6365  "".    Reference
-000046d0: 2074 7970 6520 6f66 203a 636c 6173 733a   type of :class:
-000046e0: 6052 6561 6479 602e 0a20 2020 2022 2222  `Ready`..    """
-000046f0: 0a0a 636c 6173 7320 5f5f 4150 495f 5261  ..class __API_Ra
-00004700: 774e 6f64 653a 0a20 2020 2064 6566 2061  wNode:.    def a
-00004710: 6476 616e 6365 5f61 7070 6c79 2873 656c  dvance_apply(sel
-00004720: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00004730: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004740: 4164 7661 6e63 6520 6170 706c 7920 746f  Advance apply to
-00004750: 2074 6865 2069 6e64 6578 206f 6620 7468   the index of th
-00004760: 6520 6c61 7374 2063 6f6d 6d69 7474 6564  e last committed
-00004770: 2065 6e74 7269 6573 2067 6976 656e 2062   entries given b
-00004780: 6566 6f72 652e 0a20 2020 2020 2020 2022  efore..        "
-00004790: 2222 0a20 2020 2064 6566 2061 6476 616e  "".    def advan
-000047a0: 6365 5f61 7070 6c79 5f74 6f28 7365 6c66  ce_apply_to(self
-000047b0: 2c20 6170 706c 6965 643a 2069 6e74 2920  , applied: int) 
-000047c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000047d0: 2022 2222 0a20 2020 2020 2020 2041 6476   """.        Adv
-000047e0: 616e 6365 2061 7070 6c79 2074 6f20 7468  ance apply to th
-000047f0: 6520 7061 7373 6564 2069 6e64 6578 2e0a  e passed index..
-00004800: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00004810: 6465 6620 6164 7661 6e63 6528 7365 6c66  def advance(self
-00004820: 2c20 7264 3a20 2252 6561 6479 5265 6622  , rd: "ReadyRef"
-00004830: 2920 2d3e 2022 4c69 6768 7452 6561 6479  ) -> "LightReady
-00004840: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
-00004850: 2020 2020 2020 2041 6476 616e 6365 7320         Advances 
-00004860: 7468 6520 7265 6164 7920 6166 7465 7220  the ready after 
-00004870: 6675 6c6c 7920 7072 6f63 6573 7369 6e67  fully processing
-00004880: 2069 742e 0a0a 2020 2020 2020 2020 4675   it...        Fu
-00004890: 6c6c 7920 7072 6f63 6573 7369 6e67 2061  lly processing a
-000048a0: 2072 6561 6479 2072 6571 7569 7265 7320   ready requires 
-000048b0: 746f 2070 6572 7369 7374 2073 6e61 7073  to persist snaps
-000048c0: 686f 742c 2065 6e74 7269 6573 2061 6e64  hot, entries and
-000048d0: 2068 6172 6420 7374 6174 6573 2c20 6170   hard states, ap
-000048e0: 706c 7920 616c 6c0a 2020 2020 2020 2020  ply all.        
-000048f0: 636f 6d6d 6974 7465 6420 656e 7472 6965  committed entrie
-00004900: 732c 2073 656e 6420 616c 6c20 6d65 7373  s, send all mess
-00004910: 6167 6573 2e0a 0a20 2020 2020 2020 2052  ages...        R
-00004920: 6574 7572 6e73 2074 6865 204c 6967 6874  eturns the Light
-00004930: 5265 6164 7920 7468 6174 2063 6f6e 7461  Ready that conta
-00004940: 696e 7320 636f 6d6d 6974 2069 6e64 6578  ins commit index
-00004950: 2c20 636f 6d6d 6974 7465 6420 656e 7472  , committed entr
-00004960: 6965 7320 616e 6420 6d65 7373 6167 6573  ies and messages
-00004970: 2e20 5b60 4c69 6768 7452 6561 6479 605d  . [`LightReady`]
-00004980: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
-00004990: 7320 7570 6461 7465 7320 7468 6174 206f  s updates that o
-000049a0: 6e6c 7920 7661 6c69 6420 6166 7465 7220  nly valid after 
-000049b0: 7065 7273 6973 7469 6e67 206c 6173 7420  persisting last 
-000049c0: 7265 6164 792e 2049 7420 7368 6f75 6c64  ready. It should
-000049d0: 2061 6c73 6f20 6265 2066 756c 6c79 2070   also be fully p
-000049e0: 726f 6365 7373 6564 2e0a 2020 2020 2020  rocessed..      
-000049f0: 2020 5468 656e 205b 6053 656c 663a 3a61    Then [`Self::a
-00004a00: 6476 616e 6365 5f61 7070 6c79 605d 206f  dvance_apply`] o
-00004a10: 7220 5b60 5365 6c66 3a3a 6164 7661 6e63  r [`Self::advanc
-00004a20: 655f 6170 706c 795f 746f 605d 2073 686f  e_apply_to`] sho
-00004a30: 756c 6420 6265 2075 7365 6420 6c61 7465  uld be used late
-00004a40: 7220 746f 2075 7064 6174 6520 6170 706c  r to update appl
-00004a50: 7969 6e67 0a20 2020 2020 2020 2070 726f  ying.        pro
-00004a60: 6772 6573 732e 0a20 2020 2020 2020 2022  gress..        "
-00004a70: 2222 0a20 2020 2064 6566 2061 6476 616e  "".    def advan
-00004a80: 6365 5f61 7070 656e 6428 7365 6c66 2c20  ce_append(self, 
-00004a90: 7264 3a20 2252 6561 6479 5265 6622 2920  rd: "ReadyRef") 
-00004aa0: 2d3e 2022 4c69 6768 7452 6561 6479 223a  -> "LightReady":
-00004ab0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004ac0: 2020 2020 2041 6476 616e 6365 7320 7468       Advances th
-00004ad0: 6520 7265 6164 7920 7769 7468 6f75 7420  e ready without 
-00004ae0: 6170 706c 7969 6e67 2063 6f6d 6d69 7474  applying committ
-00004af0: 6564 2065 6e74 7269 6573 2e20 5b60 5365  ed entries. [`Se
-00004b00: 6c66 3a3a 6164 7661 6e63 655f 6170 706c  lf::advance_appl
-00004b10: 7960 5d20 6f72 0a20 2020 2020 2020 205b  y`] or.        [
-00004b20: 6053 656c 663a 3a61 6476 616e 6365 5f61  `Self::advance_a
-00004b30: 7070 6c79 5f74 6f60 5d20 7368 6f75 6c64  pply_to`] should
-00004b40: 2062 6520 7573 6564 206c 6174 6572 2074   be used later t
-00004b50: 6f20 7570 6461 7465 2061 7070 6c79 696e  o update applyin
-00004b60: 6720 7072 6f67 7265 7373 2e0a 0a20 2020  g progress...   
-00004b70: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
-00004b80: 204c 6967 6874 5265 6164 7920 7468 6174   LightReady that
-00004b90: 2063 6f6e 7461 696e 7320 636f 6d6d 6974   contains commit
-00004ba0: 2069 6e64 6578 2c20 636f 6d6d 6974 7465   index, committe
-00004bb0: 6420 656e 7472 6965 7320 616e 6420 6d65  d entries and me
-00004bc0: 7373 6167 6573 2e0a 0a20 2020 2020 2020  ssages...       
-00004bd0: 2053 696e 6365 2052 6561 6479 206d 7573   Since Ready mus
-00004be0: 7420 6265 2070 6572 7369 7374 6564 2069  t be persisted i
-00004bf0: 6e20 6f72 6465 722c 2063 616c 6c69 6e67  n order, calling
-00004c00: 2074 6869 7320 6675 6e63 7469 6f6e 2069   this function i
-00004c10: 6d70 6c69 6369 746c 7920 6d65 616e 730a  mplicitly means.
-00004c20: 2020 2020 2020 2020 616c 6c20 7265 6164          all read
-00004c30: 7920 636f 6c6c 6563 7465 6420 6265 666f  y collected befo
-00004c40: 7265 2068 6176 6520 6265 656e 2070 6572  re have been per
-00004c50: 7369 7374 6564 2e0a 2020 2020 2020 2020  sisted..        
-00004c60: 2222 220a 2020 2020 6465 6620 6164 7661  """.    def adva
-00004c70: 6e63 655f 6170 7065 6e64 5f61 7379 6e63  nce_append_async
-00004c80: 2873 656c 662c 2072 643a 2022 5265 6164  (self, rd: "Read
-00004c90: 7952 6566 2229 202d 3e20 4e6f 6e65 3a0a  yRef") -> None:.
-00004ca0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00004cb0: 2020 2020 5361 6d65 2061 7320 5b60 5365      Same as [`Se
-00004cc0: 6c66 3a3a 6164 7661 6e63 655f 6170 7065  lf::advance_appe
-00004cd0: 6e64 605d 2065 7863 6570 7420 7468 6174  nd`] except that
-00004ce0: 2069 7420 616c 6c6f 7773 2074 6f20 6f6e   it allows to on
-00004cf0: 6c79 2073 746f 7265 2074 6865 2075 7064  ly store the upd
-00004d00: 6174 6573 2069 6e20 6361 6368 652e 0a20  ates in cache.. 
-00004d10: 2020 2020 2020 205b 6053 656c 663a 3a6f         [`Self::o
-00004d20: 6e5f 7065 7273 6973 745f 7265 6164 7960  n_persist_ready`
-00004d30: 5d20 7368 6f75 6c64 2062 6520 7573 6564  ] should be used
-00004d40: 206c 6174 6572 2074 6f20 7570 6461 7465   later to update
-00004d50: 2074 6865 2070 6572 7369 7374 696e 6720   the persisting 
-00004d60: 7072 6f67 7265 7373 2e0a 0a20 2020 2020  progress...     
-00004d70: 2020 2052 6166 7420 776f 726b 7320 6f6e     Raft works on
-00004d80: 2061 6e20 6173 7375 6d70 7469 6f6e 2070   an assumption p
-00004d90: 6572 7369 7374 6564 2075 7064 6174 6573  ersisted updates
-00004da0: 2073 686f 756c 6420 6e6f 7420 6265 206c   should not be l
-00004db0: 6f73 742c 2077 6869 6368 2075 7375 616c  ost, which usual
-00004dc0: 6c79 2072 6571 7569 7265 7320 6578 7065  ly requires expe
-00004dd0: 6e73 6976 650a 2020 2020 2020 2020 6f70  nsive.        op
-00004de0: 6572 6174 696f 6e73 206c 696b 6520 6066  erations like `f
-00004df0: 7379 6e63 602e 2060 6164 7661 6e63 655f  sync`. `advance_
-00004e00: 6170 7065 6e64 5f61 7379 6e63 6020 616c  append_async` al
-00004e10: 6c6f 7773 2079 6f75 2074 6f20 636f 6e74  lows you to cont
-00004e20: 726f 6c20 7468 6520 7261 7465 206f 6620  rol the rate of 
-00004e30: 7375 6368 206f 7065 7261 7469 6f6e 7320  such operations 
-00004e40: 616e 640a 2020 2020 2020 2020 6765 7420  and.        get 
-00004e50: 6120 7265 6173 6f6e 6162 6c65 2062 6174  a reasonable bat
-00004e60: 6368 2073 697a 652e 2048 6f77 6576 6572  ch size. However
-00004e70: 2c20 6974 2773 2073 7469 6c6c 2072 6571  , it's still req
-00004e80: 7569 7265 6420 7468 6174 2074 6865 2075  uired that the u
-00004e90: 7064 6174 6573 2063 616e 2062 6520 7265  pdates can be re
-00004ea0: 6164 2062 7920 7261 6674 2066 726f 6d20  ad by raft from 
-00004eb0: 7468 650a 2020 2020 2020 2020 6053 746f  the.        `Sto
-00004ec0: 7261 6765 6020 7472 6169 7420 6265 666f  rage` trait befo
-00004ed0: 7265 2063 616c 6c69 6e67 2060 6164 7661  re calling `adva
-00004ee0: 6e63 655f 6170 7065 6e64 5f61 7379 6e63  nce_append_async
-00004ef0: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
-00004f00: 2020 2064 6566 2068 6173 5f72 6561 6479     def has_ready
-00004f10: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-00004f20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00004f30: 2020 2020 4861 7352 6561 6479 2063 616c      HasReady cal
-00004f40: 6c65 6420 7768 656e 2052 6177 4e6f 6465  led when RawNode
-00004f50: 2075 7365 7220 6e65 6564 2074 6f20 6368   user need to ch
-00004f60: 6563 6b20 6966 2061 6e79 2052 6561 6479  eck if any Ready
-00004f70: 2070 656e 6469 6e67 2e0a 2020 2020 2020   pending..      
-00004f80: 2020 2222 220a 2020 2020 6465 6620 7469    """.    def ti
-00004f90: 636b 2873 656c 6629 202d 3e20 626f 6f6c  ck(self) -> bool
-00004fa0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00004fb0: 2020 2020 2020 5469 636b 2061 6476 616e        Tick advan
-00004fc0: 6365 7320 7468 6520 696e 7465 726e 616c  ces the internal
-00004fd0: 206c 6f67 6963 616c 2063 6c6f 636b 2062   logical clock b
-00004fe0: 7920 6120 7369 6e67 6c65 2074 6963 6b2e  y a single tick.
-00004ff0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00005000: 7320 7472 7565 2074 6f20 696e 6469 6361  s true to indica
-00005010: 7465 2074 6861 7420 7468 6572 6520 7769  te that there wi
-00005020: 6c6c 2070 726f 6261 626c 7920 6265 2073  ll probably be s
-00005030: 6f6d 6520 7265 6164 696e 6573 7320 7768  ome readiness wh
-00005040: 6963 680a 2020 2020 2020 2020 6e65 6564  ich.        need
-00005050: 7320 746f 2062 6520 6861 6e64 6c65 642e  s to be handled.
-00005060: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00005070: 2064 6566 2073 6574 5f62 6174 6368 5f61   def set_batch_a
-00005080: 7070 656e 6428 7365 6c66 2c20 6261 7463  ppend(self, batc
-00005090: 685f 6170 7065 6e64 3a20 626f 6f6c 2920  h_append: bool) 
-000050a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000050b0: 2022 2222 0a20 2020 2020 2020 2053 6574   """.        Set
-000050c0: 2077 6865 7468 6572 2074 6f20 6261 7463   whether to batc
-000050d0: 6820 6170 7065 6e64 206d 7367 2061 7420  h append msg at 
-000050e0: 7275 6e74 696d 652e 0a20 2020 2020 2020  runtime..       
-000050f0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-00005100: 5f70 7269 6f72 6974 7928 7365 6c66 2c20  _priority(self, 
-00005110: 7072 696f 7269 7479 3a20 696e 7429 202d  priority: int) -
-00005120: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00005130: 2222 220a 2020 2020 2020 2020 5365 7473  """.        Sets
-00005140: 2070 7269 6f72 6974 7920 6f66 206e 6f64   priority of nod
-00005150: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00005160: 2020 2064 6566 2072 6570 6f72 745f 736e     def report_sn
-00005170: 6170 7368 6f74 2873 656c 662c 2069 643a  apshot(self, id:
-00005180: 2069 6e74 2c20 736e 6170 7368 6f74 3a20   int, snapshot: 
-00005190: 2253 6e61 7073 686f 7453 7461 7475 7322  "SnapshotStatus"
-000051a0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000051b0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-000051c0: 6570 6f72 7453 6e61 7073 686f 7420 7265  eportSnapshot re
-000051d0: 706f 7274 7320 7468 6520 7374 6174 7573  ports the status
-000051e0: 206f 6620 7468 6520 7365 6e74 2073 6e61   of the sent sna
-000051f0: 7073 686f 742e 0a20 2020 2020 2020 2022  pshot..        "
-00005200: 2222 0a20 2020 2064 6566 2072 6570 6f72  "".    def repor
-00005210: 745f 756e 7265 6163 6861 626c 6528 7365  t_unreachable(se
-00005220: 6c66 2c20 6964 3a20 696e 7429 202d 3e20  lf, id: int) -> 
-00005230: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00005240: 220a 2020 2020 2020 2020 5265 706f 7274  ".        Report
-00005250: 556e 7265 6163 6861 626c 6520 7265 706f  Unreachable repo
-00005260: 7274 7320 7468 6520 6769 7665 6e20 6e6f  rts the given no
-00005270: 6465 2069 7320 6e6f 7420 7265 6163 6861  de is not reacha
-00005280: 626c 6520 666f 7220 7468 6520 6c61 7374  ble for the last
-00005290: 2073 656e 642e 0a20 2020 2020 2020 2022   send..        "
-000052a0: 2222 0a20 2020 2064 6566 2074 7261 6e73  "".    def trans
-000052b0: 6665 725f 6c65 6164 6572 2873 656c 662c  fer_leader(self,
-000052c0: 2074 7261 6e73 6665 7265 653a 2069 6e74   transferee: int
-000052d0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000052e0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-000052f0: 7261 6e73 6665 724c 6561 6465 7220 7472  ransferLeader tr
-00005300: 6965 7320 746f 2074 7261 6e73 6665 7220  ies to transfer 
-00005310: 6c65 6164 6572 7368 6970 2074 6f20 7468  leadership to th
-00005320: 6520 6769 7665 6e20 7472 616e 7366 6572  e given transfer
-00005330: 6565 2e0a 2020 2020 2020 2020 2222 220a  ee..        """.
-00005340: 2020 2020 6465 6620 736e 6170 2873 656c      def snap(sel
-00005350: 6629 202d 3e20 4f70 7469 6f6e 616c 5b22  f) -> Optional["
-00005360: 536e 6170 7368 6f74 5265 6622 5d3a 0a20  SnapshotRef"]:. 
-00005370: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005380: 2020 2047 7261 6273 2074 6865 2073 6e61     Grabs the sna
-00005390: 7073 686f 7420 6672 6f6d 2074 6865 2072  pshot from the r
-000053a0: 6166 7420 6966 2061 7661 696c 6162 6c65  aft if available
-000053b0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000053c0: 2020 6465 6620 7374 6570 2873 656c 662c    def step(self,
-000053d0: 206d 7367 3a20 224d 6573 7361 6765 2220   msg: "Message" 
-000053e0: 7c20 224d 6573 7361 6765 5265 6622 2920  | "MessageRef") 
-000053f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00005400: 2022 2222 0a20 2020 2020 2020 2053 7465   """.        Ste
-00005410: 7020 6164 7661 6e63 6573 2074 6865 2073  p advances the s
-00005420: 7461 7465 206d 6163 6869 6e65 2075 7369  tate machine usi
-00005430: 6e67 2074 6865 2067 6976 656e 206d 6573  ng the given mes
-00005440: 7361 6765 2e0a 2020 2020 2020 2020 2222  sage..        ""
-00005450: 220a 2020 2020 6465 6620 736b 6970 5f62  ".    def skip_b
-00005460: 6361 7374 5f63 6f6d 6d69 7428 7365 6c66  cast_commit(self
-00005470: 2c20 736b 6970 3a20 626f 6f6c 2920 2d3e  , skip: bool) ->
-00005480: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00005490: 2222 0a20 2020 2020 2020 2053 6574 2077  "".        Set w
-000054a0: 6865 7468 6572 2073 6b69 7020 6272 6f61  hether skip broa
-000054b0: 6463 6173 7420 656d 7074 7920 636f 6d6d  dcast empty comm
-000054c0: 6974 206d 6573 7361 6765 7320 6174 2072  it messages at r
-000054d0: 756e 7469 6d65 2e0a 2020 2020 2020 2020  untime..        
-000054e0: 2222 220a 2020 2020 6465 6620 6361 6d70  """.    def camp
-000054f0: 6169 676e 2873 656c 6629 202d 3e20 4e6f  aign(self) -> No
-00005500: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00005510: 2020 2020 2020 2020 4361 6d70 6169 676e          Campaign
-00005520: 2063 6175 7365 7320 7468 6973 2052 6177   causes this Raw
-00005530: 4e6f 6465 2074 6f20 7472 616e 7369 7469  Node to transiti
-00005540: 6f6e 2074 6f20 6361 6e64 6964 6174 6520  on to candidate 
-00005550: 7374 6174 652e 0a20 2020 2020 2020 2022  state..        "
-00005560: 2222 0a20 2020 2064 6566 2070 726f 706f  "".    def propo
-00005570: 7365 2873 656c 662c 2063 6f6e 7465 7874  se(self, context
-00005580: 3a20 6279 7465 7320 7c20 4c69 7374 5b69  : bytes | List[i
-00005590: 6e74 5d2c 2064 6174 613a 2062 7974 6573  nt], data: bytes
-000055a0: 207c 204c 6973 745b 696e 745d 2920 2d3e   | List[int]) ->
-000055b0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000055c0: 2222 0a20 2020 2020 2020 2050 726f 706f  "".        Propo
-000055d0: 7365 2070 726f 706f 7365 7320 6461 7461  se proposes data
-000055e0: 2062 6520 6170 7065 6e64 6564 2074 6f20   be appended to 
-000055f0: 7468 6520 7261 6674 206c 6f67 2e0a 2020  the raft log..  
-00005600: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-00005610: 6620 7072 6f70 6f73 655f 636f 6e66 5f63  f propose_conf_c
-00005620: 6861 6e67 6528 0a20 2020 2020 2020 2073  hange(.        s
-00005630: 656c 662c 2063 6f6e 7465 7874 3a20 6279  elf, context: by
-00005640: 7465 7320 7c20 4c69 7374 5b69 6e74 5d2c  tes | List[int],
-00005650: 2063 633a 2022 436f 6e66 4368 616e 6765   cc: "ConfChange
-00005660: 2220 7c20 2243 6f6e 6643 6861 6e67 6552  " | "ConfChangeR
-00005670: 6566 220a 2020 2020 2920 2d3e 204e 6f6e  ef".    ) -> Non
-00005680: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00005690: 2020 2020 2020 2050 726f 706f 7365 436f         ProposeCo
-000056a0: 6e66 4368 616e 6765 2070 726f 706f 7365  nfChange propose
-000056b0: 7320 6120 636f 6e66 6967 2063 6861 6e67  s a config chang
-000056c0: 652e 0a0a 2020 2020 2020 2020 4966 2074  e...        If t
-000056d0: 6865 206e 6f64 6520 656e 7465 7273 206a  he node enters j
-000056e0: 6f69 6e74 2073 7461 7465 2077 6974 6820  oint state with 
-000056f0: 6061 7574 6f5f 6c65 6176 6560 2073 6574  `auto_leave` set
-00005700: 2074 6f20 7472 7565 2c20 6974 2773 0a20   to true, it's. 
-00005710: 2020 2020 2020 2063 616c 6c65 7227 7320         caller's 
-00005720: 7265 7370 6f6e 7369 6269 6c69 7479 2074  responsibility t
-00005730: 6f20 7072 6f70 6f73 6520 616e 2065 6d70  o propose an emp
-00005740: 7479 2063 6f6e 6620 6368 616e 6765 2061  ty conf change a
-00005750: 6761 696e 2074 6f20 666f 7263 650a 2020  gain to force.  
-00005760: 2020 2020 2020 6c65 6176 696e 6720 6a6f        leaving jo
-00005770: 696e 7420 7374 6174 652e 0a20 2020 2020  int state..     
-00005780: 2020 2022 2222 0a20 2020 2064 6566 2070     """.    def p
-00005790: 726f 706f 7365 5f63 6f6e 665f 6368 616e  ropose_conf_chan
-000057a0: 6765 5f76 3228 0a20 2020 2020 2020 2073  ge_v2(.        s
-000057b0: 656c 662c 2063 6f6e 7465 7874 3a20 6279  elf, context: by
-000057c0: 7465 7320 7c20 4c69 7374 5b69 6e74 5d2c  tes | List[int],
-000057d0: 2063 633a 2022 436f 6e66 4368 616e 6765   cc: "ConfChange
-000057e0: 5632 2220 7c20 2243 6f6e 6643 6861 6e67  V2" | "ConfChang
-000057f0: 6556 3252 6566 220a 2020 2020 2920 2d3e  eV2Ref".    ) ->
-00005800: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00005810: 2222 0a20 2020 2020 2020 2050 726f 706f  "".        Propo
-00005820: 7365 436f 6e66 4368 616e 6765 2070 726f  seConfChange pro
-00005830: 706f 7365 7320 6120 636f 6e66 6967 2063  poses a config c
-00005840: 6861 6e67 652e 0a0a 2020 2020 2020 2020  hange...        
-00005850: 4966 2074 6865 206e 6f64 6520 656e 7465  If the node ente
-00005860: 7273 206a 6f69 6e74 2073 7461 7465 2077  rs joint state w
-00005870: 6974 6820 6061 7574 6f5f 6c65 6176 6560  ith `auto_leave`
-00005880: 2073 6574 2074 6f20 7472 7565 2c20 6974   set to true, it
-00005890: 2773 0a20 2020 2020 2020 2063 616c 6c65  's.        calle
-000058a0: 7227 7320 7265 7370 6f6e 7369 6269 6c69  r's responsibili
-000058b0: 7479 2074 6f20 7072 6f70 6f73 6520 616e  ty to propose an
-000058c0: 2065 6d70 7479 2063 6f6e 6620 6368 616e   empty conf chan
-000058d0: 6765 2061 6761 696e 2074 6f20 666f 7263  ge again to forc
-000058e0: 650a 2020 2020 2020 2020 6c65 6176 696e  e.        leavin
-000058f0: 6720 6a6f 696e 7420 7374 6174 652e 0a20  g joint state.. 
-00005900: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00005910: 6566 2061 7070 6c79 5f63 6f6e 665f 6368  ef apply_conf_ch
-00005920: 616e 6765 2873 656c 662c 2063 633a 2022  ange(self, cc: "
-00005930: 436f 6e66 4368 616e 6765 2220 7c20 2243  ConfChange" | "C
-00005940: 6f6e 6643 6861 6e67 6552 6566 2229 202d  onfChangeRef") -
-00005950: 3e20 436f 6e66 5374 6174 653a 0a20 2020  > ConfState:.   
-00005960: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00005970: 2041 7070 6c69 6573 2061 2063 6f6e 6669   Applies a confi
-00005980: 6720 6368 616e 6765 2074 6f20 7468 6520  g change to the 
-00005990: 6c6f 6361 6c20 6e6f 6465 2e20 5468 6520  local node. The 
-000059a0: 6170 7020 6d75 7374 2063 616c 6c20 7468  app must call th
-000059b0: 6973 2077 6865 6e20 6974 0a20 2020 2020  is when it.     
-000059c0: 2020 2061 7070 6c69 6573 2061 2063 6f6e     applies a con
-000059d0: 6669 6775 7261 7469 6f6e 2063 6861 6e67  figuration chang
-000059e0: 652c 2065 7863 6570 7420 7768 656e 2069  e, except when i
-000059f0: 7420 6465 6369 6465 7320 746f 2072 656a  t decides to rej
-00005a00: 6563 7420 7468 650a 2020 2020 2020 2020  ect the.        
-00005a10: 636f 6e66 6967 7572 6174 696f 6e20 6368  configuration ch
-00005a20: 616e 6765 2c20 696e 2077 6869 6368 2063  ange, in which c
-00005a30: 6173 6520 6e6f 2063 616c 6c20 6d75 7374  ase no call must
-00005a40: 2074 616b 6520 706c 6163 652e 0a20 2020   take place..   
-00005a50: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00005a60: 2061 7070 6c79 5f63 6f6e 665f 6368 616e   apply_conf_chan
-00005a70: 6765 5f76 3228 0a20 2020 2020 2020 2073  ge_v2(.        s
-00005a80: 656c 662c 2063 633a 2022 436f 6e66 4368  elf, cc: "ConfCh
-00005a90: 616e 6765 5632 2220 7c20 2243 6f6e 6643  angeV2" | "ConfC
-00005aa0: 6861 6e67 6556 3252 6566 220a 2020 2020  hangeV2Ref".    
-00005ab0: 2920 2d3e 2022 436f 6e66 5374 6174 6522  ) -> "ConfState"
-00005ac0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00005ad0: 2020 2020 2020 4170 706c 6965 7320 6120        Applies a 
-00005ae0: 636f 6e66 6967 2063 6861 6e67 6520 746f  config change to
-00005af0: 2074 6865 206c 6f63 616c 206e 6f64 652e   the local node.
-00005b00: 2054 6865 2061 7070 206d 7573 7420 6361   The app must ca
-00005b10: 6c6c 2074 6869 7320 7768 656e 2069 740a  ll this when it.
-00005b20: 2020 2020 2020 2020 6170 706c 6965 7320          applies 
-00005b30: 6120 636f 6e66 6967 7572 6174 696f 6e20  a configuration 
-00005b40: 6368 616e 6765 2c20 6578 6365 7074 2077  change, except w
-00005b50: 6865 6e20 6974 2064 6563 6964 6573 2074  hen it decides t
-00005b60: 6f20 7265 6a65 6374 2074 6865 0a20 2020  o reject the.   
-00005b70: 2020 2020 2063 6f6e 6669 6775 7261 7469       configurati
-00005b80: 6f6e 2063 6861 6e67 652c 2069 6e20 7768  on change, in wh
-00005b90: 6963 6820 6361 7365 206e 6f20 6361 6c6c  ich case no call
-00005ba0: 206d 7573 7420 7461 6b65 2070 6c61 6365   must take place
-00005bb0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00005bc0: 2020 6465 6620 7069 6e67 2873 656c 6629    def ping(self)
-00005bd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00005be0: 2020 2222 220a 2020 2020 2020 2020 4272    """.        Br
-00005bf0: 6f61 6463 6173 7420 6865 6172 7462 6561  oadcast heartbea
-00005c00: 7473 2074 6f20 616c 6c20 7468 6520 666f  ts to all the fo
-00005c10: 6c6c 6f77 6572 732e 0a0a 2020 2020 2020  llowers...      
-00005c20: 2020 4966 2069 7427 7320 6e6f 7420 6c65    If it's not le
-00005c30: 6164 6572 2c20 6e6f 7468 696e 6720 7769  ader, nothing wi
-00005c40: 6c6c 2068 6170 7065 6e2e 0a20 2020 2020  ll happen..     
-00005c50: 2020 2022 2222 0a20 2020 2064 6566 206f     """.    def o
-00005c60: 6e5f 7065 7273 6973 745f 7265 6164 7928  n_persist_ready(
-00005c70: 7365 6c66 2c20 6e75 6d62 6572 3a20 696e  self, number: in
-00005c80: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-00005c90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00005ca0: 4e6f 7469 6669 6573 2074 6861 7420 7468  Notifies that th
-00005cb0: 6520 7265 6164 7920 6f66 2074 6869 7320  e ready of this 
-00005cc0: 6e75 6d62 6572 2068 6173 2062 6565 6e20  number has been 
-00005cd0: 7065 7273 6973 7465 642e 0a0a 2020 2020  persisted...    
-00005ce0: 2020 2020 5369 6e63 6520 5265 6164 7920      Since Ready 
-00005cf0: 6d75 7374 2062 6520 7065 7273 6973 7465  must be persiste
-00005d00: 6420 696e 206f 7264 6572 2c20 6361 6c6c  d in order, call
-00005d10: 696e 6720 7468 6973 2066 756e 6374 696f  ing this functio
-00005d20: 6e20 696d 706c 6963 6974 6c79 206d 6561  n implicitly mea
-00005d30: 6e73 0a20 2020 2020 2020 2061 6c6c 2072  ns.        all r
-00005d40: 6561 6469 6573 2077 6974 6820 6e75 6d62  eadies with numb
-00005d50: 6572 7320 736d 616c 6c65 7220 7468 616e  ers smaller than
-00005d60: 2074 6869 7320 6f6e 6520 6861 7665 2062   this one have b
-00005d70: 6565 6e20 7065 7273 6973 7465 642e 0a0a  een persisted...
-00005d80: 2020 2020 2020 2020 5b60 5365 6c66 3a3a          [`Self::
-00005d90: 6861 735f 7265 6164 7960 5d20 616e 6420  has_ready`] and 
-00005da0: 5b60 5365 6c66 3a3a 7265 6164 7960 5d20  [`Self::ready`] 
-00005db0: 7368 6f75 6c64 2062 6520 6361 6c6c 6564  should be called
-00005dc0: 206c 6174 6572 2074 6f20 6861 6e64 6c65   later to handle
-00005dd0: 2066 7572 7468 6572 0a20 2020 2020 2020   further.       
-00005de0: 2075 7064 6174 6573 2074 6861 7420 6265   updates that be
-00005df0: 636f 6d65 2076 616c 6964 2061 6674 6572  come valid after
-00005e00: 2072 6561 6479 2062 6569 6e67 2070 6572   ready being per
-00005e10: 7369 7374 6564 2e0a 2020 2020 2020 2020  sisted..        
-00005e20: 2222 220a 2020 2020 6465 6620 7265 6164  """.    def read
-00005e30: 5f69 6e64 6578 2873 656c 662c 2072 6374  _index(self, rct
-00005e40: 783a 2062 7974 6573 207c 204c 6973 745b  x: bytes | List[
-00005e50: 696e 745d 2920 2d3e 204e 6f6e 653a 0a20  int]) -> None:. 
-00005e60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005e70: 2020 2052 6561 6449 6e64 6578 2072 6571     ReadIndex req
-00005e80: 7565 7374 7320 6120 7265 6164 2073 7461  uests a read sta
-00005e90: 7465 2e20 5468 6520 7265 6164 2073 7461  te. The read sta
-00005ea0: 7465 2077 696c 6c20 6265 2073 6574 2069  te will be set i
-00005eb0: 6e20 7265 6164 792e 0a20 2020 2020 2020  n ready..       
-00005ec0: 2052 6561 6420 5374 6174 6520 6861 7320   Read State has 
-00005ed0: 6120 7265 6164 2069 6e64 6578 2e20 4f6e  a read index. On
-00005ee0: 6365 2074 6865 2061 7070 6c69 6361 7469  ce the applicati
-00005ef0: 6f6e 2061 6476 616e 6365 7320 6675 7274  on advances furt
-00005f00: 6865 7220 7468 616e 2074 6865 2072 6561  her than the rea
-00005f10: 640a 2020 2020 2020 2020 696e 6465 782c  d.        index,
-00005f20: 2061 6e79 206c 696e 6561 7269 7a61 626c   any linearizabl
-00005f30: 6520 7265 6164 2072 6571 7565 7374 7320  e read requests 
-00005f40: 6973 7375 6564 2062 6566 6f72 6520 7468  issued before th
-00005f50: 6520 7265 6164 2072 6571 7565 7374 2063  e read request c
-00005f60: 616e 2062 650a 2020 2020 2020 2020 7072  an be.        pr
-00005f70: 6f63 6573 7365 6420 7361 6665 6c79 2e20  ocessed safely. 
-00005f80: 5468 6520 7265 6164 2073 7461 7465 2077  The read state w
-00005f90: 696c 6c20 6861 7665 2074 6865 2073 616d  ill have the sam
-00005fa0: 6520 7263 7478 2061 7474 6163 6865 642e  e rctx attached.
-00005fb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00005fc0: 2064 6566 2072 6561 6479 2873 656c 6629   def ready(self)
-00005fd0: 202d 3e20 5265 6164 793a 0a20 2020 2020   -> Ready:.     
-00005fe0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-00005ff0: 6574 7572 6e73 2074 6865 206f 7574 7374  eturns the outst
-00006000: 616e 6469 6e67 2077 6f72 6b20 7468 6174  anding work that
-00006010: 2074 6865 2061 7070 6c69 6361 7469 6f6e   the application
-00006020: 206e 6565 6473 2074 6f20 6861 6e64 6c65   needs to handle
-00006030: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00006040: 696e 636c 7564 6573 2061 7070 656e 6469  includes appendi
-00006050: 6e67 2061 6e64 2061 7070 6c79 696e 6720  ng and applying 
-00006060: 656e 7472 6965 7320 6f72 2061 2073 6e61  entries or a sna
-00006070: 7073 686f 742c 2075 7064 6174 696e 6720  pshot, updating 
-00006080: 7468 6520 4861 7264 5374 6174 652c 0a20  the HardState,. 
-00006090: 2020 2020 2020 2061 6e64 2073 656e 6469         and sendi
-000060a0: 6e67 206d 6573 7361 6765 732e 2054 6865  ng messages. The
-000060b0: 2072 6574 7572 6e65 6420 6052 6561 6479   returned `Ready
-000060c0: 6020 2a4d 5553 542a 2062 6520 6861 6e64  ` *MUST* be hand
-000060d0: 6c65 6420 616e 6420 7375 6273 6571 7565  led and subseque
-000060e0: 6e74 6c79 0a20 2020 2020 2020 2070 6173  ntly.        pas
-000060f0: 7365 6420 6261 636b 2076 6961 2060 6164  sed back via `ad
-00006100: 7661 6e63 6560 206f 7220 6974 7320 6661  vance` or its fa
-00006110: 6d69 6c69 6573 2e20 4265 666f 7265 2074  milies. Before t
-00006120: 6861 742c 202a 444f 204e 4f54 2a20 6361  hat, *DO NOT* ca
-00006130: 6c6c 2061 6e79 2066 756e 6374 696f 6e20  ll any function 
-00006140: 6c69 6b65 0a20 2020 2020 2020 2060 7374  like.        `st
-00006150: 6570 602c 2060 7072 6f70 6f73 6560 2c20  ep`, `propose`, 
-00006160: 6063 616d 7061 6967 6e60 2074 6f20 6368  `campaign` to ch
-00006170: 616e 6765 2069 6e74 6572 6e61 6c20 7374  ange internal st
-00006180: 6174 652e 0a0a 2020 2020 2020 2020 5b60  ate...        [`
-00006190: 5365 6c66 3a3a 6861 735f 7265 6164 7960  Self::has_ready`
-000061a0: 5d20 7368 6f75 6c64 2062 6520 6361 6c6c  ] should be call
-000061b0: 6564 2066 6972 7374 2074 6f20 6368 6563  ed first to chec
-000061c0: 6b20 6966 2069 7427 7320 6e65 6365 7373  k if it's necess
-000061d0: 6172 7920 746f 2068 616e 646c 6520 7468  ary to handle th
-000061e0: 6520 7265 6164 792e 0a20 2020 2020 2020  e ready..       
-000061f0: 2022 2222 0a20 2020 2064 6566 2072 6571   """.    def req
-00006200: 7565 7374 5f73 6e61 7073 686f 7428 7365  uest_snapshot(se
-00006210: 6c66 2920 2d3e 2022 5265 6164 7922 3a0a  lf) -> "Ready":.
-00006220: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00006230: 2020 2020 5265 7175 6573 7420 6120 736e      Request a sn
-00006240: 6170 7368 6f74 2066 726f 6d20 6120 6c65  apshot from a le
-00006250: 6164 6572 2e0a 2020 2020 2020 2020 5468  ader..        Th
-00006260: 6520 736e 6170 7368 6f74 2773 2069 6e64  e snapshot's ind
-00006270: 6578 206d 7573 7420 6265 2067 7265 6174  ex must be great
-00006280: 6572 206f 7220 6571 7561 6c20 746f 2074  er or equal to t
-00006290: 6865 2072 6571 7565 7374 5f69 6e64 6578  he request_index
-000062a0: 2028 6c61 7374 5f69 6e64 6578 2920 6f72   (last_index) or
-000062b0: 0a20 2020 2020 2020 2074 6865 206c 6561  .        the lea
-000062c0: 6465 7227 7320 7465 726d 206d 7573 7420  der's term must 
-000062d0: 6265 2067 7265 6174 6572 2074 6861 6e20  be greater than 
-000062e0: 7468 6520 7265 7175 6573 7420 7465 726d  the request term
-000062f0: 2028 6c61 7374 5f69 6e64 6578 2773 2074   (last_index's t
-00006300: 6572 6d29 2e0a 2020 2020 2020 2020 2222  erm)..        ""
-00006310: 220a 2020 2020 6465 6620 6f6e 5f65 6e74  ".    def on_ent
-00006320: 7269 6573 5f66 6574 6368 6564 2873 656c  ries_fetched(sel
-00006330: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00006340: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00006350: 4120 6361 6c6c 6261 636b 2077 6865 6e20  A callback when 
-00006360: 656e 7472 6965 7320 6172 6520 6665 7463  entries are fetc
-00006370: 6865 6420 6173 796e 6368 726f 6e6f 7573  hed asynchronous
-00006380: 6c79 2e0a 2020 2020 2020 2020 5468 6520  ly..        The 
-00006390: 636f 6e74 6578 7420 7368 6f75 6c64 2070  context should p
-000063a0: 726f 7669 6465 2074 6865 2063 6f6e 7465  rovide the conte
-000063b0: 7874 2070 6173 7365 6420 6672 6f6d 2053  xt passed from S
-000063c0: 746f 7261 6765 2e65 6e74 6972 6573 2829  torage.entires()
-000063d0: 2e0a 2020 2020 2020 2020 5365 6520 6d6f  ..        See mo
-000063e0: 7265 2069 6e20 7468 6520 636f 6d6d 656e  re in the commen
-000063f0: 7420 6f66 2053 746f 7261 6765 2e65 6e74  t of Storage.ent
-00006400: 6972 6573 2829 2e0a 0a20 2020 2020 2020  ires()...       
-00006410: 2023 2050 616e 6963 730a 0a20 2020 2020   # Panics..     
-00006420: 2020 2050 616e 6963 7320 6966 2070 6173     Panics if pas
-00006430: 7365 6420 7769 7468 2074 6865 2063 6f6e  sed with the con
-00006440: 7465 7874 206f 6620 636f 6e74 6578 742e  text of context.
-00006450: 6361 6e5f 6173 796e 6328 2920 3d3d 2066  can_async() == f
-00006460: 616c 7365 0a20 2020 2020 2020 2022 2222  alse.        """
-00006470: 0a0a 636c 6173 7320 496e 4d65 6d6f 7279  ..class InMemory
-00006480: 5261 774e 6f64 6528 5f5f 4150 495f 5261  RawNode(__API_Ra
-00006490: 774e 6f64 6529 3a0a 2020 2020 2222 220a  wNode):.    """.
-000064a0: 2020 2020 5261 774e 6f64 6520 6973 2061      RawNode is a
-000064b0: 2074 6872 6561 642d 756e 7361 6665 204e   thread-unsafe N
-000064c0: 6f64 652e 0a20 2020 2054 6865 206d 6574  ode..    The met
-000064d0: 686f 6473 206f 6620 7468 6973 2073 7472  hods of this str
-000064e0: 7563 7420 636f 7272 6573 706f 6e64 2074  uct correspond t
-000064f0: 6f20 7468 6520 6d65 7468 6f64 7320 6f66  o the methods of
-00006500: 204e 6f64 6520 616e 6420 6172 6520 6465   Node and are de
-00006510: 7363 7269 6265 640a 2020 2020 6d6f 7265  scribed.    more
-00006520: 2066 756c 6c79 2074 6865 7265 2e0a 2020   fully there..  
-00006530: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-00006540: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
-00006550: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
-00006560: 6667 3a20 2243 6f6e 6669 6722 207c 2022  fg: "Config" | "
-00006570: 436f 6e66 6967 5265 6622 2c0a 2020 2020  ConfigRef",.    
-00006580: 2020 2020 7374 6f72 653a 2022 4d65 6d53      store: "MemS
-00006590: 746f 7261 6765 2220 7c20 224d 656d 5374  torage" | "MemSt
-000065a0: 6f72 6167 6552 6566 222c 0a20 2020 2020  orageRef",.     
-000065b0: 2020 206c 6f67 6765 723a 2022 4c6f 6767     logger: "Logg
-000065c0: 6572 2220 7c20 224c 6f67 6765 7252 6566  er" | "LoggerRef
-000065d0: 222c 0a20 2020 2029 202d 3e20 4e6f 6e65  ",.    ) -> None
-000065e0: 3a20 2e2e 2e0a 2020 2020 6465 6620 6d61  : ....    def ma
-000065f0: 6b65 5f72 6566 2873 656c 6629 202d 3e20  ke_ref(self) -> 
-00006600: 2249 6e4d 656d 6f72 7952 6177 4e6f 6465  "InMemoryRawNode
-00006610: 5265 6622 3a20 2e2e 2e0a 2020 2020 6465  Ref": ....    de
-00006620: 6620 6765 745f 7261 6674 2873 656c 6629  f get_raft(self)
-00006630: 202d 3e20 2249 6e4d 656d 6f72 7952 6166   -> "InMemoryRaf
-00006640: 7452 6566 223a 0a20 2020 2020 2020 2022  tRef":.        "
-00006650: 2222 2022 2222 0a20 2020 2064 6566 2073  "" """.    def s
-00006660: 746f 7265 2873 656c 6629 202d 3e20 224d  tore(self) -> "M
-00006670: 656d 5374 6f72 6167 6552 6566 223a 0a20  emStorageRef":. 
-00006680: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00006690: 7320 7468 6520 7374 6f72 6520 6173 2061  s the store as a
-000066a0: 206d 7574 6162 6c65 2072 6566 6572 656e   mutable referen
-000066b0: 6365 2e22 2222 0a0a 636c 6173 7320 496e  ce."""..class In
-000066c0: 4d65 6d6f 7279 5261 774e 6f64 6552 6566  MemoryRawNodeRef
-000066d0: 285f 5f41 5049 5f52 6177 4e6f 6465 293a  (__API_RawNode):
-000066e0: 0a20 2020 2022 2222 0a20 2020 2052 6566  .    """.    Ref
-000066f0: 6572 656e 6365 2074 7970 6520 6f66 203a  erence type of :
-00006700: 636c 6173 733a 6049 6e4d 656d 6f72 7952  class:`InMemoryR
-00006710: 6177 4e6f 6465 602e 0a20 2020 2022 2222  awNode`..    """
-00006720: 0a0a 2020 2020 6465 6620 6765 745f 7261  ..    def get_ra
-00006730: 6674 2873 656c 6629 202d 3e20 2249 6e4d  ft(self) -> "InM
-00006740: 656d 6f72 7952 6166 7452 6566 223a 0a20  emoryRaftRef":. 
-00006750: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
-00006760: 2020 2064 6566 2073 746f 7265 2873 656c     def store(sel
-00006770: 6629 202d 3e20 224d 656d 5374 6f72 6167  f) -> "MemStorag
-00006780: 6552 6566 223a 0a20 2020 2020 2020 2022  eRef":.        "
-00006790: 2222 5265 7475 726e 7320 7468 6520 7374  ""Returns the st
-000067a0: 6f72 6520 6173 2061 206d 7574 6162 6c65  ore as a mutable
-000067b0: 2072 6566 6572 656e 6365 2e22 2222 0a20   reference.""". 
-000067c0: 2020 2023 2064 6566 2073 7461 7475 7328     # def status(
-000067d0: 7365 6c66 2920 2d3e 2049 6e4d 656d 6f72  self) -> InMemor
-000067e0: 7953 7461 7475 733a 0a20 2020 2023 2020  yStatus:.    #  
-000067f0: 2020 2022 2222 0a20 2020 2023 2020 2020     """.    #    
-00006800: 2053 7461 7475 7320 7265 7475 726e 7320   Status returns 
-00006810: 7468 6520 6375 7272 656e 7420 7374 6174  the current stat
-00006820: 7573 206f 6620 7468 6520 6769 7665 6e20  us of the given 
-00006830: 6772 6f75 702e 0a20 2020 2023 2020 2020  group..    #    
-00006840: 2022 2222 0a0a 636c 6173 7320 5261 774e   """..class RawN
-00006850: 6f64 6528 5f5f 4150 495f 5261 774e 6f64  ode(__API_RawNod
-00006860: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-00006870: 5261 774e 6f64 6520 6973 2061 2074 6872  RawNode is a thr
-00006880: 6561 642d 756e 7361 6665 204e 6f64 652e  ead-unsafe Node.
-00006890: 0a20 2020 2054 6865 206d 6574 686f 6473  .    The methods
-000068a0: 206f 6620 7468 6973 2073 7472 7563 7420   of this struct 
-000068b0: 636f 7272 6573 706f 6e64 2074 6f20 7468  correspond to th
-000068c0: 6520 6d65 7468 6f64 7320 6f66 204e 6f64  e methods of Nod
-000068d0: 6520 616e 6420 6172 6520 6465 7363 7269  e and are descri
-000068e0: 6265 640a 2020 2020 6d6f 7265 2066 756c  bed.    more ful
-000068f0: 6c79 2074 6865 7265 2e0a 2020 2020 2222  ly there..    ""
-00006900: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00006910: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
-00006920: 662c 0a20 2020 2020 2020 2063 6667 3a20  f,.        cfg: 
-00006930: 2243 6f6e 6669 6722 207c 2022 436f 6e66  "Config" | "Conf
-00006940: 6967 5265 6622 2c0a 2020 2020 2020 2020  igRef",.        
-00006950: 7374 6f72 653a 2022 5374 6f72 6167 6522  store: "Storage"
-00006960: 207c 2022 5374 6f72 6167 6552 6566 222c   | "StorageRef",
-00006970: 0a20 2020 2020 2020 206c 6f67 6765 723a  .        logger:
-00006980: 2022 4c6f 6767 6572 2220 7c20 224c 6f67   "Logger" | "Log
-00006990: 6765 7252 6566 222c 0a20 2020 2029 202d  gerRef",.    ) -
-000069a0: 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020 2020  > None: ....    
-000069b0: 6465 6620 6d61 6b65 5f72 6566 2873 656c  def make_ref(sel
-000069c0: 6629 202d 3e20 2252 6177 4e6f 6465 5265  f) -> "RawNodeRe
-000069d0: 6622 3a20 2e2e 2e0a 2020 2020 6465 6620  f": ....    def 
-000069e0: 6765 745f 7261 6674 2873 656c 6629 202d  get_raft(self) -
-000069f0: 3e20 2252 6166 7452 6566 223a 0a20 2020  > "RaftRef":.   
-00006a00: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
-00006a10: 2064 6566 2073 746f 7265 2873 656c 6629   def store(self)
-00006a20: 202d 3e20 2253 746f 7261 6765 5265 6622   -> "StorageRef"
-00006a30: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00006a40: 7572 6e73 2074 6865 2073 746f 7265 2061  urns the store a
-00006a50: 7320 6120 6d75 7461 626c 6520 7265 6665  s a mutable refe
-00006a60: 7265 6e63 652e 2222 220a 2020 2020 2320  rence.""".    # 
-00006a70: 6465 6620 7374 6174 7573 2873 656c 6629  def status(self)
-00006a80: 202d 3e20 5374 6174 7573 3a0a 2020 2020   -> Status:.    
-00006a90: 2320 2020 2020 2222 220a 2020 2020 2320  #     """.    # 
-00006aa0: 2020 2020 5374 6174 7573 2072 6574 7572      Status retur
-00006ab0: 6e73 2074 6865 2063 7572 7265 6e74 2073  ns the current s
-00006ac0: 7461 7475 7320 6f66 2074 6865 2067 6976  tatus of the giv
-00006ad0: 656e 2067 726f 7570 2e0a 2020 2020 2320  en group..    # 
-00006ae0: 2020 2020 2222 220a 0a63 6c61 7373 2052      """..class R
-00006af0: 6177 4e6f 6465 5265 6628 5f5f 4150 495f  awNodeRef(__API_
-00006b00: 5261 774e 6f64 6529 3a0a 2020 2020 2222  RawNode):.    ""
-00006b10: 220a 2020 2020 5265 6665 7265 6e63 6520  ".    Reference 
-00006b20: 7479 7065 206f 6620 3a63 6c61 7373 3a60  type of :class:`
-00006b30: 5261 774e 6f64 6560 2e0a 2020 2020 2222  RawNode`..    ""
-00006b40: 220a 0a20 2020 2064 6566 2067 6574 5f72  "..    def get_r
-00006b50: 6166 7428 7365 6c66 2920 2d3e 2022 5261  aft(self) -> "Ra
-00006b60: 6674 5265 6622 3a0a 2020 2020 2020 2020  ftRef":.        
-00006b70: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-00006b80: 7374 6f72 6528 7365 6c66 2920 2d3e 2022  store(self) -> "
-00006b90: 5374 6f72 6167 6552 6566 223a 0a20 2020  StorageRef":.   
-00006ba0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00006bb0: 7468 6520 7374 6f72 6520 6173 2061 206d  the store as a m
-00006bc0: 7574 6162 6c65 2072 6566 6572 656e 6365  utable reference
-00006bd0: 2e22 2222 0a20 2020 2023 2064 6566 2073  .""".    # def s
-00006be0: 7461 7475 7328 7365 6c66 2920 2d3e 2049  tatus(self) -> I
-00006bf0: 6e4d 656d 6f72 7953 7461 7475 733a 0a20  nMemoryStatus:. 
-00006c00: 2020 2023 2020 2020 2022 2222 0a20 2020     #     """.   
-00006c10: 2023 2020 2020 2053 7461 7475 7320 7265   #     Status re
-00006c20: 7475 726e 7320 7468 6520 6375 7272 656e  turns the curren
-00006c30: 7420 7374 6174 7573 206f 6620 7468 6520  t status of the 
-00006c40: 6769 7665 6e20 6772 6f75 702e 0a20 2020  given group..   
-00006c50: 2023 2020 2020 2022 2222 0a0a 636c 6173   #     """..clas
-00006c60: 7320 5f5f 4150 495f 5065 6572 3a0a 2020  s __API_Peer:.  
-00006c70: 2020 6465 6620 6765 745f 6964 2873 656c    def get_id(sel
-00006c80: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-00006c90: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00006ca0: 6964 603a 2054 6865 2049 4420 6f66 2074  id`: The ID of t
-00006cb0: 6865 2070 6565 722e 0a20 2020 2020 2020  he peer..       
-00006cc0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-00006cd0: 5f69 6428 7365 6c66 2c20 6964 3a20 696e  _id(self, id: in
-00006ce0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-00006cf0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00006d00: 6069 6460 3a20 5468 6520 4944 206f 6620  `id`: The ID of 
-00006d10: 7468 6520 7065 6572 2e0a 2020 2020 2020  the peer..      
-00006d20: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
-00006d30: 745f 636f 6e74 6578 7428 7365 6c66 2920  t_context(self) 
-00006d40: 2d3e 2062 7974 6573 3a0a 2020 2020 2020  -> bytes:.      
-00006d50: 2020 2222 220a 2020 2020 2020 2020 6063    """.        `c
-00006d60: 6f6e 7465 7874 603a 2049 6620 7468 6572  ontext`: If ther
-00006d70: 6520 6973 2063 6f6e 7465 7874 2061 7373  e is context ass
-00006d80: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
-00006d90: 2070 6565 7220 286c 696b 6520 636f 6e6e   peer (like conn
-00006da0: 6563 7469 6f6e 2069 6e66 6f72 6d61 7469  ection informati
-00006db0: 6f6e 292c 2069 7420 6361 6e20 6265 0a20  on), it can be. 
-00006dc0: 2020 2020 2020 2073 6572 6961 6c69 7a65         serialize
-00006dd0: 6420 616e 6420 7374 6f72 6564 2068 6572  d and stored her
-00006de0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00006df0: 2020 2064 6566 2073 6574 5f63 6f6e 7465     def set_conte
-00006e00: 7874 2873 656c 662c 2063 6f6e 7465 7874  xt(self, context
-00006e10: 3a20 6279 7465 7320 7c20 4c69 7374 5b69  : bytes | List[i
-00006e20: 6e74 5d29 202d 3e20 4e6f 6e65 3a0a 2020  nt]) -> None:.  
-00006e30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00006e40: 2020 6063 6f6e 7465 7874 603a 2049 6620    `context`: If 
-00006e50: 7468 6572 6520 6973 2063 6f6e 7465 7874  there is context
-00006e60: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00006e70: 2074 6865 2070 6565 7220 286c 696b 6520   the peer (like 
-00006e80: 636f 6e6e 6563 7469 6f6e 2069 6e66 6f72  connection infor
-00006e90: 6d61 7469 6f6e 292c 2069 7420 6361 6e20  mation), it can 
-00006ea0: 6265 0a20 2020 2020 2020 2073 6572 6961  be.        seria
-00006eb0: 6c69 7a65 6420 616e 6420 7374 6f72 6564  lized and stored
-00006ec0: 2068 6572 652e 0a20 2020 2020 2020 2022   here..        "
-00006ed0: 2222 0a0a 636c 6173 7320 5065 6572 285f  ""..class Peer(_
-00006ee0: 5f41 5049 5f50 6565 7229 3a0a 2020 2020  _API_Peer):.    
-00006ef0: 2222 220a 2020 2020 5265 7072 6573 656e  """.    Represen
-00006f00: 7473 2061 2050 6565 7220 6e6f 6465 2069  ts a Peer node i
-00006f10: 6e20 7468 6520 636c 7573 7465 722e 0a20  n the cluster.. 
-00006f20: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-00006f30: 5f5f 696e 6974 5f5f 2873 656c 6629 202d  __init__(self) -
-00006f40: 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020 2020  > None: ....    
-00006f50: 6465 6620 6d61 6b65 5f72 6566 2873 656c  def make_ref(sel
-00006f60: 6629 202d 3e20 2250 6565 7252 6566 223a  f) -> "PeerRef":
-00006f70: 202e 2e2e 0a0a 636c 6173 7320 5065 6572   .....class Peer
-00006f80: 5265 6628 5f5f 4150 495f 5065 6572 293a  Ref(__API_Peer):
-00006f90: 0a20 2020 2022 2222 0a20 2020 2052 6566  .    """.    Ref
-00006fa0: 6572 656e 6365 2074 7970 6520 6f66 203a  erence type of :
-00006fb0: 636c 6173 733a 6050 6565 7260 2e0a 2020  class:`Peer`..  
-00006fc0: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
-00006fd0: 5049 5f4c 6967 6874 5265 6164 793a 0a20  PI_LightReady:. 
-00006fe0: 2020 2064 6566 2063 6f6d 6d69 745f 696e     def commit_in
-00006ff0: 6465 7828 7365 6c66 2920 2d3e 204f 7074  dex(self) -> Opt
-00007000: 696f 6e61 6c5b 696e 745d 3a0a 2020 2020  ional[int]:.    
-00007010: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007020: 5468 6520 6375 7272 656e 7420 636f 6d6d  The current comm
-00007030: 6974 2069 6e64 6578 2e0a 2020 2020 2020  it index..      
-00007040: 2020 4974 2077 696c 6c20 6265 204e 6f6e    It will be Non
-00007050: 6520 7374 6174 6520 6966 2074 6865 7265  e state if there
-00007060: 2069 7320 6e6f 2075 7064 6174 652e 0a20   is no update.. 
-00007070: 2020 2020 2020 2049 7420 6973 206e 6f74         It is not
-00007080: 2072 6571 7569 7265 6420 746f 2073 6176   required to sav
-00007090: 6520 6974 2074 6f20 7374 6162 6c65 2073  e it to stable s
-000070a0: 746f 7261 6765 2e0a 2020 2020 2020 2020  torage..        
-000070b0: 2222 220a 2020 2020 6465 6620 636f 6d6d  """.    def comm
-000070c0: 6974 7465 645f 656e 7472 6965 7328 7365  itted_entries(se
-000070d0: 6c66 2920 2d3e 204c 6973 745b 2245 6e74  lf) -> List["Ent
-000070e0: 7279 5265 6622 5d3a 0a20 2020 2020 2020  ryRef"]:.       
-000070f0: 2022 2222 0a20 2020 2020 2020 2043 6f6d   """.        Com
-00007100: 6d69 7474 6564 456e 7472 6965 7320 7370  mittedEntries sp
-00007110: 6563 6966 6965 7320 656e 7472 6965 7320  ecifies entries 
-00007120: 746f 2062 6520 636f 6d6d 6974 7465 6420  to be committed 
-00007130: 746f 2061 0a20 2020 2020 2020 2073 746f  to a.        sto
-00007140: 7265 2f73 7461 7465 2d6d 6163 6869 6e65  re/state-machine
-00007150: 2e20 5468 6573 6520 6861 7665 2070 7265  . These have pre
-00007160: 7669 6f75 736c 7920 6265 656e 2063 6f6d  viously been com
-00007170: 6d69 7474 6564 2074 6f20 7374 6162 6c65  mitted to stable
-00007180: 0a20 2020 2020 2020 2073 746f 7265 2e0a  .        store..
-00007190: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000071a0: 6465 6620 7461 6b65 5f63 6f6d 6d69 7474  def take_committ
-000071b0: 6564 5f65 6e74 7269 6573 2873 656c 6629  ed_entries(self)
-000071c0: 202d 3e20 4c69 7374 5b22 456e 7472 7922   -> List["Entry"
-000071d0: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-000071e0: 2020 2020 2020 2054 616b 6520 7468 6520         Take the 
-000071f0: 436f 6d6d 6974 456e 7472 6965 732e 0a20  CommitEntries.. 
-00007200: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00007210: 6566 206d 6573 7361 6765 7328 7365 6c66  ef messages(self
-00007220: 2920 2d3e 204c 6973 745b 224d 6573 7361  ) -> List["Messa
-00007230: 6765 5265 6622 5d3a 0a20 2020 2020 2020  geRef"]:.       
-00007240: 2022 2222 0a20 2020 2020 2020 204d 6573   """.        Mes
-00007250: 7361 6765 7320 7370 6563 6966 6965 7320  sages specifies 
-00007260: 6f75 7462 6f75 6e64 206d 6573 7361 6765  outbound message
-00007270: 7320 746f 2062 6520 7365 6e74 2e0a 2020  s to be sent..  
-00007280: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-00007290: 6620 7461 6b65 5f6d 6573 7361 6765 7328  f take_messages(
-000072a0: 7365 6c66 2920 2d3e 204c 6973 745b 224d  self) -> List["M
-000072b0: 6573 7361 6765 225d 3a0a 2020 2020 2020  essage"]:.      
-000072c0: 2020 2222 220a 2020 2020 2020 2020 5461    """.        Ta
-000072d0: 6b65 2074 6865 204d 6573 7361 6765 732e  ke the Messages.
-000072e0: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
-000072f0: 6173 7320 4c69 6768 7452 6561 6479 285f  ass LightReady(_
-00007300: 5f41 5049 5f4c 6967 6874 5265 6164 7929  _API_LightReady)
-00007310: 3a0a 2020 2020 2222 220a 2020 2020 4c69  :.    """.    Li
-00007320: 6768 7452 6561 6479 2065 6e63 6170 7375  ghtReady encapsu
-00007330: 6c61 7465 7320 7468 6520 636f 6d6d 6974  lates the commit
-00007340: 2069 6e64 6578 2c20 636f 6d6d 6974 7465   index, committe
-00007350: 6420 656e 7472 6965 7320 616e 640a 2020  d entries and.  
-00007360: 2020 6d65 7373 6167 6573 2074 6861 7420    messages that 
-00007370: 6172 6520 7265 6164 7920 746f 2062 6520  are ready to be 
-00007380: 6170 706c 6965 6420 6f72 2062 6520 7365  applied or be se
-00007390: 6e74 2074 6f20 6f74 6865 7220 7065 6572  nt to other peer
-000073a0: 732e 0a20 2020 2022 2222 0a0a 2020 2020  s..    """..    
-000073b0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-000073c0: 6629 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a  f) -> None: ....
-000073d0: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
-000073e0: 2873 656c 6629 202d 3e20 224c 6967 6874  (self) -> "Light
-000073f0: 5265 6164 7952 6566 223a 202e 2e2e 0a20  ReadyRef": .... 
-00007400: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00007410: 0a20 2020 2064 6566 2064 6566 6175 6c74  .    def default
-00007420: 2829 202d 3e20 224c 6967 6874 5265 6164  () -> "LightRead
-00007430: 7922 3a20 2e2e 2e0a 0a63 6c61 7373 204c  y": .....class L
-00007440: 6967 6874 5265 6164 7952 6566 285f 5f41  ightReadyRef(__A
-00007450: 5049 5f4c 6967 6874 5265 6164 7929 3a0a  PI_LightReady):.
-00007460: 2020 2020 2222 220a 2020 2020 5265 6665      """.    Refe
-00007470: 7265 6e63 6520 7479 7065 206f 6620 3a63  rence type of :c
-00007480: 6c61 7373 3a60 4c69 6768 7452 6561 6479  lass:`LightReady
-00007490: 602e 0a20 2020 2022 2222 0a0a 636c 6173  `..    """..clas
-000074a0: 7320 5f5f 4150 495f 536e 6170 7368 6f74  s __API_Snapshot
-000074b0: 4d65 7461 6461 7461 285f 5f43 6c6f 6e65  Metadata(__Clone
-000074c0: 6162 6c65 2c20 5f5f 456e 636f 6465 722c  able, __Encoder,
-000074d0: 205f 5f44 6563 6f64 6572 293a 0a20 2020   __Decoder):.   
-000074e0: 2064 6566 2063 6c6f 6e65 2873 656c 6629   def clone(self)
-000074f0: 202d 3e20 2253 6e61 7073 686f 744d 6574   -> "SnapshotMet
-00007500: 6164 6174 6122 3a20 2e2e 2e0a 2020 2020  adata": ....    
-00007510: 6465 6620 6765 745f 696e 6465 7828 7365  def get_index(se
-00007520: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00007530: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007540: 6069 6e64 6578 603a 2054 6865 2061 7070  `index`: The app
-00007550: 6c69 6564 2069 6e64 6578 2e0a 2020 2020  lied index..    
-00007560: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00007570: 7365 745f 696e 6465 7828 7365 6c66 2c20  set_index(self, 
-00007580: 696e 6465 783a 2069 6e74 2920 2d3e 204e  index: int) -> N
-00007590: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000075a0: 0a20 2020 2020 2020 2060 696e 6465 7860  .        `index`
-000075b0: 3a20 5468 6520 6170 706c 6965 6420 696e  : The applied in
-000075c0: 6465 782e 0a20 2020 2020 2020 2022 2222  dex..        """
-000075d0: 0a20 2020 2064 6566 2063 6c65 6172 5f69  .    def clear_i
-000075e0: 6e64 6578 2873 656c 6629 202d 3e20 4e6f  ndex(self) -> No
-000075f0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00007600: 2020 2020 2020 2020 6069 6e64 6578 603a          `index`:
-00007610: 2054 6865 2061 7070 6c69 6564 2069 6e64   The applied ind
-00007620: 6578 2e0a 2020 2020 2020 2020 2222 220a  ex..        """.
-00007630: 2020 2020 6465 6620 6765 745f 7465 726d      def get_term
-00007640: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
-00007650: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00007660: 2020 2060 7465 726d 603a 2054 6865 2074     `term`: The t
-00007670: 6572 6d20 6f66 2074 6865 2061 7070 6c69  erm of the appli
-00007680: 6564 2069 6e64 6578 2e0a 2020 2020 2020  ed index..      
-00007690: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
-000076a0: 745f 7465 726d 2873 656c 662c 2074 6572  t_term(self, ter
-000076b0: 6d3a 2069 6e74 2920 2d3e 204e 6f6e 653a  m: int) -> None:
-000076c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000076d0: 2020 2020 2060 7465 726d 603a 2054 6865       `term`: The
-000076e0: 2074 6572 6d20 6f66 2074 6865 2061 7070   term of the app
-000076f0: 6c69 6564 2069 6e64 6578 2e0a 2020 2020  lied index..    
-00007700: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00007710: 636c 6561 725f 7465 726d 2873 656c 6629  clear_term(self)
-00007720: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00007730: 2020 2222 220a 2020 2020 2020 2020 6074    """.        `t
-00007740: 6572 6d60 3a20 5468 6520 7465 726d 206f  erm`: The term o
-00007750: 6620 7468 6520 6170 706c 6965 6420 696e  f the applied in
-00007760: 6465 782e 0a20 2020 2020 2020 2022 2222  dex..        """
-00007770: 0a20 2020 2064 6566 2067 6574 5f63 6f6e  .    def get_con
-00007780: 665f 7374 6174 6528 7365 6c66 2920 2d3e  f_state(self) ->
-00007790: 2022 436f 6e66 5374 6174 6552 6566 223a   "ConfStateRef":
-000077a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000077b0: 2020 2020 2060 636f 6e66 5f73 7461 7465       `conf_state
-000077c0: 603a 2054 6865 2063 7572 7265 6e74 2060  `: The current `
-000077d0: 436f 6e66 5374 6174 6560 2e0a 2020 2020  ConfState`..    
-000077e0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-000077f0: 7365 745f 636f 6e66 5f73 7461 7465 2873  set_conf_state(s
-00007800: 656c 662c 2063 6f6e 665f 7374 6174 653a  elf, conf_state:
-00007810: 2022 436f 6e66 5374 6174 6522 207c 2022   "ConfState" | "
-00007820: 436f 6e66 5374 6174 6552 6566 2229 202d  ConfStateRef") -
-00007830: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00007840: 2222 220a 2020 2020 2020 2020 6063 6f6e  """.        `con
-00007850: 665f 7374 6174 6560 3a20 5468 6520 6375  f_state`: The cu
-00007860: 7272 656e 7420 6043 6f6e 6653 7461 7465  rrent `ConfState
-00007870: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
-00007880: 2020 2064 6566 2063 6c65 6172 5f63 6f6e     def clear_con
-00007890: 665f 7374 6174 6528 7365 6c66 2920 2d3e  f_state(self) ->
-000078a0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000078b0: 2222 0a20 2020 2020 2020 2060 636f 6e66  "".        `conf
-000078c0: 5f73 7461 7465 603a 2054 6865 2063 7572  _state`: The cur
-000078d0: 7265 6e74 2060 436f 6e66 5374 6174 6560  rent `ConfState`
-000078e0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000078f0: 2020 6465 6620 6861 735f 636f 6e66 5f73    def has_conf_s
-00007900: 7461 7465 2873 656c 6629 202d 3e20 626f  tate(self) -> bo
-00007910: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
-00007920: 2020 2020 2020 2020 6063 6f6e 665f 7374          `conf_st
-00007930: 6174 6560 3a20 5468 6520 6375 7272 656e  ate`: The curren
-00007940: 7420 6043 6f6e 6653 7461 7465 602e 0a20  t `ConfState`.. 
-00007950: 2020 2020 2020 2022 2222 0a0a 636c 6173         """..clas
-00007960: 7320 536e 6170 7368 6f74 4d65 7461 6461  s SnapshotMetada
-00007970: 7461 285f 5f41 5049 5f53 6e61 7073 686f  ta(__API_Snapsho
-00007980: 744d 6574 6164 6174 6129 3a0a 2020 2020  tMetadata):.    
-00007990: 2222 2220 2222 220a 0a20 2020 2064 6566  """ """..    def
-000079a0: 205f 5f69 6e69 745f 5f28 7365 6c66 2920   __init__(self) 
-000079b0: 2d3e 204e 6f6e 653a 202e 2e2e 0a20 2020  -> None: ....   
-000079c0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-000079d0: 2020 2064 6566 2064 6566 6175 6c74 2829     def default()
-000079e0: 202d 3e20 2253 6e61 7073 686f 744d 6574   -> "SnapshotMet
-000079f0: 6164 6174 6122 3a20 2e2e 2e0a 2020 2020  adata": ....    
-00007a00: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00007a10: 2020 6465 6620 6465 636f 6465 2876 3a20    def decode(v: 
-00007a20: 4c69 7374 5b69 6e74 5d20 7c20 6279 7465  List[int] | byte
-00007a30: 7329 202d 3e20 2253 6e61 7073 686f 744d  s) -> "SnapshotM
-00007a40: 6574 6164 6174 6122 3a20 2e2e 2e0a 2020  etadata": ....  
-00007a50: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
-00007a60: 656c 6629 202d 3e20 2253 6e61 7073 686f  elf) -> "Snapsho
-00007a70: 744d 6574 6164 6174 6152 6566 223a 202e  tMetadataRef": .
-00007a80: 2e2e 0a0a 636c 6173 7320 536e 6170 7368  ....class Snapsh
-00007a90: 6f74 4d65 7461 6461 7461 5265 6628 5f5f  otMetadataRef(__
-00007aa0: 4150 495f 536e 6170 7368 6f74 4d65 7461  API_SnapshotMeta
-00007ab0: 6461 7461 293a 0a20 2020 2022 2222 0a20  data):.    """. 
-00007ac0: 2020 2052 6566 6572 656e 6365 2074 7970     Reference typ
-00007ad0: 6520 6f66 203a 636c 6173 733a 6053 6e61  e of :class:`Sna
-00007ae0: 7073 686f 744d 6574 6164 6174 6160 2e0a  pshotMetadata`..
-00007af0: 2020 2020 2222 220a 0a63 6c61 7373 205f      """..class _
-00007b00: 5f41 5049 5f53 6e61 7073 686f 7428 5f5f  _API_Snapshot(__
-00007b10: 436c 6f6e 6561 626c 652c 205f 5f45 6e63  Cloneable, __Enc
-00007b20: 6f64 6572 2c20 5f5f 4465 636f 6465 7229  oder, __Decoder)
-00007b30: 3a0a 2020 2020 6465 6620 636c 6f6e 6528  :.    def clone(
-00007b40: 7365 6c66 2920 2d3e 2022 536e 6170 7368  self) -> "Snapsh
-00007b50: 6f74 223a 202e 2e2e 0a20 2020 2064 6566  ot": ....    def
-00007b60: 2067 6574 5f64 6174 6128 7365 6c66 2920   get_data(self) 
-00007b70: 2d3e 2062 7974 6573 3a0a 2020 2020 2020  -> bytes:.      
-00007b80: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-00007b90: 6620 7365 745f 6461 7461 2873 656c 662c  f set_data(self,
-00007ba0: 2064 6174 613a 2062 7974 6573 2920 2d3e   data: bytes) ->
-00007bb0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00007bc0: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
-00007bd0: 6c65 6172 5f64 6174 6128 7365 6c66 2920  lear_data(self) 
-00007be0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00007bf0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-00007c00: 2067 6574 5f6d 6574 6164 6174 6128 7365   get_metadata(se
-00007c10: 6c66 2920 2d3e 2022 536e 6170 7368 6f74  lf) -> "Snapshot
-00007c20: 4d65 7461 6461 7461 5265 6622 3a0a 2020  MetadataRef":.  
-00007c30: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
-00007c40: 2020 6465 6620 7365 745f 6d65 7461 6461    def set_metada
-00007c50: 7461 280a 2020 2020 2020 2020 7365 6c66  ta(.        self
-00007c60: 2c20 6d65 7461 5f64 6174 613a 2022 536e  , meta_data: "Sn
-00007c70: 6170 7368 6f74 4d65 7461 6461 7461 2220  apshotMetadata" 
-00007c80: 7c20 2253 6e61 7073 686f 744d 6574 6164  | "SnapshotMetad
-00007c90: 6174 6152 6566 220a 2020 2020 2920 2d3e  ataRef".    ) ->
-00007ca0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00007cb0: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
-00007cc0: 6c65 6172 5f6d 6574 6164 6174 6128 7365  lear_metadata(se
-00007cd0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00007ce0: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
-00007cf0: 2064 6566 2068 6173 5f6d 6574 6164 6174   def has_metadat
-00007d00: 6128 7365 6c66 2920 2d3e 2062 6f6f 6c3a  a(self) -> bool:
-00007d10: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-00007d20: 0a0a 636c 6173 7320 536e 6170 7368 6f74  ..class Snapshot
-00007d30: 285f 5f41 5049 5f53 6e61 7073 686f 7429  (__API_Snapshot)
-00007d40: 3a0a 2020 2020 2222 2220 2222 220a 0a20  :.    """ """.. 
-00007d50: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00007d60: 7365 6c66 2920 2d3e 204e 6f6e 653a 202e  self) -> None: .
-00007d70: 2e2e 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
-00007d80: 7468 6f64 0a20 2020 2064 6566 2064 6566  thod.    def def
-00007d90: 6175 6c74 2829 202d 3e20 2253 6e61 7073  ault() -> "Snaps
-00007da0: 686f 7422 3a20 2e2e 2e0a 2020 2020 4073  hot": ....    @s
-00007db0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00007dc0: 6465 6620 6465 636f 6465 2876 3a20 4c69  def decode(v: Li
-00007dd0: 7374 5b69 6e74 5d20 7c20 6279 7465 7329  st[int] | bytes)
-00007de0: 202d 3e20 2253 6e61 7073 686f 7422 3a20   -> "Snapshot": 
-00007df0: 2e2e 2e0a 2020 2020 6465 6620 6d61 6b65  ....    def make
-00007e00: 5f72 6566 2873 656c 6629 202d 3e20 2253  _ref(self) -> "S
-00007e10: 6e61 7073 686f 7452 6566 223a 202e 2e2e  napshotRef": ...
-00007e20: 0a0a 636c 6173 7320 536e 6170 7368 6f74  ..class Snapshot
-00007e30: 5265 6628 5f5f 4150 495f 536e 6170 7368  Ref(__API_Snapsh
-00007e40: 6f74 293a 0a20 2020 2022 2222 0a20 2020  ot):.    """.   
-00007e50: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
-00007e60: 6f66 203a 636c 6173 733a 6053 6e61 7073  of :class:`Snaps
-00007e70: 686f 7460 2e0a 2020 2020 2222 220a 0a63  hot`..    """..c
-00007e80: 6c61 7373 205f 5f41 5049 5f4d 6573 7361  lass __API_Messa
-00007e90: 6765 285f 5f43 6c6f 6e65 6162 6c65 2c20  ge(__Cloneable, 
-00007ea0: 5f5f 456e 636f 6465 722c 205f 5f44 6563  __Encoder, __Dec
-00007eb0: 6f64 6572 293a 0a20 2020 2064 6566 2063  oder):.    def c
-00007ec0: 6c6f 6e65 2873 656c 6629 202d 3e20 224d  lone(self) -> "M
-00007ed0: 6573 7361 6765 223a 202e 2e2e 0a20 2020  essage": ....   
-00007ee0: 2064 6566 2067 6574 5f63 6f6d 6d69 7428   def get_commit(
-00007ef0: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-00007f00: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
-00007f10: 2020 6465 6620 7365 745f 636f 6d6d 6974    def set_commit
-00007f20: 2873 656c 662c 2063 6f6d 6d69 743a 2069  (self, commit: i
-00007f30: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-00007f40: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
-00007f50: 2064 6566 2063 6c65 6172 5f63 6f6d 6d69   def clear_commi
-00007f60: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
-00007f70: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-00007f80: 0a20 2020 2064 6566 2067 6574 5f63 6f6d  .    def get_com
-00007f90: 6d69 745f 7465 726d 2873 656c 6629 202d  mit_term(self) -
-00007fa0: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-00007fb0: 2222 2022 2222 0a20 2020 2064 6566 2073  "" """.    def s
-00007fc0: 6574 5f63 6f6d 6d69 745f 7465 726d 2873  et_commit_term(s
-00007fd0: 656c 662c 2063 6f6d 6d69 745f 7465 726d  elf, commit_term
-00007fe0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-00007ff0: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-00008000: 2020 2020 6465 6620 636c 6561 725f 636f      def clear_co
-00008010: 6d6d 6974 5f74 6572 6d28 7365 6c66 2920  mmit_term(self) 
-00008020: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00008030: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-00008040: 2067 6574 5f66 726f 6d28 7365 6c66 2920   get_from(self) 
-00008050: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00008060: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-00008070: 7365 745f 6672 6f6d 2873 656c 662c 2066  set_from(self, f
-00008080: 726f 6d5f 3a20 696e 7429 202d 3e20 4e6f  rom_: int) -> No
-00008090: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
-000080a0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
-000080b0: 725f 6672 6f6d 2873 656c 6629 202d 3e20  r_from(self) -> 
-000080c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000080d0: 2220 2222 220a 2020 2020 6465 6620 6765  " """.    def ge
-000080e0: 745f 696e 6465 7828 7365 6c66 2920 2d3e  t_index(self) ->
-000080f0: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-00008100: 2220 2222 220a 2020 2020 6465 6620 7365  " """.    def se
-00008110: 745f 696e 6465 7828 7365 6c66 2c20 696e  t_index(self, in
-00008120: 6465 783a 2069 6e74 2920 2d3e 204e 6f6e  dex: int) -> Non
-00008130: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
-00008140: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
-00008150: 5f69 6e64 6578 2873 656c 6629 202d 3e20  _index(self) -> 
-00008160: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00008170: 2220 2222 220a 2020 2020 6465 6620 6765  " """.    def ge
-00008180: 745f 7465 726d 2873 656c 6629 202d 3e20  t_term(self) -> 
-00008190: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-000081a0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-000081b0: 5f74 6572 6d28 7365 6c66 2c20 7465 726d  _term(self, term
-000081c0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-000081d0: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-000081e0: 2020 2020 6465 6620 636c 6561 725f 7465      def clear_te
-000081f0: 726d 2873 656c 6629 202d 3e20 4e6f 6e65  rm(self) -> None
-00008200: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-00008210: 220a 2020 2020 6465 6620 6765 745f 6c6f  ".    def get_lo
-00008220: 675f 7465 726d 2873 656c 6629 202d 3e20  g_term(self) -> 
-00008230: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-00008240: 0a20 2020 2020 2020 2060 6c6f 6754 6572  .        `logTer
-00008250: 6d60 3a20 6c6f 6754 6572 6d20 6973 2067  m`: logTerm is g
-00008260: 656e 6572 616c 6c79 2075 7365 6420 666f  enerally used fo
-00008270: 7220 6170 7065 6e64 696e 6720 5261 6674  r appending Raft
-00008280: 206c 6f67 7320 746f 2066 6f6c 6c6f 7765   logs to followe
-00008290: 7273 2e20 466f 7220 6578 616d 706c 652c  rs. For example,
-000082a0: 0a20 2020 2020 2020 2028 7479 7065 3d4d  .        (type=M
-000082b0: 7367 4170 7065 6e64 2c69 6e64 6578 3d31  sgAppend,index=1
-000082c0: 3030 2c6c 6f67 5f74 6572 6d3d 3529 206d  00,log_term=5) m
-000082d0: 6561 6e73 206c 6561 6465 7220 6170 7065  eans leader appe
-000082e0: 6e64 7320 656e 7472 6965 7320 7374 6172  nds entries star
-000082f0: 7469 6e67 2061 740a 2020 2020 2020 2020  ting at.        
-00008300: 696e 6465 783d 3130 312c 2061 6e64 2074  index=101, and t
-00008310: 6865 2074 6572 6d20 6f66 2065 6e74 7279  he term of entry
-00008320: 2061 7420 696e 6465 7820 3130 3020 6973   at index 100 is
-00008330: 2035 2e0a 2020 2020 2020 2020 2874 7970   5..        (typ
-00008340: 653d 4d73 6741 7070 656e 6452 6573 706f  e=MsgAppendRespo
-00008350: 6e73 652c 7265 6a65 6374 3d74 7275 652c  nse,reject=true,
-00008360: 696e 6465 783d 3130 302c 6c6f 675f 7465  index=100,log_te
-00008370: 726d 3d35 2920 6d65 616e 7320 666f 6c6c  rm=5) means foll
-00008380: 6f77 6572 2072 656a 6563 7473 2073 6f6d  ower rejects som
-00008390: 650a 2020 2020 2020 2020 656e 7472 6965  e.        entrie
-000083a0: 7320 6672 6f6d 2069 7473 206c 6561 6465  s from its leade
-000083b0: 7220 6173 2069 7420 616c 7265 6164 7920  r as it already 
-000083c0: 6861 7320 616e 2065 6e74 7279 2077 6974  has an entry wit
-000083d0: 6820 7465 726d 2035 2061 7420 696e 6465  h term 5 at inde
-000083e0: 7820 3130 302e 0a20 2020 2020 2020 2022  x 100..        "
-000083f0: 2222 0a20 2020 2064 6566 2073 6574 5f6c  "".    def set_l
-00008400: 6f67 5f74 6572 6d28 7365 6c66 2c20 6c6f  og_term(self, lo
-00008410: 675f 696e 6465 783a 2069 6e74 2920 2d3e  g_index: int) ->
-00008420: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00008430: 2222 0a20 2020 2020 2020 2060 6c6f 6754  "".        `logT
-00008440: 6572 6d60 3a20 6c6f 6754 6572 6d20 6973  erm`: logTerm is
-00008450: 2067 656e 6572 616c 6c79 2075 7365 6420   generally used 
-00008460: 666f 7220 6170 7065 6e64 696e 6720 5261  for appending Ra
-00008470: 6674 206c 6f67 7320 746f 2066 6f6c 6c6f  ft logs to follo
-00008480: 7765 7273 2e20 466f 7220 6578 616d 706c  wers. For exampl
-00008490: 652c 0a20 2020 2020 2020 2028 7479 7065  e,.        (type
-000084a0: 3d4d 7367 4170 7065 6e64 2c69 6e64 6578  =MsgAppend,index
-000084b0: 3d31 3030 2c6c 6f67 5f74 6572 6d3d 3529  =100,log_term=5)
-000084c0: 206d 6561 6e73 206c 6561 6465 7220 6170   means leader ap
-000084d0: 7065 6e64 7320 656e 7472 6965 7320 7374  pends entries st
-000084e0: 6172 7469 6e67 2061 740a 2020 2020 2020  arting at.      
-000084f0: 2020 696e 6465 783d 3130 312c 2061 6e64    index=101, and
-00008500: 2074 6865 2074 6572 6d20 6f66 2065 6e74   the term of ent
-00008510: 7279 2061 7420 696e 6465 7820 3130 3020  ry at index 100 
-00008520: 6973 2035 2e0a 2020 2020 2020 2020 2874  is 5..        (t
-00008530: 7970 653d 4d73 6741 7070 656e 6452 6573  ype=MsgAppendRes
-00008540: 706f 6e73 652c 7265 6a65 6374 3d74 7275  ponse,reject=tru
-00008550: 652c 696e 6465 783d 3130 302c 6c6f 675f  e,index=100,log_
-00008560: 7465 726d 3d35 2920 6d65 616e 7320 666f  term=5) means fo
-00008570: 6c6c 6f77 6572 2072 656a 6563 7473 2073  llower rejects s
-00008580: 6f6d 650a 2020 2020 2020 2020 656e 7472  ome.        entr
-00008590: 6965 7320 6672 6f6d 2069 7473 206c 6561  ies from its lea
-000085a0: 6465 7220 6173 2069 7420 616c 7265 6164  der as it alread
-000085b0: 7920 6861 7320 616e 2065 6e74 7279 2077  y has an entry w
-000085c0: 6974 6820 7465 726d 2035 2061 7420 696e  ith term 5 at in
-000085d0: 6465 7820 3130 302e 0a20 2020 2020 2020  dex 100..       
-000085e0: 2022 2222 0a20 2020 2064 6566 2063 6c65   """.    def cle
-000085f0: 6172 5f6c 6f67 5f74 6572 6d28 7365 6c66  ar_log_term(self
-00008600: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00008610: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00008620: 6c6f 6754 6572 6d60 3a20 6c6f 6754 6572  logTerm`: logTer
-00008630: 6d20 6973 2067 656e 6572 616c 6c79 2075  m is generally u
-00008640: 7365 6420 666f 7220 6170 7065 6e64 696e  sed for appendin
-00008650: 6720 5261 6674 206c 6f67 7320 746f 2066  g Raft logs to f
-00008660: 6f6c 6c6f 7765 7273 2e20 466f 7220 6578  ollowers. For ex
-00008670: 616d 706c 652c 0a20 2020 2020 2020 2028  ample,.        (
-00008680: 7479 7065 3d4d 7367 4170 7065 6e64 2c69  type=MsgAppend,i
-00008690: 6e64 6578 3d31 3030 2c6c 6f67 5f74 6572  ndex=100,log_ter
-000086a0: 6d3d 3529 206d 6561 6e73 206c 6561 6465  m=5) means leade
-000086b0: 7220 6170 7065 6e64 7320 656e 7472 6965  r appends entrie
-000086c0: 7320 7374 6172 7469 6e67 2061 740a 2020  s starting at.  
-000086d0: 2020 2020 2020 696e 6465 783d 3130 312c        index=101,
-000086e0: 2061 6e64 2074 6865 2074 6572 6d20 6f66   and the term of
-000086f0: 2065 6e74 7279 2061 7420 696e 6465 7820   entry at index 
-00008700: 3130 3020 6973 2035 2e0a 2020 2020 2020  100 is 5..      
-00008710: 2020 2874 7970 653d 4d73 6741 7070 656e    (type=MsgAppen
-00008720: 6452 6573 706f 6e73 652c 7265 6a65 6374  dResponse,reject
-00008730: 3d74 7275 652c 696e 6465 783d 3130 302c  =true,index=100,
-00008740: 6c6f 675f 7465 726d 3d35 2920 6d65 616e  log_term=5) mean
-00008750: 7320 666f 6c6c 6f77 6572 2072 656a 6563  s follower rejec
-00008760: 7473 2073 6f6d 650a 2020 2020 2020 2020  ts some.        
-00008770: 656e 7472 6965 7320 6672 6f6d 2069 7473  entries from its
-00008780: 206c 6561 6465 7220 6173 2069 7420 616c   leader as it al
-00008790: 7265 6164 7920 6861 7320 616e 2065 6e74  ready has an ent
-000087a0: 7279 2077 6974 6820 7465 726d 2035 2061  ry with term 5 a
-000087b0: 7420 696e 6465 7820 3130 302e 0a20 2020  t index 100..   
-000087c0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-000087d0: 2067 6574 5f70 7269 6f72 6974 7928 7365   get_priority(se
-000087e0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-000087f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00008800: 6070 7269 6f72 6974 7960 3a20 4966 2074  `priority`: If t
-00008810: 6869 7320 6e65 7720 6669 656c 6420 6973  his new field is
-00008820: 206e 6f74 2073 6574 2c20 7468 656e 2075   not set, then u
-00008830: 7365 2074 6865 2061 626f 7665 206f 6c64  se the above old
-00008840: 2066 6965 6c64 3b20 6f74 6865 7277 6973   field; otherwis
-00008850: 650a 2020 2020 2020 2020 7573 6520 7468  e.        use th
-00008860: 6520 6e65 7720 6669 656c 642e 2057 6865  e new field. Whe
-00008870: 6e20 6272 6f61 6463 6173 7469 6e67 2072  n broadcasting r
-00008880: 6571 7565 7374 2076 6f74 652c 2062 6f74  equest vote, bot
-00008890: 6820 6669 656c 6473 2061 7265 0a20 2020  h fields are.   
-000088a0: 2020 2020 2073 6574 2069 6620 7468 6520       set if the 
-000088b0: 7072 696f 7269 7479 2069 7320 6c61 7267  priority is larg
-000088c0: 6572 2074 6861 6e20 302e 2054 6869 7320  er than 0. This 
-000088d0: 6368 616e 6765 2069 7320 6e6f 7420 6120  change is not a 
-000088e0: 6675 6c6c 790a 2020 2020 2020 2020 636f  fully.        co
-000088f0: 6d70 6174 6962 6c65 2063 6861 6e67 652c  mpatible change,
-00008900: 2062 7574 2069 7420 6d61 6b65 7320 6d69   but it makes mi
-00008910: 6e69 6d61 6c20 696d 7061 6374 2074 6861  nimal impact tha
-00008920: 7420 6f6e 6c79 206e 6577 2070 7269 6f72  t only new prior
-00008930: 6974 790a 2020 2020 2020 2020 6973 206e  ity.        is n
-00008940: 6f74 2072 6563 6f67 6e69 7a65 6420 6279  ot recognized by
-00008950: 2074 6865 206f 6c64 206e 6f64 6573 2064   the old nodes d
-00008960: 7572 696e 6720 726f 6c6c 696e 6720 7570  uring rolling up
-00008970: 6461 7465 2e0a 2020 2020 2020 2020 2222  date..        ""
-00008980: 220a 2020 2020 6465 6620 7365 745f 7072  ".    def set_pr
-00008990: 696f 7269 7479 2873 656c 662c 2070 7269  iority(self, pri
-000089a0: 6f72 6974 793a 2069 6e74 2920 2d3e 204e  ority: int) -> N
-000089b0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000089c0: 0a20 2020 2020 2020 2060 7072 696f 7269  .        `priori
-000089d0: 7479 603a 2049 6620 7468 6973 206e 6577  ty`: If this new
-000089e0: 2066 6965 6c64 2069 7320 6e6f 7420 7365   field is not se
-000089f0: 742c 2074 6865 6e20 7573 6520 7468 6520  t, then use the 
-00008a00: 6162 6f76 6520 6f6c 6420 6669 656c 643b  above old field;
-00008a10: 206f 7468 6572 7769 7365 0a20 2020 2020   otherwise.     
-00008a20: 2020 2075 7365 2074 6865 206e 6577 2066     use the new f
-00008a30: 6965 6c64 2e20 5768 656e 2062 726f 6164  ield. When broad
-00008a40: 6361 7374 696e 6720 7265 7175 6573 7420  casting request 
-00008a50: 766f 7465 2c20 626f 7468 2066 6965 6c64  vote, both field
-00008a60: 7320 6172 650a 2020 2020 2020 2020 7365  s are.        se
-00008a70: 7420 6966 2074 6865 2070 7269 6f72 6974  t if the priorit
-00008a80: 7920 6973 206c 6172 6765 7220 7468 616e  y is larger than
-00008a90: 2030 2e20 5468 6973 2063 6861 6e67 6520   0. This change 
-00008aa0: 6973 206e 6f74 2061 2066 756c 6c79 0a20  is not a fully. 
-00008ab0: 2020 2020 2020 2063 6f6d 7061 7469 626c         compatibl
-00008ac0: 6520 6368 616e 6765 2c20 6275 7420 6974  e change, but it
-00008ad0: 206d 616b 6573 206d 696e 696d 616c 2069   makes minimal i
-00008ae0: 6d70 6163 7420 7468 6174 206f 6e6c 7920  mpact that only 
-00008af0: 6e65 7720 7072 696f 7269 7479 0a20 2020  new priority.   
-00008b00: 2020 2020 2069 7320 6e6f 7420 7265 636f       is not reco
-00008b10: 676e 697a 6564 2062 7920 7468 6520 6f6c  gnized by the ol
-00008b20: 6420 6e6f 6465 7320 6475 7269 6e67 2072  d nodes during r
-00008b30: 6f6c 6c69 6e67 2075 7064 6174 652e 0a20  olling update.. 
-00008b40: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00008b50: 6566 2063 6c65 6172 5f70 7269 6f72 6974  ef clear_priorit
-00008b60: 7928 7365 6c66 2920 2d3e 204e 6f6e 653a  y(self) -> None:
-00008b70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008b80: 2020 2020 2060 7072 696f 7269 7479 603a       `priority`:
-00008b90: 2049 6620 7468 6973 206e 6577 2066 6965   If this new fie
-00008ba0: 6c64 2069 7320 6e6f 7420 7365 742c 2074  ld is not set, t
-00008bb0: 6865 6e20 7573 6520 7468 6520 6162 6f76  hen use the abov
-00008bc0: 6520 6f6c 6420 6669 656c 643b 206f 7468  e old field; oth
-00008bd0: 6572 7769 7365 0a20 2020 2020 2020 2075  erwise.        u
-00008be0: 7365 2074 6865 206e 6577 2066 6965 6c64  se the new field
-00008bf0: 2e20 5768 656e 2062 726f 6164 6361 7374  . When broadcast
-00008c00: 696e 6720 7265 7175 6573 7420 766f 7465  ing request vote
-00008c10: 2c20 626f 7468 2066 6965 6c64 7320 6172  , both fields ar
-00008c20: 650a 2020 2020 2020 2020 7365 7420 6966  e.        set if
-00008c30: 2074 6865 2070 7269 6f72 6974 7920 6973   the priority is
-00008c40: 206c 6172 6765 7220 7468 616e 2030 2e20   larger than 0. 
-00008c50: 5468 6973 2063 6861 6e67 6520 6973 206e  This change is n
-00008c60: 6f74 2061 2066 756c 6c79 0a20 2020 2020  ot a fully.     
-00008c70: 2020 2063 6f6d 7061 7469 626c 6520 6368     compatible ch
-00008c80: 616e 6765 2c20 6275 7420 6974 206d 616b  ange, but it mak
-00008c90: 6573 206d 696e 696d 616c 2069 6d70 6163  es minimal impac
-00008ca0: 7420 7468 6174 206f 6e6c 7920 6e65 7720  t that only new 
-00008cb0: 7072 696f 7269 7479 0a20 2020 2020 2020  priority.       
-00008cc0: 2069 7320 6e6f 7420 7265 636f 676e 697a   is not recogniz
-00008cd0: 6564 2062 7920 7468 6520 6f6c 6420 6e6f  ed by the old no
-00008ce0: 6465 7320 6475 7269 6e67 2072 6f6c 6c69  des during rolli
-00008cf0: 6e67 2075 7064 6174 652e 0a20 2020 2020  ng update..     
-00008d00: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
-00008d10: 6574 5f63 6f6e 7465 7874 2873 656c 6629  et_context(self)
-00008d20: 202d 3e20 6279 7465 733a 0a20 2020 2020   -> bytes:.     
-00008d30: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
-00008d40: 6566 2073 6574 5f63 6f6e 7465 7874 2873  ef set_context(s
-00008d50: 656c 662c 2063 6f6e 7465 7874 3a20 6279  elf, context: by
-00008d60: 7465 7320 7c20 4c69 7374 5b69 6e74 5d29  tes | List[int])
-00008d70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00008d80: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-00008d90: 6620 636c 6561 725f 636f 6e74 6578 7428  f clear_context(
-00008da0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00008db0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
-00008dc0: 2020 2064 6566 2067 6574 5f72 656a 6563     def get_rejec
-00008dd0: 745f 6869 6e74 2873 656c 6629 202d 3e20  t_hint(self) -> 
-00008de0: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-00008df0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-00008e00: 5f72 656a 6563 745f 6869 6e74 2873 656c  _reject_hint(sel
-00008e10: 662c 2072 656a 6563 745f 6869 6e74 3a20  f, reject_hint: 
-00008e20: 626f 6f6c 2920 2d3e 204e 6f6e 653a 0a20  bool) -> None:. 
+000005c0: 636f 6465 2876 3a20 6279 7465 7329 202d  code(v: bytes) -
+000005d0: 3e20 416e 793a 0a20 2020 2020 2020 2022  > Any:.        "
+000005e0: 2222 2022 2222 0a0a 636c 6173 7320 4f76  "" """..class Ov
+000005f0: 6572 666c 6f77 5374 7261 7465 6779 3a0a  erflowStrategy:.
+00000600: 2020 2020 2222 2220 2222 220a 0a20 2020      """ """..   
+00000610: 2042 6c6f 636b 3a20 4669 6e61 6c5b 416e   Block: Final[An
+00000620: 795d 0a20 2020 2044 726f 703a 2046 696e  y].    Drop: Fin
+00000630: 616c 5b41 6e79 5d0a 2020 2020 4472 6f70  al[Any].    Drop
+00000640: 416e 6452 6570 6f72 743a 2046 696e 616c  AndReport: Final
+00000650: 5b41 6e79 5d0a 0a63 6c61 7373 2053 6e61  [Any]..class Sna
+00000660: 7073 686f 7453 7461 7475 733a 0a20 2020  pshotStatus:.   
+00000670: 2022 2222 5468 6520 7374 6174 7573 206f   """The status o
+00000680: 6620 7468 6520 736e 6170 7368 6f74 2e22  f the snapshot."
+00000690: 2222 0a0a 2020 2020 2222 220a 2020 2020  ""..    """.    
+000006a0: 5265 7072 6573 656e 7473 2074 6861 7420  Represents that 
+000006b0: 7468 6520 736e 6170 7368 6f74 2069 7320  the snapshot is 
+000006c0: 6669 6e69 7368 6564 2062 6569 6e67 2063  finished being c
+000006d0: 7265 6174 6564 2e0a 2020 2020 2222 220a  reated..    """.
+000006e0: 2020 2020 4669 6e69 7368 3a20 4669 6e61      Finish: Fina
+000006f0: 6c5b 416e 795d 0a0a 2020 2020 2222 220a  l[Any]..    """.
+00000700: 2020 2020 496e 6469 6361 7465 7320 7468      Indicates th
+00000710: 6174 2074 6865 2073 6e61 7073 686f 7420  at the snapshot 
+00000720: 6661 696c 6564 2074 6f20 6275 696c 6420  failed to build 
+00000730: 6f72 2069 7320 6e6f 7420 7265 6164 792e  or is not ready.
+00000740: 0a20 2020 2022 2222 0a20 2020 2046 6169  .    """.    Fai
+00000750: 6c75 7265 3a20 4669 6e61 6c5b 416e 795d  lure: Final[Any]
+00000760: 0a0a 636c 6173 7320 5072 6f67 7265 7373  ..class Progress
+00000770: 5374 6174 653a 0a20 2020 2022 2222 5468  State:.    """Th
+00000780: 6520 7374 6174 6520 6f66 2074 6865 2070  e state of the p
+00000790: 726f 6772 6573 732e 2222 220a 0a20 2020  rogress."""..   
+000007a0: 2022 2222 0a20 2020 2057 6865 7468 6572   """.    Whether
+000007b0: 2069 7427 7320 7072 6f62 696e 672e 0a20   it's probing.. 
+000007c0: 2020 2022 2222 0a20 2020 2050 726f 6265     """.    Probe
+000007d0: 3a20 4669 6e61 6c5b 416e 795d 0a0a 2020  : Final[Any]..  
+000007e0: 2020 2222 220a 2020 2020 5768 6574 6865    """.    Whethe
+000007f0: 7220 6974 2773 2072 6570 6c69 6361 7469  r it's replicati
+00000800: 6e67 2e0a 2020 2020 2222 220a 2020 2020  ng..    """.    
+00000810: 5265 706c 6963 6174 653a 2046 696e 616c  Replicate: Final
+00000820: 5b41 6e79 5d0a 0a20 2020 2022 2222 0a20  [Any]..    """. 
+00000830: 2020 2057 6865 7468 6572 2069 7427 7320     Whether it's 
+00000840: 6120 736e 6170 7368 6f74 2e0a 2020 2020  a snapshot..    
+00000850: 2222 220a 2020 2020 536e 6170 7368 6f74  """.    Snapshot
+00000860: 3a20 4669 6e61 6c5b 416e 795d 0a0a 636c  : Final[Any]..cl
+00000870: 6173 7320 5374 6174 6552 6f6c 653a 0a20  ass StateRole:. 
+00000880: 2020 2022 2222 5468 6520 726f 6c65 206f     """The role o
+00000890: 6620 7468 6520 6e6f 6465 2e22 2222 0a0a  f the node."""..
+000008a0: 2020 2020 2222 220a 2020 2020 5468 6520      """.    The 
+000008b0: 6e6f 6465 2063 6f75 6c64 2062 6563 6f6d  node could becom
+000008c0: 6520 6120 6c65 6164 6572 2e0a 2020 2020  e a leader..    
+000008d0: 2222 220a 2020 2020 4361 6e64 6964 6174  """.    Candidat
+000008e0: 653a 2046 696e 616c 5b41 6e79 5d0a 0a20  e: Final[Any].. 
+000008f0: 2020 2022 2222 0a20 2020 2054 6865 206e     """.    The n
+00000900: 6f64 6520 6973 2061 2066 6f6c 6c6f 7765  ode is a followe
+00000910: 7220 6f66 2074 6865 206c 6561 6465 722e  r of the leader.
+00000920: 0a20 2020 2022 2222 0a20 2020 2046 6f6c  .    """.    Fol
+00000930: 6c6f 7765 723a 2046 696e 616c 5b41 6e79  lower: Final[Any
+00000940: 5d0a 0a20 2020 2022 2222 0a20 2020 2054  ]..    """.    T
+00000950: 6865 206e 6f64 6520 6973 2061 206c 6561  he node is a lea
+00000960: 6465 722e 0a20 2020 2022 2222 0a20 2020  der..    """.   
+00000970: 204c 6561 6465 723a 2046 696e 616c 5b41   Leader: Final[A
+00000980: 6e79 5d0a 0a20 2020 2022 2222 0a20 2020  ny]..    """.   
+00000990: 2054 6865 206e 6f64 6520 636f 756c 6420   The node could 
+000009a0: 6265 636f 6d65 2061 2063 616e 6469 6461  become a candida
+000009b0: 7465 2c20 6966 2060 7072 6576 6f74 6560  te, if `prevote`
+000009c0: 2069 7320 656e 6162 6c65 642e 0a20 2020   is enabled..   
+000009d0: 2022 2222 0a20 2020 2050 7265 4361 6e64   """.    PreCand
+000009e0: 6964 6174 653a 2046 696e 616c 5b41 6e79  idate: Final[Any
+000009f0: 5d0a 0a63 6c61 7373 2052 6561 644f 6e6c  ]..class ReadOnl
+00000a00: 794f 7074 696f 6e3a 0a20 2020 2022 2222  yOption:.    """
+00000a10: 4465 7465 726d 696e 6573 2074 6865 2072  Determines the r
+00000a20: 656c 6174 6976 6520 7361 6665 7479 206f  elative safety o
+00000a30: 6620 616e 6420 636f 6e73 6973 7465 6e63  f and consistenc
+00000a40: 7920 6f66 2072 6561 6420 6f6e 6c79 2072  y of read only r
+00000a50: 6571 7565 7374 732e 2222 220a 0a20 2020  equests."""..   
+00000a60: 2022 2222 0a20 2020 2053 6166 6520 6775   """.    Safe gu
+00000a70: 6172 616e 7465 6573 2074 6865 206c 696e  arantees the lin
+00000a80: 6561 7269 7a61 6269 6c69 7479 206f 6620  earizability of 
+00000a90: 7468 6520 7265 6164 206f 6e6c 7920 7265  the read only re
+00000aa0: 7175 6573 7420 6279 0a20 2020 2063 6f6d  quest by.    com
+00000ab0: 6d75 6e69 6361 7469 6e67 2077 6974 6820  municating with 
+00000ac0: 7468 6520 7175 6f72 756d 2e20 4974 2069  the quorum. It i
+00000ad0: 7320 7468 6520 6465 6661 756c 7420 616e  s the default an
+00000ae0: 6420 7375 6767 6573 7465 6420 6f70 7469  d suggested opti
+00000af0: 6f6e 2e0a 2020 2020 2222 220a 2020 2020  on..    """.    
+00000b00: 5361 6665 3a20 4669 6e61 6c5b 416e 795d  Safe: Final[Any]
+00000b10: 0a0a 2020 2020 2222 220a 2020 2020 4c65  ..    """.    Le
+00000b20: 6173 6542 6173 6564 2065 6e73 7572 6573  aseBased ensures
+00000b30: 206c 696e 6561 7269 7a61 6269 6c69 7479   linearizability
+00000b40: 206f 6620 7468 6520 7265 6164 206f 6e6c   of the read onl
+00000b50: 7920 7265 7175 6573 7420 6279 0a20 2020  y request by.   
+00000b60: 2072 656c 7969 6e67 206f 6e20 7468 6520   relying on the 
+00000b70: 6c65 6164 6572 206c 6561 7365 2e20 4974  leader lease. It
+00000b80: 2063 616e 2062 6520 6166 6665 6374 6564   can be affected
+00000b90: 2062 7920 636c 6f63 6b20 6472 6966 742e   by clock drift.
+00000ba0: 0a20 2020 2049 6620 7468 6520 636c 6f63  .    If the cloc
+00000bb0: 6b20 6472 6966 7420 6973 2075 6e62 6f75  k drift is unbou
+00000bc0: 6e64 6564 2c20 6c65 6164 6572 206d 6967  nded, leader mig
+00000bd0: 6874 206b 6565 7020 7468 6520 6c65 6173  ht keep the leas
+00000be0: 6520 6c6f 6e67 6572 2074 6861 6e20 6974  e longer than it
+00000bf0: 0a20 2020 2073 686f 756c 6420 2863 6c6f  .    should (clo
+00000c00: 636b 2063 616e 206d 6f76 6520 6261 636b  ck can move back
+00000c10: 7761 7264 2f70 6175 7365 2077 6974 686f  ward/pause witho
+00000c20: 7574 2061 6e79 2062 6f75 6e64 292e 2052  ut any bound). R
+00000c30: 6561 6449 6e64 6578 2069 7320 6e6f 7420  eadIndex is not 
+00000c40: 7361 6665 0a20 2020 2069 6e20 7468 6174  safe.    in that
+00000c50: 2063 6173 652e 0a20 2020 2022 2222 0a20   case..    """. 
+00000c60: 2020 204c 6561 7365 4261 7365 643a 2046     LeaseBased: F
+00000c70: 696e 616c 5b41 6e79 5d0a 0a63 6c61 7373  inal[Any]..class
+00000c80: 204d 6573 7361 6765 5479 7065 3a0a 2020   MessageType:.  
+00000c90: 2020 2222 2220 2222 220a 0a20 2020 204d    """ """..    M
+00000ca0: 7367 4875 703a 2046 696e 616c 5b41 6e79  sgHup: Final[Any
+00000cb0: 5d0a 2020 2020 4d73 6742 6561 743a 2046  ].    MsgBeat: F
+00000cc0: 696e 616c 5b41 6e79 5d0a 2020 2020 4d73  inal[Any].    Ms
+00000cd0: 6750 726f 706f 7365 3a20 4669 6e61 6c5b  gPropose: Final[
+00000ce0: 416e 795d 0a20 2020 204d 7367 4170 7065  Any].    MsgAppe
+00000cf0: 6e64 3a20 4669 6e61 6c5b 416e 795d 0a20  nd: Final[Any]. 
+00000d00: 2020 204d 7367 4170 7065 6e64 5265 7370     MsgAppendResp
+00000d10: 6f6e 7365 3a20 4669 6e61 6c5b 416e 795d  onse: Final[Any]
+00000d20: 0a20 2020 204d 7367 5265 7175 6573 7456  .    MsgRequestV
+00000d30: 6f74 653a 2046 696e 616c 5b41 6e79 5d0a  ote: Final[Any].
+00000d40: 2020 2020 4d73 6752 6571 7565 7374 566f      MsgRequestVo
+00000d50: 7465 5265 7370 6f6e 7365 3a20 4669 6e61  teResponse: Fina
+00000d60: 6c5b 416e 795d 0a20 2020 204d 7367 536e  l[Any].    MsgSn
+00000d70: 6170 7368 6f74 3a20 4669 6e61 6c5b 416e  apshot: Final[An
+00000d80: 795d 0a20 2020 204d 7367 4865 6172 7462  y].    MsgHeartb
+00000d90: 6561 743a 2046 696e 616c 5b41 6e79 5d0a  eat: Final[Any].
+00000da0: 2020 2020 4d73 6748 6561 7274 6265 6174      MsgHeartbeat
+00000db0: 5265 7370 6f6e 7365 3a20 4669 6e61 6c5b  Response: Final[
+00000dc0: 416e 795d 0a20 2020 204d 7367 556e 7265  Any].    MsgUnre
+00000dd0: 6163 6861 626c 653a 2046 696e 616c 5b41  achable: Final[A
+00000de0: 6e79 5d0a 2020 2020 4d73 6753 6e61 7053  ny].    MsgSnapS
+00000df0: 7461 7475 733a 2046 696e 616c 5b41 6e79  tatus: Final[Any
+00000e00: 5d0a 2020 2020 4d73 6743 6865 636b 5175  ].    MsgCheckQu
+00000e10: 6f72 756d 3a20 4669 6e61 6c5b 416e 795d  orum: Final[Any]
+00000e20: 0a20 2020 204d 7367 5472 616e 7366 6572  .    MsgTransfer
+00000e30: 4c65 6164 6572 3a20 4669 6e61 6c5b 416e  Leader: Final[An
+00000e40: 795d 0a20 2020 204d 7367 5469 6d65 6f75  y].    MsgTimeou
+00000e50: 744e 6f77 3a20 4669 6e61 6c5b 416e 795d  tNow: Final[Any]
+00000e60: 0a20 2020 204d 7367 5265 6164 496e 6465  .    MsgReadInde
+00000e70: 783a 2046 696e 616c 5b41 6e79 5d0a 2020  x: Final[Any].  
+00000e80: 2020 4d73 6752 6561 6449 6e64 6578 5265    MsgReadIndexRe
+00000e90: 7370 3a20 4669 6e61 6c5b 416e 795d 0a20  sp: Final[Any]. 
+00000ea0: 2020 204d 7367 5265 7175 6573 7450 7265     MsgRequestPre
+00000eb0: 566f 7465 3a20 4669 6e61 6c5b 416e 795d  Vote: Final[Any]
+00000ec0: 0a20 2020 204d 7367 5265 7175 6573 7450  .    MsgRequestP
+00000ed0: 7265 566f 7465 5265 7370 6f6e 7365 3a20  reVoteResponse: 
+00000ee0: 4669 6e61 6c5b 416e 795d 0a20 2020 2040  Final[Any].    @
+00000ef0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00000f00: 2064 6566 2066 726f 6d5f 696e 7428 763a   def from_int(v:
+00000f10: 2069 6e74 2920 2d3e 2022 4d65 7373 6167   int) -> "Messag
+00000f20: 6554 7970 6522 3a20 2e2e 2e0a 0a63 6c61  eType": .....cla
+00000f30: 7373 2043 6f6e 6643 6861 6e67 6554 7261  ss ConfChangeTra
+00000f40: 6e73 6974 696f 6e3a 0a20 2020 2022 2222  nsition:.    """
+00000f50: 2022 2222 0a0a 2020 2020 2222 220a 2020   """..    """.  
+00000f60: 2020 4175 746f 6d61 7469 6361 6c6c 7920    Automatically 
+00000f70: 7573 6520 7468 6520 7369 6d70 6c65 2070  use the simple p
+00000f80: 726f 746f 636f 6c20 6966 2070 6f73 7369  rotocol if possi
+00000f90: 626c 652c 206f 7468 6572 7769 7365 2066  ble, otherwise f
+00000fa0: 616c 6c20 6261 636b 0a20 2020 2074 6f20  all back.    to 
+00000fb0: 436f 6e66 4368 616e 6765 5479 7065 3a3a  ConfChangeType::
+00000fc0: 496d 706c 6963 6974 2e20 4d6f 7374 2061  Implicit. Most a
+00000fd0: 7070 6c69 6361 7469 6f6e 7320 7769 6c6c  pplications will
+00000fe0: 2077 616e 7420 746f 2075 7365 2074 6869   want to use thi
+00000ff0: 732e 0a20 2020 2022 2222 0a20 2020 2041  s..    """.    A
+00001000: 7574 6f3a 2046 696e 616c 5b41 6e79 5d0a  uto: Final[Any].
+00001010: 0a20 2020 2022 2222 0a20 2020 2055 7365  .    """.    Use
+00001020: 206a 6f69 6e74 2063 6f6e 7365 6e73 7573   joint consensus
+00001030: 2075 6e63 6f6e 6469 7469 6f6e 616c 6c79   unconditionally
+00001040: 2c20 616e 6420 7472 616e 7369 7469 6f6e  , and transition
+00001050: 206f 7574 206f 6620 7468 656d 0a20 2020   out of them.   
+00001060: 2061 7574 6f6d 6174 6963 616c 6c79 2028   automatically (
+00001070: 6279 2070 726f 706f 7369 6e67 2061 207a  by proposing a z
+00001080: 6572 6f20 636f 6e66 6967 7572 6174 696f  ero configuratio
+00001090: 6e20 6368 616e 6765 292e 0a0a 2020 2020  n change)...    
+000010a0: 5468 6973 206f 7074 696f 6e20 6973 2073  This option is s
+000010b0: 7569 7461 626c 6520 666f 7220 6170 706c  uitable for appl
+000010c0: 6963 6174 696f 6e73 2074 6861 7420 7761  ications that wa
+000010d0: 6e74 2074 6f20 6d69 6e69 6d69 7a65 2074  nt to minimize t
+000010e0: 6865 2074 696d 650a 2020 2020 7370 656e  he time.    spen
+000010f0: 7420 696e 2074 6865 206a 6f69 6e74 2063  t in the joint c
+00001100: 6f6e 6669 6775 7261 7469 6f6e 2061 6e64  onfiguration and
+00001110: 2064 6f20 6e6f 7420 7374 6f72 6520 7468   do not store th
+00001120: 6520 6a6f 696e 7420 636f 6e66 6967 7572  e joint configur
+00001130: 6174 696f 6e0a 2020 2020 696e 2074 6865  ation.    in the
+00001140: 2073 7461 7465 206d 6163 6869 6e65 2028   state machine (
+00001150: 6f75 7473 6964 6520 6f66 2049 6e69 7469  outside of Initi
+00001160: 616c 5374 6174 6529 2e0a 2020 2020 2222  alState)..    ""
+00001170: 220a 2020 2020 496d 706c 6963 6974 3a20  ".    Implicit: 
+00001180: 4669 6e61 6c5b 416e 795d 0a0a 2020 2020  Final[Any]..    
+00001190: 2222 220a 2020 2020 5573 6520 6a6f 696e  """.    Use join
+000011a0: 7420 636f 6e73 656e 7375 7320 616e 6420  t consensus and 
+000011b0: 7265 6d61 696e 2069 6e20 7468 6520 6a6f  remain in the jo
+000011c0: 696e 7420 636f 6e66 6967 7572 6174 696f  int configuratio
+000011d0: 6e20 756e 7469 6c20 7468 650a 2020 2020  n until the.    
+000011e0: 6170 706c 6963 6174 696f 6e20 7072 6f70  application prop
+000011f0: 6f73 6573 2061 206e 6f2d 6f70 2063 6f6e  oses a no-op con
+00001200: 6669 6775 7261 7469 6f6e 2063 6861 6e67  figuration chang
+00001210: 652e 2054 6869 7320 6973 2073 7569 7461  e. This is suita
+00001220: 626c 6520 666f 720a 2020 2020 6170 706c  ble for.    appl
+00001230: 6963 6174 696f 6e73 2074 6861 7420 7761  ications that wa
+00001240: 6e74 2074 6f20 6578 706c 6963 6974 6c79  nt to explicitly
+00001250: 2063 6f6e 7472 6f6c 2074 6865 2074 7261   control the tra
+00001260: 6e73 6974 696f 6e73 2c20 666f 7220 6578  nsitions, for ex
+00001270: 616d 706c 650a 2020 2020 746f 2075 7365  ample.    to use
+00001280: 2061 2063 7573 746f 6d20 7061 796c 6f61   a custom payloa
+00001290: 6420 2876 6961 2074 6865 2043 6f6e 7465  d (via the Conte
+000012a0: 7874 2066 6965 6c64 292e 0a20 2020 2022  xt field)..    "
+000012b0: 2222 0a20 2020 2045 7870 6c69 6369 743a  "".    Explicit:
+000012c0: 2046 696e 616c 5b41 6e79 5d0a 2020 2020   Final[Any].    
+000012d0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+000012e0: 2020 6465 6620 6672 6f6d 5f69 6e74 2876    def from_int(v
+000012f0: 3a20 696e 7429 202d 3e20 2243 6f6e 6643  : int) -> "ConfC
+00001300: 6861 6e67 6554 7261 6e73 6974 696f 6e22  hangeTransition"
+00001310: 3a20 2e2e 2e0a 0a63 6c61 7373 2043 6f6e  : .....class Con
+00001320: 6643 6861 6e67 6554 7970 653a 0a20 2020  fChangeType:.   
+00001330: 2022 2222 2022 2222 0a0a 2020 2020 4164   """ """..    Ad
+00001340: 644e 6f64 653a 2046 696e 616c 5b41 6e79  dNode: Final[Any
+00001350: 5d0a 2020 2020 4164 644c 6561 726e 6572  ].    AddLearner
+00001360: 4e6f 6465 3a20 4669 6e61 6c5b 416e 795d  Node: Final[Any]
+00001370: 0a20 2020 2052 656d 6f76 654e 6f64 653a  .    RemoveNode:
+00001380: 2046 696e 616c 5b41 6e79 5d0a 2020 2020   Final[Any].    
+00001390: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+000013a0: 2020 6465 6620 6672 6f6d 5f69 6e74 2876    def from_int(v
+000013b0: 3a20 696e 7429 202d 3e20 2243 6f6e 6643  : int) -> "ConfC
+000013c0: 6861 6e67 6554 7970 6522 3a20 2e2e 2e0a  hangeType": ....
+000013d0: 0a63 6c61 7373 2045 6e74 7279 5479 7065  .class EntryType
+000013e0: 3a0a 2020 2020 2222 2220 2222 220a 0a20  :.    """ """.. 
+000013f0: 2020 2045 6e74 7279 436f 6e66 4368 616e     EntryConfChan
+00001400: 6765 3a20 4669 6e61 6c5b 416e 795d 0a20  ge: Final[Any]. 
+00001410: 2020 2045 6e74 7279 436f 6e66 4368 616e     EntryConfChan
+00001420: 6765 5632 3a20 4669 6e61 6c5b 416e 795d  geV2: Final[Any]
+00001430: 0a20 2020 2045 6e74 7279 4e6f 726d 616c  .    EntryNormal
+00001440: 3a20 4669 6e61 6c5b 416e 795d 0a20 2020  : Final[Any].   
+00001450: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00001460: 2020 2064 6566 2066 726f 6d5f 696e 7428     def from_int(
+00001470: 763a 2069 6e74 2920 2d3e 2022 456e 7472  v: int) -> "Entr
+00001480: 7954 7970 6522 3a20 2e2e 2e0a 0a63 6c61  yType": .....cla
+00001490: 7373 205f 5f41 5049 5f4c 6f67 6765 723a  ss __API_Logger:
+000014a0: 0a20 2020 2064 6566 2069 6e66 6f28 7365  .    def info(se
+000014b0: 6c66 2c20 733a 2073 7472 2920 2d3e 204e  lf, s: str) -> N
+000014c0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000014d0: 0a20 2020 2020 2020 204c 6f67 2069 6e66  .        Log inf
+000014e0: 6f20 6c65 7665 6c20 7265 636f 7264 0a0a  o level record..
+000014f0: 2020 2020 2020 2020 5365 6520 6073 6c6f          See `slo
+00001500: 675f 6c6f 6760 2066 6f72 2064 6f63 756d  g_log` for docum
+00001510: 656e 7461 7469 6f6e 2e0a 2020 2020 2020  entation..      
+00001520: 2020 2222 220a 2020 2020 6465 6620 6465    """.    def de
+00001530: 6275 6728 7365 6c66 2c20 733a 2073 7472  bug(self, s: str
+00001540: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00001550: 2020 2022 2222 0a20 2020 2020 2020 204c     """.        L
+00001560: 6f67 2064 6562 7567 206c 6576 656c 2072  og debug level r
+00001570: 6563 6f72 640a 0a20 2020 2020 2020 2053  ecord..        S
+00001580: 6565 2060 6c6f 6760 2066 6f72 2064 6f63  ee `log` for doc
+00001590: 756d 656e 7461 7469 6f6e 2e0a 2020 2020  umentation..    
+000015a0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+000015b0: 7472 6163 6528 7365 6c66 2c20 733a 2073  trace(self, s: s
+000015c0: 7472 2920 2d3e 204e 6f6e 653a 0a20 2020  tr) -> None:.   
+000015d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000015e0: 204c 6f67 2074 7261 6365 206c 6576 656c   Log trace level
+000015f0: 2072 6563 6f72 640a 0a20 2020 2020 2020   record..       
+00001600: 2053 6565 2060 6c6f 6760 2066 6f72 2064   See `log` for d
+00001610: 6f63 756d 656e 7461 7469 6f6e 2e0a 2020  ocumentation..  
+00001620: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00001630: 6620 6372 6974 2873 656c 662c 2073 3a20  f crit(self, s: 
+00001640: 7374 7229 202d 3e20 4e6f 6e65 3a0a 2020  str) -> None:.  
+00001650: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00001660: 2020 4c6f 6720 6372 6974 206c 6576 656c    Log crit level
+00001670: 2072 6563 6f72 640a 0a20 2020 2020 2020   record..       
+00001680: 2053 6565 2060 6c6f 6760 2066 6f72 2064   See `log` for d
+00001690: 6f63 756d 656e 7461 7469 6f6e 2e0a 2020  ocumentation..  
+000016a0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+000016b0: 6620 6572 726f 7228 7365 6c66 2c20 733a  f error(self, s:
+000016c0: 2073 7472 2920 2d3e 204e 6f6e 653a 0a20   str) -> None:. 
+000016d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000016e0: 2020 204c 6f67 2065 7272 6f72 206c 6576     Log error lev
+000016f0: 656c 2072 6563 6f72 640a 0a20 2020 2020  el record..     
+00001700: 2020 2053 6565 2060 6c6f 6760 2066 6f72     See `log` for
+00001710: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+00001720: 2020 2020 2020 2020 2222 220a 0a63 6c61          """..cla
+00001730: 7373 204c 6f67 6765 7228 5f5f 4150 495f  ss Logger(__API_
+00001740: 4c6f 6767 6572 293a 0a20 2020 2022 2222  Logger):.    """
+00001750: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00001760: 696e 6974 5f5f 280a 2020 2020 2020 2020  init__(.        
+00001770: 7365 6c66 2c20 6368 616e 5f73 697a 653a  self, chan_size:
+00001780: 2069 6e74 2c20 6f76 6572 666c 6f77 5f73   int, overflow_s
+00001790: 7472 6174 6567 793a 2022 4f76 6572 666c  trategy: "Overfl
+000017a0: 6f77 5374 7261 7465 6779 220a 2020 2020  owStrategy".    
+000017b0: 2920 2d3e 204e 6f6e 653a 202e 2e2e 0a20  ) -> None: .... 
+000017c0: 2020 2064 6566 206d 616b 655f 7265 6628     def make_ref(
+000017d0: 7365 6c66 2920 2d3e 2022 4c6f 6767 6572  self) -> "Logger
+000017e0: 5265 6622 3a20 2e2e 2e0a 0a63 6c61 7373  Ref": .....class
+000017f0: 204c 6f67 6765 7252 6566 285f 5f41 5049   LoggerRef(__API
+00001800: 5f4c 6f67 6765 7229 3a0a 2020 2020 2222  _Logger):.    ""
+00001810: 2220 2222 220a 0a63 6c61 7373 205f 5f41  " """..class __A
+00001820: 5049 5f52 6166 7453 7461 7465 285f 5f43  PI_RaftState(__C
+00001830: 6c6f 6e65 6162 6c65 293a 0a20 2020 2064  loneable):.    d
+00001840: 6566 2063 6c6f 6e65 2873 656c 6629 202d  ef clone(self) -
+00001850: 3e20 2252 6166 7453 7461 7465 223a 202e  > "RaftState": .
+00001860: 2e2e 0a20 2020 2064 6566 2069 6e69 7469  ...    def initi
+00001870: 616c 697a 6564 2873 656c 6629 202d 3e20  alized(self) -> 
+00001880: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+00001890: 220a 2020 2020 2020 2020 496e 6469 6361  ".        Indica
+000018a0: 7465 7320 7468 6520 6052 6166 7453 7461  tes the `RaftSta
+000018b0: 7465 6020 6973 2069 6e69 7469 616c 697a  te` is initializ
+000018c0: 6564 206f 7220 6e6f 742e 0a20 2020 2020  ed or not..     
+000018d0: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
+000018e0: 6574 5f63 6f6e 665f 7374 6174 6528 7365  et_conf_state(se
+000018f0: 6c66 2920 2d3e 2022 436f 6e66 5374 6174  lf) -> "ConfStat
+00001900: 6552 6566 223a 0a20 2020 2020 2020 2022  eRef":.        "
+00001910: 2222 0a20 2020 2020 2020 2060 636f 6e66  "".        `conf
+00001920: 5f73 7461 7465 603a 2052 6563 6f72 6473  _state`: Records
+00001930: 2074 6865 2063 7572 7265 6e74 206e 6f64   the current nod
+00001940: 6520 4944 7320 6c69 6b65 2060 5b31 2c20  e IDs like `[1, 
+00001950: 322c 2033 5d60 2069 6e20 7468 6520 636c  2, 3]` in the cl
+00001960: 7573 7465 722e 2045 7665 7279 2052 6166  uster. Every Raf
+00001970: 7420 6e6f 6465 206d 7573 7420 6861 7665  t node must have
+00001980: 2061 0a20 2020 2020 2020 2075 6e69 7175   a.        uniqu
+00001990: 6520 4944 2069 6e20 7468 6520 636c 7573  e ID in the clus
+000019a0: 7465 723b 0a20 2020 2020 2020 2022 2222  ter;.        """
+000019b0: 0a20 2020 2064 6566 2073 6574 5f63 6f6e  .    def set_con
+000019c0: 665f 7374 6174 6528 7365 6c66 2c20 6373  f_state(self, cs
+000019d0: 3a20 2243 6f6e 6653 7461 7465 5265 6622  : "ConfStateRef"
+000019e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000019f0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00001a00: 636f 6e66 5f73 7461 7465 603a 2052 6563  conf_state`: Rec
+00001a10: 6f72 6473 2074 6865 2063 7572 7265 6e74  ords the current
+00001a20: 206e 6f64 6520 4944 7320 6c69 6b65 2060   node IDs like `
+00001a30: 5b31 2c20 322c 2033 5d60 2069 6e20 7468  [1, 2, 3]` in th
+00001a40: 6520 636c 7573 7465 722e 2045 7665 7279  e cluster. Every
+00001a50: 2052 6166 7420 6e6f 6465 206d 7573 7420   Raft node must 
+00001a60: 6861 7665 2061 0a20 2020 2020 2020 2075  have a.        u
+00001a70: 6e69 7175 6520 4944 2069 6e20 7468 6520  nique ID in the 
+00001a80: 636c 7573 7465 723b 0a20 2020 2020 2020  cluster;.       
+00001a90: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
+00001aa0: 5f68 6172 645f 7374 6174 6528 7365 6c66  _hard_state(self
+00001ab0: 2920 2d3e 2022 4861 7264 5374 6174 6552  ) -> "HardStateR
+00001ac0: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+00001ad0: 0a20 2020 2020 2020 2060 6861 7264 5f73  .        `hard_s
+00001ae0: 7461 7465 603a 2043 6f6e 7461 696e 7320  tate`: Contains 
+00001af0: 7468 6520 6c61 7374 206d 6574 6120 696e  the last meta in
+00001b00: 666f 726d 6174 696f 6e20 696e 636c 7564  formation includ
+00001b10: 696e 6720 636f 6d6d 6974 2069 6e64 6578  ing commit index
+00001b20: 2c20 7468 6520 766f 7465 206c 6561 6465  , the vote leade
+00001b30: 722c 2061 6e64 2074 6865 2076 6f74 6520  r, and the vote 
+00001b40: 7465 726d 2e0a 2020 2020 2020 2020 2222  term..        ""
+00001b50: 220a 2020 2020 6465 6620 7365 745f 6861  ".    def set_ha
+00001b60: 7264 5f73 7461 7465 2873 656c 662c 2068  rd_state(self, h
+00001b70: 733a 2022 4861 7264 5374 6174 6552 6566  s: "HardStateRef
+00001b80: 2229 202d 3e20 4e6f 6e65 3a0a 2020 2020  ") -> None:.    
+00001b90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001ba0: 6068 6172 645f 7374 6174 6560 3a20 436f  `hard_state`: Co
+00001bb0: 6e74 6169 6e73 2074 6865 206c 6173 7420  ntains the last 
+00001bc0: 6d65 7461 2069 6e66 6f72 6d61 7469 6f6e  meta information
+00001bd0: 2069 6e63 6c75 6469 6e67 2063 6f6d 6d69   including commi
+00001be0: 7420 696e 6465 782c 2074 6865 2076 6f74  t index, the vot
+00001bf0: 6520 6c65 6164 6572 2c20 616e 6420 7468  e leader, and th
+00001c00: 6520 766f 7465 2074 6572 6d2e 0a20 2020  e vote term..   
+00001c10: 2020 2020 2022 2222 0a0a 636c 6173 7320       """..class 
+00001c20: 5261 6674 5374 6174 6528 5f5f 4150 495f  RaftState(__API_
+00001c30: 5261 6674 5374 6174 6529 3a0a 2020 2020  RaftState):.    
+00001c40: 2222 220a 2020 2020 486f 6c64 7320 626f  """.    Holds bo
+00001c50: 7468 2074 6865 2068 6172 6420 7374 6174  th the hard stat
+00001c60: 6520 2863 6f6d 6d69 7420 696e 6465 782c  e (commit index,
+00001c70: 2076 6f74 6520 6c65 6164 6572 2c20 7465   vote leader, te
+00001c80: 726d 2920 616e 6420 7468 6520 636f 6e66  rm) and the conf
+00001c90: 6967 7572 6174 696f 6e20 7374 6174 650a  iguration state.
+00001ca0: 2020 2020 2843 7572 7265 6e74 206e 6f64      (Current nod
+00001cb0: 6520 4944 7329 0a20 2020 2022 2222 0a0a  e IDs).    """..
+00001cc0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00001cd0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a20  (self) -> None: 
+00001ce0: 2e2e 2e0a 2020 2020 6465 6620 6d61 6b65  ....    def make
+00001cf0: 5f72 6566 2873 656c 6629 202d 3e20 2252  _ref(self) -> "R
+00001d00: 6166 7453 7461 7465 5265 6622 3a20 2e2e  aftStateRef": ..
+00001d10: 2e0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+00001d20: 686f 640a 2020 2020 6465 6620 6465 6661  hod.    def defa
+00001d30: 756c 7428 2920 2d3e 2022 5261 6674 5374  ult() -> "RaftSt
+00001d40: 6174 6522 3a20 2e2e 2e0a 0a63 6c61 7373  ate": .....class
+00001d50: 2052 6166 7453 7461 7465 5265 6628 5f5f   RaftStateRef(__
+00001d60: 4150 495f 5261 6674 5374 6174 6529 3a0a  API_RaftState):.
+00001d70: 2020 2020 2222 220a 2020 2020 5265 6665      """.    Refe
+00001d80: 7265 6e63 6520 7479 7065 206f 6620 3a63  rence type of :c
+00001d90: 6c61 7373 3a60 5261 6674 5374 6174 6560  lass:`RaftState`
+00001da0: 2e0a 2020 2020 2222 220a 0a63 6c61 7373  ..    """..class
+00001db0: 205f 5f41 5049 5f53 746f 7261 6765 436f   __API_StorageCo
+00001dc0: 7265 3a0a 2020 2020 6465 6620 6170 7065  re:.    def appe
+00001dd0: 6e64 2873 656c 662c 2065 6e74 733a 204c  nd(self, ents: L
+00001de0: 6973 745b 2245 6e74 7279 225d 207c 204c  ist["Entry"] | L
+00001df0: 6973 745b 2245 6e74 7279 5265 6622 5d29  ist["EntryRef"])
+00001e00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00001e10: 2020 2222 220a 2020 2020 2020 2020 4170    """.        Ap
+00001e20: 7065 6e64 2074 6865 206e 6577 2065 6e74  pend the new ent
+00001e30: 7269 6573 2074 6f20 7374 6f72 6167 652e  ries to storage.
+00001e40: 0a0a 2020 2020 2020 2020 2320 5061 6e69  ..        # Pani
+00001e50: 6373 0a0a 2020 2020 2020 2020 5061 6e69  cs..        Pani
+00001e60: 6373 2069 6620 6065 6e74 7360 2063 6f6e  cs if `ents` con
+00001e70: 7461 696e 7320 636f 6d70 6163 7465 6420  tains compacted 
+00001e80: 656e 7472 6965 732c 206f 7220 7468 6572  entries, or ther
+00001e90: 6527 7320 6120 6761 7020 6265 7477 6565  e's a gap betwee
+00001ea0: 6e20 6065 6e74 7360 2061 6e64 2074 6865  n `ents` and the
+00001eb0: 206c 6173 740a 2020 2020 2020 2020 7265   last.        re
+00001ec0: 6365 6976 6564 2065 6e74 7279 2069 6e20  ceived entry in 
+00001ed0: 7468 6520 7374 6f72 6167 652e 0a20 2020  the storage..   
+00001ee0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00001ef0: 2061 7070 6c79 5f73 6e61 7073 686f 7428   apply_snapshot(
+00001f00: 7365 6c66 2c20 736e 6170 7368 6f74 3a20  self, snapshot: 
+00001f10: 2253 6e61 7073 686f 7422 207c 2022 536e  "Snapshot" | "Sn
+00001f20: 6170 7368 6f74 5265 6622 2920 2d3e 204e  apshotRef") -> N
+00001f30: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00001f40: 0a20 2020 2020 2020 204f 7665 7277 7269  .        Overwri
+00001f50: 7465 7320 7468 6520 636f 6e74 656e 7473  tes the contents
+00001f60: 206f 6620 7468 6973 2053 746f 7261 6765   of this Storage
+00001f70: 206f 626a 6563 7420 7769 7468 2074 686f   object with tho
+00001f80: 7365 206f 6620 7468 6520 6769 7665 6e20  se of the given 
+00001f90: 736e 6170 7368 6f74 2e0a 0a20 2020 2020  snapshot...     
+00001fa0: 2020 2023 2050 616e 6963 730a 0a20 2020     # Panics..   
+00001fb0: 2020 2020 2050 616e 6963 7320 6966 2074       Panics if t
+00001fc0: 6865 2073 6e61 7073 686f 7420 696e 6465  he snapshot inde
+00001fd0: 7820 6973 206c 6573 7320 7468 616e 2074  x is less than t
+00001fe0: 6865 2073 746f 7261 6765 2773 2066 6972  he storage's fir
+00001ff0: 7374 2069 6e64 6578 2e0a 2020 2020 2020  st index..      
+00002000: 2020 2222 220a 2020 2020 6465 6620 636f    """.    def co
+00002010: 6d70 6163 7428 7365 6c66 2c20 636f 6d70  mpact(self, comp
+00002020: 6163 745f 696e 6465 783a 2069 6e74 2920  act_index: int) 
+00002030: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00002040: 2022 2222 0a20 2020 2020 2020 2044 6973   """.        Dis
+00002050: 6361 7264 7320 616c 6c20 6c6f 6720 656e  cards all log en
+00002060: 7472 6965 7320 7072 696f 7220 746f 2063  tries prior to c
+00002070: 6f6d 7061 6374 5f69 6e64 6578 2e0a 2020  ompact_index..  
+00002080: 2020 2020 2020 4974 2069 7320 7468 6520        It is the 
+00002090: 6170 706c 6963 6174 696f 6e27 7320 7265  application's re
+000020a0: 7370 6f6e 7369 6269 6c69 7479 2074 6f20  sponsibility to 
+000020b0: 6e6f 7420 6174 7465 6d70 7420 746f 2063  not attempt to c
+000020c0: 6f6d 7061 6374 2061 6e20 696e 6465 780a  ompact an index.
+000020d0: 2020 2020 2020 2020 6772 6561 7465 7220          greater 
+000020e0: 7468 616e 2052 6166 744c 6f67 2e61 7070  than RaftLog.app
+000020f0: 6c69 6564 2e0a 0a20 2020 2020 2020 2023  lied...        #
+00002100: 2050 616e 6963 730a 0a20 2020 2020 2020   Panics..       
+00002110: 2050 616e 6963 7320 6966 2060 636f 6d70   Panics if `comp
+00002120: 6163 745f 696e 6465 7860 2069 7320 6869  act_index` is hi
+00002130: 6768 6572 2074 6861 6e20 6053 746f 7261  gher than `Stora
+00002140: 6765 3a3a 6c61 7374 5f69 6e64 6578 2826  ge::last_index(&
+00002150: 7365 6c66 2920 2b20 3160 2e0a 2020 2020  self) + 1`..    
+00002160: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00002170: 636f 6d6d 6974 5f74 6f28 7365 6c66 2c20  commit_to(self, 
+00002180: 696e 6465 783a 2069 6e74 2920 2d3e 204e  index: int) -> N
+00002190: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000021a0: 0a20 2020 2020 2020 2043 6f6d 6d69 7420  .        Commit 
+000021b0: 746f 2061 6e20 696e 6465 782e 0a0a 2020  to an index...  
+000021c0: 2020 2020 2020 2320 5061 6e69 6373 0a0a        # Panics..
+000021d0: 2020 2020 2020 2020 5061 6e69 6373 2069          Panics i
+000021e0: 6620 7468 6572 6520 6973 206e 6f20 7375  f there is no su
+000021f0: 6368 2065 6e74 7279 2069 6e20 7261 6674  ch entry in raft
+00002200: 206c 6f67 732e 0a20 2020 2020 2020 2022   logs..        "
+00002210: 2222 0a20 2020 2064 6566 2063 6f6d 6d69  "".    def commi
+00002220: 745f 746f 5f61 6e64 5f73 6574 5f63 6f6e  t_to_and_set_con
+00002230: 665f 7374 6174 6573 280a 2020 2020 2020  f_states(.      
+00002240: 2020 7365 6c66 2c20 6964 783a 2069 6e74    self, idx: int
+00002250: 2c20 6373 3a20 4f70 7469 6f6e 616c 5b22  , cs: Optional["
+00002260: 436f 6e66 5374 6174 6522 5d20 7c20 4f70  ConfState"] | Op
+00002270: 7469 6f6e 616c 5b22 436f 6e66 5374 6174  tional["ConfStat
+00002280: 6552 6566 225d 0a20 2020 2029 202d 3e20  eRef"].    ) -> 
+00002290: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000022a0: 220a 2020 2020 2020 2020 436f 6d6d 6974  ".        Commit
+000022b0: 2074 6f20 6069 6478 6020 616e 6420 7365   to `idx` and se
+000022c0: 7420 636f 6e66 6967 7572 6174 696f 6e20  t configuration 
+000022d0: 746f 2074 6865 2067 6976 656e 2073 7461  to the given sta
+000022e0: 7465 732e 204f 6e6c 7920 7573 6564 2066  tes. Only used f
+000022f0: 6f72 2074 6573 7473 2e0a 2020 2020 2020  or tests..      
+00002300: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+00002310: 745f 636f 6e66 5f73 7461 7465 2873 656c  t_conf_state(sel
+00002320: 662c 2063 733a 2022 436f 6e66 5374 6174  f, cs: "ConfStat
+00002330: 6522 207c 2022 436f 6e66 5374 6174 6552  e" | "ConfStateR
+00002340: 6566 2229 202d 3e20 4e6f 6e65 3a0a 2020  ef") -> None:.  
+00002350: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00002360: 2020 5361 7665 7320 7468 6520 6375 7272    Saves the curr
+00002370: 656e 7420 636f 6e66 2073 7461 7465 2e0a  ent conf state..
+00002380: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00002390: 6465 6620 6861 7264 5f73 7461 7465 2873  def hard_state(s
+000023a0: 656c 6629 202d 3e20 2248 6172 6453 7461  elf) -> "HardSta
+000023b0: 7465 5265 6622 3a0a 2020 2020 2020 2020  teRef":.        
+000023c0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+000023d0: 7468 6520 6861 7264 2073 7461 7465 2e0a  the hard state..
+000023e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000023f0: 6465 6620 7365 745f 6861 7264 7374 6174  def set_hardstat
+00002400: 6528 7365 6c66 2c20 6873 3a20 2248 6172  e(self, hs: "Har
+00002410: 6453 7461 7465 2220 7c20 2248 6172 6453  dState" | "HardS
+00002420: 7461 7465 5265 6622 2920 2d3e 204e 6f6e  tateRef") -> Non
+00002430: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00002440: 2020 2020 2020 2053 6176 6573 2074 6865         Saves the
+00002450: 2063 7572 7265 6e74 2048 6172 6453 7461   current HardSta
+00002460: 7465 2e0a 2020 2020 2020 2020 2222 220a  te..        """.
+00002470: 2020 2020 6465 6620 7472 6967 6765 725f      def trigger_
+00002480: 736e 6170 5f75 6e61 7661 696c 6162 6c65  snap_unavailable
+00002490: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000024a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000024b0: 2020 2020 5472 6967 6765 7220 6120 536e      Trigger a Sn
+000024c0: 6170 7368 6f74 5465 6d70 6f72 6172 696c  apshotTemporaril
+000024d0: 7955 6e61 7661 696c 6162 6c65 2065 7272  yUnavailable err
+000024e0: 6f72 2e0a 2020 2020 2020 2020 2222 220a  or..        """.
+000024f0: 2020 2020 6465 6620 7472 6967 6765 725f      def trigger_
+00002500: 6c6f 675f 756e 6176 6169 6c61 626c 6528  log_unavailable(
+00002510: 7365 6c66 2c20 763a 2062 6f6f 6c29 202d  self, v: bool) -
+00002520: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00002530: 2222 220a 2020 2020 2020 2020 5365 7420  """.        Set 
+00002540: 6120 4c6f 6754 656d 706f 7261 7269 6c79  a LogTemporarily
+00002550: 556e 6176 6169 6c61 626c 6520 6572 726f  Unavailable erro
+00002560: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
+00002570: 2020 2064 6566 2074 616b 655f 6765 745f     def take_get_
+00002580: 656e 7472 6965 735f 636f 6e74 6578 7428  entries_context(
+00002590: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
+000025a0: 6c5b 2247 6574 456e 7472 6965 7343 6f6e  l["GetEntriesCon
+000025b0: 7465 7874 225d 3a0a 2020 2020 2020 2020  text"]:.        
+000025c0: 2222 220a 2020 2020 2020 2020 5461 6b65  """.        Take
+000025d0: 2067 6574 2065 6e74 7269 6573 2063 6f6e   get entries con
+000025e0: 7465 7874 2e0a 2020 2020 2020 2020 2222  text..        ""
+000025f0: 220a 0a63 6c61 7373 204d 656d 5374 6f72  "..class MemStor
+00002600: 6167 6543 6f72 6528 5f5f 4150 495f 5374  ageCore(__API_St
+00002610: 6f72 6167 6543 6f72 6529 3a0a 2020 2020  orageCore):.    
+00002620: 2222 220a 2020 2020 5468 6520 4d65 6d6f  """.    The Memo
+00002630: 7279 2053 746f 7261 6765 2043 6f72 6520  ry Storage Core 
+00002640: 696e 7374 616e 6365 2068 6f6c 6473 2074  instance holds t
+00002650: 6865 2061 6374 7561 6c20 7374 6174 6520  he actual state 
+00002660: 6f66 2074 6865 2073 746f 7261 6765 2073  of the storage s
+00002670: 7472 7563 742e 2054 6f20 6163 6365 7373  truct. To access
+00002680: 2074 6869 730a 2020 2020 7661 6c75 652c   this.    value,
+00002690: 2075 7365 2074 6865 2060 726c 6020 616e   use the `rl` an
+000026a0: 6420 6077 6c60 2066 756e 6374 696f 6e73  d `wl` functions
+000026b0: 206f 6e20 7468 6520 6d61 696e 204d 656d   on the main Mem
+000026c0: 5374 6f72 6167 6520 696d 706c 656d 656e  Storage implemen
+000026d0: 7461 7469 6f6e 2e0a 2020 2020 2222 220a  tation..    """.
+000026e0: 0a20 2020 2064 6566 206d 616b 655f 7265  .    def make_re
+000026f0: 6628 7365 6c66 2920 2d3e 2022 4d65 6d53  f(self) -> "MemS
+00002700: 746f 7261 6765 436f 7265 5265 6622 3a20  torageCoreRef": 
+00002710: 2e2e 2e0a 2020 2020 4073 7461 7469 636d  ....    @staticm
+00002720: 6574 686f 640a 2020 2020 6465 6620 6465  ethod.    def de
+00002730: 6661 756c 7428 2920 2d3e 2022 4d65 6d53  fault() -> "MemS
+00002740: 746f 7261 6765 436f 7265 223a 202e 2e2e  torageCore": ...
+00002750: 0a0a 636c 6173 7320 4d65 6d53 746f 7261  ..class MemStora
+00002760: 6765 436f 7265 5265 6628 5f5f 4150 495f  geCoreRef(__API_
+00002770: 5374 6f72 6167 6543 6f72 6529 3a0a 2020  StorageCore):.  
+00002780: 2020 2222 220a 2020 2020 5265 6665 7265    """.    Refere
+00002790: 6e63 6520 7479 7065 206f 6620 3a63 6c61  nce type of :cla
+000027a0: 7373 3a60 4d65 6d53 746f 7261 6765 602e  ss:`MemStorage`.
+000027b0: 0a20 2020 2022 2222 0a0a 636c 6173 7320  .    """..class 
+000027c0: 5374 6f72 6167 6543 6f72 6528 5f5f 4150  StorageCore(__AP
+000027d0: 495f 5374 6f72 6167 6543 6f72 6529 3a0a  I_StorageCore):.
+000027e0: 2020 2020 2222 2220 2222 220a 0a20 2020      """ """..   
+000027f0: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
+00002800: 6c66 2920 2d3e 2022 5374 6f72 6167 6543  lf) -> "StorageC
+00002810: 6f72 6552 6566 223a 202e 2e2e 0a20 2020  oreRef": ....   
+00002820: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00002830: 2020 2064 6566 2064 6566 6175 6c74 2829     def default()
+00002840: 202d 3e20 2253 746f 7261 6765 436f 7265   -> "StorageCore
+00002850: 223a 202e 2e2e 0a0a 636c 6173 7320 5374  ": .....class St
+00002860: 6f72 6167 6543 6f72 6552 6566 285f 5f41  orageCoreRef(__A
+00002870: 5049 5f53 746f 7261 6765 436f 7265 293a  PI_StorageCore):
+00002880: 0a20 2020 2022 2222 0a20 2020 2052 6566  .    """.    Ref
+00002890: 6572 656e 6365 2074 7970 6520 6f66 203a  erence type of :
+000028a0: 636c 6173 733a 6053 746f 7261 6765 436f  class:`StorageCo
+000028b0: 7265 602e 0a20 2020 2022 2222 0a0a 636c  re`..    """..cl
+000028c0: 6173 7320 5f5f 4150 495f 5374 6f72 6167  ass __API_Storag
+000028d0: 6528 5f5f 436c 6f6e 6561 626c 6529 3a0a  e(__Cloneable):.
+000028e0: 2020 2020 6465 6620 636c 6f6e 6528 7365      def clone(se
+000028f0: 6c66 2920 2d3e 2041 6e79 3a20 2e2e 2e0a  lf) -> Any: ....
+00002900: 2020 2020 6465 6620 696e 6974 6961 6c69      def initiali
+00002910: 7a65 5f77 6974 685f 636f 6e66 5f73 7461  ze_with_conf_sta
+00002920: 7465 280a 2020 2020 2020 2020 7365 6c66  te(.        self
+00002930: 2c20 636f 6e66 5f73 7461 7465 3a20 2243  , conf_state: "C
+00002940: 6f6e 6653 7461 7465 2220 7c20 2243 6f6e  onfState" | "Con
+00002950: 6653 7461 7465 5265 6622 0a20 2020 2029  fStateRef".    )
+00002960: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00002970: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
+00002980: 6974 6961 6c69 7a65 2061 2060 4d65 6d53  itialize a `MemS
+00002990: 746f 7261 6765 6020 7769 7468 2061 2067  torage` with a g
+000029a0: 6976 656e 2060 436f 6e66 6967 602e 0a0a  iven `Config`...
+000029b0: 2020 2020 2020 2020 596f 7520 7368 6f75          You shou
+000029c0: 6c64 2075 7365 2074 6865 2073 616d 6520  ld use the same 
+000029d0: 696e 7075 7420 746f 2069 6e69 7469 616c  input to initial
+000029e0: 697a 6520 616c 6c20 6e6f 6465 732e 0a20  ize all nodes.. 
+000029f0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00002a00: 6566 2069 6e69 7469 616c 5f73 7461 7465  ef initial_state
+00002a10: 2873 656c 6629 202d 3e20 5261 6674 5374  (self) -> RaftSt
+00002a20: 6174 653a 0a20 2020 2020 2020 2022 2222  ate:.        """
+00002a30: 0a20 2020 2020 2020 2049 6d70 6c65 6d65  .        Impleme
+00002a40: 6e74 7320 7468 6520 5374 6f72 6167 6520  nts the Storage 
+00002a50: 7472 6169 742e 0a20 2020 2020 2020 2022  trait..        "
+00002a60: 2222 0a20 2020 2064 6566 2065 6e74 7269  "".    def entri
+00002a70: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
+00002a80: 2c0a 2020 2020 2020 2020 6c6f 773a 2069  ,.        low: i
+00002a90: 6e74 2c0a 2020 2020 2020 2020 6869 6768  nt,.        high
+00002aa0: 3a20 696e 742c 0a20 2020 2020 2020 2063  : int,.        c
+00002ab0: 6f6e 7465 7874 3a20 2247 6574 456e 7472  ontext: "GetEntr
+00002ac0: 6965 7343 6f6e 7465 7874 5265 6622 2c0a  iesContextRef",.
+00002ad0: 2020 2020 2020 2020 6d61 785f 7369 7a65          max_size
+00002ae0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d2c  : Optional[int],
+00002af0: 0a20 2020 2029 202d 3e20 4c69 7374 5b22  .    ) -> List["
+00002b00: 456e 7472 7922 5d3a 0a20 2020 2020 2020  Entry"]:.       
+00002b10: 2022 2222 0a20 2020 2020 2020 2049 6d70   """.        Imp
+00002b20: 6c65 6d65 6e74 7320 7468 6520 5374 6f72  lements the Stor
+00002b30: 6167 6520 7472 6169 742e 0a20 2020 2020  age trait..     
+00002b40: 2020 2022 2222 0a20 2020 2064 6566 2074     """.    def t
+00002b50: 6572 6d28 7365 6c66 2c20 6964 783a 2069  erm(self, idx: i
+00002b60: 6e74 2920 2d3e 2069 6e74 3a0a 2020 2020  nt) -> int:.    
+00002b70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00002b80: 496d 706c 656d 656e 7473 2074 6865 2053  Implements the S
+00002b90: 746f 7261 6765 2074 7261 6974 2e0a 2020  torage trait..  
+00002ba0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00002bb0: 6620 6669 7273 745f 696e 6465 7828 7365  f first_index(se
+00002bc0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+00002bd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00002be0: 496d 706c 656d 656e 7473 2074 6865 2053  Implements the S
+00002bf0: 746f 7261 6765 2074 7261 6974 2e0a 2020  torage trait..  
+00002c00: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00002c10: 6620 6c61 7374 5f69 6e64 6578 2873 656c  f last_index(sel
+00002c20: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00002c30: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
+00002c40: 6d70 6c65 6d65 6e74 7320 7468 6520 5374  mplements the St
+00002c50: 6f72 6167 6520 7472 6169 742e 0a20 2020  orage trait..   
+00002c60: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00002c70: 2073 6e61 7073 686f 7428 7365 6c66 2c20   snapshot(self, 
+00002c80: 7265 7175 6573 745f 696e 6465 783a 2069  request_index: i
+00002c90: 6e74 2c20 746f 3a20 696e 7429 202d 3e20  nt, to: int) -> 
+00002ca0: 2253 6e61 7073 686f 7422 3a0a 2020 2020  "Snapshot":.    
+00002cb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00002cc0: 496d 706c 656d 656e 7473 2074 6865 2053  Implements the S
+00002cd0: 746f 7261 6765 2074 7261 6974 2e0a 2020  torage trait..  
+00002ce0: 2020 2020 2020 2222 220a 0a63 6c61 7373        """..class
+00002cf0: 204d 656d 5374 6f72 6167 6528 5f5f 4150   MemStorage(__AP
+00002d00: 495f 5374 6f72 6167 6529 3a0a 2020 2020  I_Storage):.    
+00002d10: 2222 220a 2020 2020 604d 656d 5374 6f72  """.    `MemStor
+00002d20: 6167 6560 2069 7320 6120 7468 7265 6164  age` is a thread
+00002d30: 2d73 6166 6520 6275 7420 696e 636f 6d70  -safe but incomp
+00002d40: 6c65 7465 2069 6d70 6c65 6d65 6e74 6174  lete implementat
+00002d50: 696f 6e20 6f66 2060 5374 6f72 6167 6560  ion of `Storage`
+00002d60: 2c20 6d61 696e 6c79 2066 6f72 2074 6573  , mainly for tes
+00002d70: 7473 2e0a 0a20 2020 2041 2072 6561 6c20  ts...    A real 
+00002d80: 6053 746f 7261 6765 6020 7368 6f75 6c64  `Storage` should
+00002d90: 2073 6176 6520 626f 7468 2072 6166 7420   save both raft 
+00002da0: 6c6f 6773 2061 6e64 2061 7070 6c69 6564  logs and applied
+00002db0: 2064 6174 612e 2048 6f77 6576 6572 2060   data. However `
+00002dc0: 4d65 6d53 746f 7261 6765 6020 6f6e 6c79  MemStorage` only
+00002dd0: 0a20 2020 2063 6f6e 7461 696e 7320 7261  .    contains ra
+00002de0: 6674 206c 6f67 732e 2053 6f20 796f 7520  ft logs. So you 
+00002df0: 6361 6e20 6361 6c6c 2060 4d65 6d53 746f  can call `MemSto
+00002e00: 7261 6765 3a3a 6170 7065 6e64 6020 746f  rage::append` to
+00002e10: 2070 6572 7369 7374 206e 6577 2072 6563   persist new rec
+00002e20: 6569 7665 6420 756e 7374 6162 6c65 2072  eived unstable r
+00002e30: 6166 740a 2020 2020 6c6f 6773 2061 6e64  aft.    logs and
+00002e40: 2074 6865 6e20 6163 6365 7373 2074 6865   then access the
+00002e50: 6d20 7769 7468 2060 5374 6f72 6167 6560  m with `Storage`
+00002e60: 2041 5049 732e 2054 6865 206f 6e6c 7920   APIs. The only 
+00002e70: 6578 6365 7074 696f 6e20 6973 2060 5374  exception is `St
+00002e80: 6f72 6167 653a 3a73 6e61 7073 686f 7460  orage::snapshot`
+00002e90: 2e20 5468 6572 650a 2020 2020 6973 206e  . There.    is n
+00002ea0: 6f20 6461 7461 2069 6e20 6053 6e61 7073  o data in `Snaps
+00002eb0: 686f 7460 2072 6574 7572 6e65 6420 6279  hot` returned by
+00002ec0: 2060 4d65 6d53 746f 7261 6765 3a3a 736e   `MemStorage::sn
+00002ed0: 6170 7368 6f74 6020 6265 6361 7573 6520  apshot` because 
+00002ee0: 6170 706c 6965 6420 6461 7461 2069 7320  applied data is 
+00002ef0: 6e6f 7420 7374 6f72 6564 0a20 2020 2069  not stored.    i
+00002f00: 6e20 604d 656d 5374 6f72 6167 6560 2e0a  n `MemStorage`..
+00002f10: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00002f20: 205f 5f69 6e69 745f 5f28 7365 6c66 2920   __init__(self) 
+00002f30: 2d3e 204e 6f6e 653a 202e 2e2e 0a20 2020  -> None: ....   
+00002f40: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
+00002f50: 6c66 2920 2d3e 2022 4d65 6d53 746f 7261  lf) -> "MemStora
+00002f60: 6765 5265 6622 3a20 2e2e 2e0a 2020 2020  geRef": ....    
+00002f70: 6465 6620 636c 6f6e 6528 7365 6c66 2920  def clone(self) 
+00002f80: 2d3e 2022 4d65 6d53 746f 7261 6765 223a  -> "MemStorage":
+00002f90: 202e 2e2e 0a20 2020 2040 7374 6174 6963   ....    @static
+00002fa0: 6d65 7468 6f64 0a20 2020 2064 6566 2064  method.    def d
+00002fb0: 6566 6175 6c74 2829 202d 3e20 224d 656d  efault() -> "Mem
+00002fc0: 5374 6f72 6167 6522 3a20 2e2e 2e0a 2020  Storage": ....  
+00002fd0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00002fe0: 2020 2020 6465 6620 6e65 775f 7769 7468      def new_with
+00002ff0: 5f63 6f6e 665f 7374 6174 6528 0a20 2020  _conf_state(.   
+00003000: 2020 2020 2063 6f6e 665f 7374 6174 653a       conf_state:
+00003010: 2022 436f 6e66 5374 6174 6522 207c 2022   "ConfState" | "
+00003020: 436f 6e66 5374 6174 6552 6566 222c 0a20  ConfStateRef",. 
+00003030: 2020 2029 202d 3e20 224d 656d 5374 6f72     ) -> "MemStor
+00003040: 6167 6522 3a0a 2020 2020 2020 2020 2222  age":.        ""
+00003050: 220a 2020 2020 2020 2020 4372 6561 7465  ".        Create
+00003060: 2061 206e 6577 2060 4d65 6d53 746f 7261   a new `MemStora
+00003070: 6765 6020 7769 7468 2061 2067 6976 656e  ge` with a given
+00003080: 2060 436f 6e66 6967 602e 2054 6865 2067   `Config`. The g
+00003090: 6976 656e 2060 436f 6e66 6967 6020 7769  iven `Config` wi
+000030a0: 6c6c 2062 6520 7573 6564 2074 6f0a 2020  ll be used to.  
+000030b0: 2020 2020 2020 696e 6974 6961 6c69 7a65        initialize
+000030c0: 2074 6865 2073 746f 7261 6765 2e0a 0a20   the storage... 
+000030d0: 2020 2020 2020 2059 6f75 2073 686f 756c         You shoul
+000030e0: 6420 7573 6520 7468 6520 7361 6d65 2069  d use the same i
+000030f0: 6e70 7574 2074 6f20 696e 6974 6961 6c69  nput to initiali
+00003100: 7a65 2061 6c6c 206e 6f64 6573 2e0a 2020  ze all nodes..  
+00003110: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00003120: 6620 776c 2873 656c 6629 202d 3e20 224d  f wl(self) -> "M
+00003130: 656d 5374 6f72 6167 6543 6f72 6552 6566  emStorageCoreRef
+00003140: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
+00003150: 2020 2020 2020 204f 7065 6e73 2075 7020         Opens up 
+00003160: 6120 7772 6974 6520 6c6f 636b 206f 6e20  a write lock on 
+00003170: 7468 6520 7374 6f72 6167 6520 616e 6420  the storage and 
+00003180: 7265 7475 726e 7320 6775 6172 6420 6861  returns guard ha
+00003190: 6e64 6c65 2e20 5573 6520 7468 6973 0a20  ndle. Use this. 
+000031a0: 2020 2020 2020 2077 6974 6820 6675 6e63         with func
+000031b0: 7469 6f6e 7320 7468 6174 2074 616b 6520  tions that take 
+000031c0: 6120 6d75 7461 626c 6520 7265 6665 7265  a mutable refere
+000031d0: 6e63 6520 746f 2073 656c 662e 0a20 2020  nce to self..   
+000031e0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+000031f0: 2072 6c28 7365 6c66 2920 2d3e 2022 4d65   rl(self) -> "Me
+00003200: 6d53 746f 7261 6765 436f 7265 5265 6622  mStorageCoreRef"
+00003210: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00003220: 2020 2020 2020 4f70 656e 7320 7570 2061        Opens up a
+00003230: 2072 6561 6420 6c6f 636b 206f 6e20 7468   read lock on th
+00003240: 6520 7374 6f72 6167 6520 616e 6420 7265  e storage and re
+00003250: 7475 726e 7320 6120 6775 6172 6420 6861  turns a guard ha
+00003260: 6e64 6c65 2e20 5573 6520 7468 6973 0a20  ndle. Use this. 
+00003270: 2020 2020 2020 2077 6974 6820 6675 6e63         with func
+00003280: 7469 6f6e 7320 7468 6174 2064 6f6e 2774  tions that don't
+00003290: 2072 6571 7569 7265 206d 7574 6174 696f   require mutatio
+000032a0: 6e2e 0a20 2020 2020 2020 2022 2222 0a0a  n..        """..
+000032b0: 636c 6173 7320 4d65 6d53 746f 7261 6765  class MemStorage
+000032c0: 5265 6628 5f5f 4150 495f 5374 6f72 6167  Ref(__API_Storag
+000032d0: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+000032e0: 5265 6665 7265 6e63 6520 7479 7065 206f  Reference type o
+000032f0: 6620 3a63 6c61 7373 3a60 4d65 6d53 746f  f :class:`MemSto
+00003300: 7261 6765 602e 0a20 2020 2022 2222 0a0a  rage`..    """..
+00003310: 2020 2020 6465 6620 636c 6f6e 6528 7365      def clone(se
+00003320: 6c66 2920 2d3e 2022 4d65 6d53 746f 7261  lf) -> "MemStora
+00003330: 6765 223a 202e 2e2e 0a20 2020 2064 6566  ge": ....    def
+00003340: 2077 6c28 7365 6c66 2920 2d3e 2022 4d65   wl(self) -> "Me
+00003350: 6d53 746f 7261 6765 436f 7265 5265 6622  mStorageCoreRef"
+00003360: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00003370: 2020 2020 2020 4f70 656e 7320 7570 2061        Opens up a
+00003380: 2077 7269 7465 206c 6f63 6b20 6f6e 2074   write lock on t
+00003390: 6865 2073 746f 7261 6765 2061 6e64 2072  he storage and r
+000033a0: 6574 7572 6e73 2067 7561 7264 2068 616e  eturns guard han
+000033b0: 646c 652e 2055 7365 2074 6869 730a 2020  dle. Use this.  
+000033c0: 2020 2020 2020 7769 7468 2066 756e 6374        with funct
+000033d0: 696f 6e73 2074 6861 7420 7461 6b65 2061  ions that take a
+000033e0: 206d 7574 6162 6c65 2072 6566 6572 656e   mutable referen
+000033f0: 6365 2074 6f20 7365 6c66 2e0a 2020 2020  ce to self..    
+00003400: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00003410: 726c 2873 656c 6629 202d 3e20 224d 656d  rl(self) -> "Mem
+00003420: 5374 6f72 6167 6543 6f72 6552 6566 223a  StorageCoreRef":
+00003430: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003440: 2020 2020 204f 7065 6e73 2075 7020 6120       Opens up a 
+00003450: 7265 6164 206c 6f63 6b20 6f6e 2074 6865  read lock on the
+00003460: 2073 746f 7261 6765 2061 6e64 2072 6574   storage and ret
+00003470: 7572 6e73 2061 2067 7561 7264 2068 616e  urns a guard han
+00003480: 646c 652e 2055 7365 2074 6869 730a 2020  dle. Use this.  
+00003490: 2020 2020 2020 7769 7468 2066 756e 6374        with funct
+000034a0: 696f 6e73 2074 6861 7420 646f 6e27 7420  ions that don't 
+000034b0: 7265 7175 6972 6520 6d75 7461 7469 6f6e  require mutation
+000034c0: 2e0a 2020 2020 2020 2020 2222 220a 0a63  ..        """..c
+000034d0: 6c61 7373 2053 746f 7261 6765 285f 5f41  lass Storage(__A
+000034e0: 5049 5f53 746f 7261 6765 293a 0a20 2020  PI_Storage):.   
+000034f0: 2022 2222 0a20 2020 2053 746f 7261 6765   """.    Storage
+00003500: 2073 6176 6573 2061 6c6c 2074 6865 2069   saves all the i
+00003510: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+00003520: 2074 6865 2063 7572 7265 6e74 2052 6166   the current Raf
+00003530: 7420 696d 706c 656d 656e 7461 7469 6f6e  t implementation
+00003540: 2c20 696e 636c 7564 696e 6720 5261 6674  , including Raft
+00003550: 204c 6f67 2c0a 2020 2020 636f 6d6d 6974   Log,.    commit
+00003560: 2069 6e64 6578 2c20 7468 6520 6c65 6164   index, the lead
+00003570: 6572 2074 6f20 766f 7465 2066 6f72 2c20  er to vote for, 
+00003580: 6574 632e 0a0a 2020 2020 4966 2061 6e79  etc...    If any
+00003590: 2053 746f 7261 6765 206d 6574 686f 6420   Storage method 
+000035a0: 7265 7475 726e 7320 616e 2065 7272 6f72  returns an error
+000035b0: 2c20 7468 6520 7261 6674 2069 6e73 7461  , the raft insta
+000035c0: 6e63 6520 7769 6c6c 0a20 2020 2062 6563  nce will.    bec
+000035d0: 6f6d 6520 696e 6f70 6572 6162 6c65 2061  ome inoperable a
+000035e0: 6e64 2072 6566 7573 6520 746f 2070 6172  nd refuse to par
+000035f0: 7469 6369 7061 7465 2069 6e20 656c 6563  ticipate in elec
+00003600: 7469 6f6e 733b 2074 6865 0a20 2020 2061  tions; the.    a
+00003610: 7070 6c69 6361 7469 6f6e 2069 7320 7265  pplication is re
+00003620: 7370 6f6e 7369 626c 6520 666f 7220 636c  sponsible for cl
+00003630: 6561 6e75 7020 616e 6420 7265 636f 7665  eanup and recove
+00003640: 7279 2069 6e20 7468 6973 2063 6173 652e  ry in this case.
+00003650: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00003660: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+00003670: 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020   -> None: ....  
+00003680: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
+00003690: 656c 6629 202d 3e20 2253 746f 7261 6765  elf) -> "Storage
+000036a0: 5265 6622 3a20 2e2e 2e0a 2020 2020 6465  Ref": ....    de
+000036b0: 6620 636c 6f6e 6528 7365 6c66 2920 2d3e  f clone(self) ->
+000036c0: 2022 5374 6f72 6167 6522 3a20 2e2e 2e0a   "Storage": ....
+000036d0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+000036e0: 640a 2020 2020 6465 6620 6465 6661 756c  d.    def defaul
+000036f0: 7428 2920 2d3e 2022 5374 6f72 6167 6522  t() -> "Storage"
+00003700: 3a20 2e2e 2e0a 2020 2020 4073 7461 7469  : ....    @stati
+00003710: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00003720: 6e65 775f 7769 7468 5f63 6f6e 665f 7374  new_with_conf_st
+00003730: 6174 6528 0a20 2020 2020 2020 2063 6f6e  ate(.        con
+00003740: 665f 7374 6174 653a 2022 436f 6e66 5374  f_state: "ConfSt
+00003750: 6174 6522 207c 2022 436f 6e66 5374 6174  ate" | "ConfStat
+00003760: 6552 6566 222c 0a20 2020 2029 202d 3e20  eRef",.    ) -> 
+00003770: 2253 746f 7261 6765 223a 0a20 2020 2020  "Storage":.     
+00003780: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
+00003790: 6566 2077 6c28 7365 6c66 2920 2d3e 2041  ef wl(self) -> A
+000037a0: 6e79 3a0a 2020 2020 2020 2020 2222 220a  ny:.        """.
+000037b0: 2020 2020 2020 2020 4f70 656e 7320 7570          Opens up
+000037c0: 2061 2077 7269 7465 206c 6f63 6b20 6f6e   a write lock on
+000037d0: 2074 6865 2073 746f 7261 6765 2061 6e64   the storage and
+000037e0: 2072 6574 7572 6e73 2067 7561 7264 2068   returns guard h
+000037f0: 616e 646c 652e 2055 7365 2074 6869 730a  andle. Use this.
+00003800: 2020 2020 2020 2020 7769 7468 2066 756e          with fun
+00003810: 6374 696f 6e73 2074 6861 7420 7461 6b65  ctions that take
+00003820: 2061 206d 7574 6162 6c65 2072 6566 6572   a mutable refer
+00003830: 656e 6365 2074 6f20 7365 6c66 2e0a 2020  ence to self..  
+00003840: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00003850: 6620 726c 2873 656c 6629 202d 3e20 416e  f rl(self) -> An
+00003860: 793a 0a20 2020 2020 2020 2022 2222 0a20  y:.        """. 
+00003870: 2020 2020 2020 204f 7065 6e73 2075 7020         Opens up 
+00003880: 6120 7265 6164 206c 6f63 6b20 6f6e 2074  a read lock on t
+00003890: 6865 2073 746f 7261 6765 2061 6e64 2072  he storage and r
+000038a0: 6574 7572 6e73 2061 2067 7561 7264 2068  eturns a guard h
+000038b0: 616e 646c 652e 2055 7365 2074 6869 730a  andle. Use this.
+000038c0: 2020 2020 2020 2020 7769 7468 2066 756e          with fun
+000038d0: 6374 696f 6e73 2074 6861 7420 646f 6e27  ctions that don'
+000038e0: 7420 7265 7175 6972 6520 6d75 7461 7469  t require mutati
+000038f0: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
+00003900: 0a63 6c61 7373 2053 746f 7261 6765 5265  .class StorageRe
+00003910: 6628 5f5f 4150 495f 5374 6f72 6167 6529  f(__API_Storage)
+00003920: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
+00003930: 6665 7265 6e63 6520 7479 7065 206f 6620  ference type of 
+00003940: 3a63 6c61 7373 3a60 5374 6f72 6167 6560  :class:`Storage`
+00003950: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00003960: 6566 2063 6c6f 6e65 2873 656c 6629 202d  ef clone(self) -
+00003970: 3e20 2253 746f 7261 6765 223a 202e 2e2e  > "Storage": ...
+00003980: 0a20 2020 2064 6566 2077 6c28 7365 6c66  .    def wl(self
+00003990: 2920 2d3e 2041 6e79 3a0a 2020 2020 2020  ) -> Any:.      
+000039a0: 2020 2222 220a 2020 2020 2020 2020 4f70    """.        Op
+000039b0: 656e 7320 7570 2061 2077 7269 7465 206c  ens up a write l
+000039c0: 6f63 6b20 6f6e 2074 6865 2073 746f 7261  ock on the stora
+000039d0: 6765 2061 6e64 2072 6574 7572 6e73 2067  ge and returns g
+000039e0: 7561 7264 2068 616e 646c 652e 2055 7365  uard handle. Use
+000039f0: 2074 6869 730a 2020 2020 2020 2020 7769   this.        wi
+00003a00: 7468 2066 756e 6374 696f 6e73 2074 6861  th functions tha
+00003a10: 7420 7461 6b65 2061 206d 7574 6162 6c65  t take a mutable
+00003a20: 2072 6566 6572 656e 6365 2074 6f20 7365   reference to se
+00003a30: 6c66 2e0a 2020 2020 2020 2020 2222 220a  lf..        """.
+00003a40: 2020 2020 6465 6620 726c 2873 656c 6629      def rl(self)
+00003a50: 202d 3e20 416e 793a 0a20 2020 2020 2020   -> Any:.       
+00003a60: 2022 2222 0a20 2020 2020 2020 204f 7065   """.        Ope
+00003a70: 6e73 2075 7020 6120 7265 6164 206c 6f63  ns up a read loc
+00003a80: 6b20 6f6e 2074 6865 2073 746f 7261 6765  k on the storage
+00003a90: 2061 6e64 2072 6574 7572 6e73 2061 2067   and returns a g
+00003aa0: 7561 7264 2068 616e 646c 652e 2055 7365  uard handle. Use
+00003ab0: 2074 6869 730a 2020 2020 2020 2020 7769   this.        wi
+00003ac0: 7468 2066 756e 6374 696f 6e73 2074 6861  th functions tha
+00003ad0: 7420 646f 6e27 7420 7265 7175 6972 6520  t don't require 
+00003ae0: 6d75 7461 7469 6f6e 2e0a 2020 2020 2020  mutation..      
+00003af0: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
+00003b00: 5049 5f52 6561 6479 3a0a 2020 2020 6465  PI_Ready:.    de
+00003b10: 6620 6873 2873 656c 6629 202d 3e20 4f70  f hs(self) -> Op
+00003b20: 7469 6f6e 616c 5b22 4861 7264 5374 6174  tional["HardStat
+00003b30: 6552 6566 225d 3a0a 2020 2020 2020 2020  eRef"]:.        
+00003b40: 2222 220a 2020 2020 2020 2020 5468 6520  """.        The 
+00003b50: 6375 7272 656e 7420 7374 6174 6520 6f66  current state of
+00003b60: 2061 204e 6f64 6520 746f 2062 6520 7361   a Node to be sa
+00003b70: 7665 6420 746f 2073 7461 626c 6520 7374  ved to stable st
+00003b80: 6f72 6167 652e 0a20 2020 2020 2020 2048  orage..        H
+00003b90: 6172 6453 7461 7465 2077 696c 6c20 6265  ardState will be
+00003ba0: 204e 6f6e 6520 7374 6174 6520 6966 2074   None state if t
+00003bb0: 6865 7265 2069 7320 6e6f 2075 7064 6174  here is no updat
+00003bc0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+00003bd0: 2020 2064 6566 2073 7328 7365 6c66 2920     def ss(self) 
+00003be0: 2d3e 204f 7074 696f 6e61 6c5b 2253 6f66  -> Optional["Sof
+00003bf0: 7453 7461 7465 5265 6622 5d3a 0a20 2020  tStateRef"]:.   
+00003c00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003c10: 2054 6865 2063 7572 7265 6e74 2076 6f6c   The current vol
+00003c20: 6174 696c 6520 7374 6174 6520 6f66 2061  atile state of a
+00003c30: 204e 6f64 652e 0a20 2020 2020 2020 2053   Node..        S
+00003c40: 6f66 7453 7461 7465 2077 696c 6c20 6265  oftState will be
+00003c50: 204e 6f6e 6520 6966 2074 6865 7265 2069   None if there i
+00003c60: 7320 6e6f 2075 7064 6174 652e 0a20 2020  s no update..   
+00003c70: 2020 2020 2049 7420 6973 206e 6f74 2072       It is not r
+00003c80: 6571 7569 7265 6420 746f 2063 6f6e 7375  equired to consu
+00003c90: 6d65 206f 7220 7374 6f72 6520 536f 6674  me or store Soft
+00003ca0: 5374 6174 652e 0a20 2020 2020 2020 2022  State..        "
+00003cb0: 2222 0a20 2020 2064 6566 206d 7573 745f  "".    def must_
+00003cc0: 7379 6e63 2873 656c 6629 202d 3e20 626f  sync(self) -> bo
+00003cd0: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
+00003ce0: 2020 2020 2020 2020 4d75 7374 5379 6e63          MustSync
+00003cf0: 2069 7320 6661 6c73 6520 6966 2061 6e64   is false if and
+00003d00: 206f 6e6c 7920 6966 0a20 2020 2020 2020   only if.       
+00003d10: 2031 2e20 6e6f 2048 6172 6453 7461 7465   1. no HardState
+00003d20: 206f 7220 6f6e 6c79 2069 7473 2063 6f6d   or only its com
+00003d30: 6d69 7420 6973 2064 6966 6665 7265 6e74  mit is different
+00003d40: 2066 726f 6d20 6265 666f 7265 0a20 2020   from before.   
+00003d50: 2020 2020 2032 2e20 6e6f 2045 6e74 7269       2. no Entri
+00003d60: 6573 2061 6e64 2053 6e61 7073 686f 740a  es and Snapshot.
+00003d70: 2020 2020 2020 2020 4966 2069 7427 7320          If it's 
+00003d80: 6661 6c73 652c 2061 6e20 6173 796e 6368  false, an asynch
+00003d90: 726f 6e6f 7573 2077 7269 7465 206f 6620  ronous write of 
+00003da0: 4861 7264 5374 6174 6520 6973 2070 6572  HardState is per
+00003db0: 6d69 7373 6962 6c65 2062 6566 6f72 6520  missible before 
+00003dc0: 6361 6c6c 696e 670a 2020 2020 2020 2020  calling.        
+00003dd0: 5b60 5261 774e 6f64 653a 3a6f 6e5f 7065  [`RawNode::on_pe
+00003de0: 7273 6973 745f 7265 6164 7960 5d20 6f72  rsist_ready`] or
+00003df0: 205b 6052 6177 4e6f 6465 3a3a 6164 7661   [`RawNode::adva
+00003e00: 6e63 6560 5d20 6f72 2069 7473 2066 616d  nce`] or its fam
+00003e10: 696c 6965 732e 0a20 2020 2020 2020 2022  ilies..        "
+00003e20: 2222 0a20 2020 2064 6566 206e 756d 6265  "".    def numbe
+00003e30: 7228 7365 6c66 2920 2d3e 2069 6e74 3a0a  r(self) -> int:.
+00003e40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003e50: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+00003e60: 6620 6375 7272 656e 7420 5265 6164 792e  f current Ready.
+00003e70: 0a20 2020 2020 2020 2049 7420 6973 2075  .        It is u
+00003e80: 7365 6420 666f 7220 6964 656e 7469 6679  sed for identify
+00003e90: 696e 6720 7468 6520 6469 6666 6572 656e  ing the differen
+00003ea0: 7420 5265 6164 7920 616e 6420 5265 6164  t Ready and Read
+00003eb0: 7952 6563 6f72 642e 0a20 2020 2020 2020  yRecord..       
+00003ec0: 2022 2222 0a20 2020 2064 6566 2073 6e61   """.    def sna
+00003ed0: 7073 686f 7428 7365 6c66 2920 2d3e 2022  pshot(self) -> "
+00003ee0: 536e 6170 7368 6f74 5265 6622 3a0a 2020  SnapshotRef":.  
+00003ef0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003f00: 2020 536e 6170 7368 6f74 2073 7065 6369    Snapshot speci
+00003f10: 6669 6573 2074 6865 2073 6e61 7073 686f  fies the snapsho
+00003f20: 7420 746f 2062 6520 7361 7665 6420 746f  t to be saved to
+00003f30: 2073 7461 626c 6520 7374 6f72 6167 652e   stable storage.
+00003f40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003f50: 2064 6566 2063 6f6d 6d69 7474 6564 5f65   def committed_e
+00003f60: 6e74 7269 6573 2873 656c 6629 202d 3e20  ntries(self) -> 
+00003f70: 4c69 7374 5b22 456e 7472 7952 6566 225d  List["EntryRef"]
+00003f80: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00003f90: 2020 2020 2020 436f 6d6d 6974 7465 6445        CommittedE
+00003fa0: 6e74 7269 6573 2073 7065 6369 6669 6573  ntries specifies
+00003fb0: 2065 6e74 7269 6573 2074 6f20 6265 2063   entries to be c
+00003fc0: 6f6d 6d69 7474 6564 2074 6f20 610a 2020  ommitted to a.  
+00003fd0: 2020 2020 2020 7374 6f72 652f 7374 6174        store/stat
+00003fe0: 652d 6d61 6368 696e 652e 2054 6865 7365  e-machine. These
+00003ff0: 2068 6176 6520 7072 6576 696f 7573 6c79   have previously
+00004000: 2062 6565 6e20 636f 6d6d 6974 7465 6420   been committed 
+00004010: 746f 2073 7461 626c 650a 2020 2020 2020  to stable.      
+00004020: 2020 7374 6f72 652e 0a20 2020 2020 2020    store..       
+00004030: 2022 2222 0a20 2020 2064 6566 2074 616b   """.    def tak
+00004040: 655f 636f 6d6d 6974 7465 645f 656e 7472  e_committed_entr
+00004050: 6965 7328 7365 6c66 2920 2d3e 204c 6973  ies(self) -> Lis
+00004060: 745b 2245 6e74 7279 225d 3a0a 2020 2020  t["Entry"]:.    
+00004070: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00004080: 5461 6b65 2074 6865 2043 6f6d 6d69 7445  Take the CommitE
+00004090: 6e74 7269 6573 2e0a 2020 2020 2020 2020  ntries..        
+000040a0: 2222 220a 2020 2020 6465 6620 656e 7472  """.    def entr
+000040b0: 6965 7328 7365 6c66 2920 2d3e 204c 6973  ies(self) -> Lis
+000040c0: 745b 2245 6e74 7279 5265 6622 5d3a 0a20  t["EntryRef"]:. 
+000040d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000040e0: 2020 2045 6e74 7269 6573 2073 7065 6369     Entries speci
+000040f0: 6669 6573 2065 6e74 7269 6573 2074 6f20  fies entries to 
+00004100: 6265 2073 6176 6564 2074 6f20 7374 6162  be saved to stab
+00004110: 6c65 2073 746f 7261 6765 2e0a 2020 2020  le storage..    
+00004120: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00004130: 7461 6b65 5f65 6e74 7269 6573 2873 656c  take_entries(sel
+00004140: 6629 202d 3e20 4c69 7374 5b22 456e 7472  f) -> List["Entr
+00004150: 7922 5d3a 0a20 2020 2020 2020 2022 2222  y"]:.        """
+00004160: 0a20 2020 2020 2020 2054 616b 6520 7468  .        Take th
+00004170: 6520 456e 7472 6965 732e 0a20 2020 2020  e Entries..     
+00004180: 2020 2022 2222 0a20 2020 2064 6566 206d     """.    def m
+00004190: 6573 7361 6765 7328 7365 6c66 2920 2d3e  essages(self) ->
+000041a0: 204c 6973 745b 224d 6573 7361 6765 5265   List["MessageRe
+000041b0: 6622 5d3a 0a20 2020 2020 2020 2022 2222  f"]:.        """
+000041c0: 0a20 2020 2020 2020 204d 6573 7361 6765  .        Message
+000041d0: 7320 7370 6563 6966 6965 7320 6f75 7462  s specifies outb
+000041e0: 6f75 6e64 206d 6573 7361 6765 7320 746f  ound messages to
+000041f0: 2062 6520 7365 6e74 2e0a 2020 2020 2020   be sent..      
+00004200: 2020 4966 2069 7420 636f 6e74 6169 6e73    If it contains
+00004210: 2061 204d 7367 536e 6170 206d 6573 7361   a MsgSnap messa
+00004220: 6765 2c20 7468 6520 6170 706c 6963 6174  ge, the applicat
+00004230: 696f 6e20 4d55 5354 2072 6570 6f72 7420  ion MUST report 
+00004240: 6261 636b 2074 6f20 7261 6674 0a20 2020  back to raft.   
+00004250: 2020 2020 2077 6865 6e20 7468 6520 736e       when the sn
+00004260: 6170 7368 6f74 2068 6173 2062 6565 6e20  apshot has been 
+00004270: 7265 6365 6976 6564 206f 7220 6861 7320  received or has 
+00004280: 6661 696c 6564 2062 7920 6361 6c6c 696e  failed by callin
+00004290: 6720 5265 706f 7274 536e 6170 7368 6f74  g ReportSnapshot
+000042a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000042b0: 2020 6465 6620 7461 6b65 5f6d 6573 7361    def take_messa
+000042c0: 6765 7328 7365 6c66 2920 2d3e 204c 6973  ges(self) -> Lis
+000042d0: 745b 224d 6573 7361 6765 225d 3a0a 2020  t["Message"]:.  
+000042e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000042f0: 2020 5461 6b65 2074 6865 204d 6573 7361    Take the Messa
+00004300: 6765 732e 0a20 2020 2020 2020 2022 2222  ges..        """
+00004310: 0a20 2020 2064 6566 2070 6572 7369 7374  .    def persist
+00004320: 6564 5f6d 6573 7361 6765 7328 7365 6c66  ed_messages(self
+00004330: 2920 2d3e 204c 6973 745b 224d 6573 7361  ) -> List["Messa
+00004340: 6765 5265 6622 5d3a 0a20 2020 2020 2020  geRef"]:.       
+00004350: 2022 2222 0a20 2020 2020 2020 2050 6572   """.        Per
+00004360: 7369 7374 6564 204d 6573 7361 6765 7320  sisted Messages 
+00004370: 7370 6563 6966 6965 7320 6f75 7462 6f75  specifies outbou
+00004380: 6e64 206d 6573 7361 6765 7320 746f 2062  nd messages to b
+00004390: 6520 7365 6e74 2041 4654 4552 2074 6865  e sent AFTER the
+000043a0: 2048 6172 6453 7461 7465 2c0a 2020 2020   HardState,.    
+000043b0: 2020 2020 456e 7472 6965 7320 616e 6420      Entries and 
+000043c0: 536e 6170 7368 6f74 2061 7265 2070 6572  Snapshot are per
+000043d0: 7369 7374 6564 2074 6f20 7374 6162 6c65  sisted to stable
+000043e0: 2073 746f 7261 6765 2e0a 2020 2020 2020   storage..      
+000043f0: 2020 2222 220a 2020 2020 6465 6620 7461    """.    def ta
+00004400: 6b65 5f70 6572 7369 7374 6564 5f6d 6573  ke_persisted_mes
+00004410: 7361 6765 7328 7365 6c66 2920 2d3e 204c  sages(self) -> L
+00004420: 6973 745b 224d 6573 7361 6765 225d 3a0a  ist["Message"]:.
+00004430: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00004440: 2020 2020 5461 6b65 2074 6865 2050 6572      Take the Per
+00004450: 7369 7374 6564 204d 6573 7361 6765 732e  sisted Messages.
+00004460: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00004470: 2064 6566 2072 6561 645f 7374 6174 6573   def read_states
+00004480: 2873 656c 6629 202d 3e20 4c69 7374 5b22  (self) -> List["
+00004490: 5265 6164 5374 6174 6552 6566 225d 3a0a  ReadStateRef"]:.
+000044a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000044b0: 2020 2020 5265 6164 5374 6174 6573 2073      ReadStates s
+000044c0: 7065 6369 6669 6573 2074 6865 2073 7461  pecifies the sta
+000044d0: 7465 2066 6f72 2072 6561 6420 6f6e 6c79  te for read only
+000044e0: 2071 7565 7279 2e0a 2020 2020 2020 2020   query..        
+000044f0: 2222 220a 2020 2020 6465 6620 7461 6b65  """.    def take
+00004500: 5f72 6561 645f 7374 6174 6573 2873 656c  _read_states(sel
+00004510: 6629 202d 3e20 4c69 7374 5b22 5265 6164  f) -> List["Read
+00004520: 5374 6174 6522 5d3a 0a20 2020 2020 2020  State"]:.       
+00004530: 2022 2222 0a20 2020 2020 2020 2052 6561   """.        Rea
+00004540: 6453 7461 7465 7320 7370 6563 6966 6965  dStates specifie
+00004550: 7320 7468 6520 7374 6174 6520 666f 7220  s the state for 
+00004560: 7265 6164 206f 6e6c 7920 7175 6572 792e  read only query.
+00004570: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
+00004580: 6173 7320 5265 6164 7928 5f5f 4150 495f  ass Ready(__API_
+00004590: 5265 6164 7929 3a0a 2020 2020 2222 220a  Ready):.    """.
+000045a0: 2020 2020 5265 6164 7920 656e 6361 7073      Ready encaps
+000045b0: 756c 6174 6573 2074 6865 2065 6e74 7269  ulates the entri
+000045c0: 6573 2061 6e64 206d 6573 7361 6765 7320  es and messages 
+000045d0: 7468 6174 2061 7265 2072 6561 6479 2074  that are ready t
+000045e0: 6f20 7265 6164 2c0a 2020 2020 6265 2073  o read,.    be s
+000045f0: 6176 6564 2074 6f20 7374 6162 6c65 2073  aved to stable s
+00004600: 746f 7261 6765 2c20 636f 6d6d 6974 7465  torage, committe
+00004610: 6420 6f72 2073 656e 7420 746f 206f 7468  d or sent to oth
+00004620: 6572 2070 6565 7273 2e0a 2020 2020 2222  er peers..    ""
+00004630: 220a 0a20 2020 2064 6566 206d 616b 655f  "..    def make_
+00004640: 7265 6628 7365 6c66 2920 2d3e 2022 5265  ref(self) -> "Re
+00004650: 6164 7952 6566 223a 202e 2e2e 0a20 2020  adyRef": ....   
+00004660: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00004670: 2020 2064 6566 2064 6566 6175 6c74 2829     def default()
+00004680: 202d 3e20 2252 6561 6479 223a 202e 2e2e   -> "Ready": ...
+00004690: 0a0a 636c 6173 7320 5265 6164 7952 6566  ..class ReadyRef
+000046a0: 285f 5f41 5049 5f52 6561 6479 293a 0a20  (__API_Ready):. 
+000046b0: 2020 2022 2222 0a20 2020 2052 6566 6572     """.    Refer
+000046c0: 656e 6365 2074 7970 6520 6f66 203a 636c  ence type of :cl
+000046d0: 6173 733a 6052 6561 6479 602e 0a20 2020  ass:`Ready`..   
+000046e0: 2022 2222 0a0a 636c 6173 7320 5f5f 4150   """..class __AP
+000046f0: 495f 5261 774e 6f64 653a 0a20 2020 2064  I_RawNode:.    d
+00004700: 6566 2061 6476 616e 6365 5f61 7070 6c79  ef advance_apply
+00004710: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00004720: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00004730: 2020 2020 4164 7661 6e63 6520 6170 706c      Advance appl
+00004740: 7920 746f 2074 6865 2069 6e64 6578 206f  y to the index o
+00004750: 6620 7468 6520 6c61 7374 2063 6f6d 6d69  f the last commi
+00004760: 7474 6564 2065 6e74 7269 6573 2067 6976  tted entries giv
+00004770: 656e 2062 6566 6f72 652e 0a20 2020 2020  en before..     
+00004780: 2020 2022 2222 0a20 2020 2064 6566 2061     """.    def a
+00004790: 6476 616e 6365 5f61 7070 6c79 5f74 6f28  dvance_apply_to(
+000047a0: 7365 6c66 2c20 6170 706c 6965 643a 2069  self, applied: i
+000047b0: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
+000047c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000047d0: 2041 6476 616e 6365 2061 7070 6c79 2074   Advance apply t
+000047e0: 6f20 7468 6520 7061 7373 6564 2069 6e64  o the passed ind
+000047f0: 6578 2e0a 2020 2020 2020 2020 2222 220a  ex..        """.
+00004800: 2020 2020 6465 6620 6164 7661 6e63 6528      def advance(
+00004810: 7365 6c66 2c20 7264 3a20 2252 6561 6479  self, rd: "Ready
+00004820: 5265 6622 2920 2d3e 2022 4c69 6768 7452  Ref") -> "LightR
+00004830: 6561 6479 223a 0a20 2020 2020 2020 2022  eady":.        "
+00004840: 2222 0a20 2020 2020 2020 2041 6476 616e  "".        Advan
+00004850: 6365 7320 7468 6520 7265 6164 7920 6166  ces the ready af
+00004860: 7465 7220 6675 6c6c 7920 7072 6f63 6573  ter fully proces
+00004870: 7369 6e67 2069 742e 0a0a 2020 2020 2020  sing it...      
+00004880: 2020 4675 6c6c 7920 7072 6f63 6573 7369    Fully processi
+00004890: 6e67 2061 2072 6561 6479 2072 6571 7569  ng a ready requi
+000048a0: 7265 7320 746f 2070 6572 7369 7374 2073  res to persist s
+000048b0: 6e61 7073 686f 742c 2065 6e74 7269 6573  napshot, entries
+000048c0: 2061 6e64 2068 6172 6420 7374 6174 6573   and hard states
+000048d0: 2c20 6170 706c 7920 616c 6c0a 2020 2020  , apply all.    
+000048e0: 2020 2020 636f 6d6d 6974 7465 6420 656e      committed en
+000048f0: 7472 6965 732c 2073 656e 6420 616c 6c20  tries, send all 
+00004900: 6d65 7373 6167 6573 2e0a 0a20 2020 2020  messages...     
+00004910: 2020 2052 6574 7572 6e73 2074 6865 204c     Returns the L
+00004920: 6967 6874 5265 6164 7920 7468 6174 2063  ightReady that c
+00004930: 6f6e 7461 696e 7320 636f 6d6d 6974 2069  ontains commit i
+00004940: 6e64 6578 2c20 636f 6d6d 6974 7465 6420  ndex, committed 
+00004950: 656e 7472 6965 7320 616e 6420 6d65 7373  entries and mess
+00004960: 6167 6573 2e20 5b60 4c69 6768 7452 6561  ages. [`LightRea
+00004970: 6479 605d 0a20 2020 2020 2020 2063 6f6e  dy`].        con
+00004980: 7461 696e 7320 7570 6461 7465 7320 7468  tains updates th
+00004990: 6174 206f 6e6c 7920 7661 6c69 6420 6166  at only valid af
+000049a0: 7465 7220 7065 7273 6973 7469 6e67 206c  ter persisting l
+000049b0: 6173 7420 7265 6164 792e 2049 7420 7368  ast ready. It sh
+000049c0: 6f75 6c64 2061 6c73 6f20 6265 2066 756c  ould also be ful
+000049d0: 6c79 2070 726f 6365 7373 6564 2e0a 2020  ly processed..  
+000049e0: 2020 2020 2020 5468 656e 205b 6053 656c        Then [`Sel
+000049f0: 663a 3a61 6476 616e 6365 5f61 7070 6c79  f::advance_apply
+00004a00: 605d 206f 7220 5b60 5365 6c66 3a3a 6164  `] or [`Self::ad
+00004a10: 7661 6e63 655f 6170 706c 795f 746f 605d  vance_apply_to`]
+00004a20: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
+00004a30: 6c61 7465 7220 746f 2075 7064 6174 6520  later to update 
+00004a40: 6170 706c 7969 6e67 0a20 2020 2020 2020  applying.       
+00004a50: 2070 726f 6772 6573 732e 0a20 2020 2020   progress..     
+00004a60: 2020 2022 2222 0a20 2020 2064 6566 2061     """.    def a
+00004a70: 6476 616e 6365 5f61 7070 656e 6428 7365  dvance_append(se
+00004a80: 6c66 2c20 7264 3a20 2252 6561 6479 5265  lf, rd: "ReadyRe
+00004a90: 6622 2920 2d3e 2022 4c69 6768 7452 6561  f") -> "LightRea
+00004aa0: 6479 223a 0a20 2020 2020 2020 2022 2222  dy":.        """
+00004ab0: 0a20 2020 2020 2020 2041 6476 616e 6365  .        Advance
+00004ac0: 7320 7468 6520 7265 6164 7920 7769 7468  s the ready with
+00004ad0: 6f75 7420 6170 706c 7969 6e67 2063 6f6d  out applying com
+00004ae0: 6d69 7474 6564 2065 6e74 7269 6573 2e20  mitted entries. 
+00004af0: 5b60 5365 6c66 3a3a 6164 7661 6e63 655f  [`Self::advance_
+00004b00: 6170 706c 7960 5d20 6f72 0a20 2020 2020  apply`] or.     
+00004b10: 2020 205b 6053 656c 663a 3a61 6476 616e     [`Self::advan
+00004b20: 6365 5f61 7070 6c79 5f74 6f60 5d20 7368  ce_apply_to`] sh
+00004b30: 6f75 6c64 2062 6520 7573 6564 206c 6174  ould be used lat
+00004b40: 6572 2074 6f20 7570 6461 7465 2061 7070  er to update app
+00004b50: 6c79 696e 6720 7072 6f67 7265 7373 2e0a  lying progress..
+00004b60: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00004b70: 2074 6865 204c 6967 6874 5265 6164 7920   the LightReady 
+00004b80: 7468 6174 2063 6f6e 7461 696e 7320 636f  that contains co
+00004b90: 6d6d 6974 2069 6e64 6578 2c20 636f 6d6d  mmit index, comm
+00004ba0: 6974 7465 6420 656e 7472 6965 7320 616e  itted entries an
+00004bb0: 6420 6d65 7373 6167 6573 2e0a 0a20 2020  d messages...   
+00004bc0: 2020 2020 2053 696e 6365 2052 6561 6479       Since Ready
+00004bd0: 206d 7573 7420 6265 2070 6572 7369 7374   must be persist
+00004be0: 6564 2069 6e20 6f72 6465 722c 2063 616c  ed in order, cal
+00004bf0: 6c69 6e67 2074 6869 7320 6675 6e63 7469  ling this functi
+00004c00: 6f6e 2069 6d70 6c69 6369 746c 7920 6d65  on implicitly me
+00004c10: 616e 730a 2020 2020 2020 2020 616c 6c20  ans.        all 
+00004c20: 7265 6164 7920 636f 6c6c 6563 7465 6420  ready collected 
+00004c30: 6265 666f 7265 2068 6176 6520 6265 656e  before have been
+00004c40: 2070 6572 7369 7374 6564 2e0a 2020 2020   persisted..    
+00004c50: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00004c60: 6164 7661 6e63 655f 6170 7065 6e64 5f61  advance_append_a
+00004c70: 7379 6e63 2873 656c 662c 2072 643a 2022  sync(self, rd: "
+00004c80: 5265 6164 7952 6566 2229 202d 3e20 4e6f  ReadyRef") -> No
+00004c90: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00004ca0: 2020 2020 2020 2020 5361 6d65 2061 7320          Same as 
+00004cb0: 5b60 5365 6c66 3a3a 6164 7661 6e63 655f  [`Self::advance_
+00004cc0: 6170 7065 6e64 605d 2065 7863 6570 7420  append`] except 
+00004cd0: 7468 6174 2069 7420 616c 6c6f 7773 2074  that it allows t
+00004ce0: 6f20 6f6e 6c79 2073 746f 7265 2074 6865  o only store the
+00004cf0: 2075 7064 6174 6573 2069 6e20 6361 6368   updates in cach
+00004d00: 652e 0a20 2020 2020 2020 205b 6053 656c  e..        [`Sel
+00004d10: 663a 3a6f 6e5f 7065 7273 6973 745f 7265  f::on_persist_re
+00004d20: 6164 7960 5d20 7368 6f75 6c64 2062 6520  ady`] should be 
+00004d30: 7573 6564 206c 6174 6572 2074 6f20 7570  used later to up
+00004d40: 6461 7465 2074 6865 2070 6572 7369 7374  date the persist
+00004d50: 696e 6720 7072 6f67 7265 7373 2e0a 0a20  ing progress... 
+00004d60: 2020 2020 2020 2052 6166 7420 776f 726b         Raft work
+00004d70: 7320 6f6e 2061 6e20 6173 7375 6d70 7469  s on an assumpti
+00004d80: 6f6e 2070 6572 7369 7374 6564 2075 7064  on persisted upd
+00004d90: 6174 6573 2073 686f 756c 6420 6e6f 7420  ates should not 
+00004da0: 6265 206c 6f73 742c 2077 6869 6368 2075  be lost, which u
+00004db0: 7375 616c 6c79 2072 6571 7569 7265 7320  sually requires 
+00004dc0: 6578 7065 6e73 6976 650a 2020 2020 2020  expensive.      
+00004dd0: 2020 6f70 6572 6174 696f 6e73 206c 696b    operations lik
+00004de0: 6520 6066 7379 6e63 602e 2060 6164 7661  e `fsync`. `adva
+00004df0: 6e63 655f 6170 7065 6e64 5f61 7379 6e63  nce_append_async
+00004e00: 6020 616c 6c6f 7773 2079 6f75 2074 6f20  ` allows you to 
+00004e10: 636f 6e74 726f 6c20 7468 6520 7261 7465  control the rate
+00004e20: 206f 6620 7375 6368 206f 7065 7261 7469   of such operati
+00004e30: 6f6e 7320 616e 640a 2020 2020 2020 2020  ons and.        
+00004e40: 6765 7420 6120 7265 6173 6f6e 6162 6c65  get a reasonable
+00004e50: 2062 6174 6368 2073 697a 652e 2048 6f77   batch size. How
+00004e60: 6576 6572 2c20 6974 2773 2073 7469 6c6c  ever, it's still
+00004e70: 2072 6571 7569 7265 6420 7468 6174 2074   required that t
+00004e80: 6865 2075 7064 6174 6573 2063 616e 2062  he updates can b
+00004e90: 6520 7265 6164 2062 7920 7261 6674 2066  e read by raft f
+00004ea0: 726f 6d20 7468 650a 2020 2020 2020 2020  rom the.        
+00004eb0: 6053 746f 7261 6765 6020 7472 6169 7420  `Storage` trait 
+00004ec0: 6265 666f 7265 2063 616c 6c69 6e67 2060  before calling `
+00004ed0: 6164 7661 6e63 655f 6170 7065 6e64 5f61  advance_append_a
+00004ee0: 7379 6e63 602e 0a20 2020 2020 2020 2022  sync`..        "
+00004ef0: 2222 0a20 2020 2064 6566 2068 6173 5f72  "".    def has_r
+00004f00: 6561 6479 2873 656c 6629 202d 3e20 626f  eady(self) -> bo
+00004f10: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
+00004f20: 2020 2020 2020 2020 4861 7352 6561 6479          HasReady
+00004f30: 2063 616c 6c65 6420 7768 656e 2052 6177   called when Raw
+00004f40: 4e6f 6465 2075 7365 7220 6e65 6564 2074  Node user need t
+00004f50: 6f20 6368 6563 6b20 6966 2061 6e79 2052  o check if any R
+00004f60: 6561 6479 2070 656e 6469 6e67 2e0a 2020  eady pending..  
+00004f70: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00004f80: 6620 7469 636b 2873 656c 6629 202d 3e20  f tick(self) -> 
+00004f90: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+00004fa0: 220a 2020 2020 2020 2020 5469 636b 2061  ".        Tick a
+00004fb0: 6476 616e 6365 7320 7468 6520 696e 7465  dvances the inte
+00004fc0: 726e 616c 206c 6f67 6963 616c 2063 6c6f  rnal logical clo
+00004fd0: 636b 2062 7920 6120 7369 6e67 6c65 2074  ck by a single t
+00004fe0: 6963 6b2e 0a0a 2020 2020 2020 2020 5265  ick...        Re
+00004ff0: 7475 726e 7320 7472 7565 2074 6f20 696e  turns true to in
+00005000: 6469 6361 7465 2074 6861 7420 7468 6572  dicate that ther
+00005010: 6520 7769 6c6c 2070 726f 6261 626c 7920  e will probably 
+00005020: 6265 2073 6f6d 6520 7265 6164 696e 6573  be some readines
+00005030: 7320 7768 6963 680a 2020 2020 2020 2020  s which.        
+00005040: 6e65 6564 7320 746f 2062 6520 6861 6e64  needs to be hand
+00005050: 6c65 642e 0a20 2020 2020 2020 2022 2222  led..        """
+00005060: 0a20 2020 2064 6566 2073 6574 5f62 6174  .    def set_bat
+00005070: 6368 5f61 7070 656e 6428 7365 6c66 2c20  ch_append(self, 
+00005080: 6261 7463 685f 6170 7065 6e64 3a20 626f  batch_append: bo
+00005090: 6f6c 2920 2d3e 204e 6f6e 653a 0a20 2020  ol) -> None:.   
+000050a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000050b0: 2053 6574 2077 6865 7468 6572 2074 6f20   Set whether to 
+000050c0: 6261 7463 6820 6170 7065 6e64 206d 7367  batch append msg
+000050d0: 2061 7420 7275 6e74 696d 652e 0a20 2020   at runtime..   
+000050e0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+000050f0: 2073 6574 5f70 7269 6f72 6974 7928 7365   set_priority(se
+00005100: 6c66 2c20 7072 696f 7269 7479 3a20 696e  lf, priority: in
+00005110: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
+00005120: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00005130: 5365 7473 2070 7269 6f72 6974 7920 6f66  Sets priority of
+00005140: 206e 6f64 652e 0a20 2020 2020 2020 2022   node..        "
+00005150: 2222 0a20 2020 2064 6566 2072 6570 6f72  "".    def repor
+00005160: 745f 736e 6170 7368 6f74 2873 656c 662c  t_snapshot(self,
+00005170: 2069 643a 2069 6e74 2c20 736e 6170 7368   id: int, snapsh
+00005180: 6f74 3a20 2253 6e61 7073 686f 7453 7461  ot: "SnapshotSta
+00005190: 7475 7322 2920 2d3e 204e 6f6e 653a 0a20  tus") -> None:. 
+000051a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000051b0: 2020 2052 6570 6f72 7453 6e61 7073 686f     ReportSnapsho
+000051c0: 7420 7265 706f 7274 7320 7468 6520 7374  t reports the st
+000051d0: 6174 7573 206f 6620 7468 6520 7365 6e74  atus of the sent
+000051e0: 2073 6e61 7073 686f 742e 0a20 2020 2020   snapshot..     
+000051f0: 2020 2022 2222 0a20 2020 2064 6566 2072     """.    def r
+00005200: 6570 6f72 745f 756e 7265 6163 6861 626c  eport_unreachabl
+00005210: 6528 7365 6c66 2c20 6964 3a20 696e 7429  e(self, id: int)
+00005220: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00005230: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+00005240: 706f 7274 556e 7265 6163 6861 626c 6520  portUnreachable 
+00005250: 7265 706f 7274 7320 7468 6520 6769 7665  reports the give
+00005260: 6e20 6e6f 6465 2069 7320 6e6f 7420 7265  n node is not re
+00005270: 6163 6861 626c 6520 666f 7220 7468 6520  achable for the 
+00005280: 6c61 7374 2073 656e 642e 0a20 2020 2020  last send..     
+00005290: 2020 2022 2222 0a20 2020 2064 6566 2074     """.    def t
+000052a0: 7261 6e73 6665 725f 6c65 6164 6572 2873  ransfer_leader(s
+000052b0: 656c 662c 2074 7261 6e73 6665 7265 653a  elf, transferee:
+000052c0: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
+000052d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000052e0: 2020 2054 7261 6e73 6665 724c 6561 6465     TransferLeade
+000052f0: 7220 7472 6965 7320 746f 2074 7261 6e73  r tries to trans
+00005300: 6665 7220 6c65 6164 6572 7368 6970 2074  fer leadership t
+00005310: 6f20 7468 6520 6769 7665 6e20 7472 616e  o the given tran
+00005320: 7366 6572 6565 2e0a 2020 2020 2020 2020  sferee..        
+00005330: 2222 220a 2020 2020 6465 6620 736e 6170  """.    def snap
+00005340: 2873 656c 6629 202d 3e20 4f70 7469 6f6e  (self) -> Option
+00005350: 616c 5b22 536e 6170 7368 6f74 5265 6622  al["SnapshotRef"
+00005360: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00005370: 2020 2020 2020 2047 7261 6273 2074 6865         Grabs the
+00005380: 2073 6e61 7073 686f 7420 6672 6f6d 2074   snapshot from t
+00005390: 6865 2072 6166 7420 6966 2061 7661 696c  he raft if avail
+000053a0: 6162 6c65 2e0a 2020 2020 2020 2020 2222  able..        ""
+000053b0: 220a 2020 2020 6465 6620 7374 6570 2873  ".    def step(s
+000053c0: 656c 662c 206d 7367 3a20 224d 6573 7361  elf, msg: "Messa
+000053d0: 6765 2220 7c20 224d 6573 7361 6765 5265  ge" | "MessageRe
+000053e0: 6622 2920 2d3e 204e 6f6e 653a 0a20 2020  f") -> None:.   
+000053f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00005400: 2053 7465 7020 6164 7661 6e63 6573 2074   Step advances t
+00005410: 6865 2073 7461 7465 206d 6163 6869 6e65  he state machine
+00005420: 2075 7369 6e67 2074 6865 2067 6976 656e   using the given
+00005430: 206d 6573 7361 6765 2e0a 2020 2020 2020   message..      
+00005440: 2020 2222 220a 2020 2020 6465 6620 736b    """.    def sk
+00005450: 6970 5f62 6361 7374 5f63 6f6d 6d69 7428  ip_bcast_commit(
+00005460: 7365 6c66 2c20 736b 6970 3a20 626f 6f6c  self, skip: bool
+00005470: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00005480: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+00005490: 6574 2077 6865 7468 6572 2073 6b69 7020  et whether skip 
+000054a0: 6272 6f61 6463 6173 7420 656d 7074 7920  broadcast empty 
+000054b0: 636f 6d6d 6974 206d 6573 7361 6765 7320  commit messages 
+000054c0: 6174 2072 756e 7469 6d65 2e0a 2020 2020  at runtime..    
+000054d0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+000054e0: 6361 6d70 6169 676e 2873 656c 6629 202d  campaign(self) -
+000054f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00005500: 2222 220a 2020 2020 2020 2020 4361 6d70  """.        Camp
+00005510: 6169 676e 2063 6175 7365 7320 7468 6973  aign causes this
+00005520: 2052 6177 4e6f 6465 2074 6f20 7472 616e   RawNode to tran
+00005530: 7369 7469 6f6e 2074 6f20 6361 6e64 6964  sition to candid
+00005540: 6174 6520 7374 6174 652e 0a20 2020 2020  ate state..     
+00005550: 2020 2022 2222 0a20 2020 2064 6566 2070     """.    def p
+00005560: 726f 706f 7365 2873 656c 662c 2063 6f6e  ropose(self, con
+00005570: 7465 7874 3a20 6279 7465 732c 2064 6174  text: bytes, dat
+00005580: 613a 2062 7974 6573 2920 2d3e 204e 6f6e  a: bytes) -> Non
+00005590: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+000055a0: 2020 2020 2020 2050 726f 706f 7365 2070         Propose p
+000055b0: 726f 706f 7365 7320 6461 7461 2062 6520  roposes data be 
+000055c0: 6170 7065 6e64 6564 2074 6f20 7468 6520  appended to the 
+000055d0: 7261 6674 206c 6f67 2e0a 2020 2020 2020  raft log..      
+000055e0: 2020 2222 220a 2020 2020 6465 6620 7072    """.    def pr
+000055f0: 6f70 6f73 655f 636f 6e66 5f63 6861 6e67  opose_conf_chang
+00005600: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+00005610: 2063 6f6e 7465 7874 3a20 6279 7465 732c   context: bytes,
+00005620: 2063 633a 2022 436f 6e66 4368 616e 6765   cc: "ConfChange
+00005630: 2220 7c20 2243 6f6e 6643 6861 6e67 6552  " | "ConfChangeR
+00005640: 6566 220a 2020 2020 2920 2d3e 204e 6f6e  ef".    ) -> Non
+00005650: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00005660: 2020 2020 2020 2050 726f 706f 7365 436f         ProposeCo
+00005670: 6e66 4368 616e 6765 2070 726f 706f 7365  nfChange propose
+00005680: 7320 6120 636f 6e66 6967 2063 6861 6e67  s a config chang
+00005690: 652e 0a0a 2020 2020 2020 2020 4966 2074  e...        If t
+000056a0: 6865 206e 6f64 6520 656e 7465 7273 206a  he node enters j
+000056b0: 6f69 6e74 2073 7461 7465 2077 6974 6820  oint state with 
+000056c0: 6061 7574 6f5f 6c65 6176 6560 2073 6574  `auto_leave` set
+000056d0: 2074 6f20 7472 7565 2c20 6974 2773 0a20   to true, it's. 
+000056e0: 2020 2020 2020 2063 616c 6c65 7227 7320         caller's 
+000056f0: 7265 7370 6f6e 7369 6269 6c69 7479 2074  responsibility t
+00005700: 6f20 7072 6f70 6f73 6520 616e 2065 6d70  o propose an emp
+00005710: 7479 2063 6f6e 6620 6368 616e 6765 2061  ty conf change a
+00005720: 6761 696e 2074 6f20 666f 7263 650a 2020  gain to force.  
+00005730: 2020 2020 2020 6c65 6176 696e 6720 6a6f        leaving jo
+00005740: 696e 7420 7374 6174 652e 0a20 2020 2020  int state..     
+00005750: 2020 2022 2222 0a20 2020 2064 6566 2070     """.    def p
+00005760: 726f 706f 7365 5f63 6f6e 665f 6368 616e  ropose_conf_chan
+00005770: 6765 5f76 3228 0a20 2020 2020 2020 2073  ge_v2(.        s
+00005780: 656c 662c 2063 6f6e 7465 7874 3a20 6279  elf, context: by
+00005790: 7465 732c 2063 633a 2022 436f 6e66 4368  tes, cc: "ConfCh
+000057a0: 616e 6765 5632 2220 7c20 2243 6f6e 6643  angeV2" | "ConfC
+000057b0: 6861 6e67 6556 3252 6566 220a 2020 2020  hangeV2Ref".    
+000057c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000057d0: 2020 2022 2222 0a20 2020 2020 2020 2050     """.        P
+000057e0: 726f 706f 7365 436f 6e66 4368 616e 6765  roposeConfChange
+000057f0: 2070 726f 706f 7365 7320 6120 636f 6e66   proposes a conf
+00005800: 6967 2063 6861 6e67 652e 0a0a 2020 2020  ig change...    
+00005810: 2020 2020 4966 2074 6865 206e 6f64 6520      If the node 
+00005820: 656e 7465 7273 206a 6f69 6e74 2073 7461  enters joint sta
+00005830: 7465 2077 6974 6820 6061 7574 6f5f 6c65  te with `auto_le
+00005840: 6176 6560 2073 6574 2074 6f20 7472 7565  ave` set to true
+00005850: 2c20 6974 2773 0a20 2020 2020 2020 2063  , it's.        c
+00005860: 616c 6c65 7227 7320 7265 7370 6f6e 7369  aller's responsi
+00005870: 6269 6c69 7479 2074 6f20 7072 6f70 6f73  bility to propos
+00005880: 6520 616e 2065 6d70 7479 2063 6f6e 6620  e an empty conf 
+00005890: 6368 616e 6765 2061 6761 696e 2074 6f20  change again to 
+000058a0: 666f 7263 650a 2020 2020 2020 2020 6c65  force.        le
+000058b0: 6176 696e 6720 6a6f 696e 7420 7374 6174  aving joint stat
+000058c0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+000058d0: 2020 2064 6566 2061 7070 6c79 5f63 6f6e     def apply_con
+000058e0: 665f 6368 616e 6765 2873 656c 662c 2063  f_change(self, c
+000058f0: 633a 2022 436f 6e66 4368 616e 6765 2220  c: "ConfChange" 
+00005900: 7c20 2243 6f6e 6643 6861 6e67 6552 6566  | "ConfChangeRef
+00005910: 2229 202d 3e20 436f 6e66 5374 6174 653a  ") -> ConfState:
+00005920: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00005930: 2020 2020 2041 7070 6c69 6573 2061 2063       Applies a c
+00005940: 6f6e 6669 6720 6368 616e 6765 2074 6f20  onfig change to 
+00005950: 7468 6520 6c6f 6361 6c20 6e6f 6465 2e20  the local node. 
+00005960: 5468 6520 6170 7020 6d75 7374 2063 616c  The app must cal
+00005970: 6c20 7468 6973 2077 6865 6e20 6974 0a20  l this when it. 
+00005980: 2020 2020 2020 2061 7070 6c69 6573 2061         applies a
+00005990: 2063 6f6e 6669 6775 7261 7469 6f6e 2063   configuration c
+000059a0: 6861 6e67 652c 2065 7863 6570 7420 7768  hange, except wh
+000059b0: 656e 2069 7420 6465 6369 6465 7320 746f  en it decides to
+000059c0: 2072 656a 6563 7420 7468 650a 2020 2020   reject the.    
+000059d0: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
+000059e0: 6e20 6368 616e 6765 2c20 696e 2077 6869  n change, in whi
+000059f0: 6368 2063 6173 6520 6e6f 2063 616c 6c20  ch case no call 
+00005a00: 6d75 7374 2074 616b 6520 706c 6163 652e  must take place.
+00005a10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00005a20: 2064 6566 2061 7070 6c79 5f63 6f6e 665f   def apply_conf_
+00005a30: 6368 616e 6765 5f76 3228 0a20 2020 2020  change_v2(.     
+00005a40: 2020 2073 656c 662c 2063 633a 2022 436f     self, cc: "Co
+00005a50: 6e66 4368 616e 6765 5632 2220 7c20 2243  nfChangeV2" | "C
+00005a60: 6f6e 6643 6861 6e67 6556 3252 6566 220a  onfChangeV2Ref".
+00005a70: 2020 2020 2920 2d3e 2022 436f 6e66 5374      ) -> "ConfSt
+00005a80: 6174 6522 3a0a 2020 2020 2020 2020 2222  ate":.        ""
+00005a90: 220a 2020 2020 2020 2020 4170 706c 6965  ".        Applie
+00005aa0: 7320 6120 636f 6e66 6967 2063 6861 6e67  s a config chang
+00005ab0: 6520 746f 2074 6865 206c 6f63 616c 206e  e to the local n
+00005ac0: 6f64 652e 2054 6865 2061 7070 206d 7573  ode. The app mus
+00005ad0: 7420 6361 6c6c 2074 6869 7320 7768 656e  t call this when
+00005ae0: 2069 740a 2020 2020 2020 2020 6170 706c   it.        appl
+00005af0: 6965 7320 6120 636f 6e66 6967 7572 6174  ies a configurat
+00005b00: 696f 6e20 6368 616e 6765 2c20 6578 6365  ion change, exce
+00005b10: 7074 2077 6865 6e20 6974 2064 6563 6964  pt when it decid
+00005b20: 6573 2074 6f20 7265 6a65 6374 2074 6865  es to reject the
+00005b30: 0a20 2020 2020 2020 2063 6f6e 6669 6775  .        configu
+00005b40: 7261 7469 6f6e 2063 6861 6e67 652c 2069  ration change, i
+00005b50: 6e20 7768 6963 6820 6361 7365 206e 6f20  n which case no 
+00005b60: 6361 6c6c 206d 7573 7420 7461 6b65 2070  call must take p
+00005b70: 6c61 6365 2e0a 2020 2020 2020 2020 2222  lace..        ""
+00005b80: 220a 2020 2020 6465 6620 7069 6e67 2873  ".    def ping(s
+00005b90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00005ba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00005bb0: 2020 4272 6f61 6463 6173 7420 6865 6172    Broadcast hear
+00005bc0: 7462 6561 7473 2074 6f20 616c 6c20 7468  tbeats to all th
+00005bd0: 6520 666f 6c6c 6f77 6572 732e 0a0a 2020  e followers...  
+00005be0: 2020 2020 2020 4966 2069 7427 7320 6e6f        If it's no
+00005bf0: 7420 6c65 6164 6572 2c20 6e6f 7468 696e  t leader, nothin
+00005c00: 6720 7769 6c6c 2068 6170 7065 6e2e 0a20  g will happen.. 
+00005c10: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00005c20: 6566 206f 6e5f 7065 7273 6973 745f 7265  ef on_persist_re
+00005c30: 6164 7928 7365 6c66 2c20 6e75 6d62 6572  ady(self, number
+00005c40: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
+00005c50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00005c60: 2020 2020 4e6f 7469 6669 6573 2074 6861      Notifies tha
+00005c70: 7420 7468 6520 7265 6164 7920 6f66 2074  t the ready of t
+00005c80: 6869 7320 6e75 6d62 6572 2068 6173 2062  his number has b
+00005c90: 6565 6e20 7065 7273 6973 7465 642e 0a0a  een persisted...
+00005ca0: 2020 2020 2020 2020 5369 6e63 6520 5265          Since Re
+00005cb0: 6164 7920 6d75 7374 2062 6520 7065 7273  ady must be pers
+00005cc0: 6973 7465 6420 696e 206f 7264 6572 2c20  isted in order, 
+00005cd0: 6361 6c6c 696e 6720 7468 6973 2066 756e  calling this fun
+00005ce0: 6374 696f 6e20 696d 706c 6963 6974 6c79  ction implicitly
+00005cf0: 206d 6561 6e73 0a20 2020 2020 2020 2061   means.        a
+00005d00: 6c6c 2072 6561 6469 6573 2077 6974 6820  ll readies with 
+00005d10: 6e75 6d62 6572 7320 736d 616c 6c65 7220  numbers smaller 
+00005d20: 7468 616e 2074 6869 7320 6f6e 6520 6861  than this one ha
+00005d30: 7665 2062 6565 6e20 7065 7273 6973 7465  ve been persiste
+00005d40: 642e 0a0a 2020 2020 2020 2020 5b60 5365  d...        [`Se
+00005d50: 6c66 3a3a 6861 735f 7265 6164 7960 5d20  lf::has_ready`] 
+00005d60: 616e 6420 5b60 5365 6c66 3a3a 7265 6164  and [`Self::read
+00005d70: 7960 5d20 7368 6f75 6c64 2062 6520 6361  y`] should be ca
+00005d80: 6c6c 6564 206c 6174 6572 2074 6f20 6861  lled later to ha
+00005d90: 6e64 6c65 2066 7572 7468 6572 0a20 2020  ndle further.   
+00005da0: 2020 2020 2075 7064 6174 6573 2074 6861       updates tha
+00005db0: 7420 6265 636f 6d65 2076 616c 6964 2061  t become valid a
+00005dc0: 6674 6572 2072 6561 6479 2062 6569 6e67  fter ready being
+00005dd0: 2070 6572 7369 7374 6564 2e0a 2020 2020   persisted..    
+00005de0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00005df0: 7265 6164 5f69 6e64 6578 2873 656c 662c  read_index(self,
+00005e00: 2072 6374 783a 2062 7974 6573 2920 2d3e   rctx: bytes) ->
+00005e10: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00005e20: 2222 0a20 2020 2020 2020 2052 6561 6449  "".        ReadI
+00005e30: 6e64 6578 2072 6571 7565 7374 7320 6120  ndex requests a 
+00005e40: 7265 6164 2073 7461 7465 2e20 5468 6520  read state. The 
+00005e50: 7265 6164 2073 7461 7465 2077 696c 6c20  read state will 
+00005e60: 6265 2073 6574 2069 6e20 7265 6164 792e  be set in ready.
+00005e70: 0a20 2020 2020 2020 2052 6561 6420 5374  .        Read St
+00005e80: 6174 6520 6861 7320 6120 7265 6164 2069  ate has a read i
+00005e90: 6e64 6578 2e20 4f6e 6365 2074 6865 2061  ndex. Once the a
+00005ea0: 7070 6c69 6361 7469 6f6e 2061 6476 616e  pplication advan
+00005eb0: 6365 7320 6675 7274 6865 7220 7468 616e  ces further than
+00005ec0: 2074 6865 2072 6561 640a 2020 2020 2020   the read.      
+00005ed0: 2020 696e 6465 782c 2061 6e79 206c 696e    index, any lin
+00005ee0: 6561 7269 7a61 626c 6520 7265 6164 2072  earizable read r
+00005ef0: 6571 7565 7374 7320 6973 7375 6564 2062  equests issued b
+00005f00: 6566 6f72 6520 7468 6520 7265 6164 2072  efore the read r
+00005f10: 6571 7565 7374 2063 616e 2062 650a 2020  equest can be.  
+00005f20: 2020 2020 2020 7072 6f63 6573 7365 6420        processed 
+00005f30: 7361 6665 6c79 2e20 5468 6520 7265 6164  safely. The read
+00005f40: 2073 7461 7465 2077 696c 6c20 6861 7665   state will have
+00005f50: 2074 6865 2073 616d 6520 7263 7478 2061   the same rctx a
+00005f60: 7474 6163 6865 642e 0a20 2020 2020 2020  ttached..       
+00005f70: 2022 2222 0a20 2020 2064 6566 2072 6561   """.    def rea
+00005f80: 6479 2873 656c 6629 202d 3e20 5265 6164  dy(self) -> Read
+00005f90: 793a 0a20 2020 2020 2020 2022 2222 0a20  y:.        """. 
+00005fa0: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
+00005fb0: 6865 206f 7574 7374 616e 6469 6e67 2077  he outstanding w
+00005fc0: 6f72 6b20 7468 6174 2074 6865 2061 7070  ork that the app
+00005fd0: 6c69 6361 7469 6f6e 206e 6565 6473 2074  lication needs t
+00005fe0: 6f20 6861 6e64 6c65 2e0a 0a20 2020 2020  o handle...     
+00005ff0: 2020 2054 6869 7320 696e 636c 7564 6573     This includes
+00006000: 2061 7070 656e 6469 6e67 2061 6e64 2061   appending and a
+00006010: 7070 6c79 696e 6720 656e 7472 6965 7320  pplying entries 
+00006020: 6f72 2061 2073 6e61 7073 686f 742c 2075  or a snapshot, u
+00006030: 7064 6174 696e 6720 7468 6520 4861 7264  pdating the Hard
+00006040: 5374 6174 652c 0a20 2020 2020 2020 2061  State,.        a
+00006050: 6e64 2073 656e 6469 6e67 206d 6573 7361  nd sending messa
+00006060: 6765 732e 2054 6865 2072 6574 7572 6e65  ges. The returne
+00006070: 6420 6052 6561 6479 6020 2a4d 5553 542a  d `Ready` *MUST*
+00006080: 2062 6520 6861 6e64 6c65 6420 616e 6420   be handled and 
+00006090: 7375 6273 6571 7565 6e74 6c79 0a20 2020  subsequently.   
+000060a0: 2020 2020 2070 6173 7365 6420 6261 636b       passed back
+000060b0: 2076 6961 2060 6164 7661 6e63 6560 206f   via `advance` o
+000060c0: 7220 6974 7320 6661 6d69 6c69 6573 2e20  r its families. 
+000060d0: 4265 666f 7265 2074 6861 742c 202a 444f  Before that, *DO
+000060e0: 204e 4f54 2a20 6361 6c6c 2061 6e79 2066   NOT* call any f
+000060f0: 756e 6374 696f 6e20 6c69 6b65 0a20 2020  unction like.   
+00006100: 2020 2020 2060 7374 6570 602c 2060 7072       `step`, `pr
+00006110: 6f70 6f73 6560 2c20 6063 616d 7061 6967  opose`, `campaig
+00006120: 6e60 2074 6f20 6368 616e 6765 2069 6e74  n` to change int
+00006130: 6572 6e61 6c20 7374 6174 652e 0a0a 2020  ernal state...  
+00006140: 2020 2020 2020 5b60 5365 6c66 3a3a 6861        [`Self::ha
+00006150: 735f 7265 6164 7960 5d20 7368 6f75 6c64  s_ready`] should
+00006160: 2062 6520 6361 6c6c 6564 2066 6972 7374   be called first
+00006170: 2074 6f20 6368 6563 6b20 6966 2069 7427   to check if it'
+00006180: 7320 6e65 6365 7373 6172 7920 746f 2068  s necessary to h
+00006190: 616e 646c 6520 7468 6520 7265 6164 792e  andle the ready.
+000061a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000061b0: 2064 6566 2072 6571 7565 7374 5f73 6e61   def request_sna
+000061c0: 7073 686f 7428 7365 6c66 2920 2d3e 2022  pshot(self) -> "
+000061d0: 5265 6164 7922 3a0a 2020 2020 2020 2020  Ready":.        
+000061e0: 2222 220a 2020 2020 2020 2020 5265 7175  """.        Requ
+000061f0: 6573 7420 6120 736e 6170 7368 6f74 2066  est a snapshot f
+00006200: 726f 6d20 6120 6c65 6164 6572 2e0a 2020  rom a leader..  
+00006210: 2020 2020 2020 5468 6520 736e 6170 7368        The snapsh
+00006220: 6f74 2773 2069 6e64 6578 206d 7573 7420  ot's index must 
+00006230: 6265 2067 7265 6174 6572 206f 7220 6571  be greater or eq
+00006240: 7561 6c20 746f 2074 6865 2072 6571 7565  ual to the reque
+00006250: 7374 5f69 6e64 6578 2028 6c61 7374 5f69  st_index (last_i
+00006260: 6e64 6578 2920 6f72 0a20 2020 2020 2020  ndex) or.       
+00006270: 2074 6865 206c 6561 6465 7227 7320 7465   the leader's te
+00006280: 726d 206d 7573 7420 6265 2067 7265 6174  rm must be great
+00006290: 6572 2074 6861 6e20 7468 6520 7265 7175  er than the requ
+000062a0: 6573 7420 7465 726d 2028 6c61 7374 5f69  est term (last_i
+000062b0: 6e64 6578 2773 2074 6572 6d29 2e0a 2020  ndex's term)..  
+000062c0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+000062d0: 6620 6f6e 5f65 6e74 7269 6573 5f66 6574  f on_entries_fet
+000062e0: 6368 6564 2873 656c 6629 202d 3e20 4e6f  ched(self) -> No
+000062f0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00006300: 2020 2020 2020 2020 4120 6361 6c6c 6261          A callba
+00006310: 636b 2077 6865 6e20 656e 7472 6965 7320  ck when entries 
+00006320: 6172 6520 6665 7463 6865 6420 6173 796e  are fetched asyn
+00006330: 6368 726f 6e6f 7573 6c79 2e0a 2020 2020  chronously..    
+00006340: 2020 2020 5468 6520 636f 6e74 6578 7420      The context 
+00006350: 7368 6f75 6c64 2070 726f 7669 6465 2074  should provide t
+00006360: 6865 2063 6f6e 7465 7874 2070 6173 7365  he context passe
+00006370: 6420 6672 6f6d 2053 746f 7261 6765 2e65  d from Storage.e
+00006380: 6e74 6972 6573 2829 2e0a 2020 2020 2020  ntires()..      
+00006390: 2020 5365 6520 6d6f 7265 2069 6e20 7468    See more in th
+000063a0: 6520 636f 6d6d 656e 7420 6f66 2053 746f  e comment of Sto
+000063b0: 7261 6765 2e65 6e74 6972 6573 2829 2e0a  rage.entires()..
+000063c0: 0a20 2020 2020 2020 2023 2050 616e 6963  .        # Panic
+000063d0: 730a 0a20 2020 2020 2020 2050 616e 6963  s..        Panic
+000063e0: 7320 6966 2070 6173 7365 6420 7769 7468  s if passed with
+000063f0: 2074 6865 2063 6f6e 7465 7874 206f 6620   the context of 
+00006400: 636f 6e74 6578 742e 6361 6e5f 6173 796e  context.can_asyn
+00006410: 6328 2920 3d3d 2066 616c 7365 0a20 2020  c() == false.   
+00006420: 2020 2020 2022 2222 0a0a 636c 6173 7320       """..class 
+00006430: 496e 4d65 6d6f 7279 5261 774e 6f64 6528  InMemoryRawNode(
+00006440: 5f5f 4150 495f 5261 774e 6f64 6529 3a0a  __API_RawNode):.
+00006450: 2020 2020 2222 220a 2020 2020 5261 774e      """.    RawN
+00006460: 6f64 6520 6973 2061 2074 6872 6561 642d  ode is a thread-
+00006470: 756e 7361 6665 204e 6f64 652e 0a20 2020  unsafe Node..   
+00006480: 2054 6865 206d 6574 686f 6473 206f 6620   The methods of 
+00006490: 7468 6973 2073 7472 7563 7420 636f 7272  this struct corr
+000064a0: 6573 706f 6e64 2074 6f20 7468 6520 6d65  espond to the me
+000064b0: 7468 6f64 7320 6f66 204e 6f64 6520 616e  thods of Node an
+000064c0: 6420 6172 6520 6465 7363 7269 6265 640a  d are described.
+000064d0: 2020 2020 6d6f 7265 2066 756c 6c79 2074      more fully t
+000064e0: 6865 7265 2e0a 2020 2020 2222 220a 0a20  here..    """.. 
+000064f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00006500: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00006510: 2020 2020 2020 2063 6667 3a20 2243 6f6e         cfg: "Con
+00006520: 6669 6722 207c 2022 436f 6e66 6967 5265  fig" | "ConfigRe
+00006530: 6622 2c0a 2020 2020 2020 2020 7374 6f72  f",.        stor
+00006540: 653a 2022 4d65 6d53 746f 7261 6765 2220  e: "MemStorage" 
+00006550: 7c20 224d 656d 5374 6f72 6167 6552 6566  | "MemStorageRef
+00006560: 222c 0a20 2020 2020 2020 206c 6f67 6765  ",.        logge
+00006570: 723a 2022 4c6f 6767 6572 2220 7c20 224c  r: "Logger" | "L
+00006580: 6f67 6765 7252 6566 222c 0a20 2020 2029  oggerRef",.    )
+00006590: 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020   -> None: ....  
+000065a0: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
+000065b0: 656c 6629 202d 3e20 2249 6e4d 656d 6f72  elf) -> "InMemor
+000065c0: 7952 6177 4e6f 6465 5265 6622 3a20 2e2e  yRawNodeRef": ..
+000065d0: 2e0a 2020 2020 6465 6620 6765 745f 7261  ..    def get_ra
+000065e0: 6674 2873 656c 6629 202d 3e20 2249 6e4d  ft(self) -> "InM
+000065f0: 656d 6f72 7952 6166 7452 6566 223a 0a20  emoryRaftRef":. 
+00006600: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+00006610: 2020 2064 6566 2073 746f 7265 2873 656c     def store(sel
+00006620: 6629 202d 3e20 224d 656d 5374 6f72 6167  f) -> "MemStorag
+00006630: 6552 6566 223a 0a20 2020 2020 2020 2022  eRef":.        "
+00006640: 2222 5265 7475 726e 7320 7468 6520 7374  ""Returns the st
+00006650: 6f72 6520 6173 2061 206d 7574 6162 6c65  ore as a mutable
+00006660: 2072 6566 6572 656e 6365 2e22 2222 0a0a   reference."""..
+00006670: 636c 6173 7320 496e 4d65 6d6f 7279 5261  class InMemoryRa
+00006680: 774e 6f64 6552 6566 285f 5f41 5049 5f52  wNodeRef(__API_R
+00006690: 6177 4e6f 6465 293a 0a20 2020 2022 2222  awNode):.    """
+000066a0: 0a20 2020 2052 6566 6572 656e 6365 2074  .    Reference t
+000066b0: 7970 6520 6f66 203a 636c 6173 733a 6049  ype of :class:`I
+000066c0: 6e4d 656d 6f72 7952 6177 4e6f 6465 602e  nMemoryRawNode`.
+000066d0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+000066e0: 6620 6765 745f 7261 6674 2873 656c 6629  f get_raft(self)
+000066f0: 202d 3e20 2249 6e4d 656d 6f72 7952 6166   -> "InMemoryRaf
+00006700: 7452 6566 223a 0a20 2020 2020 2020 2022  tRef":.        "
+00006710: 2222 2022 2222 0a20 2020 2064 6566 2073  "" """.    def s
+00006720: 746f 7265 2873 656c 6629 202d 3e20 224d  tore(self) -> "M
+00006730: 656d 5374 6f72 6167 6552 6566 223a 0a20  emStorageRef":. 
+00006740: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00006750: 7320 7468 6520 7374 6f72 6520 6173 2061  s the store as a
+00006760: 206d 7574 6162 6c65 2072 6566 6572 656e   mutable referen
+00006770: 6365 2e22 2222 0a20 2020 2023 2064 6566  ce.""".    # def
+00006780: 2073 7461 7475 7328 7365 6c66 2920 2d3e   status(self) ->
+00006790: 2049 6e4d 656d 6f72 7953 7461 7475 733a   InMemoryStatus:
+000067a0: 0a20 2020 2023 2020 2020 2022 2222 0a20  .    #     """. 
+000067b0: 2020 2023 2020 2020 2053 7461 7475 7320     #     Status 
+000067c0: 7265 7475 726e 7320 7468 6520 6375 7272  returns the curr
+000067d0: 656e 7420 7374 6174 7573 206f 6620 7468  ent status of th
+000067e0: 6520 6769 7665 6e20 6772 6f75 702e 0a20  e given group.. 
+000067f0: 2020 2023 2020 2020 2022 2222 0a0a 636c     #     """..cl
+00006800: 6173 7320 5261 774e 6f64 6528 5f5f 4150  ass RawNode(__AP
+00006810: 495f 5261 774e 6f64 6529 3a0a 2020 2020  I_RawNode):.    
+00006820: 2222 220a 2020 2020 5261 774e 6f64 6520  """.    RawNode 
+00006830: 6973 2061 2074 6872 6561 642d 756e 7361  is a thread-unsa
+00006840: 6665 204e 6f64 652e 0a20 2020 2054 6865  fe Node..    The
+00006850: 206d 6574 686f 6473 206f 6620 7468 6973   methods of this
+00006860: 2073 7472 7563 7420 636f 7272 6573 706f   struct correspo
+00006870: 6e64 2074 6f20 7468 6520 6d65 7468 6f64  nd to the method
+00006880: 7320 6f66 204e 6f64 6520 616e 6420 6172  s of Node and ar
+00006890: 6520 6465 7363 7269 6265 640a 2020 2020  e described.    
+000068a0: 6d6f 7265 2066 756c 6c79 2074 6865 7265  more fully there
+000068b0: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+000068c0: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
+000068d0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000068e0: 2020 2063 6667 3a20 2243 6f6e 6669 6722     cfg: "Config"
+000068f0: 207c 2022 436f 6e66 6967 5265 6622 2c0a   | "ConfigRef",.
+00006900: 2020 2020 2020 2020 7374 6f72 653a 2022          store: "
+00006910: 5374 6f72 6167 6522 207c 2022 5374 6f72  Storage" | "Stor
+00006920: 6167 6552 6566 222c 0a20 2020 2020 2020  ageRef",.       
+00006930: 206c 6f67 6765 723a 2022 4c6f 6767 6572   logger: "Logger
+00006940: 2220 7c20 224c 6f67 6765 7252 6566 222c  " | "LoggerRef",
+00006950: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a20  .    ) -> None: 
+00006960: 2e2e 2e0a 2020 2020 6465 6620 6d61 6b65  ....    def make
+00006970: 5f72 6566 2873 656c 6629 202d 3e20 2252  _ref(self) -> "R
+00006980: 6177 4e6f 6465 5265 6622 3a20 2e2e 2e0a  awNodeRef": ....
+00006990: 2020 2020 6465 6620 6765 745f 7261 6674      def get_raft
+000069a0: 2873 656c 6629 202d 3e20 2252 6166 7452  (self) -> "RaftR
+000069b0: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+000069c0: 2022 2222 0a20 2020 2064 6566 2073 746f   """.    def sto
+000069d0: 7265 2873 656c 6629 202d 3e20 2253 746f  re(self) -> "Sto
+000069e0: 7261 6765 5265 6622 3a0a 2020 2020 2020  rageRef":.      
+000069f0: 2020 2222 2252 6574 7572 6e73 2074 6865    """Returns the
+00006a00: 2073 746f 7265 2061 7320 6120 6d75 7461   store as a muta
+00006a10: 626c 6520 7265 6665 7265 6e63 652e 2222  ble reference.""
+00006a20: 220a 2020 2020 2320 6465 6620 7374 6174  ".    # def stat
+00006a30: 7573 2873 656c 6629 202d 3e20 5374 6174  us(self) -> Stat
+00006a40: 7573 3a0a 2020 2020 2320 2020 2020 2222  us:.    #     ""
+00006a50: 220a 2020 2020 2320 2020 2020 5374 6174  ".    #     Stat
+00006a60: 7573 2072 6574 7572 6e73 2074 6865 2063  us returns the c
+00006a70: 7572 7265 6e74 2073 7461 7475 7320 6f66  urrent status of
+00006a80: 2074 6865 2067 6976 656e 2067 726f 7570   the given group
+00006a90: 2e0a 2020 2020 2320 2020 2020 2222 220a  ..    #     """.
+00006aa0: 0a63 6c61 7373 2052 6177 4e6f 6465 5265  .class RawNodeRe
+00006ab0: 6628 5f5f 4150 495f 5261 774e 6f64 6529  f(__API_RawNode)
+00006ac0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
+00006ad0: 6665 7265 6e63 6520 7479 7065 206f 6620  ference type of 
+00006ae0: 3a63 6c61 7373 3a60 5261 774e 6f64 6560  :class:`RawNode`
+00006af0: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00006b00: 6566 2067 6574 5f72 6166 7428 7365 6c66  ef get_raft(self
+00006b10: 2920 2d3e 2022 5261 6674 5265 6622 3a0a  ) -> "RaftRef":.
+00006b20: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
+00006b30: 2020 2020 6465 6620 7374 6f72 6528 7365      def store(se
+00006b40: 6c66 2920 2d3e 2022 5374 6f72 6167 6552  lf) -> "StorageR
+00006b50: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+00006b60: 5265 7475 726e 7320 7468 6520 7374 6f72  Returns the stor
+00006b70: 6520 6173 2061 206d 7574 6162 6c65 2072  e as a mutable r
+00006b80: 6566 6572 656e 6365 2e22 2222 0a20 2020  eference.""".   
+00006b90: 2023 2064 6566 2073 7461 7475 7328 7365   # def status(se
+00006ba0: 6c66 2920 2d3e 2049 6e4d 656d 6f72 7953  lf) -> InMemoryS
+00006bb0: 7461 7475 733a 0a20 2020 2023 2020 2020  tatus:.    #    
+00006bc0: 2022 2222 0a20 2020 2023 2020 2020 2053   """.    #     S
+00006bd0: 7461 7475 7320 7265 7475 726e 7320 7468  tatus returns th
+00006be0: 6520 6375 7272 656e 7420 7374 6174 7573  e current status
+00006bf0: 206f 6620 7468 6520 6769 7665 6e20 6772   of the given gr
+00006c00: 6f75 702e 0a20 2020 2023 2020 2020 2022  oup..    #     "
+00006c10: 2222 0a0a 636c 6173 7320 5f5f 4150 495f  ""..class __API_
+00006c20: 5065 6572 3a0a 2020 2020 6465 6620 6765  Peer:.    def ge
+00006c30: 745f 6964 2873 656c 6629 202d 3e20 696e  t_id(self) -> in
+00006c40: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+00006c50: 2020 2020 2020 2060 6964 603a 2054 6865         `id`: The
+00006c60: 2049 4420 6f66 2074 6865 2070 6565 722e   ID of the peer.
+00006c70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00006c80: 2064 6566 2073 6574 5f69 6428 7365 6c66   def set_id(self
+00006c90: 2c20 6964 3a20 696e 7429 202d 3e20 4e6f  , id: int) -> No
+00006ca0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00006cb0: 2020 2020 2020 2020 6069 6460 3a20 5468          `id`: Th
+00006cc0: 6520 4944 206f 6620 7468 6520 7065 6572  e ID of the peer
+00006cd0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00006ce0: 2020 6465 6620 6765 745f 636f 6e74 6578    def get_contex
+00006cf0: 7428 7365 6c66 2920 2d3e 2062 7974 6573  t(self) -> bytes
+00006d00: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00006d10: 2020 2020 2020 6063 6f6e 7465 7874 603a        `context`:
+00006d20: 2049 6620 7468 6572 6520 6973 2063 6f6e   If there is con
+00006d30: 7465 7874 2061 7373 6f63 6961 7465 6420  text associated 
+00006d40: 7769 7468 2074 6865 2070 6565 7220 286c  with the peer (l
+00006d50: 696b 6520 636f 6e6e 6563 7469 6f6e 2069  ike connection i
+00006d60: 6e66 6f72 6d61 7469 6f6e 292c 2069 7420  nformation), it 
+00006d70: 6361 6e20 6265 0a20 2020 2020 2020 2073  can be.        s
+00006d80: 6572 6961 6c69 7a65 6420 616e 6420 7374  erialized and st
+00006d90: 6f72 6564 2068 6572 652e 0a20 2020 2020  ored here..     
+00006da0: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
+00006db0: 6574 5f63 6f6e 7465 7874 2873 656c 662c  et_context(self,
+00006dc0: 2063 6f6e 7465 7874 3a20 6279 7465 7329   context: bytes)
+00006dd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00006de0: 2020 2222 220a 2020 2020 2020 2020 6063    """.        `c
+00006df0: 6f6e 7465 7874 603a 2049 6620 7468 6572  ontext`: If ther
+00006e00: 6520 6973 2063 6f6e 7465 7874 2061 7373  e is context ass
+00006e10: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
+00006e20: 2070 6565 7220 286c 696b 6520 636f 6e6e   peer (like conn
+00006e30: 6563 7469 6f6e 2069 6e66 6f72 6d61 7469  ection informati
+00006e40: 6f6e 292c 2069 7420 6361 6e20 6265 0a20  on), it can be. 
+00006e50: 2020 2020 2020 2073 6572 6961 6c69 7a65         serialize
+00006e60: 6420 616e 6420 7374 6f72 6564 2068 6572  d and stored her
+00006e70: 652e 0a20 2020 2020 2020 2022 2222 0a0a  e..        """..
+00006e80: 636c 6173 7320 5065 6572 285f 5f41 5049  class Peer(__API
+00006e90: 5f50 6565 7229 3a0a 2020 2020 2222 220a  _Peer):.    """.
+00006ea0: 2020 2020 5265 7072 6573 656e 7473 2061      Represents a
+00006eb0: 2050 6565 7220 6e6f 6465 2069 6e20 7468   Peer node in th
+00006ec0: 6520 636c 7573 7465 722e 0a20 2020 2022  e cluster..    "
+00006ed0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00006ee0: 6974 5f5f 2873 656c 6629 202d 3e20 4e6f  it__(self) -> No
+00006ef0: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
+00006f00: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+00006f10: 3e20 2250 6565 7252 6566 223a 202e 2e2e  > "PeerRef": ...
+00006f20: 0a0a 636c 6173 7320 5065 6572 5265 6628  ..class PeerRef(
+00006f30: 5f5f 4150 495f 5065 6572 293a 0a20 2020  __API_Peer):.   
+00006f40: 2022 2222 0a20 2020 2052 6566 6572 656e   """.    Referen
+00006f50: 6365 2074 7970 6520 6f66 203a 636c 6173  ce type of :clas
+00006f60: 733a 6050 6565 7260 2e0a 2020 2020 2222  s:`Peer`..    ""
+00006f70: 220a 0a63 6c61 7373 205f 5f41 5049 5f4c  "..class __API_L
+00006f80: 6967 6874 5265 6164 793a 0a20 2020 2064  ightReady:.    d
+00006f90: 6566 2063 6f6d 6d69 745f 696e 6465 7828  ef commit_index(
+00006fa0: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
+00006fb0: 6c5b 696e 745d 3a0a 2020 2020 2020 2020  l[int]:.        
+00006fc0: 2222 220a 2020 2020 2020 2020 5468 6520  """.        The 
+00006fd0: 6375 7272 656e 7420 636f 6d6d 6974 2069  current commit i
+00006fe0: 6e64 6578 2e0a 2020 2020 2020 2020 4974  ndex..        It
+00006ff0: 2077 696c 6c20 6265 204e 6f6e 6520 7374   will be None st
+00007000: 6174 6520 6966 2074 6865 7265 2069 7320  ate if there is 
+00007010: 6e6f 2075 7064 6174 652e 0a20 2020 2020  no update..     
+00007020: 2020 2049 7420 6973 206e 6f74 2072 6571     It is not req
+00007030: 7569 7265 6420 746f 2073 6176 6520 6974  uired to save it
+00007040: 2074 6f20 7374 6162 6c65 2073 746f 7261   to stable stora
+00007050: 6765 2e0a 2020 2020 2020 2020 2222 220a  ge..        """.
+00007060: 2020 2020 6465 6620 636f 6d6d 6974 7465      def committe
+00007070: 645f 656e 7472 6965 7328 7365 6c66 2920  d_entries(self) 
+00007080: 2d3e 204c 6973 745b 2245 6e74 7279 5265  -> List["EntryRe
+00007090: 6622 5d3a 0a20 2020 2020 2020 2022 2222  f"]:.        """
+000070a0: 0a20 2020 2020 2020 2043 6f6d 6d69 7474  .        Committ
+000070b0: 6564 456e 7472 6965 7320 7370 6563 6966  edEntries specif
+000070c0: 6965 7320 656e 7472 6965 7320 746f 2062  ies entries to b
+000070d0: 6520 636f 6d6d 6974 7465 6420 746f 2061  e committed to a
+000070e0: 0a20 2020 2020 2020 2073 746f 7265 2f73  .        store/s
+000070f0: 7461 7465 2d6d 6163 6869 6e65 2e20 5468  tate-machine. Th
+00007100: 6573 6520 6861 7665 2070 7265 7669 6f75  ese have previou
+00007110: 736c 7920 6265 656e 2063 6f6d 6d69 7474  sly been committ
+00007120: 6564 2074 6f20 7374 6162 6c65 0a20 2020  ed to stable.   
+00007130: 2020 2020 2073 746f 7265 2e0a 2020 2020       store..    
+00007140: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00007150: 7461 6b65 5f63 6f6d 6d69 7474 6564 5f65  take_committed_e
+00007160: 6e74 7269 6573 2873 656c 6629 202d 3e20  ntries(self) -> 
+00007170: 4c69 7374 5b22 456e 7472 7922 5d3a 0a20  List["Entry"]:. 
+00007180: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007190: 2020 2054 616b 6520 7468 6520 436f 6d6d     Take the Comm
+000071a0: 6974 456e 7472 6965 732e 0a20 2020 2020  itEntries..     
+000071b0: 2020 2022 2222 0a20 2020 2064 6566 206d     """.    def m
+000071c0: 6573 7361 6765 7328 7365 6c66 2920 2d3e  essages(self) ->
+000071d0: 204c 6973 745b 224d 6573 7361 6765 5265   List["MessageRe
+000071e0: 6622 5d3a 0a20 2020 2020 2020 2022 2222  f"]:.        """
+000071f0: 0a20 2020 2020 2020 204d 6573 7361 6765  .        Message
+00007200: 7320 7370 6563 6966 6965 7320 6f75 7462  s specifies outb
+00007210: 6f75 6e64 206d 6573 7361 6765 7320 746f  ound messages to
+00007220: 2062 6520 7365 6e74 2e0a 2020 2020 2020   be sent..      
+00007230: 2020 2222 220a 2020 2020 6465 6620 7461    """.    def ta
+00007240: 6b65 5f6d 6573 7361 6765 7328 7365 6c66  ke_messages(self
+00007250: 2920 2d3e 204c 6973 745b 224d 6573 7361  ) -> List["Messa
+00007260: 6765 225d 3a0a 2020 2020 2020 2020 2222  ge"]:.        ""
+00007270: 220a 2020 2020 2020 2020 5461 6b65 2074  ".        Take t
+00007280: 6865 204d 6573 7361 6765 732e 0a20 2020  he Messages..   
+00007290: 2020 2020 2022 2222 0a0a 636c 6173 7320       """..class 
+000072a0: 4c69 6768 7452 6561 6479 285f 5f41 5049  LightReady(__API
+000072b0: 5f4c 6967 6874 5265 6164 7929 3a0a 2020  _LightReady):.  
+000072c0: 2020 2222 220a 2020 2020 4c69 6768 7452    """.    LightR
+000072d0: 6561 6479 2065 6e63 6170 7375 6c61 7465  eady encapsulate
+000072e0: 7320 7468 6520 636f 6d6d 6974 2069 6e64  s the commit ind
+000072f0: 6578 2c20 636f 6d6d 6974 7465 6420 656e  ex, committed en
+00007300: 7472 6965 7320 616e 640a 2020 2020 6d65  tries and.    me
+00007310: 7373 6167 6573 2074 6861 7420 6172 6520  ssages that are 
+00007320: 7265 6164 7920 746f 2062 6520 6170 706c  ready to be appl
+00007330: 6965 6420 6f72 2062 6520 7365 6e74 2074  ied or be sent t
+00007340: 6f20 6f74 6865 7220 7065 6572 732e 0a20  o other peers.. 
+00007350: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+00007360: 5f5f 696e 6974 5f5f 2873 656c 6629 202d  __init__(self) -
+00007370: 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020 2020  > None: ....    
+00007380: 6465 6620 6d61 6b65 5f72 6566 2873 656c  def make_ref(sel
+00007390: 6629 202d 3e20 224c 6967 6874 5265 6164  f) -> "LightRead
+000073a0: 7952 6566 223a 202e 2e2e 0a20 2020 2040  yRef": ....    @
+000073b0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+000073c0: 2064 6566 2064 6566 6175 6c74 2829 202d   def default() -
+000073d0: 3e20 224c 6967 6874 5265 6164 7922 3a20  > "LightReady": 
+000073e0: 2e2e 2e0a 0a63 6c61 7373 204c 6967 6874  .....class Light
+000073f0: 5265 6164 7952 6566 285f 5f41 5049 5f4c  ReadyRef(__API_L
+00007400: 6967 6874 5265 6164 7929 3a0a 2020 2020  ightReady):.    
+00007410: 2222 220a 2020 2020 5265 6665 7265 6e63  """.    Referenc
+00007420: 6520 7479 7065 206f 6620 3a63 6c61 7373  e type of :class
+00007430: 3a60 4c69 6768 7452 6561 6479 602e 0a20  :`LightReady`.. 
+00007440: 2020 2022 2222 0a0a 636c 6173 7320 5f5f     """..class __
+00007450: 4150 495f 536e 6170 7368 6f74 4d65 7461  API_SnapshotMeta
+00007460: 6461 7461 285f 5f43 6c6f 6e65 6162 6c65  data(__Cloneable
+00007470: 2c20 5f5f 456e 636f 6465 722c 205f 5f44  , __Encoder, __D
+00007480: 6563 6f64 6572 293a 0a20 2020 2064 6566  ecoder):.    def
+00007490: 2063 6c6f 6e65 2873 656c 6629 202d 3e20   clone(self) -> 
+000074a0: 2253 6e61 7073 686f 744d 6574 6164 6174  "SnapshotMetadat
+000074b0: 6122 3a20 2e2e 2e0a 2020 2020 6465 6620  a": ....    def 
+000074c0: 6765 745f 696e 6465 7828 7365 6c66 2920  get_index(self) 
+000074d0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+000074e0: 2222 220a 2020 2020 2020 2020 6069 6e64  """.        `ind
+000074f0: 6578 603a 2054 6865 2061 7070 6c69 6564  ex`: The applied
+00007500: 2069 6e64 6578 2e0a 2020 2020 2020 2020   index..        
+00007510: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+00007520: 696e 6465 7828 7365 6c66 2c20 696e 6465  index(self, inde
+00007530: 783a 2069 6e74 2920 2d3e 204e 6f6e 653a  x: int) -> None:
+00007540: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007550: 2020 2020 2060 696e 6465 7860 3a20 5468       `index`: Th
+00007560: 6520 6170 706c 6965 6420 696e 6465 782e  e applied index.
+00007570: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007580: 2064 6566 2063 6c65 6172 5f69 6e64 6578   def clear_index
+00007590: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000075a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000075b0: 2020 2020 6069 6e64 6578 603a 2054 6865      `index`: The
+000075c0: 2061 7070 6c69 6564 2069 6e64 6578 2e0a   applied index..
+000075d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000075e0: 6465 6620 6765 745f 7465 726d 2873 656c  def get_term(sel
+000075f0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00007600: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00007610: 7465 726d 603a 2054 6865 2074 6572 6d20  term`: The term 
+00007620: 6f66 2074 6865 2061 7070 6c69 6564 2069  of the applied i
+00007630: 6e64 6578 2e0a 2020 2020 2020 2020 2222  ndex..        ""
+00007640: 220a 2020 2020 6465 6620 7365 745f 7465  ".    def set_te
+00007650: 726d 2873 656c 662c 2074 6572 6d3a 2069  rm(self, term: i
+00007660: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
+00007670: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007680: 2060 7465 726d 603a 2054 6865 2074 6572   `term`: The ter
+00007690: 6d20 6f66 2074 6865 2061 7070 6c69 6564  m of the applied
+000076a0: 2069 6e64 6578 2e0a 2020 2020 2020 2020   index..        
+000076b0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+000076c0: 725f 7465 726d 2873 656c 6629 202d 3e20  r_term(self) -> 
+000076d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000076e0: 220a 2020 2020 2020 2020 6074 6572 6d60  ".        `term`
+000076f0: 3a20 5468 6520 7465 726d 206f 6620 7468  : The term of th
+00007700: 6520 6170 706c 6965 6420 696e 6465 782e  e applied index.
+00007710: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007720: 2064 6566 2067 6574 5f63 6f6e 665f 7374   def get_conf_st
+00007730: 6174 6528 7365 6c66 2920 2d3e 2022 436f  ate(self) -> "Co
+00007740: 6e66 5374 6174 6552 6566 223a 0a20 2020  nfStateRef":.   
+00007750: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007760: 2060 636f 6e66 5f73 7461 7465 603a 2054   `conf_state`: T
+00007770: 6865 2063 7572 7265 6e74 2060 436f 6e66  he current `Conf
+00007780: 5374 6174 6560 2e0a 2020 2020 2020 2020  State`..        
+00007790: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+000077a0: 636f 6e66 5f73 7461 7465 2873 656c 662c  conf_state(self,
+000077b0: 2063 6f6e 665f 7374 6174 653a 2022 436f   conf_state: "Co
+000077c0: 6e66 5374 6174 6522 207c 2022 436f 6e66  nfState" | "Conf
+000077d0: 5374 6174 6552 6566 2229 202d 3e20 4e6f  StateRef") -> No
+000077e0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+000077f0: 2020 2020 2020 2020 6063 6f6e 665f 7374          `conf_st
+00007800: 6174 6560 3a20 5468 6520 6375 7272 656e  ate`: The curren
+00007810: 7420 6043 6f6e 6653 7461 7465 602e 0a20  t `ConfState`.. 
+00007820: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00007830: 6566 2063 6c65 6172 5f63 6f6e 665f 7374  ef clear_conf_st
+00007840: 6174 6528 7365 6c66 2920 2d3e 204e 6f6e  ate(self) -> Non
+00007850: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00007860: 2020 2020 2020 2060 636f 6e66 5f73 7461         `conf_sta
+00007870: 7465 603a 2054 6865 2063 7572 7265 6e74  te`: The current
+00007880: 2060 436f 6e66 5374 6174 6560 2e0a 2020   `ConfState`..  
+00007890: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+000078a0: 6620 6861 735f 636f 6e66 5f73 7461 7465  f has_conf_state
+000078b0: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
+000078c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000078d0: 2020 2020 6063 6f6e 665f 7374 6174 6560      `conf_state`
+000078e0: 3a20 5468 6520 6375 7272 656e 7420 6043  : The current `C
+000078f0: 6f6e 6653 7461 7465 602e 0a20 2020 2020  onfState`..     
+00007900: 2020 2022 2222 0a0a 636c 6173 7320 536e     """..class Sn
+00007910: 6170 7368 6f74 4d65 7461 6461 7461 285f  apshotMetadata(_
+00007920: 5f41 5049 5f53 6e61 7073 686f 744d 6574  _API_SnapshotMet
+00007930: 6164 6174 6129 3a0a 2020 2020 2222 2220  adata):.    """ 
+00007940: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+00007950: 6e69 745f 5f28 7365 6c66 2920 2d3e 204e  nit__(self) -> N
+00007960: 6f6e 653a 202e 2e2e 0a20 2020 2040 7374  one: ....    @st
+00007970: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00007980: 6566 2064 6566 6175 6c74 2829 202d 3e20  ef default() -> 
+00007990: 2253 6e61 7073 686f 744d 6574 6164 6174  "SnapshotMetadat
+000079a0: 6122 3a20 2e2e 2e0a 2020 2020 4073 7461  a": ....    @sta
+000079b0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+000079c0: 6620 6465 636f 6465 2876 3a20 6279 7465  f decode(v: byte
+000079d0: 7329 202d 3e20 2253 6e61 7073 686f 744d  s) -> "SnapshotM
+000079e0: 6574 6164 6174 6122 3a20 2e2e 2e0a 2020  etadata": ....  
+000079f0: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
+00007a00: 656c 6629 202d 3e20 2253 6e61 7073 686f  elf) -> "Snapsho
+00007a10: 744d 6574 6164 6174 6152 6566 223a 202e  tMetadataRef": .
+00007a20: 2e2e 0a0a 636c 6173 7320 536e 6170 7368  ....class Snapsh
+00007a30: 6f74 4d65 7461 6461 7461 5265 6628 5f5f  otMetadataRef(__
+00007a40: 4150 495f 536e 6170 7368 6f74 4d65 7461  API_SnapshotMeta
+00007a50: 6461 7461 293a 0a20 2020 2022 2222 0a20  data):.    """. 
+00007a60: 2020 2052 6566 6572 656e 6365 2074 7970     Reference typ
+00007a70: 6520 6f66 203a 636c 6173 733a 6053 6e61  e of :class:`Sna
+00007a80: 7073 686f 744d 6574 6164 6174 6160 2e0a  pshotMetadata`..
+00007a90: 2020 2020 2222 220a 0a63 6c61 7373 205f      """..class _
+00007aa0: 5f41 5049 5f53 6e61 7073 686f 7428 5f5f  _API_Snapshot(__
+00007ab0: 436c 6f6e 6561 626c 652c 205f 5f45 6e63  Cloneable, __Enc
+00007ac0: 6f64 6572 2c20 5f5f 4465 636f 6465 7229  oder, __Decoder)
+00007ad0: 3a0a 2020 2020 6465 6620 636c 6f6e 6528  :.    def clone(
+00007ae0: 7365 6c66 2920 2d3e 2022 536e 6170 7368  self) -> "Snapsh
+00007af0: 6f74 223a 202e 2e2e 0a20 2020 2064 6566  ot": ....    def
+00007b00: 2067 6574 5f64 6174 6128 7365 6c66 2920   get_data(self) 
+00007b10: 2d3e 2062 7974 6573 3a0a 2020 2020 2020  -> bytes:.      
+00007b20: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00007b30: 6620 7365 745f 6461 7461 2873 656c 662c  f set_data(self,
+00007b40: 2064 6174 613a 2062 7974 6573 2920 2d3e   data: bytes) ->
+00007b50: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00007b60: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
+00007b70: 6c65 6172 5f64 6174 6128 7365 6c66 2920  lear_data(self) 
+00007b80: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00007b90: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+00007ba0: 2067 6574 5f6d 6574 6164 6174 6128 7365   get_metadata(se
+00007bb0: 6c66 2920 2d3e 2022 536e 6170 7368 6f74  lf) -> "Snapshot
+00007bc0: 4d65 7461 6461 7461 5265 6622 3a0a 2020  MetadataRef":.  
+00007bd0: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
+00007be0: 2020 6465 6620 7365 745f 6d65 7461 6461    def set_metada
+00007bf0: 7461 280a 2020 2020 2020 2020 7365 6c66  ta(.        self
+00007c00: 2c20 6d65 7461 5f64 6174 613a 2022 536e  , meta_data: "Sn
+00007c10: 6170 7368 6f74 4d65 7461 6461 7461 2220  apshotMetadata" 
+00007c20: 7c20 2253 6e61 7073 686f 744d 6574 6164  | "SnapshotMetad
+00007c30: 6174 6152 6566 220a 2020 2020 2920 2d3e  ataRef".    ) ->
+00007c40: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00007c50: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
+00007c60: 6c65 6172 5f6d 6574 6164 6174 6128 7365  lear_metadata(se
+00007c70: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00007c80: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00007c90: 2064 6566 2068 6173 5f6d 6574 6164 6174   def has_metadat
+00007ca0: 6128 7365 6c66 2920 2d3e 2062 6f6f 6c3a  a(self) -> bool:
+00007cb0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+00007cc0: 0a0a 636c 6173 7320 536e 6170 7368 6f74  ..class Snapshot
+00007cd0: 285f 5f41 5049 5f53 6e61 7073 686f 7429  (__API_Snapshot)
+00007ce0: 3a0a 2020 2020 2222 2220 2222 220a 0a20  :.    """ """.. 
+00007cf0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00007d00: 7365 6c66 2920 2d3e 204e 6f6e 653a 202e  self) -> None: .
+00007d10: 2e2e 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
+00007d20: 7468 6f64 0a20 2020 2064 6566 2064 6566  thod.    def def
+00007d30: 6175 6c74 2829 202d 3e20 2253 6e61 7073  ault() -> "Snaps
+00007d40: 686f 7422 3a20 2e2e 2e0a 2020 2020 4073  hot": ....    @s
+00007d50: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00007d60: 6465 6620 6465 636f 6465 2876 3a20 6279  def decode(v: by
+00007d70: 7465 7329 202d 3e20 2253 6e61 7073 686f  tes) -> "Snapsho
+00007d80: 7422 3a20 2e2e 2e0a 2020 2020 6465 6620  t": ....    def 
+00007d90: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+00007da0: 3e20 2253 6e61 7073 686f 7452 6566 223a  > "SnapshotRef":
+00007db0: 202e 2e2e 0a0a 636c 6173 7320 536e 6170   .....class Snap
+00007dc0: 7368 6f74 5265 6628 5f5f 4150 495f 536e  shotRef(__API_Sn
+00007dd0: 6170 7368 6f74 293a 0a20 2020 2022 2222  apshot):.    """
+00007de0: 0a20 2020 2052 6566 6572 656e 6365 2074  .    Reference t
+00007df0: 7970 6520 6f66 203a 636c 6173 733a 6053  ype of :class:`S
+00007e00: 6e61 7073 686f 7460 2e0a 2020 2020 2222  napshot`..    ""
+00007e10: 220a 0a63 6c61 7373 205f 5f41 5049 5f4d  "..class __API_M
+00007e20: 6573 7361 6765 285f 5f43 6c6f 6e65 6162  essage(__Cloneab
+00007e30: 6c65 2c20 5f5f 456e 636f 6465 722c 205f  le, __Encoder, _
+00007e40: 5f44 6563 6f64 6572 293a 0a20 2020 2064  _Decoder):.    d
+00007e50: 6566 2063 6c6f 6e65 2873 656c 6629 202d  ef clone(self) -
+00007e60: 3e20 224d 6573 7361 6765 223a 202e 2e2e  > "Message": ...
+00007e70: 0a20 2020 2064 6566 2067 6574 5f63 6f6d  .    def get_com
+00007e80: 6d69 7428 7365 6c66 2920 2d3e 2069 6e74  mit(self) -> int
+00007e90: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
+00007ea0: 220a 2020 2020 6465 6620 7365 745f 636f  ".    def set_co
+00007eb0: 6d6d 6974 2873 656c 662c 2063 6f6d 6d69  mmit(self, commi
+00007ec0: 743a 2069 6e74 2920 2d3e 204e 6f6e 653a  t: int) -> None:
+00007ed0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+00007ee0: 0a20 2020 2064 6566 2063 6c65 6172 5f63  .    def clear_c
+00007ef0: 6f6d 6d69 7428 7365 6c66 2920 2d3e 204e  ommit(self) -> N
+00007f00: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00007f10: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
+00007f20: 5f63 6f6d 6d69 745f 7465 726d 2873 656c  _commit_term(sel
+00007f30: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00007f40: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
+00007f50: 6566 2073 6574 5f63 6f6d 6d69 745f 7465  ef set_commit_te
+00007f60: 726d 2873 656c 662c 2063 6f6d 6d69 745f  rm(self, commit_
+00007f70: 7465 726d 3a20 696e 7429 202d 3e20 4e6f  term: int) -> No
+00007f80: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+00007f90: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+00007fa0: 725f 636f 6d6d 6974 5f74 6572 6d28 7365  r_commit_term(se
+00007fb0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00007fc0: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00007fd0: 2064 6566 2067 6574 5f66 726f 6d28 7365   def get_from(se
+00007fe0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+00007ff0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+00008000: 6465 6620 7365 745f 6672 6f6d 2873 656c  def set_from(sel
+00008010: 662c 2066 726f 6d5f 3a20 696e 7429 202d  f, from_: int) -
+00008020: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00008030: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
+00008040: 636c 6561 725f 6672 6f6d 2873 656c 6629  clear_from(self)
+00008050: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00008060: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00008070: 6620 6765 745f 696e 6465 7828 7365 6c66  f get_index(self
+00008080: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+00008090: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+000080a0: 6620 7365 745f 696e 6465 7828 7365 6c66  f set_index(self
+000080b0: 2c20 696e 6465 783a 2069 6e74 2920 2d3e  , index: int) ->
+000080c0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+000080d0: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
+000080e0: 6c65 6172 5f69 6e64 6578 2873 656c 6629  lear_index(self)
+000080f0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00008100: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00008110: 6620 6765 745f 7465 726d 2873 656c 6629  f get_term(self)
+00008120: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+00008130: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+00008140: 2073 6574 5f74 6572 6d28 7365 6c66 2c20   set_term(self, 
+00008150: 7465 726d 3a20 696e 7429 202d 3e20 4e6f  term: int) -> No
+00008160: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+00008170: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+00008180: 725f 7465 726d 2873 656c 6629 202d 3e20  r_term(self) -> 
+00008190: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000081a0: 2220 2222 220a 2020 2020 6465 6620 6765  " """.    def ge
+000081b0: 745f 6c6f 675f 7465 726d 2873 656c 6629  t_log_term(self)
+000081c0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+000081d0: 2022 2222 0a20 2020 2020 2020 2060 6c6f   """.        `lo
+000081e0: 6754 6572 6d60 3a20 6c6f 6754 6572 6d20  gTerm`: logTerm 
+000081f0: 6973 2067 656e 6572 616c 6c79 2075 7365  is generally use
+00008200: 6420 666f 7220 6170 7065 6e64 696e 6720  d for appending 
+00008210: 5261 6674 206c 6f67 7320 746f 2066 6f6c  Raft logs to fol
+00008220: 6c6f 7765 7273 2e20 466f 7220 6578 616d  lowers. For exam
+00008230: 706c 652c 0a20 2020 2020 2020 2028 7479  ple,.        (ty
+00008240: 7065 3d4d 7367 4170 7065 6e64 2c69 6e64  pe=MsgAppend,ind
+00008250: 6578 3d31 3030 2c6c 6f67 5f74 6572 6d3d  ex=100,log_term=
+00008260: 3529 206d 6561 6e73 206c 6561 6465 7220  5) means leader 
+00008270: 6170 7065 6e64 7320 656e 7472 6965 7320  appends entries 
+00008280: 7374 6172 7469 6e67 2061 740a 2020 2020  starting at.    
+00008290: 2020 2020 696e 6465 783d 3130 312c 2061      index=101, a
+000082a0: 6e64 2074 6865 2074 6572 6d20 6f66 2065  nd the term of e
+000082b0: 6e74 7279 2061 7420 696e 6465 7820 3130  ntry at index 10
+000082c0: 3020 6973 2035 2e0a 2020 2020 2020 2020  0 is 5..        
+000082d0: 2874 7970 653d 4d73 6741 7070 656e 6452  (type=MsgAppendR
+000082e0: 6573 706f 6e73 652c 7265 6a65 6374 3d74  esponse,reject=t
+000082f0: 7275 652c 696e 6465 783d 3130 302c 6c6f  rue,index=100,lo
+00008300: 675f 7465 726d 3d35 2920 6d65 616e 7320  g_term=5) means 
+00008310: 666f 6c6c 6f77 6572 2072 656a 6563 7473  follower rejects
+00008320: 2073 6f6d 650a 2020 2020 2020 2020 656e   some.        en
+00008330: 7472 6965 7320 6672 6f6d 2069 7473 206c  tries from its l
+00008340: 6561 6465 7220 6173 2069 7420 616c 7265  eader as it alre
+00008350: 6164 7920 6861 7320 616e 2065 6e74 7279  ady has an entry
+00008360: 2077 6974 6820 7465 726d 2035 2061 7420   with term 5 at 
+00008370: 696e 6465 7820 3130 302e 0a20 2020 2020  index 100..     
+00008380: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
+00008390: 6574 5f6c 6f67 5f74 6572 6d28 7365 6c66  et_log_term(self
+000083a0: 2c20 6c6f 675f 696e 6465 783a 2069 6e74  , log_index: int
+000083b0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000083c0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+000083d0: 6c6f 6754 6572 6d60 3a20 6c6f 6754 6572  logTerm`: logTer
+000083e0: 6d20 6973 2067 656e 6572 616c 6c79 2075  m is generally u
+000083f0: 7365 6420 666f 7220 6170 7065 6e64 696e  sed for appendin
+00008400: 6720 5261 6674 206c 6f67 7320 746f 2066  g Raft logs to f
+00008410: 6f6c 6c6f 7765 7273 2e20 466f 7220 6578  ollowers. For ex
+00008420: 616d 706c 652c 0a20 2020 2020 2020 2028  ample,.        (
+00008430: 7479 7065 3d4d 7367 4170 7065 6e64 2c69  type=MsgAppend,i
+00008440: 6e64 6578 3d31 3030 2c6c 6f67 5f74 6572  ndex=100,log_ter
+00008450: 6d3d 3529 206d 6561 6e73 206c 6561 6465  m=5) means leade
+00008460: 7220 6170 7065 6e64 7320 656e 7472 6965  r appends entrie
+00008470: 7320 7374 6172 7469 6e67 2061 740a 2020  s starting at.  
+00008480: 2020 2020 2020 696e 6465 783d 3130 312c        index=101,
+00008490: 2061 6e64 2074 6865 2074 6572 6d20 6f66   and the term of
+000084a0: 2065 6e74 7279 2061 7420 696e 6465 7820   entry at index 
+000084b0: 3130 3020 6973 2035 2e0a 2020 2020 2020  100 is 5..      
+000084c0: 2020 2874 7970 653d 4d73 6741 7070 656e    (type=MsgAppen
+000084d0: 6452 6573 706f 6e73 652c 7265 6a65 6374  dResponse,reject
+000084e0: 3d74 7275 652c 696e 6465 783d 3130 302c  =true,index=100,
+000084f0: 6c6f 675f 7465 726d 3d35 2920 6d65 616e  log_term=5) mean
+00008500: 7320 666f 6c6c 6f77 6572 2072 656a 6563  s follower rejec
+00008510: 7473 2073 6f6d 650a 2020 2020 2020 2020  ts some.        
+00008520: 656e 7472 6965 7320 6672 6f6d 2069 7473  entries from its
+00008530: 206c 6561 6465 7220 6173 2069 7420 616c   leader as it al
+00008540: 7265 6164 7920 6861 7320 616e 2065 6e74  ready has an ent
+00008550: 7279 2077 6974 6820 7465 726d 2035 2061  ry with term 5 a
+00008560: 7420 696e 6465 7820 3130 302e 0a20 2020  t index 100..   
+00008570: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00008580: 2063 6c65 6172 5f6c 6f67 5f74 6572 6d28   clear_log_term(
+00008590: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000085a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000085b0: 2020 2060 6c6f 6754 6572 6d60 3a20 6c6f     `logTerm`: lo
+000085c0: 6754 6572 6d20 6973 2067 656e 6572 616c  gTerm is general
+000085d0: 6c79 2075 7365 6420 666f 7220 6170 7065  ly used for appe
+000085e0: 6e64 696e 6720 5261 6674 206c 6f67 7320  nding Raft logs 
+000085f0: 746f 2066 6f6c 6c6f 7765 7273 2e20 466f  to followers. Fo
+00008600: 7220 6578 616d 706c 652c 0a20 2020 2020  r example,.     
+00008610: 2020 2028 7479 7065 3d4d 7367 4170 7065     (type=MsgAppe
+00008620: 6e64 2c69 6e64 6578 3d31 3030 2c6c 6f67  nd,index=100,log
+00008630: 5f74 6572 6d3d 3529 206d 6561 6e73 206c  _term=5) means l
+00008640: 6561 6465 7220 6170 7065 6e64 7320 656e  eader appends en
+00008650: 7472 6965 7320 7374 6172 7469 6e67 2061  tries starting a
+00008660: 740a 2020 2020 2020 2020 696e 6465 783d  t.        index=
+00008670: 3130 312c 2061 6e64 2074 6865 2074 6572  101, and the ter
+00008680: 6d20 6f66 2065 6e74 7279 2061 7420 696e  m of entry at in
+00008690: 6465 7820 3130 3020 6973 2035 2e0a 2020  dex 100 is 5..  
+000086a0: 2020 2020 2020 2874 7970 653d 4d73 6741        (type=MsgA
+000086b0: 7070 656e 6452 6573 706f 6e73 652c 7265  ppendResponse,re
+000086c0: 6a65 6374 3d74 7275 652c 696e 6465 783d  ject=true,index=
+000086d0: 3130 302c 6c6f 675f 7465 726d 3d35 2920  100,log_term=5) 
+000086e0: 6d65 616e 7320 666f 6c6c 6f77 6572 2072  means follower r
+000086f0: 656a 6563 7473 2073 6f6d 650a 2020 2020  ejects some.    
+00008700: 2020 2020 656e 7472 6965 7320 6672 6f6d      entries from
+00008710: 2069 7473 206c 6561 6465 7220 6173 2069   its leader as i
+00008720: 7420 616c 7265 6164 7920 6861 7320 616e  t already has an
+00008730: 2065 6e74 7279 2077 6974 6820 7465 726d   entry with term
+00008740: 2035 2061 7420 696e 6465 7820 3130 302e   5 at index 100.
+00008750: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00008760: 2064 6566 2067 6574 5f70 7269 6f72 6974   def get_priorit
+00008770: 7928 7365 6c66 2920 2d3e 2069 6e74 3a0a  y(self) -> int:.
+00008780: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00008790: 2020 2020 6070 7269 6f72 6974 7960 3a20      `priority`: 
+000087a0: 4966 2074 6869 7320 6e65 7720 6669 656c  If this new fiel
+000087b0: 6420 6973 206e 6f74 2073 6574 2c20 7468  d is not set, th
+000087c0: 656e 2075 7365 2074 6865 2061 626f 7665  en use the above
+000087d0: 206f 6c64 2066 6965 6c64 3b20 6f74 6865   old field; othe
+000087e0: 7277 6973 650a 2020 2020 2020 2020 7573  rwise.        us
+000087f0: 6520 7468 6520 6e65 7720 6669 656c 642e  e the new field.
+00008800: 2057 6865 6e20 6272 6f61 6463 6173 7469   When broadcasti
+00008810: 6e67 2072 6571 7565 7374 2076 6f74 652c  ng request vote,
+00008820: 2062 6f74 6820 6669 656c 6473 2061 7265   both fields are
+00008830: 0a20 2020 2020 2020 2073 6574 2069 6620  .        set if 
+00008840: 7468 6520 7072 696f 7269 7479 2069 7320  the priority is 
+00008850: 6c61 7267 6572 2074 6861 6e20 302e 2054  larger than 0. T
+00008860: 6869 7320 6368 616e 6765 2069 7320 6e6f  his change is no
+00008870: 7420 6120 6675 6c6c 790a 2020 2020 2020  t a fully.      
+00008880: 2020 636f 6d70 6174 6962 6c65 2063 6861    compatible cha
+00008890: 6e67 652c 2062 7574 2069 7420 6d61 6b65  nge, but it make
+000088a0: 7320 6d69 6e69 6d61 6c20 696d 7061 6374  s minimal impact
+000088b0: 2074 6861 7420 6f6e 6c79 206e 6577 2070   that only new p
+000088c0: 7269 6f72 6974 790a 2020 2020 2020 2020  riority.        
+000088d0: 6973 206e 6f74 2072 6563 6f67 6e69 7a65  is not recognize
+000088e0: 6420 6279 2074 6865 206f 6c64 206e 6f64  d by the old nod
+000088f0: 6573 2064 7572 696e 6720 726f 6c6c 696e  es during rollin
+00008900: 6720 7570 6461 7465 2e0a 2020 2020 2020  g update..      
+00008910: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+00008920: 745f 7072 696f 7269 7479 2873 656c 662c  t_priority(self,
+00008930: 2070 7269 6f72 6974 793a 2069 6e74 2920   priority: int) 
+00008940: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00008950: 2022 2222 0a20 2020 2020 2020 2060 7072   """.        `pr
+00008960: 696f 7269 7479 603a 2049 6620 7468 6973  iority`: If this
+00008970: 206e 6577 2066 6965 6c64 2069 7320 6e6f   new field is no
+00008980: 7420 7365 742c 2074 6865 6e20 7573 6520  t set, then use 
+00008990: 7468 6520 6162 6f76 6520 6f6c 6420 6669  the above old fi
+000089a0: 656c 643b 206f 7468 6572 7769 7365 0a20  eld; otherwise. 
+000089b0: 2020 2020 2020 2075 7365 2074 6865 206e         use the n
+000089c0: 6577 2066 6965 6c64 2e20 5768 656e 2062  ew field. When b
+000089d0: 726f 6164 6361 7374 696e 6720 7265 7175  roadcasting requ
+000089e0: 6573 7420 766f 7465 2c20 626f 7468 2066  est vote, both f
+000089f0: 6965 6c64 7320 6172 650a 2020 2020 2020  ields are.      
+00008a00: 2020 7365 7420 6966 2074 6865 2070 7269    set if the pri
+00008a10: 6f72 6974 7920 6973 206c 6172 6765 7220  ority is larger 
+00008a20: 7468 616e 2030 2e20 5468 6973 2063 6861  than 0. This cha
+00008a30: 6e67 6520 6973 206e 6f74 2061 2066 756c  nge is not a ful
+00008a40: 6c79 0a20 2020 2020 2020 2063 6f6d 7061  ly.        compa
+00008a50: 7469 626c 6520 6368 616e 6765 2c20 6275  tible change, bu
+00008a60: 7420 6974 206d 616b 6573 206d 696e 696d  t it makes minim
+00008a70: 616c 2069 6d70 6163 7420 7468 6174 206f  al impact that o
+00008a80: 6e6c 7920 6e65 7720 7072 696f 7269 7479  nly new priority
+00008a90: 0a20 2020 2020 2020 2069 7320 6e6f 7420  .        is not 
+00008aa0: 7265 636f 676e 697a 6564 2062 7920 7468  recognized by th
+00008ab0: 6520 6f6c 6420 6e6f 6465 7320 6475 7269  e old nodes duri
+00008ac0: 6e67 2072 6f6c 6c69 6e67 2075 7064 6174  ng rolling updat
+00008ad0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+00008ae0: 2020 2064 6566 2063 6c65 6172 5f70 7269     def clear_pri
+00008af0: 6f72 6974 7928 7365 6c66 2920 2d3e 204e  ority(self) -> N
+00008b00: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00008b10: 0a20 2020 2020 2020 2060 7072 696f 7269  .        `priori
+00008b20: 7479 603a 2049 6620 7468 6973 206e 6577  ty`: If this new
+00008b30: 2066 6965 6c64 2069 7320 6e6f 7420 7365   field is not se
+00008b40: 742c 2074 6865 6e20 7573 6520 7468 6520  t, then use the 
+00008b50: 6162 6f76 6520 6f6c 6420 6669 656c 643b  above old field;
+00008b60: 206f 7468 6572 7769 7365 0a20 2020 2020   otherwise.     
+00008b70: 2020 2075 7365 2074 6865 206e 6577 2066     use the new f
+00008b80: 6965 6c64 2e20 5768 656e 2062 726f 6164  ield. When broad
+00008b90: 6361 7374 696e 6720 7265 7175 6573 7420  casting request 
+00008ba0: 766f 7465 2c20 626f 7468 2066 6965 6c64  vote, both field
+00008bb0: 7320 6172 650a 2020 2020 2020 2020 7365  s are.        se
+00008bc0: 7420 6966 2074 6865 2070 7269 6f72 6974  t if the priorit
+00008bd0: 7920 6973 206c 6172 6765 7220 7468 616e  y is larger than
+00008be0: 2030 2e20 5468 6973 2063 6861 6e67 6520   0. This change 
+00008bf0: 6973 206e 6f74 2061 2066 756c 6c79 0a20  is not a fully. 
+00008c00: 2020 2020 2020 2063 6f6d 7061 7469 626c         compatibl
+00008c10: 6520 6368 616e 6765 2c20 6275 7420 6974  e change, but it
+00008c20: 206d 616b 6573 206d 696e 696d 616c 2069   makes minimal i
+00008c30: 6d70 6163 7420 7468 6174 206f 6e6c 7920  mpact that only 
+00008c40: 6e65 7720 7072 696f 7269 7479 0a20 2020  new priority.   
+00008c50: 2020 2020 2069 7320 6e6f 7420 7265 636f       is not reco
+00008c60: 676e 697a 6564 2062 7920 7468 6520 6f6c  gnized by the ol
+00008c70: 6420 6e6f 6465 7320 6475 7269 6e67 2072  d nodes during r
+00008c80: 6f6c 6c69 6e67 2075 7064 6174 652e 0a20  olling update.. 
+00008c90: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00008ca0: 6566 2067 6574 5f63 6f6e 7465 7874 2873  ef get_context(s
+00008cb0: 656c 6629 202d 3e20 6279 7465 733a 0a20  elf) -> bytes:. 
+00008cc0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+00008cd0: 2020 2064 6566 2073 6574 5f63 6f6e 7465     def set_conte
+00008ce0: 7874 2873 656c 662c 2063 6f6e 7465 7874  xt(self, context
+00008cf0: 3a20 6279 7465 7329 202d 3e20 4e6f 6e65  : bytes) -> None
+00008d00: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
+00008d10: 220a 2020 2020 6465 6620 636c 6561 725f  ".    def clear_
+00008d20: 636f 6e74 6578 7428 7365 6c66 2920 2d3e  context(self) ->
+00008d30: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00008d40: 2222 2022 2222 0a20 2020 2064 6566 2067  "" """.    def g
+00008d50: 6574 5f72 656a 6563 745f 6869 6e74 2873  et_reject_hint(s
+00008d60: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+00008d70: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00008d80: 2064 6566 2073 6574 5f72 656a 6563 745f   def set_reject_
+00008d90: 6869 6e74 2873 656c 662c 2072 656a 6563  hint(self, rejec
+00008da0: 745f 6869 6e74 3a20 626f 6f6c 2920 2d3e  t_hint: bool) ->
+00008db0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00008dc0: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
+00008dd0: 6c65 6172 5f72 656a 6563 745f 6869 6e74  lear_reject_hint
+00008de0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00008df0: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
+00008e00: 2020 2020 6465 6620 6765 745f 656e 7472      def get_entr
+00008e10: 6965 7328 7365 6c66 2920 2d3e 204c 6973  ies(self) -> Lis
+00008e20: 745b 2245 6e74 7279 5265 6622 5d3a 0a20  t["EntryRef"]:. 
 00008e30: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
-00008e40: 2020 2064 6566 2063 6c65 6172 5f72 656a     def clear_rej
-00008e50: 6563 745f 6869 6e74 2873 656c 6629 202d  ect_hint(self) -
-00008e60: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00008e70: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-00008e80: 6765 745f 656e 7472 6965 7328 7365 6c66  get_entries(self
-00008e90: 2920 2d3e 204c 6973 745b 2245 6e74 7279  ) -> List["Entry
-00008ea0: 5265 6622 5d3a 0a20 2020 2020 2020 2022  Ref"]:.        "
-00008eb0: 2222 2022 2222 0a20 2020 2064 6566 2073  "" """.    def s
-00008ec0: 6574 5f65 6e74 7269 6573 2873 656c 662c  et_entries(self,
-00008ed0: 2065 6e74 733a 204c 6973 745b 2245 6e74   ents: List["Ent
-00008ee0: 7279 225d 207c 204c 6973 745b 2245 6e74  ry"] | List["Ent
-00008ef0: 7279 5265 6622 5d29 202d 3e20 4e6f 6e65  ryRef"]) -> None
-00008f00: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-00008f10: 220a 2020 2020 6465 6620 636c 6561 725f  ".    def clear_
-00008f20: 656e 7472 6965 7328 7365 6c66 2920 2d3e  entries(self) ->
-00008f30: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00008f40: 2222 2022 2222 0a20 2020 2064 6566 2067  "" """.    def g
-00008f50: 6574 5f6d 7367 5f74 7970 6528 7365 6c66  et_msg_type(self
-00008f60: 2920 2d3e 2022 4d65 7373 6167 6554 7970  ) -> "MessageTyp
-00008f70: 6522 3a0a 2020 2020 2020 2020 2222 2220  e":.        """ 
-00008f80: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
-00008f90: 6d73 675f 7479 7065 2873 656c 662c 2074  msg_type(self, t
-00008fa0: 7970 3a20 224d 6573 7361 6765 5479 7065  yp: "MessageType
-00008fb0: 2229 202d 3e20 4e6f 6e65 3a0a 2020 2020  ") -> None:.    
-00008fc0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-00008fd0: 6465 6620 636c 6561 725f 6d73 675f 7479  def clear_msg_ty
-00008fe0: 7065 2873 656c 6629 202d 3e20 4e6f 6e65  pe(self) -> None
-00008ff0: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-00009000: 220a 2020 2020 6465 6620 6765 745f 7265  ".    def get_re
-00009010: 6a65 6374 2873 656c 6629 202d 3e20 626f  ject(self) -> bo
-00009020: 6f6c 3a0a 2020 2020 2020 2020 2222 2220  ol:.        """ 
-00009030: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
-00009040: 7265 6a65 6374 2873 656c 662c 2072 656a  reject(self, rej
-00009050: 6563 743a 2062 6f6f 6c29 202d 3e20 4e6f  ect: bool) -> No
-00009060: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
-00009070: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
-00009080: 725f 7265 6a65 6374 2873 656c 6629 202d  r_reject(self) -
-00009090: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000090a0: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-000090b0: 6765 745f 736e 6170 7368 6f74 2873 656c  get_snapshot(sel
-000090c0: 6629 202d 3e20 2253 6e61 7073 686f 7452  f) -> "SnapshotR
-000090d0: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
-000090e0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-000090f0: 5f73 6e61 7073 686f 7428 7365 6c66 2c20  _snapshot(self, 
-00009100: 736e 6170 7368 6f74 3a20 2253 6e61 7073  snapshot: "Snaps
-00009110: 686f 7422 207c 2022 536e 6170 7368 6f74  hot" | "Snapshot
-00009120: 5265 6622 2920 2d3e 204e 6f6e 653a 0a20  Ref") -> None:. 
-00009130: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
-00009140: 2020 2064 6566 2063 6c65 6172 5f73 6e61     def clear_sna
-00009150: 7073 686f 7428 7365 6c66 2920 2d3e 204e  pshot(self) -> N
-00009160: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00009170: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-00009180: 5f74 6f28 7365 6c66 2920 2d3e 2069 6e74  _to(self) -> int
-00009190: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-000091a0: 220a 2020 2020 6465 6620 7365 745f 746f  ".    def set_to
-000091b0: 2873 656c 662c 2074 6f3a 2069 6e74 2920  (self, to: int) 
-000091c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000091d0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-000091e0: 2063 6c65 6172 5f74 6f28 7365 6c66 2920   clear_to(self) 
-000091f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00009200: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-00009210: 2067 6574 5f72 6571 7565 7374 5f73 6e61   get_request_sna
-00009220: 7073 686f 7428 7365 6c66 2920 2d3e 2069  pshot(self) -> i
-00009230: 6e74 3a0a 2020 2020 2020 2020 2222 2220  nt:.        """ 
-00009240: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
-00009250: 7265 7175 6573 745f 736e 6170 7368 6f74  request_snapshot
-00009260: 2873 656c 662c 2072 6571 7565 7374 5f73  (self, request_s
-00009270: 6e61 7073 686f 743a 2069 6e74 2920 2d3e  napshot: int) ->
-00009280: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00009290: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
-000092a0: 6c65 6172 5f72 6571 7565 7374 5f73 6e61  lear_request_sna
-000092b0: 7073 686f 7428 7365 6c66 2920 2d3e 204e  pshot(self) -> N
-000092c0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000092d0: 2022 2222 0a20 2020 2064 6566 2068 6173   """.    def has
-000092e0: 5f73 6e61 7073 686f 7428 7365 6c66 2920  _snapshot(self) 
-000092f0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00009300: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-00009310: 2063 6f6d 7075 7465 5f73 697a 6528 7365   compute_size(se
-00009320: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00009330: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009340: 436f 6d70 7574 6520 616e 6420 6361 6368  Compute and cach
-00009350: 6520 7369 7a65 206f 6620 7468 6973 206d  e size of this m
-00009360: 6573 7361 6765 2061 6e64 2061 6c6c 206e  essage and all n
-00009370: 6573 7465 6420 6d65 7373 6167 6573 0a20  ested messages. 
-00009380: 2020 2020 2020 2022 2222 0a0a 636c 6173         """..clas
-00009390: 7320 4d65 7373 6167 6528 5f5f 4150 495f  s Message(__API_
-000093a0: 4d65 7373 6167 6529 3a0a 2020 2020 2222  Message):.    ""
-000093b0: 2220 2222 220a 0a20 2020 2064 6566 205f  " """..    def _
-000093c0: 5f69 6e69 745f 5f28 7365 6c66 2920 2d3e  _init__(self) ->
-000093d0: 204e 6f6e 653a 202e 2e2e 0a20 2020 2064   None: ....    d
-000093e0: 6566 206d 616b 655f 7265 6628 7365 6c66  ef make_ref(self
-000093f0: 2920 2d3e 2022 4d65 7373 6167 6552 6566  ) -> "MessageRef
-00009400: 223a 202e 2e2e 0a20 2020 2040 7374 6174  ": ....    @stat
-00009410: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00009420: 2064 6566 6175 6c74 2829 202d 3e20 224d   default() -> "M
-00009430: 6573 7361 6765 223a 202e 2e2e 0a20 2020  essage": ....   
-00009440: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-00009450: 2020 2064 6566 2064 6563 6f64 6528 763a     def decode(v:
-00009460: 204c 6973 745b 696e 745d 207c 2062 7974   List[int] | byt
-00009470: 6573 2920 2d3e 2022 4d65 7373 6167 6522  es) -> "Message"
-00009480: 3a20 2e2e 2e0a 0a63 6c61 7373 204d 6573  : .....class Mes
-00009490: 7361 6765 5265 6628 4d65 7373 6167 6529  sageRef(Message)
-000094a0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-000094b0: 6665 7265 6e63 6520 7479 7065 206f 6620  ference type of 
-000094c0: 3a63 6c61 7373 3a60 4d65 7373 6167 6560  :class:`Message`
-000094d0: 2e0a 2020 2020 2222 220a 0a63 6c61 7373  ..    """..class
-000094e0: 205f 5f41 5049 5f48 6172 6453 7461 7465   __API_HardState
-000094f0: 285f 5f43 6c6f 6e65 6162 6c65 2c20 5f5f  (__Cloneable, __
-00009500: 456e 636f 6465 722c 205f 5f44 6563 6f64  Encoder, __Decod
-00009510: 6572 293a 0a20 2020 2064 6566 2063 6c6f  er):.    def clo
-00009520: 6e65 2873 656c 6629 202d 3e20 2248 6172  ne(self) -> "Har
-00009530: 6453 7461 7465 223a 202e 2e2e 0a20 2020  dState": ....   
-00009540: 2064 6566 2067 6574 5f74 6572 6d28 7365   def get_term(se
-00009550: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00009560: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-00009570: 6465 6620 7365 745f 7465 726d 2873 656c  def set_term(sel
-00009580: 662c 2074 6572 6d3a 2069 6e74 2920 2d3e  f, term: int) ->
-00009590: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000095a0: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
-000095b0: 6c65 6172 5f74 6572 6d28 7365 6c66 2920  lear_term(self) 
-000095c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000095d0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-000095e0: 2067 6574 5f76 6f74 6528 7365 6c66 2920   get_vote(self) 
-000095f0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00009600: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-00009610: 7365 745f 766f 7465 2873 656c 662c 2076  set_vote(self, v
-00009620: 6f74 653a 2069 6e74 2920 2d3e 204e 6f6e  ote: int) -> Non
-00009630: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
-00009640: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
-00009650: 5f76 6f74 6528 7365 6c66 2920 2d3e 204e  _vote(self) -> N
-00009660: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00009670: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-00009680: 5f63 6f6d 6d69 7428 7365 6c66 2920 2d3e  _commit(self) ->
-00009690: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-000096a0: 2220 2222 220a 2020 2020 6465 6620 7365  " """.    def se
-000096b0: 745f 636f 6d6d 6974 2873 656c 662c 2063  t_commit(self, c
-000096c0: 6f6d 6d69 743a 2069 6e74 2920 2d3e 204e  ommit: int) -> N
-000096d0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000096e0: 2022 2222 0a20 2020 2064 6566 2063 6c65   """.    def cle
-000096f0: 6172 5f63 6f6d 6d69 7428 7365 6c66 2920  ar_commit(self) 
-00009700: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00009710: 2022 2222 2022 2222 0a0a 636c 6173 7320   """ """..class 
-00009720: 4861 7264 5374 6174 6528 5f5f 4150 495f  HardState(__API_
-00009730: 4861 7264 5374 6174 6529 3a0a 2020 2020  HardState):.    
-00009740: 2222 2220 2222 220a 0a20 2020 2064 6566  """ """..    def
-00009750: 205f 5f69 6e69 745f 5f28 7365 6c66 2920   __init__(self) 
-00009760: 2d3e 204e 6f6e 653a 202e 2e2e 0a20 2020  -> None: ....   
-00009770: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
-00009780: 6c66 2920 2d3e 2022 4861 7264 5374 6174  lf) -> "HardStat
-00009790: 6552 6566 223a 202e 2e2e 0a20 2020 2040  eRef": ....    @
-000097a0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-000097b0: 2064 6566 2064 6566 6175 6c74 2829 202d   def default() -
-000097c0: 3e20 2248 6172 6453 7461 7465 223a 202e  > "HardState": .
-000097d0: 2e2e 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
-000097e0: 7468 6f64 0a20 2020 2064 6566 2064 6563  thod.    def dec
-000097f0: 6f64 6528 763a 204c 6973 745b 696e 745d  ode(v: List[int]
-00009800: 207c 2062 7974 6573 2920 2d3e 2022 4861   | bytes) -> "Ha
-00009810: 7264 5374 6174 6522 3a20 2e2e 2e0a 0a63  rdState": .....c
-00009820: 6c61 7373 2048 6172 6453 7461 7465 5265  lass HardStateRe
-00009830: 6628 5f5f 4150 495f 4861 7264 5374 6174  f(__API_HardStat
-00009840: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-00009850: 5265 6665 7265 6e63 6520 7479 7065 206f  Reference type o
-00009860: 6620 3a63 6c61 7373 3a60 4861 7264 5374  f :class:`HardSt
-00009870: 6174 6560 2e0a 2020 2020 2222 220a 0a63  ate`..    """..c
-00009880: 6c61 7373 205f 5f41 5049 5f47 6574 456e  lass __API_GetEn
-00009890: 7472 6965 7343 6f6e 7465 7874 3a0a 2020  triesContext:.  
-000098a0: 2020 6465 6620 6361 6e5f 6173 796e 6328    def can_async(
-000098b0: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
-000098c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000098d0: 2020 2043 6865 636b 2069 6620 7468 6520     Check if the 
-000098e0: 6361 6c6c 6572 2773 2063 6f6e 7465 7874  caller's context
-000098f0: 2073 7570 706f 7274 2066 6574 6368 696e   support fetchin
-00009900: 6720 656e 7472 6965 7320 6173 796e 6368  g entries asynch
-00009910: 726f 6e6f 7573 6c79 2e0a 2020 2020 2020  ronously..      
-00009920: 2020 2222 220a 0a63 6c61 7373 2047 6574    """..class Get
-00009930: 456e 7472 6965 7343 6f6e 7465 7874 285f  EntriesContext(_
-00009940: 5f41 5049 5f47 6574 456e 7472 6965 7343  _API_GetEntriesC
-00009950: 6f6e 7465 7874 293a 0a20 2020 2022 2222  ontext):.    """
-00009960: 0a20 2020 2052 6563 6f72 6473 2074 6865  .    Records the
-00009970: 2063 6f6e 7465 7874 206f 6620 7468 6520   context of the 
-00009980: 6361 6c6c 6572 2077 686f 2063 616c 6c73  caller who calls
-00009990: 2065 6e74 7269 6573 2829 206f 6620 5374   entries() of St
-000099a0: 6f72 6167 6520 7472 6169 742e 0a20 2020  orage trait..   
-000099b0: 2022 2222 0a0a 2020 2020 4073 7461 7469   """..    @stati
-000099c0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-000099d0: 656d 7074 7928 6361 6e5f 6173 796e 633a  empty(can_async:
-000099e0: 2062 6f6f 6c29 202d 3e20 2247 6574 456e   bool) -> "GetEn
-000099f0: 7472 6965 7343 6f6e 7465 7874 223a 0a20  triesContext":. 
-00009a00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00009a10: 2020 2055 7365 6420 666f 7220 6361 6c6c     Used for call
-00009a20: 6572 7320 6f75 7420 6f66 2072 6166 742e  ers out of raft.
-00009a30: 2043 616c 6c65 7220 6361 6e20 6375 7374   Caller can cust
-00009a40: 6f6d 697a 6520 6966 2069 7420 7375 7070  omize if it supp
-00009a50: 6f72 7473 2061 7379 6e63 2e0a 2020 2020  orts async..    
-00009a60: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00009a70: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
-00009a80: 3e20 2247 6574 456e 7472 6965 7343 6f6e  > "GetEntriesCon
-00009a90: 7465 7874 5265 6622 3a20 2e2e 2e0a 0a63  textRef": .....c
-00009aa0: 6c61 7373 2047 6574 456e 7472 6965 7343  lass GetEntriesC
-00009ab0: 6f6e 7465 7874 5265 6628 5f5f 4150 495f  ontextRef(__API_
-00009ac0: 4765 7445 6e74 7269 6573 436f 6e74 6578  GetEntriesContex
-00009ad0: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
-00009ae0: 5265 6665 7265 6e63 6520 7479 7065 206f  Reference type o
-00009af0: 6620 3a63 6c61 7373 3a60 4765 7445 6e74  f :class:`GetEnt
-00009b00: 7269 6573 436f 6e74 6578 7460 2e0a 2020  riesContext`..  
-00009b10: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
-00009b20: 5049 5f45 6e74 7279 285f 5f43 6c6f 6e65  PI_Entry(__Clone
-00009b30: 6162 6c65 2c20 5f5f 456e 636f 6465 722c  able, __Encoder,
-00009b40: 205f 5f44 6563 6f64 6572 293a 0a20 2020   __Decoder):.   
-00009b50: 2064 6566 2063 6c6f 6e65 2873 656c 6629   def clone(self)
-00009b60: 202d 3e20 2245 6e74 7279 223a 202e 2e2e   -> "Entry": ...
-00009b70: 0a20 2020 2064 6566 2067 6574 5f63 6f6e  .    def get_con
-00009b80: 7465 7874 2873 656c 6629 202d 3e20 6279  text(self) -> by
-00009b90: 7465 733a 0a20 2020 2020 2020 2022 2222  tes:.        """
-00009ba0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-00009bb0: 5f63 6f6e 7465 7874 2873 656c 662c 2063  _context(self, c
-00009bc0: 6f6e 7465 7874 3a20 6279 7465 7320 7c20  ontext: bytes | 
-00009bd0: 4c69 7374 5b69 6e74 5d29 202d 3e20 4e6f  List[int]) -> No
-00009be0: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
-00009bf0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
-00009c00: 725f 636f 6e74 6578 7428 7365 6c66 2920  r_context(self) 
-00009c10: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00009c20: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-00009c30: 2067 6574 5f64 6174 6128 7365 6c66 2920   get_data(self) 
-00009c40: 2d3e 2062 7974 6573 3a0a 2020 2020 2020  -> bytes:.      
-00009c50: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-00009c60: 6620 7365 745f 6461 7461 2873 656c 662c  f set_data(self,
-00009c70: 2064 6174 613a 2062 7974 6573 207c 204c   data: bytes | L
-00009c80: 6973 745b 696e 745d 2920 2d3e 204e 6f6e  ist[int]) -> Non
-00009c90: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
-00009ca0: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
-00009cb0: 5f64 6174 6128 7365 6c66 2920 2d3e 204e  _data(self) -> N
-00009cc0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00009cd0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-00009ce0: 5f65 6e74 7279 5f74 7970 6528 7365 6c66  _entry_type(self
-00009cf0: 2920 2d3e 2022 456e 7472 7954 7970 6522  ) -> "EntryType"
-00009d00: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-00009d10: 220a 2020 2020 6465 6620 7365 745f 656e  ".    def set_en
-00009d20: 7472 795f 7479 7065 2873 656c 662c 2074  try_type(self, t
-00009d30: 7970 3a20 2245 6e74 7279 5479 7065 2229  yp: "EntryType")
-00009d40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00009d50: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-00009d60: 6620 636c 6561 725f 656e 7472 795f 7479  f clear_entry_ty
-00009d70: 7065 2873 656c 6629 202d 3e20 4e6f 6e65  pe(self) -> None
-00009d80: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-00009d90: 220a 2020 2020 6465 6620 6765 745f 7465  ".    def get_te
-00009da0: 726d 2873 656c 6629 202d 3e20 696e 743a  rm(self) -> int:
-00009db0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-00009dc0: 0a20 2020 2064 6566 2073 6574 5f74 6572  .    def set_ter
-00009dd0: 6d28 7365 6c66 2c20 7465 726d 3a20 696e  m(self, term: in
-00009de0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-00009df0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-00009e00: 6465 6620 636c 6561 725f 7465 726d 2873  def clear_term(s
-00009e10: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00009e20: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
-00009e30: 2020 6465 6620 6765 745f 696e 6465 7828    def get_index(
-00009e40: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-00009e50: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
-00009e60: 2020 6465 6620 7365 745f 696e 6465 7828    def set_index(
-00009e70: 7365 6c66 2c20 696e 6465 783a 2069 6e74  self, index: int
-00009e80: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00009e90: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
-00009ea0: 6566 2063 6c65 6172 5f69 6e64 6578 2873  ef clear_index(s
-00009eb0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00009ec0: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
-00009ed0: 2020 6465 6620 6765 745f 7379 6e63 5f6c    def get_sync_l
-00009ee0: 6f67 2873 656c 6629 202d 3e20 626f 6f6c  og(self) -> bool
-00009ef0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00009f00: 2020 2020 2020 4465 7072 6563 6174 6564        Deprecated
-00009f10: 2120 4974 2069 7320 6b65 7074 2066 6f72  ! It is kept for
-00009f20: 2062 6163 6b77 6172 6420 636f 6d70 6174   backward compat
-00009f30: 6962 696c 6974 792e 0a20 2020 2020 2020  ibility..       
-00009f40: 2054 4f44 4f3a 2072 656d 6f76 6520 6974   TODO: remove it
-00009f50: 2069 6e20 7468 6520 6e65 7874 206d 616a   in the next maj
-00009f60: 6f72 2072 656c 6561 7365 2e0a 2020 2020  or release..    
-00009f70: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00009f80: 7365 745f 7379 6e63 5f6c 6f67 2873 656c  set_sync_log(sel
-00009f90: 662c 2073 796e 635f 6c6f 673a 2062 6f6f  f, sync_log: boo
-00009fa0: 6c29 202d 3e20 4e6f 6e65 3a0a 2020 2020  l) -> None:.    
-00009fb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009fc0: 4465 7072 6563 6174 6564 2120 4974 2069  Deprecated! It i
-00009fd0: 7320 6b65 7074 2066 6f72 2062 6163 6b77  s kept for backw
-00009fe0: 6172 6420 636f 6d70 6174 6962 696c 6974  ard compatibilit
-00009ff0: 792e 0a20 2020 2020 2020 2054 4f44 4f3a  y..        TODO:
-0000a000: 2072 656d 6f76 6520 6974 2069 6e20 7468   remove it in th
-0000a010: 6520 6e65 7874 206d 616a 6f72 2072 656c  e next major rel
-0000a020: 6561 7365 2e0a 2020 2020 2020 2020 2222  ease..        ""
-0000a030: 220a 2020 2020 6465 6620 636c 6561 725f  ".    def clear_
-0000a040: 7379 6e63 5f6c 6f67 2873 656c 6629 202d  sync_log(self) -
-0000a050: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000a060: 2222 220a 2020 2020 2020 2020 4465 7072  """.        Depr
-0000a070: 6563 6174 6564 2120 4974 2069 7320 6b65  ecated! It is ke
-0000a080: 7074 2066 6f72 2062 6163 6b77 6172 6420  pt for backward 
-0000a090: 636f 6d70 6174 6962 696c 6974 792e 0a20  compatibility.. 
-0000a0a0: 2020 2020 2020 2054 4f44 4f3a 2072 656d         TODO: rem
-0000a0b0: 6f76 6520 6974 2069 6e20 7468 6520 6e65  ove it in the ne
-0000a0c0: 7874 206d 616a 6f72 2072 656c 6561 7365  xt major release
-0000a0d0: 2e0a 2020 2020 2020 2020 2222 220a 0a63  ..        """..c
-0000a0e0: 6c61 7373 2045 6e74 7279 285f 5f41 5049  lass Entry(__API
-0000a0f0: 5f45 6e74 7279 293a 0a20 2020 2022 2222  _Entry):.    """
-0000a100: 0a20 2020 2054 6865 2065 6e74 7279 2069  .    The entry i
-0000a110: 7320 6120 7479 7065 206f 6620 6368 616e  s a type of chan
-0000a120: 6765 2074 6861 7420 6e65 6564 7320 746f  ge that needs to
-0000a130: 2062 6520 6170 706c 6965 642e 2049 7420   be applied. It 
-0000a140: 636f 6e74 6169 6e73 2074 776f 2064 6174  contains two dat
-0000a150: 6120 6669 656c 6473 2e0a 2020 2020 5768  a fields..    Wh
-0000a160: 696c 6520 7468 6520 6669 656c 6473 2061  ile the fields a
-0000a170: 7265 2062 7569 6c74 2069 6e74 6f20 7468  re built into th
-0000a180: 6520 6d6f 6465 6c3b 2074 6865 6972 2075  e model; their u
-0000a190: 7361 6765 2069 7320 6465 7465 726d 696e  sage is determin
-0000a1a0: 6564 2062 7920 7468 6520 656e 7472 795f  ed by the entry_
-0000a1b0: 7479 7065 2e0a 0a20 2020 2046 6f72 206e  type...    For n
-0000a1c0: 6f72 6d61 6c20 656e 7472 6965 732c 2074  ormal entries, t
-0000a1d0: 6865 2064 6174 6120 6669 656c 6420 7368  he data field sh
-0000a1e0: 6f75 6c64 2063 6f6e 7461 696e 2074 6865  ould contain the
-0000a1f0: 2064 6174 6120 6368 616e 6765 2074 6861   data change tha
-0000a200: 7420 7368 6f75 6c64 2062 6520 6170 706c  t should be appl
-0000a210: 6965 642e 0a20 2020 2054 6865 2063 6f6e  ied..    The con
-0000a220: 7465 7874 2066 6965 6c64 2063 616e 2062  text field can b
-0000a230: 6520 7573 6564 2066 6f72 2061 6e79 2063  e used for any c
-0000a240: 6f6e 7465 7874 7561 6c20 6461 7461 2074  ontextual data t
-0000a250: 6861 7420 6d69 6768 7420 6265 2072 656c  hat might be rel
-0000a260: 6576 616e 7420 746f 2074 6865 0a20 2020  evant to the.   
-0000a270: 2061 7070 6c69 6361 7469 6f6e 206f 6620   application of 
-0000a280: 7468 6520 6461 7461 2e0a 0a20 2020 2046  the data...    F
-0000a290: 6f72 2063 6f6e 6669 6775 7261 7469 6f6e  or configuration
-0000a2a0: 2063 6861 6e67 6573 2c20 7468 6520 6461   changes, the da
-0000a2b0: 7461 2077 696c 6c20 636f 6e74 6169 6e20  ta will contain 
-0000a2c0: 7468 6520 436f 6e66 4368 616e 6765 206d  the ConfChange m
-0000a2d0: 6573 7361 6765 2061 6e64 2074 6865 0a20  essage and the. 
-0000a2e0: 2020 2063 6f6e 7465 7874 2077 696c 6c20     context will 
-0000a2f0: 7072 6f76 6964 6520 616e 7974 6869 6e67  provide anything
-0000a300: 206e 6565 6465 6420 746f 2061 7373 6973   needed to assis
-0000a310: 7420 7468 6520 636f 6e66 6967 7572 6174  t the configurat
-0000a320: 696f 6e20 6368 616e 6765 2e20 5468 6520  ion change. The 
-0000a330: 636f 6e74 6578 740a 2020 2020 6966 2066  context.    if f
-0000a340: 6f72 2074 6865 2075 7365 7220 746f 2073  or the user to s
-0000a350: 6574 2061 6e64 2075 7365 2069 6e20 7468  et and use in th
-0000a360: 6973 2063 6173 652e 0a20 2020 2022 2222  is case..    """
-0000a370: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0000a380: 5f5f 2873 656c 6629 202d 3e20 4e6f 6e65  __(self) -> None
-0000a390: 3a20 2e2e 2e0a 2020 2020 6465 6620 6d61  : ....    def ma
-0000a3a0: 6b65 5f72 6566 2873 656c 6629 202d 3e20  ke_ref(self) -> 
-0000a3b0: 2245 6e74 7279 5265 6622 3a20 2e2e 2e0a  "EntryRef": ....
-0000a3c0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-0000a3d0: 640a 2020 2020 6465 6620 6465 6661 756c  d.    def defaul
-0000a3e0: 7428 2920 2d3e 2022 456e 7472 7922 3a20  t() -> "Entry": 
-0000a3f0: 2e2e 2e0a 2020 2020 4073 7461 7469 636d  ....    @staticm
-0000a400: 6574 686f 640a 2020 2020 6465 6620 6465  ethod.    def de
-0000a410: 636f 6465 2876 3a20 4c69 7374 5b69 6e74  code(v: List[int
-0000a420: 5d20 7c20 6279 7465 7329 202d 3e20 2245  ] | bytes) -> "E
-0000a430: 6e74 7279 223a 202e 2e2e 0a0a 636c 6173  ntry": .....clas
-0000a440: 7320 456e 7472 7952 6566 285f 5f41 5049  s EntryRef(__API
-0000a450: 5f45 6e74 7279 293a 0a20 2020 2022 2222  _Entry):.    """
-0000a460: 0a20 2020 2052 6566 6572 656e 6365 2074  .    Reference t
-0000a470: 7970 6520 6f66 203a 636c 6173 733a 6045  ype of :class:`E
-0000a480: 6e74 7279 602e 0a20 2020 2022 2222 0a0a  ntry`..    """..
-0000a490: 636c 6173 7320 5f5f 4150 495f 436f 6e66  class __API_Conf
-0000a4a0: 5374 6174 6528 5f5f 436c 6f6e 6561 626c  State(__Cloneabl
-0000a4b0: 652c 205f 5f45 6e63 6f64 6572 2c20 5f5f  e, __Encoder, __
-0000a4c0: 4465 636f 6465 7229 3a0a 2020 2020 6465  Decoder):.    de
-0000a4d0: 6620 636c 6f6e 6528 7365 6c66 2920 2d3e  f clone(self) ->
-0000a4e0: 2022 436f 6e66 5374 6174 6522 3a20 2e2e   "ConfState": ..
-0000a4f0: 2e0a 2020 2020 6465 6620 6765 745f 6175  ..    def get_au
-0000a500: 746f 5f6c 6561 7665 2873 656c 6629 202d  to_leave(self) -
-0000a510: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-0000a520: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-0000a530: 7365 745f 6175 746f 5f6c 6561 7665 2873  set_auto_leave(s
-0000a540: 656c 662c 2061 7574 6f5f 6c65 6176 653a  elf, auto_leave:
-0000a550: 2062 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a   bool) -> None:.
-0000a560: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-0000a570: 2020 2020 6465 6620 636c 6561 725f 6175      def clear_au
-0000a580: 746f 5f6c 6561 7665 2873 656c 6629 202d  to_leave(self) -
-0000a590: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000a5a0: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-0000a5b0: 6765 745f 6c65 6172 6e65 7273 2873 656c  get_learners(sel
-0000a5c0: 6629 202d 3e20 4c69 7374 5b69 6e74 5d3a  f) -> List[int]:
-0000a5d0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-0000a5e0: 0a20 2020 2064 6566 2073 6574 5f6c 6561  .    def set_lea
-0000a5f0: 726e 6572 7328 7365 6c66 2c20 6c65 6172  rners(self, lear
-0000a600: 6e65 7273 3a20 4c69 7374 5b69 6e74 5d29  ners: List[int])
-0000a610: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000a620: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-0000a630: 6620 636c 6561 725f 6c65 6172 6e65 7273  f clear_learners
-0000a640: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000a650: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-0000a660: 2020 2020 6465 6620 6765 745f 6c65 6172      def get_lear
-0000a670: 6e65 7273 5f6e 6578 7428 7365 6c66 2920  ners_next(self) 
-0000a680: 2d3e 204c 6973 745b 696e 745d 3a0a 2020  -> List[int]:.  
-0000a690: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
-0000a6a0: 2020 6465 6620 7365 745f 6c65 6172 6e65    def set_learne
-0000a6b0: 7273 5f6e 6578 7428 7365 6c66 2c20 6c65  rs_next(self, le
-0000a6c0: 6172 6e65 7273 5f6e 6578 743a 204c 6973  arners_next: Lis
-0000a6d0: 745b 696e 745d 2920 2d3e 204e 6f6e 653a  t[int]) -> None:
-0000a6e0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-0000a6f0: 0a20 2020 2064 6566 2063 6c65 6172 5f6c  .    def clear_l
-0000a700: 6561 726e 6572 735f 6e65 7874 2873 656c  earners_next(sel
-0000a710: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000a720: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-0000a730: 6465 6620 6765 745f 766f 7465 7273 2873  def get_voters(s
-0000a740: 656c 6629 202d 3e20 4c69 7374 5b69 6e74  elf) -> List[int
-0000a750: 5d3a 0a20 2020 2020 2020 2022 2222 2022  ]:.        """ "
-0000a760: 2222 0a20 2020 2064 6566 2073 6574 5f76  "".    def set_v
-0000a770: 6f74 6572 7328 7365 6c66 2c20 766f 7465  oters(self, vote
-0000a780: 7273 3a20 4c69 7374 5b69 6e74 5d29 202d  rs: List[int]) -
-0000a790: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000a7a0: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-0000a7b0: 636c 6561 725f 766f 7465 7273 2873 656c  clear_voters(sel
-0000a7c0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000a7d0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-0000a7e0: 6465 6620 6765 745f 766f 7465 7273 5f6f  def get_voters_o
-0000a7f0: 7574 676f 696e 6728 7365 6c66 2920 2d3e  utgoing(self) ->
-0000a800: 204c 6973 745b 696e 745d 3a0a 2020 2020   List[int]:.    
-0000a810: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-0000a820: 6465 6620 7365 745f 766f 7465 7273 5f6f  def set_voters_o
-0000a830: 7574 676f 696e 6728 7365 6c66 2c20 766f  utgoing(self, vo
-0000a840: 7465 7273 5f6f 7574 676f 696e 673a 204c  ters_outgoing: L
-0000a850: 6973 745b 696e 745d 2920 2d3e 204e 6f6e  ist[int]) -> Non
-0000a860: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
-0000a870: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
-0000a880: 5f76 6f74 6572 735f 6f75 7467 6f69 6e67  _voters_outgoing
-0000a890: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000a8a0: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-0000a8b0: 0a63 6c61 7373 2043 6f6e 6653 7461 7465  .class ConfState
-0000a8c0: 285f 5f41 5049 5f43 6f6e 6653 7461 7465  (__API_ConfState
-0000a8d0: 293a 0a20 2020 2022 2222 2022 2222 0a0a  ):.    """ """..
-0000a8e0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0000a8f0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-0000a900: 766f 7465 7273 3a20 4f70 7469 6f6e 616c  voters: Optional
-0000a910: 5b4c 6973 745b 696e 745d 5d2c 206c 6561  [List[int]], lea
-0000a920: 726e 6572 733a 204f 7074 696f 6e61 6c5b  rners: Optional[
-0000a930: 4c69 7374 5b69 6e74 5d5d 0a20 2020 2029  List[int]].    )
-0000a940: 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020   -> None: ....  
-0000a950: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
-0000a960: 656c 6629 202d 3e20 2243 6f6e 6653 7461  elf) -> "ConfSta
-0000a970: 7465 5265 6622 3a20 2e2e 2e0a 2020 2020  teRef": ....    
-0000a980: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-0000a990: 2020 6465 6620 6465 6661 756c 7428 2920    def default() 
-0000a9a0: 2d3e 2022 436f 6e66 5374 6174 6522 3a20  -> "ConfState": 
-0000a9b0: 2e2e 2e0a 2020 2020 4073 7461 7469 636d  ....    @staticm
-0000a9c0: 6574 686f 640a 2020 2020 6465 6620 6465  ethod.    def de
-0000a9d0: 636f 6465 2876 3a20 4c69 7374 5b69 6e74  code(v: List[int
-0000a9e0: 5d20 7c20 6279 7465 7329 202d 3e20 2243  ] | bytes) -> "C
-0000a9f0: 6f6e 6653 7461 7465 223a 202e 2e2e 0a0a  onfState": .....
-0000aa00: 636c 6173 7320 436f 6e66 5374 6174 6552  class ConfStateR
-0000aa10: 6566 285f 5f41 5049 5f43 6f6e 6653 7461  ef(__API_ConfSta
-0000aa20: 7465 293a 0a20 2020 2022 2222 0a20 2020  te):.    """.   
-0000aa30: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
-0000aa40: 6f66 203a 636c 6173 733a 6043 6f6e 6653  of :class:`ConfS
-0000aa50: 7461 7465 602e 0a20 2020 2022 2222 0a0a  tate`..    """..
-0000aa60: 636c 6173 7320 5f5f 4150 495f 436f 6e66  class __API_Conf
-0000aa70: 4368 616e 6765 5632 285f 5f43 6c6f 6e65  ChangeV2(__Clone
-0000aa80: 6162 6c65 2c20 5f5f 456e 636f 6465 722c  able, __Encoder,
-0000aa90: 205f 5f44 6563 6f64 6572 293a 0a20 2020   __Decoder):.   
-0000aaa0: 2064 6566 2063 6c6f 6e65 2873 656c 6629   def clone(self)
-0000aab0: 202d 3e20 2243 6f6e 6643 6861 6e67 6556   -> "ConfChangeV
-0000aac0: 3222 3a20 2e2e 2e0a 2020 2020 6465 6620  2": ....    def 
-0000aad0: 6765 745f 6368 616e 6765 7328 7365 6c66  get_changes(self
-0000aae0: 2920 2d3e 204c 6973 745b 2243 6f6e 6643  ) -> List["ConfC
-0000aaf0: 6861 6e67 6553 696e 676c 6552 6566 225d  hangeSingleRef"]
-0000ab00: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-0000ab10: 220a 2020 2020 6465 6620 7365 745f 6368  ".    def set_ch
-0000ab20: 616e 6765 7328 0a20 2020 2020 2020 2073  anges(.        s
-0000ab30: 656c 662c 2063 6861 6e67 6573 3a20 4c69  elf, changes: Li
-0000ab40: 7374 5b22 436f 6e66 4368 616e 6765 5369  st["ConfChangeSi
-0000ab50: 6e67 6c65 225d 207c 204c 6973 745b 2243  ngle"] | List["C
-0000ab60: 6f6e 6643 6861 6e67 6553 696e 676c 6552  onfChangeSingleR
-0000ab70: 6566 225d 0a20 2020 2029 202d 3e20 4e6f  ef"].    ) -> No
-0000ab80: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
-0000ab90: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
-0000aba0: 725f 6368 616e 6765 7328 7365 6c66 2920  r_changes(self) 
-0000abb0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000abc0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-0000abd0: 2067 6574 5f63 6f6e 7465 7874 2873 656c   get_context(sel
-0000abe0: 6629 202d 3e20 6279 7465 733a 0a20 2020  f) -> bytes:.   
+00008e40: 2020 2064 6566 2073 6574 5f65 6e74 7269     def set_entri
+00008e50: 6573 2873 656c 662c 2065 6e74 733a 204c  es(self, ents: L
+00008e60: 6973 745b 2245 6e74 7279 225d 207c 204c  ist["Entry"] | L
+00008e70: 6973 745b 2245 6e74 7279 5265 6622 5d29  ist["EntryRef"])
+00008e80: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00008e90: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00008ea0: 6620 636c 6561 725f 656e 7472 6965 7328  f clear_entries(
+00008eb0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00008ec0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+00008ed0: 2020 2064 6566 2067 6574 5f6d 7367 5f74     def get_msg_t
+00008ee0: 7970 6528 7365 6c66 2920 2d3e 2022 4d65  ype(self) -> "Me
+00008ef0: 7373 6167 6554 7970 6522 3a0a 2020 2020  ssageType":.    
+00008f00: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+00008f10: 6465 6620 7365 745f 6d73 675f 7479 7065  def set_msg_type
+00008f20: 2873 656c 662c 2074 7970 3a20 224d 6573  (self, typ: "Mes
+00008f30: 7361 6765 5479 7065 2229 202d 3e20 4e6f  sageType") -> No
+00008f40: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+00008f50: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+00008f60: 725f 6d73 675f 7479 7065 2873 656c 6629  r_msg_type(self)
+00008f70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00008f80: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00008f90: 6620 6765 745f 7265 6a65 6374 2873 656c  f get_reject(sel
+00008fa0: 6629 202d 3e20 626f 6f6c 3a0a 2020 2020  f) -> bool:.    
+00008fb0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+00008fc0: 6465 6620 7365 745f 7265 6a65 6374 2873  def set_reject(s
+00008fd0: 656c 662c 2072 656a 6563 743a 2062 6f6f  elf, reject: boo
+00008fe0: 6c29 202d 3e20 4e6f 6e65 3a0a 2020 2020  l) -> None:.    
+00008ff0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+00009000: 6465 6620 636c 6561 725f 7265 6a65 6374  def clear_reject
+00009010: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00009020: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
+00009030: 2020 2020 6465 6620 6765 745f 736e 6170      def get_snap
+00009040: 7368 6f74 2873 656c 6629 202d 3e20 2253  shot(self) -> "S
+00009050: 6e61 7073 686f 7452 6566 223a 0a20 2020  napshotRef":.   
+00009060: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00009070: 2064 6566 2073 6574 5f73 6e61 7073 686f   def set_snapsho
+00009080: 7428 7365 6c66 2c20 736e 6170 7368 6f74  t(self, snapshot
+00009090: 3a20 2253 6e61 7073 686f 7422 207c 2022  : "Snapshot" | "
+000090a0: 536e 6170 7368 6f74 5265 6622 2920 2d3e  SnapshotRef") ->
+000090b0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+000090c0: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
+000090d0: 6c65 6172 5f73 6e61 7073 686f 7428 7365  lear_snapshot(se
+000090e0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+000090f0: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00009100: 2064 6566 2067 6574 5f74 6f28 7365 6c66   def get_to(self
+00009110: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+00009120: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00009130: 6620 7365 745f 746f 2873 656c 662c 2074  f set_to(self, t
+00009140: 6f3a 2069 6e74 2920 2d3e 204e 6f6e 653a  o: int) -> None:
+00009150: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+00009160: 0a20 2020 2064 6566 2063 6c65 6172 5f74  .    def clear_t
+00009170: 6f28 7365 6c66 2920 2d3e 204e 6f6e 653a  o(self) -> None:
+00009180: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+00009190: 0a20 2020 2064 6566 2067 6574 5f72 6571  .    def get_req
+000091a0: 7565 7374 5f73 6e61 7073 686f 7428 7365  uest_snapshot(se
+000091b0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+000091c0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+000091d0: 6465 6620 7365 745f 7265 7175 6573 745f  def set_request_
+000091e0: 736e 6170 7368 6f74 2873 656c 662c 2072  snapshot(self, r
+000091f0: 6571 7565 7374 5f73 6e61 7073 686f 743a  equest_snapshot:
+00009200: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
+00009210: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+00009220: 2020 2064 6566 2063 6c65 6172 5f72 6571     def clear_req
+00009230: 7565 7374 5f73 6e61 7073 686f 7428 7365  uest_snapshot(se
+00009240: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00009250: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00009260: 2064 6566 2068 6173 5f73 6e61 7073 686f   def has_snapsho
+00009270: 7428 7365 6c66 2920 2d3e 2062 6f6f 6c3a  t(self) -> bool:
+00009280: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+00009290: 0a20 2020 2064 6566 2063 6f6d 7075 7465  .    def compute
+000092a0: 5f73 697a 6528 7365 6c66 2920 2d3e 2069  _size(self) -> i
+000092b0: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
+000092c0: 2020 2020 2020 2020 436f 6d70 7574 6520          Compute 
+000092d0: 616e 6420 6361 6368 6520 7369 7a65 206f  and cache size o
+000092e0: 6620 7468 6973 206d 6573 7361 6765 2061  f this message a
+000092f0: 6e64 2061 6c6c 206e 6573 7465 6420 6d65  nd all nested me
+00009300: 7373 6167 6573 0a20 2020 2020 2020 2022  ssages.        "
+00009310: 2222 0a0a 636c 6173 7320 4d65 7373 6167  ""..class Messag
+00009320: 6528 5f5f 4150 495f 4d65 7373 6167 6529  e(__API_Message)
+00009330: 3a0a 2020 2020 2222 2220 2222 220a 0a20  :.    """ """.. 
+00009340: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00009350: 7365 6c66 2920 2d3e 204e 6f6e 653a 202e  self) -> None: .
+00009360: 2e2e 0a20 2020 2064 6566 206d 616b 655f  ...    def make_
+00009370: 7265 6628 7365 6c66 2920 2d3e 2022 4d65  ref(self) -> "Me
+00009380: 7373 6167 6552 6566 223a 202e 2e2e 0a20  ssageRef": .... 
+00009390: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+000093a0: 0a20 2020 2064 6566 2064 6566 6175 6c74  .    def default
+000093b0: 2829 202d 3e20 224d 6573 7361 6765 223a  () -> "Message":
+000093c0: 202e 2e2e 0a20 2020 2040 7374 6174 6963   ....    @static
+000093d0: 6d65 7468 6f64 0a20 2020 2064 6566 2064  method.    def d
+000093e0: 6563 6f64 6528 763a 2062 7974 6573 2920  ecode(v: bytes) 
+000093f0: 2d3e 2022 4d65 7373 6167 6522 3a20 2e2e  -> "Message": ..
+00009400: 2e0a 0a63 6c61 7373 204d 6573 7361 6765  ...class Message
+00009410: 5265 6628 4d65 7373 6167 6529 3a0a 2020  Ref(Message):.  
+00009420: 2020 2222 220a 2020 2020 5265 6665 7265    """.    Refere
+00009430: 6e63 6520 7479 7065 206f 6620 3a63 6c61  nce type of :cla
+00009440: 7373 3a60 4d65 7373 6167 6560 2e0a 2020  ss:`Message`..  
+00009450: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
+00009460: 5049 5f48 6172 6453 7461 7465 285f 5f43  PI_HardState(__C
+00009470: 6c6f 6e65 6162 6c65 2c20 5f5f 456e 636f  loneable, __Enco
+00009480: 6465 722c 205f 5f44 6563 6f64 6572 293a  der, __Decoder):
+00009490: 0a20 2020 2064 6566 2063 6c6f 6e65 2873  .    def clone(s
+000094a0: 656c 6629 202d 3e20 2248 6172 6453 7461  elf) -> "HardSta
+000094b0: 7465 223a 202e 2e2e 0a20 2020 2064 6566  te": ....    def
+000094c0: 2067 6574 5f74 6572 6d28 7365 6c66 2920   get_term(self) 
+000094d0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+000094e0: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
+000094f0: 7365 745f 7465 726d 2873 656c 662c 2074  set_term(self, t
+00009500: 6572 6d3a 2069 6e74 2920 2d3e 204e 6f6e  erm: int) -> Non
+00009510: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
+00009520: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
+00009530: 5f74 6572 6d28 7365 6c66 2920 2d3e 204e  _term(self) -> N
+00009540: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00009550: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
+00009560: 5f76 6f74 6528 7365 6c66 2920 2d3e 2069  _vote(self) -> i
+00009570: 6e74 3a0a 2020 2020 2020 2020 2222 2220  nt:.        """ 
+00009580: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+00009590: 766f 7465 2873 656c 662c 2076 6f74 653a  vote(self, vote:
+000095a0: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
+000095b0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+000095c0: 2020 2064 6566 2063 6c65 6172 5f76 6f74     def clear_vot
+000095d0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
+000095e0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+000095f0: 0a20 2020 2064 6566 2067 6574 5f63 6f6d  .    def get_com
+00009600: 6d69 7428 7365 6c66 2920 2d3e 2069 6e74  mit(self) -> int
+00009610: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
+00009620: 220a 2020 2020 6465 6620 7365 745f 636f  ".    def set_co
+00009630: 6d6d 6974 2873 656c 662c 2063 6f6d 6d69  mmit(self, commi
+00009640: 743a 2069 6e74 2920 2d3e 204e 6f6e 653a  t: int) -> None:
+00009650: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+00009660: 0a20 2020 2064 6566 2063 6c65 6172 5f63  .    def clear_c
+00009670: 6f6d 6d69 7428 7365 6c66 2920 2d3e 204e  ommit(self) -> N
+00009680: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00009690: 2022 2222 0a0a 636c 6173 7320 4861 7264   """..class Hard
+000096a0: 5374 6174 6528 5f5f 4150 495f 4861 7264  State(__API_Hard
+000096b0: 5374 6174 6529 3a0a 2020 2020 2222 2220  State):.    """ 
+000096c0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+000096d0: 6e69 745f 5f28 7365 6c66 2920 2d3e 204e  nit__(self) -> N
+000096e0: 6f6e 653a 202e 2e2e 0a20 2020 2064 6566  one: ....    def
+000096f0: 206d 616b 655f 7265 6628 7365 6c66 2920   make_ref(self) 
+00009700: 2d3e 2022 4861 7264 5374 6174 6552 6566  -> "HardStateRef
+00009710: 223a 202e 2e2e 0a20 2020 2040 7374 6174  ": ....    @stat
+00009720: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00009730: 2064 6566 6175 6c74 2829 202d 3e20 2248   default() -> "H
+00009740: 6172 6453 7461 7465 223a 202e 2e2e 0a20  ardState": .... 
+00009750: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00009760: 0a20 2020 2064 6566 2064 6563 6f64 6528  .    def decode(
+00009770: 763a 2062 7974 6573 2920 2d3e 2022 4861  v: bytes) -> "Ha
+00009780: 7264 5374 6174 6522 3a20 2e2e 2e0a 0a63  rdState": .....c
+00009790: 6c61 7373 2048 6172 6453 7461 7465 5265  lass HardStateRe
+000097a0: 6628 5f5f 4150 495f 4861 7264 5374 6174  f(__API_HardStat
+000097b0: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+000097c0: 5265 6665 7265 6e63 6520 7479 7065 206f  Reference type o
+000097d0: 6620 3a63 6c61 7373 3a60 4861 7264 5374  f :class:`HardSt
+000097e0: 6174 6560 2e0a 2020 2020 2222 220a 0a63  ate`..    """..c
+000097f0: 6c61 7373 205f 5f41 5049 5f47 6574 456e  lass __API_GetEn
+00009800: 7472 6965 7343 6f6e 7465 7874 3a0a 2020  triesContext:.  
+00009810: 2020 6465 6620 6361 6e5f 6173 796e 6328    def can_async(
+00009820: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
+00009830: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00009840: 2020 2043 6865 636b 2069 6620 7468 6520     Check if the 
+00009850: 6361 6c6c 6572 2773 2063 6f6e 7465 7874  caller's context
+00009860: 2073 7570 706f 7274 2066 6574 6368 696e   support fetchin
+00009870: 6720 656e 7472 6965 7320 6173 796e 6368  g entries asynch
+00009880: 726f 6e6f 7573 6c79 2e0a 2020 2020 2020  ronously..      
+00009890: 2020 2222 220a 0a63 6c61 7373 2047 6574    """..class Get
+000098a0: 456e 7472 6965 7343 6f6e 7465 7874 285f  EntriesContext(_
+000098b0: 5f41 5049 5f47 6574 456e 7472 6965 7343  _API_GetEntriesC
+000098c0: 6f6e 7465 7874 293a 0a20 2020 2022 2222  ontext):.    """
+000098d0: 0a20 2020 2052 6563 6f72 6473 2074 6865  .    Records the
+000098e0: 2063 6f6e 7465 7874 206f 6620 7468 6520   context of the 
+000098f0: 6361 6c6c 6572 2077 686f 2063 616c 6c73  caller who calls
+00009900: 2065 6e74 7269 6573 2829 206f 6620 5374   entries() of St
+00009910: 6f72 6167 6520 7472 6169 742e 0a20 2020  orage trait..   
+00009920: 2022 2222 0a0a 2020 2020 4073 7461 7469   """..    @stati
+00009930: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00009940: 656d 7074 7928 6361 6e5f 6173 796e 633a  empty(can_async:
+00009950: 2062 6f6f 6c29 202d 3e20 2247 6574 456e   bool) -> "GetEn
+00009960: 7472 6965 7343 6f6e 7465 7874 223a 0a20  triesContext":. 
+00009970: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00009980: 2020 2055 7365 6420 666f 7220 6361 6c6c     Used for call
+00009990: 6572 7320 6f75 7420 6f66 2072 6166 742e  ers out of raft.
+000099a0: 2043 616c 6c65 7220 6361 6e20 6375 7374   Caller can cust
+000099b0: 6f6d 697a 6520 6966 2069 7420 7375 7070  omize if it supp
+000099c0: 6f72 7473 2061 7379 6e63 2e0a 2020 2020  orts async..    
+000099d0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+000099e0: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+000099f0: 3e20 2247 6574 456e 7472 6965 7343 6f6e  > "GetEntriesCon
+00009a00: 7465 7874 5265 6622 3a20 2e2e 2e0a 0a63  textRef": .....c
+00009a10: 6c61 7373 2047 6574 456e 7472 6965 7343  lass GetEntriesC
+00009a20: 6f6e 7465 7874 5265 6628 5f5f 4150 495f  ontextRef(__API_
+00009a30: 4765 7445 6e74 7269 6573 436f 6e74 6578  GetEntriesContex
+00009a40: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
+00009a50: 5265 6665 7265 6e63 6520 7479 7065 206f  Reference type o
+00009a60: 6620 3a63 6c61 7373 3a60 4765 7445 6e74  f :class:`GetEnt
+00009a70: 7269 6573 436f 6e74 6578 7460 2e0a 2020  riesContext`..  
+00009a80: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
+00009a90: 5049 5f45 6e74 7279 285f 5f43 6c6f 6e65  PI_Entry(__Clone
+00009aa0: 6162 6c65 2c20 5f5f 456e 636f 6465 722c  able, __Encoder,
+00009ab0: 205f 5f44 6563 6f64 6572 293a 0a20 2020   __Decoder):.   
+00009ac0: 2064 6566 2063 6c6f 6e65 2873 656c 6629   def clone(self)
+00009ad0: 202d 3e20 2245 6e74 7279 223a 202e 2e2e   -> "Entry": ...
+00009ae0: 0a20 2020 2064 6566 2067 6574 5f63 6f6e  .    def get_con
+00009af0: 7465 7874 2873 656c 6629 202d 3e20 6279  text(self) -> by
+00009b00: 7465 733a 0a20 2020 2020 2020 2022 2222  tes:.        """
+00009b10: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
+00009b20: 5f63 6f6e 7465 7874 2873 656c 662c 2063  _context(self, c
+00009b30: 6f6e 7465 7874 3a20 6279 7465 7329 202d  ontext: bytes) -
+00009b40: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00009b50: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
+00009b60: 636c 6561 725f 636f 6e74 6578 7428 7365  clear_context(se
+00009b70: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00009b80: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00009b90: 2064 6566 2067 6574 5f64 6174 6128 7365   def get_data(se
+00009ba0: 6c66 2920 2d3e 2062 7974 6573 3a0a 2020  lf) -> bytes:.  
+00009bb0: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
+00009bc0: 2020 6465 6620 7365 745f 6461 7461 2873    def set_data(s
+00009bd0: 656c 662c 2064 6174 613a 2062 7974 6573  elf, data: bytes
+00009be0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00009bf0: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
+00009c00: 6566 2063 6c65 6172 5f64 6174 6128 7365  ef clear_data(se
+00009c10: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00009c20: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+00009c30: 2064 6566 2067 6574 5f65 6e74 7279 5f74   def get_entry_t
+00009c40: 7970 6528 7365 6c66 2920 2d3e 2022 456e  ype(self) -> "En
+00009c50: 7472 7954 7970 6522 3a0a 2020 2020 2020  tryType":.      
+00009c60: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00009c70: 6620 7365 745f 656e 7472 795f 7479 7065  f set_entry_type
+00009c80: 2873 656c 662c 2074 7970 3a20 2245 6e74  (self, typ: "Ent
+00009c90: 7279 5479 7065 2229 202d 3e20 4e6f 6e65  ryType") -> None
+00009ca0: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
+00009cb0: 220a 2020 2020 6465 6620 636c 6561 725f  ".    def clear_
+00009cc0: 656e 7472 795f 7479 7065 2873 656c 6629  entry_type(self)
+00009cd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00009ce0: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+00009cf0: 6620 6765 745f 7465 726d 2873 656c 6629  f get_term(self)
+00009d00: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+00009d10: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+00009d20: 2073 6574 5f74 6572 6d28 7365 6c66 2c20   set_term(self, 
+00009d30: 7465 726d 3a20 696e 7429 202d 3e20 4e6f  term: int) -> No
+00009d40: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+00009d50: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+00009d60: 725f 7465 726d 2873 656c 6629 202d 3e20  r_term(self) -> 
+00009d70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00009d80: 2220 2222 220a 2020 2020 6465 6620 6765  " """.    def ge
+00009d90: 745f 696e 6465 7828 7365 6c66 2920 2d3e  t_index(self) ->
+00009da0: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+00009db0: 2220 2222 220a 2020 2020 6465 6620 7365  " """.    def se
+00009dc0: 745f 696e 6465 7828 7365 6c66 2c20 696e  t_index(self, in
+00009dd0: 6465 783a 2069 6e74 2920 2d3e 204e 6f6e  dex: int) -> Non
+00009de0: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
+00009df0: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
+00009e00: 5f69 6e64 6578 2873 656c 6629 202d 3e20  _index(self) -> 
+00009e10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00009e20: 2220 2222 220a 2020 2020 6465 6620 6765  " """.    def ge
+00009e30: 745f 7379 6e63 5f6c 6f67 2873 656c 6629  t_sync_log(self)
+00009e40: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00009e50: 2020 2222 220a 2020 2020 2020 2020 4465    """.        De
+00009e60: 7072 6563 6174 6564 2120 4974 2069 7320  precated! It is 
+00009e70: 6b65 7074 2066 6f72 2062 6163 6b77 6172  kept for backwar
+00009e80: 6420 636f 6d70 6174 6962 696c 6974 792e  d compatibility.
+00009e90: 0a20 2020 2020 2020 2054 4f44 4f3a 2072  .        TODO: r
+00009ea0: 656d 6f76 6520 6974 2069 6e20 7468 6520  emove it in the 
+00009eb0: 6e65 7874 206d 616a 6f72 2072 656c 6561  next major relea
+00009ec0: 7365 2e0a 2020 2020 2020 2020 2222 220a  se..        """.
+00009ed0: 2020 2020 6465 6620 7365 745f 7379 6e63      def set_sync
+00009ee0: 5f6c 6f67 2873 656c 662c 2073 796e 635f  _log(self, sync_
+00009ef0: 6c6f 673a 2062 6f6f 6c29 202d 3e20 4e6f  log: bool) -> No
+00009f00: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00009f10: 2020 2020 2020 2020 4465 7072 6563 6174          Deprecat
+00009f20: 6564 2120 4974 2069 7320 6b65 7074 2066  ed! It is kept f
+00009f30: 6f72 2062 6163 6b77 6172 6420 636f 6d70  or backward comp
+00009f40: 6174 6962 696c 6974 792e 0a20 2020 2020  atibility..     
+00009f50: 2020 2054 4f44 4f3a 2072 656d 6f76 6520     TODO: remove 
+00009f60: 6974 2069 6e20 7468 6520 6e65 7874 206d  it in the next m
+00009f70: 616a 6f72 2072 656c 6561 7365 2e0a 2020  ajor release..  
+00009f80: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00009f90: 6620 636c 6561 725f 7379 6e63 5f6c 6f67  f clear_sync_log
+00009fa0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00009fb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009fc0: 2020 2020 4465 7072 6563 6174 6564 2120      Deprecated! 
+00009fd0: 4974 2069 7320 6b65 7074 2066 6f72 2062  It is kept for b
+00009fe0: 6163 6b77 6172 6420 636f 6d70 6174 6962  ackward compatib
+00009ff0: 696c 6974 792e 0a20 2020 2020 2020 2054  ility..        T
+0000a000: 4f44 4f3a 2072 656d 6f76 6520 6974 2069  ODO: remove it i
+0000a010: 6e20 7468 6520 6e65 7874 206d 616a 6f72  n the next major
+0000a020: 2072 656c 6561 7365 2e0a 2020 2020 2020   release..      
+0000a030: 2020 2222 220a 0a63 6c61 7373 2045 6e74    """..class Ent
+0000a040: 7279 285f 5f41 5049 5f45 6e74 7279 293a  ry(__API_Entry):
+0000a050: 0a20 2020 2022 2222 0a20 2020 2054 6865  .    """.    The
+0000a060: 2065 6e74 7279 2069 7320 6120 7479 7065   entry is a type
+0000a070: 206f 6620 6368 616e 6765 2074 6861 7420   of change that 
+0000a080: 6e65 6564 7320 746f 2062 6520 6170 706c  needs to be appl
+0000a090: 6965 642e 2049 7420 636f 6e74 6169 6e73  ied. It contains
+0000a0a0: 2074 776f 2064 6174 6120 6669 656c 6473   two data fields
+0000a0b0: 2e0a 2020 2020 5768 696c 6520 7468 6520  ..    While the 
+0000a0c0: 6669 656c 6473 2061 7265 2062 7569 6c74  fields are built
+0000a0d0: 2069 6e74 6f20 7468 6520 6d6f 6465 6c3b   into the model;
+0000a0e0: 2074 6865 6972 2075 7361 6765 2069 7320   their usage is 
+0000a0f0: 6465 7465 726d 696e 6564 2062 7920 7468  determined by th
+0000a100: 6520 656e 7472 795f 7479 7065 2e0a 0a20  e entry_type... 
+0000a110: 2020 2046 6f72 206e 6f72 6d61 6c20 656e     For normal en
+0000a120: 7472 6965 732c 2074 6865 2064 6174 6120  tries, the data 
+0000a130: 6669 656c 6420 7368 6f75 6c64 2063 6f6e  field should con
+0000a140: 7461 696e 2074 6865 2064 6174 6120 6368  tain the data ch
+0000a150: 616e 6765 2074 6861 7420 7368 6f75 6c64  ange that should
+0000a160: 2062 6520 6170 706c 6965 642e 0a20 2020   be applied..   
+0000a170: 2054 6865 2063 6f6e 7465 7874 2066 6965   The context fie
+0000a180: 6c64 2063 616e 2062 6520 7573 6564 2066  ld can be used f
+0000a190: 6f72 2061 6e79 2063 6f6e 7465 7874 7561  or any contextua
+0000a1a0: 6c20 6461 7461 2074 6861 7420 6d69 6768  l data that migh
+0000a1b0: 7420 6265 2072 656c 6576 616e 7420 746f  t be relevant to
+0000a1c0: 2074 6865 0a20 2020 2061 7070 6c69 6361   the.    applica
+0000a1d0: 7469 6f6e 206f 6620 7468 6520 6461 7461  tion of the data
+0000a1e0: 2e0a 0a20 2020 2046 6f72 2063 6f6e 6669  ...    For confi
+0000a1f0: 6775 7261 7469 6f6e 2063 6861 6e67 6573  guration changes
+0000a200: 2c20 7468 6520 6461 7461 2077 696c 6c20  , the data will 
+0000a210: 636f 6e74 6169 6e20 7468 6520 436f 6e66  contain the Conf
+0000a220: 4368 616e 6765 206d 6573 7361 6765 2061  Change message a
+0000a230: 6e64 2074 6865 0a20 2020 2063 6f6e 7465  nd the.    conte
+0000a240: 7874 2077 696c 6c20 7072 6f76 6964 6520  xt will provide 
+0000a250: 616e 7974 6869 6e67 206e 6565 6465 6420  anything needed 
+0000a260: 746f 2061 7373 6973 7420 7468 6520 636f  to assist the co
+0000a270: 6e66 6967 7572 6174 696f 6e20 6368 616e  nfiguration chan
+0000a280: 6765 2e20 5468 6520 636f 6e74 6578 740a  ge. The context.
+0000a290: 2020 2020 6966 2066 6f72 2074 6865 2075      if for the u
+0000a2a0: 7365 7220 746f 2073 6574 2061 6e64 2075  ser to set and u
+0000a2b0: 7365 2069 6e20 7468 6973 2063 6173 652e  se in this case.
+0000a2c0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+0000a2d0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+0000a2e0: 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020   -> None: ....  
+0000a2f0: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
+0000a300: 656c 6629 202d 3e20 2245 6e74 7279 5265  elf) -> "EntryRe
+0000a310: 6622 3a20 2e2e 2e0a 2020 2020 4073 7461  f": ....    @sta
+0000a320: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+0000a330: 6620 6465 6661 756c 7428 2920 2d3e 2022  f default() -> "
+0000a340: 456e 7472 7922 3a20 2e2e 2e0a 2020 2020  Entry": ....    
+0000a350: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+0000a360: 2020 6465 6620 6465 636f 6465 2876 3a20    def decode(v: 
+0000a370: 6279 7465 7329 202d 3e20 2245 6e74 7279  bytes) -> "Entry
+0000a380: 223a 202e 2e2e 0a0a 636c 6173 7320 456e  ": .....class En
+0000a390: 7472 7952 6566 285f 5f41 5049 5f45 6e74  tryRef(__API_Ent
+0000a3a0: 7279 293a 0a20 2020 2022 2222 0a20 2020  ry):.    """.   
+0000a3b0: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
+0000a3c0: 6f66 203a 636c 6173 733a 6045 6e74 7279  of :class:`Entry
+0000a3d0: 602e 0a20 2020 2022 2222 0a0a 636c 6173  `..    """..clas
+0000a3e0: 7320 5f5f 4150 495f 436f 6e66 5374 6174  s __API_ConfStat
+0000a3f0: 6528 5f5f 436c 6f6e 6561 626c 652c 205f  e(__Cloneable, _
+0000a400: 5f45 6e63 6f64 6572 2c20 5f5f 4465 636f  _Encoder, __Deco
+0000a410: 6465 7229 3a0a 2020 2020 6465 6620 636c  der):.    def cl
+0000a420: 6f6e 6528 7365 6c66 2920 2d3e 2022 436f  one(self) -> "Co
+0000a430: 6e66 5374 6174 6522 3a20 2e2e 2e0a 2020  nfState": ....  
+0000a440: 2020 6465 6620 6765 745f 6175 746f 5f6c    def get_auto_l
+0000a450: 6561 7665 2873 656c 6629 202d 3e20 626f  eave(self) -> bo
+0000a460: 6f6c 3a0a 2020 2020 2020 2020 2222 2220  ol:.        """ 
+0000a470: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+0000a480: 6175 746f 5f6c 6561 7665 2873 656c 662c  auto_leave(self,
+0000a490: 2061 7574 6f5f 6c65 6176 653a 2062 6f6f   auto_leave: boo
+0000a4a0: 6c29 202d 3e20 4e6f 6e65 3a0a 2020 2020  l) -> None:.    
+0000a4b0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+0000a4c0: 6465 6620 636c 6561 725f 6175 746f 5f6c  def clear_auto_l
+0000a4d0: 6561 7665 2873 656c 6629 202d 3e20 4e6f  eave(self) -> No
+0000a4e0: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+0000a4f0: 2222 220a 2020 2020 6465 6620 6765 745f  """.    def get_
+0000a500: 6c65 6172 6e65 7273 2873 656c 6629 202d  learners(self) -
+0000a510: 3e20 4c69 7374 5b69 6e74 5d3a 0a20 2020  > List[int]:.   
+0000a520: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+0000a530: 2064 6566 2073 6574 5f6c 6561 726e 6572   def set_learner
+0000a540: 7328 7365 6c66 2c20 6c65 6172 6e65 7273  s(self, learners
+0000a550: 3a20 4c69 7374 5b69 6e74 5d29 202d 3e20  : List[int]) -> 
+0000a560: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000a570: 2220 2222 220a 2020 2020 6465 6620 636c  " """.    def cl
+0000a580: 6561 725f 6c65 6172 6e65 7273 2873 656c  ear_learners(sel
+0000a590: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000a5a0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
+0000a5b0: 6465 6620 6765 745f 6c65 6172 6e65 7273  def get_learners
+0000a5c0: 5f6e 6578 7428 7365 6c66 2920 2d3e 204c  _next(self) -> L
+0000a5d0: 6973 745b 696e 745d 3a0a 2020 2020 2020  ist[int]:.      
+0000a5e0: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
+0000a5f0: 6620 7365 745f 6c65 6172 6e65 7273 5f6e  f set_learners_n
+0000a600: 6578 7428 7365 6c66 2c20 6c65 6172 6e65  ext(self, learne
+0000a610: 7273 5f6e 6578 743a 204c 6973 745b 696e  rs_next: List[in
+0000a620: 745d 2920 2d3e 204e 6f6e 653a 0a20 2020  t]) -> None:.   
+0000a630: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+0000a640: 2064 6566 2063 6c65 6172 5f6c 6561 726e   def clear_learn
+0000a650: 6572 735f 6e65 7874 2873 656c 6629 202d  ers_next(self) -
+0000a660: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000a670: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
+0000a680: 6765 745f 766f 7465 7273 2873 656c 6629  get_voters(self)
+0000a690: 202d 3e20 4c69 7374 5b69 6e74 5d3a 0a20   -> List[int]:. 
+0000a6a0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+0000a6b0: 2020 2064 6566 2073 6574 5f76 6f74 6572     def set_voter
+0000a6c0: 7328 7365 6c66 2c20 766f 7465 7273 3a20  s(self, voters: 
+0000a6d0: 4c69 7374 5b69 6e74 5d29 202d 3e20 4e6f  List[int]) -> No
+0000a6e0: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+0000a6f0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+0000a700: 725f 766f 7465 7273 2873 656c 6629 202d  r_voters(self) -
+0000a710: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000a720: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
+0000a730: 6765 745f 766f 7465 7273 5f6f 7574 676f  get_voters_outgo
+0000a740: 696e 6728 7365 6c66 2920 2d3e 204c 6973  ing(self) -> Lis
+0000a750: 745b 696e 745d 3a0a 2020 2020 2020 2020  t[int]:.        
+0000a760: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
+0000a770: 7365 745f 766f 7465 7273 5f6f 7574 676f  set_voters_outgo
+0000a780: 696e 6728 7365 6c66 2c20 766f 7465 7273  ing(self, voters
+0000a790: 5f6f 7574 676f 696e 673a 204c 6973 745b  _outgoing: List[
+0000a7a0: 696e 745d 2920 2d3e 204e 6f6e 653a 0a20  int]) -> None:. 
+0000a7b0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+0000a7c0: 2020 2064 6566 2063 6c65 6172 5f76 6f74     def clear_vot
+0000a7d0: 6572 735f 6f75 7467 6f69 6e67 2873 656c  ers_outgoing(sel
+0000a7e0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000a7f0: 2020 2020 2222 2220 2222 220a 0a63 6c61      """ """..cla
+0000a800: 7373 2043 6f6e 6653 7461 7465 285f 5f41  ss ConfState(__A
+0000a810: 5049 5f43 6f6e 6653 7461 7465 293a 0a20  PI_ConfState):. 
+0000a820: 2020 2022 2222 2022 2222 0a0a 2020 2020     """ """..    
+0000a830: 6465 6620 5f5f 696e 6974 5f5f 280a 2020  def __init__(.  
+0000a840: 2020 2020 2020 7365 6c66 2c20 766f 7465        self, vote
+0000a850: 7273 3a20 4f70 7469 6f6e 616c 5b4c 6973  rs: Optional[Lis
+0000a860: 745b 696e 745d 5d2c 206c 6561 726e 6572  t[int]], learner
+0000a870: 733a 204f 7074 696f 6e61 6c5b 4c69 7374  s: Optional[List
+0000a880: 5b69 6e74 5d5d 0a20 2020 2029 202d 3e20  [int]].    ) -> 
+0000a890: 4e6f 6e65 3a20 2e2e 2e0a 2020 2020 6465  None: ....    de
+0000a8a0: 6620 6d61 6b65 5f72 6566 2873 656c 6629  f make_ref(self)
+0000a8b0: 202d 3e20 2243 6f6e 6653 7461 7465 5265   -> "ConfStateRe
+0000a8c0: 6622 3a20 2e2e 2e0a 2020 2020 4073 7461  f": ....    @sta
+0000a8d0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+0000a8e0: 6620 6465 6661 756c 7428 2920 2d3e 2022  f default() -> "
+0000a8f0: 436f 6e66 5374 6174 6522 3a20 2e2e 2e0a  ConfState": ....
+0000a900: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+0000a910: 640a 2020 2020 6465 6620 6465 636f 6465  d.    def decode
+0000a920: 2876 3a20 6279 7465 7329 202d 3e20 2243  (v: bytes) -> "C
+0000a930: 6f6e 6653 7461 7465 223a 202e 2e2e 0a0a  onfState": .....
+0000a940: 636c 6173 7320 436f 6e66 5374 6174 6552  class ConfStateR
+0000a950: 6566 285f 5f41 5049 5f43 6f6e 6653 7461  ef(__API_ConfSta
+0000a960: 7465 293a 0a20 2020 2022 2222 0a20 2020  te):.    """.   
+0000a970: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
+0000a980: 6f66 203a 636c 6173 733a 6043 6f6e 6653  of :class:`ConfS
+0000a990: 7461 7465 602e 0a20 2020 2022 2222 0a0a  tate`..    """..
+0000a9a0: 636c 6173 7320 5f5f 4150 495f 436f 6e66  class __API_Conf
+0000a9b0: 4368 616e 6765 5632 285f 5f43 6c6f 6e65  ChangeV2(__Clone
+0000a9c0: 6162 6c65 2c20 5f5f 456e 636f 6465 722c  able, __Encoder,
+0000a9d0: 205f 5f44 6563 6f64 6572 293a 0a20 2020   __Decoder):.   
+0000a9e0: 2064 6566 2063 6c6f 6e65 2873 656c 6629   def clone(self)
+0000a9f0: 202d 3e20 2243 6f6e 6643 6861 6e67 6556   -> "ConfChangeV
+0000aa00: 3222 3a20 2e2e 2e0a 2020 2020 6465 6620  2": ....    def 
+0000aa10: 6765 745f 6368 616e 6765 7328 7365 6c66  get_changes(self
+0000aa20: 2920 2d3e 204c 6973 745b 2243 6f6e 6643  ) -> List["ConfC
+0000aa30: 6861 6e67 6553 696e 676c 6552 6566 225d  hangeSingleRef"]
+0000aa40: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
+0000aa50: 220a 2020 2020 6465 6620 7365 745f 6368  ".    def set_ch
+0000aa60: 616e 6765 7328 0a20 2020 2020 2020 2073  anges(.        s
+0000aa70: 656c 662c 2063 6861 6e67 6573 3a20 4c69  elf, changes: Li
+0000aa80: 7374 5b22 436f 6e66 4368 616e 6765 5369  st["ConfChangeSi
+0000aa90: 6e67 6c65 225d 207c 204c 6973 745b 2243  ngle"] | List["C
+0000aaa0: 6f6e 6643 6861 6e67 6553 696e 676c 6552  onfChangeSingleR
+0000aab0: 6566 225d 0a20 2020 2029 202d 3e20 4e6f  ef"].    ) -> No
+0000aac0: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+0000aad0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+0000aae0: 725f 6368 616e 6765 7328 7365 6c66 2920  r_changes(self) 
+0000aaf0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000ab00: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+0000ab10: 2067 6574 5f63 6f6e 7465 7874 2873 656c   get_context(sel
+0000ab20: 6629 202d 3e20 6279 7465 733a 0a20 2020  f) -> bytes:.   
+0000ab30: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+0000ab40: 2064 6566 2073 6574 5f63 6f6e 7465 7874   def set_context
+0000ab50: 2873 656c 662c 2063 6f6e 7465 7874 3a20  (self, context: 
+0000ab60: 6279 7465 7329 202d 3e20 4e6f 6e65 3a0a  bytes) -> None:.
+0000ab70: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
+0000ab80: 2020 2020 6465 6620 636c 6561 725f 636f      def clear_co
+0000ab90: 6e74 6578 7428 7365 6c66 2920 2d3e 204e  ntext(self) -> N
+0000aba0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000abb0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
+0000abc0: 5f74 7261 6e73 6974 696f 6e28 7365 6c66  _transition(self
+0000abd0: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
+0000abe0: 5472 616e 7369 7469 6f6e 223a 0a20 2020  Transition":.   
 0000abf0: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
-0000ac00: 2064 6566 2073 6574 5f63 6f6e 7465 7874   def set_context
-0000ac10: 2873 656c 662c 2063 6f6e 7465 7874 3a20  (self, context: 
-0000ac20: 6279 7465 7320 7c20 4c69 7374 5b69 6e74  bytes | List[int
-0000ac30: 5d29 202d 3e20 4e6f 6e65 3a0a 2020 2020  ]) -> None:.    
-0000ac40: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-0000ac50: 6465 6620 636c 6561 725f 636f 6e74 6578  def clear_contex
-0000ac60: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
-0000ac70: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-0000ac80: 0a20 2020 2064 6566 2067 6574 5f74 7261  .    def get_tra
-0000ac90: 6e73 6974 696f 6e28 7365 6c66 2920 2d3e  nsition(self) ->
-0000aca0: 2022 436f 6e66 4368 616e 6765 5472 616e   "ConfChangeTran
-0000acb0: 7369 7469 6f6e 223a 0a20 2020 2020 2020  sition":.       
-0000acc0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-0000acd0: 2073 6574 5f74 7261 6e73 6974 696f 6e28   set_transition(
-0000ace0: 7365 6c66 2c20 7472 616e 7369 7469 6f6e  self, transition
-0000acf0: 3a20 2243 6f6e 6643 6861 6e67 6554 7261  : "ConfChangeTra
-0000ad00: 6e73 6974 696f 6e22 2920 2d3e 204e 6f6e  nsition") -> Non
-0000ad10: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
-0000ad20: 2222 0a20 2020 2064 6566 2063 6c65 6172  "".    def clear
-0000ad30: 5f74 7261 6e73 6974 696f 6e28 7365 6c66  _transition(self
-0000ad40: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000ad50: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
-0000ad60: 6566 2065 6e74 6572 5f6a 6f69 6e74 2873  ef enter_joint(s
-0000ad70: 656c 6629 202d 3e20 4f70 7469 6f6e 616c  elf) -> Optional
-0000ad80: 5b62 6f6f 6c5d 3a0a 2020 2020 2020 2020  [bool]:.        
-0000ad90: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
-0000ada0: 6b73 2069 6620 7573 6573 204a 6f69 6e74  ks if uses Joint
-0000adb0: 2043 6f6e 7365 6e73 7573 2e0a 0a20 2020   Consensus...   
-0000adc0: 2020 2020 2049 7420 7769 6c6c 2072 6574       It will ret
-0000add0: 7572 6e20 536f 6d65 2069 6620 616e 6420  urn Some if and 
-0000ade0: 6f6e 6c79 2069 6620 7468 6973 2063 6f6e  only if this con
-0000adf0: 6669 6720 6368 616e 6765 2077 696c 6c20  fig change will 
-0000ae00: 7573 6520 4a6f 696e 7420 436f 6e73 656e  use Joint Consen
-0000ae10: 7375 732c 0a20 2020 2020 2020 2077 6869  sus,.        whi
-0000ae20: 6368 2069 7320 7468 6520 6361 7365 2069  ch is the case i
-0000ae30: 6620 6974 2063 6f6e 7461 696e 7320 6d6f  f it contains mo
-0000ae40: 7265 2074 6861 6e20 6f6e 6520 6368 616e  re than one chan
-0000ae50: 6765 206f 7220 6966 2074 6865 2075 7365  ge or if the use
-0000ae60: 206f 6620 4a6f 696e 740a 2020 2020 2020   of Joint.      
-0000ae70: 2020 436f 6e73 656e 7375 7320 7761 7320    Consensus was 
-0000ae80: 7265 7175 6573 7465 6420 6578 706c 6963  requested explic
-0000ae90: 6974 6c79 2e20 5468 6520 626f 6f6c 2069  itly. The bool i
-0000aea0: 6e64 6963 6174 6573 2077 6865 7468 6572  ndicates whether
-0000aeb0: 2074 6865 204a 6f69 6e74 2053 7461 7465   the Joint State
-0000aec0: 0a20 2020 2020 2020 2077 696c 6c20 6265  .        will be
-0000aed0: 206c 6566 7420 6175 746f 6d61 7469 6361   left automatica
-0000aee0: 6c6c 792e 0a20 2020 2020 2020 2022 2222  lly..        """
-0000aef0: 0a20 2020 2064 6566 206d 6572 6765 5f66  .    def merge_f
-0000af00: 726f 6d5f 6279 7465 7328 7365 6c66 2c20  rom_bytes(self, 
-0000af10: 623a 2062 7974 6573 2920 2d3e 204e 6f6e  b: bytes) -> Non
-0000af20: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-0000af30: 2020 2020 2020 2055 7064 6174 6520 7468         Update th
-0000af40: 6973 206d 6573 7361 6765 206f 626a 6563  is message objec
-0000af50: 7420 7769 7468 2066 6965 6c64 7320 7265  t with fields re
-0000af60: 6164 2066 726f 6d20 6769 7665 6e20 7374  ad from given st
-0000af70: 7265 616d 2e0a 2020 2020 2020 2020 2222  ream..        ""
-0000af80: 220a 2020 2020 6465 6620 6c65 6176 655f  ".    def leave_
-0000af90: 6a6f 696e 7428 7365 6c66 2920 2d3e 2062  joint(self) -> b
-0000afa0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-0000afb0: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
-0000afc0: 6966 2074 6865 2063 6f6e 6669 6775 7261  if the configura
-0000afd0: 7469 6f6e 2063 6861 6e67 6520 6c65 6176  tion change leav
-0000afe0: 6573 2061 206a 6f69 6e74 2063 6f6e 6669  es a joint confi
-0000aff0: 6775 7261 7469 6f6e 2e0a 0a20 2020 2020  guration...     
-0000b000: 2020 2054 6869 7320 6973 2074 6865 2063     This is the c
-0000b010: 6173 6520 6966 2074 6865 2043 6f6e 6643  ase if the ConfC
-0000b020: 6861 6e67 6556 3220 6973 207a 6572 6f2c  hangeV2 is zero,
-0000b030: 2077 6974 6820 7468 6520 706f 7373 6962   with the possib
-0000b040: 6c65 2065 7863 6570 7469 6f6e 206f 660a  le exception of.
-0000b050: 2020 2020 2020 2020 7468 6520 436f 6e74          the Cont
-0000b060: 6578 7420 6669 656c 642e 0a20 2020 2020  ext field..     
-0000b070: 2020 2022 2222 0a20 2020 2064 6566 2061     """.    def a
-0000b080: 735f 7631 2873 656c 6629 202d 3e20 4f70  s_v1(self) -> Op
-0000b090: 7469 6f6e 616c 5b22 436f 6e66 4368 616e  tional["ConfChan
-0000b0a0: 6765 5265 6622 5d3a 0a20 2020 2020 2020  geRef"]:.       
-0000b0b0: 2022 2222 0a20 2020 2020 2020 2043 6f6e   """.        Con
-0000b0c0: 7665 7274 7320 636f 6e66 2063 6861 6e67  verts conf chang
-0000b0d0: 6520 746f 2060 436f 6e66 4368 616e 6765  e to `ConfChange
-0000b0e0: 602e 0a0a 2020 2020 2020 2020 6043 6f6e  `...        `Con
-0000b0f0: 6643 6861 6e67 6556 3260 2063 616e 2774  fChangeV2` can't
-0000b100: 2062 6520 6368 616e 6765 6420 6261 636b   be changed back
-0000b110: 2074 6f20 6043 6f6e 6643 6861 6e67 6560   to `ConfChange`
-0000b120: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000b130: 2020 6465 6620 6173 5f76 3228 7365 6c66    def as_v2(self
-0000b140: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
-0000b150: 5632 223a 0a20 2020 2020 2020 2022 2222  V2":.        """
-0000b160: 0a20 2020 2020 2020 2047 6574 7320 636f  .        Gets co
-0000b170: 6e66 2063 6861 6e67 6520 6173 2060 436f  nf change as `Co
-0000b180: 6e66 4368 616e 6765 5632 602e 0a20 2020  nfChangeV2`..   
-0000b190: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-0000b1a0: 2069 6e74 6f5f 7632 2873 656c 6629 202d   into_v2(self) -
-0000b1b0: 3e20 2243 6f6e 6643 6861 6e67 6556 3222  > "ConfChangeV2"
-0000b1c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000b1d0: 2020 2020 2020 436f 6e76 6572 7473 2063        Converts c
-0000b1e0: 6f6e 6620 6368 616e 6765 2074 6f20 6043  onf change to `C
-0000b1f0: 6f6e 6643 6861 6e67 6556 3260 2e0a 2020  onfChangeV2`..  
-0000b200: 2020 2020 2020 2222 220a 0a63 6c61 7373        """..class
-0000b210: 2043 6f6e 6643 6861 6e67 6556 3228 5f5f   ConfChangeV2(__
-0000b220: 4150 495f 436f 6e66 4368 616e 6765 5632  API_ConfChangeV2
-0000b230: 293a 0a20 2020 2022 2222 0a20 2020 2043  ):.    """.    C
-0000b240: 6f6e 6643 6861 6e67 6556 3220 6d65 7373  onfChangeV2 mess
-0000b250: 6167 6573 2069 6e69 7469 6174 6520 636f  ages initiate co
-0000b260: 6e66 6967 7572 6174 696f 6e20 6368 616e  nfiguration chan
-0000b270: 6765 732e 2054 6865 7920 7375 7070 6f72  ges. They suppor
-0000b280: 7420 626f 7468 2074 6865 0a20 2020 2073  t both the.    s
-0000b290: 696d 706c 6520 226f 6e65 2061 7420 6120  imple "one at a 
-0000b2a0: 7469 6d65 2220 6d65 6d62 6572 7368 6970  time" membership
-0000b2b0: 2063 6861 6e67 6520 7072 6f74 6f63 6f6c   change protocol
-0000b2c0: 2061 6e64 2066 756c 6c20 4a6f 696e 7420   and full Joint 
-0000b2d0: 436f 6e73 656e 7375 730a 2020 2020 616c  Consensus.    al
-0000b2e0: 6c6f 7769 6e67 2066 6f72 2061 7262 6974  lowing for arbit
-0000b2f0: 7261 7279 2063 6861 6e67 6573 2069 6e20  rary changes in 
-0000b300: 6d65 6d62 6572 7368 6970 2e0a 0a20 2020  membership...   
-0000b310: 2054 6865 2073 7570 706c 6965 6420 636f   The supplied co
-0000b320: 6e74 6578 7420 6973 2074 7265 6174 6564  ntext is treated
-0000b330: 2061 7320 616e 206f 7061 7175 6520 7061   as an opaque pa
-0000b340: 796c 6f61 6420 616e 6420 6361 6e20 6265  yload and can be
-0000b350: 2075 7365 6420 746f 0a20 2020 2061 7474   used to.    att
-0000b360: 6163 6820 616e 2061 6374 696f 6e20 6f6e  ach an action on
-0000b370: 2074 6865 2073 7461 7465 206d 6163 6869   the state machi
-0000b380: 6e65 2074 6f20 7468 6520 6170 706c 6963  ne to the applic
-0000b390: 6174 696f 6e20 6f66 2074 6865 2063 6f6e  ation of the con
-0000b3a0: 6669 6720 6368 616e 6765 0a20 2020 2070  fig change.    p
-0000b3b0: 726f 706f 7361 6c2e 204e 6f74 6520 7468  roposal. Note th
-0000b3c0: 6174 2063 6f6e 7472 6172 7920 746f 204a  at contrary to J
-0000b3d0: 6f69 6e74 2043 6f6e 7365 6e73 7573 2061  oint Consensus a
-0000b3e0: 7320 6f75 746c 696e 6564 2069 6e20 7468  s outlined in th
-0000b3f0: 6520 5261 6674 0a20 2020 2070 6170 6572  e Raft.    paper
-0000b400: 5b31 5d2c 2063 6f6e 6669 6775 7261 7469  [1], configurati
-0000b410: 6f6e 2063 6861 6e67 6573 2062 6563 6f6d  on changes becom
-0000b420: 6520 6163 7469 7665 2077 6865 6e20 7468  e active when th
-0000b430: 6579 2061 7265 202a 6170 706c 6965 642a  ey are *applied*
-0000b440: 2074 6f20 7468 650a 2020 2020 7374 6174   to the.    stat
-0000b450: 6520 6d61 6368 696e 6520 286e 6f74 2077  e machine (not w
-0000b460: 6865 6e20 7468 6579 2061 7265 2061 7070  hen they are app
-0000b470: 656e 6465 6420 746f 2074 6865 206c 6f67  ended to the log
-0000b480: 292e 0a0a 2020 2020 5468 6520 7369 6d70  )...    The simp
-0000b490: 6c65 2070 726f 746f 636f 6c20 6361 6e20  le protocol can 
-0000b4a0: 6265 2075 7365 6420 7768 656e 6576 6572  be used whenever
-0000b4b0: 206f 6e6c 7920 6120 7369 6e67 6c65 2063   only a single c
-0000b4c0: 6861 6e67 6520 6973 206d 6164 652e 0a0a  hange is made...
-0000b4d0: 2020 2020 4e6f 6e2d 7369 6d70 6c65 2063      Non-simple c
-0000b4e0: 6861 6e67 6573 2072 6571 7569 7265 2074  hanges require t
-0000b4f0: 6865 2075 7365 206f 6620 4a6f 696e 7420  he use of Joint 
-0000b500: 436f 6e73 656e 7375 732c 2066 6f72 2077  Consensus, for w
-0000b510: 6869 6368 2074 776f 0a20 2020 2063 6f6e  hich two.    con
-0000b520: 6669 6775 7261 7469 6f6e 2063 6861 6e67  figuration chang
-0000b530: 6573 2061 7265 2072 756e 2e20 5468 6520  es are run. The 
-0000b540: 6669 7273 7420 636f 6e66 6967 7572 6174  first configurat
-0000b550: 696f 6e20 6368 616e 6765 2073 7065 6369  ion change speci
-0000b560: 6669 6573 2074 6865 0a20 2020 2064 6573  fies the.    des
-0000b570: 6972 6564 2063 6861 6e67 6573 2061 6e64  ired changes and
-0000b580: 2074 7261 6e73 6974 696f 6e73 2074 6865   transitions the
-0000b590: 2052 6166 7420 6772 6f75 7020 696e 746f   Raft group into
-0000b5a0: 2074 6865 206a 6f69 6e74 2063 6f6e 6669   the joint confi
-0000b5b0: 6775 7261 7469 6f6e 2c0a 2020 2020 696e  guration,.    in
-0000b5c0: 2077 6869 6368 2071 756f 7275 6d20 7265   which quorum re
-0000b5d0: 7175 6972 6573 2061 206d 616a 6f72 6974  quires a majorit
-0000b5e0: 7920 6f66 2062 6f74 6820 7468 6520 7072  y of both the pr
-0000b5f0: 652d 6368 616e 6765 7320 616e 6420 706f  e-changes and po
-0000b600: 7374 2d63 6861 6e67 6573 0a20 2020 2063  st-changes.    c
-0000b610: 6f6e 6669 6775 7261 7469 6f6e 2e20 4a6f  onfiguration. Jo
-0000b620: 696e 7420 436f 6e73 656e 7375 7320 6176  int Consensus av
-0000b630: 6f69 6473 2065 6e74 6572 696e 6720 6672  oids entering fr
-0000b640: 6167 696c 6520 696e 7465 726d 6564 6961  agile intermedia
-0000b650: 7465 0a20 2020 2063 6f6e 6669 6775 7261  te.    configura
-0000b660: 7469 6f6e 7320 7468 6174 2063 6f75 6c64  tions that could
-0000b670: 2063 6f6d 7072 6f6d 6973 6520 7375 7276   compromise surv
-0000b680: 6976 6162 696c 6974 792e 2046 6f72 2065  ivability. For e
-0000b690: 7861 6d70 6c65 2c20 7769 7468 6f75 7420  xample, without 
-0000b6a0: 7468 650a 2020 2020 7573 6520 6f66 204a  the.    use of J
-0000b6b0: 6f69 6e74 2043 6f6e 7365 6e73 7573 2061  oint Consensus a
-0000b6c0: 6e64 2072 756e 6e69 6e67 2061 6372 6f73  nd running acros
-0000b6d0: 7320 7468 7265 6520 6176 6169 6c61 6269  s three availabi
-0000b6e0: 6c69 7479 207a 6f6e 6573 2077 6974 6820  lity zones with 
-0000b6f0: 610a 2020 2020 7265 706c 6963 6174 696f  a.    replicatio
-0000b700: 6e20 6661 6374 6f72 206f 6620 7468 7265  n factor of thre
-0000b710: 652c 2069 7420 6973 206e 6f74 2070 6f73  e, it is not pos
-0000b720: 7369 626c 6520 746f 2072 6570 6c61 6365  sible to replace
-0000b730: 2061 2076 6f74 6572 2077 6974 686f 7574   a voter without
-0000b740: 0a20 2020 2065 6e74 6572 696e 6720 616e  .    entering an
-0000b750: 2069 6e74 6572 6d65 6469 6174 6520 636f   intermediate co
-0000b760: 6e66 6967 7572 6174 696f 6e20 7468 6174  nfiguration that
-0000b770: 2064 6f65 7320 6e6f 7420 7375 7276 6976   does not surviv
-0000b780: 6520 7468 6520 6f75 7461 6765 206f 660a  e the outage of.
-0000b790: 2020 2020 6f6e 6520 6176 6169 6c61 6269      one availabi
-0000b7a0: 6c69 7479 207a 6f6e 652e 0a0a 2020 2020  lity zone...    
-0000b7b0: 5468 6520 7072 6f76 6964 6564 2043 6f6e  The provided Con
-0000b7c0: 6643 6861 6e67 6554 7261 6e73 6974 696f  fChangeTransitio
-0000b7d0: 6e20 7370 6563 6966 6965 7320 686f 7720  n specifies how 
-0000b7e0: 2861 6e64 2077 6865 7468 6572 2920 4a6f  (and whether) Jo
-0000b7f0: 696e 7420 436f 6e73 656e 7375 730a 2020  int Consensus.  
-0000b800: 2020 6973 2075 7365 642c 2061 6e64 2061    is used, and a
-0000b810: 7373 6967 6e73 2074 6865 2074 6173 6b20  ssigns the task 
-0000b820: 6f66 206c 6561 7669 6e67 2074 6865 206a  of leaving the j
-0000b830: 6f69 6e74 2063 6f6e 6669 6775 7261 7469  oint configurati
-0000b840: 6f6e 2065 6974 6865 7220 746f 0a20 2020  on either to.   
-0000b850: 2052 6166 7420 6f72 2074 6865 2061 7070   Raft or the app
-0000b860: 6c69 6361 7469 6f6e 2e20 4c65 6176 696e  lication. Leavin
-0000b870: 6720 7468 6520 6a6f 696e 7420 636f 6e66  g the joint conf
-0000b880: 6967 7572 6174 696f 6e20 6973 2061 6363  iguration is acc
-0000b890: 6f6d 706c 6973 6865 6420 6279 0a20 2020  omplished by.   
-0000b8a0: 2070 726f 706f 7369 6e67 2061 2043 6f6e   proposing a Con
-0000b8b0: 6643 6861 6e67 6556 3220 7769 7468 206f  fChangeV2 with o
-0000b8c0: 6e6c 7920 616e 6420 6f70 7469 6f6e 616c  nly and optional
-0000b8d0: 6c79 2074 6865 2043 6f6e 7465 7874 2066  ly the Context f
-0000b8e0: 6965 6c64 0a20 2020 2070 6f70 756c 6174  ield.    populat
-0000b8f0: 6564 2e0a 0a20 2020 2046 6f72 2064 6574  ed...    For det
-0000b900: 6169 6c73 206f 6e20 5261 6674 206d 656d  ails on Raft mem
-0000b910: 6265 7273 6869 7020 6368 616e 6765 732c  bership changes,
-0000b920: 2073 6565 3a0a 0a20 2020 205b 315d 3a20   see:..    [1]: 
-0000b930: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0000b940: 6f6d 2f6f 6e67 6172 6469 652f 6469 7373  om/ongardie/diss
-0000b950: 6572 7461 7469 6f6e 2f62 6c6f 622f 6d61  ertation/blob/ma
-0000b960: 7374 6572 2f6f 6e6c 696e 652d 7472 696d  ster/online-trim
-0000b970: 2e70 6466 0a20 2020 2022 2222 0a0a 2020  .pdf.    """..  
-0000b980: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000b990: 656c 6629 202d 3e20 4e6f 6e65 3a20 2e2e  elf) -> None: ..
-0000b9a0: 2e0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-0000b9b0: 686f 640a 2020 2020 6465 6620 6465 6661  hod.    def defa
-0000b9c0: 756c 7428 2920 2d3e 2022 436f 6e66 4368  ult() -> "ConfCh
-0000b9d0: 616e 6765 5632 223a 202e 2e2e 0a20 2020  angeV2": ....   
-0000b9e0: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
-0000b9f0: 6c66 2920 2d3e 2022 436f 6e66 4368 616e  lf) -> "ConfChan
-0000ba00: 6765 5632 5265 6622 3a20 2e2e 2e0a 2020  geV2Ref": ....  
-0000ba10: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0000ba20: 2020 2020 6465 6620 6465 636f 6465 2876      def decode(v
-0000ba30: 3a20 4c69 7374 5b69 6e74 5d20 7c20 6279  : List[int] | by
-0000ba40: 7465 7329 202d 3e20 2243 6f6e 6643 6861  tes) -> "ConfCha
-0000ba50: 6e67 6556 3222 3a20 2e2e 2e0a 0a63 6c61  ngeV2": .....cla
-0000ba60: 7373 2043 6f6e 6643 6861 6e67 6556 3252  ss ConfChangeV2R
-0000ba70: 6566 285f 5f41 5049 5f43 6f6e 6643 6861  ef(__API_ConfCha
-0000ba80: 6e67 6556 3229 3a0a 2020 2020 2222 220a  ngeV2):.    """.
-0000ba90: 2020 2020 5265 6665 7265 6e63 6520 7479      Reference ty
-0000baa0: 7065 206f 6620 3a63 6c61 7373 3a60 436f  pe of :class:`Co
-0000bab0: 6e66 4368 616e 6765 5632 602e 0a20 2020  nfChangeV2`..   
-0000bac0: 2022 2222 0a0a 636c 6173 7320 5f5f 4150   """..class __AP
-0000bad0: 495f 436f 6e66 4368 616e 6765 5369 6e67  I_ConfChangeSing
-0000bae0: 6c65 285f 5f43 6c6f 6e65 6162 6c65 2c20  le(__Cloneable, 
-0000baf0: 5f5f 456e 636f 6465 722c 205f 5f44 6563  __Encoder, __Dec
-0000bb00: 6f64 6572 293a 0a20 2020 2064 6566 2063  oder):.    def c
-0000bb10: 6c6f 6e65 2873 656c 6629 202d 3e20 2243  lone(self) -> "C
-0000bb20: 6f6e 6643 6861 6e67 6553 696e 676c 6522  onfChangeSingle"
-0000bb30: 3a20 2e2e 2e0a 2020 2020 6465 6620 6765  : ....    def ge
-0000bb40: 745f 6e6f 6465 5f69 6428 7365 6c66 2920  t_node_id(self) 
-0000bb50: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-0000bb60: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-0000bb70: 7365 745f 6e6f 6465 5f69 6428 7365 6c66  set_node_id(self
-0000bb80: 2c20 6e6f 6465 5f69 643a 2069 6e74 293a  , node_id: int):
-0000bb90: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-0000bba0: 0a20 2020 2064 6566 2063 6c65 6172 5f6e  .    def clear_n
-0000bbb0: 6f64 655f 6964 2873 656c 6629 202d 3e20  ode_id(self) -> 
-0000bbc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000bbd0: 2220 2222 220a 2020 2020 6465 6620 6765  " """.    def ge
-0000bbe0: 745f 6368 616e 6765 5f74 7970 6528 7365  t_change_type(se
-0000bbf0: 6c66 2920 2d3e 2022 436f 6e66 4368 616e  lf) -> "ConfChan
-0000bc00: 6765 5479 7065 223a 0a20 2020 2020 2020  geType":.       
-0000bc10: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-0000bc20: 2073 6574 5f63 6861 6e67 655f 7479 7065   set_change_type
-0000bc30: 2873 656c 662c 2074 7970 3a20 2243 6f6e  (self, typ: "Con
-0000bc40: 6643 6861 6e67 6554 7970 6522 2920 2d3e  fChangeType") ->
-0000bc50: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-0000bc60: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
-0000bc70: 6c65 6172 5f63 6861 6e67 655f 7479 7065  lear_change_type
-0000bc80: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000bc90: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-0000bca0: 0a63 6c61 7373 2043 6f6e 6643 6861 6e67  .class ConfChang
-0000bcb0: 6553 696e 676c 6528 5f5f 4150 495f 436f  eSingle(__API_Co
-0000bcc0: 6e66 4368 616e 6765 5369 6e67 6c65 293a  nfChangeSingle):
-0000bcd0: 0a20 2020 2022 2222 0a20 2020 2043 6f6e  .    """.    Con
-0000bce0: 6643 6861 6e67 6553 696e 676c 6520 6973  fChangeSingle is
-0000bcf0: 2061 6e20 696e 6469 7669 6475 616c 2063   an individual c
-0000bd00: 6f6e 6669 6775 7261 7469 6f6e 2063 6861  onfiguration cha
-0000bd10: 6e67 6520 6f70 6572 6174 696f 6e2e 204d  nge operation. M
-0000bd20: 756c 7469 706c 650a 2020 2020 7375 6368  ultiple.    such
-0000bd30: 206f 7065 7261 7469 6f6e 7320 6361 6e20   operations can 
-0000bd40: 6265 2063 6172 7269 6564 206f 7574 2061  be carried out a
-0000bd50: 746f 6d69 6361 6c6c 7920 7669 6120 6120  tomically via a 
-0000bd60: 436f 6e66 4368 616e 6765 5632 2e0a 2020  ConfChangeV2..  
-0000bd70: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-0000bd80: 5f69 6e69 745f 5f28 7365 6c66 2920 2d3e  _init__(self) ->
-0000bd90: 204e 6f6e 653a 202e 2e2e 0a20 2020 2064   None: ....    d
-0000bda0: 6566 206d 616b 655f 7265 6628 7365 6c66  ef make_ref(self
-0000bdb0: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
-0000bdc0: 5369 6e67 6c65 5265 6622 3a20 2e2e 2e0a  SingleRef": ....
-0000bdd0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-0000bde0: 640a 2020 2020 6465 6620 6465 6661 756c  d.    def defaul
-0000bdf0: 7428 2920 2d3e 2022 436f 6e66 4368 616e  t() -> "ConfChan
-0000be00: 6765 5369 6e67 6c65 223a 202e 2e2e 0a20  geSingle": .... 
-0000be10: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-0000be20: 0a20 2020 2064 6566 2064 6563 6f64 6528  .    def decode(
-0000be30: 763a 204c 6973 745b 696e 745d 207c 2062  v: List[int] | b
-0000be40: 7974 6573 2920 2d3e 2022 436f 6e66 4368  ytes) -> "ConfCh
-0000be50: 616e 6765 5369 6e67 6c65 223a 202e 2e2e  angeSingle": ...
-0000be60: 0a0a 636c 6173 7320 436f 6e66 4368 616e  ..class ConfChan
-0000be70: 6765 5369 6e67 6c65 5265 6628 5f5f 4150  geSingleRef(__AP
-0000be80: 495f 436f 6e66 4368 616e 6765 5369 6e67  I_ConfChangeSing
-0000be90: 6c65 293a 0a20 2020 2022 2222 0a20 2020  le):.    """.   
-0000bea0: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
-0000beb0: 6f66 203a 636c 6173 733a 6043 6f6e 6643  of :class:`ConfC
-0000bec0: 6861 6e67 6553 696e 676c 6560 2e0a 2020  hangeSingle`..  
-0000bed0: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
-0000bee0: 5049 5f43 6f6e 6643 6861 6e67 6528 5f5f  PI_ConfChange(__
-0000bef0: 436c 6f6e 6561 626c 652c 205f 5f45 6e63  Cloneable, __Enc
-0000bf00: 6f64 6572 2c20 5f5f 4465 636f 6465 7229  oder, __Decoder)
-0000bf10: 3a0a 2020 2020 6465 6620 636c 6f6e 6528  :.    def clone(
-0000bf20: 7365 6c66 2920 2d3e 2022 436f 6e66 4368  self) -> "ConfCh
-0000bf30: 616e 6765 223a 202e 2e2e 0a20 2020 2064  ange": ....    d
-0000bf40: 6566 2067 6574 5f69 6428 7365 6c66 2920  ef get_id(self) 
-0000bf50: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-0000bf60: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-0000bf70: 7365 745f 6964 2873 656c 662c 2069 643a  set_id(self, id:
-0000bf80: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
-0000bf90: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
-0000bfa0: 2020 2064 6566 2063 6c65 6172 5f69 6428     def clear_id(
-0000bfb0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000bfc0: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
-0000bfd0: 2020 2064 6566 2067 6574 5f6e 6f64 655f     def get_node_
-0000bfe0: 6964 2873 656c 6629 202d 3e20 696e 743a  id(self) -> int:
-0000bff0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-0000c000: 0a20 2020 2064 6566 2073 6574 5f6e 6f64  .    def set_nod
-0000c010: 655f 6964 2873 656c 662c 206e 6f64 655f  e_id(self, node_
-0000c020: 6964 3a20 696e 7429 202d 3e20 4e6f 6e65  id: int) -> None
-0000c030: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
-0000c040: 220a 2020 2020 6465 6620 636c 6561 725f  ".    def clear_
-0000c050: 6e6f 6465 5f69 6428 7365 6c66 2920 2d3e  node_id(self) ->
-0000c060: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-0000c070: 2222 2022 2222 0a20 2020 2064 6566 2067  "" """.    def g
-0000c080: 6574 5f63 6861 6e67 655f 7479 7065 2873  et_change_type(s
-0000c090: 656c 6629 202d 3e20 2243 6f6e 6643 6861  elf) -> "ConfCha
-0000c0a0: 6e67 6554 7970 6522 3a0a 2020 2020 2020  ngeType":.      
-0000c0b0: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-0000c0c0: 6620 7365 745f 6368 616e 6765 5f74 7970  f set_change_typ
-0000c0d0: 6528 7365 6c66 2c20 7479 703a 2022 436f  e(self, typ: "Co
-0000c0e0: 6e66 4368 616e 6765 5479 7065 2229 202d  nfChangeType") -
-0000c0f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000c100: 2222 2220 2222 220a 2020 2020 6465 6620  """ """.    def 
-0000c110: 636c 6561 725f 6368 616e 6765 5f74 7970  clear_change_typ
-0000c120: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-0000c130: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-0000c140: 0a20 2020 2064 6566 2067 6574 5f63 6f6e  .    def get_con
-0000c150: 7465 7874 2873 656c 6629 202d 3e20 6279  text(self) -> by
-0000c160: 7465 733a 0a20 2020 2020 2020 2022 2222  tes:.        """
-0000c170: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-0000c180: 5f63 6f6e 7465 7874 2873 656c 662c 2063  _context(self, c
-0000c190: 6f6e 7465 7874 3a20 6279 7465 7320 7c20  ontext: bytes | 
-0000c1a0: 4c69 7374 5b69 6e74 5d29 202d 3e20 4e6f  List[int]) -> No
-0000c1b0: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
-0000c1c0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
-0000c1d0: 725f 636f 6e74 6578 7428 7365 6c66 2920  r_context(self) 
-0000c1e0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000c1f0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
-0000c200: 206d 6572 6765 5f66 726f 6d5f 6279 7465   merge_from_byte
-0000c210: 7328 7365 6c66 2c20 623a 2062 7974 6573  s(self, b: bytes
-0000c220: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000c230: 2020 2022 2222 0a20 2020 2020 2020 2055     """.        U
-0000c240: 7064 6174 6520 7468 6973 206d 6573 7361  pdate this messa
-0000c250: 6765 206f 626a 6563 7420 7769 7468 2066  ge object with f
-0000c260: 6965 6c64 7320 7265 6164 2066 726f 6d20  ields read from 
-0000c270: 6769 7665 6e20 7374 7265 616d 2e0a 2020  given stream..  
-0000c280: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-0000c290: 6620 6173 5f76 3128 7365 6c66 2920 2d3e  f as_v1(self) ->
-0000c2a0: 204f 7074 696f 6e61 6c5b 2243 6f6e 6643   Optional["ConfC
-0000c2b0: 6861 6e67 6552 6566 225d 3a0a 2020 2020  hangeRef"]:.    
-0000c2c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c2d0: 436f 6e76 6572 7473 2063 6f6e 6620 6368  Converts conf ch
-0000c2e0: 616e 6765 2074 6f20 6043 6f6e 6643 6861  ange to `ConfCha
-0000c2f0: 6e67 6560 2e0a 0a20 2020 2020 2020 2060  nge`...        `
-0000c300: 436f 6e66 4368 616e 6765 5632 6020 6361  ConfChangeV2` ca
-0000c310: 6e27 7420 6265 2063 6861 6e67 6564 2062  n't be changed b
-0000c320: 6163 6b20 746f 2060 436f 6e66 4368 616e  ack to `ConfChan
-0000c330: 6765 602e 0a20 2020 2020 2020 2022 2222  ge`..        """
-0000c340: 0a20 2020 2064 6566 2061 735f 7632 2873  .    def as_v2(s
-0000c350: 656c 6629 202d 3e20 2243 6f6e 6643 6861  elf) -> "ConfCha
-0000c360: 6e67 6556 3222 3a0a 2020 2020 2020 2020  ngeV2":.        
-0000c370: 2222 220a 2020 2020 2020 2020 4765 7473  """.        Gets
-0000c380: 2063 6f6e 6620 6368 616e 6765 2061 7320   conf change as 
-0000c390: 6043 6f6e 6643 6861 6e67 6556 3260 2e0a  `ConfChangeV2`..
-0000c3a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000c3b0: 6465 6620 696e 746f 5f76 3228 7365 6c66  def into_v2(self
-0000c3c0: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
-0000c3d0: 5632 223a 0a20 2020 2020 2020 2022 2222  V2":.        """
-0000c3e0: 0a20 2020 2020 2020 2043 6f6e 7665 7274  .        Convert
-0000c3f0: 7320 636f 6e66 2063 6861 6e67 6520 746f  s conf change to
-0000c400: 2060 436f 6e66 4368 616e 6765 5632 602e   `ConfChangeV2`.
-0000c410: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
-0000c420: 6173 7320 436f 6e66 4368 616e 6765 285f  ass ConfChange(_
-0000c430: 5f41 5049 5f43 6f6e 6643 6861 6e67 6529  _API_ConfChange)
-0000c440: 3a0a 2020 2020 2222 2220 2222 220a 0a20  :.    """ """.. 
-0000c450: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0000c460: 7365 6c66 2920 2d3e 204e 6f6e 653a 202e  self) -> None: .
-0000c470: 2e2e 0a20 2020 2064 6566 206d 616b 655f  ...    def make_
-0000c480: 7265 6628 7365 6c66 2920 2d3e 2022 436f  ref(self) -> "Co
-0000c490: 6e66 4368 616e 6765 5265 6622 3a20 2e2e  nfChangeRef": ..
-0000c4a0: 2e0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-0000c4b0: 686f 640a 2020 2020 6465 6620 6465 6661  hod.    def defa
-0000c4c0: 756c 7428 2920 2d3e 2022 436f 6e66 4368  ult() -> "ConfCh
-0000c4d0: 616e 6765 223a 202e 2e2e 0a20 2020 2040  ange": ....    @
-0000c4e0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-0000c4f0: 2064 6566 2064 6563 6f64 6528 763a 204c   def decode(v: L
-0000c500: 6973 745b 696e 745d 207c 2062 7974 6573  ist[int] | bytes
-0000c510: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
-0000c520: 223a 202e 2e2e 0a0a 636c 6173 7320 436f  ": .....class Co
-0000c530: 6e66 4368 616e 6765 5265 6628 5f5f 4150  nfChangeRef(__AP
-0000c540: 495f 436f 6e66 4368 616e 6765 293a 0a20  I_ConfChange):. 
-0000c550: 2020 2022 2222 0a20 2020 2052 6566 6572     """.    Refer
-0000c560: 656e 6365 2074 7970 6520 6f66 203a 636c  ence type of :cl
-0000c570: 6173 733a 6043 6f6e 6643 6861 6e67 6560  ass:`ConfChange`
-0000c580: 2e0a 2020 2020 2222 220a 0a63 6c61 7373  ..    """..class
-0000c590: 205f 5f41 5049 5f55 6e73 7461 626c 653a   __API_Unstable:
-0000c5a0: 0a20 2020 2064 6566 206d 6179 6265 5f66  .    def maybe_f
-0000c5b0: 6972 7374 5f69 6e64 6578 2873 656c 6629  irst_index(self)
-0000c5c0: 202d 3e20 4f70 7469 6f6e 616c 5b69 6e74   -> Optional[int
-0000c5d0: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-0000c5e0: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
-0000c5f0: 6865 2069 6e64 6578 206f 6620 7468 6520  he index of the 
-0000c600: 6669 7273 7420 706f 7373 6962 6c65 2065  first possible e
-0000c610: 6e74 7279 2069 6e20 656e 7472 6965 730a  ntry in entries.
-0000c620: 2020 2020 2020 2020 6966 2069 7420 6861          if it ha
-0000c630: 7320 6120 736e 6170 7368 6f74 2e0a 2020  s a snapshot..  
-0000c640: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-0000c650: 6620 6d61 7962 655f 6c61 7374 5f69 6e64  f maybe_last_ind
-0000c660: 6578 2873 656c 6629 202d 3e20 4f70 7469  ex(self) -> Opti
-0000c670: 6f6e 616c 5b69 6e74 5d3a 0a20 2020 2020  onal[int]:.     
-0000c680: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-0000c690: 6574 7572 6e73 2074 6865 206c 6173 7420  eturns the last 
-0000c6a0: 696e 6465 7820 6966 2069 7420 6861 7320  index if it has 
-0000c6b0: 6174 206c 6561 7374 206f 6e65 2075 6e73  at least one uns
-0000c6c0: 7461 626c 6520 656e 7472 7920 6f72 2073  table entry or s
-0000c6d0: 6e61 7073 686f 742e 0a20 2020 2020 2020  napshot..       
-0000c6e0: 2022 2222 0a20 2020 2064 6566 206d 6179   """.    def may
-0000c6f0: 6265 5f74 6572 6d28 7365 6c66 2920 2d3e  be_term(self) ->
-0000c700: 204f 7074 696f 6e61 6c5b 696e 745d 3a0a   Optional[int]:.
-0000c710: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000c720: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
-0000c730: 7465 726d 206f 6620 7468 6520 656e 7472  term of the entr
-0000c740: 7920 6174 2069 6e64 6578 2069 6478 2c20  y at index idx, 
-0000c750: 6966 2074 6865 7265 2069 7320 616e 792e  if there is any.
-0000c760: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000c770: 2064 6566 206d 7573 745f 6368 6563 6b5f   def must_check_
-0000c780: 6f75 746f 6662 6f75 6e64 7328 7365 6c66  outofbounds(self
-0000c790: 2c20 6c6f 3a20 696e 742c 2068 693a 2069  , lo: int, hi: i
-0000c7a0: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-0000c7b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c7c0: 2041 7373 6572 7473 2074 6865 2060 6869   Asserts the `hi
-0000c7d0: 6020 616e 6420 606c 6f60 2076 616c 7565  ` and `lo` value
-0000c7e0: 7320 6167 6169 6e73 7420 6561 6368 206f  s against each o
-0000c7f0: 7468 6572 2061 6e64 2061 6761 696e 7374  ther and against
-0000c800: 2074 6865 0a20 2020 2020 2020 2065 6e74   the.        ent
-0000c810: 7269 6573 2074 6865 6d73 656c 7665 732e  ries themselves.
-0000c820: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000c830: 2064 6566 2073 6c69 6365 2873 656c 662c   def slice(self,
-0000c840: 206c 6f3a 2069 6e74 2c20 6869 3a20 696e   lo: int, hi: in
-0000c850: 7429 202d 3e20 4c69 7374 5b22 456e 7472  t) -> List["Entr
-0000c860: 7952 6566 225d 3a0a 2020 2020 2020 2020  yRef"]:.        
-0000c870: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0000c880: 726e 7320 6120 736c 6963 6520 6f66 2065  rns a slice of e
-0000c890: 6e74 7269 6573 2062 6574 7765 656e 2074  ntries between t
-0000c8a0: 6865 2068 6967 6820 616e 6420 6c6f 772e  he high and low.
-0000c8b0: 0a0a 2020 2020 2020 2020 2320 5061 6e69  ..        # Pani
-0000c8c0: 6373 0a0a 2020 2020 2020 2020 5061 6e69  cs..        Pani
-0000c8d0: 6373 2069 6620 7468 6520 606c 6f60 206f  cs if the `lo` o
-0000c8e0: 7220 6068 6960 2061 7265 206f 7574 206f  r `hi` are out o
-0000c8f0: 6620 626f 756e 6473 2e0a 2020 2020 2020  f bounds..      
-0000c900: 2020 5061 6e69 6373 2069 6620 606c 6f20    Panics if `lo 
-0000c910: 3e20 6869 602e 0a20 2020 2020 2020 2022  > hi`..        "
-0000c920: 2222 0a20 2020 2064 6566 2073 7461 626c  "".    def stabl
-0000c930: 655f 736e 6170 2873 656c 662c 2069 6e64  e_snap(self, ind
-0000c940: 6578 3a20 696e 7429 202d 3e20 4e6f 6e65  ex: int) -> None
-0000c950: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000c960: 2020 2020 2020 436c 6561 7273 2074 6865        Clears the
-0000c970: 2075 6e73 7461 626c 6520 736e 6170 7368   unstable snapsh
-0000c980: 6f74 2e0a 2020 2020 2020 2020 2222 220a  ot..        """.
-0000c990: 2020 2020 6465 6620 7374 6162 6c65 5f65      def stable_e
-0000c9a0: 6e74 7269 6573 2873 656c 662c 2069 6e64  ntries(self, ind
-0000c9b0: 6578 3a20 696e 742c 2074 6572 6d3a 2069  ex: int, term: i
-0000c9c0: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-0000c9d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c9e0: 2043 6c65 6172 7320 7468 6520 756e 7374   Clears the unst
-0000c9f0: 6162 6c65 2065 6e74 7269 6573 2061 6e64  able entries and
-0000ca00: 206d 6f76 6573 2074 6865 2073 7461 626c   moves the stabl
-0000ca10: 6520 6f66 6673 6574 2075 7020 746f 2074  e offset up to t
-0000ca20: 6865 0a20 2020 2020 2020 206c 6173 7420  he.        last 
-0000ca30: 696e 6465 782c 2069 6620 7468 6572 6520  index, if there 
-0000ca40: 6973 2061 6e79 2e0a 2020 2020 2020 2020  is any..        
-0000ca50: 2222 220a 2020 2020 6465 6620 7265 7374  """.    def rest
-0000ca60: 6f72 6528 7365 6c66 2c20 736e 6170 3a20  ore(self, snap: 
-0000ca70: 2253 6e61 7073 686f 7452 6566 2229 202d  "SnapshotRef") -
-0000ca80: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000ca90: 2222 220a 2020 2020 2020 2020 4672 6f6d  """.        From
-0000caa0: 2061 2067 6976 656e 2073 6e61 7073 686f   a given snapsho
-0000cab0: 742c 2072 6573 746f 7265 7320 7468 6520  t, restores the 
-0000cac0: 736e 6170 7368 6f74 2074 6f20 7365 6c66  snapshot to self
-0000cad0: 2c20 6275 7420 646f 6573 6e27 7420 756e  , but doesn't un
-0000cae0: 7061 636b 2e0a 2020 2020 2020 2020 2222  pack..        ""
-0000caf0: 220a 2020 2020 6465 6620 7472 756e 6361  ".    def trunca
-0000cb00: 7465 5f61 6e64 5f61 7070 656e 6428 7365  te_and_append(se
-0000cb10: 6c66 2c20 656e 7473 3a20 4c69 7374 5b22  lf, ents: List["
-0000cb20: 456e 7472 7922 5d20 7c20 4c69 7374 5b22  Entry"] | List["
-0000cb30: 456e 7472 7952 6566 225d 2920 2d3e 204e  EntryRef"]) -> N
-0000cb40: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000cb50: 0a20 2020 2020 2020 2041 7070 656e 6420  .        Append 
-0000cb60: 656e 7472 6965 7320 746f 2075 6e73 7461  entries to unsta
-0000cb70: 626c 652c 2074 7275 6e63 6174 6520 6c6f  ble, truncate lo
-0000cb80: 6361 6c20 626c 6f63 6b20 6669 7273 7420  cal block first 
-0000cb90: 6966 206f 7665 726c 6170 7065 642e 0a0a  if overlapped...
-0000cba0: 2020 2020 2020 2020 2320 5061 6e69 6373          # Panics
-0000cbb0: 0a0a 2020 2020 2020 2020 5061 6e69 6373  ..        Panics
-0000cbc0: 2069 6620 7472 756e 6361 7465 206c 6f67   if truncate log
-0000cbd0: 7320 746f 2074 6865 2065 6e74 7279 2062  s to the entry b
-0000cbe0: 6566 6f72 6520 736e 6170 7368 6f74 0a20  efore snapshot. 
-0000cbf0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-0000cc00: 6566 2067 6574 5f65 6e74 7269 6573 5f73  ef get_entries_s
-0000cc10: 697a 6528 7365 6c66 2920 2d3e 2069 6e74  ize(self) -> int
-0000cc20: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000cc30: 2020 2020 2020 6065 6e74 7269 6573 5f73        `entries_s
-0000cc40: 697a 6560 3a20 5468 6520 7369 7a65 206f  ize`: The size o
-0000cc50: 6620 656e 7472 6965 730a 2020 2020 2020  f entries.      
-0000cc60: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
-0000cc70: 745f 656e 7472 6965 735f 7369 7a65 2873  t_entries_size(s
-0000cc80: 656c 662c 2065 6e74 7269 6573 5f73 697a  elf, entries_siz
-0000cc90: 653a 2069 6e74 2920 2d3e 204e 6f6e 653a  e: int) -> None:
-0000cca0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ccb0: 2020 2020 2060 656e 7472 6965 735f 7369       `entries_si
-0000ccc0: 7a65 603a 2054 6865 2073 697a 6520 6f66  ze`: The size of
-0000ccd0: 2065 6e74 7269 6573 0a20 2020 2020 2020   entries.       
-0000cce0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-0000ccf0: 5f6f 6666 7365 7428 7365 6c66 2920 2d3e  _offset(self) ->
-0000cd00: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-0000cd10: 220a 2020 2020 2020 2020 606f 6666 7365  ".        `offse
-0000cd20: 7460 3a20 5468 6520 6f66 6673 6574 2066  t`: The offset f
-0000cd30: 726f 6d20 7468 6520 7665 6374 6f72 2069  rom the vector i
-0000cd40: 6e64 6578 2e0a 2020 2020 2020 2020 2222  ndex..        ""
-0000cd50: 220a 2020 2020 6465 6620 7365 745f 6f66  ".    def set_of
-0000cd60: 6673 6574 2873 656c 662c 206f 6666 7365  fset(self, offse
-0000cd70: 743a 2069 6e74 2920 2d3e 204e 6f6e 653a  t: int) -> None:
-0000cd80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000cd90: 2020 2020 2060 6f66 6673 6574 603a 2054       `offset`: T
-0000cda0: 6865 206f 6666 7365 7420 6672 6f6d 2074  he offset from t
-0000cdb0: 6865 2076 6563 746f 7220 696e 6465 782e  he vector index.
-0000cdc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000cdd0: 2064 6566 2067 6574 5f65 6e74 7269 6573   def get_entries
-0000cde0: 2873 656c 6629 202d 3e20 4c69 7374 5b22  (self) -> List["
-0000cdf0: 456e 7472 7952 6566 225d 3a0a 2020 2020  EntryRef"]:.    
-0000ce00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ce10: 6065 6e74 7269 6573 603a 2041 6c6c 2065  `entries`: All e
-0000ce20: 6e74 7269 6573 2074 6861 7420 6861 7665  ntries that have
-0000ce30: 206e 6f74 2079 6574 2062 6565 6e20 7772   not yet been wr
-0000ce40: 6974 7465 6e20 746f 2073 746f 7261 6765  itten to storage
-0000ce50: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000ce60: 2020 6465 6620 7365 745f 656e 7472 6965    def set_entrie
-0000ce70: 7328 7365 6c66 2c20 656e 7473 3a20 4c69  s(self, ents: Li
-0000ce80: 7374 5b22 456e 7472 7922 5d20 7c20 4c69  st["Entry"] | Li
-0000ce90: 7374 5b22 456e 7472 7952 6566 225d 2920  st["EntryRef"]) 
-0000cea0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000ceb0: 2022 2222 0a20 2020 2020 2020 2060 656e   """.        `en
-0000cec0: 7472 6965 7360 3a20 416c 6c20 656e 7472  tries`: All entr
-0000ced0: 6965 7320 7468 6174 2068 6176 6520 6e6f  ies that have no
-0000cee0: 7420 7965 7420 6265 656e 2077 7269 7474  t yet been writt
-0000cef0: 656e 2074 6f20 7374 6f72 6167 652e 0a20  en to storage.. 
-0000cf00: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-0000cf10: 6566 2067 6574 5f6c 6f67 6765 7228 7365  ef get_logger(se
-0000cf20: 6c66 2920 2d3e 2022 4c6f 6767 6572 5265  lf) -> "LoggerRe
-0000cf30: 6622 3a0a 2020 2020 2020 2020 2222 220a  f":.        """.
-0000cf40: 2020 2020 2020 2020 606c 6f67 6765 7260          `logger`
-0000cf50: 3a20 5468 6520 7461 6720 746f 2075 7365  : The tag to use
-0000cf60: 2077 6865 6e20 6c6f 6767 696e 672e 0a20   when logging.. 
-0000cf70: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-0000cf80: 6566 2073 6574 5f6c 6f67 6765 7228 7365  ef set_logger(se
-0000cf90: 6c66 2c20 6c6f 6767 6572 3a20 224c 6f67  lf, logger: "Log
-0000cfa0: 6765 7222 207c 2022 4c6f 6767 6572 5265  ger" | "LoggerRe
-0000cfb0: 6622 2920 2d3e 204e 6f6e 653a 0a20 2020  f") -> None:.   
-0000cfc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000cfd0: 2060 6c6f 6767 6572 603a 2054 6865 2074   `logger`: The t
-0000cfe0: 6167 2074 6f20 7573 6520 7768 656e 206c  ag to use when l
-0000cff0: 6f67 6769 6e67 2e0a 2020 2020 2020 2020  ogging..        
-0000d000: 2222 220a 2020 2020 6465 6620 6765 745f  """.    def get_
-0000d010: 736e 6170 7368 6f74 2873 656c 6629 202d  snapshot(self) -
-0000d020: 3e20 4f70 7469 6f6e 616c 5b22 536e 6170  > Optional["Snap
-0000d030: 7368 6f74 5265 6622 5d3a 0a20 2020 2020  shotRef"]:.     
-0000d040: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-0000d050: 736e 6170 7368 6f74 603a 2054 6865 2069  snapshot`: The i
-0000d060: 6e63 6f6d 696e 6720 756e 7374 6162 6c65  ncoming unstable
-0000d070: 2073 6e61 7073 686f 742c 2069 6620 616e   snapshot, if an
-0000d080: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
-0000d090: 2020 2064 6566 2073 6574 5f73 6e61 7073     def set_snaps
-0000d0a0: 686f 7428 7365 6c66 2c20 736e 6170 7368  hot(self, snapsh
-0000d0b0: 6f74 3a20 2253 6e61 7073 686f 7422 207c  ot: "Snapshot" |
-0000d0c0: 2022 536e 6170 7368 6f74 5265 6622 2920   "SnapshotRef") 
-0000d0d0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000d0e0: 2022 2222 0a20 2020 2020 2020 2060 736e   """.        `sn
-0000d0f0: 6170 7368 6f74 603a 2054 6865 2069 6e63  apshot`: The inc
-0000d100: 6f6d 696e 6720 756e 7374 6162 6c65 2073  oming unstable s
-0000d110: 6e61 7073 686f 742c 2069 6620 616e 792e  napshot, if any.
-0000d120: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
-0000d130: 6173 7320 556e 7374 6162 6c65 285f 5f41  ass Unstable(__A
-0000d140: 5049 5f55 6e73 7461 626c 6529 3a0a 2020  PI_Unstable):.  
-0000d150: 2020 2222 220a 2020 2020 5468 6520 6075    """.    The `u
-0000d160: 6e73 7461 626c 652e 656e 7472 6965 735b  nstable.entries[
-0000d170: 695d 6020 6861 7320 7261 6674 206c 6f67  i]` has raft log
-0000d180: 2070 6f73 6974 696f 6e20 6069 2b75 6e73   position `i+uns
-0000d190: 7461 626c 652e 6f66 6673 6574 602e 0a20  table.offset`.. 
-0000d1a0: 2020 204e 6f74 6520 7468 6174 2060 756e     Note that `un
-0000d1b0: 7374 6162 6c65 2e6f 6666 7365 7460 206d  stable.offset` m
-0000d1c0: 6179 2062 6520 6c65 7373 2074 6861 6e20  ay be less than 
-0000d1d0: 7468 6520 6869 6768 6573 7420 6c6f 670a  the highest log.
-0000d1e0: 2020 2020 706f 7369 7469 6f6e 2069 6e20      position in 
-0000d1f0: 7374 6f72 6167 653b 2074 6869 7320 6d65  storage; this me
-0000d200: 616e 7320 7468 6174 2074 6865 206e 6578  ans that the nex
-0000d210: 7420 7772 6974 6520 746f 2073 746f 7261  t write to stora
-0000d220: 6765 0a20 2020 206d 6967 6874 206e 6565  ge.    might nee
-0000d230: 6420 746f 2074 7275 6e63 6174 6520 7468  d to truncate th
-0000d240: 6520 6c6f 6720 6265 666f 7265 2070 6572  e log before per
-0000d250: 7369 7374 696e 6720 756e 7374 6162 6c65  sisting unstable
-0000d260: 2e65 6e74 7269 6573 2e0a 2020 2020 2222  .entries..    ""
-0000d270: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-0000d280: 745f 5f28 7365 6c66 2c20 6f66 6673 6574  t__(self, offset
-0000d290: 3a20 696e 742c 206c 6f67 6765 723a 2022  : int, logger: "
-0000d2a0: 4c6f 6767 6572 2220 7c20 224c 6f67 6765  Logger" | "Logge
-0000d2b0: 7252 6566 2229 202d 3e20 4e6f 6e65 3a20  rRef") -> None: 
-0000d2c0: 2e2e 2e0a 2020 2020 6465 6620 6d61 6b65  ....    def make
-0000d2d0: 5f72 6566 2873 656c 6629 202d 3e20 2255  _ref(self) -> "U
-0000d2e0: 6e73 7461 626c 6552 6566 223a 202e 2e2e  nstableRef": ...
-0000d2f0: 0a0a 636c 6173 7320 556e 7374 6162 6c65  ..class Unstable
-0000d300: 5265 6628 5f5f 4150 495f 556e 7374 6162  Ref(__API_Unstab
-0000d310: 6c65 293a 0a20 2020 2022 2222 0a20 2020  le):.    """.   
-0000d320: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
-0000d330: 6f66 203a 636c 6173 733a 6055 6e73 7461  of :class:`Unsta
-0000d340: 626c 6560 2e0a 2020 2020 2222 220a 0a63  ble`..    """..c
-0000d350: 6c61 7373 205f 5f41 5049 5f53 6f66 7453  lass __API_SoftS
-0000d360: 7461 7465 3a0a 2020 2020 6465 6620 6765  tate:.    def ge
-0000d370: 745f 6c65 6164 6572 5f69 6428 7365 6c66  t_leader_id(self
-0000d380: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-0000d390: 2020 2222 220a 2020 2020 2020 2020 606c    """.        `l
-0000d3a0: 6561 6465 725f 6964 603a 2054 6865 2070  eader_id`: The p
-0000d3b0: 6f74 656e 7469 616c 206c 6561 6465 7220  otential leader 
-0000d3c0: 6f66 2074 6865 2063 6c75 7374 6572 2e0a  of the cluster..
-0000d3d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000d3e0: 6465 6620 7365 745f 6c65 6164 6572 5f69  def set_leader_i
-0000d3f0: 6428 7365 6c66 2c20 6c65 6164 6572 5f69  d(self, leader_i
-0000d400: 643a 2069 6e74 2920 2d3e 204e 6f6e 653a  d: int) -> None:
-0000d410: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000d420: 2020 2020 2060 6c65 6164 6572 5f69 6460       `leader_id`
-0000d430: 3a20 5468 6520 706f 7465 6e74 6961 6c20  : The potential 
-0000d440: 6c65 6164 6572 206f 6620 7468 6520 636c  leader of the cl
-0000d450: 7573 7465 722e 0a20 2020 2020 2020 2022  uster..        "
-0000d460: 2222 0a20 2020 2064 6566 2067 6574 5f72  "".    def get_r
-0000d470: 6166 745f 7374 6174 6528 7365 6c66 2920  aft_state(self) 
-0000d480: 2d3e 2022 5374 6174 6552 6f6c 6522 3a0a  -> "StateRole":.
-0000d490: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000d4a0: 2020 2020 6072 6166 745f 7374 6174 6560      `raft_state`
-0000d4b0: 3a20 5468 6520 736f 6674 2072 6f6c 6520  : The soft role 
-0000d4c0: 7468 6973 206e 6f64 6520 6d61 7920 7461  this node may ta
-0000d4d0: 6b65 2e0a 2020 2020 2020 2020 2222 220a  ke..        """.
-0000d4e0: 2020 2020 6465 6620 7365 745f 7261 6674      def set_raft
-0000d4f0: 5f73 7461 7465 2873 656c 662c 2072 6f6c  _state(self, rol
-0000d500: 653a 2022 5374 6174 6552 6f6c 6522 2920  e: "StateRole") 
-0000d510: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000d520: 2022 2222 0a20 2020 2020 2020 2060 7261   """.        `ra
-0000d530: 6674 5f73 7461 7465 603a 2054 6865 2073  ft_state`: The s
-0000d540: 6f66 7420 726f 6c65 2074 6869 7320 6e6f  oft role this no
-0000d550: 6465 206d 6179 2074 616b 652e 0a20 2020  de may take..   
-0000d560: 2020 2020 2022 2222 0a0a 636c 6173 7320       """..class 
-0000d570: 536f 6674 5374 6174 6528 5f5f 4150 495f  SoftState(__API_
-0000d580: 536f 6674 5374 6174 6529 3a0a 2020 2020  SoftState):.    
-0000d590: 2222 220a 2020 2020 536f 6674 5374 6174  """.    SoftStat
-0000d5a0: 6520 7072 6f76 6964 6573 2073 7461 7465  e provides state
-0000d5b0: 2074 6861 7420 6973 2075 7365 6675 6c20   that is useful 
-0000d5c0: 666f 7220 6c6f 6767 696e 6720 616e 6420  for logging and 
-0000d5d0: 6465 6275 6767 696e 672e 0a20 2020 2054  debugging..    T
-0000d5e0: 6865 2073 7461 7465 2069 7320 766f 6c61  he state is vola
-0000d5f0: 7469 6c65 2061 6e64 2064 6f65 7320 6e6f  tile and does no
-0000d600: 7420 6e65 6564 2074 6f20 6265 2070 6572  t need to be per
-0000d610: 7369 7374 6564 2074 6f20 7468 6520 5741  sisted to the WA
-0000d620: 4c2e 0a20 2020 2022 2222 0a0a 2020 2020  L..    """..    
-0000d630: 6465 6620 6d61 6b65 5f72 6566 2873 656c  def make_ref(sel
-0000d640: 6629 202d 3e20 2253 6f66 7453 7461 7465  f) -> "SoftState
-0000d650: 5265 6622 3a20 2e2e 2e0a 2020 2020 4073  Ref": ....    @s
-0000d660: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-0000d670: 6465 6620 6465 6661 756c 7428 2920 2d3e  def default() ->
-0000d680: 2022 536f 6674 5374 6174 6522 3a20 2e2e   "SoftState": ..
-0000d690: 2e0a 0a63 6c61 7373 2053 6f66 7453 7461  ...class SoftSta
-0000d6a0: 7465 5265 6628 5f5f 4150 495f 536f 6674  teRef(__API_Soft
-0000d6b0: 5374 6174 6529 3a0a 2020 2020 2222 220a  State):.    """.
-0000d6c0: 2020 2020 5265 6665 7265 6e63 6520 7479      Reference ty
-0000d6d0: 7065 206f 6620 3a63 6c61 7373 3a60 536f  pe of :class:`So
-0000d6e0: 6674 5374 6174 6560 2e0a 2020 2020 2222  ftState`..    ""
-0000d6f0: 220a 0a63 6c61 7373 205f 5f41 5049 5f52  "..class __API_R
-0000d700: 6561 6453 7461 7465 285f 5f43 6c6f 6e65  eadState(__Clone
-0000d710: 6162 6c65 293a 0a20 2020 2064 6566 2063  able):.    def c
-0000d720: 6c6f 6e65 2873 656c 6629 202d 3e20 2252  lone(self) -> "R
-0000d730: 6561 6453 7461 7465 223a 202e 2e2e 0a20  eadState": .... 
-0000d740: 2020 2064 6566 2067 6574 5f69 6e64 6578     def get_index
-0000d750: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
-0000d760: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d770: 2020 2060 696e 6465 7860 3a20 5468 6520     `index`: The 
-0000d780: 696e 6465 7820 6f66 2074 6865 2072 6561  index of the rea
-0000d790: 6420 7374 6174 652e 0a20 2020 2020 2020  d state..       
+0000ac00: 2064 6566 2073 6574 5f74 7261 6e73 6974   def set_transit
+0000ac10: 696f 6e28 7365 6c66 2c20 7472 616e 7369  ion(self, transi
+0000ac20: 7469 6f6e 3a20 2243 6f6e 6643 6861 6e67  tion: "ConfChang
+0000ac30: 6554 7261 6e73 6974 696f 6e22 2920 2d3e  eTransition") ->
+0000ac40: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000ac50: 2222 2022 2222 0a20 2020 2064 6566 2063  "" """.    def c
+0000ac60: 6c65 6172 5f74 7261 6e73 6974 696f 6e28  lear_transition(
+0000ac70: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000ac80: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+0000ac90: 2020 2064 6566 2065 6e74 6572 5f6a 6f69     def enter_joi
+0000aca0: 6e74 2873 656c 6629 202d 3e20 4f70 7469  nt(self) -> Opti
+0000acb0: 6f6e 616c 5b62 6f6f 6c5d 3a0a 2020 2020  onal[bool]:.    
+0000acc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000acd0: 4368 6563 6b73 2069 6620 7573 6573 204a  Checks if uses J
+0000ace0: 6f69 6e74 2043 6f6e 7365 6e73 7573 2e0a  oint Consensus..
+0000acf0: 0a20 2020 2020 2020 2049 7420 7769 6c6c  .        It will
+0000ad00: 2072 6574 7572 6e20 536f 6d65 2069 6620   return Some if 
+0000ad10: 616e 6420 6f6e 6c79 2069 6620 7468 6973  and only if this
+0000ad20: 2063 6f6e 6669 6720 6368 616e 6765 2077   config change w
+0000ad30: 696c 6c20 7573 6520 4a6f 696e 7420 436f  ill use Joint Co
+0000ad40: 6e73 656e 7375 732c 0a20 2020 2020 2020  nsensus,.       
+0000ad50: 2077 6869 6368 2069 7320 7468 6520 6361   which is the ca
+0000ad60: 7365 2069 6620 6974 2063 6f6e 7461 696e  se if it contain
+0000ad70: 7320 6d6f 7265 2074 6861 6e20 6f6e 6520  s more than one 
+0000ad80: 6368 616e 6765 206f 7220 6966 2074 6865  change or if the
+0000ad90: 2075 7365 206f 6620 4a6f 696e 740a 2020   use of Joint.  
+0000ada0: 2020 2020 2020 436f 6e73 656e 7375 7320        Consensus 
+0000adb0: 7761 7320 7265 7175 6573 7465 6420 6578  was requested ex
+0000adc0: 706c 6963 6974 6c79 2e20 5468 6520 626f  plicitly. The bo
+0000add0: 6f6c 2069 6e64 6963 6174 6573 2077 6865  ol indicates whe
+0000ade0: 7468 6572 2074 6865 204a 6f69 6e74 2053  ther the Joint S
+0000adf0: 7461 7465 0a20 2020 2020 2020 2077 696c  tate.        wil
+0000ae00: 6c20 6265 206c 6566 7420 6175 746f 6d61  l be left automa
+0000ae10: 7469 6361 6c6c 792e 0a20 2020 2020 2020  tically..       
+0000ae20: 2022 2222 0a20 2020 2064 6566 206d 6572   """.    def mer
+0000ae30: 6765 5f66 726f 6d5f 6279 7465 7328 7365  ge_from_bytes(se
+0000ae40: 6c66 2c20 623a 2062 7974 6573 2920 2d3e  lf, b: bytes) ->
+0000ae50: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000ae60: 2222 0a20 2020 2020 2020 2055 7064 6174  "".        Updat
+0000ae70: 6520 7468 6973 206d 6573 7361 6765 206f  e this message o
+0000ae80: 626a 6563 7420 7769 7468 2066 6965 6c64  bject with field
+0000ae90: 7320 7265 6164 2066 726f 6d20 6769 7665  s read from give
+0000aea0: 6e20 7374 7265 616d 2e0a 2020 2020 2020  n stream..      
+0000aeb0: 2020 2222 220a 2020 2020 6465 6620 6c65    """.    def le
+0000aec0: 6176 655f 6a6f 696e 7428 7365 6c66 2920  ave_joint(self) 
+0000aed0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+0000aee0: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
+0000aef0: 636b 7320 6966 2074 6865 2063 6f6e 6669  cks if the confi
+0000af00: 6775 7261 7469 6f6e 2063 6861 6e67 6520  guration change 
+0000af10: 6c65 6176 6573 2061 206a 6f69 6e74 2063  leaves a joint c
+0000af20: 6f6e 6669 6775 7261 7469 6f6e 2e0a 0a20  onfiguration... 
+0000af30: 2020 2020 2020 2054 6869 7320 6973 2074         This is t
+0000af40: 6865 2063 6173 6520 6966 2074 6865 2043  he case if the C
+0000af50: 6f6e 6643 6861 6e67 6556 3220 6973 207a  onfChangeV2 is z
+0000af60: 6572 6f2c 2077 6974 6820 7468 6520 706f  ero, with the po
+0000af70: 7373 6962 6c65 2065 7863 6570 7469 6f6e  ssible exception
+0000af80: 206f 660a 2020 2020 2020 2020 7468 6520   of.        the 
+0000af90: 436f 6e74 6578 7420 6669 656c 642e 0a20  Context field.. 
+0000afa0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+0000afb0: 6566 2061 735f 7631 2873 656c 6629 202d  ef as_v1(self) -
+0000afc0: 3e20 4f70 7469 6f6e 616c 5b22 436f 6e66  > Optional["Conf
+0000afd0: 4368 616e 6765 5265 6622 5d3a 0a20 2020  ChangeRef"]:.   
+0000afe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000aff0: 2043 6f6e 7665 7274 7320 636f 6e66 2063   Converts conf c
+0000b000: 6861 6e67 6520 746f 2060 436f 6e66 4368  hange to `ConfCh
+0000b010: 616e 6765 602e 0a0a 2020 2020 2020 2020  ange`...        
+0000b020: 6043 6f6e 6643 6861 6e67 6556 3260 2063  `ConfChangeV2` c
+0000b030: 616e 2774 2062 6520 6368 616e 6765 6420  an't be changed 
+0000b040: 6261 636b 2074 6f20 6043 6f6e 6643 6861  back to `ConfCha
+0000b050: 6e67 6560 2e0a 2020 2020 2020 2020 2222  nge`..        ""
+0000b060: 220a 2020 2020 6465 6620 6173 5f76 3228  ".    def as_v2(
+0000b070: 7365 6c66 2920 2d3e 2022 436f 6e66 4368  self) -> "ConfCh
+0000b080: 616e 6765 5632 223a 0a20 2020 2020 2020  angeV2":.       
+0000b090: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+0000b0a0: 7320 636f 6e66 2063 6861 6e67 6520 6173  s conf change as
+0000b0b0: 2060 436f 6e66 4368 616e 6765 5632 602e   `ConfChangeV2`.
+0000b0c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000b0d0: 2064 6566 2069 6e74 6f5f 7632 2873 656c   def into_v2(sel
+0000b0e0: 6629 202d 3e20 2243 6f6e 6643 6861 6e67  f) -> "ConfChang
+0000b0f0: 6556 3222 3a0a 2020 2020 2020 2020 2222  eV2":.        ""
+0000b100: 220a 2020 2020 2020 2020 436f 6e76 6572  ".        Conver
+0000b110: 7473 2063 6f6e 6620 6368 616e 6765 2074  ts conf change t
+0000b120: 6f20 6043 6f6e 6643 6861 6e67 6556 3260  o `ConfChangeV2`
+0000b130: 2e0a 2020 2020 2020 2020 2222 220a 0a63  ..        """..c
+0000b140: 6c61 7373 2043 6f6e 6643 6861 6e67 6556  lass ConfChangeV
+0000b150: 3228 5f5f 4150 495f 436f 6e66 4368 616e  2(__API_ConfChan
+0000b160: 6765 5632 293a 0a20 2020 2022 2222 0a20  geV2):.    """. 
+0000b170: 2020 2043 6f6e 6643 6861 6e67 6556 3220     ConfChangeV2 
+0000b180: 6d65 7373 6167 6573 2069 6e69 7469 6174  messages initiat
+0000b190: 6520 636f 6e66 6967 7572 6174 696f 6e20  e configuration 
+0000b1a0: 6368 616e 6765 732e 2054 6865 7920 7375  changes. They su
+0000b1b0: 7070 6f72 7420 626f 7468 2074 6865 0a20  pport both the. 
+0000b1c0: 2020 2073 696d 706c 6520 226f 6e65 2061     simple "one a
+0000b1d0: 7420 6120 7469 6d65 2220 6d65 6d62 6572  t a time" member
+0000b1e0: 7368 6970 2063 6861 6e67 6520 7072 6f74  ship change prot
+0000b1f0: 6f63 6f6c 2061 6e64 2066 756c 6c20 4a6f  ocol and full Jo
+0000b200: 696e 7420 436f 6e73 656e 7375 730a 2020  int Consensus.  
+0000b210: 2020 616c 6c6f 7769 6e67 2066 6f72 2061    allowing for a
+0000b220: 7262 6974 7261 7279 2063 6861 6e67 6573  rbitrary changes
+0000b230: 2069 6e20 6d65 6d62 6572 7368 6970 2e0a   in membership..
+0000b240: 0a20 2020 2054 6865 2073 7570 706c 6965  .    The supplie
+0000b250: 6420 636f 6e74 6578 7420 6973 2074 7265  d context is tre
+0000b260: 6174 6564 2061 7320 616e 206f 7061 7175  ated as an opaqu
+0000b270: 6520 7061 796c 6f61 6420 616e 6420 6361  e payload and ca
+0000b280: 6e20 6265 2075 7365 6420 746f 0a20 2020  n be used to.   
+0000b290: 2061 7474 6163 6820 616e 2061 6374 696f   attach an actio
+0000b2a0: 6e20 6f6e 2074 6865 2073 7461 7465 206d  n on the state m
+0000b2b0: 6163 6869 6e65 2074 6f20 7468 6520 6170  achine to the ap
+0000b2c0: 706c 6963 6174 696f 6e20 6f66 2074 6865  plication of the
+0000b2d0: 2063 6f6e 6669 6720 6368 616e 6765 0a20   config change. 
+0000b2e0: 2020 2070 726f 706f 7361 6c2e 204e 6f74     proposal. Not
+0000b2f0: 6520 7468 6174 2063 6f6e 7472 6172 7920  e that contrary 
+0000b300: 746f 204a 6f69 6e74 2043 6f6e 7365 6e73  to Joint Consens
+0000b310: 7573 2061 7320 6f75 746c 696e 6564 2069  us as outlined i
+0000b320: 6e20 7468 6520 5261 6674 0a20 2020 2070  n the Raft.    p
+0000b330: 6170 6572 5b31 5d2c 2063 6f6e 6669 6775  aper[1], configu
+0000b340: 7261 7469 6f6e 2063 6861 6e67 6573 2062  ration changes b
+0000b350: 6563 6f6d 6520 6163 7469 7665 2077 6865  ecome active whe
+0000b360: 6e20 7468 6579 2061 7265 202a 6170 706c  n they are *appl
+0000b370: 6965 642a 2074 6f20 7468 650a 2020 2020  ied* to the.    
+0000b380: 7374 6174 6520 6d61 6368 696e 6520 286e  state machine (n
+0000b390: 6f74 2077 6865 6e20 7468 6579 2061 7265  ot when they are
+0000b3a0: 2061 7070 656e 6465 6420 746f 2074 6865   appended to the
+0000b3b0: 206c 6f67 292e 0a0a 2020 2020 5468 6520   log)...    The 
+0000b3c0: 7369 6d70 6c65 2070 726f 746f 636f 6c20  simple protocol 
+0000b3d0: 6361 6e20 6265 2075 7365 6420 7768 656e  can be used when
+0000b3e0: 6576 6572 206f 6e6c 7920 6120 7369 6e67  ever only a sing
+0000b3f0: 6c65 2063 6861 6e67 6520 6973 206d 6164  le change is mad
+0000b400: 652e 0a0a 2020 2020 4e6f 6e2d 7369 6d70  e...    Non-simp
+0000b410: 6c65 2063 6861 6e67 6573 2072 6571 7569  le changes requi
+0000b420: 7265 2074 6865 2075 7365 206f 6620 4a6f  re the use of Jo
+0000b430: 696e 7420 436f 6e73 656e 7375 732c 2066  int Consensus, f
+0000b440: 6f72 2077 6869 6368 2074 776f 0a20 2020  or which two.   
+0000b450: 2063 6f6e 6669 6775 7261 7469 6f6e 2063   configuration c
+0000b460: 6861 6e67 6573 2061 7265 2072 756e 2e20  hanges are run. 
+0000b470: 5468 6520 6669 7273 7420 636f 6e66 6967  The first config
+0000b480: 7572 6174 696f 6e20 6368 616e 6765 2073  uration change s
+0000b490: 7065 6369 6669 6573 2074 6865 0a20 2020  pecifies the.   
+0000b4a0: 2064 6573 6972 6564 2063 6861 6e67 6573   desired changes
+0000b4b0: 2061 6e64 2074 7261 6e73 6974 696f 6e73   and transitions
+0000b4c0: 2074 6865 2052 6166 7420 6772 6f75 7020   the Raft group 
+0000b4d0: 696e 746f 2074 6865 206a 6f69 6e74 2063  into the joint c
+0000b4e0: 6f6e 6669 6775 7261 7469 6f6e 2c0a 2020  onfiguration,.  
+0000b4f0: 2020 696e 2077 6869 6368 2071 756f 7275    in which quoru
+0000b500: 6d20 7265 7175 6972 6573 2061 206d 616a  m requires a maj
+0000b510: 6f72 6974 7920 6f66 2062 6f74 6820 7468  ority of both th
+0000b520: 6520 7072 652d 6368 616e 6765 7320 616e  e pre-changes an
+0000b530: 6420 706f 7374 2d63 6861 6e67 6573 0a20  d post-changes. 
+0000b540: 2020 2063 6f6e 6669 6775 7261 7469 6f6e     configuration
+0000b550: 2e20 4a6f 696e 7420 436f 6e73 656e 7375  . Joint Consensu
+0000b560: 7320 6176 6f69 6473 2065 6e74 6572 696e  s avoids enterin
+0000b570: 6720 6672 6167 696c 6520 696e 7465 726d  g fragile interm
+0000b580: 6564 6961 7465 0a20 2020 2063 6f6e 6669  ediate.    confi
+0000b590: 6775 7261 7469 6f6e 7320 7468 6174 2063  gurations that c
+0000b5a0: 6f75 6c64 2063 6f6d 7072 6f6d 6973 6520  ould compromise 
+0000b5b0: 7375 7276 6976 6162 696c 6974 792e 2046  survivability. F
+0000b5c0: 6f72 2065 7861 6d70 6c65 2c20 7769 7468  or example, with
+0000b5d0: 6f75 7420 7468 650a 2020 2020 7573 6520  out the.    use 
+0000b5e0: 6f66 204a 6f69 6e74 2043 6f6e 7365 6e73  of Joint Consens
+0000b5f0: 7573 2061 6e64 2072 756e 6e69 6e67 2061  us and running a
+0000b600: 6372 6f73 7320 7468 7265 6520 6176 6169  cross three avai
+0000b610: 6c61 6269 6c69 7479 207a 6f6e 6573 2077  lability zones w
+0000b620: 6974 6820 610a 2020 2020 7265 706c 6963  ith a.    replic
+0000b630: 6174 696f 6e20 6661 6374 6f72 206f 6620  ation factor of 
+0000b640: 7468 7265 652c 2069 7420 6973 206e 6f74  three, it is not
+0000b650: 2070 6f73 7369 626c 6520 746f 2072 6570   possible to rep
+0000b660: 6c61 6365 2061 2076 6f74 6572 2077 6974  lace a voter wit
+0000b670: 686f 7574 0a20 2020 2065 6e74 6572 696e  hout.    enterin
+0000b680: 6720 616e 2069 6e74 6572 6d65 6469 6174  g an intermediat
+0000b690: 6520 636f 6e66 6967 7572 6174 696f 6e20  e configuration 
+0000b6a0: 7468 6174 2064 6f65 7320 6e6f 7420 7375  that does not su
+0000b6b0: 7276 6976 6520 7468 6520 6f75 7461 6765  rvive the outage
+0000b6c0: 206f 660a 2020 2020 6f6e 6520 6176 6169   of.    one avai
+0000b6d0: 6c61 6269 6c69 7479 207a 6f6e 652e 0a0a  lability zone...
+0000b6e0: 2020 2020 5468 6520 7072 6f76 6964 6564      The provided
+0000b6f0: 2043 6f6e 6643 6861 6e67 6554 7261 6e73   ConfChangeTrans
+0000b700: 6974 696f 6e20 7370 6563 6966 6965 7320  ition specifies 
+0000b710: 686f 7720 2861 6e64 2077 6865 7468 6572  how (and whether
+0000b720: 2920 4a6f 696e 7420 436f 6e73 656e 7375  ) Joint Consensu
+0000b730: 730a 2020 2020 6973 2075 7365 642c 2061  s.    is used, a
+0000b740: 6e64 2061 7373 6967 6e73 2074 6865 2074  nd assigns the t
+0000b750: 6173 6b20 6f66 206c 6561 7669 6e67 2074  ask of leaving t
+0000b760: 6865 206a 6f69 6e74 2063 6f6e 6669 6775  he joint configu
+0000b770: 7261 7469 6f6e 2065 6974 6865 7220 746f  ration either to
+0000b780: 0a20 2020 2052 6166 7420 6f72 2074 6865  .    Raft or the
+0000b790: 2061 7070 6c69 6361 7469 6f6e 2e20 4c65   application. Le
+0000b7a0: 6176 696e 6720 7468 6520 6a6f 696e 7420  aving the joint 
+0000b7b0: 636f 6e66 6967 7572 6174 696f 6e20 6973  configuration is
+0000b7c0: 2061 6363 6f6d 706c 6973 6865 6420 6279   accomplished by
+0000b7d0: 0a20 2020 2070 726f 706f 7369 6e67 2061  .    proposing a
+0000b7e0: 2043 6f6e 6643 6861 6e67 6556 3220 7769   ConfChangeV2 wi
+0000b7f0: 7468 206f 6e6c 7920 616e 6420 6f70 7469  th only and opti
+0000b800: 6f6e 616c 6c79 2074 6865 2043 6f6e 7465  onally the Conte
+0000b810: 7874 2066 6965 6c64 0a20 2020 2070 6f70  xt field.    pop
+0000b820: 756c 6174 6564 2e0a 0a20 2020 2046 6f72  ulated...    For
+0000b830: 2064 6574 6169 6c73 206f 6e20 5261 6674   details on Raft
+0000b840: 206d 656d 6265 7273 6869 7020 6368 616e   membership chan
+0000b850: 6765 732c 2073 6565 3a0a 0a20 2020 205b  ges, see:..    [
+0000b860: 315d 3a20 6874 7470 733a 2f2f 6769 7468  1]: https://gith
+0000b870: 7562 2e63 6f6d 2f6f 6e67 6172 6469 652f  ub.com/ongardie/
+0000b880: 6469 7373 6572 7461 7469 6f6e 2f62 6c6f  dissertation/blo
+0000b890: 622f 6d61 7374 6572 2f6f 6e6c 696e 652d  b/master/online-
+0000b8a0: 7472 696d 2e70 6466 0a20 2020 2022 2222  trim.pdf.    """
+0000b8b0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0000b8c0: 5f5f 2873 656c 6629 202d 3e20 4e6f 6e65  __(self) -> None
+0000b8d0: 3a20 2e2e 2e0a 2020 2020 4073 7461 7469  : ....    @stati
+0000b8e0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+0000b8f0: 6465 6661 756c 7428 2920 2d3e 2022 436f  default() -> "Co
+0000b900: 6e66 4368 616e 6765 5632 223a 202e 2e2e  nfChangeV2": ...
+0000b910: 0a20 2020 2064 6566 206d 616b 655f 7265  .    def make_re
+0000b920: 6628 7365 6c66 2920 2d3e 2022 436f 6e66  f(self) -> "Conf
+0000b930: 4368 616e 6765 5632 5265 6622 3a20 2e2e  ChangeV2Ref": ..
+0000b940: 2e0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+0000b950: 686f 640a 2020 2020 6465 6620 6465 636f  hod.    def deco
+0000b960: 6465 2876 3a20 6279 7465 7329 202d 3e20  de(v: bytes) -> 
+0000b970: 2243 6f6e 6643 6861 6e67 6556 3222 3a20  "ConfChangeV2": 
+0000b980: 2e2e 2e0a 0a63 6c61 7373 2043 6f6e 6643  .....class ConfC
+0000b990: 6861 6e67 6556 3252 6566 285f 5f41 5049  hangeV2Ref(__API
+0000b9a0: 5f43 6f6e 6643 6861 6e67 6556 3229 3a0a  _ConfChangeV2):.
+0000b9b0: 2020 2020 2222 220a 2020 2020 5265 6665      """.    Refe
+0000b9c0: 7265 6e63 6520 7479 7065 206f 6620 3a63  rence type of :c
+0000b9d0: 6c61 7373 3a60 436f 6e66 4368 616e 6765  lass:`ConfChange
+0000b9e0: 5632 602e 0a20 2020 2022 2222 0a0a 636c  V2`..    """..cl
+0000b9f0: 6173 7320 5f5f 4150 495f 436f 6e66 4368  ass __API_ConfCh
+0000ba00: 616e 6765 5369 6e67 6c65 285f 5f43 6c6f  angeSingle(__Clo
+0000ba10: 6e65 6162 6c65 2c20 5f5f 456e 636f 6465  neable, __Encode
+0000ba20: 722c 205f 5f44 6563 6f64 6572 293a 0a20  r, __Decoder):. 
+0000ba30: 2020 2064 6566 2063 6c6f 6e65 2873 656c     def clone(sel
+0000ba40: 6629 202d 3e20 2243 6f6e 6643 6861 6e67  f) -> "ConfChang
+0000ba50: 6553 696e 676c 6522 3a20 2e2e 2e0a 2020  eSingle": ....  
+0000ba60: 2020 6465 6620 6765 745f 6e6f 6465 5f69    def get_node_i
+0000ba70: 6428 7365 6c66 2920 2d3e 2069 6e74 3a0a  d(self) -> int:.
+0000ba80: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
+0000ba90: 2020 2020 6465 6620 7365 745f 6e6f 6465      def set_node
+0000baa0: 5f69 6428 7365 6c66 2c20 6e6f 6465 5f69  _id(self, node_i
+0000bab0: 643a 2069 6e74 293a 0a20 2020 2020 2020  d: int):.       
+0000bac0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+0000bad0: 2063 6c65 6172 5f6e 6f64 655f 6964 2873   clear_node_id(s
+0000bae0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000baf0: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
+0000bb00: 2020 6465 6620 6765 745f 6368 616e 6765    def get_change
+0000bb10: 5f74 7970 6528 7365 6c66 2920 2d3e 2022  _type(self) -> "
+0000bb20: 436f 6e66 4368 616e 6765 5479 7065 223a  ConfChangeType":
+0000bb30: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+0000bb40: 0a20 2020 2064 6566 2073 6574 5f63 6861  .    def set_cha
+0000bb50: 6e67 655f 7479 7065 2873 656c 662c 2074  nge_type(self, t
+0000bb60: 7970 3a20 2243 6f6e 6643 6861 6e67 6554  yp: "ConfChangeT
+0000bb70: 7970 6522 2920 2d3e 204e 6f6e 653a 0a20  ype") -> None:. 
+0000bb80: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+0000bb90: 2020 2064 6566 2063 6c65 6172 5f63 6861     def clear_cha
+0000bba0: 6e67 655f 7479 7065 2873 656c 6629 202d  nge_type(self) -
+0000bbb0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000bbc0: 2222 2220 2222 220a 0a63 6c61 7373 2043  """ """..class C
+0000bbd0: 6f6e 6643 6861 6e67 6553 696e 676c 6528  onfChangeSingle(
+0000bbe0: 5f5f 4150 495f 436f 6e66 4368 616e 6765  __API_ConfChange
+0000bbf0: 5369 6e67 6c65 293a 0a20 2020 2022 2222  Single):.    """
+0000bc00: 0a20 2020 2043 6f6e 6643 6861 6e67 6553  .    ConfChangeS
+0000bc10: 696e 676c 6520 6973 2061 6e20 696e 6469  ingle is an indi
+0000bc20: 7669 6475 616c 2063 6f6e 6669 6775 7261  vidual configura
+0000bc30: 7469 6f6e 2063 6861 6e67 6520 6f70 6572  tion change oper
+0000bc40: 6174 696f 6e2e 204d 756c 7469 706c 650a  ation. Multiple.
+0000bc50: 2020 2020 7375 6368 206f 7065 7261 7469      such operati
+0000bc60: 6f6e 7320 6361 6e20 6265 2063 6172 7269  ons can be carri
+0000bc70: 6564 206f 7574 2061 746f 6d69 6361 6c6c  ed out atomicall
+0000bc80: 7920 7669 6120 6120 436f 6e66 4368 616e  y via a ConfChan
+0000bc90: 6765 5632 2e0a 2020 2020 2222 220a 0a20  geV2..    """.. 
+0000bca0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0000bcb0: 7365 6c66 2920 2d3e 204e 6f6e 653a 202e  self) -> None: .
+0000bcc0: 2e2e 0a20 2020 2064 6566 206d 616b 655f  ...    def make_
+0000bcd0: 7265 6628 7365 6c66 2920 2d3e 2022 436f  ref(self) -> "Co
+0000bce0: 6e66 4368 616e 6765 5369 6e67 6c65 5265  nfChangeSingleRe
+0000bcf0: 6622 3a20 2e2e 2e0a 2020 2020 4073 7461  f": ....    @sta
+0000bd00: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+0000bd10: 6620 6465 6661 756c 7428 2920 2d3e 2022  f default() -> "
+0000bd20: 436f 6e66 4368 616e 6765 5369 6e67 6c65  ConfChangeSingle
+0000bd30: 223a 202e 2e2e 0a20 2020 2040 7374 6174  ": ....    @stat
+0000bd40: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0000bd50: 2064 6563 6f64 6528 763a 2062 7974 6573   decode(v: bytes
+0000bd60: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
+0000bd70: 5369 6e67 6c65 223a 202e 2e2e 0a0a 636c  Single": .....cl
+0000bd80: 6173 7320 436f 6e66 4368 616e 6765 5369  ass ConfChangeSi
+0000bd90: 6e67 6c65 5265 6628 5f5f 4150 495f 436f  ngleRef(__API_Co
+0000bda0: 6e66 4368 616e 6765 5369 6e67 6c65 293a  nfChangeSingle):
+0000bdb0: 0a20 2020 2022 2222 0a20 2020 2052 6566  .    """.    Ref
+0000bdc0: 6572 656e 6365 2074 7970 6520 6f66 203a  erence type of :
+0000bdd0: 636c 6173 733a 6043 6f6e 6643 6861 6e67  class:`ConfChang
+0000bde0: 6553 696e 676c 6560 2e0a 2020 2020 2222  eSingle`..    ""
+0000bdf0: 220a 0a63 6c61 7373 205f 5f41 5049 5f43  "..class __API_C
+0000be00: 6f6e 6643 6861 6e67 6528 5f5f 436c 6f6e  onfChange(__Clon
+0000be10: 6561 626c 652c 205f 5f45 6e63 6f64 6572  eable, __Encoder
+0000be20: 2c20 5f5f 4465 636f 6465 7229 3a0a 2020  , __Decoder):.  
+0000be30: 2020 6465 6620 636c 6f6e 6528 7365 6c66    def clone(self
+0000be40: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
+0000be50: 223a 202e 2e2e 0a20 2020 2064 6566 2067  ": ....    def g
+0000be60: 6574 5f69 6428 7365 6c66 2920 2d3e 2069  et_id(self) -> i
+0000be70: 6e74 3a0a 2020 2020 2020 2020 2222 2220  nt:.        """ 
+0000be80: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+0000be90: 6964 2873 656c 662c 2069 643a 2069 6e74  id(self, id: int
+0000bea0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000beb0: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
+0000bec0: 6566 2063 6c65 6172 5f69 6428 7365 6c66  ef clear_id(self
+0000bed0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000bee0: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
+0000bef0: 6566 2067 6574 5f6e 6f64 655f 6964 2873  ef get_node_id(s
+0000bf00: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+0000bf10: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+0000bf20: 2064 6566 2073 6574 5f6e 6f64 655f 6964   def set_node_id
+0000bf30: 2873 656c 662c 206e 6f64 655f 6964 3a20  (self, node_id: 
+0000bf40: 696e 7429 202d 3e20 4e6f 6e65 3a0a 2020  int) -> None:.  
+0000bf50: 2020 2020 2020 2222 2220 2222 220a 2020        """ """.  
+0000bf60: 2020 6465 6620 636c 6561 725f 6e6f 6465    def clear_node
+0000bf70: 5f69 6428 7365 6c66 2920 2d3e 204e 6f6e  _id(self) -> Non
+0000bf80: 653a 0a20 2020 2020 2020 2022 2222 2022  e:.        """ "
+0000bf90: 2222 0a20 2020 2064 6566 2067 6574 5f63  "".    def get_c
+0000bfa0: 6861 6e67 655f 7479 7065 2873 656c 6629  hange_type(self)
+0000bfb0: 202d 3e20 2243 6f6e 6643 6861 6e67 6554   -> "ConfChangeT
+0000bfc0: 7970 6522 3a0a 2020 2020 2020 2020 2222  ype":.        ""
+0000bfd0: 2220 2222 220a 2020 2020 6465 6620 7365  " """.    def se
+0000bfe0: 745f 6368 616e 6765 5f74 7970 6528 7365  t_change_type(se
+0000bff0: 6c66 2c20 7479 703a 2022 436f 6e66 4368  lf, typ: "ConfCh
+0000c000: 616e 6765 5479 7065 2229 202d 3e20 4e6f  angeType") -> No
+0000c010: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+0000c020: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+0000c030: 725f 6368 616e 6765 5f74 7970 6528 7365  r_change_type(se
+0000c040: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000c050: 2020 2020 2022 2222 2022 2222 0a20 2020       """ """.   
+0000c060: 2064 6566 2067 6574 5f63 6f6e 7465 7874   def get_context
+0000c070: 2873 656c 6629 202d 3e20 6279 7465 733a  (self) -> bytes:
+0000c080: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
+0000c090: 0a20 2020 2064 6566 2073 6574 5f63 6f6e  .    def set_con
+0000c0a0: 7465 7874 2873 656c 662c 2063 6f6e 7465  text(self, conte
+0000c0b0: 7874 3a20 6279 7465 7329 202d 3e20 4e6f  xt: bytes) -> No
+0000c0c0: 6e65 3a0a 2020 2020 2020 2020 2222 2220  ne:.        """ 
+0000c0d0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+0000c0e0: 725f 636f 6e74 6578 7428 7365 6c66 2920  r_context(self) 
+0000c0f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000c100: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+0000c110: 206d 6572 6765 5f66 726f 6d5f 6279 7465   merge_from_byte
+0000c120: 7328 7365 6c66 2c20 623a 2062 7974 6573  s(self, b: bytes
+0000c130: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000c140: 2020 2022 2222 0a20 2020 2020 2020 2055     """.        U
+0000c150: 7064 6174 6520 7468 6973 206d 6573 7361  pdate this messa
+0000c160: 6765 206f 626a 6563 7420 7769 7468 2066  ge object with f
+0000c170: 6965 6c64 7320 7265 6164 2066 726f 6d20  ields read from 
+0000c180: 6769 7665 6e20 7374 7265 616d 2e0a 2020  given stream..  
+0000c190: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0000c1a0: 6620 6173 5f76 3128 7365 6c66 2920 2d3e  f as_v1(self) ->
+0000c1b0: 204f 7074 696f 6e61 6c5b 2243 6f6e 6643   Optional["ConfC
+0000c1c0: 6861 6e67 6552 6566 225d 3a0a 2020 2020  hangeRef"]:.    
+0000c1d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000c1e0: 436f 6e76 6572 7473 2063 6f6e 6620 6368  Converts conf ch
+0000c1f0: 616e 6765 2074 6f20 6043 6f6e 6643 6861  ange to `ConfCha
+0000c200: 6e67 6560 2e0a 0a20 2020 2020 2020 2060  nge`...        `
+0000c210: 436f 6e66 4368 616e 6765 5632 6020 6361  ConfChangeV2` ca
+0000c220: 6e27 7420 6265 2063 6861 6e67 6564 2062  n't be changed b
+0000c230: 6163 6b20 746f 2060 436f 6e66 4368 616e  ack to `ConfChan
+0000c240: 6765 602e 0a20 2020 2020 2020 2022 2222  ge`..        """
+0000c250: 0a20 2020 2064 6566 2061 735f 7632 2873  .    def as_v2(s
+0000c260: 656c 6629 202d 3e20 2243 6f6e 6643 6861  elf) -> "ConfCha
+0000c270: 6e67 6556 3222 3a0a 2020 2020 2020 2020  ngeV2":.        
+0000c280: 2222 220a 2020 2020 2020 2020 4765 7473  """.        Gets
+0000c290: 2063 6f6e 6620 6368 616e 6765 2061 7320   conf change as 
+0000c2a0: 6043 6f6e 6643 6861 6e67 6556 3260 2e0a  `ConfChangeV2`..
+0000c2b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000c2c0: 6465 6620 696e 746f 5f76 3228 7365 6c66  def into_v2(self
+0000c2d0: 2920 2d3e 2022 436f 6e66 4368 616e 6765  ) -> "ConfChange
+0000c2e0: 5632 223a 0a20 2020 2020 2020 2022 2222  V2":.        """
+0000c2f0: 0a20 2020 2020 2020 2043 6f6e 7665 7274  .        Convert
+0000c300: 7320 636f 6e66 2063 6861 6e67 6520 746f  s conf change to
+0000c310: 2060 436f 6e66 4368 616e 6765 5632 602e   `ConfChangeV2`.
+0000c320: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
+0000c330: 6173 7320 436f 6e66 4368 616e 6765 285f  ass ConfChange(_
+0000c340: 5f41 5049 5f43 6f6e 6643 6861 6e67 6529  _API_ConfChange)
+0000c350: 3a0a 2020 2020 2222 2220 2222 220a 0a20  :.    """ """.. 
+0000c360: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0000c370: 7365 6c66 2920 2d3e 204e 6f6e 653a 202e  self) -> None: .
+0000c380: 2e2e 0a20 2020 2064 6566 206d 616b 655f  ...    def make_
+0000c390: 7265 6628 7365 6c66 2920 2d3e 2022 436f  ref(self) -> "Co
+0000c3a0: 6e66 4368 616e 6765 5265 6622 3a20 2e2e  nfChangeRef": ..
+0000c3b0: 2e0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+0000c3c0: 686f 640a 2020 2020 6465 6620 6465 6661  hod.    def defa
+0000c3d0: 756c 7428 2920 2d3e 2022 436f 6e66 4368  ult() -> "ConfCh
+0000c3e0: 616e 6765 223a 202e 2e2e 0a20 2020 2040  ange": ....    @
+0000c3f0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0000c400: 2064 6566 2064 6563 6f64 6528 763a 2062   def decode(v: b
+0000c410: 7974 6573 2920 2d3e 2022 436f 6e66 4368  ytes) -> "ConfCh
+0000c420: 616e 6765 223a 202e 2e2e 0a0a 636c 6173  ange": .....clas
+0000c430: 7320 436f 6e66 4368 616e 6765 5265 6628  s ConfChangeRef(
+0000c440: 5f5f 4150 495f 436f 6e66 4368 616e 6765  __API_ConfChange
+0000c450: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
+0000c460: 6566 6572 656e 6365 2074 7970 6520 6f66  eference type of
+0000c470: 203a 636c 6173 733a 6043 6f6e 6643 6861   :class:`ConfCha
+0000c480: 6e67 6560 2e0a 2020 2020 2222 220a 0a63  nge`..    """..c
+0000c490: 6c61 7373 205f 5f41 5049 5f55 6e73 7461  lass __API_Unsta
+0000c4a0: 626c 653a 0a20 2020 2064 6566 206d 6179  ble:.    def may
+0000c4b0: 6265 5f66 6972 7374 5f69 6e64 6578 2873  be_first_index(s
+0000c4c0: 656c 6629 202d 3e20 4f70 7469 6f6e 616c  elf) -> Optional
+0000c4d0: 5b69 6e74 5d3a 0a20 2020 2020 2020 2022  [int]:.        "
+0000c4e0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+0000c4f0: 6e73 2074 6865 2069 6e64 6578 206f 6620  ns the index of 
+0000c500: 7468 6520 6669 7273 7420 706f 7373 6962  the first possib
+0000c510: 6c65 2065 6e74 7279 2069 6e20 656e 7472  le entry in entr
+0000c520: 6965 730a 2020 2020 2020 2020 6966 2069  ies.        if i
+0000c530: 7420 6861 7320 6120 736e 6170 7368 6f74  t has a snapshot
+0000c540: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000c550: 2020 6465 6620 6d61 7962 655f 6c61 7374    def maybe_last
+0000c560: 5f69 6e64 6578 2873 656c 6629 202d 3e20  _index(self) -> 
+0000c570: 4f70 7469 6f6e 616c 5b69 6e74 5d3a 0a20  Optional[int]:. 
+0000c580: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000c590: 2020 2052 6574 7572 6e73 2074 6865 206c     Returns the l
+0000c5a0: 6173 7420 696e 6465 7820 6966 2069 7420  ast index if it 
+0000c5b0: 6861 7320 6174 206c 6561 7374 206f 6e65  has at least one
+0000c5c0: 2075 6e73 7461 626c 6520 656e 7472 7920   unstable entry 
+0000c5d0: 6f72 2073 6e61 7073 686f 742e 0a20 2020  or snapshot..   
+0000c5e0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+0000c5f0: 206d 6179 6265 5f74 6572 6d28 7365 6c66   maybe_term(self
+0000c600: 2920 2d3e 204f 7074 696f 6e61 6c5b 696e  ) -> Optional[in
+0000c610: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
+0000c620: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+0000c630: 7468 6520 7465 726d 206f 6620 7468 6520  the term of the 
+0000c640: 656e 7472 7920 6174 2069 6e64 6578 2069  entry at index i
+0000c650: 6478 2c20 6966 2074 6865 7265 2069 7320  dx, if there is 
+0000c660: 616e 792e 0a20 2020 2020 2020 2022 2222  any..        """
+0000c670: 0a20 2020 2064 6566 206d 7573 745f 6368  .    def must_ch
+0000c680: 6563 6b5f 6f75 746f 6662 6f75 6e64 7328  eck_outofbounds(
+0000c690: 7365 6c66 2c20 6c6f 3a20 696e 742c 2068  self, lo: int, h
+0000c6a0: 693a 2069 6e74 2920 2d3e 204e 6f6e 653a  i: int) -> None:
+0000c6b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000c6c0: 2020 2020 2041 7373 6572 7473 2074 6865       Asserts the
+0000c6d0: 2060 6869 6020 616e 6420 606c 6f60 2076   `hi` and `lo` v
+0000c6e0: 616c 7565 7320 6167 6169 6e73 7420 6561  alues against ea
+0000c6f0: 6368 206f 7468 6572 2061 6e64 2061 6761  ch other and aga
+0000c700: 696e 7374 2074 6865 0a20 2020 2020 2020  inst the.       
+0000c710: 2065 6e74 7269 6573 2074 6865 6d73 656c   entries themsel
+0000c720: 7665 732e 0a20 2020 2020 2020 2022 2222  ves..        """
+0000c730: 0a20 2020 2064 6566 2073 6c69 6365 2873  .    def slice(s
+0000c740: 656c 662c 206c 6f3a 2069 6e74 2c20 6869  elf, lo: int, hi
+0000c750: 3a20 696e 7429 202d 3e20 4c69 7374 5b22  : int) -> List["
+0000c760: 456e 7472 7952 6566 225d 3a0a 2020 2020  EntryRef"]:.    
+0000c770: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000c780: 5265 7475 726e 7320 6120 736c 6963 6520  Returns a slice 
+0000c790: 6f66 2065 6e74 7269 6573 2062 6574 7765  of entries betwe
+0000c7a0: 656e 2074 6865 2068 6967 6820 616e 6420  en the high and 
+0000c7b0: 6c6f 772e 0a0a 2020 2020 2020 2020 2320  low...        # 
+0000c7c0: 5061 6e69 6373 0a0a 2020 2020 2020 2020  Panics..        
+0000c7d0: 5061 6e69 6373 2069 6620 7468 6520 606c  Panics if the `l
+0000c7e0: 6f60 206f 7220 6068 6960 2061 7265 206f  o` or `hi` are o
+0000c7f0: 7574 206f 6620 626f 756e 6473 2e0a 2020  ut of bounds..  
+0000c800: 2020 2020 2020 5061 6e69 6373 2069 6620        Panics if 
+0000c810: 606c 6f20 3e20 6869 602e 0a20 2020 2020  `lo > hi`..     
+0000c820: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
+0000c830: 7461 626c 655f 736e 6170 2873 656c 662c  table_snap(self,
+0000c840: 2069 6e64 6578 3a20 696e 7429 202d 3e20   index: int) -> 
+0000c850: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000c860: 220a 2020 2020 2020 2020 436c 6561 7273  ".        Clears
+0000c870: 2074 6865 2075 6e73 7461 626c 6520 736e   the unstable sn
+0000c880: 6170 7368 6f74 2e0a 2020 2020 2020 2020  apshot..        
+0000c890: 2222 220a 2020 2020 6465 6620 7374 6162  """.    def stab
+0000c8a0: 6c65 5f65 6e74 7269 6573 2873 656c 662c  le_entries(self,
+0000c8b0: 2069 6e64 6578 3a20 696e 742c 2074 6572   index: int, ter
+0000c8c0: 6d3a 2069 6e74 2920 2d3e 204e 6f6e 653a  m: int) -> None:
+0000c8d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000c8e0: 2020 2020 2043 6c65 6172 7320 7468 6520       Clears the 
+0000c8f0: 756e 7374 6162 6c65 2065 6e74 7269 6573  unstable entries
+0000c900: 2061 6e64 206d 6f76 6573 2074 6865 2073   and moves the s
+0000c910: 7461 626c 6520 6f66 6673 6574 2075 7020  table offset up 
+0000c920: 746f 2074 6865 0a20 2020 2020 2020 206c  to the.        l
+0000c930: 6173 7420 696e 6465 782c 2069 6620 7468  ast index, if th
+0000c940: 6572 6520 6973 2061 6e79 2e0a 2020 2020  ere is any..    
+0000c950: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+0000c960: 7265 7374 6f72 6528 7365 6c66 2c20 736e  restore(self, sn
+0000c970: 6170 3a20 2253 6e61 7073 686f 7452 6566  ap: "SnapshotRef
+0000c980: 2229 202d 3e20 4e6f 6e65 3a0a 2020 2020  ") -> None:.    
+0000c990: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000c9a0: 4672 6f6d 2061 2067 6976 656e 2073 6e61  From a given sna
+0000c9b0: 7073 686f 742c 2072 6573 746f 7265 7320  pshot, restores 
+0000c9c0: 7468 6520 736e 6170 7368 6f74 2074 6f20  the snapshot to 
+0000c9d0: 7365 6c66 2c20 6275 7420 646f 6573 6e27  self, but doesn'
+0000c9e0: 7420 756e 7061 636b 2e0a 2020 2020 2020  t unpack..      
+0000c9f0: 2020 2222 220a 2020 2020 6465 6620 7472    """.    def tr
+0000ca00: 756e 6361 7465 5f61 6e64 5f61 7070 656e  uncate_and_appen
+0000ca10: 6428 7365 6c66 2c20 656e 7473 3a20 4c69  d(self, ents: Li
+0000ca20: 7374 5b22 456e 7472 7922 5d20 7c20 4c69  st["Entry"] | Li
+0000ca30: 7374 5b22 456e 7472 7952 6566 225d 2920  st["EntryRef"]) 
+0000ca40: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000ca50: 2022 2222 0a20 2020 2020 2020 2041 7070   """.        App
+0000ca60: 656e 6420 656e 7472 6965 7320 746f 2075  end entries to u
+0000ca70: 6e73 7461 626c 652c 2074 7275 6e63 6174  nstable, truncat
+0000ca80: 6520 6c6f 6361 6c20 626c 6f63 6b20 6669  e local block fi
+0000ca90: 7273 7420 6966 206f 7665 726c 6170 7065  rst if overlappe
+0000caa0: 642e 0a0a 2020 2020 2020 2020 2320 5061  d...        # Pa
+0000cab0: 6e69 6373 0a0a 2020 2020 2020 2020 5061  nics..        Pa
+0000cac0: 6e69 6373 2069 6620 7472 756e 6361 7465  nics if truncate
+0000cad0: 206c 6f67 7320 746f 2074 6865 2065 6e74   logs to the ent
+0000cae0: 7279 2062 6566 6f72 6520 736e 6170 7368  ry before snapsh
+0000caf0: 6f74 0a20 2020 2020 2020 2022 2222 0a20  ot.        """. 
+0000cb00: 2020 2064 6566 2067 6574 5f65 6e74 7269     def get_entri
+0000cb10: 6573 5f73 697a 6528 7365 6c66 2920 2d3e  es_size(self) ->
+0000cb20: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+0000cb30: 220a 2020 2020 2020 2020 6065 6e74 7269  ".        `entri
+0000cb40: 6573 5f73 697a 6560 3a20 5468 6520 7369  es_size`: The si
+0000cb50: 7a65 206f 6620 656e 7472 6965 730a 2020  ze of entries.  
+0000cb60: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0000cb70: 6620 7365 745f 656e 7472 6965 735f 7369  f set_entries_si
+0000cb80: 7a65 2873 656c 662c 2065 6e74 7269 6573  ze(self, entries
+0000cb90: 5f73 697a 653a 2069 6e74 2920 2d3e 204e  _size: int) -> N
+0000cba0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000cbb0: 0a20 2020 2020 2020 2060 656e 7472 6965  .        `entrie
+0000cbc0: 735f 7369 7a65 603a 2054 6865 2073 697a  s_size`: The siz
+0000cbd0: 6520 6f66 2065 6e74 7269 6573 0a20 2020  e of entries.   
+0000cbe0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+0000cbf0: 2067 6574 5f6f 6666 7365 7428 7365 6c66   get_offset(self
+0000cc00: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+0000cc10: 2020 2222 220a 2020 2020 2020 2020 606f    """.        `o
+0000cc20: 6666 7365 7460 3a20 5468 6520 6f66 6673  ffset`: The offs
+0000cc30: 6574 2066 726f 6d20 7468 6520 7665 6374  et from the vect
+0000cc40: 6f72 2069 6e64 6578 2e0a 2020 2020 2020  or index..      
+0000cc50: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+0000cc60: 745f 6f66 6673 6574 2873 656c 662c 206f  t_offset(self, o
+0000cc70: 6666 7365 743a 2069 6e74 2920 2d3e 204e  ffset: int) -> N
+0000cc80: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000cc90: 0a20 2020 2020 2020 2060 6f66 6673 6574  .        `offset
+0000cca0: 603a 2054 6865 206f 6666 7365 7420 6672  `: The offset fr
+0000ccb0: 6f6d 2074 6865 2076 6563 746f 7220 696e  om the vector in
+0000ccc0: 6465 782e 0a20 2020 2020 2020 2022 2222  dex..        """
+0000ccd0: 0a20 2020 2064 6566 2067 6574 5f65 6e74  .    def get_ent
+0000cce0: 7269 6573 2873 656c 6629 202d 3e20 4c69  ries(self) -> Li
+0000ccf0: 7374 5b22 456e 7472 7952 6566 225d 3a0a  st["EntryRef"]:.
+0000cd00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000cd10: 2020 2020 6065 6e74 7269 6573 603a 2041      `entries`: A
+0000cd20: 6c6c 2065 6e74 7269 6573 2074 6861 7420  ll entries that 
+0000cd30: 6861 7665 206e 6f74 2079 6574 2062 6565  have not yet bee
+0000cd40: 6e20 7772 6974 7465 6e20 746f 2073 746f  n written to sto
+0000cd50: 7261 6765 2e0a 2020 2020 2020 2020 2222  rage..        ""
+0000cd60: 220a 2020 2020 6465 6620 7365 745f 656e  ".    def set_en
+0000cd70: 7472 6965 7328 7365 6c66 2c20 656e 7473  tries(self, ents
+0000cd80: 3a20 4c69 7374 5b22 456e 7472 7922 5d20  : List["Entry"] 
+0000cd90: 7c20 4c69 7374 5b22 456e 7472 7952 6566  | List["EntryRef
+0000cda0: 225d 2920 2d3e 204e 6f6e 653a 0a20 2020  "]) -> None:.   
+0000cdb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000cdc0: 2060 656e 7472 6965 7360 3a20 416c 6c20   `entries`: All 
+0000cdd0: 656e 7472 6965 7320 7468 6174 2068 6176  entries that hav
+0000cde0: 6520 6e6f 7420 7965 7420 6265 656e 2077  e not yet been w
+0000cdf0: 7269 7474 656e 2074 6f20 7374 6f72 6167  ritten to storag
+0000ce00: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+0000ce10: 2020 2064 6566 2067 6574 5f6c 6f67 6765     def get_logge
+0000ce20: 7228 7365 6c66 2920 2d3e 2022 4c6f 6767  r(self) -> "Logg
+0000ce30: 6572 5265 6622 3a0a 2020 2020 2020 2020  erRef":.        
+0000ce40: 2222 220a 2020 2020 2020 2020 606c 6f67  """.        `log
+0000ce50: 6765 7260 3a20 5468 6520 7461 6720 746f  ger`: The tag to
+0000ce60: 2075 7365 2077 6865 6e20 6c6f 6767 696e   use when loggin
+0000ce70: 672e 0a20 2020 2020 2020 2022 2222 0a20  g..        """. 
+0000ce80: 2020 2064 6566 2073 6574 5f6c 6f67 6765     def set_logge
+0000ce90: 7228 7365 6c66 2c20 6c6f 6767 6572 3a20  r(self, logger: 
+0000cea0: 224c 6f67 6765 7222 207c 2022 4c6f 6767  "Logger" | "Logg
+0000ceb0: 6572 5265 6622 2920 2d3e 204e 6f6e 653a  erRef") -> None:
+0000cec0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ced0: 2020 2020 2060 6c6f 6767 6572 603a 2054       `logger`: T
+0000cee0: 6865 2074 6167 2074 6f20 7573 6520 7768  he tag to use wh
+0000cef0: 656e 206c 6f67 6769 6e67 2e0a 2020 2020  en logging..    
+0000cf00: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+0000cf10: 6765 745f 736e 6170 7368 6f74 2873 656c  get_snapshot(sel
+0000cf20: 6629 202d 3e20 4f70 7469 6f6e 616c 5b22  f) -> Optional["
+0000cf30: 536e 6170 7368 6f74 5265 6622 5d3a 0a20  SnapshotRef"]:. 
+0000cf40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000cf50: 2020 2060 736e 6170 7368 6f74 603a 2054     `snapshot`: T
+0000cf60: 6865 2069 6e63 6f6d 696e 6720 756e 7374  he incoming unst
+0000cf70: 6162 6c65 2073 6e61 7073 686f 742c 2069  able snapshot, i
+0000cf80: 6620 616e 792e 0a20 2020 2020 2020 2022  f any..        "
+0000cf90: 2222 0a20 2020 2064 6566 2073 6574 5f73  "".    def set_s
+0000cfa0: 6e61 7073 686f 7428 7365 6c66 2c20 736e  napshot(self, sn
+0000cfb0: 6170 7368 6f74 3a20 2253 6e61 7073 686f  apshot: "Snapsho
+0000cfc0: 7422 207c 2022 536e 6170 7368 6f74 5265  t" | "SnapshotRe
+0000cfd0: 6622 2920 2d3e 204e 6f6e 653a 0a20 2020  f") -> None:.   
+0000cfe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000cff0: 2060 736e 6170 7368 6f74 603a 2054 6865   `snapshot`: The
+0000d000: 2069 6e63 6f6d 696e 6720 756e 7374 6162   incoming unstab
+0000d010: 6c65 2073 6e61 7073 686f 742c 2069 6620  le snapshot, if 
+0000d020: 616e 792e 0a20 2020 2020 2020 2022 2222  any..        """
+0000d030: 0a0a 636c 6173 7320 556e 7374 6162 6c65  ..class Unstable
+0000d040: 285f 5f41 5049 5f55 6e73 7461 626c 6529  (__API_Unstable)
+0000d050: 3a0a 2020 2020 2222 220a 2020 2020 5468  :.    """.    Th
+0000d060: 6520 6075 6e73 7461 626c 652e 656e 7472  e `unstable.entr
+0000d070: 6965 735b 695d 6020 6861 7320 7261 6674  ies[i]` has raft
+0000d080: 206c 6f67 2070 6f73 6974 696f 6e20 6069   log position `i
+0000d090: 2b75 6e73 7461 626c 652e 6f66 6673 6574  +unstable.offset
+0000d0a0: 602e 0a20 2020 204e 6f74 6520 7468 6174  `..    Note that
+0000d0b0: 2060 756e 7374 6162 6c65 2e6f 6666 7365   `unstable.offse
+0000d0c0: 7460 206d 6179 2062 6520 6c65 7373 2074  t` may be less t
+0000d0d0: 6861 6e20 7468 6520 6869 6768 6573 7420  han the highest 
+0000d0e0: 6c6f 670a 2020 2020 706f 7369 7469 6f6e  log.    position
+0000d0f0: 2069 6e20 7374 6f72 6167 653b 2074 6869   in storage; thi
+0000d100: 7320 6d65 616e 7320 7468 6174 2074 6865  s means that the
+0000d110: 206e 6578 7420 7772 6974 6520 746f 2073   next write to s
+0000d120: 746f 7261 6765 0a20 2020 206d 6967 6874  torage.    might
+0000d130: 206e 6565 6420 746f 2074 7275 6e63 6174   need to truncat
+0000d140: 6520 7468 6520 6c6f 6720 6265 666f 7265  e the log before
+0000d150: 2070 6572 7369 7374 696e 6720 756e 7374   persisting unst
+0000d160: 6162 6c65 2e65 6e74 7269 6573 2e0a 2020  able.entries..  
+0000d170: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0000d180: 5f69 6e69 745f 5f28 7365 6c66 2c20 6f66  _init__(self, of
+0000d190: 6673 6574 3a20 696e 742c 206c 6f67 6765  fset: int, logge
+0000d1a0: 723a 2022 4c6f 6767 6572 2220 7c20 224c  r: "Logger" | "L
+0000d1b0: 6f67 6765 7252 6566 2229 202d 3e20 4e6f  oggerRef") -> No
+0000d1c0: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
+0000d1d0: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+0000d1e0: 3e20 2255 6e73 7461 626c 6552 6566 223a  > "UnstableRef":
+0000d1f0: 202e 2e2e 0a0a 636c 6173 7320 556e 7374   .....class Unst
+0000d200: 6162 6c65 5265 6628 5f5f 4150 495f 556e  ableRef(__API_Un
+0000d210: 7374 6162 6c65 293a 0a20 2020 2022 2222  stable):.    """
+0000d220: 0a20 2020 2052 6566 6572 656e 6365 2074  .    Reference t
+0000d230: 7970 6520 6f66 203a 636c 6173 733a 6055  ype of :class:`U
+0000d240: 6e73 7461 626c 6560 2e0a 2020 2020 2222  nstable`..    ""
+0000d250: 220a 0a63 6c61 7373 205f 5f41 5049 5f53  "..class __API_S
+0000d260: 6f66 7453 7461 7465 3a0a 2020 2020 6465  oftState:.    de
+0000d270: 6620 6765 745f 6c65 6164 6572 5f69 6428  f get_leader_id(
+0000d280: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
+0000d290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000d2a0: 2020 606c 6561 6465 725f 6964 603a 2054    `leader_id`: T
+0000d2b0: 6865 2070 6f74 656e 7469 616c 206c 6561  he potential lea
+0000d2c0: 6465 7220 6f66 2074 6865 2063 6c75 7374  der of the clust
+0000d2d0: 6572 2e0a 2020 2020 2020 2020 2222 220a  er..        """.
+0000d2e0: 2020 2020 6465 6620 7365 745f 6c65 6164      def set_lead
+0000d2f0: 6572 5f69 6428 7365 6c66 2c20 6c65 6164  er_id(self, lead
+0000d300: 6572 5f69 643a 2069 6e74 2920 2d3e 204e  er_id: int) -> N
+0000d310: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000d320: 0a20 2020 2020 2020 2060 6c65 6164 6572  .        `leader
+0000d330: 5f69 6460 3a20 5468 6520 706f 7465 6e74  _id`: The potent
+0000d340: 6961 6c20 6c65 6164 6572 206f 6620 7468  ial leader of th
+0000d350: 6520 636c 7573 7465 722e 0a20 2020 2020  e cluster..     
+0000d360: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
+0000d370: 6574 5f72 6166 745f 7374 6174 6528 7365  et_raft_state(se
+0000d380: 6c66 2920 2d3e 2022 5374 6174 6552 6f6c  lf) -> "StateRol
+0000d390: 6522 3a0a 2020 2020 2020 2020 2222 220a  e":.        """.
+0000d3a0: 2020 2020 2020 2020 6072 6166 745f 7374          `raft_st
+0000d3b0: 6174 6560 3a20 5468 6520 736f 6674 2072  ate`: The soft r
+0000d3c0: 6f6c 6520 7468 6973 206e 6f64 6520 6d61  ole this node ma
+0000d3d0: 7920 7461 6b65 2e0a 2020 2020 2020 2020  y take..        
+0000d3e0: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+0000d3f0: 7261 6674 5f73 7461 7465 2873 656c 662c  raft_state(self,
+0000d400: 2072 6f6c 653a 2022 5374 6174 6552 6f6c   role: "StateRol
+0000d410: 6522 2920 2d3e 204e 6f6e 653a 0a20 2020  e") -> None:.   
+0000d420: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000d430: 2060 7261 6674 5f73 7461 7465 603a 2054   `raft_state`: T
+0000d440: 6865 2073 6f66 7420 726f 6c65 2074 6869  he soft role thi
+0000d450: 7320 6e6f 6465 206d 6179 2074 616b 652e  s node may take.
+0000d460: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
+0000d470: 6173 7320 536f 6674 5374 6174 6528 5f5f  ass SoftState(__
+0000d480: 4150 495f 536f 6674 5374 6174 6529 3a0a  API_SoftState):.
+0000d490: 2020 2020 2222 220a 2020 2020 536f 6674      """.    Soft
+0000d4a0: 5374 6174 6520 7072 6f76 6964 6573 2073  State provides s
+0000d4b0: 7461 7465 2074 6861 7420 6973 2075 7365  tate that is use
+0000d4c0: 6675 6c20 666f 7220 6c6f 6767 696e 6720  ful for logging 
+0000d4d0: 616e 6420 6465 6275 6767 696e 672e 0a20  and debugging.. 
+0000d4e0: 2020 2054 6865 2073 7461 7465 2069 7320     The state is 
+0000d4f0: 766f 6c61 7469 6c65 2061 6e64 2064 6f65  volatile and doe
+0000d500: 7320 6e6f 7420 6e65 6564 2074 6f20 6265  s not need to be
+0000d510: 2070 6572 7369 7374 6564 2074 6f20 7468   persisted to th
+0000d520: 6520 5741 4c2e 0a20 2020 2022 2222 0a0a  e WAL..    """..
+0000d530: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
+0000d540: 2873 656c 6629 202d 3e20 2253 6f66 7453  (self) -> "SoftS
+0000d550: 7461 7465 5265 6622 3a20 2e2e 2e0a 2020  tateRef": ....  
+0000d560: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+0000d570: 2020 2020 6465 6620 6465 6661 756c 7428      def default(
+0000d580: 2920 2d3e 2022 536f 6674 5374 6174 6522  ) -> "SoftState"
+0000d590: 3a20 2e2e 2e0a 0a63 6c61 7373 2053 6f66  : .....class Sof
+0000d5a0: 7453 7461 7465 5265 6628 5f5f 4150 495f  tStateRef(__API_
+0000d5b0: 536f 6674 5374 6174 6529 3a0a 2020 2020  SoftState):.    
+0000d5c0: 2222 220a 2020 2020 5265 6665 7265 6e63  """.    Referenc
+0000d5d0: 6520 7479 7065 206f 6620 3a63 6c61 7373  e type of :class
+0000d5e0: 3a60 536f 6674 5374 6174 6560 2e0a 2020  :`SoftState`..  
+0000d5f0: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
+0000d600: 5049 5f52 6561 6453 7461 7465 285f 5f43  PI_ReadState(__C
+0000d610: 6c6f 6e65 6162 6c65 293a 0a20 2020 2064  loneable):.    d
+0000d620: 6566 2063 6c6f 6e65 2873 656c 6629 202d  ef clone(self) -
+0000d630: 3e20 2252 6561 6453 7461 7465 223a 202e  > "ReadState": .
+0000d640: 2e2e 0a20 2020 2064 6566 2067 6574 5f69  ...    def get_i
+0000d650: 6e64 6578 2873 656c 6629 202d 3e20 696e  ndex(self) -> in
+0000d660: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+0000d670: 2020 2020 2020 2060 696e 6465 7860 3a20         `index`: 
+0000d680: 5468 6520 696e 6465 7820 6f66 2074 6865  The index of the
+0000d690: 2072 6561 6420 7374 6174 652e 0a20 2020   read state..   
+0000d6a0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+0000d6b0: 2073 6574 5f69 6e64 6578 2873 656c 662c   set_index(self,
+0000d6c0: 2069 6478 3a20 696e 7429 202d 3e20 4e6f   idx: int) -> No
+0000d6d0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+0000d6e0: 2020 2020 2020 2020 6069 6e64 6578 603a          `index`:
+0000d6f0: 2054 6865 2069 6e64 6578 206f 6620 7468   The index of th
+0000d700: 6520 7265 6164 2073 7461 7465 2e0a 2020  e read state..  
+0000d710: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0000d720: 6620 6765 745f 7265 7175 6573 745f 6374  f get_request_ct
+0000d730: 7828 7365 6c66 2920 2d3e 2062 7974 6573  x(self) -> bytes
+0000d740: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000d750: 2020 2020 2020 6072 6571 7565 7374 5f63        `request_c
+0000d760: 7478 603a 2041 2064 6174 6167 7261 6d20  tx`: A datagram 
+0000d770: 636f 6e73 6973 7469 6e67 206f 6620 636f  consisting of co
+0000d780: 6e74 6578 7420 6162 6f75 7420 7468 6520  ntext about the 
+0000d790: 7265 7175 6573 742e 0a20 2020 2020 2020  request..       
 0000d7a0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-0000d7b0: 5f69 6e64 6578 2873 656c 662c 2069 6478  _index(self, idx
-0000d7c0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-0000d7d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000d7e0: 2020 2020 6069 6e64 6578 603a 2054 6865      `index`: The
-0000d7f0: 2069 6e64 6578 206f 6620 7468 6520 7265   index of the re
-0000d800: 6164 2073 7461 7465 2e0a 2020 2020 2020  ad state..      
-0000d810: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
-0000d820: 745f 7265 7175 6573 745f 6374 7828 7365  t_request_ctx(se
-0000d830: 6c66 2920 2d3e 2062 7974 6573 3a0a 2020  lf) -> bytes:.  
-0000d840: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000d850: 2020 6072 6571 7565 7374 5f63 7478 603a    `request_ctx`:
-0000d860: 2041 2064 6174 6167 7261 6d20 636f 6e73   A datagram cons
-0000d870: 6973 7469 6e67 206f 6620 636f 6e74 6578  isting of contex
-0000d880: 7420 6162 6f75 7420 7468 6520 7265 7175  t about the requ
-0000d890: 6573 742e 0a20 2020 2020 2020 2022 2222  est..        """
-0000d8a0: 0a20 2020 2064 6566 2073 6574 5f72 6571  .    def set_req
-0000d8b0: 7565 7374 5f63 7478 2873 656c 662c 2072  uest_ctx(self, r
-0000d8c0: 6571 7565 7374 5f63 7478 3a20 6279 7465  equest_ctx: byte
-0000d8d0: 7320 7c20 4c69 7374 5b69 6e74 5d29 202d  s | List[int]) -
-0000d8e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000d8f0: 2222 220a 2020 2020 2020 2020 6072 6571  """.        `req
-0000d900: 7565 7374 5f63 7478 603a 2041 2064 6174  uest_ctx`: A dat
-0000d910: 6167 7261 6d20 636f 6e73 6973 7469 6e67  agram consisting
-0000d920: 206f 6620 636f 6e74 6578 7420 6162 6f75   of context abou
-0000d930: 7420 7468 6520 7265 7175 6573 742e 0a20  t the request.. 
-0000d940: 2020 2020 2020 2022 2222 0a0a 636c 6173         """..clas
-0000d950: 7320 5265 6164 5374 6174 6528 5f5f 4150  s ReadState(__AP
-0000d960: 495f 5265 6164 5374 6174 6529 3a0a 2020  I_ReadState):.  
-0000d970: 2020 2222 220a 2020 2020 5265 6164 5374    """.    ReadSt
-0000d980: 6174 6520 7072 6f76 6964 6573 2073 7461  ate provides sta
-0000d990: 7465 2066 6f72 2072 6561 6420 6f6e 6c79  te for read only
-0000d9a0: 2071 7565 7279 2e0a 2020 2020 4974 2773   query..    It's
-0000d9b0: 2063 616c 6c65 7227 7320 7265 7370 6f6e   caller's respon
-0000d9c0: 7369 6269 6c69 7479 2074 6f20 7365 6e64  sibility to send
-0000d9d0: 204d 7367 5265 6164 496e 6465 7820 6669   MsgReadIndex fi
-0000d9e0: 7273 7420 6265 666f 7265 2067 6574 7469  rst before getti
-0000d9f0: 6e67 0a20 2020 2074 6869 7320 7374 6174  ng.    this stat
-0000da00: 6520 6672 6f6d 2072 6561 6479 2e20 4974  e from ready. It
-0000da10: 2773 2061 6c73 6f20 6361 6c6c 6572 2773  's also caller's
-0000da20: 2064 7574 7920 746f 2064 6966 6665 7265   duty to differe
-0000da30: 6e74 6961 7465 2069 6620 7468 6973 0a20  ntiate if this. 
-0000da40: 2020 2073 7461 7465 2069 7320 7768 6174     state is what
-0000da50: 2069 7420 7265 7175 6573 7473 2074 6872   it requests thr
-0000da60: 6f75 6768 2072 6571 7565 7374 5f63 7478  ough request_ctx
-0000da70: 2c20 652e 672e 2067 6976 656e 2061 2075  , e.g. given a u
-0000da80: 6e69 7175 6520 6964 2061 730a 2020 2020  nique id as.    
-0000da90: 7265 7175 6573 745f 6374 782e 0a20 2020  request_ctx..   
-0000daa0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-0000dab0: 696e 6974 5f5f 2873 656c 6629 202d 3e20  init__(self) -> 
-0000dac0: 4e6f 6e65 3a20 2e2e 2e0a 2020 2020 6465  None: ....    de
-0000dad0: 6620 6d61 6b65 5f72 6566 2873 656c 6629  f make_ref(self)
-0000dae0: 202d 3e20 2252 6561 6453 7461 7465 5265   -> "ReadStateRe
-0000daf0: 6622 3a20 2e2e 2e0a 0a63 6c61 7373 2052  f": .....class R
-0000db00: 6561 6453 7461 7465 5265 6628 5f5f 4150  eadStateRef(__AP
-0000db10: 495f 5265 6164 5374 6174 6529 3a0a 2020  I_ReadState):.  
-0000db20: 2020 2222 220a 2020 2020 5265 6665 7265    """.    Refere
-0000db30: 6e63 6520 7479 7065 206f 6620 3a63 6c61  nce type of :cla
-0000db40: 7373 3a60 5265 6164 5374 6174 6560 2e0a  ss:`ReadState`..
-0000db50: 2020 2020 2222 220a 0a63 6c61 7373 205f      """..class _
-0000db60: 5f41 5049 5f52 6166 744c 6f67 3a0a 2020  _API_RaftLog:.  
-0000db70: 2020 6465 6620 656e 7472 6965 7328 0a20    def entries(. 
-0000db80: 2020 2020 2020 2073 656c 662c 2069 6478         self, idx
-0000db90: 3a20 696e 742c 2063 6f6e 7465 7874 3a20  : int, context: 
-0000dba0: 2247 6574 456e 7472 6965 7343 6f6e 7465  "GetEntriesConte
-0000dbb0: 7874 5265 6622 2c20 6d61 785f 7369 7a65  xtRef", max_size
-0000dbc0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d0a  : Optional[int].
-0000dbd0: 2020 2020 2920 2d3e 204c 6973 745b 2245      ) -> List["E
-0000dbe0: 6e74 7279 225d 3a0a 2020 2020 2020 2020  ntry"]:.        
-0000dbf0: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0000dc00: 726e 7320 656e 7472 6965 7320 7374 6172  rns entries star
-0000dc10: 7469 6e67 2066 726f 6d20 6120 7061 7274  ting from a part
-0000dc20: 6963 756c 6172 2069 6e64 6578 2061 6e64  icular index and
-0000dc30: 206e 6f74 2065 7863 6565 6469 6e67 2061   not exceeding a
-0000dc40: 2062 7974 6573 697a 652e 0a20 2020 2020   bytesize..     
-0000dc50: 2020 2022 2222 0a20 2020 2064 6566 2061     """.    def a
-0000dc60: 6c6c 5f65 6e74 7269 6573 2873 656c 6629  ll_entries(self)
-0000dc70: 202d 3e20 4c69 7374 5b22 456e 7472 7922   -> List["Entry"
-0000dc80: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-0000dc90: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
-0000dca0: 6c6c 2074 6865 2065 6e74 7269 6573 2e20  ll the entries. 
-0000dcb0: 4f6e 6c79 2075 7365 6420 6279 2074 6573  Only used by tes
-0000dcc0: 7473 2e0a 2020 2020 2020 2020 2222 220a  ts..        """.
-0000dcd0: 2020 2020 6465 6620 6170 7065 6e64 2873      def append(s
-0000dce0: 656c 662c 2065 6e74 733a 204c 6973 745b  elf, ents: List[
-0000dcf0: 2245 6e74 7279 225d 207c 204c 6973 745b  "Entry"] | List[
-0000dd00: 2245 6e74 7279 5265 6622 5d29 202d 3e20  "EntryRef"]) -> 
-0000dd10: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-0000dd20: 0a20 2020 2020 2020 2041 7070 656e 6473  .        Appends
-0000dd30: 2061 2073 6574 206f 6620 656e 7472 6965   a set of entrie
-0000dd40: 7320 746f 2074 6865 2075 6e73 7461 626c  s to the unstabl
-0000dd50: 6520 6c69 7374 2e0a 2020 2020 2020 2020  e list..        
-0000dd60: 2222 220a 2020 2020 6465 6620 6170 706c  """.    def appl
-0000dd70: 6965 6428 7365 6c66 2920 2d3e 2069 6e74  ied(self) -> int
-0000dd80: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000dd90: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
-0000dda0: 6520 6c61 7374 2061 7070 6c69 6564 2069  e last applied i
-0000ddb0: 6e64 6578 2e0a 2020 2020 2020 2020 2222  ndex..        ""
-0000ddc0: 220a 2020 2020 6465 6620 6669 6e64 5f63  ".    def find_c
-0000ddd0: 6f6e 666c 6963 7428 7365 6c66 2c20 656e  onflict(self, en
-0000dde0: 7473 3a20 4c69 7374 5b22 456e 7472 7922  ts: List["Entry"
-0000ddf0: 5d20 7c20 4c69 7374 5b22 456e 7472 7952  ] | List["EntryR
-0000de00: 6566 225d 2920 2d3e 2069 6e74 3a0a 2020  ef"]) -> int:.  
-0000de10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000de20: 2020 4669 6e64 7320 7468 6520 696e 6465    Finds the inde
-0000de30: 7820 6f66 2074 6865 2063 6f6e 666c 6963  x of the conflic
-0000de40: 742e 0a0a 2020 2020 2020 2020 4974 2072  t...        It r
-0000de50: 6574 7572 6e73 2074 6865 2066 6972 7374  eturns the first
-0000de60: 2069 6e64 6578 206f 6620 636f 6e66 6c69   index of confli
-0000de70: 6374 696e 6720 656e 7472 6965 7320 6265  cting entries be
-0000de80: 7477 6565 6e20 7468 6520 6578 6973 7469  tween the existi
-0000de90: 6e67 0a20 2020 2020 2020 2065 6e74 7269  ng.        entri
-0000dea0: 6573 2061 6e64 2074 6865 2067 6976 656e  es and the given
-0000deb0: 2065 6e74 7269 6573 2c20 6966 2074 6865   entries, if the
-0000dec0: 7265 2061 7265 2061 6e79 2e0a 0a20 2020  re are any...   
-0000ded0: 2020 2020 2049 6620 7468 6572 6520 6172       If there ar
-0000dee0: 6520 6e6f 2063 6f6e 666c 6963 7469 6e67  e no conflicting
-0000def0: 2065 6e74 7269 6573 2c20 616e 6420 7468   entries, and th
-0000df00: 6520 6578 6973 7469 6e67 2065 6e74 7269  e existing entri
-0000df10: 6573 2063 6f6e 7461 696e 0a20 2020 2020  es contain.     
-0000df20: 2020 2061 6c6c 2074 6865 2067 6976 656e     all the given
-0000df30: 2065 6e74 7269 6573 2c20 7a65 726f 2077   entries, zero w
-0000df40: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
-0000df50: 0a0a 2020 2020 2020 2020 4966 2074 6865  ..        If the
-0000df60: 7265 2061 7265 206e 6f20 636f 6e66 6c69  re are no confli
-0000df70: 6374 696e 6720 656e 7472 6965 732c 2062  cting entries, b
-0000df80: 7574 2074 6865 2067 6976 656e 2065 6e74  ut the given ent
-0000df90: 7269 6573 2063 6f6e 7461 696e 7320 6e65  ries contains ne
-0000dfa0: 770a 2020 2020 2020 2020 656e 7472 6965  w.        entrie
-0000dfb0: 732c 2074 6865 2069 6e64 6578 206f 6620  s, the index of 
-0000dfc0: 7468 6520 6669 7273 7420 6e65 7720 656e  the first new en
-0000dfd0: 7472 7920 7769 6c6c 2062 6520 7265 7475  try will be retu
-0000dfe0: 726e 6564 2e0a 0a20 2020 2020 2020 2041  rned...        A
-0000dff0: 6e20 656e 7472 7920 6973 2063 6f6e 7369  n entry is consi
-0000e000: 6465 7265 6420 746f 2062 6520 636f 6e66  dered to be conf
-0000e010: 6c69 6374 696e 6720 6966 2069 7420 6861  licting if it ha
-0000e020: 7320 7468 6520 7361 6d65 2069 6e64 6578  s the same index
-0000e030: 2062 7574 0a20 2020 2020 2020 2061 2064   but.        a d
-0000e040: 6966 6665 7265 6e74 2074 6572 6d2e 0a0a  ifferent term...
-0000e050: 2020 2020 2020 2020 5468 6520 6669 7273          The firs
-0000e060: 7420 656e 7472 7920 4d55 5354 2068 6176  t entry MUST hav
-0000e070: 6520 616e 2069 6e64 6578 2065 7175 616c  e an index equal
-0000e080: 2074 6f20 7468 6520 6172 6775 6d65 6e74   to the argument
-0000e090: 2027 6672 6f6d 272e 0a20 2020 2020 2020   'from'..       
-0000e0a0: 2054 6865 2069 6e64 6578 206f 6620 7468   The index of th
-0000e0b0: 6520 6769 7665 6e20 656e 7472 6965 7320  e given entries 
-0000e0c0: 4d55 5354 2062 6520 636f 6e74 696e 756f  MUST be continuo
-0000e0d0: 7573 6c79 2069 6e63 7265 6173 696e 672e  usly increasing.
-0000e0e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e0f0: 2064 6566 2066 696e 645f 636f 6e66 6c69   def find_confli
-0000e100: 6374 5f62 795f 7465 726d 2873 656c 662c  ct_by_term(self,
-0000e110: 2069 6e64 6578 3a20 696e 742c 2074 6572   index: int, ter
-0000e120: 6d3a 2069 6e74 2920 2d3e 2054 7570 6c65  m: int) -> Tuple
-0000e130: 5b69 6e74 2c20 4f70 7469 6f6e 616c 5b69  [int, Optional[i
-0000e140: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
-0000e150: 220a 2020 2020 2020 2020 6669 6e64 5f63  ".        find_c
-0000e160: 6f6e 666c 6963 745f 6279 5f74 6572 6d20  onflict_by_term 
-0000e170: 7461 6b65 7320 616e 2028 6069 6e64 6578  takes an (`index
-0000e180: 602c 2060 7465 726d 6029 2070 6169 7220  `, `term`) pair 
-0000e190: 2869 6e64 6963 6174 696e 6720 6120 636f  (indicating a co
-0000e1a0: 6e66 6c69 6374 696e 6720 6c6f 670a 2020  nflicting log.  
-0000e1b0: 2020 2020 2020 656e 7472 7920 6f6e 2061        entry on a
-0000e1c0: 206c 6561 6465 722f 666f 6c6c 6f77 6572   leader/follower
-0000e1d0: 2064 7572 696e 6720 616e 2061 7070 656e   during an appen
-0000e1e0: 6429 2061 6e64 2066 696e 6473 2074 6865  d) and finds the
-0000e1f0: 206c 6172 6765 7374 2069 6e64 6578 2069   largest index i
-0000e200: 6e0a 2020 2020 2020 2020 6c6f 6720 7769  n.        log wi
-0000e210: 7468 206c 6f67 2e74 6572 6d20 3c3d 2060  th log.term <= `
-0000e220: 7465 726d 6020 616e 6420 6c6f 672e 696e  term` and log.in
-0000e230: 6465 7820 3c3d 2060 696e 6465 7860 2e20  dex <= `index`. 
-0000e240: 4966 206e 6f20 7375 6368 2069 6e64 6578  If no such index
-0000e250: 2065 7869 7374 730a 2020 2020 2020 2020   exists.        
-0000e260: 696e 2074 6865 206c 6f67 2c20 7468 6520  in the log, the 
-0000e270: 6c6f 6727 7320 6669 7273 7420 696e 6465  log's first inde
-0000e280: 7820 6973 2072 6574 7572 6e65 642e 0a0a  x is returned...
-0000e290: 2020 2020 2020 2020 5468 6520 696e 6465          The inde
-0000e2a0: 7820 7072 6f76 6964 6564 204d 5553 5420  x provided MUST 
-0000e2b0: 6265 2065 7175 616c 2074 6f20 6f72 206c  be equal to or l
-0000e2c0: 6573 7320 7468 616e 2073 656c 662e 6c61  ess than self.la
-0000e2d0: 7374 5f69 6e64 6578 2829 2e20 496e 7661  st_index(). Inva
-0000e2e0: 6c69 640a 2020 2020 2020 2020 696e 7075  lid.        inpu
-0000e2f0: 7473 206c 6f67 2061 2077 6172 6e69 6e67  ts log a warning
-0000e300: 2061 6e64 2074 6865 2069 6e70 7574 2069   and the input i
-0000e310: 6e64 6578 2069 7320 7265 7475 726e 6564  ndex is returned
-0000e320: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000e330: 6e20 2869 6e64 6578 2c20 7465 726d 290a  n (index, term).
-0000e340: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000e350: 6465 6620 636f 6d6d 6974 5f74 6f28 7365  def commit_to(se
-0000e360: 6c66 2c20 746f 5f63 6f6d 6d69 743a 2069  lf, to_commit: i
-0000e370: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-0000e380: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e390: 2053 6574 7320 7468 6520 6c61 7374 2063   Sets the last c
-0000e3a0: 6f6d 6d69 7474 6564 2076 616c 7565 2074  ommitted value t
-0000e3b0: 6f20 7468 6520 7061 7373 6564 2069 6e20  o the passed in 
-0000e3c0: 7661 6c75 652e 0a0a 2020 2020 2020 2020  value...        
-0000e3d0: 2320 5061 6e69 6373 0a0a 2020 2020 2020  # Panics..      
-0000e3e0: 2020 5061 6e69 6373 2069 6620 7468 6520    Panics if the 
-0000e3f0: 696e 6465 7820 676f 6573 2070 6173 7420  index goes past 
-0000e400: 7468 6520 6c61 7374 2069 6e64 6578 2e0a  the last index..
-0000e410: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000e420: 6465 6620 636f 6d6d 6974 5f69 6e66 6f28  def commit_info(
-0000e430: 7365 6c66 2920 2d3e 2054 7570 6c65 5b69  self) -> Tuple[i
-0000e440: 6e74 2c20 696e 745d 3a0a 2020 2020 2020  nt, int]:.      
-0000e450: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0000e460: 7475 726e 7320 7468 6520 636f 6d6d 6974  turns the commit
-0000e470: 7465 6420 696e 6465 7820 616e 6420 6974  ted index and it
-0000e480: 7320 7465 726d 2e0a 2020 2020 2020 2020  s term..        
-0000e490: 2222 220a 2020 2020 6465 6620 7374 6f72  """.    def stor
-0000e4a0: 6528 7365 6c66 2920 2d3e 2022 4d65 6d53  e(self) -> "MemS
-0000e4b0: 746f 7261 6765 5265 6622 3a0a 2020 2020  torageRef":.    
-0000e4c0: 2020 2020 2222 2220 2222 220a 2020 2020      """ """.    
-0000e4d0: 6465 6620 6e65 7874 5f65 6e74 7269 6573  def next_entries
-0000e4e0: 2873 656c 662c 206d 6178 5f73 697a 653a  (self, max_size:
-0000e4f0: 204f 7074 696f 6e61 6c5b 696e 745d 2920   Optional[int]) 
-0000e500: 2d3e 204f 7074 696f 6e61 6c5b 4c69 7374  -> Optional[List
-0000e510: 5b22 456e 7472 7922 5d5d 3a0a 2020 2020  ["Entry"]]:.    
-0000e520: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e530: 5265 7475 726e 7320 616c 6c20 7468 6520  Returns all the 
-0000e540: 6176 6169 6c61 626c 6520 656e 7472 6965  available entrie
-0000e550: 7320 666f 7220 6578 6563 7574 696f 6e2e  s for execution.
-0000e560: 0a20 2020 2020 2020 2049 6620 6170 706c  .        If appl
-0000e570: 6965 6420 6973 2073 6d61 6c6c 6572 2074  ied is smaller t
-0000e580: 6861 6e20 7468 6520 696e 6465 7820 6f66  han the index of
-0000e590: 2073 6e61 7073 686f 742c 2069 7420 7265   snapshot, it re
-0000e5a0: 7475 726e 7320 616c 6c20 636f 6d6d 6974  turns all commit
-0000e5b0: 7465 640a 2020 2020 2020 2020 656e 7472  ted.        entr
-0000e5c0: 6965 7320 6166 7465 7220 7468 6520 696e  ies after the in
-0000e5d0: 6465 7820 6f66 2073 6e61 7073 686f 742e  dex of snapshot.
-0000e5e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e5f0: 2064 6566 206e 6578 745f 656e 7472 6965   def next_entrie
-0000e600: 735f 7369 6e63 6528 0a20 2020 2020 2020  s_since(.       
-0000e610: 2073 656c 662c 2073 696e 6365 5f69 6478   self, since_idx
-0000e620: 3a20 696e 742c 206d 6178 5f73 697a 653a  : int, max_size:
-0000e630: 204f 7074 696f 6e61 6c5b 696e 745d 0a20   Optional[int]. 
-0000e640: 2020 2029 202d 3e20 4f70 7469 6f6e 616c     ) -> Optional
-0000e650: 5b4c 6973 745b 2245 6e74 7279 225d 5d3a  [List["Entry"]]:
-0000e660: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e670: 2020 2020 2052 6574 7572 6e73 2063 6f6d       Returns com
-0000e680: 6d69 7474 6564 2061 6e64 2070 6572 7369  mitted and persi
-0000e690: 7374 6564 2065 6e74 7269 6573 2073 696e  sted entries sin
-0000e6a0: 6365 206d 6178 2860 7369 6e63 655f 6964  ce max(`since_id
-0000e6b0: 7860 202b 2031 2c20 6669 7273 745f 696e  x` + 1, first_in
-0000e6c0: 6465 7829 2e0a 2020 2020 2020 2020 2222  dex)..        ""
-0000e6d0: 220a 2020 2020 6465 6620 6861 735f 6e65  ".    def has_ne
-0000e6e0: 7874 5f65 6e74 7269 6573 2873 656c 6629  xt_entries(self)
-0000e6f0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-0000e700: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0000e710: 7475 726e 7320 7768 6574 6865 7220 7468  turns whether th
-0000e720: 6572 6520 6172 6520 6e65 7720 656e 7472  ere are new entr
-0000e730: 6965 732e 0a20 2020 2020 2020 2022 2222  ies..        """
-0000e740: 0a20 2020 2064 6566 2068 6173 5f6e 6578  .    def has_nex
-0000e750: 745f 656e 7472 6965 735f 7369 6e63 6528  t_entries_since(
-0000e760: 7365 6c66 2c20 7369 6e63 655f 6964 783a  self, since_idx:
-0000e770: 2069 6e74 2920 2d3e 2062 6f6f 6c3a 0a20   int) -> bool:. 
-0000e780: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000e790: 2020 2052 6574 7572 6e73 2077 6865 7468     Returns wheth
-0000e7a0: 6572 2074 6865 7265 2061 7265 2063 6f6d  er there are com
-0000e7b0: 6d69 7474 6564 2061 6e64 2070 6572 7369  mitted and persi
-0000e7c0: 7374 6564 2065 6e74 7269 6573 2073 696e  sted entries sin
-0000e7d0: 6365 0a20 2020 2020 2020 206d 6178 2860  ce.        max(`
-0000e7e0: 7369 6e63 655f 6964 7860 202b 2031 2c20  since_idx` + 1, 
-0000e7f0: 6669 7273 745f 696e 6465 7829 2e0a 2020  first_index)..  
-0000e800: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-0000e810: 6620 6973 5f75 705f 746f 5f64 6174 6528  f is_up_to_date(
-0000e820: 7365 6c66 2c20 6c61 7374 5f69 6e64 6578  self, last_index
-0000e830: 3a20 696e 742c 2074 6572 6d3a 2069 6e74  : int, term: int
-0000e840: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0000e850: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
-0000e860: 6574 6572 6d69 6e65 7320 6966 2074 6865  etermines if the
-0000e870: 2067 6976 656e 2028 6c61 7374 496e 6465   given (lastInde
-0000e880: 782c 7465 726d 2920 6c6f 6720 6973 206d  x,term) log is m
-0000e890: 6f72 6520 7570 2d74 6f2d 6461 7465 0a20  ore up-to-date. 
-0000e8a0: 2020 2020 2020 2062 7920 636f 6d70 6172         by compar
-0000e8b0: 696e 6720 7468 6520 696e 6465 7820 616e  ing the index an
-0000e8c0: 6420 7465 726d 206f 6620 7468 6520 6c61  d term of the la
-0000e8d0: 7374 2065 6e74 7279 2069 6e20 7468 6520  st entry in the 
-0000e8e0: 6578 6973 7469 6e67 206c 6f67 732e 0a20  existing logs.. 
-0000e8f0: 2020 2020 2020 2049 6620 7468 6520 6c6f         If the lo
-0000e900: 6773 2068 6176 6520 6c61 7374 2065 6e74  gs have last ent
-0000e910: 7279 2077 6974 6820 6469 6666 6572 656e  ry with differen
-0000e920: 7420 7465 726d 732c 2074 6865 6e20 7468  t terms, then th
-0000e930: 6520 6c6f 6720 7769 7468 2074 6865 0a20  e log with the. 
-0000e940: 2020 2020 2020 206c 6174 6572 2074 6572         later ter
-0000e950: 6d20 6973 206d 6f72 6520 7570 2d74 6f2d  m is more up-to-
-0000e960: 6461 7465 2e20 4966 2074 6865 206c 6f67  date. If the log
-0000e970: 7320 656e 6420 7769 7468 2074 6865 2073  s end with the s
-0000e980: 616d 6520 7465 726d 2c20 7468 656e 0a20  ame term, then. 
-0000e990: 2020 2020 2020 2077 6869 6368 6576 6572         whichever
-0000e9a0: 206c 6f67 2068 6173 2074 6865 206c 6172   log has the lar
-0000e9b0: 6765 7220 6c61 7374 5f69 6e64 6578 2069  ger last_index i
-0000e9c0: 7320 6d6f 7265 2075 702d 746f 2d64 6174  s more up-to-dat
-0000e9d0: 652e 2049 6620 7468 6520 6c6f 6773 2061  e. If the logs a
-0000e9e0: 7265 0a20 2020 2020 2020 2074 6865 2073  re.        the s
-0000e9f0: 616d 652c 2074 6865 2067 6976 656e 206c  ame, the given l
-0000ea00: 6f67 2069 7320 7570 2d74 6f2d 6461 7465  og is up-to-date
-0000ea10: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000ea20: 2020 6465 6620 6d61 7962 655f 636f 6d6d    def maybe_comm
-0000ea30: 6974 2873 656c 662c 206d 6178 5f69 6e64  it(self, max_ind
-0000ea40: 6578 3a20 696e 742c 2074 6572 6d3a 2069  ex: int, term: i
-0000ea50: 6e74 2920 2d3e 2062 6f6f 6c3a 0a20 2020  nt) -> bool:.   
-0000ea60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000ea70: 2041 7474 656d 7074 7320 746f 2063 6f6d   Attempts to com
-0000ea80: 6d69 7420 7468 6520 696e 6465 7820 616e  mit the index an
-0000ea90: 6420 7465 726d 2061 6e64 2072 6574 7572  d term and retur
-0000eaa0: 6e73 2077 6865 7468 6572 2069 7420 6469  ns whether it di
-0000eab0: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-0000eac0: 2020 2064 6566 206d 6179 6265 5f70 6572     def maybe_per
-0000ead0: 7369 7374 2873 656c 662c 2069 6e64 6578  sist(self, index
-0000eae0: 3a20 696e 742c 2074 6572 6d3a 2069 6e74  : int, term: int
-0000eaf0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0000eb00: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-0000eb10: 7474 656d 7074 7320 746f 2070 6572 7369  ttempts to persi
-0000eb20: 7374 2074 6865 2069 6e64 6578 2061 6e64  st the index and
-0000eb30: 2074 6572 6d20 616e 6420 7265 7475 726e   term and return
-0000eb40: 7320 7768 6574 6865 7220 6974 2064 6964  s whether it did
-0000eb50: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000eb60: 2020 6465 6620 6d61 7962 655f 7065 7273    def maybe_pers
-0000eb70: 6973 745f 736e 6170 2873 656c 662c 2069  ist_snap(self, i
-0000eb80: 6e64 6578 3a20 696e 7429 202d 3e20 626f  ndex: int) -> bo
-0000eb90: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
-0000eba0: 2020 2020 2020 2020 4174 7465 6d70 7473          Attempts
-0000ebb0: 2074 6f20 7065 7273 6973 7420 7468 6520   to persist the 
-0000ebc0: 736e 6170 7368 6f74 2061 6e64 2072 6574  snapshot and ret
-0000ebd0: 7572 6e73 2077 6865 7468 6572 2069 7420  urns whether it 
-0000ebe0: 6469 642e 0a20 2020 2020 2020 2022 2222  did..        """
-0000ebf0: 0a20 2020 2064 6566 206d 6179 6265 5f61  .    def maybe_a
-0000ec00: 7070 656e 6428 0a20 2020 2020 2020 2073  ppend(.        s
-0000ec10: 656c 662c 0a20 2020 2020 2020 2069 6478  elf,.        idx
-0000ec20: 3a20 696e 742c 0a20 2020 2020 2020 2074  : int,.        t
-0000ec30: 6572 6d3a 2069 6e74 2c0a 2020 2020 2020  erm: int,.      
-0000ec40: 2020 636f 6d6d 6974 7465 643a 2069 6e74    committed: int
-0000ec50: 2c0a 2020 2020 2020 2020 656e 7473 3a20  ,.        ents: 
-0000ec60: 4c69 7374 5b22 456e 7472 7922 5d20 7c20  List["Entry"] | 
-0000ec70: 4c69 7374 5b22 456e 7472 7952 6566 225d  List["EntryRef"]
-0000ec80: 2c0a 2020 2020 2920 2d3e 204f 7074 696f  ,.    ) -> Optio
-0000ec90: 6e61 6c5b 5475 706c 655b 696e 742c 2069  nal[Tuple[int, i
-0000eca0: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
-0000ecb0: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-0000ecc0: 7320 4e6f 6e65 2069 6620 7468 6520 656e  s None if the en
-0000ecd0: 7472 6965 7320 6361 6e6e 6f74 2062 6520  tries cannot be 
-0000ece0: 6170 7065 6e64 6564 2e20 4f74 6865 7277  appended. Otherw
-0000ecf0: 6973 652c 0a20 2020 2020 2020 2069 7420  ise,.        it 
-0000ed00: 7265 7475 726e 7320 536f 6d65 2828 636f  returns Some((co
-0000ed10: 6e66 6c69 6374 5f69 6e64 6578 2c20 6c61  nflict_index, la
-0000ed20: 7374 5f69 6e64 6578 2929 2e0a 0a20 2020  st_index))...   
-0000ed30: 2020 2020 2023 2050 616e 6963 730a 0a20       # Panics.. 
-0000ed40: 2020 2020 2020 2050 616e 6963 7320 6966         Panics if
-0000ed50: 2069 7420 6669 6e64 7320 6120 636f 6e66   it finds a conf
-0000ed60: 6c69 6374 696e 6720 696e 6465 7820 6c65  licting index le
-0000ed70: 7373 2074 6861 6e20 636f 6d6d 6974 7465  ss than committe
-0000ed80: 6420 696e 6465 782e 0a20 2020 2020 2020  d index..       
-0000ed90: 2022 2222 0a20 2020 2064 6566 2073 6e61   """.    def sna
-0000eda0: 7073 686f 7428 7365 6c66 2c20 7265 7175  pshot(self, requ
-0000edb0: 6573 745f 696e 6465 783a 2069 6e74 2c20  est_index: int, 
-0000edc0: 746f 3a20 696e 7429 202d 3e20 2253 6e61  to: int) -> "Sna
-0000edd0: 7073 686f 7452 6566 223a 0a20 2020 2020  pshotRef":.     
-0000ede0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-0000edf0: 6574 7572 6e73 2074 6865 2063 7572 7265  eturns the curre
-0000ee00: 6e74 2073 6e61 7073 686f 740a 2020 2020  nt snapshot.    
-0000ee10: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-0000ee20: 7374 6162 6c65 5f65 6e74 7269 6573 2873  stable_entries(s
-0000ee30: 656c 662c 2069 6e64 6578 3a20 696e 742c  elf, index: int,
-0000ee40: 2074 6572 6d3a 2069 6e74 2920 2d3e 204e   term: int) -> N
-0000ee50: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000ee60: 0a20 2020 2020 2020 2043 6c65 6172 7320  .        Clears 
-0000ee70: 7468 6520 756e 7374 6162 6c65 2065 6e74  the unstable ent
-0000ee80: 7269 6573 2061 6e64 206d 6f76 6573 2074  ries and moves t
-0000ee90: 6865 2073 7461 626c 6520 6f66 6673 6574  he stable offset
-0000eea0: 2075 7020 746f 2074 6865 0a20 2020 2020   up to the.     
-0000eeb0: 2020 206c 6173 7420 696e 6465 782c 2069     last index, i
-0000eec0: 6620 7468 6572 6520 6973 2061 6e79 2e0a  f there is any..
-0000eed0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000eee0: 6465 6620 7374 6162 6c65 5f73 6e61 7028  def stable_snap(
-0000eef0: 7365 6c66 2c20 696e 6465 783a 2069 6e74  self, index: int
-0000ef00: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000ef10: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-0000ef20: 6c65 6172 7320 7468 6520 756e 7374 6162  lears the unstab
-0000ef30: 6c65 2073 6e61 7073 686f 742e 0a20 2020  le snapshot..   
-0000ef40: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-0000ef50: 2074 6572 6d28 7365 6c66 2c20 6964 783a   term(self, idx:
-0000ef60: 2069 6e74 2920 2d3e 2069 6e74 3a0a 2020   int) -> int:.  
-0000ef70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ef80: 2020 466f 7220 6120 6769 7665 6e20 696e    For a given in
-0000ef90: 6465 782c 2066 696e 6473 2074 6865 2074  dex, finds the t
-0000efa0: 6572 6d20 6173 736f 6369 6174 6564 2077  erm associated w
-0000efb0: 6974 6820 6974 2e0a 2020 2020 2020 2020  ith it..        
-0000efc0: 2222 220a 2020 2020 6465 6620 6c61 7374  """.    def last
-0000efd0: 5f74 6572 6d28 7365 6c66 2920 2d3e 2069  _term(self) -> i
-0000efe0: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
-0000eff0: 2020 2020 2020 2020 4772 6162 7320 7468          Grabs th
-0000f000: 6520 7465 726d 2066 726f 6d20 7468 6520  e term from the 
-0000f010: 6c61 7374 2065 6e74 7279 2e0a 0a20 2020  last entry...   
-0000f020: 2020 2020 2023 2050 616e 6963 730a 0a20       # Panics.. 
-0000f030: 2020 2020 2020 2050 616e 6963 7320 6966         Panics if
-0000f040: 2074 6865 7265 2061 7265 2065 6e74 7269   there are entri
-0000f050: 6573 2062 7574 2074 6865 206c 6173 7420  es but the last 
-0000f060: 7465 726d 2068 6173 2062 6565 6e20 6469  term has been di
-0000f070: 7363 6172 6465 642e 0a20 2020 2020 2020  scarded..       
-0000f080: 2022 2222 0a20 2020 2064 6566 206d 6174   """.    def mat
-0000f090: 6368 5f74 6572 6d28 7365 6c66 2c20 6964  ch_term(self, id
-0000f0a0: 783a 2069 6e74 2c20 7465 726d 3a20 696e  x: int, term: in
-0000f0b0: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
-0000f0c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000f0d0: 416e 7377 6572 7320 7468 6520 7175 6573  Answers the ques
-0000f0e0: 7469 6f6e 3a20 446f 6573 2074 6869 7320  tion: Does this 
-0000f0f0: 696e 6465 7820 6265 6c6f 6e67 2074 6f20  index belong to 
-0000f100: 7468 6973 2074 6572 6d3f 0a20 2020 2020  this term?.     
-0000f110: 2020 2022 2222 0a20 2020 2064 6566 2066     """.    def f
-0000f120: 6972 7374 5f69 6e64 6578 2873 656c 6629  irst_index(self)
-0000f130: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-0000f140: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-0000f150: 7572 6e73 2074 6820 6669 7273 7420 696e  urns th first in
-0000f160: 6465 7820 696e 2074 6865 2073 746f 7265  dex in the store
-0000f170: 2074 6861 7420 6973 2061 7661 696c 6162   that is availab
-0000f180: 6c65 2076 6961 2065 6e74 7269 6573 0a0a  le via entries..
-0000f190: 2020 2020 2020 2020 2320 5061 6e69 6373          # Panics
-0000f1a0: 0a0a 2020 2020 2020 2020 5061 6e69 6373  ..        Panics
-0000f1b0: 2069 6620 7468 6520 7374 6f72 6520 646f   if the store do
-0000f1c0: 6573 6e27 7420 6861 7665 2061 2066 6972  esn't have a fir
-0000f1d0: 7374 2069 6e64 6578 2e0a 2020 2020 2020  st index..      
-0000f1e0: 2020 2222 220a 2020 2020 6465 6620 6c61    """.    def la
-0000f1f0: 7374 5f69 6e64 6578 2873 656c 6629 202d  st_index(self) -
-0000f200: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-0000f210: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-0000f220: 6e73 2074 6865 206c 6173 7420 696e 6465  ns the last inde
-0000f230: 7820 696e 2074 6865 2073 746f 7265 2074  x in the store t
-0000f240: 6861 7420 6973 2061 7661 696c 6162 6c65  hat is available
-0000f250: 2076 6961 2065 6e74 7269 6573 2e0a 0a20   via entries... 
-0000f260: 2020 2020 2020 2023 2050 616e 6963 730a         # Panics.
-0000f270: 0a20 2020 2020 2020 2050 616e 6963 7320  .        Panics 
-0000f280: 6966 2074 6865 2073 746f 7265 2064 6f65  if the store doe
-0000f290: 736e 2774 2068 6176 6520 6120 6c61 7374  sn't have a last
-0000f2a0: 2069 6e64 6578 2e0a 2020 2020 2020 2020   index..        
-0000f2b0: 2222 220a 2020 2020 6465 6620 756e 7374  """.    def unst
-0000f2c0: 6162 6c65 2873 656c 6629 202d 3e20 2255  able(self) -> "U
-0000f2d0: 6e73 7461 626c 6552 6566 223a 0a20 2020  nstableRef":.   
-0000f2e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f2f0: 2052 6574 7572 6e73 2061 2072 6566 6572   Returns a refer
-0000f300: 656e 6365 2074 6f20 7468 6520 756e 7374  ence to the unst
-0000f310: 6162 6c65 206c 6f67 2e0a 2020 2020 2020  able log..      
-0000f320: 2020 2222 220a 2020 2020 6465 6620 756e    """.    def un
-0000f330: 7374 6162 6c65 5f65 6e74 7269 6573 2873  stable_entries(s
-0000f340: 656c 6629 202d 3e20 4c69 7374 5b22 456e  elf) -> List["En
-0000f350: 7472 7952 6566 225d 3a0a 2020 2020 2020  tryRef"]:.      
-0000f360: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0000f370: 7475 726e 7320 736c 6963 6520 6f66 2065  turns slice of e
-0000f380: 6e74 7269 6573 2074 6861 7420 6172 6520  ntries that are 
-0000f390: 6e6f 7420 7065 7273 6973 7465 642e 0a20  not persisted.. 
-0000f3a0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-0000f3b0: 6566 2075 6e73 7461 626c 655f 736e 6170  ef unstable_snap
-0000f3c0: 7368 6f74 2873 656c 6629 202d 3e20 4f70  shot(self) -> Op
-0000f3d0: 7469 6f6e 616c 5b22 536e 6170 7368 6f74  tional["Snapshot
-0000f3e0: 5265 6622 5d3a 0a20 2020 2020 2020 2022  Ref"]:.        "
-0000f3f0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-0000f400: 6e73 2074 6865 2073 6e61 7073 686f 7420  ns the snapshot 
-0000f410: 7468 6174 2061 7265 206e 6f74 2070 6572  that are not per
-0000f420: 7369 7374 6564 2e0a 2020 2020 2020 2020  sisted..        
-0000f430: 2222 220a 2020 2020 6465 6620 6765 745f  """.    def get_
-0000f440: 6170 706c 6965 6428 7365 6c66 2920 2d3e  applied(self) ->
-0000f450: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-0000f460: 220a 2020 2020 2020 2020 6061 7070 6c69  ".        `appli
-0000f470: 6564 603a 2054 6865 2068 6967 6865 7374  ed`: The highest
-0000f480: 206c 6f67 2070 6f73 6974 696f 6e20 7468   log position th
-0000f490: 6174 2074 6865 2061 7070 6c69 6361 7469  at the applicati
-0000f4a0: 6f6e 2068 6173 2062 6565 6e20 696e 7374  on has been inst
-0000f4b0: 7275 6374 6564 0a20 2020 2020 2020 2074  ructed.        t
-0000f4c0: 6f20 6170 706c 7920 746f 2069 7473 2073  o apply to its s
-0000f4d0: 7461 7465 206d 6163 6869 6e65 2e0a 0a20  tate machine... 
-0000f4e0: 2020 2020 2020 2049 6e76 6172 6961 6e74         Invariant
-0000f4f0: 3a20 6170 706c 6965 6420 3c3d 206d 696e  : applied <= min
-0000f500: 2863 6f6d 6d69 7474 6564 2c20 7065 7273  (committed, pers
-0000f510: 6973 7465 6429 0a20 2020 2020 2020 2022  isted).        "
-0000f520: 2222 0a20 2020 2064 6566 2073 6574 5f61  "".    def set_a
-0000f530: 7070 6c69 6564 2873 656c 662c 2061 7070  pplied(self, app
-0000f540: 6c69 6564 3a20 696e 7429 202d 3e20 4e6f  lied: int) -> No
-0000f550: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-0000f560: 2020 2020 2020 2020 6061 7070 6c69 6564          `applied
-0000f570: 603a 2054 6865 2068 6967 6865 7374 206c  `: The highest l
-0000f580: 6f67 2070 6f73 6974 696f 6e20 7468 6174  og position that
-0000f590: 2074 6865 2061 7070 6c69 6361 7469 6f6e   the application
-0000f5a0: 2068 6173 2062 6565 6e20 696e 7374 7275   has been instru
-0000f5b0: 6374 6564 0a20 2020 2020 2020 2074 6f20  cted.        to 
-0000f5c0: 6170 706c 7920 746f 2069 7473 2073 7461  apply to its sta
-0000f5d0: 7465 206d 6163 6869 6e65 2e0a 0a20 2020  te machine...   
-0000f5e0: 2020 2020 2049 6e76 6172 6961 6e74 3a20       Invariant: 
-0000f5f0: 6170 706c 6965 6420 3c3d 206d 696e 2863  applied <= min(c
-0000f600: 6f6d 6d69 7474 6564 2c20 7065 7273 6973  ommitted, persis
-0000f610: 7465 6429 0a20 2020 2020 2020 2022 2222  ted).        """
-0000f620: 0a20 2020 2064 6566 2067 6574 5f63 6f6d  .    def get_com
-0000f630: 6d69 7474 6564 2873 656c 6629 202d 3e20  mitted(self) -> 
-0000f640: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-0000f650: 0a20 2020 2020 2020 2060 636f 6d6d 6974  .        `commit
-0000f660: 7465 6460 3a20 5468 6520 6869 6768 6573  ted`: The highes
-0000f670: 7420 6c6f 6720 706f 7369 7469 6f6e 2074  t log position t
-0000f680: 6861 7420 6973 206b 6e6f 776e 2074 6f20  hat is known to 
-0000f690: 6265 2069 6e20 7374 6162 6c65 2073 746f  be in stable sto
-0000f6a0: 7261 6765 0a20 2020 2020 2020 206f 6e20  rage.        on 
-0000f6b0: 6120 7175 6f72 756d 206f 6620 6e6f 6465  a quorum of node
-0000f6c0: 732e 0a0a 2020 2020 2020 2020 496e 7661  s...        Inva
-0000f6d0: 7269 616e 743a 2061 7070 6c69 6564 203c  riant: applied <
-0000f6e0: 3d20 636f 6d6d 6974 7465 640a 2020 2020  = committed.    
-0000f6f0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-0000f700: 7365 745f 636f 6d6d 6974 7465 6428 7365  set_committed(se
-0000f710: 6c66 2c20 636f 6d6d 6974 7465 643a 2069  lf, committed: i
-0000f720: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-0000f730: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f740: 2060 636f 6d6d 6974 7465 6460 3a20 5468   `committed`: Th
-0000f750: 6520 6869 6768 6573 7420 6c6f 6720 706f  e highest log po
-0000f760: 7369 7469 6f6e 2074 6861 7420 6973 206b  sition that is k
-0000f770: 6e6f 776e 2074 6f20 6265 2069 6e20 7374  nown to be in st
-0000f780: 6162 6c65 2073 746f 7261 6765 0a20 2020  able storage.   
-0000f790: 2020 2020 206f 6e20 6120 7175 6f72 756d       on a quorum
-0000f7a0: 206f 6620 6e6f 6465 732e 0a0a 2020 2020   of nodes...    
-0000f7b0: 2020 2020 496e 7661 7269 616e 743a 2061      Invariant: a
-0000f7c0: 7070 6c69 6564 203c 3d20 636f 6d6d 6974  pplied <= commit
-0000f7d0: 7465 640a 2020 2020 2020 2020 2222 220a  ted.        """.
-0000f7e0: 2020 2020 6465 6620 6765 745f 7065 7273      def get_pers
-0000f7f0: 6973 7465 6428 7365 6c66 2920 2d3e 2069  isted(self) -> i
-0000f800: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
-0000f810: 2020 2020 2020 2020 6070 6572 7369 7374          `persist
-0000f820: 6564 603a 2054 6865 2068 6967 6865 7374  ed`: The highest
-0000f830: 206c 6f67 2070 6f73 6974 696f 6e20 7468   log position th
-0000f840: 6174 2069 7320 6b6e 6f77 6e20 746f 2062  at is known to b
-0000f850: 6520 7065 7273 6973 7465 6420 696e 2073  e persisted in s
-0000f860: 7461 626c 650a 2020 2020 2020 2020 7374  table.        st
-0000f870: 6f72 6167 652e 2049 7427 7320 7573 6564  orage. It's used
-0000f880: 2066 6f72 206c 696d 6974 696e 6720 7468   for limiting th
-0000f890: 6520 7570 7065 7220 626f 756e 6420 6f66  e upper bound of
-0000f8a0: 2063 6f6d 6d69 7474 6564 2061 6e64 0a20   committed and. 
-0000f8b0: 2020 2020 2020 2070 6572 7369 7374 6564         persisted
-0000f8c0: 2065 6e74 7269 6573 2e0a 0a20 2020 2020   entries...     
-0000f8d0: 2020 2049 6e76 6172 6961 6e74 3a20 7065     Invariant: pe
-0000f8e0: 7273 6973 7465 6420 3c20 756e 7374 6162  rsisted < unstab
-0000f8f0: 6c65 2e6f 6666 7365 7420 2626 2061 7070  le.offset && app
-0000f900: 6c69 6564 203c 3d20 7065 7273 6973 7465  lied <= persiste
-0000f910: 640a 2020 2020 2020 2020 2222 220a 2020  d.        """.  
-0000f920: 2020 6465 6620 7365 745f 7065 7273 6973    def set_persis
-0000f930: 7465 6428 7365 6c66 2c20 7065 7273 6973  ted(self, persis
-0000f940: 7465 643a 2069 6e74 2920 2d3e 204e 6f6e  ted: int) -> Non
-0000f950: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-0000f960: 2020 2020 2020 2060 7065 7273 6973 7465         `persiste
-0000f970: 6460 3a20 5468 6520 6869 6768 6573 7420  d`: The highest 
-0000f980: 6c6f 6720 706f 7369 7469 6f6e 2074 6861  log position tha
-0000f990: 7420 6973 206b 6e6f 776e 2074 6f20 6265  t is known to be
-0000f9a0: 2070 6572 7369 7374 6564 2069 6e20 7374   persisted in st
-0000f9b0: 6162 6c65 0a20 2020 2020 2020 2073 746f  able.        sto
-0000f9c0: 7261 6765 2e20 4974 2773 2075 7365 6420  rage. It's used 
-0000f9d0: 666f 7220 6c69 6d69 7469 6e67 2074 6865  for limiting the
-0000f9e0: 2075 7070 6572 2062 6f75 6e64 206f 6620   upper bound of 
-0000f9f0: 636f 6d6d 6974 7465 6420 616e 640a 2020  committed and.  
-0000fa00: 2020 2020 2020 7065 7273 6973 7465 6420        persisted 
-0000fa10: 656e 7472 6965 732e 0a0a 2020 2020 2020  entries...      
-0000fa20: 2020 496e 7661 7269 616e 743a 2070 6572    Invariant: per
-0000fa30: 7369 7374 6564 203c 2075 6e73 7461 626c  sisted < unstabl
-0000fa40: 652e 6f66 6673 6574 2026 2620 6170 706c  e.offset && appl
-0000fa50: 6965 6420 3c3d 2070 6572 7369 7374 6564  ied <= persisted
-0000fa60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000fa70: 2064 6566 2073 6c69 6365 280a 2020 2020   def slice(.    
-0000fa80: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0000fa90: 2020 6c6f 773a 2069 6e74 2c0a 2020 2020    low: int,.    
-0000faa0: 2020 2020 6869 6768 3a20 696e 742c 0a20      high: int,. 
-0000fab0: 2020 2020 2020 206d 6178 5f73 697a 653a         max_size:
-0000fac0: 204f 7074 696f 6e61 6c5b 696e 745d 2c0a   Optional[int],.
-0000fad0: 2020 2020 2020 2020 636f 6e74 6578 743a          context:
-0000fae0: 2022 4765 7445 6e74 7269 6573 436f 6e74   "GetEntriesCont
-0000faf0: 6578 7452 6566 222c 0a20 2020 2029 202d  extRef",.    ) -
-0000fb00: 3e20 4c69 7374 5b22 456e 7472 7952 6566  > List["EntryRef
-0000fb10: 225d 3a0a 2020 2020 2020 2020 2222 220a  "]:.        """.
-0000fb20: 2020 2020 2020 2020 4772 6162 7320 6120          Grabs a 
-0000fb30: 736c 6963 6520 6f66 2065 6e74 7269 6573  slice of entries
-0000fb40: 2066 726f 6d20 7468 6520 7261 6674 2e20   from the raft. 
-0000fb50: 556e 6c69 6b65 2061 2072 7573 7420 736c  Unlike a rust sl
-0000fb60: 6963 6520 706f 696e 7465 722c 2074 6865  ice pointer, the
-0000fb70: 7365 2061 7265 0a20 2020 2020 2020 2072  se are.        r
-0000fb80: 6574 7572 6e65 6420 6279 2076 616c 7565  eturned by value
-0000fb90: 2e20 5468 6520 7265 7375 6c74 2069 7320  . The result is 
-0000fba0: 7472 756e 6361 7465 6420 746f 2074 6865  truncated to the
-0000fbb0: 206d 6178 5f73 697a 6520 696e 2062 7974   max_size in byt
-0000fbc0: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-0000fbd0: 2020 2020 6465 6620 7265 7374 6f72 6528      def restore(
-0000fbe0: 7365 6c66 2c20 736e 6170 7368 6f74 3a20  self, snapshot: 
-0000fbf0: 2253 6e61 7073 686f 7422 207c 2022 536e  "Snapshot" | "Sn
-0000fc00: 6170 7368 6f74 5265 6622 2920 2d3e 204e  apshotRef") -> N
-0000fc10: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000fc20: 0a20 2020 2020 2020 2052 6573 746f 7265  .        Restore
-0000fc30: 7320 7468 6520 6375 7272 656e 7420 6c6f  s the current lo
-0000fc40: 6720 6672 6f6d 2061 2073 6e61 7073 686f  g from a snapsho
-0000fc50: 742e 0a20 2020 2020 2020 2022 2222 0a0a  t..        """..
-0000fc60: 636c 6173 7320 496e 4d65 6d6f 7279 5261  class InMemoryRa
-0000fc70: 6674 4c6f 6728 5f5f 4150 495f 5261 6674  ftLog(__API_Raft
-0000fc80: 4c6f 6729 3a0a 2020 2020 2222 220a 2020  Log):.    """.  
-0000fc90: 2020 5261 6674 206c 6f67 2069 6d70 6c65    Raft log imple
-0000fca0: 6d65 6e74 6174 696f 6e0a 2020 2020 2222  mentation.    ""
-0000fcb0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-0000fcc0: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
-0000fcd0: 662c 2073 746f 7265 3a20 224d 656d 5374  f, store: "MemSt
-0000fce0: 6f72 6167 6552 6566 222c 206c 6f67 6765  orageRef", logge
-0000fcf0: 723a 2022 4c6f 6767 6572 2220 7c20 224c  r: "Logger" | "L
-0000fd00: 6f67 6765 7252 6566 220a 2020 2020 2920  oggerRef".    ) 
-0000fd10: 2d3e 204e 6f6e 653a 202e 2e2e 0a20 2020  -> None: ....   
-0000fd20: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
-0000fd30: 6c66 2920 2d3e 2022 496e 4d65 6d6f 7279  lf) -> "InMemory
-0000fd40: 5261 6674 4c6f 6752 6566 223a 202e 2e2e  RaftLogRef": ...
-0000fd50: 0a20 2020 2064 6566 2067 6574 5f73 746f  .    def get_sto
-0000fd60: 7265 2873 656c 6629 202d 3e20 224d 656d  re(self) -> "Mem
-0000fd70: 5374 6f72 6167 6552 6566 223a 0a20 2020  StorageRef":.   
-0000fd80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000fd90: 2047 7261 6220 6120 7265 6164 2d6f 6e6c   Grab a read-onl
-0000fda0: 7920 7265 6665 7265 6e63 6520 746f 2074  y reference to t
-0000fdb0: 6865 2075 6e64 6572 6c79 696e 6720 7374  he underlying st
-0000fdc0: 6f72 6167 652e 0a20 2020 2020 2020 2022  orage..        "
-0000fdd0: 2222 0a0a 636c 6173 7320 496e 4d65 6d6f  ""..class InMemo
-0000fde0: 7279 5261 6674 4c6f 6752 6566 285f 5f41  ryRaftLogRef(__A
-0000fdf0: 5049 5f52 6166 744c 6f67 293a 0a20 2020  PI_RaftLog):.   
-0000fe00: 2022 2222 0a20 2020 2052 6566 6572 656e   """.    Referen
-0000fe10: 6365 2074 7970 6520 6f66 203a 636c 6173  ce type of :clas
-0000fe20: 733a 6049 6e4d 656d 6f72 7952 6166 744c  s:`InMemoryRaftL
-0000fe30: 6f67 602e 0a20 2020 2022 2222 0a0a 2020  og`..    """..  
-0000fe40: 2020 6465 6620 6765 745f 7374 6f72 6528    def get_store(
-0000fe50: 7365 6c66 2920 2d3e 2022 4d65 6d53 746f  self) -> "MemSto
-0000fe60: 7261 6765 5265 6622 3a0a 2020 2020 2020  rageRef":.      
-0000fe70: 2020 2222 220a 2020 2020 2020 2020 4772    """.        Gr
-0000fe80: 6162 2061 2072 6561 642d 6f6e 6c79 2072  ab a read-only r
-0000fe90: 6566 6572 656e 6365 2074 6f20 7468 6520  eference to the 
-0000fea0: 756e 6465 726c 7969 6e67 2073 746f 7261  underlying stora
-0000feb0: 6765 2e0a 2020 2020 2020 2020 2222 220a  ge..        """.
-0000fec0: 0a63 6c61 7373 2052 6166 744c 6f67 285f  .class RaftLog(_
-0000fed0: 5f41 5049 5f52 6166 744c 6f67 293a 0a20  _API_RaftLog):. 
-0000fee0: 2020 2022 2222 2022 2222 0a0a 2020 2020     """ """..    
-0000fef0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0000ff00: 662c 2073 746f 7265 3a20 2253 746f 7261  f, store: "Stora
-0000ff10: 6765 5265 6622 2c20 6c6f 6767 6572 3a20  geRef", logger: 
-0000ff20: 224c 6f67 6765 7222 207c 2022 4c6f 6767  "Logger" | "Logg
-0000ff30: 6572 5265 6622 2920 2d3e 204e 6f6e 653a  erRef") -> None:
-0000ff40: 202e 2e2e 0a20 2020 2064 6566 206d 616b   ....    def mak
-0000ff50: 655f 7265 6628 7365 6c66 2920 2d3e 2022  e_ref(self) -> "
-0000ff60: 5261 6674 4c6f 6752 6566 223a 202e 2e2e  RaftLogRef": ...
-0000ff70: 0a20 2020 2064 6566 2067 6574 5f73 746f  .    def get_sto
-0000ff80: 7265 2873 656c 6629 202d 3e20 2253 746f  re(self) -> "Sto
-0000ff90: 7261 6765 5265 6622 3a0a 2020 2020 2020  rageRef":.      
-0000ffa0: 2020 2222 220a 2020 2020 2020 2020 4772    """.        Gr
-0000ffb0: 6162 2061 2072 6561 642d 6f6e 6c79 2072  ab a read-only r
-0000ffc0: 6566 6572 656e 6365 2074 6f20 7468 6520  eference to the 
-0000ffd0: 756e 6465 726c 7969 6e67 2073 746f 7261  underlying stora
-0000ffe0: 6765 2e0a 2020 2020 2020 2020 2222 220a  ge..        """.
-0000fff0: 0a63 6c61 7373 2052 6166 744c 6f67 5265  .class RaftLogRe
-00010000: 6628 5f5f 4150 495f 5261 6674 4c6f 6729  f(__API_RaftLog)
-00010010: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-00010020: 6665 7265 6e63 6520 7479 7065 206f 6620  ference type of 
-00010030: 3a63 6c61 7373 3a60 5261 6674 4c6f 6760  :class:`RaftLog`
-00010040: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00010050: 6566 2067 6574 5f73 746f 7265 2873 656c  ef get_store(sel
-00010060: 6629 202d 3e20 2253 746f 7261 6765 5265  f) -> "StorageRe
-00010070: 6622 3a0a 2020 2020 2020 2020 2222 220a  f":.        """.
-00010080: 2020 2020 2020 2020 4772 6162 2061 2072          Grab a r
-00010090: 6561 642d 6f6e 6c79 2072 6566 6572 656e  ead-only referen
-000100a0: 6365 2074 6f20 7468 6520 756e 6465 726c  ce to the underl
-000100b0: 7969 6e67 2073 746f 7261 6765 2e0a 2020  ying storage..  
-000100c0: 2020 2020 2020 2222 220a 0a63 6c61 7373        """..class
-000100d0: 205f 5f41 5049 5f52 6166 743a 0a20 2020   __API_Raft:.   
-000100e0: 2064 6566 2061 7070 656e 645f 656e 7472   def append_entr
-000100f0: 7928 7365 6c66 2c20 656e 7473 3a20 4c69  y(self, ents: Li
-00010100: 7374 5b22 456e 7472 7922 5d20 7c20 4c69  st["Entry"] | Li
-00010110: 7374 5b22 456e 7472 7952 6566 225d 2920  st["EntryRef"]) 
-00010120: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00010130: 2022 2222 0a20 2020 2020 2020 2041 7070   """.        App
-00010140: 656e 6473 2061 2073 6c69 6365 206f 6620  ends a slice of 
-00010150: 656e 7472 6965 7320 746f 2074 6865 206c  entries to the l
-00010160: 6f67 2e0a 2020 2020 2020 2020 5468 6520  og..        The 
-00010170: 656e 7472 6965 7320 6172 6520 7570 6461  entries are upda
-00010180: 7465 6420 746f 206d 6174 6368 2074 6865  ted to match the
-00010190: 2063 7572 7265 6e74 2069 6e64 6578 2061   current index a
-000101a0: 6e64 2074 6572 6d2e 0a20 2020 2020 2020  nd term..       
-000101b0: 204f 6e6c 7920 6361 6c6c 6564 2062 7920   Only called by 
-000101c0: 6c65 6164 6572 2063 7572 7265 6e74 6c79  leader currently
-000101d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000101e0: 2064 6566 2073 656e 645f 6170 7065 6e64   def send_append
-000101f0: 2873 656c 662c 2074 6f3a 2069 6e74 2920  (self, to: int) 
-00010200: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00010210: 2022 2222 0a20 2020 2020 2020 2053 656e   """.        Sen
-00010220: 6473 2061 6e20 6170 7065 6e64 2052 5043  ds an append RPC
-00010230: 2077 6974 6820 6e65 7720 656e 7472 6965   with new entrie
-00010240: 7320 2869 6620 616e 7929 2061 6e64 2074  s (if any) and t
-00010250: 6865 2063 7572 7265 6e74 2063 6f6d 6d69  he current commi
-00010260: 7420 696e 6465 7820 746f 2074 6865 2067  t index to the g
-00010270: 6976 656e 0a20 2020 2020 2020 2070 6565  iven.        pee
-00010280: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
-00010290: 2020 2064 6566 206f 6e5f 7065 7273 6973     def on_persis
-000102a0: 745f 656e 7472 6965 7328 7365 6c66 2c20  t_entries(self, 
-000102b0: 696e 6465 783a 2069 6e74 2c20 7465 726d  index: int, term
-000102c0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-000102d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000102e0: 2020 2020 4e6f 7469 6669 6573 2074 6861      Notifies tha
-000102f0: 7420 7468 6573 6520 7261 6674 206c 6f67  t these raft log
-00010300: 7320 6861 7665 2062 6565 6e20 7065 7273  s have been pers
-00010310: 6973 7465 642e 0a20 2020 2020 2020 2022  isted..        "
-00010320: 2222 0a20 2020 2064 6566 2061 7070 6c79  "".    def apply
-00010330: 5f74 6f5f 6375 7272 656e 745f 7465 726d  _to_current_term
-00010340: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-00010350: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010360: 2020 2020 4368 6563 6b73 2069 6620 6c6f      Checks if lo
-00010370: 6773 2061 7265 2061 7070 6c69 6564 2074  gs are applied t
-00010380: 6f20 6375 7272 656e 7420 7465 726d 2e0a  o current term..
-00010390: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000103a0: 6465 6620 636f 6d6d 6974 5f74 6f5f 6375  def commit_to_cu
-000103b0: 7272 656e 745f 7465 726d 2873 656c 6629  rrent_term(self)
-000103c0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-000103d0: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
-000103e0: 6563 6b73 2069 6620 6c6f 6773 2061 7265  ecks if logs are
-000103f0: 2063 6f6d 6d69 7474 6564 2074 6f20 6974   committed to it
-00010400: 7320 7465 726d 2e0a 0a20 2020 2020 2020  s term...       
-00010410: 2054 6865 2063 6865 636b 2069 7320 7573   The check is us
-00010420: 6566 756c 2075 7375 616c 6c79 2077 6865  eful usually whe
-00010430: 6e20 7261 6674 2069 7320 6c65 6164 6572  n raft is leader
-00010440: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00010450: 2020 6465 6620 6772 6f75 705f 636f 6d6d    def group_comm
-00010460: 6974 2873 656c 6629 202d 3e20 626f 6f6c  it(self) -> bool
-00010470: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010480: 2020 2020 2020 5768 6574 6865 7220 656e        Whether en
-00010490: 6162 6c65 2067 726f 7570 2063 6f6d 6d69  able group commi
-000104a0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-000104b0: 2020 2064 6566 2065 6e61 626c 655f 6772     def enable_gr
-000104c0: 6f75 705f 636f 6d6d 6974 2873 656c 662c  oup_commit(self,
-000104d0: 2065 6e61 626c 653a 2062 6f6f 6c29 202d   enable: bool) -
-000104e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000104f0: 2222 220a 2020 2020 2020 2020 436f 6e66  """.        Conf
-00010500: 6967 7572 6573 2067 726f 7570 2063 6f6d  igures group com
-00010510: 6d69 742e 0a0a 2020 2020 2020 2020 4966  mit...        If
-00010520: 2067 726f 7570 2063 6f6d 6d69 7420 6973   group commit is
-00010530: 2065 6e61 626c 6564 2c20 6f6e 6c79 206c   enabled, only l
-00010540: 6f67 7320 7265 706c 6963 6174 6564 2074  ogs replicated t
-00010550: 6f20 6174 206c 6561 7374 2074 776f 0a20  o at least two. 
-00010560: 2020 2020 2020 2064 6966 6665 7265 6e74         different
-00010570: 2067 726f 7570 7320 6172 6520 636f 6d6d   groups are comm
-00010580: 6974 7465 642e 0a0a 2020 2020 2020 2020  itted...        
-00010590: 596f 7520 7368 6f75 6c64 2075 7365 2060  You should use `
-000105a0: 6173 7369 676e 5f63 6f6d 6d69 745f 6772  assign_commit_gr
-000105b0: 6f75 7073 6020 746f 2063 6f6e 6669 6775  oups` to configu
-000105c0: 7265 2070 6565 7220 6772 6f75 7073 2e0a  re peer groups..
-000105d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000105e0: 6465 6620 636c 6561 725f 636f 6d6d 6974  def clear_commit
-000105f0: 5f67 726f 7570 2873 656c 6629 202d 3e20  _group(self) -> 
-00010600: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00010610: 220a 2020 2020 2020 2020 5265 6d6f 7665  ".        Remove
-00010620: 7320 616c 6c20 636f 6d6d 6974 2067 726f  s all commit gro
-00010630: 7570 2063 6f6e 6669 6775 7261 7469 6f6e  up configuration
-00010640: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00010650: 2020 2064 6566 2063 6865 636b 5f67 726f     def check_gro
-00010660: 7570 5f63 6f6d 6d69 745f 636f 6e73 6973  up_commit_consis
-00010670: 7465 6e74 2873 656c 6629 202d 3e20 4f70  tent(self) -> Op
-00010680: 7469 6f6e 616c 5b62 6f6f 6c5d 3a0a 2020  tional[bool]:.  
-00010690: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000106a0: 2020 4368 6563 6b73 2077 6865 7468 6572    Checks whether
-000106b0: 2074 6865 2072 6166 7420 6772 6f75 7020   the raft group 
-000106c0: 6973 2075 7369 6e67 2067 726f 7570 2063  is using group c
-000106d0: 6f6d 6d69 7420 616e 6420 636f 6e73 6973  ommit and consis
-000106e0: 7465 6e74 0a20 2020 2020 2020 206f 7665  tent.        ove
-000106f0: 7220 6772 6f75 702e 0a0a 2020 2020 2020  r group...      
-00010700: 2020 4966 2069 7420 6361 6e27 7420 6765    If it can't ge
-00010710: 7420 6120 636f 7272 6563 7420 616e 7377  t a correct answ
-00010720: 6572 2c20 604e 6f6e 6560 2069 7320 7265  er, `None` is re
-00010730: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
-00010740: 2222 220a 2020 2020 6465 6620 6173 7369  """.    def assi
-00010750: 676e 5f63 6f6d 6d69 745f 6772 6f75 7073  gn_commit_groups
-00010760: 2873 656c 662c 2069 6473 3a20 4c69 7374  (self, ids: List
-00010770: 5b54 7570 6c65 5b69 6e74 2c20 696e 745d  [Tuple[int, int]
-00010780: 5d29 202d 3e20 4e6f 6e65 3a0a 2020 2020  ]) -> None:.    
-00010790: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000107a0: 4173 7369 676e 7320 6772 6f75 7073 2074  Assigns groups t
-000107b0: 6f20 7065 6572 732e 0a0a 2020 2020 2020  o peers...      
-000107c0: 2020 5468 6520 7475 706c 6520 6973 2028    The tuple is (
-000107d0: 6070 6565 725f 6964 602c 2060 6772 6f75  `peer_id`, `grou
-000107e0: 705f 6964 6029 2e20 6067 726f 7570 5f69  p_id`). `group_i
-000107f0: 6460 2073 686f 756c 6420 6265 206c 6172  d` should be lar
-00010800: 6765 7220 7468 616e 2030 2e0a 0a20 2020  ger than 0...   
-00010810: 2020 2020 2054 6865 2067 726f 7570 2069       The group i
-00010820: 6e66 6f72 6d61 7469 6f6e 2069 7320 6f6e  nformation is on
-00010830: 6c79 2073 746f 7265 6420 696e 206d 656d  ly stored in mem
-00010840: 6f72 792e 2053 6f20 796f 7520 6e65 6564  ory. So you need
-00010850: 2074 6f20 636f 6e66 6967 7572 650a 2020   to configure.  
-00010860: 2020 2020 2020 6974 2065 7665 7279 2074        it every t
-00010870: 696d 6520 6120 7261 6674 2073 7461 7465  ime a raft state
-00010880: 206d 6163 6869 6e65 2069 7320 696e 6974   machine is init
-00010890: 6961 6c69 7a65 6420 6f72 2061 2073 6e61  ialized or a sna
-000108a0: 7073 686f 7420 6973 2061 7070 6c69 6564  pshot is applied
-000108b0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000108c0: 2020 6465 6620 636f 6d6d 6974 5f61 7070    def commit_app
-000108d0: 6c79 2873 656c 662c 2061 7070 6c69 6564  ly(self, applied
-000108e0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-000108f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010900: 2020 2020 436f 6d6d 6974 2074 6861 7420      Commit that 
-00010910: 7468 6520 5261 6674 2070 6565 7220 6861  the Raft peer ha
-00010920: 7320 6170 706c 6965 6420 7570 2074 6f20  s applied up to 
-00010930: 7468 6520 6769 7665 6e20 696e 6465 782e  the given index.
-00010940: 0a0a 2020 2020 2020 2020 5265 6769 7374  ..        Regist
-00010950: 6572 7320 7468 6520 6e65 7720 6170 706c  ers the new appl
-00010960: 6965 6420 696e 6465 7820 746f 2074 6865  ied index to the
-00010970: 2052 6166 7420 6c6f 672e 0a0a 2020 2020   Raft log...    
-00010980: 2020 2020 2320 486f 6f6b 730a 0a20 2020      # Hooks..   
-00010990: 2020 2020 202a 2050 6f73 743a 2043 6865       * Post: Che
-000109a0: 636b 7320 746f 2073 6565 2069 6620 6974  cks to see if it
-000109b0: 2773 2074 696d 6520 746f 2066 696e 616c  's time to final
-000109c0: 697a 6520 6120 4a6f 696e 7420 436f 6e73  ize a Joint Cons
-000109d0: 656e 7375 7320 7374 6174 652e 0a20 2020  ensus state..   
-000109e0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-000109f0: 206d 6179 6265 5f63 6f6d 6d69 7428 7365   maybe_commit(se
-00010a00: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
-00010a10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010a20: 2041 7474 656d 7074 7320 746f 2061 6476   Attempts to adv
-00010a30: 616e 6365 2074 6865 2063 6f6d 6d69 7420  ance the commit 
-00010a40: 696e 6465 782e 2052 6574 7572 6e73 2074  index. Returns t
-00010a50: 7275 6520 6966 2074 6865 2063 6f6d 6d69  rue if the commi
-00010a60: 7420 696e 6465 780a 2020 2020 2020 2020  t index.        
-00010a70: 6368 616e 6765 6420 2869 6e20 7768 6963  changed (in whic
-00010a80: 6820 6361 7365 2074 6865 2063 616c 6c65  h case the calle
-00010a90: 7220 7368 6f75 6c64 2063 616c 6c20 6072  r should call `r
-00010aa0: 2e62 6361 7374 5f61 7070 656e 6460 292e  .bcast_append`).
-00010ab0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010ac0: 2064 6566 2075 6e63 6f6d 6d69 7474 6564   def uncommitted
-00010ad0: 5f73 697a 6528 7365 6c66 2920 2d3e 2069  _size(self) -> i
-00010ae0: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
-00010af0: 2020 2020 2020 2020 5265 7475 726e 2063          Return c
-00010b00: 7572 7265 6e74 2075 6e63 6f6d 6d69 7474  urrent uncommitt
-00010b10: 6564 2073 697a 6520 7265 636f 7264 6564  ed size recorded
-00010b20: 2062 7920 756e 636f 6d6d 6974 7465 645f   by uncommitted_
-00010b30: 7374 6174 650a 2020 2020 2020 2020 2222  state.        ""
-00010b40: 220a 2020 2020 6465 6620 6d61 7962 655f  ".    def maybe_
-00010b50: 696e 6372 6561 7365 5f75 6e63 6f6d 6d69  increase_uncommi
-00010b60: 7474 6564 5f73 697a 6528 0a20 2020 2020  tted_size(.     
-00010b70: 2020 2073 656c 662c 2065 6e74 733a 204c     self, ents: L
-00010b80: 6973 745b 2245 6e74 7279 225d 207c 204c  ist["Entry"] | L
-00010b90: 6973 745b 2245 6e74 7279 5265 6622 5d0a  ist["EntryRef"].
-00010ba0: 2020 2020 2920 2d3e 2062 6f6f 6c3a 0a20      ) -> bool:. 
-00010bb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010bc0: 2020 2049 6e63 7265 6173 6520 7369 7a65     Increase size
-00010bd0: 206f 6620 2765 6e74 7327 2074 6f20 756e   of 'ents' to un
-00010be0: 636f 6d6d 6974 7465 6420 7369 7a65 2e20  committed size. 
-00010bf0: 5265 7475 726e 2074 7275 6520 7768 656e  Return true when
-00010c00: 2073 697a 6520 6c69 6d69 740a 2020 2020   size limit.    
-00010c10: 2020 2020 6973 2073 6174 6973 6669 6564      is satisfied
-00010c20: 2e20 4f74 6865 7277 6973 6520 7265 7475  . Otherwise retu
-00010c30: 726e 2066 616c 7365 2061 6e64 2075 6e63  rn false and unc
-00010c40: 6f6d 6d69 7474 6564 2073 697a 6520 7265  ommitted size re
-00010c50: 6d61 696e 7320 756e 6368 616e 6765 642e  mains unchanged.
-00010c60: 0a20 2020 2020 2020 2046 6f72 2072 6166  .        For raf
-00010c70: 7420 7769 7468 206e 6f20 6c69 6d69 7428  t with no limit(
-00010c80: 6f72 206e 6f6e 2d6c 6561 6465 7220 7261  or non-leader ra
-00010c90: 6674 292c 2069 7420 616c 7761 7973 2072  ft), it always r
-00010ca0: 6574 7572 6e20 7472 7565 2e0a 2020 2020  eturn true..    
-00010cb0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00010cc0: 7265 6475 6365 5f75 6e63 6f6d 6d69 7474  reduce_uncommitt
-00010cd0: 6564 5f73 697a 6528 7365 6c66 2c20 656e  ed_size(self, en
-00010ce0: 7473 3a20 4c69 7374 5b22 456e 7472 7922  ts: List["Entry"
-00010cf0: 5d20 7c20 4c69 7374 5b22 456e 7472 7952  ] | List["EntryR
-00010d00: 6566 225d 2920 2d3e 204e 6f6e 653a 0a20  ef"]) -> None:. 
-00010d10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010d20: 2020 2052 6564 7563 6520 7369 7a65 206f     Reduce size o
-00010d30: 6620 2765 6e74 7327 2066 726f 6d20 756e  f 'ents' from un
-00010d40: 636f 6d6d 6974 7465 6420 7369 7a65 2e0a  committed size..
-00010d50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010d60: 6465 6620 6263 6173 745f 6170 7065 6e64  def bcast_append
-00010d70: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00010d80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010d90: 2020 2020 5365 6e64 7320 5250 432c 2077      Sends RPC, w
-00010da0: 6974 6820 656e 7472 6965 7320 746f 2061  ith entries to a
-00010db0: 6c6c 2070 6565 7273 2074 6861 7420 6172  ll peers that ar
-00010dc0: 6520 6e6f 7420 7570 2d74 6f2d 6461 7465  e not up-to-date
-00010dd0: 0a20 2020 2020 2020 2061 6363 6f72 6469  .        accordi
-00010de0: 6e67 2074 6f20 7468 6520 7072 6f67 7265  ng to the progre
-00010df0: 7373 2072 6563 6f72 6465 6420 696e 2072  ss recorded in r
-00010e00: 2e70 7273 2829 2e0a 2020 2020 2020 2020  .prs()..        
-00010e10: 2222 220a 2020 2020 6465 6620 6263 6173  """.    def bcas
-00010e20: 745f 6865 6172 7462 6561 7428 7365 6c66  t_heartbeat(self
-00010e30: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00010e40: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
-00010e50: 656e 6473 2052 5043 2c20 7769 7468 6f75  ends RPC, withou
-00010e60: 7420 656e 7472 6965 7320 746f 2061 6c6c  t entries to all
-00010e70: 2074 6865 2070 6565 7273 2e0a 2020 2020   the peers..    
-00010e80: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00010e90: 7368 6f75 6c64 5f62 6361 7374 5f63 6f6d  should_bcast_com
-00010ea0: 6d69 7428 7365 6c66 2920 2d3e 2062 6f6f  mit(self) -> boo
-00010eb0: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
-00010ec0: 2020 2020 2020 2053 7065 6369 6669 6573         Specifies
-00010ed0: 2069 6620 7468 6520 636f 6d6d 6974 2073   if the commit s
-00010ee0: 686f 756c 6420 6265 2062 726f 6164 6361  hould be broadca
-00010ef0: 7374 2e0a 2020 2020 2020 2020 2222 220a  st..        """.
-00010f00: 2020 2020 6465 6620 736b 6970 5f62 6361      def skip_bca
-00010f10: 7374 5f63 6f6d 6d69 7428 7365 6c66 2c20  st_commit(self, 
-00010f20: 736b 6970 3a20 626f 6f6c 2920 2d3e 204e  skip: bool) -> N
-00010f30: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00010f40: 0a20 2020 2020 2020 2053 6574 2077 6865  .        Set whe
-00010f50: 7468 6572 2073 6b69 7020 6272 6f61 6463  ther skip broadc
-00010f60: 6173 7420 656d 7074 7920 636f 6d6d 6974  ast empty commit
-00010f70: 206d 6573 7361 6765 7320 6174 2072 756e   messages at run
-00010f80: 7469 6d65 2e0a 2020 2020 2020 2020 2222  time..        ""
-00010f90: 220a 2020 2020 6465 6620 6265 636f 6d65  ".    def become
-00010fa0: 5f6c 6561 6465 7228 7365 6c66 2920 2d3e  _leader(self) ->
-00010fb0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00010fc0: 2222 0a20 2020 2020 2020 204d 616b 6573  "".        Makes
-00010fd0: 2074 6869 7320 7261 6674 2074 6865 206c   this raft the l
-00010fe0: 6561 6465 722e 0a0a 2020 2020 2020 2020  eader...        
-00010ff0: 2320 5061 6e69 6373 0a0a 2020 2020 2020  # Panics..      
-00011000: 2020 5061 6e69 6373 2069 6620 7468 6973    Panics if this
-00011010: 2069 7320 6120 666f 6c6c 6f77 6572 206e   is a follower n
-00011020: 6f64 652e 0a20 2020 2020 2020 2022 2222  ode..        """
-00011030: 0a20 2020 2064 6566 2062 6563 6f6d 655f  .    def become_
-00011040: 666f 6c6c 6f77 6572 2873 656c 662c 2074  follower(self, t
-00011050: 6572 6d3a 2069 6e74 2c20 6c65 6164 6572  erm: int, leader
-00011060: 5f69 643a 2069 6e74 2920 2d3e 204e 6f6e  _id: int) -> Non
-00011070: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00011080: 2020 2020 2020 2043 6f6e 7665 7274 7320         Converts 
-00011090: 7468 6973 206e 6f64 6520 746f 2061 2066  this node to a f
-000110a0: 6f6c 6c6f 7765 722e 0a20 2020 2020 2020  ollower..       
-000110b0: 2022 2222 0a20 2020 2064 6566 2062 6563   """.    def bec
-000110c0: 6f6d 655f 7072 655f 6361 6e64 6964 6174  ome_pre_candidat
-000110d0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-000110e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000110f0: 2020 2020 2043 6f6e 7665 7274 7320 7468       Converts th
-00011100: 6973 206e 6f64 6520 746f 2061 2070 7265  is node to a pre
-00011110: 2d63 616e 6469 6461 7465 0a0a 2020 2020  -candidate..    
-00011120: 2020 2020 2320 5061 6e69 6373 0a0a 2020      # Panics..  
-00011130: 2020 2020 2020 5061 6e69 6373 2069 6620        Panics if 
-00011140: 6120 6c65 6164 6572 2061 6c72 6561 6479  a leader already
-00011150: 2065 7869 7374 732e 0a20 2020 2020 2020   exists..       
-00011160: 2022 2222 0a20 2020 2064 6566 2062 6563   """.    def bec
-00011170: 6f6d 655f 6361 6e64 6964 6174 6528 7365  ome_candidate(se
-00011180: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00011190: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000111a0: 2043 6f6e 7665 7274 7320 7468 6973 206e   Converts this n
-000111b0: 6f64 6520 746f 2061 2063 616e 6469 6461  ode to a candida
-000111c0: 7465 0a0a 2020 2020 2020 2020 2320 5061  te..        # Pa
-000111d0: 6e69 6373 0a0a 2020 2020 2020 2020 5061  nics..        Pa
-000111e0: 6e69 6373 2069 6620 6120 6c65 6164 6572  nics if a leader
-000111f0: 2061 6c72 6561 6479 2065 7869 7374 732e   already exists.
-00011200: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011210: 2064 6566 2068 6561 7274 6265 6174 5f74   def heartbeat_t
-00011220: 696d 656f 7574 2873 656c 6629 202d 3e20  imeout(self) -> 
-00011230: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-00011240: 0a20 2020 2020 2020 2046 6574 6368 2074  .        Fetch t
-00011250: 6865 206c 656e 6774 6820 6f66 2074 6865  he length of the
-00011260: 2068 6561 7274 6265 6174 2074 696d 656f   heartbeat timeo
-00011270: 7574 0a20 2020 2020 2020 2022 2222 0a20  ut.        """. 
-00011280: 2020 2064 6566 2068 6561 7274 6265 6174     def heartbeat
-00011290: 5f65 6c61 7073 6564 2873 656c 6629 202d  _elapsed(self) -
-000112a0: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-000112b0: 2222 0a20 2020 2020 2020 2046 6574 6368  "".        Fetch
-000112c0: 2074 6865 206e 756d 6265 7220 6f66 2074   the number of t
-000112d0: 6963 6b73 2065 6c61 7073 6564 2073 696e  icks elapsed sin
-000112e0: 6365 206c 6173 7420 6865 6172 7462 6561  ce last heartbea
-000112f0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-00011300: 2020 2064 6566 2065 6c65 6374 696f 6e5f     def election_
-00011310: 7469 6d65 6f75 7428 7365 6c66 2920 2d3e  timeout(self) ->
-00011320: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-00011330: 220a 2020 2020 2020 2020 4665 7463 6820  ".        Fetch 
-00011340: 7468 6520 6c65 6e67 7468 206f 6620 7468  the length of th
-00011350: 6520 656c 6563 7469 6f6e 2074 696d 656f  e election timeo
-00011360: 7574 2e0a 2020 2020 2020 2020 2222 220a  ut..        """.
-00011370: 2020 2020 6465 6620 7261 6e64 6f6d 697a      def randomiz
-00011380: 6564 5f65 6c65 6374 696f 6e5f 7469 6d65  ed_election_time
-00011390: 6f75 7428 7365 6c66 2920 2d3e 2069 6e74  out(self) -> int
-000113a0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000113b0: 2020 2020 2020 5265 7475 726e 2074 6865        Return the
-000113c0: 206c 656e 6774 6820 6f66 2074 6865 2063   length of the c
-000113d0: 7572 7265 6e74 2072 616e 646f 6d69 7a65  urrent randomize
-000113e0: 6420 656c 6563 7469 6f6e 2074 696d 656f  d election timeo
-000113f0: 7574 2e0a 2020 2020 2020 2020 2222 220a  ut..        """.
-00011400: 2020 2020 6465 6620 7365 745f 7261 6e64      def set_rand
-00011410: 6f6d 697a 6564 5f65 6c65 6374 696f 6e5f  omized_election_
-00011420: 7469 6d65 6f75 7428 7365 6c66 2c20 7261  timeout(self, ra
-00011430: 6e64 6f6d 697a 6564 5f65 6c65 6374 696f  ndomized_electio
-00011440: 6e5f 7469 6d65 6f75 743a 2069 6e74 2920  n_timeout: int) 
-00011450: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00011460: 2022 2222 0a20 2020 2020 2020 2046 6f72   """.        For
-00011470: 2074 6573 7469 6e67 206c 6561 6465 7220   testing leader 
-00011480: 6c65 6173 650a 2020 2020 2020 2020 2222  lease.        ""
-00011490: 220a 2020 2020 6465 6620 7265 7365 745f  ".    def reset_
-000114a0: 7261 6e64 6f6d 697a 6564 5f65 6c65 6374  randomized_elect
-000114b0: 696f 6e5f 7469 6d65 6f75 7428 7365 6c66  ion_timeout(self
-000114c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000114d0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-000114e0: 6567 656e 6572 6174 6573 2061 6e64 2073  egenerates and s
-000114f0: 746f 7265 7320 7468 6520 656c 6563 7469  tores the electi
-00011500: 6f6e 2074 696d 656f 7574 2e0a 2020 2020  on timeout..    
-00011510: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00011520: 7061 7373 5f65 6c65 6374 696f 6e5f 7469  pass_election_ti
-00011530: 6d65 6f75 7428 7365 6c66 2920 2d3e 2062  meout(self) -> b
-00011540: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-00011550: 0a20 2020 2020 2020 2060 7061 7373 5f65  .        `pass_e
-00011560: 6c65 6374 696f 6e5f 7469 6d65 6f75 7460  lection_timeout`
-00011570: 2072 6574 7572 6e73 2074 7275 6520 6966   returns true if
-00011580: 2060 656c 6563 7469 6f6e 5f65 6c61 7073   `election_elaps
-00011590: 6564 6020 6973 2067 7265 6174 6572 0a20  ed` is greater. 
-000115a0: 2020 2020 2020 2074 6861 6e20 6f72 2065         than or e
-000115b0: 7175 616c 2074 6f20 7468 6520 7261 6e64  qual to the rand
-000115c0: 6f6d 697a 6564 2065 6c65 6374 696f 6e20  omized election 
-000115d0: 7469 6d65 6f75 7420 696e 0a20 2020 2020  timeout in.     
-000115e0: 2020 205b 6065 6c65 6374 696f 6e5f 7469     [`election_ti
-000115f0: 6d65 6f75 7460 2c20 3220 2a20 6065 6c65  meout`, 2 * `ele
-00011600: 6374 696f 6e5f 7469 6d65 6f75 7460 202d  ction_timeout` -
-00011610: 2031 5d2e 0a20 2020 2020 2020 2022 2222   1]..        """
-00011620: 0a20 2020 2064 6566 2073 656e 645f 7469  .    def send_ti
-00011630: 6d65 6f75 745f 6e6f 7728 7365 6c66 2c20  meout_now(self, 
-00011640: 746f 3a20 696e 7429 202d 3e20 4e6f 6e65  to: int) -> None
-00011650: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00011660: 2020 2020 2020 4973 7375 6573 2061 206d        Issues a m
-00011670: 6573 7361 6765 2074 6f20 7469 6d65 6f75  essage to timeou
-00011680: 7420 696d 6d65 6469 6174 656c 792e 0a20  t immediately.. 
-00011690: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-000116a0: 6566 2072 6561 6479 5f72 6561 645f 636f  ef ready_read_co
-000116b0: 756e 7428 7365 6c66 2920 2d3e 2069 6e74  unt(self) -> int
-000116c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000116d0: 2020 2020 2020 5265 7475 726e 7320 686f        Returns ho
-000116e0: 7720 6d61 6e79 2072 6561 6420 7374 6174  w many read stat
-000116f0: 6573 2065 7869 7374 2e0a 2020 2020 2020  es exist..      
-00011700: 2020 2222 220a 2020 2020 6465 6620 7065    """.    def pe
-00011710: 6e64 696e 675f 7265 6164 5f63 6f75 6e74  nding_read_count
-00011720: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
-00011730: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011740: 2020 2052 6574 7572 6e73 2074 6865 206e     Returns the n
-00011750: 756d 6265 7220 6f66 2070 656e 6469 6e67  umber of pending
-00011760: 2072 6561 642d 6f6e 6c79 206d 6573 7361   read-only messa
-00011770: 6765 732e 0a20 2020 2020 2020 2022 2222  ges..        """
-00011780: 0a20 2020 2064 6566 206c 6f61 645f 7374  .    def load_st
-00011790: 6174 6528 7365 6c66 2c20 6873 3a20 2248  ate(self, hs: "H
-000117a0: 6172 6453 7461 7465 2220 7c20 2248 6172  ardState" | "Har
-000117b0: 6453 7461 7465 5265 6622 2920 2d3e 204e  dStateRef") -> N
-000117c0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000117d0: 0a20 2020 2020 2020 2046 6f72 2061 2067  .        For a g
-000117e0: 6976 656e 2068 6172 6473 7461 7465 2c20  iven hardstate, 
-000117f0: 6c6f 6164 2074 6865 2073 7461 7465 2069  load the state i
-00011800: 6e74 6f20 7365 6c66 2e0a 2020 2020 2020  nto self..      
-00011810: 2020 2222 220a 2020 2020 6465 6620 736f    """.    def so
-00011820: 6674 5f73 7461 7465 2873 656c 6629 202d  ft_state(self) -
-00011830: 3e20 2253 6f66 7453 7461 7465 223a 0a20  > "SoftState":. 
-00011840: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011850: 2020 2052 6574 7572 6e73 2061 2076 616c     Returns a val
-00011860: 7565 2072 6570 7265 7365 6e74 696e 6720  ue representing 
-00011870: 7468 6520 736f 6674 7374 6174 6520 6174  the softstate at
-00011880: 2074 6865 2074 696d 6520 6f66 2063 616c   the time of cal
-00011890: 6c69 6e67 2e0a 2020 2020 2020 2020 2222  ling..        ""
-000118a0: 220a 2020 2020 6465 6620 6861 7264 5f73  ".    def hard_s
-000118b0: 7461 7465 2873 656c 6629 202d 3e20 2248  tate(self) -> "H
-000118c0: 6172 6453 7461 7465 223a 0a20 2020 2020  ardState":.     
-000118d0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-000118e0: 6574 7572 6e73 2061 2076 616c 7565 2072  eturns a value r
-000118f0: 6570 7265 7365 6e74 696e 6720 7468 6520  epresenting the 
-00011900: 6861 7264 7374 6174 6520 6174 2074 6865  hardstate at the
-00011910: 2074 696d 6520 6f66 2063 616c 6c69 6e67   time of calling
-00011920: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00011930: 2020 6465 6620 7069 6e67 2873 656c 6629    def ping(self)
-00011940: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00011950: 2020 2222 220a 2020 2020 2020 2020 4272    """.        Br
-00011960: 6f61 6463 6173 7473 2068 6561 7274 6265  oadcasts heartbe
-00011970: 6174 7320 746f 2061 6c6c 2074 6865 2066  ats to all the f
-00011980: 6f6c 6c6f 7765 7273 2069 6620 6974 2773  ollowers if it's
-00011990: 206c 6561 6465 722e 0a20 2020 2020 2020   leader..       
-000119a0: 2022 2222 0a20 2020 2064 6566 2074 6963   """.    def tic
-000119b0: 6b28 7365 6c66 2920 2d3e 2062 6f6f 6c3a  k(self) -> bool:
-000119c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000119d0: 2020 2020 2052 6574 7572 6e73 2074 7275       Returns tru
-000119e0: 6520 746f 2069 6e64 6963 6174 6520 7468  e to indicate th
-000119f0: 6174 2074 6865 7265 2077 696c 6c20 7072  at there will pr
-00011a00: 6f62 6162 6c79 2062 6520 736f 6d65 2072  obably be some r
-00011a10: 6561 6469 6e65 7373 206e 6565 6420 746f  eadiness need to
-00011a20: 2062 6520 6861 6e64 6c65 642e 0a20 2020   be handled..   
-00011a30: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00011a40: 2074 6963 6b5f 656c 6563 7469 6f6e 2873   tick_election(s
-00011a50: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
-00011a60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00011a70: 2020 5275 6e20 6279 2066 6f6c 6c6f 7765    Run by followe
-00011a80: 7273 2061 6e64 2063 616e 6469 6461 7465  rs and candidate
-00011a90: 7320 6166 7465 7220 7365 6c66 2e65 6c65  s after self.ele
-00011aa0: 6374 696f 6e5f 7469 6d65 6f75 742e 0a0a  ction_timeout...
-00011ab0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-00011ac0: 7472 7565 2074 6f20 696e 6469 6361 7465  true to indicate
-00011ad0: 2074 6861 7420 7468 6572 6520 7769 6c6c   that there will
-00011ae0: 2070 726f 6261 626c 7920 6265 2073 6f6d   probably be som
-00011af0: 6520 7265 6164 696e 6573 7320 6e65 6564  e readiness need
-00011b00: 2074 6f20 6265 2068 616e 646c 6564 2e0a   to be handled..
-00011b10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011b20: 6465 6620 7374 6570 2873 656c 662c 206d  def step(self, m
-00011b30: 7367 3a20 224d 6573 7361 6765 2220 7c20  sg: "Message" | 
-00011b40: 224d 6573 7361 6765 5265 6622 2920 2d3e  "MessageRef") ->
-00011b50: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00011b60: 2222 0a20 2020 2020 2020 2053 7465 7073  "".        Steps
-00011b70: 2074 6865 2072 6166 7420 616c 6f6e 6720   the raft along 
-00011b80: 7669 6120 6120 6d65 7373 6167 652e 2054  via a message. T
-00011b90: 6869 7320 7368 6f75 6c64 2062 6520 6361  his should be ca
-00011ba0: 6c6c 6564 2065 7665 7279 7469 6d65 2079  lled everytime y
-00011bb0: 6f75 7220 7261 6674 2072 6563 6569 7665  our raft receive
-00011bc0: 7320 610a 2020 2020 2020 2020 6d65 7373  s a.        mess
-00011bd0: 6167 6520 6672 6f6d 2061 2070 6565 722e  age from a peer.
-00011be0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011bf0: 2064 6566 2068 6173 5f70 656e 6469 6e67   def has_pending
-00011c00: 5f63 6f6e 6628 7365 6c66 2920 2d3e 2062  _conf(self) -> b
-00011c10: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-00011c20: 0a20 2020 2020 2020 2043 6865 636b 2069  .        Check i
-00011c30: 6620 7468 6572 6520 6973 2061 6e79 2070  f there is any p
-00011c40: 656e 6469 6e67 2063 6f6e 6663 6861 6e67  ending confchang
-00011c50: 652e 0a0a 2020 2020 2020 2020 5468 6973  e...        This
-00011c60: 206d 6574 686f 6420 6361 6e20 6265 2066   method can be f
-00011c70: 616c 7365 2070 6f73 6974 6976 652e 0a20  alse positive.. 
-00011c80: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00011c90: 6566 2070 726f 6d6f 7461 626c 6528 7365  ef promotable(se
-00011ca0: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
-00011cb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00011cc0: 2049 6e64 6963 6174 6573 2077 6865 7468   Indicates wheth
-00011cd0: 6572 2073 7461 7465 206d 6163 6869 6e65  er state machine
-00011ce0: 2063 616e 2062 6520 7072 6f6d 6f74 6564   can be promoted
-00011cf0: 2074 6f20 6c65 6164 6572 2c0a 2020 2020   to leader,.    
-00011d00: 2020 2020 7768 6963 6820 6973 2074 7275      which is tru
-00011d10: 6520 7768 656e 2069 7427 7320 6120 766f  e when it's a vo
-00011d20: 7465 7220 616e 6420 6974 7320 6f77 6e20  ter and its own 
-00011d30: 6964 2069 7320 696e 2070 726f 6772 6573  id is in progres
-00011d40: 7320 6c69 7374 2e0a 2020 2020 2020 2020  s list..        
-00011d50: 2222 220a 2020 2020 6465 6620 706f 7374  """.    def post
-00011d60: 5f63 6f6e 665f 6368 616e 6765 2873 656c  _conf_change(sel
-00011d70: 6629 202d 3e20 2243 6f6e 6653 7461 7465  f) -> "ConfState
-00011d80: 5265 6622 3a0a 2020 2020 2020 2020 2222  Ref":.        ""
-00011d90: 220a 2020 2020 2020 2020 5570 6461 7465  ".        Update
-00011da0: 7320 7468 6520 696e 2d6d 656d 6f72 7920  s the in-memory 
-00011db0: 7374 6174 6520 616e 642c 2077 6865 6e20  state and, when 
-00011dc0: 6e65 6365 7373 6172 792c 2063 6172 7269  necessary, carri
-00011dd0: 6573 206f 7574 2061 6464 6974 696f 6e61  es out additiona
-00011de0: 6c20 6163 7469 6f6e 730a 2020 2020 2020  l actions.      
-00011df0: 2020 7375 6368 2061 7320 7265 6163 7469    such as reacti
-00011e00: 6e67 2074 6f20 7468 6520 7265 6d6f 7661  ng to the remova
-00011e10: 6c20 6f66 206e 6f64 6573 206f 7220 6368  l of nodes or ch
-00011e20: 616e 6765 6420 7175 6f72 756d 2072 6571  anged quorum req
-00011e30: 7569 7265 6d65 6e74 732e 0a20 2020 2020  uirements..     
-00011e40: 2020 2022 2222 0a20 2020 2064 6566 2069     """.    def i
-00011e50: 6e5f 6c65 6173 6528 7365 6c66 2920 2d3e  n_lease(self) ->
-00011e60: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
-00011e70: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-00011e80: 6e73 2077 6865 7468 6572 2074 6865 2063  ns whether the c
-00011e90: 7572 7265 6e74 2072 6166 7420 6973 2069  urrent raft is i
-00011ea0: 6e20 6c65 6173 652e 0a20 2020 2020 2020  n lease..       
-00011eb0: 2022 2222 0a20 2020 2064 6566 2068 616e   """.    def han
-00011ec0: 646c 655f 6865 6172 7462 6561 7428 7365  dle_heartbeat(se
-00011ed0: 6c66 2c20 6d73 673a 2022 4d65 7373 6167  lf, msg: "Messag
-00011ee0: 6522 207c 2022 4d65 7373 6167 6552 6566  e" | "MessageRef
-00011ef0: 2229 202d 3e20 4e6f 6e65 3a0a 2020 2020  ") -> None:.    
-00011f00: 2020 2020 2222 2246 6f72 2061 206d 6573      """For a mes
-00011f10: 7361 6765 2c20 636f 6d6d 6974 2061 6e64  sage, commit and
-00011f20: 2073 656e 6420 6f75 7420 6865 6172 7462   send out heartb
-00011f30: 6561 742e 2222 220a 2020 2020 6465 6620  eat.""".    def 
-00011f40: 6861 6e64 6c65 5f61 7070 656e 645f 656e  handle_append_en
-00011f50: 7472 6965 7328 7365 6c66 2c20 6d73 673a  tries(self, msg:
-00011f60: 2022 4d65 7373 6167 6522 207c 2022 4d65   "Message" | "Me
-00011f70: 7373 6167 6552 6566 2229 202d 3e20 4e6f  ssageRef") -> No
-00011f80: 6e65 3a0a 2020 2020 2020 2020 2222 2246  ne:.        """F
-00011f90: 6f72 2061 2067 6976 656e 206d 6573 7361  or a given messa
-00011fa0: 6765 2c20 6170 7065 6e64 2074 6865 2065  ge, append the e
-00011fb0: 6e74 7269 6573 2074 6f20 7468 6520 6c6f  ntries to the lo
-00011fc0: 672e 2222 220a 2020 2020 6465 6620 7265  g.""".    def re
-00011fd0: 7175 6573 745f 736e 6170 7368 6f74 2873  quest_snapshot(s
-00011fe0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00011ff0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00012000: 2020 5265 7175 6573 7420 6120 736e 6170    Request a snap
-00012010: 7368 6f74 2066 726f 6d20 6120 6c65 6164  shot from a lead
-00012020: 6572 2e0a 2020 2020 2020 2020 2222 220a  er..        """.
-00012030: 2020 2020 6465 6620 7072 7328 7365 6c66      def prs(self
-00012040: 2920 2d3e 2022 5072 6f67 7265 7373 5472  ) -> "ProgressTr
-00012050: 6163 6b65 7252 6566 223a 0a20 2020 2020  ackerRef":.     
-00012060: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-00012070: 6574 7572 6e73 2061 2072 6561 642d 6f6e  eturns a read-on
-00012080: 6c79 2072 6566 6572 656e 6365 2074 6f20  ly reference to 
-00012090: 7468 6520 7072 6f67 7265 7373 2073 6574  the progress set
-000120a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000120b0: 2020 6465 6620 7265 7365 7428 7365 6c66    def reset(self
-000120c0: 2c20 7465 726d 3a20 696e 7429 202d 3e20  , term: int) -> 
-000120d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000120e0: 220a 2020 2020 2020 2020 5265 7365 7473  ".        Resets
-000120f0: 2074 6865 2063 7572 7265 6e74 206e 6f64   the current nod
-00012100: 6520 746f 2061 2067 6976 656e 2074 6572  e to a given ter
-00012110: 6d2e 0a20 2020 2020 2020 2022 2222 0a20  m..        """. 
-00012120: 2020 2064 6566 2072 6573 746f 7265 2873     def restore(s
-00012130: 656c 662c 2073 6e61 7073 686f 743a 2022  elf, snapshot: "
-00012140: 536e 6170 7368 6f74 2220 7c20 2253 6e61  Snapshot" | "Sna
-00012150: 7073 686f 7452 6566 2229 202d 3e20 626f  pshotRef") -> bo
-00012160: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
-00012170: 2020 2020 2020 2020 5265 636f 7665 7273          Recovers
-00012180: 2074 6865 2073 7461 7465 206d 6163 6869   the state machi
-00012190: 6e65 2066 726f 6d20 6120 736e 6170 7368  ne from a snapsh
-000121a0: 6f74 2e20 4974 2072 6573 746f 7265 7320  ot. It restores 
-000121b0: 7468 6520 6c6f 6720 616e 6420 7468 650a  the log and the.
-000121c0: 2020 2020 2020 2020 636f 6e66 6967 7572          configur
-000121d0: 6174 696f 6e20 6f66 2073 7461 7465 206d  ation of state m
-000121e0: 6163 6869 6e65 2e0a 2020 2020 2020 2020  achine..        
-000121f0: 2222 220a 2020 2020 6465 6620 736e 6170  """.    def snap
-00012200: 2873 656c 6629 202d 3e20 4f70 7469 6f6e  (self) -> Option
-00012210: 616c 5b22 536e 6170 7368 6f74 5265 6622  al["SnapshotRef"
-00012220: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-00012230: 2020 2020 2020 2047 7261 6273 2061 2072         Grabs a r
-00012240: 6566 6572 656e 6365 2074 6f20 7468 6520  eference to the 
-00012250: 736e 6170 7368 6f74 0a20 2020 2020 2020  snapshot.       
-00012260: 2022 2222 0a20 2020 2064 6566 2073 746f   """.    def sto
-00012270: 7265 2873 656c 6629 202d 3e20 224d 656d  re(self) -> "Mem
-00012280: 5374 6f72 6167 6552 6566 223a 0a20 2020  StorageRef":.   
-00012290: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000122a0: 2047 7261 6273 2061 6e20 696d 6d75 7461   Grabs an immuta
-000122b0: 626c 6520 7265 6665 7265 6e63 6520 746f  ble reference to
-000122c0: 2074 6865 2073 746f 7265 2e0a 2020 2020   the store..    
-000122d0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-000122e0: 6f6e 5f70 6572 7369 7374 5f73 6e61 7028  on_persist_snap(
-000122f0: 7365 6c66 2c20 696e 6465 783a 2069 6e74  self, index: int
-00012300: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00012310: 2020 2022 2222 0a20 2020 2020 2020 204e     """.        N
-00012320: 6f74 6966 6965 7320 7468 6174 2074 6865  otifies that the
-00012330: 2073 6e61 7073 686f 7420 6861 7665 2062   snapshot have b
-00012340: 6565 6e20 7065 7273 6973 7465 642e 0a20  een persisted.. 
-00012350: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00012360: 6566 2061 626f 7274 5f6c 6561 6465 725f  ef abort_leader_
-00012370: 7472 616e 7366 6572 2873 656c 6629 202d  transfer(self) -
-00012380: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00012390: 2222 220a 2020 2020 2020 2020 5374 6f70  """.        Stop
-000123a0: 7320 7468 6520 7472 616e 7366 6572 206f  s the transfer o
-000123b0: 6620 6120 6c65 6164 6572 2e0a 2020 2020  f a leader..    
-000123c0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-000123d0: 6361 6d70 6169 676e 2873 656c 662c 2074  campaign(self, t
-000123e0: 7970 3a20 7374 7229 202d 3e20 4e6f 6e65  yp: str) -> None
-000123f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00012400: 2020 2020 2020 4361 6d70 6169 676e 2074        Campaign t
-00012410: 6f20 6174 7465 6d70 7420 746f 2062 6563  o attempt to bec
-00012420: 6f6d 6520 6120 6c65 6164 6572 2e0a 0a20  ome a leader... 
-00012430: 2020 2020 2020 2049 6620 7072 6576 6f74         If prevot
-00012440: 6520 6973 2065 6e61 626c 6564 2c20 7468  e is enabled, th
-00012450: 6973 2069 7320 6861 6e64 6c65 6420 6173  is is handled as
-00012460: 2077 656c 6c2e 0a20 2020 2020 2020 2022   well..        "
-00012470: 2222 0a20 2020 2064 6566 2067 6574 5f6c  "".    def get_l
-00012480: 6561 645f 7472 616e 7366 6572 6565 2873  ead_transferee(s
-00012490: 656c 6629 202d 3e20 4f70 7469 6f6e 616c  elf) -> Optional
-000124a0: 5b69 6e74 5d3a 0a20 2020 2020 2020 2022  [int]:.        "
-000124b0: 2222 0a20 2020 2020 2020 2060 6c65 6164  "".        `lead
-000124c0: 5f74 7261 6e73 6665 7265 6560 3a20 4944  _transferee`: ID
-000124d0: 206f 6620 7468 6520 6c65 6164 6572 2074   of the leader t
-000124e0: 7261 6e73 6665 7220 7461 7267 6574 2077  ransfer target w
-000124f0: 6865 6e20 6974 7320 7661 6c75 6520 6973  hen its value is
-00012500: 206e 6f74 204e 6f6e 652e 0a0a 2020 2020   not None...    
-00012510: 2020 2020 4966 2074 6869 7320 6973 2053      If this is S
-00012520: 6f6d 6528 6964 292c 2077 6520 666f 6c6c  ome(id), we foll
-00012530: 6f77 2074 6865 2070 726f 6365 6475 7265  ow the procedure
-00012540: 2064 6566 696e 6564 2069 6e20 7261 6674   defined in raft
-00012550: 2074 6865 7369 7320 332e 3130 2e0a 2020   thesis 3.10..  
-00012560: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-00012570: 6620 7365 745f 6c65 6164 5f74 7261 6e73  f set_lead_trans
-00012580: 6665 7265 6528 7365 6c66 2c20 6c65 6164  feree(self, lead
-00012590: 5f74 7261 6e73 6665 7265 653a 2069 6e74  _transferee: int
-000125a0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000125b0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-000125c0: 6c65 6164 5f74 7261 6e73 6665 7265 6560  lead_transferee`
-000125d0: 3a20 4944 206f 6620 7468 6520 6c65 6164  : ID of the lead
-000125e0: 6572 2074 7261 6e73 6665 7220 7461 7267  er transfer targ
-000125f0: 6574 2077 6865 6e20 6974 7320 7661 6c75  et when its valu
-00012600: 6520 6973 206e 6f74 204e 6f6e 652e 0a0a  e is not None...
-00012610: 2020 2020 2020 2020 4966 2074 6869 7320          If this 
-00012620: 6973 2053 6f6d 6528 6964 292c 2077 6520  is Some(id), we 
-00012630: 666f 6c6c 6f77 2074 6865 2070 726f 6365  follow the proce
-00012640: 6475 7265 2064 6566 696e 6564 2069 6e20  dure defined in 
-00012650: 7261 6674 2074 6865 7369 7320 332e 3130  raft thesis 3.10
-00012660: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00012670: 2020 6465 6620 6765 745f 7465 726d 2873    def get_term(s
-00012680: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
-00012690: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000126a0: 2060 7465 726d 603a 2054 6865 2063 7572   `term`: The cur
-000126b0: 7265 6e74 2065 6c65 6374 696f 6e20 7465  rent election te
-000126c0: 726d 2e0a 2020 2020 2020 2020 2222 220a  rm..        """.
-000126d0: 2020 2020 6465 6620 7365 745f 7465 726d      def set_term
-000126e0: 2873 656c 662c 2074 6572 6d3a 2069 6e74  (self, term: int
-000126f0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00012700: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00012710: 7465 726d 603a 2054 6865 2063 7572 7265  term`: The curre
-00012720: 6e74 2065 6c65 6374 696f 6e20 7465 726d  nt election term
-00012730: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00012740: 2020 6465 6620 6765 745f 766f 7465 2873    def get_vote(s
-00012750: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
-00012760: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012770: 2060 766f 7465 603a 2057 6869 6368 2070   `vote`: Which p
-00012780: 6565 7220 7468 6973 2072 6166 7420 6973  eer this raft is
-00012790: 2076 6f74 696e 6720 666f 722e 0a20 2020   voting for..   
-000127a0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-000127b0: 2073 6574 5f76 6f74 6528 7365 6c66 2c20   set_vote(self, 
-000127c0: 766f 7465 3a20 696e 7429 202d 3e20 4e6f  vote: int) -> No
-000127d0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-000127e0: 2020 2020 2020 2020 6076 6f74 6560 3a20          `vote`: 
-000127f0: 5768 6963 6820 7065 6572 2074 6869 7320  Which peer this 
-00012800: 7261 6674 2069 7320 766f 7469 6e67 2066  raft is voting f
-00012810: 6f72 2e0a 2020 2020 2020 2020 2222 220a  or..        """.
-00012820: 2020 2020 6465 6620 6765 745f 7072 696f      def get_prio
-00012830: 7269 7479 2873 656c 6629 202d 3e20 696e  rity(self) -> in
-00012840: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-00012850: 2020 2020 2020 2060 7072 696f 7269 7479         `priority
-00012860: 603a 2054 6865 2065 6c65 6374 696f 6e20  `: The election 
-00012870: 7072 696f 7269 7479 206f 6620 7468 6973  priority of this
-00012880: 206e 6f64 652e 0a20 2020 2020 2020 2022   node..        "
-00012890: 2222 0a20 2020 2064 6566 2073 6574 5f70  "".    def set_p
-000128a0: 7269 6f72 6974 7928 7365 6c66 2c20 7072  riority(self, pr
-000128b0: 696f 7269 7479 3a20 696e 7429 202d 3e20  iority: int) -> 
-000128c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000128d0: 220a 2020 2020 2020 2020 6070 7269 6f72  ".        `prior
-000128e0: 6974 7960 3a20 5468 6520 656c 6563 7469  ity`: The electi
-000128f0: 6f6e 2070 7269 6f72 6974 7920 6f66 2074  on priority of t
-00012900: 6869 7320 6e6f 6465 2e0a 2020 2020 2020  his node..      
-00012910: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
-00012920: 745f 6c65 6164 6572 5f69 6428 7365 6c66  t_leader_id(self
-00012930: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-00012940: 2020 2222 220a 2020 2020 2020 2020 606c    """.        `l
-00012950: 6561 6465 725f 6964 603a 2054 6865 206c  eader_id`: The l
-00012960: 6561 6465 7220 6964 0a20 2020 2020 2020  eader id.       
-00012970: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-00012980: 5f6c 6561 6465 725f 6964 2873 656c 662c  _leader_id(self,
-00012990: 206c 6561 6465 725f 6964 3a20 696e 7429   leader_id: int)
-000129a0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000129b0: 2020 2222 220a 2020 2020 2020 2020 606c    """.        `l
-000129c0: 6561 6465 725f 6964 603a 2054 6865 206c  eader_id`: The l
-000129d0: 6561 6465 7220 6964 0a20 2020 2020 2020  eader id.       
-000129e0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-000129f0: 5f6d 6178 5f6d 7367 5f73 697a 6528 7365  _max_msg_size(se
-00012a00: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00012a10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00012a20: 606d 6178 5f6d 7367 5f73 697a 6560 3a20  `max_msg_size`: 
-00012a30: 5468 6520 6d61 7869 6d75 6d20 6c65 6e67  The maximum leng
-00012a40: 7468 2028 696e 2062 7974 6573 2920 6f66  th (in bytes) of
-00012a50: 2061 6c6c 2074 6865 2065 6e74 7269 6573   all the entries
-00012a60: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00012a70: 2020 6465 6620 7365 745f 6d61 785f 6d73    def set_max_ms
-00012a80: 675f 7369 7a65 2873 656c 662c 206d 6178  g_size(self, max
-00012a90: 5f6d 7367 5f73 697a 653a 2069 6e74 2920  _msg_size: int) 
-00012aa0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00012ab0: 2022 2222 0a20 2020 2020 2020 2060 6d61   """.        `ma
-00012ac0: 785f 6d73 675f 7369 7a65 603a 2054 6865  x_msg_size`: The
-00012ad0: 206d 6178 696d 756d 206c 656e 6774 6820   maximum length 
-00012ae0: 2869 6e20 6279 7465 7329 206f 6620 616c  (in bytes) of al
-00012af0: 6c20 7468 6520 656e 7472 6965 732e 0a20  l the entries.. 
-00012b00: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00012b10: 6566 2067 6574 5f70 656e 6469 6e67 5f63  ef get_pending_c
-00012b20: 6f6e 665f 696e 6465 7828 7365 6c66 2920  onf_index(self) 
-00012b30: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00012b40: 2222 220a 2020 2020 2020 2020 6070 656e  """.        `pen
-00012b50: 6469 6e67 5f63 6f6e 665f 696e 6465 7860  ding_conf_index`
-00012b60: 3a20 4f6e 6c79 206f 6e65 2063 6f6e 6620  : Only one conf 
-00012b70: 6368 616e 6765 206d 6179 2062 6520 7065  change may be pe
-00012b80: 6e64 696e 6720 2869 6e20 7468 6520 6c6f  nding (in the lo
-00012b90: 672c 2062 7574 206e 6f74 2079 6574 0a20  g, but not yet. 
-00012ba0: 2020 2020 2020 2061 7070 6c69 6564 2920         applied) 
-00012bb0: 6174 2061 2074 696d 652e 2054 6869 7320  at a time. This 
-00012bc0: 6973 2065 6e66 6f72 6365 6420 7669 6120  is enforced via 
-00012bd0: 6070 656e 6469 6e67 5f63 6f6e 665f 696e  `pending_conf_in
-00012be0: 6465 7860 2c20 7768 6963 680a 2020 2020  dex`, which.    
-00012bf0: 2020 2020 6973 2073 6574 2074 6f20 6120      is set to a 
-00012c00: 7661 6c75 6520 3e3d 2074 6865 206c 6f67  value >= the log
-00012c10: 2069 6e64 6578 206f 6620 7468 6520 6c61   index of the la
-00012c20: 7465 7374 2070 656e 6469 6e67 0a20 2020  test pending.   
-00012c30: 2020 2020 2063 6f6e 6669 6775 7261 7469       configurati
-00012c40: 6f6e 2063 6861 6e67 6520 2869 6620 616e  on change (if an
-00012c50: 7929 2e20 436f 6e66 6967 2063 6861 6e67  y). Config chang
-00012c60: 6573 2061 7265 206f 6e6c 7920 616c 6c6f  es are only allo
-00012c70: 7765 6420 746f 0a20 2020 2020 2020 2062  wed to.        b
-00012c80: 6520 7072 6f70 6f73 6564 2069 6620 7468  e proposed if th
-00012c90: 6520 6c65 6164 6572 2773 2061 7070 6c69  e leader's appli
-00012ca0: 6564 2069 6e64 6578 2069 7320 6772 6561  ed index is grea
-00012cb0: 7465 7220 7468 616e 2074 6869 730a 2020  ter than this.  
-00012cc0: 2020 2020 2020 7661 6c75 652e 0a0a 2020        value...  
-00012cd0: 2020 2020 2020 5468 6973 2076 616c 7565        This value
-00012ce0: 2069 7320 636f 6e73 6572 7661 7469 7665   is conservative
-00012cf0: 6c79 2073 6574 2069 6e20 6361 7365 7320  ly set in cases 
-00012d00: 7768 6572 6520 7468 6572 6520 6d61 7920  where there may 
-00012d10: 6265 2061 2063 6f6e 6669 6775 7261 7469  be a configurati
-00012d20: 6f6e 2063 6861 6e67 6520 7065 6e64 696e  on change pendin
-00012d30: 672c 0a20 2020 2020 2020 2062 7574 2073  g,.        but s
-00012d40: 6361 6e6e 696e 6720 7468 6520 6c6f 6720  canning the log 
-00012d50: 6973 2070 6f73 7369 626c 7920 6578 7065  is possibly expe
-00012d60: 6e73 6976 652e 2054 6869 7320 696d 706c  nsive. This impl
-00012d70: 6965 7320 7468 6174 2074 6865 2069 6e64  ies that the ind
-00012d80: 6578 2073 7461 7465 6420 6865 7265 206d  ex stated here m
-00012d90: 6179 206e 6f74 0a20 2020 2020 2020 206e  ay not.        n
-00012da0: 6563 6573 7361 7269 6c79 2062 6520 6120  ecessarily be a 
-00012db0: 636f 6e66 6967 2063 6861 6e67 6520 656e  config change en
-00012dc0: 7472 792c 2061 6e64 2069 7420 6d61 7920  try, and it may 
-00012dd0: 6e6f 7420 6265 2061 2060 4265 6769 6e4d  not be a `BeginM
-00012de0: 656d 6265 7273 6869 7043 6861 6e67 6560  embershipChange`
-00012df0: 2065 6e74 7279 2c20 6576 656e 2069 660a   entry, even if.
-00012e00: 2020 2020 2020 2020 7765 2073 6574 2074          we set t
-00012e10: 6869 7320 746f 206f 6e65 2e0a 2020 2020  his to one..    
-00012e20: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00012e30: 7365 745f 7065 6e64 696e 675f 636f 6e66  set_pending_conf
-00012e40: 5f69 6e64 6578 2873 656c 662c 2070 656e  _index(self, pen
-00012e50: 6469 6e67 5f63 6f6e 665f 696e 6465 783a  ding_conf_index:
-00012e60: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
-00012e70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00012e80: 2020 2060 7065 6e64 696e 675f 636f 6e66     `pending_conf
-00012e90: 5f69 6e64 6578 603a 204f 6e6c 7920 6f6e  _index`: Only on
-00012ea0: 6520 636f 6e66 2063 6861 6e67 6520 6d61  e conf change ma
-00012eb0: 7920 6265 2070 656e 6469 6e67 2028 696e  y be pending (in
-00012ec0: 2074 6865 206c 6f67 2c20 6275 7420 6e6f   the log, but no
-00012ed0: 7420 7965 740a 2020 2020 2020 2020 6170  t yet.        ap
-00012ee0: 706c 6965 6429 2061 7420 6120 7469 6d65  plied) at a time
-00012ef0: 2e20 5468 6973 2069 7320 656e 666f 7263  . This is enforc
-00012f00: 6564 2076 6961 2060 7065 6e64 696e 675f  ed via `pending_
-00012f10: 636f 6e66 5f69 6e64 6578 602c 2077 6869  conf_index`, whi
-00012f20: 6368 0a20 2020 2020 2020 2069 7320 7365  ch.        is se
-00012f30: 7420 746f 2061 2076 616c 7565 203e 3d20  t to a value >= 
-00012f40: 7468 6520 6c6f 6720 696e 6465 7820 6f66  the log index of
-00012f50: 2074 6865 206c 6174 6573 7420 7065 6e64   the latest pend
-00012f60: 696e 670a 2020 2020 2020 2020 636f 6e66  ing.        conf
-00012f70: 6967 7572 6174 696f 6e20 6368 616e 6765  iguration change
-00012f80: 2028 6966 2061 6e79 292e 2043 6f6e 6669   (if any). Confi
-00012f90: 6720 6368 616e 6765 7320 6172 6520 6f6e  g changes are on
-00012fa0: 6c79 2061 6c6c 6f77 6564 2074 6f0a 2020  ly allowed to.  
-00012fb0: 2020 2020 2020 6265 2070 726f 706f 7365        be propose
-00012fc0: 6420 6966 2074 6865 206c 6561 6465 7227  d if the leader'
-00012fd0: 7320 6170 706c 6965 6420 696e 6465 7820  s applied index 
-00012fe0: 6973 2067 7265 6174 6572 2074 6861 6e20  is greater than 
-00012ff0: 7468 6973 0a20 2020 2020 2020 2076 616c  this.        val
-00013000: 7565 2e0a 0a20 2020 2020 2020 2054 6869  ue...        Thi
-00013010: 7320 7661 6c75 6520 6973 2063 6f6e 7365  s value is conse
-00013020: 7276 6174 6976 656c 7920 7365 7420 696e  rvatively set in
-00013030: 2063 6173 6573 2077 6865 7265 2074 6865   cases where the
-00013040: 7265 206d 6179 2062 6520 6120 636f 6e66  re may be a conf
-00013050: 6967 7572 6174 696f 6e20 6368 616e 6765  iguration change
-00013060: 2070 656e 6469 6e67 2c0a 2020 2020 2020   pending,.      
-00013070: 2020 6275 7420 7363 616e 6e69 6e67 2074    but scanning t
-00013080: 6865 206c 6f67 2069 7320 706f 7373 6962  he log is possib
-00013090: 6c79 2065 7870 656e 7369 7665 2e20 5468  ly expensive. Th
-000130a0: 6973 2069 6d70 6c69 6573 2074 6861 7420  is implies that 
-000130b0: 7468 6520 696e 6465 7820 7374 6174 6564  the index stated
-000130c0: 2068 6572 6520 6d61 7920 6e6f 740a 2020   here may not.  
-000130d0: 2020 2020 2020 6e65 6365 7373 6172 696c        necessaril
-000130e0: 7920 6265 2061 2063 6f6e 6669 6720 6368  y be a config ch
-000130f0: 616e 6765 2065 6e74 7279 2c20 616e 6420  ange entry, and 
-00013100: 6974 206d 6179 206e 6f74 2062 6520 6120  it may not be a 
-00013110: 6042 6567 696e 4d65 6d62 6572 7368 6970  `BeginMembership
-00013120: 4368 616e 6765 6020 656e 7472 792c 2065  Change` entry, e
-00013130: 7665 6e20 6966 0a20 2020 2020 2020 2077  ven if.        w
-00013140: 6520 7365 7420 7468 6973 2074 6f20 6f6e  e set this to on
-00013150: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00013160: 2020 2064 6566 2067 6574 5f70 656e 6469     def get_pendi
-00013170: 6e67 5f72 6571 7565 7374 5f73 6e61 7073  ng_request_snaps
-00013180: 686f 7428 7365 6c66 2920 2d3e 2069 6e74  hot(self) -> int
-00013190: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000131a0: 2020 2020 2020 6070 656e 6469 6e67 5f72        `pending_r
-000131b0: 6571 7565 7374 5f73 6e61 7073 686f 7460  equest_snapshot`
-000131c0: 3a20 5468 6520 7065 6572 2069 7320 7265  : The peer is re
-000131d0: 7175 6573 7469 6e67 2073 6e61 7073 686f  questing snapsho
-000131e0: 742c 2069 7420 6973 2074 6865 2069 6e64  t, it is the ind
-000131f0: 6578 2074 6861 7420 7468 6520 666f 6c6c  ex that the foll
-00013200: 6f77 6572 0a20 2020 2020 2020 206e 6565  ower.        nee
-00013210: 6473 2069 7420 746f 2062 6520 696e 636c  ds it to be incl
-00013220: 7564 6564 2069 6e20 6120 736e 6170 7368  uded in a snapsh
-00013230: 6f74 2e0a 2020 2020 2020 2020 2222 220a  ot..        """.
-00013240: 2020 2020 6465 6620 7365 745f 7065 6e64      def set_pend
-00013250: 696e 675f 7265 7175 6573 745f 736e 6170  ing_request_snap
-00013260: 7368 6f74 2873 656c 662c 2070 656e 6469  shot(self, pendi
-00013270: 6e67 5f72 6571 7565 7374 5f73 6e61 7073  ng_request_snaps
-00013280: 686f 743a 2069 6e74 2920 2d3e 204e 6f6e  hot: int) -> Non
-00013290: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-000132a0: 2020 2020 2020 2060 7065 6e64 696e 675f         `pending_
-000132b0: 7265 7175 6573 745f 736e 6170 7368 6f74  request_snapshot
-000132c0: 603a 2054 6865 2070 6565 7220 6973 2072  `: The peer is r
-000132d0: 6571 7565 7374 696e 6720 736e 6170 7368  equesting snapsh
-000132e0: 6f74 2c20 6974 2069 7320 7468 6520 696e  ot, it is the in
-000132f0: 6465 7820 7468 6174 2074 6865 2066 6f6c  dex that the fol
-00013300: 6c6f 7765 720a 2020 2020 2020 2020 6e65  lower.        ne
-00013310: 6564 7320 6974 2074 6f20 6265 2069 6e63  eds it to be inc
-00013320: 6c75 6465 6420 696e 2061 2073 6e61 7073  luded in a snaps
-00013330: 686f 742e 0a20 2020 2020 2020 2022 2222  hot..        """
-00013340: 0a20 2020 2064 6566 2067 6574 5f69 6428  .    def get_id(
-00013350: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-00013360: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013370: 2020 6069 6460 3a20 5468 6520 4944 206f    `id`: The ID o
-00013380: 6620 7468 6973 206e 6f64 652e 0a20 2020  f this node..   
-00013390: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-000133a0: 2073 6574 5f69 6428 7365 6c66 2c20 6964   set_id(self, id
-000133b0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-000133c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000133d0: 2020 2020 6069 6460 3a20 5468 6520 4944      `id`: The ID
-000133e0: 206f 6620 7468 6973 206e 6f64 652e 0a20   of this node.. 
-000133f0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00013400: 6566 2067 6574 5f6d 7367 7328 7365 6c66  ef get_msgs(self
-00013410: 2920 2d3e 204c 6973 745b 224d 6573 7361  ) -> List["Messa
-00013420: 6765 5265 6622 5d3a 0a20 2020 2020 2020  geRef"]:.       
-00013430: 2022 2222 0a20 2020 2020 2020 2060 6d73   """.        `ms
-00013440: 6773 603a 2054 6865 206c 6973 7420 6f66  gs`: The list of
-00013450: 206d 6573 7361 6765 732e 0a20 2020 2020   messages..     
-00013460: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
-00013470: 6574 5f6d 7367 7328 7365 6c66 2c20 6d73  et_msgs(self, ms
-00013480: 6773 3a20 4c69 7374 5b22 4d65 7373 6167  gs: List["Messag
-00013490: 6522 207c 2022 4d65 7373 6167 6552 6566  e" | "MessageRef
-000134a0: 225d 2920 2d3e 204e 6f6e 653a 0a20 2020  "]) -> None:.   
-000134b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000134c0: 2060 6d73 6773 603a 2054 6865 206c 6973   `msgs`: The lis
-000134d0: 7420 6f66 206d 6573 7361 6765 732e 0a20  t of messages.. 
-000134e0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-000134f0: 6566 2074 616b 655f 6d73 6773 2873 656c  ef take_msgs(sel
-00013500: 6629 202d 3e20 4c69 7374 5b22 4d65 7373  f) -> List["Mess
-00013510: 6167 6522 5d3a 0a20 2020 2020 2020 2022  age"]:.        "
-00013520: 2222 0a20 2020 2020 2020 2060 6d73 6773  "".        `msgs
-00013530: 603a 2054 6865 206c 6973 7420 6f66 206d  `: The list of m
-00013540: 6573 7361 6765 732e 0a20 2020 2020 2020  essages..       
-00013550: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-00013560: 5f6d 6178 5f69 6e66 6c69 6768 7428 7365  _max_inflight(se
-00013570: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00013580: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00013590: 606d 6178 5f69 6e66 6c69 6768 7460 3a20  `max_inflight`: 
-000135a0: 5468 6520 6d61 7869 6d75 6d20 6e75 6d62  The maximum numb
-000135b0: 6572 206f 6620 6d65 7373 6167 6573 2074  er of messages t
-000135c0: 6861 7420 6361 6e20 6265 2069 6e66 6c69  hat can be infli
-000135d0: 6768 742e 0a20 2020 2020 2020 2022 2222  ght..        """
-000135e0: 0a20 2020 2064 6566 2073 6574 5f6d 6178  .    def set_max
-000135f0: 5f69 6e66 6c69 6768 7428 7365 6c66 2c20  _inflight(self, 
-00013600: 6d61 785f 696e 666c 6967 6874 3a20 696e  max_inflight: in
-00013610: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-00013620: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00013630: 606d 6178 5f69 6e66 6c69 6768 7460 3a20  `max_inflight`: 
-00013640: 5468 6520 6d61 7869 6d75 6d20 6e75 6d62  The maximum numb
-00013650: 6572 206f 6620 6d65 7373 6167 6573 2074  er of messages t
-00013660: 6861 7420 6361 6e20 6265 2069 6e66 6c69  hat can be infli
-00013670: 6768 742e 0a20 2020 2020 2020 2022 2222  ght..        """
-00013680: 0a20 2020 2064 6566 2067 6574 5f73 7461  .    def get_sta
-00013690: 7465 2873 656c 6629 202d 3e20 2253 7461  te(self) -> "Sta
-000136a0: 7465 526f 6c65 223a 0a20 2020 2020 2020  teRole":.       
-000136b0: 2022 2222 0a20 2020 2020 2020 2060 7374   """.        `st
-000136c0: 6174 6560 3a20 5468 6520 6375 7272 656e  ate`: The curren
-000136d0: 7420 726f 6c65 206f 6620 7468 6973 206e  t role of this n
-000136e0: 6f64 652e 0a20 2020 2020 2020 2022 2222  ode..        """
-000136f0: 0a20 2020 2064 6566 2073 6574 5f73 7461  .    def set_sta
-00013700: 7465 2873 656c 662c 2073 7461 7465 5f72  te(self, state_r
-00013710: 6f6c 653a 2022 5374 6174 6552 6f6c 6522  ole: "StateRole"
-00013720: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00013730: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00013740: 7374 6174 6560 3a20 5468 6520 6375 7272  state`: The curr
-00013750: 656e 7420 726f 6c65 206f 6620 7468 6973  ent role of this
-00013760: 206e 6f64 652e 0a20 2020 2020 2020 2022   node..        "
-00013770: 2222 0a20 2020 2064 6566 2067 6574 5f65  "".    def get_e
-00013780: 6c65 6374 696f 6e5f 656c 6170 7365 6428  lection_elapsed(
-00013790: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-000137a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000137b0: 2020 6065 6c65 6374 696f 6e5f 656c 6170    `election_elap
-000137c0: 7365 6460 3a20 5469 636b 7320 7369 6e63  sed`: Ticks sinc
-000137d0: 6520 6974 2072 6561 6368 6564 206c 6173  e it reached las
-000137e0: 7420 656c 6563 7469 6f6e 5469 6d65 6f75  t electionTimeou
-000137f0: 7420 7768 656e 2069 7420 6973 206c 6561  t when it is lea
-00013800: 6465 7220 6f72 2063 616e 6469 6461 7465  der or candidate
-00013810: 2e0a 2020 2020 2020 2020 4e75 6d62 6572  ..        Number
-00013820: 206f 6620 7469 636b 7320 7369 6e63 6520   of ticks since 
-00013830: 6974 2072 6561 6368 6564 206c 6173 7420  it reached last 
-00013840: 656c 6563 7469 6f6e 5469 6d65 6f75 7420  electionTimeout 
-00013850: 6f72 2072 6563 6569 7665 6420 610a 2020  or received a.  
-00013860: 2020 2020 2020 7661 6c69 6420 6d65 7373        valid mess
-00013870: 6167 6520 6672 6f6d 2063 7572 7265 6e74  age from current
-00013880: 206c 6561 6465 7220 7768 656e 2069 7420   leader when it 
-00013890: 6973 2061 2066 6f6c 6c6f 7765 722e 0a20  is a follower.. 
-000138a0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-000138b0: 6566 2073 6574 5f65 6c65 6374 696f 6e5f  ef set_election_
-000138c0: 656c 6170 7365 6428 7365 6c66 2c20 656c  elapsed(self, el
-000138d0: 6563 7469 6f6e 5f65 6c61 7073 6564 3a20  ection_elapsed: 
-000138e0: 696e 7429 202d 3e20 4e6f 6e65 3a0a 2020  int) -> None:.  
-000138f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013900: 2020 6065 6c65 6374 696f 6e5f 656c 6170    `election_elap
-00013910: 7365 6460 3a20 5469 636b 7320 7369 6e63  sed`: Ticks sinc
-00013920: 6520 6974 2072 6561 6368 6564 206c 6173  e it reached las
-00013930: 7420 656c 6563 7469 6f6e 5469 6d65 6f75  t electionTimeou
-00013940: 7420 7768 656e 2069 7420 6973 206c 6561  t when it is lea
-00013950: 6465 7220 6f72 2063 616e 6469 6461 7465  der or candidate
-00013960: 2e0a 2020 2020 2020 2020 4e75 6d62 6572  ..        Number
-00013970: 206f 6620 7469 636b 7320 7369 6e63 6520   of ticks since 
-00013980: 6974 2072 6561 6368 6564 206c 6173 7420  it reached last 
-00013990: 656c 6563 7469 6f6e 5469 6d65 6f75 7420  electionTimeout 
-000139a0: 6f72 2072 6563 6569 7665 6420 610a 2020  or received a.  
-000139b0: 2020 2020 2020 7661 6c69 6420 6d65 7373        valid mess
-000139c0: 6167 6520 6672 6f6d 2063 7572 7265 6e74  age from current
-000139d0: 206c 6561 6465 7220 7768 656e 2069 7420   leader when it 
-000139e0: 6973 2061 2066 6f6c 6c6f 7765 722e 0a20  is a follower.. 
-000139f0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00013a00: 6566 2067 6574 5f63 6865 636b 5f71 756f  ef get_check_quo
-00013a10: 7275 6d28 7365 6c66 2920 2d3e 2062 6f6f  rum(self) -> boo
-00013a20: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
-00013a30: 2020 2020 2020 2060 6368 6563 6b5f 7175         `check_qu
-00013a40: 6f72 756d 603a 2057 6865 7468 6572 2074  orum`: Whether t
-00013a50: 6f20 6368 6563 6b20 7468 6520 7175 6f72  o check the quor
-00013a60: 756d 0a20 2020 2020 2020 2022 2222 0a20  um.        """. 
-00013a70: 2020 2064 6566 2073 6574 5f63 6865 636b     def set_check
-00013a80: 5f71 756f 7275 6d28 7365 6c66 2c20 6368  _quorum(self, ch
-00013a90: 6563 6b5f 7175 6f72 756d 3a20 626f 6f6c  eck_quorum: bool
-00013aa0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00013ab0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00013ac0: 6368 6563 6b5f 7175 6f72 756d 603a 2057  check_quorum`: W
-00013ad0: 6865 7468 6572 2074 6f20 6368 6563 6b20  hether to check 
-00013ae0: 7468 6520 7175 6f72 756d 0a20 2020 2020  the quorum.     
-00013af0: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
-00013b00: 6574 5f70 7265 5f76 6f74 6528 7365 6c66  et_pre_vote(self
-00013b10: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-00013b20: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00013b30: 7072 655f 766f 7465 603a 2045 6e61 626c  pre_vote`: Enabl
-00013b40: 6520 7468 6520 7072 6576 6f74 6520 616c  e the prevote al
-00013b50: 676f 7269 7468 6d2e 0a0a 2020 2020 2020  gorithm...      
-00013b60: 2020 5468 6973 2065 6e61 626c 6573 2061    This enables a
-00013b70: 2070 7265 2d65 6c65 6374 696f 6e20 766f   pre-election vo
-00013b80: 7465 2072 6f75 6e64 206f 6e20 4361 6e64  te round on Cand
-00013b90: 6964 6174 6573 2070 7269 6f72 2074 6f20  idates prior to 
-00013ba0: 6469 7372 7570 7469 6e67 2074 6865 2063  disrupting the c
-00013bb0: 6c75 7374 6572 2e0a 0a20 2020 2020 2020  luster...       
-00013bc0: 2045 6e61 626c 6520 7468 6973 2069 6620   Enable this if 
-00013bd0: 6772 6561 7465 7220 636c 7573 7465 7220  greater cluster 
-00013be0: 7374 6162 696c 6974 7920 6973 2070 7265  stability is pre
-00013bf0: 6665 7272 6564 206f 7665 7220 6661 7374  ferred over fast
-00013c00: 6572 2065 6c65 6374 696f 6e73 2e0a 2020  er elections..  
-00013c10: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-00013c20: 6620 7365 745f 7072 655f 766f 7465 2873  f set_pre_vote(s
-00013c30: 656c 662c 2070 7265 5f76 6f74 653a 2062  elf, pre_vote: b
-00013c40: 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a 2020  ool) -> None:.  
-00013c50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013c60: 2020 6070 7265 5f76 6f74 6560 3a20 456e    `pre_vote`: En
-00013c70: 6162 6c65 2074 6865 2070 7265 766f 7465  able the prevote
-00013c80: 2061 6c67 6f72 6974 686d 2e0a 0a20 2020   algorithm...   
-00013c90: 2020 2020 2054 6869 7320 656e 6162 6c65       This enable
-00013ca0: 7320 6120 7072 652d 656c 6563 7469 6f6e  s a pre-election
-00013cb0: 2076 6f74 6520 726f 756e 6420 6f6e 2043   vote round on C
-00013cc0: 616e 6469 6461 7465 7320 7072 696f 7220  andidates prior 
-00013cd0: 746f 2064 6973 7275 7074 696e 6720 7468  to disrupting th
-00013ce0: 6520 636c 7573 7465 722e 0a0a 2020 2020  e cluster...    
-00013cf0: 2020 2020 456e 6162 6c65 2074 6869 7320      Enable this 
-00013d00: 6966 2067 7265 6174 6572 2063 6c75 7374  if greater clust
-00013d10: 6572 2073 7461 6269 6c69 7479 2069 7320  er stability is 
-00013d20: 7072 6566 6572 7265 6420 6f76 6572 2066  preferred over f
-00013d30: 6173 7465 7220 656c 6563 7469 6f6e 732e  aster elections.
-00013d40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013d50: 2064 6566 2061 7070 6c79 5f63 6f6e 665f   def apply_conf_
-00013d60: 6368 616e 6765 2873 656c 662c 2063 6f6e  change(self, con
-00013d70: 665f 6368 616e 6765 3a20 2243 6f6e 6643  f_change: "ConfC
-00013d80: 6861 6e67 6556 3252 6566 2229 202d 3e20  hangeV2Ref") -> 
-00013d90: 2243 6f6e 6643 6861 6e67 6552 6566 223a  "ConfChangeRef":
-00013da0: 0a20 2020 2020 2020 2022 2222 2022 2222  .        """ """
-00013db0: 0a20 2020 2064 6566 2067 6574 5f72 6561  .    def get_rea
-00013dc0: 645f 7374 6174 6573 2873 656c 6629 202d  d_states(self) -
-00013dd0: 3e20 4c69 7374 5b22 5265 6164 5374 6174  > List["ReadStat
-00013de0: 6522 5d3a 0a20 2020 2020 2020 2022 2222  e"]:.        """
-00013df0: 0a20 2020 2020 2020 2060 7265 6164 5f73  .        `read_s
-00013e00: 7461 7465 7360 3a20 5468 6520 6375 7272  tates`: The curr
-00013e10: 656e 7420 7265 6164 2073 7461 7465 732e  ent read states.
-00013e20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013e30: 2064 6566 2073 6574 5f72 6561 645f 7374   def set_read_st
-00013e40: 6174 6573 280a 2020 2020 2020 2020 7365  ates(.        se
-00013e50: 6c66 2c20 7265 6164 5f73 7461 7465 733a  lf, read_states:
-00013e60: 204c 6973 745b 2252 6561 6453 7461 7465   List["ReadState
-00013e70: 225d 207c 204c 6973 745b 2252 6561 6453  "] | List["ReadS
-00013e80: 7461 7465 5265 6622 5d0a 2020 2020 2920  tateRef"].    ) 
-00013e90: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00013ea0: 2022 2222 0a20 2020 2020 2020 2060 7265   """.        `re
-00013eb0: 6164 5f73 7461 7465 7360 3a20 5468 6520  ad_states`: The 
-00013ec0: 6375 7272 656e 7420 7265 6164 2073 7461  current read sta
-00013ed0: 7465 732e 0a20 2020 2020 2020 2022 2222  tes..        """
-00013ee0: 0a20 2020 2064 6566 2067 6574 5f72 6561  .    def get_rea
-00013ef0: 645f 6f6e 6c79 5f6f 7074 696f 6e28 7365  d_only_option(se
-00013f00: 6c66 2920 2d3e 2022 5265 6164 4f6e 6c79  lf) -> "ReadOnly
-00013f10: 4f70 7469 6f6e 223a 0a20 2020 2020 2020  Option":.       
-00013f20: 2022 2222 0a20 2020 2020 2020 2060 7265   """.        `re
-00013f30: 6164 5f6f 6e6c 795f 6f70 7469 6f6e 603a  ad_only_option`:
-00013f40: 2043 686f 6f73 6520 7468 6520 6c69 6e65   Choose the line
-00013f50: 6172 697a 6162 696c 6974 7920 6d6f 6465  arizability mode
-00013f60: 206f 7220 7468 6520 6c65 6173 6520 6d6f   or the lease mo
-00013f70: 6465 2074 6f20 7265 6164 2064 6174 612e  de to read data.
-00013f80: 2049 6620 796f 7520 646f 6ee2 8099 7420   If you don...t 
-00013f90: 6361 7265 2061 626f 7574 2074 6865 2072  care about the r
-00013fa0: 6561 6420 636f 6e73 6973 7465 6e63 7920  ead consistency 
-00013fb0: 616e 6420 7761 6e74 2061 2068 6967 6865  and want a highe
-00013fc0: 7220 7265 6164 2070 6572 666f 726d 616e  r read performan
-00013fd0: 6365 2c20 796f 7520 6361 6e20 7573 6520  ce, you can use 
-00013fe0: 7468 6520 6c65 6173 6520 6d6f 6465 2e0a  the lease mode..
-00013ff0: 2020 2020 2020 2020 5365 7474 696e 6720          Setting 
-00014000: 7468 6973 2074 6f20 604c 6561 7365 4261  this to `LeaseBa
-00014010: 7365 6460 2072 6571 7569 7265 7320 6063  sed` requires `c
-00014020: 6865 636b 5f71 756f 7275 6d20 3d20 7472  heck_quorum = tr
-00014030: 7565 602e 0a20 2020 2020 2020 2022 2222  ue`..        """
-00014040: 0a20 2020 2064 6566 2073 6574 5f72 6561  .    def set_rea
-00014050: 645f 6f6e 6c79 5f6f 7074 696f 6e28 7365  d_only_option(se
-00014060: 6c66 2c20 6f70 7469 6f6e 3a20 2252 6561  lf, option: "Rea
-00014070: 644f 6e6c 794f 7074 696f 6e22 2920 2d3e  dOnlyOption") ->
-00014080: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00014090: 2222 0a20 2020 2020 2020 2060 7265 6164  "".        `read
-000140a0: 5f6f 6e6c 795f 6f70 7469 6f6e 603a 2043  _only_option`: C
-000140b0: 686f 6f73 6520 7468 6520 6c69 6e65 6172  hoose the linear
-000140c0: 697a 6162 696c 6974 7920 6d6f 6465 206f  izability mode o
-000140d0: 7220 7468 6520 6c65 6173 6520 6d6f 6465  r the lease mode
-000140e0: 2074 6f20 7265 6164 2064 6174 612e 2049   to read data. I
-000140f0: 6620 796f 7520 646f 6ee2 8099 7420 6361  f you don...t ca
-00014100: 7265 2061 626f 7574 2074 6865 2072 6561  re about the rea
-00014110: 6420 636f 6e73 6973 7465 6e63 7920 616e  d consistency an
-00014120: 6420 7761 6e74 2061 2068 6967 6865 7220  d want a higher 
-00014130: 7265 6164 2070 6572 666f 726d 616e 6365  read performance
-00014140: 2c20 796f 7520 6361 6e20 7573 6520 7468  , you can use th
-00014150: 6520 6c65 6173 6520 6d6f 6465 2e0a 2020  e lease mode..  
-00014160: 2020 2020 2020 5365 7474 696e 6720 7468        Setting th
-00014170: 6973 2074 6f20 604c 6561 7365 4261 7365  is to `LeaseBase
-00014180: 6460 2072 6571 7569 7265 7320 6063 6865  d` requires `che
-00014190: 636b 5f71 756f 7275 6d20 3d20 7472 7565  ck_quorum = true
-000141a0: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
-000141b0: 2020 2064 6566 2069 6e66 6c69 6768 745f     def inflight_
-000141c0: 6275 6666 6572 735f 7369 7a65 2873 656c  buffers_size(sel
-000141d0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-000141e0: 2020 2022 2222 4765 7420 7468 6520 696e     """Get the in
-000141f0: 666c 6967 6874 2062 7566 6665 7220 7369  flight buffer si
-00014200: 7a65 2e22 2222 0a20 2020 2064 6566 206d  ze.""".    def m
-00014210: 6179 6265 5f66 7265 655f 696e 666c 6967  aybe_free_inflig
-00014220: 6874 5f62 7566 6665 7273 2873 656c 6629  ht_buffers(self)
-00014230: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00014240: 2020 2222 220a 2020 2020 2020 2020 4120    """.        A 
-00014250: 5261 6674 206c 6561 6465 7220 616c 6c6f  Raft leader allo
-00014260: 6361 7465 7320 6120 7665 6374 6f72 2077  cates a vector w
-00014270: 6974 6820 6361 7061 6369 7479 2060 6d61  ith capacity `ma
-00014280: 785f 696e 666c 6967 6874 5f6d 7367 7360  x_inflight_msgs`
-00014290: 2066 6f72 2065 7665 7279 2070 6565 722e   for every peer.
-000142a0: 0a20 2020 2020 2020 2049 7420 7461 6b65  .        It take
-000142b0: 7320 6120 6c6f 7420 6f66 206d 656d 6f72  s a lot of memor
-000142c0: 7920 6966 2074 6865 7265 2061 7265 2074  y if there are t
-000142d0: 6f6f 206d 616e 7920 5261 6674 2067 726f  oo many Raft gro
-000142e0: 7570 732e 2060 6d61 7962 655f 6672 6565  ups. `maybe_free
-000142f0: 5f69 6e66 6c69 6768 745f 6275 6666 6572  _inflight_buffer
-00014300: 7360 0a20 2020 2020 2020 2069 7320 7573  s`.        is us
-00014310: 6564 2074 6f20 6672 6565 206d 656d 6f72  ed to free memor
-00014320: 7920 6966 206e 6563 6573 7361 7279 2e0a  y if necessary..
-00014330: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014340: 6465 6620 6164 6a75 7374 5f6d 6178 5f69  def adjust_max_i
-00014350: 6e66 6c69 6768 745f 6d73 6773 2873 656c  nflight_msgs(sel
-00014360: 662c 2074 6172 6765 743a 2069 6e74 2c20  f, target: int, 
-00014370: 6361 703a 2069 6e74 2920 2d3e 204e 6f6e  cap: int) -> Non
-00014380: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00014390: 2020 2020 2020 2054 6f20 6164 6a75 7374         To adjust
-000143a0: 2060 6d61 785f 696e 666c 6967 6874 5f6d   `max_inflight_m
-000143b0: 7367 7360 2066 6f72 2074 6865 2073 7065  sgs` for the spe
-000143c0: 6369 6669 6564 2070 6565 722e 0a20 2020  cified peer..   
-000143d0: 2020 2020 2053 6574 2074 6f20 6030 6020       Set to `0` 
-000143e0: 7769 6c6c 2064 6973 6162 6c65 2074 6865  will disable the
-000143f0: 2070 726f 6772 6573 732e 0a20 2020 2020   progress..     
-00014400: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
-00014410: 6574 5f72 6561 646f 6e6c 795f 7265 6164  et_readonly_read
-00014420: 5f69 6e64 6578 5f71 7565 7565 2873 656c  _index_queue(sel
-00014430: 6629 202d 3e20 4c69 7374 5b4c 6973 745b  f) -> List[List[
-00014440: 696e 745d 5d3a 0a20 2020 2020 2020 2022  int]]:.        "
-00014450: 2222 2022 2222 0a20 2020 2064 6566 2073  "" """.    def s
-00014460: 6574 5f62 6174 6368 5f61 7070 656e 6428  et_batch_append(
-00014470: 7365 6c66 2c20 6261 7463 685f 6170 7065  self, batch_appe
-00014480: 6e64 3a20 626f 6f6c 2920 2d3e 204e 6f6e  nd: bool) -> Non
-00014490: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-000144a0: 2020 2020 2020 2053 6574 2077 6865 7468         Set wheth
-000144b0: 6572 2062 6174 6368 2061 7070 656e 6420  er batch append 
-000144c0: 6d73 6720 6174 2072 756e 7469 6d65 2e0a  msg at runtime..
-000144d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000144e0: 6465 6620 7365 745f 6d61 785f 636f 6d6d  def set_max_comm
-000144f0: 6974 7465 645f 7369 7a65 5f70 6572 5f72  itted_size_per_r
-00014500: 6561 6479 2873 656c 662c 2073 697a 653a  eady(self, size:
-00014510: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
-00014520: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00014530: 2020 2053 6574 2060 6d61 785f 636f 6d6d     Set `max_comm
-00014540: 6974 7465 645f 7369 7a65 5f70 6572 5f72  itted_size_per_r
-00014550: 6561 6479 6020 746f 2060 7369 7a65 602e  eady` to `size`.
-00014560: 0a20 2020 2020 2020 2022 2222 0a0a 636c  .        """..cl
-00014570: 6173 7320 496e 4d65 6d6f 7279 5261 6674  ass InMemoryRaft
-00014580: 285f 5f41 5049 5f52 6166 7429 3a0a 2020  (__API_Raft):.  
-00014590: 2020 2222 220a 2020 2020 4120 7374 7275    """.    A stru
-000145a0: 6374 2074 6861 7420 7265 7072 6573 656e  ct that represen
-000145b0: 7473 2074 6865 2072 6166 7420 636f 6e73  ts the raft cons
-000145c0: 656e 7375 7320 6974 7365 6c66 2e20 5374  ensus itself. St
-000145d0: 6f72 6573 2064 6574 6169 6c73 2063 6f6e  ores details con
-000145e0: 6365 726e 696e 6720 7468 6520 6375 7272  cerning the curr
-000145f0: 656e 740a 2020 2020 616e 6420 706f 7373  ent.    and poss
-00014600: 6962 6c65 2073 7461 7465 2074 6865 2073  ible state the s
-00014610: 7973 7465 6d20 6361 6e20 7461 6b65 2e0a  ystem can take..
-00014620: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00014630: 205f 5f69 6e69 745f 5f28 0a20 2020 2020   __init__(.     
-00014640: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00014650: 2063 6667 3a20 2243 6f6e 6669 6722 207c   cfg: "Config" |
-00014660: 2022 436f 6e66 6967 5265 6622 2c0a 2020   "ConfigRef",.  
-00014670: 2020 2020 2020 7374 6f72 653a 2022 4d65        store: "Me
-00014680: 6d53 746f 7261 6765 2220 7c20 224d 656d  mStorage" | "Mem
-00014690: 5374 6f72 6167 6552 6566 222c 0a20 2020  StorageRef",.   
-000146a0: 2020 2020 206c 6f67 6765 723a 2022 4c6f       logger: "Lo
-000146b0: 6767 6572 2220 7c20 224c 6f67 6765 7252  gger" | "LoggerR
-000146c0: 6566 222c 0a20 2020 2029 202d 3e20 4e6f  ef",.    ) -> No
-000146d0: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
-000146e0: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
-000146f0: 3e20 2249 6e4d 656d 6f72 7952 6166 7452  > "InMemoryRaftR
-00014700: 6566 223a 202e 2e2e 0a20 2020 2064 6566  ef": ....    def
-00014710: 2067 6574 5f72 6166 745f 6c6f 6728 7365   get_raft_log(se
-00014720: 6c66 2920 2d3e 2022 496e 4d65 6d6f 7279  lf) -> "InMemory
-00014730: 5261 6674 4c6f 6752 6566 223a 0a20 2020  RaftLogRef":.   
-00014740: 2020 2020 2022 2222 2022 2222 0a0a 636c       """ """..cl
-00014750: 6173 7320 496e 4d65 6d6f 7279 5261 6674  ass InMemoryRaft
-00014760: 5265 6628 5f5f 4150 495f 5261 6674 293a  Ref(__API_Raft):
-00014770: 0a20 2020 2022 2222 0a20 2020 2052 6566  .    """.    Ref
-00014780: 6572 656e 6365 2074 7970 6520 6f66 203a  erence type of :
-00014790: 636c 6173 733a 6049 6e4d 656d 6f72 7952  class:`InMemoryR
-000147a0: 6166 7460 2e0a 2020 2020 2222 220a 0a20  aft`..    """.. 
-000147b0: 2020 2064 6566 2067 6574 5f72 6166 745f     def get_raft_
-000147c0: 6c6f 6728 7365 6c66 2920 2d3e 2022 496e  log(self) -> "In
-000147d0: 4d65 6d6f 7279 5261 6674 4c6f 6752 6566  MemoryRaftLogRef
-000147e0: 223a 0a20 2020 2020 2020 2022 2222 2022  ":.        """ "
-000147f0: 2222 0a0a 636c 6173 7320 5261 6674 285f  ""..class Raft(_
-00014800: 5f41 5049 5f52 6166 7429 3a0a 2020 2020  _API_Raft):.    
-00014810: 2222 220a 2020 2020 4120 7374 7275 6374  """.    A struct
-00014820: 2074 6861 7420 7265 7072 6573 656e 7473   that represents
-00014830: 2074 6865 2072 6166 7420 636f 6e73 656e   the raft consen
-00014840: 7375 7320 6974 7365 6c66 2e20 5374 6f72  sus itself. Stor
-00014850: 6573 2064 6574 6169 6c73 2063 6f6e 6365  es details conce
-00014860: 726e 696e 6720 7468 6520 6375 7272 656e  rning the curren
-00014870: 740a 2020 2020 616e 6420 706f 7373 6962  t.    and possib
-00014880: 6c65 2073 7461 7465 2074 6865 2073 7973  le state the sys
-00014890: 7465 6d20 6361 6e20 7461 6b65 2e0a 2020  tem can take..  
-000148a0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-000148b0: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
-000148c0: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
-000148d0: 6667 3a20 2243 6f6e 6669 6722 207c 2022  fg: "Config" | "
-000148e0: 436f 6e66 6967 5265 6622 2c0a 2020 2020  ConfigRef",.    
-000148f0: 2020 2020 7374 6f72 653a 2022 5374 6f72      store: "Stor
-00014900: 6167 6522 207c 2022 5374 6f72 6167 6552  age" | "StorageR
-00014910: 6566 222c 0a20 2020 2020 2020 206c 6f67  ef",.        log
-00014920: 6765 723a 2022 4c6f 6767 6572 2220 7c20  ger: "Logger" | 
-00014930: 224c 6f67 6765 7252 6566 222c 0a20 2020  "LoggerRef",.   
-00014940: 2029 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a   ) -> None: ....
-00014950: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
-00014960: 2873 656c 6629 202d 3e20 2252 6166 7452  (self) -> "RaftR
-00014970: 6566 223a 202e 2e2e 0a20 2020 2064 6566  ef": ....    def
-00014980: 2067 6574 5f72 6166 745f 6c6f 6728 7365   get_raft_log(se
-00014990: 6c66 2920 2d3e 2022 5261 6674 4c6f 6752  lf) -> "RaftLogR
-000149a0: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
-000149b0: 2022 2222 0a0a 636c 6173 7320 5261 6674   """..class Raft
-000149c0: 5265 6628 5f5f 4150 495f 5261 6674 293a  Ref(__API_Raft):
-000149d0: 0a20 2020 2022 2222 0a20 2020 2052 6566  .    """.    Ref
-000149e0: 6572 656e 6365 2074 7970 6520 6f66 203a  erence type of :
-000149f0: 636c 6173 733a 6052 6166 7460 2e0a 2020  class:`Raft`..  
-00014a00: 2020 2222 220a 0a20 2020 2064 6566 2067    """..    def g
-00014a10: 6574 5f72 6166 745f 6c6f 6728 7365 6c66  et_raft_log(self
-00014a20: 2920 2d3e 2022 5261 6674 4c6f 6752 6566  ) -> "RaftLogRef
-00014a30: 223a 0a20 2020 2020 2020 2022 2222 2022  ":.        """ "
-00014a40: 2222 0a0a 636c 6173 7320 5072 6f67 7265  ""..class Progre
-00014a50: 7373 4d61 7049 7465 6d3a 0a20 2020 2064  ssMapItem:.    d
-00014a60: 6566 2069 6428 7365 6c66 2920 2d3e 2069  ef id(self) -> i
-00014a70: 6e74 3a20 2e2e 2e0a 2020 2020 6465 6620  nt: ....    def 
-00014a80: 7072 6f67 7265 7373 2873 656c 6629 202d  progress(self) -
-00014a90: 3e20 2250 726f 6772 6573 7322 3a20 2e2e  > "Progress": ..
-00014aa0: 2e0a 0a63 6c61 7373 205f 5f41 5049 5f50  ...class __API_P
-00014ab0: 726f 6772 6573 7354 7261 636b 6572 285f  rogressTracker(_
-00014ac0: 5f43 6c6f 6e65 6162 6c65 293a 0a20 2020  _Cloneable):.   
-00014ad0: 2064 6566 2063 6c6f 6e65 2873 656c 6629   def clone(self)
-00014ae0: 202d 3e20 2250 726f 6772 6573 7354 7261   -> "ProgressTra
-00014af0: 636b 6572 223a 202e 2e2e 0a20 2020 2064  cker": ....    d
-00014b00: 6566 2067 6574 2873 656c 662c 2069 643a  ef get(self, id:
-00014b10: 2069 6e74 2920 2d3e 204f 7074 696f 6e61   int) -> Optiona
-00014b20: 6c5b 2250 726f 6772 6573 7352 6566 225d  l["ProgressRef"]
-00014b30: 3a0a 2020 2020 2020 2020 2222 2222 2222  :.        """"""
-00014b40: 0a20 2020 2064 6566 2067 726f 7570 5f63  .    def group_c
-00014b50: 6f6d 6d69 7428 7365 6c66 2920 2d3e 2062  ommit(self) -> b
-00014b60: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-00014b70: 0a20 2020 2020 2020 2057 6865 7468 6572  .        Whether
-00014b80: 2065 6e61 626c 6520 6772 6f75 7020 636f   enable group co
-00014b90: 6d6d 6974 2e0a 2020 2020 2020 2020 2222  mmit..        ""
-00014ba0: 220a 2020 2020 6465 6620 656e 6162 6c65  ".    def enable
-00014bb0: 5f67 726f 7570 5f63 6f6d 6d69 7428 7365  _group_commit(se
-00014bc0: 6c66 2c20 656e 6162 6c65 3a20 626f 6f6c  lf, enable: bool
-00014bd0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00014be0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00014bf0: 6f6e 6669 6775 7265 7320 6772 6f75 7020  onfigures group 
-00014c00: 636f 6d6d 6974 2e0a 2020 2020 2020 2020  commit..        
-00014c10: 2222 220a 2020 2020 6465 6620 6861 735f  """.    def has_
-00014c20: 7175 6f72 756d 2873 656c 662c 2070 6f74  quorum(self, pot
-00014c30: 656e 7469 616c 5f71 756f 7275 6d3a 2053  ential_quorum: S
-00014c40: 6574 5b69 6e74 5d29 202d 3e20 626f 6f6c  et[int]) -> bool
-00014c50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00014c60: 2020 2020 2020 4465 7465 726d 696e 6520        Determine 
-00014c70: 6966 2061 2071 756f 7275 6d20 6973 2066  if a quorum is f
-00014c80: 6f72 6d65 6420 6672 6f6d 2074 6865 2067  ormed from the g
-00014c90: 6976 656e 2073 6574 206f 6620 6e6f 6465  iven set of node
-00014ca0: 732e 0a0a 2020 2020 2020 2020 5468 6973  s...        This
-00014cb0: 2069 7320 7468 6520 6f6e 6c79 2063 6f72   is the only cor
-00014cc0: 7265 6374 2077 6179 2074 6f20 7665 7269  rect way to veri
-00014cd0: 6679 2079 6f75 2068 6176 6520 7265 6163  fy you have reac
-00014ce0: 6865 6420 6120 7175 6f72 756d 2066 6f72  hed a quorum for
-00014cf0: 2074 6865 2077 686f 6c65 2067 726f 7570   the whole group
-00014d00: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00014d10: 2020 6465 6620 6973 5f73 696e 676c 6574    def is_singlet
-00014d20: 6f6e 2873 656c 6629 202d 3e20 626f 6f6c  on(self) -> bool
-00014d30: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00014d40: 2020 2020 2020 5265 7475 726e 7320 7472        Returns tr
-00014d50: 7565 2069 6620 2861 6e64 206f 6e6c 7920  ue if (and only 
-00014d60: 6966 2920 7468 6572 6520 6973 206f 6e6c  if) there is onl
-00014d70: 7920 6f6e 6520 766f 7469 6e67 206d 656d  y one voting mem
-00014d80: 6265 720a 2020 2020 2020 2020 2869 2e65  ber.        (i.e
-00014d90: 2e20 7468 6520 6c65 6164 6572 2920 696e  . the leader) in
-00014da0: 2074 6865 2063 7572 7265 6e74 2063 6f6e   the current con
-00014db0: 6669 6775 7261 7469 6f6e 2e0a 2020 2020  figuration..    
-00014dc0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00014dd0: 7175 6f72 756d 5f72 6563 656e 746c 795f  quorum_recently_
-00014de0: 6163 7469 7665 2873 656c 662c 2070 6572  active(self, per
-00014df0: 7370 6563 7469 7665 5f6f 663a 2069 6e74  spective_of: int
-00014e00: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-00014e10: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
-00014e20: 6574 6572 6d69 6e65 7320 6966 2074 6865  etermines if the
-00014e30: 2063 7572 7265 6e74 2071 756f 7275 6d20   current quorum 
-00014e40: 6973 2061 6374 6976 6520 6163 636f 7264  is active accord
-00014e50: 696e 6720 746f 2074 6865 2074 6869 7320  ing to the this 
-00014e60: 7261 6674 206e 6f64 652e 0a20 2020 2020  raft node..     
-00014e70: 2020 2044 6f69 6e67 2074 6869 7320 7769     Doing this wi
-00014e80: 6c6c 2073 6574 2074 6865 2060 7265 6365  ll set the `rece
-00014e90: 6e74 5f61 6374 6976 6560 206f 6620 6561  nt_active` of ea
-00014ea0: 6368 2070 6565 7220 746f 2066 616c 7365  ch peer to false
-00014eb0: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00014ec0: 7368 6f75 6c64 206f 6e6c 7920 6265 2063  should only be c
-00014ed0: 616c 6c65 6420 6279 2074 6865 206c 6561  alled by the lea
-00014ee0: 6465 722e 0a20 2020 2020 2020 2022 2222  der..        """
-00014ef0: 0a20 2020 2064 6566 206d 6178 696d 616c  .    def maximal
-00014f00: 5f63 6f6d 6d69 7474 6564 5f69 6e64 6578  _committed_index
-00014f10: 2873 656c 6629 202d 3e20 5475 706c 655b  (self) -> Tuple[
-00014f20: 696e 742c 2062 6f6f 6c5d 3a0a 2020 2020  int, bool]:.    
-00014f30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014f40: 5265 7475 726e 7320 7468 6520 6d61 7869  Returns the maxi
-00014f50: 6d61 6c20 636f 6d6d 6974 7465 6420 696e  mal committed in
-00014f60: 6465 7820 666f 7220 7468 6520 636c 7573  dex for the clus
-00014f70: 7465 722e 2054 6865 2062 6f6f 6c20 666c  ter. The bool fl
-00014f80: 6167 2069 6e64 6963 6174 6573 2077 6865  ag indicates whe
-00014f90: 7468 6572 0a20 2020 2020 2020 2074 6865  ther.        the
-00014fa0: 2069 6e64 6578 2069 7320 636f 6d70 7574   index is comput
-00014fb0: 6564 2062 7920 6772 6f75 7020 636f 6d6d  ed by group comm
-00014fc0: 6974 2061 6c67 6f72 6974 686d 2073 7563  it algorithm suc
-00014fd0: 6365 7373 6675 6c6c 790a 0a20 2020 2020  cessfully..     
-00014fe0: 2020 2045 672e 2049 6620 7468 6520 6d61     Eg. If the ma
-00014ff0: 7463 6865 6420 696e 6465 7865 7320 6172  tched indexes ar
-00015000: 6520 605b 322c 322c 322c 342c 355d 602c  e `[2,2,2,4,5]`,
-00015010: 2069 7420 7769 6c6c 2072 6574 7572 6e20   it will return 
-00015020: 6032 602e 0a20 2020 2020 2020 2049 6620  `2`..        If 
-00015030: 7468 6520 6d61 7463 6865 6420 696e 6465  the matched inde
-00015040: 7865 7320 616e 6420 6772 6f75 7073 2061  xes and groups a
-00015050: 7265 2060 5b28 312c 2031 292c 2028 322c  re `[(1, 1), (2,
-00015060: 2032 292c 2028 332c 2032 295d 602c 2069   2), (3, 2)]`, i
-00015070: 7420 7769 6c6c 2072 6574 7572 6e20 6031  t will return `1
-00015080: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
-00015090: 2020 2064 6566 2072 6563 6f72 645f 766f     def record_vo
-000150a0: 7465 2873 656c 662c 2069 643a 2069 6e74  te(self, id: int
-000150b0: 2c20 766f 7465 3a20 626f 6f6c 2920 2d3e  , vote: bool) ->
-000150c0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000150d0: 2222 0a20 2020 2020 2020 2052 6563 6f72  "".        Recor
-000150e0: 6473 2074 6861 7420 7468 6520 6e6f 6465  ds that the node
-000150f0: 2077 6974 6820 7468 6520 6769 7665 6e20   with the given 
-00015100: 6964 2076 6f74 6564 2066 6f72 2074 6869  id voted for thi
-00015110: 7320 5261 6674 0a20 2020 2020 2020 2069  s Raft.        i
-00015120: 6e73 7461 6e63 6520 6966 2076 203d 3d20  nstance if v == 
-00015130: 7472 7565 2028 616e 6420 6465 636c 696e  true (and declin
-00015140: 6564 2069 7420 6f74 6865 7277 6973 6529  ed it otherwise)
-00015150: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00015160: 2020 6465 6620 7265 7365 745f 766f 7465    def reset_vote
-00015170: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-00015180: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015190: 2020 2020 2050 7265 7061 7265 7320 666f       Prepares fo
-000151a0: 7220 6120 6e65 7720 726f 756e 6420 6f66  r a new round of
-000151b0: 2076 6f74 6520 636f 756e 7469 6e67 2076   vote counting v
-000151c0: 6961 2072 6563 6f72 6456 6f74 652e 0a20  ia recordVote.. 
-000151d0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-000151e0: 6566 2063 6f6e 665f 766f 7465 7273 2873  ef conf_voters(s
-000151f0: 656c 6629 202d 3e20 224a 6f69 6e74 436f  elf) -> "JointCo
-00015200: 6e66 6967 5265 6622 3a0a 2020 2020 2020  nfigRef":.      
-00015210: 2020 2222 2220 2222 220a 2020 2020 6465    """ """.    de
-00015220: 6620 636f 6e66 5f6c 6561 726e 6572 7328  f conf_learners(
-00015230: 7365 6c66 2920 2d3e 2053 6574 5b69 6e74  self) -> Set[int
-00015240: 5d3a 0a20 2020 2020 2020 2022 2222 2022  ]:.        """ "
-00015250: 2222 0a20 2020 2064 6566 2063 6f6c 6c65  "".    def colle
-00015260: 6374 2873 656c 6629 202d 3e20 4c69 7374  ct(self) -> List
-00015270: 5b22 5072 6f67 7265 7373 4d61 7049 7465  ["ProgressMapIte
-00015280: 6d22 5d3a 0a20 2020 2020 2020 2022 2222  m"]:.        """
-00015290: 2022 2222 0a0a 636c 6173 7320 5072 6f67   """..class Prog
-000152a0: 7265 7373 5472 6163 6b65 7228 5f5f 4150  ressTracker(__AP
-000152b0: 495f 5072 6f67 7265 7373 5472 6163 6b65  I_ProgressTracke
-000152c0: 7229 3a0a 2020 2020 2222 220a 2020 2020  r):.    """.    
-000152d0: 6050 726f 6772 6573 7354 7261 636b 6572  `ProgressTracker
-000152e0: 6020 636f 6e74 6169 6e73 2073 6576 6572  ` contains sever
-000152f0: 616c 2060 5072 6f67 7265 7373 6065 732c  al `Progress`es,
-00015300: 0a20 2020 2077 6869 6368 2063 6f75 6c64  .    which could
-00015310: 2062 6520 604c 6561 6465 7260 2c20 6046   be `Leader`, `F
-00015320: 6f6c 6c6f 7765 7260 2061 6e64 2060 4c65  ollower` and `Le
-00015330: 6172 6e65 7260 2e0a 2020 2020 2222 220a  arner`..    """.
-00015340: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00015350: 5f28 7365 6c66 2c20 6d61 785f 696e 666c  _(self, max_infl
-00015360: 6967 6874 3a20 696e 7429 202d 3e20 4e6f  ight: int) -> No
-00015370: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
-00015380: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
-00015390: 3e20 2250 726f 6772 6573 7354 7261 636b  > "ProgressTrack
-000153a0: 6572 5265 6622 3a20 2e2e 2e0a 0a63 6c61  erRef": .....cla
-000153b0: 7373 2050 726f 6772 6573 7354 7261 636b  ss ProgressTrack
-000153c0: 6572 5265 6628 5f5f 4150 495f 5072 6f67  erRef(__API_Prog
-000153d0: 7265 7373 5472 6163 6b65 7229 3a0a 2020  ressTracker):.  
-000153e0: 2020 2222 220a 2020 2020 5265 6665 7265    """.    Refere
-000153f0: 6e63 6520 7479 7065 206f 6620 3a63 6c61  nce type of :cla
-00015400: 7373 3a60 5072 6f67 7265 7373 5472 6163  ss:`ProgressTrac
-00015410: 6b65 7260 2e0a 2020 2020 2222 220a 0a63  ker`..    """..c
-00015420: 6c61 7373 205f 5f41 5049 5f50 726f 6772  lass __API_Progr
-00015430: 6573 7328 5f5f 436c 6f6e 6561 626c 6529  ess(__Cloneable)
-00015440: 3a0a 2020 2020 6465 6620 636c 6f6e 6528  :.    def clone(
-00015450: 7365 6c66 2920 2d3e 2022 5072 6f67 7265  self) -> "Progre
-00015460: 7373 223a 202e 2e2e 0a20 2020 2064 6566  ss": ....    def
-00015470: 2062 6563 6f6d 655f 7072 6f62 6528 7365   become_probe(se
-00015480: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00015490: 2020 2020 2022 2222 4368 616e 6765 7320       """Changes 
-000154a0: 7468 6520 7072 6f67 7265 7373 2074 6f20  the progress to 
-000154b0: 6120 7072 6f62 652e 2222 220a 2020 2020  a probe.""".    
-000154c0: 6465 6620 6265 636f 6d65 5f72 6570 6c69  def become_repli
-000154d0: 6361 7465 2873 656c 6629 202d 3e20 4e6f  cate(self) -> No
-000154e0: 6e65 3a0a 2020 2020 2020 2020 2222 2243  ne:.        """C
-000154f0: 6861 6e67 6573 2074 6865 2070 726f 6772  hanges the progr
-00015500: 6573 7320 746f 2061 2052 6570 6c69 6361  ess to a Replica
-00015510: 7465 2e22 2222 0a20 2020 2064 6566 2062  te.""".    def b
-00015520: 6563 6f6d 655f 736e 6170 7368 6f74 2873  ecome_snapshot(s
-00015530: 656c 662c 2073 6e61 7073 686f 745f 6964  elf, snapshot_id
-00015540: 783a 2069 6e74 2920 2d3e 204e 6f6e 653a  x: int) -> None:
-00015550: 0a20 2020 2020 2020 2022 2222 4368 616e  .        """Chan
-00015560: 6765 7320 7468 6520 7072 6f67 7265 7373  ges the progress
-00015570: 2074 6f20 6120 736e 6170 7368 6f74 2e22   to a snapshot."
-00015580: 2222 0a20 2020 2064 6566 206d 6179 6265  "".    def maybe
-00015590: 5f75 7064 6174 6528 7365 6c66 2c20 6e3a  _update(self, n:
-000155a0: 2069 6e74 2920 2d3e 2062 6f6f 6c3a 0a20   int) -> bool:. 
-000155b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000155c0: 2020 2052 6574 7572 6e73 2066 616c 7365     Returns false
-000155d0: 2069 6620 7468 6520 6769 7665 6e20 6e20   if the given n 
-000155e0: 696e 6465 7820 636f 6d65 7320 6672 6f6d  index comes from
-000155f0: 2061 6e20 6f75 7464 6174 6564 206d 6573   an outdated mes
-00015600: 7361 6765 2e0a 2020 2020 2020 2020 4f74  sage..        Ot
-00015610: 6865 7277 6973 6520 6974 2075 7064 6174  herwise it updat
-00015620: 6573 2074 6865 2070 726f 6772 6573 7320  es the progress 
-00015630: 616e 6420 7265 7475 726e 7320 7472 7565  and returns true
-00015640: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00015650: 2020 6465 6620 6d61 7962 655f 6465 6372    def maybe_decr
-00015660: 5f74 6f28 0a20 2020 2020 2020 2073 656c  _to(.        sel
-00015670: 662c 2072 656a 6563 7465 643a 2069 6e74  f, rejected: int
-00015680: 2c20 6d61 7463 685f 6869 6e74 3a20 696e  , match_hint: in
-00015690: 742c 2072 6571 7565 7374 5f73 6e61 7073  t, request_snaps
-000156a0: 686f 743a 2069 6e74 0a20 2020 2029 202d  hot: int.    ) -
-000156b0: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-000156c0: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-000156d0: 726e 7320 6661 6c73 6520 6966 2074 6865  rns false if the
-000156e0: 2067 6976 656e 2069 6e64 6578 2063 6f6d   given index com
-000156f0: 6573 2066 726f 6d20 616e 206f 7574 206f  es from an out o
-00015700: 6620 6f72 6465 7220 6d65 7373 6167 652e  f order message.
-00015710: 0a20 2020 2020 2020 204f 7468 6572 7769  .        Otherwi
-00015720: 7365 2069 7420 6465 6372 6561 7365 7320  se it decreases 
-00015730: 7468 6520 7072 6f67 7265 7373 206e 6578  the progress nex
-00015740: 7420 696e 6465 7820 746f 206d 696e 2872  t index to min(r
-00015750: 656a 6563 7465 642c 206c 6173 7429 0a20  ejected, last). 
-00015760: 2020 2020 2020 2061 6e64 2072 6574 7572         and retur
-00015770: 6e73 2074 7275 652e 0a20 2020 2020 2020  ns true..       
-00015780: 2022 2222 0a20 2020 2064 6566 2073 6e61   """.    def sna
-00015790: 7073 686f 745f 6661 696c 7572 6528 7365  pshot_failure(se
-000157a0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-000157b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000157c0: 2053 6574 7320 7468 6520 736e 6170 7368   Sets the snapsh
-000157d0: 6f74 2074 6f20 6661 696c 7572 652e 0a20  ot to failure.. 
-000157e0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-000157f0: 6566 2070 6175 7365 2873 656c 6629 202d  ef pause(self) -
-00015800: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00015810: 2222 220a 2020 2020 2020 2020 5061 7573  """.        Paus
-00015820: 6520 7072 6f67 7265 7373 2e0a 2020 2020  e progress..    
-00015830: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00015840: 6973 5f70 6175 7365 6428 7365 6c66 2920  is_paused(self) 
-00015850: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00015860: 2022 2222 0a20 2020 2020 2020 2044 6574   """.        Det
-00015870: 6572 6d69 6e65 2077 6865 7468 6572 2070  ermine whether p
-00015880: 726f 6772 6573 7320 6973 2070 6175 7365  rogress is pause
-00015890: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-000158a0: 2020 2064 6566 2069 735f 736e 6170 7368     def is_snapsh
-000158b0: 6f74 5f63 6175 6768 745f 7570 2873 656c  ot_caught_up(sel
-000158c0: 6629 202d 3e20 626f 6f6c 3a0a 2020 2020  f) -> bool:.    
-000158d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000158e0: 5265 7475 726e 7320 7472 7565 2069 6620  Returns true if 
-000158f0: 4d61 7463 6820 6973 2065 7175 616c 206f  Match is equal o
-00015900: 7220 6869 6768 6572 2074 6861 6e20 7468  r higher than th
-00015910: 6520 7065 6e64 696e 6753 6e61 7073 686f  e pendingSnapsho
-00015920: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-00015930: 2020 2064 6566 2072 6573 756d 6528 7365     def resume(se
-00015940: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00015950: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015960: 2052 6573 756d 6520 7072 6f67 7265 7373   Resume progress
-00015970: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015980: 2064 6566 2075 7064 6174 655f 7374 6174   def update_stat
-00015990: 6528 7365 6c66 2c20 6c61 7374 3a20 696e  e(self, last: in
-000159a0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-000159b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000159c0: 5570 6461 7465 2069 6e66 6c69 6768 7420  Update inflight 
-000159d0: 6d73 6773 2061 6e64 206e 6578 745f 6964  msgs and next_id
-000159e0: 780a 2020 2020 2020 2020 2222 220a 2020  x.        """.  
-000159f0: 2020 6465 6620 7570 6461 7465 5f63 6f6d    def update_com
-00015a00: 6d69 7474 6564 2873 656c 662c 2063 6f6d  mitted(self, com
-00015a10: 6d69 7474 6564 5f69 6e64 6578 3a20 696e  mitted_index: in
-00015a20: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-00015a30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015a40: 5570 6461 7465 2063 6f6d 6d69 7474 6564  Update committed
-00015a50: 5f69 6e64 6578 2e0a 2020 2020 2020 2020  _index..        
-00015a60: 2222 220a 2020 2020 6465 6620 6f70 7469  """.    def opti
-00015a70: 6d69 7374 6963 5f75 7064 6174 6528 7365  mistic_update(se
-00015a80: 6c66 2c20 6e3a 2069 6e74 2920 2d3e 204e  lf, n: int) -> N
-00015a90: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00015aa0: 0a20 2020 2020 2020 204f 7074 696d 6973  .        Optimis
-00015ab0: 7469 6361 6c6c 7920 6164 7661 6e63 6520  tically advance 
-00015ac0: 7468 6520 696e 6465 780a 2020 2020 2020  the index.      
-00015ad0: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
-00015ae0: 745f 696e 7328 7365 6c66 2920 2d3e 2022  t_ins(self) -> "
-00015af0: 496e 666c 6967 6874 7352 6566 223a 0a20  InflightsRef":. 
-00015b00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015b10: 2020 2060 696e 7360 3a20 496e 666c 6967     `ins`: Inflig
-00015b20: 6874 7320 6973 2061 2073 6c69 6469 6e67  hts is a sliding
-00015b30: 2077 696e 646f 7720 666f 7220 7468 6520   window for the 
-00015b40: 696e 666c 6967 6874 206d 6573 7361 6765  inflight message
-00015b50: 732e 0a20 2020 2020 2020 2057 6865 6e20  s..        When 
-00015b60: 696e 666c 6967 6874 7320 6973 2066 756c  inflights is ful
-00015b70: 6c2c 206e 6f20 6d6f 7265 206d 6573 7361  l, no more messa
-00015b80: 6765 2073 686f 756c 6420 6265 2073 656e  ge should be sen
-00015b90: 742e 0a20 2020 2020 2020 2057 6865 6e20  t..        When 
-00015ba0: 6120 6c65 6164 6572 2073 656e 6473 206f  a leader sends o
-00015bb0: 7574 2061 206d 6573 7361 6765 2c20 7468  ut a message, th
-00015bc0: 6520 696e 6465 7820 6f66 2074 6865 206c  e index of the l
-00015bd0: 6173 740a 2020 2020 2020 2020 656e 7472  ast.        entr
-00015be0: 7920 7368 6f75 6c64 2062 6520 6164 6465  y should be adde
-00015bf0: 6420 746f 2069 6e66 6c69 6768 7473 2e20  d to inflights. 
-00015c00: 5468 6520 696e 6465 7820 4d55 5354 2062  The index MUST b
-00015c10: 6520 6164 6465 640a 2020 2020 2020 2020  e added.        
-00015c20: 696e 746f 2069 6e66 6c69 6768 7473 2069  into inflights i
-00015c30: 6e20 6f72 6465 722e 0a20 2020 2020 2020  n order..       
-00015c40: 2057 6865 6e20 6120 6c65 6164 6572 2072   When a leader r
-00015c50: 6563 6569 7665 7320 6120 7265 706c 792c  eceives a reply,
-00015c60: 2074 6865 2070 7265 7669 6f75 7320 696e   the previous in
-00015c70: 666c 6967 6874 7320 7368 6f75 6c64 0a20  flights should. 
-00015c80: 2020 2020 2020 2062 6520 6672 6565 6420         be freed 
-00015c90: 6279 2063 616c 6c69 6e67 2069 6e66 6c69  by calling infli
-00015ca0: 6768 7473 2e66 7265 6554 6f2e 0a20 2020  ghts.freeTo..   
-00015cb0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00015cc0: 2073 6574 5f69 6e73 2873 656c 662c 2069   set_ins(self, i
-00015cd0: 6e66 6c69 6768 7473 3a20 2249 6e66 6c69  nflights: "Infli
-00015ce0: 6768 7473 2220 7c20 2249 6e66 6c69 6768  ghts" | "Infligh
-00015cf0: 7473 5265 6622 2920 2d3e 204e 6f6e 653a  tsRef") -> None:
-00015d00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015d10: 2020 2020 2060 696e 7360 3a20 496e 666c       `ins`: Infl
-00015d20: 6967 6874 7320 6973 2061 2073 6c69 6469  ights is a slidi
-00015d30: 6e67 2077 696e 646f 7720 666f 7220 7468  ng window for th
-00015d40: 6520 696e 666c 6967 6874 206d 6573 7361  e inflight messa
-00015d50: 6765 732e 0a20 2020 2020 2020 2057 6865  ges..        Whe
-00015d60: 6e20 696e 666c 6967 6874 7320 6973 2066  n inflights is f
-00015d70: 756c 6c2c 206e 6f20 6d6f 7265 206d 6573  ull, no more mes
-00015d80: 7361 6765 2073 686f 756c 6420 6265 2073  sage should be s
-00015d90: 656e 742e 0a20 2020 2020 2020 2057 6865  ent..        Whe
-00015da0: 6e20 6120 6c65 6164 6572 2073 656e 6473  n a leader sends
-00015db0: 206f 7574 2061 206d 6573 7361 6765 2c20   out a message, 
-00015dc0: 7468 6520 696e 6465 7820 6f66 2074 6865  the index of the
-00015dd0: 206c 6173 740a 2020 2020 2020 2020 656e   last.        en
-00015de0: 7472 7920 7368 6f75 6c64 2062 6520 6164  try should be ad
-00015df0: 6465 6420 746f 2069 6e66 6c69 6768 7473  ded to inflights
-00015e00: 2e20 5468 6520 696e 6465 7820 4d55 5354  . The index MUST
-00015e10: 2062 6520 6164 6465 640a 2020 2020 2020   be added.      
-00015e20: 2020 696e 746f 2069 6e66 6c69 6768 7473    into inflights
-00015e30: 2069 6e20 6f72 6465 722e 0a20 2020 2020   in order..     
-00015e40: 2020 2057 6865 6e20 6120 6c65 6164 6572     When a leader
-00015e50: 2072 6563 6569 7665 7320 6120 7265 706c   receives a repl
-00015e60: 792c 2074 6865 2070 7265 7669 6f75 7320  y, the previous 
-00015e70: 696e 666c 6967 6874 7320 7368 6f75 6c64  inflights should
-00015e80: 0a20 2020 2020 2020 2062 6520 6672 6565  .        be free
-00015e90: 6420 6279 2063 616c 6c69 6e67 2069 6e66  d by calling inf
-00015ea0: 6c69 6768 7473 2e66 7265 6554 6f2e 0a20  lights.freeTo.. 
-00015eb0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
-00015ec0: 6566 2067 6574 5f63 6f6d 6d69 745f 6772  ef get_commit_gr
-00015ed0: 6f75 705f 6964 2873 656c 6629 202d 3e20  oup_id(self) -> 
-00015ee0: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-00015ef0: 0a20 2020 2020 2020 2060 636f 6d6d 6974  .        `commit
-00015f00: 5f67 726f 7570 5f69 6460 3a20 4f6e 6c79  _group_id`: Only
-00015f10: 206c 6f67 7320 7265 706c 6963 6174 6564   logs replicated
-00015f20: 2074 6f20 6469 6666 6572 656e 7420 6772   to different gr
-00015f30: 6f75 7020 7769 6c6c 2062 6520 636f 6d6d  oup will be comm
-00015f40: 6974 7465 6420 6966 2061 6e79 2067 726f  itted if any gro
-00015f50: 7570 2069 7320 636f 6e66 6967 7572 6564  up is configured
-00015f60: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00015f70: 2020 6465 6620 7365 745f 636f 6d6d 6974    def set_commit
-00015f80: 5f67 726f 7570 5f69 6428 7365 6c66 2c20  _group_id(self, 
-00015f90: 636f 6d6d 6974 5f67 726f 7570 5f69 643a  commit_group_id:
-00015fa0: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
-00015fb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015fc0: 2020 2060 636f 6d6d 6974 5f67 726f 7570     `commit_group
-00015fd0: 5f69 6460 3a20 4f6e 6c79 206c 6f67 7320  _id`: Only logs 
-00015fe0: 7265 706c 6963 6174 6564 2074 6f20 6469  replicated to di
-00015ff0: 6666 6572 656e 7420 6772 6f75 7020 7769  fferent group wi
-00016000: 6c6c 2062 6520 636f 6d6d 6974 7465 6420  ll be committed 
-00016010: 6966 2061 6e79 2067 726f 7570 2069 7320  if any group is 
-00016020: 636f 6e66 6967 7572 6564 2e0a 2020 2020  configured..    
-00016030: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
-00016040: 6765 745f 636f 6d6d 6974 7465 645f 696e  get_committed_in
-00016050: 6465 7828 7365 6c66 2920 2d3e 2069 6e74  dex(self) -> int
-00016060: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00016070: 2020 2020 2020 6063 6f6d 6d69 7474 6564        `committed
-00016080: 5f69 6e64 6578 603a 2043 6f6d 6d69 7474  _index`: Committ
-00016090: 6564 2069 6e64 6578 2069 6e20 7261 6674  ed index in raft
-000160a0: 5f6c 6f67 0a20 2020 2020 2020 2022 2222  _log.        """
-000160b0: 0a20 2020 2064 6566 2073 6574 5f63 6f6d  .    def set_com
-000160c0: 6d69 7474 6564 5f69 6e64 6578 2873 656c  mitted_index(sel
-000160d0: 662c 2063 6f6d 6d69 7474 6564 5f69 6e64  f, committed_ind
-000160e0: 6578 3a20 696e 7429 202d 3e20 4e6f 6e65  ex: int) -> None
-000160f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00016100: 2020 2020 2020 6063 6f6d 6d69 7474 6564        `committed
-00016110: 5f69 6e64 6578 603a 2043 6f6d 6d69 7474  _index`: Committ
-00016120: 6564 2069 6e64 6578 2069 6e20 7261 6674  ed index in raft
-00016130: 5f6c 6f67 0a20 2020 2020 2020 2022 2222  _log.        """
-00016140: 0a20 2020 2064 6566 2067 6574 5f6d 6174  .    def get_mat
-00016150: 6368 6564 2873 656c 6629 202d 3e20 696e  ched(self) -> in
-00016160: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-00016170: 2020 2020 2020 2060 6d61 7463 6865 6460         `matched`
-00016180: 3a20 486f 7720 6d75 6368 2073 7461 7465  : How much state
-00016190: 2069 7320 6d61 7463 6865 642e 0a20 2020   is matched..   
-000161a0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-000161b0: 2073 6574 5f6d 6174 6368 6564 2873 656c   set_matched(sel
-000161c0: 662c 206d 6174 6368 6564 3a20 696e 7429  f, matched: int)
-000161d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000161e0: 2020 2222 220a 2020 2020 2020 2020 606d    """.        `m
-000161f0: 6174 6368 6564 603a 2048 6f77 206d 7563  atched`: How muc
-00016200: 6820 7374 6174 6520 6973 206d 6174 6368  h state is match
-00016210: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-00016220: 2020 2020 6465 6620 6765 745f 6e65 7874      def get_next
-00016230: 5f69 6478 2873 656c 6629 202d 3e20 696e  _idx(self) -> in
-00016240: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-00016250: 2020 2020 2020 2060 6e65 7874 5f69 6478         `next_idx
-00016260: 603a 2054 6865 206e 6578 7420 696e 6465  `: The next inde
-00016270: 7820 746f 2061 7070 6c79 0a20 2020 2020  x to apply.     
-00016280: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
-00016290: 6574 5f6e 6578 745f 6964 7828 7365 6c66  et_next_idx(self
-000162a0: 2c20 6e65 7874 5f69 6478 3a20 696e 7429  , next_idx: int)
-000162b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000162c0: 2020 2222 220a 2020 2020 2020 2020 606e    """.        `n
-000162d0: 6578 745f 6964 7860 3a20 5468 6520 6e65  ext_idx`: The ne
-000162e0: 7874 2069 6e64 6578 2074 6f20 6170 706c  xt index to appl
-000162f0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-00016300: 2020 6465 6620 6765 745f 7065 6e64 696e    def get_pendin
-00016310: 675f 736e 6170 7368 6f74 2873 656c 6629  g_snapshot(self)
-00016320: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-00016330: 2022 2222 0a20 2020 2020 2020 2060 7065   """.        `pe
-00016340: 6e64 696e 675f 736e 6170 7368 6f74 603a  nding_snapshot`:
-00016350: 2054 6869 7320 6669 656c 6420 6973 2075   This field is u
-00016360: 7365 6420 696e 2050 726f 6772 6573 7353  sed in ProgressS
-00016370: 7461 7465 536e 6170 7368 6f74 2e0a 2020  tateSnapshot..  
-00016380: 2020 2020 2020 4966 2074 6865 7265 2069        If there i
-00016390: 7320 6120 7065 6e64 696e 6720 736e 6170  s a pending snap
-000163a0: 7368 6f74 2c20 7468 6520 7065 6e64 696e  shot, the pendin
-000163b0: 6753 6e61 7073 686f 7420 7769 6c6c 2062  gSnapshot will b
-000163c0: 6520 7365 7420 746f 2074 6865 0a20 2020  e set to the.   
-000163d0: 2020 2020 2069 6e64 6578 206f 6620 7468       index of th
-000163e0: 6520 736e 6170 7368 6f74 2e20 4966 2070  e snapshot. If p
-000163f0: 656e 6469 6e67 536e 6170 7368 6f74 2069  endingSnapshot i
-00016400: 7320 7365 742c 2074 6865 2072 6570 6c69  s set, the repli
-00016410: 6361 7469 6f6e 2070 726f 6365 7373 206f  cation process o
-00016420: 660a 2020 2020 2020 2020 7468 6973 2050  f.        this P
-00016430: 726f 6772 6573 7320 7769 6c6c 2062 6520  rogress will be 
-00016440: 7061 7573 6564 2e20 7261 6674 2077 696c  paused. raft wil
-00016450: 6c20 6e6f 7420 7265 7365 6e64 2073 6e61  l not resend sna
-00016460: 7073 686f 7420 756e 7469 6c20 7468 6520  pshot until the 
-00016470: 7065 6e64 696e 6720 6f6e 650a 2020 2020  pending one.    
-00016480: 2020 2020 6973 2072 6570 6f72 7465 6420      is reported 
-00016490: 746f 2062 6520 6661 696c 6564 2e0a 2020  to be failed..  
-000164a0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-000164b0: 6620 7365 745f 7065 6e64 696e 675f 736e  f set_pending_sn
-000164c0: 6170 7368 6f74 2873 656c 662c 2070 656e  apshot(self, pen
-000164d0: 6469 6e67 5f73 6e61 7073 686f 743a 2069  ding_snapshot: i
-000164e0: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-000164f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016500: 2060 7065 6e64 696e 675f 736e 6170 7368   `pending_snapsh
-00016510: 6f74 603a 2054 6869 7320 6669 656c 6420  ot`: This field 
-00016520: 6973 2075 7365 6420 696e 2050 726f 6772  is used in Progr
-00016530: 6573 7353 7461 7465 536e 6170 7368 6f74  essStateSnapshot
-00016540: 2e0a 2020 2020 2020 2020 4966 2074 6865  ..        If the
-00016550: 7265 2069 7320 6120 7065 6e64 696e 6720  re is a pending 
-00016560: 736e 6170 7368 6f74 2c20 7468 6520 7065  snapshot, the pe
-00016570: 6e64 696e 6753 6e61 7073 686f 7420 7769  ndingSnapshot wi
-00016580: 6c6c 2062 6520 7365 7420 746f 2074 6865  ll be set to the
-00016590: 0a20 2020 2020 2020 2069 6e64 6578 206f  .        index o
-000165a0: 6620 7468 6520 736e 6170 7368 6f74 2e20  f the snapshot. 
-000165b0: 4966 2070 656e 6469 6e67 536e 6170 7368  If pendingSnapsh
-000165c0: 6f74 2069 7320 7365 742c 2074 6865 2072  ot is set, the r
-000165d0: 6570 6c69 6361 7469 6f6e 2070 726f 6365  eplication proce
-000165e0: 7373 206f 660a 2020 2020 2020 2020 7468  ss of.        th
-000165f0: 6973 2050 726f 6772 6573 7320 7769 6c6c  is Progress will
-00016600: 2062 6520 7061 7573 6564 2e20 7261 6674   be paused. raft
-00016610: 2077 696c 6c20 6e6f 7420 7265 7365 6e64   will not resend
-00016620: 2073 6e61 7073 686f 7420 756e 7469 6c20   snapshot until 
-00016630: 7468 6520 7065 6e64 696e 6720 6f6e 650a  the pending one.
-00016640: 2020 2020 2020 2020 6973 2072 6570 6f72          is repor
-00016650: 7465 6420 746f 2062 6520 6661 696c 6564  ted to be failed
-00016660: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00016670: 2020 6465 6620 6765 745f 7065 6e64 696e    def get_pendin
-00016680: 675f 7265 7175 6573 745f 736e 6170 7368  g_request_snapsh
-00016690: 6f74 2873 656c 6629 202d 3e20 696e 743a  ot(self) -> int:
-000166a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000166b0: 2020 2020 2060 7065 6e64 696e 675f 7265       `pending_re
-000166c0: 7175 6573 745f 736e 6170 7368 6f74 603a  quest_snapshot`:
-000166d0: 2054 6869 7320 6669 656c 6420 6973 2075   This field is u
-000166e0: 7365 6420 696e 2072 6571 7565 7374 2073  sed in request s
-000166f0: 6e61 7073 686f 742e 0a20 2020 2020 2020  napshot..       
-00016700: 2049 6620 7468 6572 6520 6973 2061 2070   If there is a p
-00016710: 656e 6469 6e67 2072 6571 7565 7374 2073  ending request s
-00016720: 6e61 7073 686f 742c 2074 6869 7320 7769  napshot, this wi
-00016730: 6c6c 2062 6520 7365 7420 746f 2074 6865  ll be set to the
-00016740: 2072 6571 7565 7374 0a20 2020 2020 2020   request.       
-00016750: 2069 6e64 6578 206f 6620 7468 6520 736e   index of the sn
-00016760: 6170 7368 6f74 2e0a 2020 2020 2020 2020  apshot..        
-00016770: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
-00016780: 7065 6e64 696e 675f 7265 7175 6573 745f  pending_request_
-00016790: 736e 6170 7368 6f74 2873 656c 662c 2070  snapshot(self, p
-000167a0: 656e 6469 6e67 5f72 6571 7565 7374 5f73  ending_request_s
-000167b0: 6e61 7073 686f 743a 2069 6e74 2920 2d3e  napshot: int) ->
-000167c0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000167d0: 2222 0a20 2020 2020 2020 2060 7065 6e64  "".        `pend
-000167e0: 696e 675f 7265 7175 6573 745f 736e 6170  ing_request_snap
-000167f0: 7368 6f74 603a 2054 6869 7320 6669 656c  shot`: This fiel
-00016800: 6420 6973 2075 7365 6420 696e 2072 6571  d is used in req
-00016810: 7565 7374 2073 6e61 7073 686f 742e 0a20  uest snapshot.. 
-00016820: 2020 2020 2020 2049 6620 7468 6572 6520         If there 
-00016830: 6973 2061 2070 656e 6469 6e67 2072 6571  is a pending req
-00016840: 7565 7374 2073 6e61 7073 686f 742c 2074  uest snapshot, t
-00016850: 6869 7320 7769 6c6c 2062 6520 7365 7420  his will be set 
-00016860: 746f 2074 6865 2072 6571 7565 7374 0a20  to the request. 
-00016870: 2020 2020 2020 2069 6e64 6578 206f 6620         index of 
-00016880: 7468 6520 736e 6170 7368 6f74 2e0a 2020  the snapshot..  
-00016890: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-000168a0: 6620 6765 745f 7265 6365 6e74 5f61 6374  f get_recent_act
-000168b0: 6976 6528 7365 6c66 2920 2d3e 2062 6f6f  ive(self) -> boo
-000168c0: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
-000168d0: 2020 2020 2020 2060 7265 6365 6e74 5f61         `recent_a
-000168e0: 6374 6976 6560 3a20 5468 6973 2069 7320  ctive`: This is 
-000168f0: 7472 7565 2069 6620 7468 6520 7072 6f67  true if the prog
-00016900: 7265 7373 2069 7320 7265 6365 6e74 6c79  ress is recently
-00016910: 2061 6374 6976 652e 2052 6563 6569 7669   active. Receivi
-00016920: 6e67 2061 6e79 206d 6573 7361 6765 730a  ng any messages.
-00016930: 2020 2020 2020 2020 6672 6f6d 2074 6865          from the
-00016940: 2063 6f72 7265 7370 6f6e 6469 6e67 2066   corresponding f
-00016950: 6f6c 6c6f 7765 7220 696e 6469 6361 7465  ollower indicate
-00016960: 7320 7468 6520 7072 6f67 7265 7373 2069  s the progress i
-00016970: 7320 6163 7469 7665 2e0a 2020 2020 2020  s active..      
-00016980: 2020 5265 6365 6e74 4163 7469 7665 2063    RecentActive c
-00016990: 616e 2062 6520 7265 7365 7420 746f 2066  an be reset to f
-000169a0: 616c 7365 2061 6674 6572 2061 6e20 656c  alse after an el
-000169b0: 6563 7469 6f6e 2074 696d 656f 7574 2e0a  ection timeout..
-000169c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000169d0: 6465 6620 7365 745f 7265 6365 6e74 5f61  def set_recent_a
-000169e0: 6374 6976 6528 7365 6c66 2c20 7265 6365  ctive(self, rece
-000169f0: 6e74 5f61 6374 6976 653a 2062 6f6f 6c29  nt_active: bool)
-00016a00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00016a10: 2020 2222 220a 2020 2020 2020 2020 6072    """.        `r
-00016a20: 6563 656e 745f 6163 7469 7665 603a 2054  ecent_active`: T
-00016a30: 6869 7320 6973 2074 7275 6520 6966 2074  his is true if t
-00016a40: 6865 2070 726f 6772 6573 7320 6973 2072  he progress is r
-00016a50: 6563 656e 746c 7920 6163 7469 7665 2e20  ecently active. 
-00016a60: 5265 6365 6976 696e 6720 616e 7920 6d65  Receiving any me
-00016a70: 7373 6167 6573 0a20 2020 2020 2020 2066  ssages.        f
-00016a80: 726f 6d20 7468 6520 636f 7272 6573 706f  rom the correspo
-00016a90: 6e64 696e 6720 666f 6c6c 6f77 6572 2069  nding follower i
-00016aa0: 6e64 6963 6174 6573 2074 6865 2070 726f  ndicates the pro
-00016ab0: 6772 6573 7320 6973 2061 6374 6976 652e  gress is active.
-00016ac0: 0a20 2020 2020 2020 2052 6563 656e 7441  .        RecentA
-00016ad0: 6374 6976 6520 6361 6e20 6265 2072 6573  ctive can be res
-00016ae0: 6574 2074 6f20 6661 6c73 6520 6166 7465  et to false afte
-00016af0: 7220 616e 2065 6c65 6374 696f 6e20 7469  r an election ti
-00016b00: 6d65 6f75 742e 0a20 2020 2020 2020 2022  meout..        "
-00016b10: 2222 0a20 2020 2064 6566 2067 6574 5f70  "".    def get_p
-00016b20: 6175 7365 6428 7365 6c66 2920 2d3e 2062  aused(self) -> b
-00016b30: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-00016b40: 0a20 2020 2020 2020 2060 7061 7573 6564  .        `paused
-00016b50: 603a 2050 6175 7365 6420 6973 2075 7365  `: Paused is use
-00016b60: 6420 696e 2050 726f 6772 6573 7353 7461  d in ProgressSta
-00016b70: 7465 5072 6f62 652e 0a20 2020 2020 2020  teProbe..       
-00016b80: 2057 6865 6e20 5061 7573 6564 2069 7320   When Paused is 
-00016b90: 7472 7565 2c20 7261 6674 2073 686f 756c  true, raft shoul
-00016ba0: 6420 7061 7573 6520 7365 6e64 696e 6720  d pause sending 
-00016bb0: 7265 706c 6963 6174 696f 6e20 6d65 7373  replication mess
-00016bc0: 6167 6520 746f 2074 6869 7320 7065 6572  age to this peer
-00016bd0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00016be0: 2020 6465 6620 7365 745f 7061 7573 6564    def set_paused
-00016bf0: 2873 656c 662c 2070 6175 7365 643a 2062  (self, paused: b
-00016c00: 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a 2020  ool) -> None:.  
-00016c10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016c20: 2020 6070 6175 7365 6460 3a20 5061 7573    `paused`: Paus
-00016c30: 6564 2069 7320 7573 6564 2069 6e20 5072  ed is used in Pr
-00016c40: 6f67 7265 7373 5374 6174 6550 726f 6265  ogressStateProbe
-00016c50: 2e0a 2020 2020 2020 2020 5768 656e 2050  ..        When P
-00016c60: 6175 7365 6420 6973 2074 7275 652c 2072  aused is true, r
-00016c70: 6166 7420 7368 6f75 6c64 2070 6175 7365  aft should pause
-00016c80: 2073 656e 6469 6e67 2072 6570 6c69 6361   sending replica
-00016c90: 7469 6f6e 206d 6573 7361 6765 2074 6f20  tion message to 
-00016ca0: 7468 6973 2070 6565 722e 0a20 2020 2020  this peer..     
-00016cb0: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
-00016cc0: 6574 5f73 7461 7465 2873 656c 6629 202d  et_state(self) -
-00016cd0: 3e20 2250 726f 6772 6573 7353 7461 7465  > "ProgressState
-00016ce0: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
-00016cf0: 2020 2020 2020 2060 7374 6174 6560 3a20         `state`: 
-00016d00: 5768 656e 2069 6e20 5072 6f67 7265 7373  When in Progress
-00016d10: 5374 6174 6550 726f 6265 2c20 6c65 6164  StateProbe, lead
-00016d20: 6572 2073 656e 6473 2061 7420 6d6f 7374  er sends at most
-00016d30: 206f 6e65 2072 6570 6c69 6361 7469 6f6e   one replication
-00016d40: 206d 6573 7361 6765 0a20 2020 2020 2020   message.       
-00016d50: 2070 6572 2068 6561 7274 6265 6174 2069   per heartbeat i
-00016d60: 6e74 6572 7661 6c2e 2049 7420 616c 736f  nterval. It also
-00016d70: 2070 726f 6265 7320 6163 7475 616c 2070   probes actual p
-00016d80: 726f 6772 6573 7320 6f66 2074 6865 2066  rogress of the f
-00016d90: 6f6c 6c6f 7765 722e 0a0a 2020 2020 2020  ollower...      
-00016da0: 2020 5768 656e 2069 6e20 5072 6f67 7265    When in Progre
-00016db0: 7373 5374 6174 6552 6570 6c69 6361 7465  ssStateReplicate
-00016dc0: 2c20 6c65 6164 6572 206f 7074 696d 6973  , leader optimis
-00016dd0: 7469 6361 6c6c 7920 696e 6372 6561 7365  tically increase
-00016de0: 7320 6e65 7874 0a20 2020 2020 2020 2074  s next.        t
-00016df0: 6f20 7468 6520 6c61 7465 7374 2065 6e74  o the latest ent
-00016e00: 7279 2073 656e 7420 6166 7465 7220 7365  ry sent after se
-00016e10: 6e64 696e 6720 7265 706c 6963 6174 696f  nding replicatio
-00016e20: 6e20 6d65 7373 6167 652e 2054 6869 7320  n message. This 
-00016e30: 6973 0a20 2020 2020 2020 2061 6e20 6f70  is.        an op
-00016e40: 7469 6d69 7a65 6420 7374 6174 6520 666f  timized state fo
-00016e50: 7220 6661 7374 2072 6570 6c69 6361 7469  r fast replicati
-00016e60: 6e67 206c 6f67 2065 6e74 7269 6573 2074  ng log entries t
-00016e70: 6f20 7468 6520 666f 6c6c 6f77 6572 2e0a  o the follower..
-00016e80: 0a20 2020 2020 2020 2057 6865 6e20 696e  .        When in
-00016e90: 2050 726f 6772 6573 7353 7461 7465 536e   ProgressStateSn
-00016ea0: 6170 7368 6f74 2c20 6c65 6164 6572 2073  apshot, leader s
-00016eb0: 686f 756c 6420 6861 7665 2073 656e 7420  hould have sent 
-00016ec0: 6f75 7420 736e 6170 7368 6f74 0a20 2020  out snapshot.   
-00016ed0: 2020 2020 2062 6566 6f72 6520 616e 6420       before and 
-00016ee0: 7374 6f70 2073 656e 6469 6e67 2061 6e79  stop sending any
-00016ef0: 2072 6570 6c69 6361 7469 6f6e 206d 6573   replication mes
-00016f00: 7361 6765 2e0a 2020 2020 2020 2020 2222  sage..        ""
-00016f10: 220a 2020 2020 6465 6620 7365 745f 7374  ".    def set_st
-00016f20: 6174 6528 7365 6c66 2c20 7374 6174 653a  ate(self, state:
-00016f30: 2022 5072 6f67 7265 7373 5374 6174 6522   "ProgressState"
-00016f40: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00016f50: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00016f60: 7374 6174 6560 3a20 5768 656e 2069 6e20  state`: When in 
-00016f70: 5072 6f67 7265 7373 5374 6174 6550 726f  ProgressStatePro
-00016f80: 6265 2c20 6c65 6164 6572 2073 656e 6473  be, leader sends
-00016f90: 2061 7420 6d6f 7374 206f 6e65 2072 6570   at most one rep
-00016fa0: 6c69 6361 7469 6f6e 206d 6573 7361 6765  lication message
-00016fb0: 0a20 2020 2020 2020 2070 6572 2068 6561  .        per hea
-00016fc0: 7274 6265 6174 2069 6e74 6572 7661 6c2e  rtbeat interval.
-00016fd0: 2049 7420 616c 736f 2070 726f 6265 7320   It also probes 
-00016fe0: 6163 7475 616c 2070 726f 6772 6573 7320  actual progress 
-00016ff0: 6f66 2074 6865 2066 6f6c 6c6f 7765 722e  of the follower.
-00017000: 0a0a 2020 2020 2020 2020 5768 656e 2069  ..        When i
-00017010: 6e20 5072 6f67 7265 7373 5374 6174 6552  n ProgressStateR
-00017020: 6570 6c69 6361 7465 2c20 6c65 6164 6572  eplicate, leader
-00017030: 206f 7074 696d 6973 7469 6361 6c6c 7920   optimistically 
-00017040: 696e 6372 6561 7365 7320 6e65 7874 0a20  increases next. 
-00017050: 2020 2020 2020 2074 6f20 7468 6520 6c61         to the la
-00017060: 7465 7374 2065 6e74 7279 2073 656e 7420  test entry sent 
-00017070: 6166 7465 7220 7365 6e64 696e 6720 7265  after sending re
-00017080: 706c 6963 6174 696f 6e20 6d65 7373 6167  plication messag
-00017090: 652e 2054 6869 7320 6973 0a20 2020 2020  e. This is.     
-000170a0: 2020 2061 6e20 6f70 7469 6d69 7a65 6420     an optimized 
-000170b0: 7374 6174 6520 666f 7220 6661 7374 2072  state for fast r
-000170c0: 6570 6c69 6361 7469 6e67 206c 6f67 2065  eplicating log e
-000170d0: 6e74 7269 6573 2074 6f20 7468 6520 666f  ntries to the fo
-000170e0: 6c6c 6f77 6572 2e0a 0a20 2020 2020 2020  llower...       
-000170f0: 2057 6865 6e20 696e 2050 726f 6772 6573   When in Progres
-00017100: 7353 7461 7465 536e 6170 7368 6f74 2c20  sStateSnapshot, 
-00017110: 6c65 6164 6572 2073 686f 756c 6420 6861  leader should ha
-00017120: 7665 2073 656e 7420 6f75 7420 736e 6170  ve sent out snap
-00017130: 7368 6f74 0a20 2020 2020 2020 2062 6566  shot.        bef
-00017140: 6f72 6520 616e 6420 7374 6f70 2073 656e  ore and stop sen
-00017150: 6469 6e67 2061 6e79 2072 6570 6c69 6361  ding any replica
-00017160: 7469 6f6e 206d 6573 7361 6765 2e0a 2020  tion message..  
-00017170: 2020 2020 2020 2222 220a 0a63 6c61 7373        """..class
-00017180: 2050 726f 6772 6573 7328 5f5f 4150 495f   Progress(__API_
-00017190: 5072 6f67 7265 7373 293a 0a20 2020 2022  Progress):.    "
-000171a0: 2222 0a20 2020 2054 6865 2070 726f 6772  "".    The progr
-000171b0: 6573 7320 6f66 2063 6174 6368 696e 6720  ess of catching 
-000171c0: 7570 2066 726f 6d20 6120 7265 7374 6172  up from a restar
-000171d0: 742e 0a20 2020 2022 2222 0a0a 2020 2020  t..    """..    
-000171e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-000171f0: 662c 206e 6578 745f 6964 783a 2069 6e74  f, next_idx: int
-00017200: 2c20 696e 735f 7369 7a65 3a20 696e 7429  , ins_size: int)
-00017210: 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a 2020   -> None: ....  
-00017220: 2020 6465 6620 6d61 6b65 5f72 6566 2873    def make_ref(s
-00017230: 656c 6629 202d 3e20 2250 726f 6772 6573  elf) -> "Progres
-00017240: 7352 6566 223a 202e 2e2e 0a0a 636c 6173  sRef": .....clas
-00017250: 7320 5072 6f67 7265 7373 5265 6628 5f5f  s ProgressRef(__
-00017260: 4150 495f 5072 6f67 7265 7373 293a 0a20  API_Progress):. 
-00017270: 2020 2022 2222 0a20 2020 2052 6566 6572     """.    Refer
-00017280: 656e 6365 2074 7970 6520 6f66 203a 636c  ence type of :cl
-00017290: 6173 733a 6050 726f 6772 6573 7360 2e0a  ass:`Progress`..
-000172a0: 2020 2020 2222 220a 0a63 6c61 7373 205f      """..class _
-000172b0: 5f41 5049 5f4a 6f69 6e74 436f 6e66 6967  _API_JointConfig
-000172c0: 285f 5f43 6c6f 6e65 6162 6c65 293a 0a20  (__Cloneable):. 
-000172d0: 2020 2064 6566 2063 6c6f 6e65 2873 656c     def clone(sel
-000172e0: 6629 202d 3e20 224a 6f69 6e74 436f 6e66  f) -> "JointConf
-000172f0: 6967 223a 202e 2e2e 0a20 2020 2064 6566  ig": ....    def
-00017300: 2063 6c65 6172 2873 656c 6629 202d 3e20   clear(self) -> 
-00017310: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00017320: 2243 6c65 6172 7320 616c 6c20 4944 732e  "Clears all IDs.
-00017330: 2222 220a 2020 2020 6465 6620 636f 6e74  """.    def cont
-00017340: 6169 6e73 2873 656c 662c 2069 643a 2069  ains(self, id: i
-00017350: 6e74 2920 2d3e 2062 6f6f 6c3a 0a20 2020  nt) -> bool:.   
-00017360: 2020 2020 2022 2222 4368 6563 6b20 6966       """Check if
-00017370: 2061 6e20 6964 2069 7320 6120 766f 7465   an id is a vote
-00017380: 722e 2222 220a 2020 2020 6465 6620 6964  r.""".    def id
-00017390: 7328 2920 2d3e 2053 6574 5b69 6e74 5d3a  s() -> Set[int]:
-000173a0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000173b0: 726e 7320 616e 2069 7465 7261 746f 7220  rns an iterator 
-000173c0: 6f76 6572 2074 776f 2068 6173 6820 7365  over two hash se
-000173d0: 7420 7769 7468 6f75 7420 636c 6f6e 696e  t without clonin
-000173e0: 672e 2222 220a 2020 2020 6465 6620 6973  g.""".    def is
-000173f0: 5f73 696e 676c 6574 6f6e 2873 656c 6629  _singleton(self)
-00017400: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-00017410: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00017420: 7475 726e 7320 7472 7565 2069 6620 2861  turns true if (a
-00017430: 6e64 206f 6e6c 7920 6966 2920 7468 6572  nd only if) ther
-00017440: 6520 6973 206f 6e6c 7920 6f6e 6520 766f  e is only one vo
-00017450: 7469 6e67 206d 656d 6265 720a 2020 2020  ting member.    
-00017460: 2020 2020 2869 2e65 2e20 7468 6520 6c65      (i.e. the le
-00017470: 6164 6572 2920 696e 2074 6865 2063 7572  ader) in the cur
-00017480: 7265 6e74 2063 6f6e 6669 6775 7261 7469  rent configurati
-00017490: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
-000174a0: 0a63 6c61 7373 204a 6f69 6e74 436f 6e66  .class JointConf
-000174b0: 6967 285f 5f41 5049 5f4a 6f69 6e74 436f  ig(__API_JointCo
-000174c0: 6e66 6967 293a 0a20 2020 2022 2222 0a20  nfig):.    """. 
-000174d0: 2020 2041 2063 6f6e 6669 6775 7261 7469     A configurati
-000174e0: 6f6e 206f 6620 7477 6f20 6772 6f75 7073  on of two groups
-000174f0: 206f 6620 2870 6f73 7369 626c 7920 6f76   of (possibly ov
-00017500: 6572 6c61 7070 696e 6729 206d 616a 6f72  erlapping) major
-00017510: 6974 7920 636f 6e66 6967 7572 6174 696f  ity configuratio
-00017520: 6e73 2e0a 2020 2020 4465 6369 7369 6f6e  ns..    Decision
-00017530: 7320 7265 7175 6972 6520 7468 6520 7375  s require the su
-00017540: 7070 6f72 7420 6f66 2062 6f74 6820 6d61  pport of both ma
-00017550: 6a6f 7269 7469 6573 2e0a 2020 2020 2222  jorities..    ""
-00017560: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00017570: 745f 5f28 7365 6c66 2c20 766f 7465 7273  t__(self, voters
-00017580: 3a20 5365 745b 696e 745d 2920 2d3e 204e  : Set[int]) -> N
-00017590: 6f6e 653a 202e 2e2e 0a20 2020 2064 6566  one: ....    def
-000175a0: 206d 616b 655f 7265 6628 7365 6c66 2920   make_ref(self) 
-000175b0: 2d3e 2022 4a6f 696e 7443 6f6e 6669 6752  -> "JointConfigR
-000175c0: 6566 223a 202e 2e2e 0a0a 636c 6173 7320  ef": .....class 
-000175d0: 4a6f 696e 7443 6f6e 6669 6752 6566 285f  JointConfigRef(_
-000175e0: 5f41 5049 5f4a 6f69 6e74 436f 6e66 6967  _API_JointConfig
-000175f0: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-00017600: 6566 6572 656e 6365 2074 7970 6520 6f66  eference type of
-00017610: 203a 636c 6173 733a 604a 6f69 6e74 436f   :class:`JointCo
-00017620: 6e66 6967 602e 0a20 2020 2022 2222 0a0a  nfig`..    """..
-00017630: 636c 6173 7320 5f5f 4150 495f 4d61 6a6f  class __API_Majo
-00017640: 7269 7479 436f 6e66 6967 285f 5f43 6c6f  rityConfig(__Clo
-00017650: 6e65 6162 6c65 293a 0a20 2020 2064 6566  neable):.    def
-00017660: 2063 6c6f 6e65 2873 656c 6629 202d 3e20   clone(self) -> 
-00017670: 224d 616a 6f72 6974 7943 6f6e 6669 6722  "MajorityConfig"
-00017680: 3a20 2e2e 2e0a 2020 2020 6465 6620 7261  : ....    def ra
-00017690: 775f 736c 6963 6528 7365 6c66 2920 2d3e  w_slice(self) ->
-000176a0: 204c 6973 745b 696e 745d 3a0a 2020 2020   List[int]:.    
-000176b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000176c0: 5265 7475 726e 7320 7468 6520 4d61 6a6f  Returns the Majo
-000176d0: 7269 7479 436f 6e66 6967 2061 7320 6120  rityConfig as a 
-000176e0: 736c 6963 652e 0a20 2020 2020 2020 2022  slice..        "
-000176f0: 2222 0a20 2020 2064 6566 2063 6170 6163  "".    def capac
-00017700: 6974 7928 7365 6c66 2920 2d3e 2069 6e74  ity(self) -> int
-00017710: 3a0a 2020 2020 2020 2020 2222 2222 2222  :.        """"""
-00017720: 0a20 2020 2064 6566 2065 7874 656e 6428  .    def extend(
-00017730: 7365 6c66 2c20 6f74 6865 725f 7365 743a  self, other_set:
-00017740: 2053 6574 5b69 6e74 5d29 202d 3e20 4e6f   Set[int]) -> No
-00017750: 6e65 3a0a 2020 2020 2020 2020 2222 2222  ne:.        """"
-00017760: 2222 0a20 2020 2064 6566 2067 6574 2873  "".    def get(s
-00017770: 656c 662c 2069 6e64 6578 3a20 696e 7429  elf, index: int)
-00017780: 202d 3e20 4f70 7469 6f6e 616c 5b69 6e74   -> Optional[int
-00017790: 5d3a 0a20 2020 2020 2020 2022 2222 2222  ]:.        """""
-000177a0: 220a 2020 2020 6465 6620 696e 7365 7274  ".    def insert
-000177b0: 2873 656c 662c 2076 616c 7565 3a20 696e  (self, value: in
-000177c0: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
-000177d0: 2020 2020 2222 2222 2222 0a20 2020 2064      """""".    d
-000177e0: 6566 2072 6570 6c61 6365 2873 656c 662c  ef replace(self,
-000177f0: 2076 616c 7565 3a20 696e 7429 202d 3e20   value: int) -> 
-00017800: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-00017810: 2222 220a 2020 2020 6465 6620 6973 5f64  """.    def is_d
-00017820: 6973 6a6f 696e 7428 7365 6c66 2c20 6f74  isjoint(self, ot
-00017830: 6865 723a 2053 6574 5b69 6e74 5d29 202d  her: Set[int]) -
-00017840: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-00017850: 2222 2222 2222 0a20 2020 2064 6566 2069  """""".    def i
-00017860: 735f 7375 7065 7273 6574 2873 656c 662c  s_superset(self,
-00017870: 206f 7468 6572 3a20 5365 745b 696e 745d   other: Set[int]
-00017880: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-00017890: 2020 2022 2222 2222 220a 2020 2020 6465     """""".    de
-000178a0: 6620 6973 5f73 7562 7365 7428 7365 6c66  f is_subset(self
-000178b0: 2c20 6f74 6865 723a 2053 6574 5b69 6e74  , other: Set[int
-000178c0: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
-000178d0: 2020 2020 2222 2222 2222 0a20 2020 2064      """""".    d
-000178e0: 6566 2072 6573 6572 7665 2873 656c 662c  ef reserve(self,
-000178f0: 2061 6464 6974 696f 6e61 6c3a 2069 6e74   additional: int
-00017900: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00017910: 2020 2022 2222 2222 220a 2020 2020 6465     """""".    de
-00017920: 6620 7265 6d6f 7665 2873 656c 662c 2076  f remove(self, v
-00017930: 616c 7565 3a20 696e 7429 202d 3e20 626f  alue: int) -> bo
-00017940: 6f6c 3a0a 2020 2020 2020 2020 2222 2222  ol:.        """"
-00017950: 2222 0a20 2020 2064 6566 2073 6872 696e  "".    def shrin
-00017960: 6b5f 746f 2873 656c 662c 206d 696e 5f63  k_to(self, min_c
-00017970: 6170 6163 6974 793a 2069 6e74 2920 2d3e  apacity: int) ->
-00017980: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00017990: 2222 2222 220a 2020 2020 6465 6620 7368  """"".    def sh
-000179a0: 7269 6e6b 5f74 6f5f 6669 7428 7365 6c66  rink_to_fit(self
-000179b0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000179c0: 2020 2022 2222 2222 220a 2020 2020 6465     """""".    de
-000179d0: 6620 7472 795f 7265 7365 7276 6528 7365  f try_reserve(se
-000179e0: 6c66 2c20 6164 6469 7469 6f6e 616c 3a20  lf, additional: 
-000179f0: 696e 7429 202d 3e20 4e6f 6e65 3a0a 2020  int) -> None:.  
-00017a00: 2020 2020 2020 2222 2222 2222 0a0a 636c        """"""..cl
-00017a10: 6173 7320 4d61 6a6f 7269 7479 436f 6e66  ass MajorityConf
-00017a20: 6967 285f 5f41 5049 5f4d 616a 6f72 6974  ig(__API_Majorit
-00017a30: 7943 6f6e 6669 6729 3a0a 2020 2020 2222  yConfig):.    ""
-00017a40: 220a 2020 2020 4120 7365 7420 6f66 2049  ".    A set of I
-00017a50: 4473 2074 6861 7420 7573 6573 206d 616a  Ds that uses maj
-00017a60: 6f72 6974 7920 7175 6f72 756d 7320 746f  ority quorums to
-00017a70: 206d 616b 6520 6465 6369 7369 6f6e 732e   make decisions.
-00017a80: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00017a90: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00017aa0: 2076 6f74 6572 733a 2053 6574 5b69 6e74   voters: Set[int
-00017ab0: 5d29 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a  ]) -> None: ....
-00017ac0: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
-00017ad0: 2873 656c 6629 202d 3e20 224d 616a 6f72  (self) -> "Major
-00017ae0: 6974 7943 6f6e 6669 6752 6566 223a 202e  ityConfigRef": .
-00017af0: 2e2e 0a0a 636c 6173 7320 4d61 6a6f 7269  ....class Majori
-00017b00: 7479 436f 6e66 6967 5265 6628 5f5f 4150  tyConfigRef(__AP
-00017b10: 495f 4d61 6a6f 7269 7479 436f 6e66 6967  I_MajorityConfig
-00017b20: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-00017b30: 6566 6572 656e 6365 2074 7970 6520 6f66  eference type of
-00017b40: 203a 636c 6173 733a 604d 616a 6f72 6974   :class:`Majorit
-00017b50: 7943 6f6e 6669 6760 2e0a 2020 2020 2222  yConfig`..    ""
-00017b60: 220a 0a63 6c61 7373 205f 5f41 5049 5f49  "..class __API_I
-00017b70: 6e66 6c69 6768 7473 285f 5f43 6c6f 6e65  nflights(__Clone
-00017b80: 6162 6c65 293a 0a20 2020 2064 6566 2063  able):.    def c
-00017b90: 6c6f 6e65 2873 656c 6629 202d 3e20 2249  lone(self) -> "I
-00017ba0: 6e66 6c69 6768 7473 223a 202e 2e2e 0a20  nflights": .... 
-00017bb0: 2020 2064 6566 2061 6464 2873 656c 662c     def add(self,
-00017bc0: 2069 6e66 6c69 6768 743a 2069 6e74 2920   inflight: int) 
-00017bd0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00017be0: 2022 2222 4164 6473 2061 6e20 696e 666c   """Adds an infl
-00017bf0: 6967 6874 2069 6e74 6f20 696e 666c 6967  ight into inflig
-00017c00: 6874 7322 2222 0a20 2020 2064 6566 2066  hts""".    def f
-00017c10: 756c 6c28 7365 6c66 2920 2d3e 2062 6f6f  ull(self) -> boo
-00017c20: 6c3a 0a20 2020 2020 2020 2022 2222 5265  l:.        """Re
-00017c30: 7475 726e 7320 7472 7565 2069 6620 7468  turns true if th
-00017c40: 6520 696e 666c 6967 6874 7320 6973 2066  e inflights is f
-00017c50: 756c 6c2e 2222 220a 2020 2020 6465 6620  ull.""".    def 
-00017c60: 7265 7365 7428 7365 6c66 2920 2d3e 204e  reset(self) -> N
-00017c70: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00017c80: 4672 6565 7320 616c 6c20 696e 666c 6967  Frees all inflig
-00017c90: 6874 732e 2222 220a 2020 2020 6465 6620  hts.""".    def 
-00017ca0: 6672 6565 5f74 6f28 7365 6c66 2c20 746f  free_to(self, to
-00017cb0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-00017cc0: 2020 2020 2020 2020 2222 2246 7265 6573          """Frees
-00017cd0: 2074 6865 2069 6e66 6c69 6768 7473 2073   the inflights s
-00017ce0: 6d61 6c6c 6572 206f 7220 6571 7561 6c20  maller or equal 
-00017cf0: 746f 2074 6865 2067 6976 656e 2060 746f  to the given `to
-00017d00: 6020 666c 6967 6874 2e22 2222 0a20 2020  ` flight.""".   
-00017d10: 2064 6566 2066 7265 655f 6669 7273 745f   def free_first_
-00017d20: 6f6e 6528 7365 6c66 2920 2d3e 204e 6f6e  one(self) -> Non
-00017d30: 653a 0a20 2020 2020 2020 2022 2222 4672  e:.        """Fr
-00017d40: 6565 7320 7468 6520 6669 7273 7420 6275  ees the first bu
-00017d50: 6666 6572 2065 6e74 7279 2e22 2222 0a20  ffer entry.""". 
-00017d60: 2020 2064 6566 206d 6179 6265 5f66 7265     def maybe_fre
-00017d70: 655f 6275 6666 6572 2873 656c 6629 202d  e_buffer(self) -
-00017d80: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00017d90: 2222 2246 7265 6520 756e 7573 6564 206d  """Free unused m
-00017da0: 656d 6f72 7922 2222 0a20 2020 2064 6566  emory""".    def
-00017db0: 2062 7566 6665 725f 6361 7061 6369 7479   buffer_capacity
-00017dc0: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
-00017dd0: 2020 2020 2020 2022 2222 4361 7061 6369         """Capaci
-00017de0: 7479 206f 6620 7468 6520 696e 7465 726e  ty of the intern
-00017df0: 616c 2062 7566 6665 722e 2222 220a 2020  al buffer.""".  
-00017e00: 2020 6465 6620 6275 6666 6572 5f69 735f    def buffer_is_
-00017e10: 616c 6c6f 6361 7465 6428 7365 6c66 2920  allocated(self) 
-00017e20: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00017e30: 2022 2222 5768 6574 6865 7220 6275 6666   """Whether buff
-00017e40: 6572 2069 7320 616c 6c6f 6361 7465 6420  er is allocated 
-00017e50: 6f72 206e 6f74 2e20 4974 2773 2066 6f72  or not. It's for
-00017e60: 2074 6573 7473 2e22 2222 0a20 2020 2064   tests.""".    d
-00017e70: 6566 2063 6f75 6e74 2873 656c 6629 202d  ef count(self) -
-00017e80: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-00017e90: 2222 4e75 6d62 6572 206f 6620 696e 666c  ""Number of infl
-00017ea0: 6967 6874 206d 6573 7361 6765 732e 2049  ight messages. I
-00017eb0: 7427 7320 666f 7220 7465 7374 732e 2222  t's for tests.""
-00017ec0: 220a 2020 2020 6465 6620 7365 745f 6361  ".    def set_ca
-00017ed0: 7028 7365 6c66 2c20 696e 636f 6d69 6e67  p(self, incoming
-00017ee0: 5f63 6170 3a20 696e 7429 202d 3e20 4e6f  _cap: int) -> No
-00017ef0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00017f00: 2020 2020 2020 2020 4164 6a75 7374 2069          Adjust i
-00017f10: 6e66 6c69 6768 7420 6275 6666 6572 2063  nflight buffer c
-00017f20: 6170 6163 6974 792e 2053 6574 2069 7420  apacity. Set it 
-00017f30: 746f 2060 3060 2077 696c 6c20 6469 7361  to `0` will disa
-00017f40: 626c 6520 7468 6520 7072 6f67 7265 7373  ble the progress
-00017f50: 2e0a 2020 2020 2020 2020 4361 6c6c 696e  ..        Callin
-00017f60: 6720 6974 2062 6574 7765 656e 2060 7365  g it between `se
-00017f70: 6c66 2e66 756c 6c28 2960 2061 6e64 2060  lf.full()` and `
-00017f80: 7365 6c66 2e61 6464 2829 6020 6361 6e20  self.add()` can 
-00017f90: 6361 7573 6520 6120 7061 6e69 632e 0a20  cause a panic.. 
-00017fa0: 2020 2020 2020 2022 2222 0a0a 636c 6173         """..clas
-00017fb0: 7320 496e 666c 6967 6874 7328 5f5f 4150  s Inflights(__AP
-00017fc0: 495f 496e 666c 6967 6874 7329 3a0a 2020  I_Inflights):.  
-00017fd0: 2020 2222 220a 2020 2020 4120 6275 6666    """.    A buff
-00017fe0: 6572 206f 6620 696e 666c 6967 6874 206d  er of inflight m
-00017ff0: 6573 7361 6765 732e 0a20 2020 2022 2222  essages..    """
-00018000: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00018010: 5f5f 2873 656c 662c 2063 6170 3a20 696e  __(self, cap: in
-00018020: 7429 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a  t) -> None: ....
-00018030: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
-00018040: 2873 656c 6629 202d 3e20 2249 6e66 6c69  (self) -> "Infli
-00018050: 6768 7473 5265 6622 3a20 2e2e 2e0a 0a63  ghtsRef": .....c
-00018060: 6c61 7373 2049 6e66 6c69 6768 7473 5265  lass InflightsRe
-00018070: 6628 5f5f 4150 495f 496e 666c 6967 6874  f(__API_Inflight
-00018080: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
-00018090: 5265 6665 7265 6e63 6520 7479 7065 206f  Reference type o
-000180a0: 6620 3a63 6c61 7373 3a60 496e 666c 6967  f :class:`Inflig
-000180b0: 6874 7352 6566 602e 0a20 2020 2022 2222  htsRef`..    """
-000180c0: 0a0a 636c 6173 7320 5f5f 4150 495f 436f  ..class __API_Co
-000180d0: 6e66 6967 285f 5f43 6c6f 6e65 6162 6c65  nfig(__Cloneable
-000180e0: 293a 0a20 2020 2064 6566 2063 6c6f 6e65  ):.    def clone
-000180f0: 2873 656c 6629 202d 3e20 2243 6f6e 6669  (self) -> "Confi
-00018100: 6722 3a20 2e2e 2e0a 2020 2020 6465 6620  g": ....    def 
-00018110: 6d69 6e5f 656c 6563 7469 6f6e 5f74 6963  min_election_tic
-00018120: 6b28 7365 6c66 2920 2d3e 2069 6e74 3a0a  k(self) -> int:.
-00018130: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00018140: 2020 2020 606d 696e 5f65 6c65 6374 696f      `min_electio
-00018150: 6e5f 7469 636b 603a 2054 6865 206d 696e  n_tick`: The min
-00018160: 696d 756d 206e 756d 6265 7220 6f66 2074  imum number of t
-00018170: 6963 6b73 2062 6566 6f72 6520 616e 2065  icks before an e
-00018180: 6c65 6374 696f 6e2e 0a20 2020 2020 2020  lection..       
-00018190: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-000181a0: 5f6d 696e 5f65 6c65 6374 696f 6e5f 7469  _min_election_ti
-000181b0: 636b 2873 656c 662c 206d 696e 5f65 6c65  ck(self, min_ele
-000181c0: 6374 696f 6e5f 7469 636b 3a20 696e 7429  ction_tick: int)
-000181d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000181e0: 2020 2222 220a 2020 2020 2020 2020 606d    """.        `m
-000181f0: 696e 5f65 6c65 6374 696f 6e5f 7469 636b  in_election_tick
-00018200: 603a 2054 6865 206d 696e 696d 756d 206e  `: The minimum n
-00018210: 756d 6265 7220 6f66 2074 6963 6b73 2062  umber of ticks b
-00018220: 6566 6f72 6520 616e 2065 6c65 6374 696f  efore an electio
-00018230: 6e2e 0a20 2020 2020 2020 2022 2222 0a20  n..        """. 
-00018240: 2020 2064 6566 206d 6178 5f65 6c65 6374     def max_elect
-00018250: 696f 6e5f 7469 636b 2873 656c 6629 202d  ion_tick(self) -
-00018260: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-00018270: 2222 0a20 2020 2020 2020 2060 6d61 785f  "".        `max_
-00018280: 656c 6563 7469 6f6e 5f74 6963 6b60 3a20  election_tick`: 
-00018290: 5468 6520 6d61 7869 6d75 6d20 6e75 6d62  The maximum numb
-000182a0: 6572 206f 6620 7469 636b 7320 6265 666f  er of ticks befo
-000182b0: 7265 2061 6e20 656c 6563 7469 6f6e 2e0a  re an election..
-000182c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000182d0: 6465 6620 7365 745f 6d61 785f 656c 6563  def set_max_elec
-000182e0: 7469 6f6e 5f74 6963 6b28 7365 6c66 2c20  tion_tick(self, 
-000182f0: 6d61 785f 656c 6563 7469 6f6e 5f74 6963  max_election_tic
-00018300: 6b3a 2069 6e74 2920 2d3e 204e 6f6e 653a  k: int) -> None:
-00018310: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00018320: 2020 2020 2060 6d61 785f 656c 6563 7469       `max_electi
-00018330: 6f6e 5f74 6963 6b60 3a20 5468 6520 6d61  on_tick`: The ma
-00018340: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
-00018350: 7469 636b 7320 6265 666f 7265 2061 6e20  ticks before an 
-00018360: 656c 6563 7469 6f6e 2e0a 2020 2020 2020  election..      
-00018370: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
-00018380: 745f 7265 6164 5f6f 6e6c 795f 6f70 7469  t_read_only_opti
-00018390: 6f6e 2873 656c 6629 202d 3e20 2252 6561  on(self) -> "Rea
-000183a0: 644f 6e6c 794f 7074 696f 6e22 3a0a 2020  dOnlyOption":.  
-000183b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000183c0: 2020 6072 6561 645f 6f6e 6c79 5f6f 7074    `read_only_opt
-000183d0: 696f 6e60 3a20 4368 6f6f 7365 2074 6865  ion`: Choose the
-000183e0: 206c 696e 6561 7269 7a61 6269 6c69 7479   linearizability
-000183f0: 206d 6f64 6520 6f72 2074 6865 206c 6561   mode or the lea
-00018400: 7365 206d 6f64 6520 746f 2072 6561 6420  se mode to read 
-00018410: 6461 7461 2e20 4966 2079 6f75 2064 6f6e  data. If you don
-00018420: e280 9974 2063 6172 6520 6162 6f75 7420  ...t care about 
-00018430: 7468 6520 7265 6164 2063 6f6e 7369 7374  the read consist
-00018440: 656e 6379 2061 6e64 2077 616e 7420 6120  ency and want a 
-00018450: 6869 6768 6572 2072 6561 6420 7065 7266  higher read perf
-00018460: 6f72 6d61 6e63 652c 2079 6f75 2063 616e  ormance, you can
-00018470: 2075 7365 2074 6865 206c 6561 7365 206d   use the lease m
-00018480: 6f64 652e 0a20 2020 2020 2020 2053 6574  ode..        Set
-00018490: 7469 6e67 2074 6869 7320 746f 2060 4c65  ting this to `Le
-000184a0: 6173 6542 6173 6564 6020 7265 7175 6972  aseBased` requir
-000184b0: 6573 2060 6368 6563 6b5f 7175 6f72 756d  es `check_quorum
-000184c0: 203d 2074 7275 6560 2e0a 2020 2020 2020   = true`..      
-000184d0: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
-000184e0: 745f 7265 6164 5f6f 6e6c 795f 6f70 7469  t_read_only_opti
-000184f0: 6f6e 2873 656c 662c 2072 6561 645f 6f6e  on(self, read_on
-00018500: 6c79 5f6f 7074 696f 6e3a 2022 5265 6164  ly_option: "Read
-00018510: 4f6e 6c79 4f70 7469 6f6e 2229 202d 3e20  OnlyOption") -> 
-00018520: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00018530: 220a 2020 2020 2020 2020 6072 6561 645f  ".        `read_
-00018540: 6f6e 6c79 5f6f 7074 696f 6e60 3a20 4368  only_option`: Ch
-00018550: 6f6f 7365 2074 6865 206c 696e 6561 7269  oose the lineari
-00018560: 7a61 6269 6c69 7479 206d 6f64 6520 6f72  zability mode or
-00018570: 2074 6865 206c 6561 7365 206d 6f64 6520   the lease mode 
-00018580: 746f 2072 6561 6420 6461 7461 2e20 4966  to read data. If
-00018590: 2079 6f75 2064 6f6e e280 9974 2063 6172   you don...t car
-000185a0: 6520 6162 6f75 7420 7468 6520 7265 6164  e about the read
-000185b0: 2063 6f6e 7369 7374 656e 6379 2061 6e64   consistency and
-000185c0: 2077 616e 7420 6120 6869 6768 6572 2072   want a higher r
-000185d0: 6561 6420 7065 7266 6f72 6d61 6e63 652c  ead performance,
-000185e0: 2079 6f75 2063 616e 2075 7365 2074 6865   you can use the
-000185f0: 206c 6561 7365 206d 6f64 652e 0a20 2020   lease mode..   
-00018600: 2020 2020 2053 6574 7469 6e67 2074 6869       Setting thi
-00018610: 7320 746f 2060 4c65 6173 6542 6173 6564  s to `LeaseBased
-00018620: 6020 7265 7175 6972 6573 2060 6368 6563  ` requires `chec
-00018630: 6b5f 7175 6f72 756d 203d 2074 7275 6560  k_quorum = true`
-00018640: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00018650: 2020 6465 6620 6765 745f 6964 2873 656c    def get_id(sel
-00018660: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-00018670: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00018680: 6964 603a 2054 6865 2069 6465 6e74 6974  id`: The identit
-00018690: 7920 6f66 2074 6865 206c 6f63 616c 2072  y of the local r
-000186a0: 6166 742e 2049 7420 6361 6e6e 6f74 2062  aft. It cannot b
-000186b0: 6520 302c 2061 6e64 206d 7573 7420 6265  e 0, and must be
-000186c0: 2075 6e69 7175 6520 696e 2074 6865 2067   unique in the g
-000186d0: 726f 7570 2e0a 2020 2020 2020 2020 2222  roup..        ""
-000186e0: 220a 2020 2020 6465 6620 7365 745f 6964  ".    def set_id
-000186f0: 2873 656c 662c 2069 643a 2069 6e74 2920  (self, id: int) 
-00018700: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00018710: 2022 2222 0a20 2020 2020 2020 2060 6964   """.        `id
-00018720: 603a 2054 6865 2069 6465 6e74 6974 7920  `: The identity 
-00018730: 6f66 2074 6865 206c 6f63 616c 2072 6166  of the local raf
-00018740: 742e 2049 7420 6361 6e6e 6f74 2062 6520  t. It cannot be 
-00018750: 302c 2061 6e64 206d 7573 7420 6265 2075  0, and must be u
-00018760: 6e69 7175 6520 696e 2074 6865 2067 726f  nique in the gro
-00018770: 7570 2e0a 2020 2020 2020 2020 2222 220a  up..        """.
-00018780: 2020 2020 6465 6620 6765 745f 656c 6563      def get_elec
-00018790: 7469 6f6e 5f74 6963 6b28 7365 6c66 2920  tion_tick(self) 
-000187a0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-000187b0: 2222 220a 2020 2020 2020 2020 6065 6c65  """.        `ele
-000187c0: 6374 696f 6e5f 7469 636b 603a 2054 6865  ction_tick`: The
-000187d0: 206e 756d 6265 7220 6f66 206e 6f64 652e   number of node.
-000187e0: 7469 636b 2069 6e76 6f63 6174 696f 6e73  tick invocations
-000187f0: 2074 6861 7420 6d75 7374 2070 6173 7320   that must pass 
-00018800: 6265 7477 6565 6e0a 2020 2020 2020 2020  between.        
-00018810: 656c 6563 7469 6f6e 732e 2054 6861 7420  elections. That 
-00018820: 6973 2c20 6966 2061 2066 6f6c 6c6f 7765  is, if a followe
-00018830: 7220 646f 6573 206e 6f74 2072 6563 6569  r does not recei
-00018840: 7665 2061 6e79 206d 6573 7361 6765 2066  ve any message f
-00018850: 726f 6d20 7468 650a 2020 2020 2020 2020  rom the.        
-00018860: 6c65 6164 6572 206f 6620 6375 7272 656e  leader of curren
-00018870: 7420 7465 726d 2062 6566 6f72 6520 456c  t term before El
-00018880: 6563 7469 6f6e 5469 636b 2068 6173 2065  ectionTick has e
-00018890: 6c61 7073 6564 2c20 6974 2077 696c 6c20  lapsed, it will 
-000188a0: 6265 636f 6d65 0a20 2020 2020 2020 2063  become.        c
-000188b0: 616e 6469 6461 7465 2061 6e64 2073 7461  andidate and sta
-000188c0: 7274 2061 6e20 656c 6563 7469 6f6e 2e20  rt an election. 
-000188d0: 656c 6563 7469 6f6e 5f74 6963 6b20 6d75  election_tick mu
-000188e0: 7374 2062 6520 6772 6561 7465 7220 7468  st be greater th
-000188f0: 616e 0a20 2020 2020 2020 2048 6561 7274  an.        Heart
-00018900: 6265 6174 5469 636b 2e20 5765 2073 7567  beatTick. We sug
-00018910: 6765 7374 2065 6c65 6374 696f 6e5f 7469  gest election_ti
-00018920: 636b 203d 2031 3020 2a20 4865 6172 7462  ck = 10 * Heartb
-00018930: 6561 7454 6963 6b20 746f 2061 766f 6964  eatTick to avoid
-00018940: 0a20 2020 2020 2020 2075 6e6e 6563 6573  .        unneces
-00018950: 7361 7279 206c 6561 6465 7220 7377 6974  sary leader swit
-00018960: 6368 696e 670a 2020 2020 2020 2020 2222  ching.        ""
-00018970: 220a 2020 2020 6465 6620 7365 745f 656c  ".    def set_el
-00018980: 6563 7469 6f6e 5f74 6963 6b28 7365 6c66  ection_tick(self
-00018990: 2c20 656c 6563 7469 6f6e 5f74 6963 6b3a  , election_tick:
-000189a0: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
-000189b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000189c0: 2020 2060 656c 6563 7469 6f6e 5f74 6963     `election_tic
-000189d0: 6b60 3a20 5468 6520 6e75 6d62 6572 206f  k`: The number o
-000189e0: 6620 6e6f 6465 2e74 6963 6b20 696e 766f  f node.tick invo
-000189f0: 6361 7469 6f6e 7320 7468 6174 206d 7573  cations that mus
-00018a00: 7420 7061 7373 2062 6574 7765 656e 0a20  t pass between. 
-00018a10: 2020 2020 2020 2065 6c65 6374 696f 6e73         elections
-00018a20: 2e20 5468 6174 2069 732c 2069 6620 6120  . That is, if a 
-00018a30: 666f 6c6c 6f77 6572 2064 6f65 7320 6e6f  follower does no
-00018a40: 7420 7265 6365 6976 6520 616e 7920 6d65  t receive any me
-00018a50: 7373 6167 6520 6672 6f6d 2074 6865 0a20  ssage from the. 
-00018a60: 2020 2020 2020 206c 6561 6465 7220 6f66         leader of
-00018a70: 2063 7572 7265 6e74 2074 6572 6d20 6265   current term be
-00018a80: 666f 7265 2045 6c65 6374 696f 6e54 6963  fore ElectionTic
-00018a90: 6b20 6861 7320 656c 6170 7365 642c 2069  k has elapsed, i
-00018aa0: 7420 7769 6c6c 2062 6563 6f6d 650a 2020  t will become.  
-00018ab0: 2020 2020 2020 6361 6e64 6964 6174 6520        candidate 
-00018ac0: 616e 6420 7374 6172 7420 616e 2065 6c65  and start an ele
-00018ad0: 6374 696f 6e2e 2065 6c65 6374 696f 6e5f  ction. election_
-00018ae0: 7469 636b 206d 7573 7420 6265 2067 7265  tick must be gre
-00018af0: 6174 6572 2074 6861 6e0a 2020 2020 2020  ater than.      
-00018b00: 2020 4865 6172 7462 6561 7454 6963 6b2e    HeartbeatTick.
-00018b10: 2057 6520 7375 6767 6573 7420 656c 6563   We suggest elec
-00018b20: 7469 6f6e 5f74 6963 6b20 3d20 3130 202a  tion_tick = 10 *
-00018b30: 2048 6561 7274 6265 6174 5469 636b 2074   HeartbeatTick t
-00018b40: 6f20 6176 6f69 640a 2020 2020 2020 2020  o avoid.        
-00018b50: 756e 6e65 6365 7373 6172 7920 6c65 6164  unnecessary lead
-00018b60: 6572 2073 7769 7463 6869 6e67 0a20 2020  er switching.   
-00018b70: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00018b80: 2067 6574 5f68 6561 7274 6265 6174 5f74   get_heartbeat_t
-00018b90: 6963 6b28 7365 6c66 2920 2d3e 2069 6e74  ick(self) -> int
-00018ba0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00018bb0: 2020 2020 2020 6068 6561 7274 6265 6174        `heartbeat
-00018bc0: 5f74 6963 6b60 3a20 4865 6172 7462 6561  _tick`: Heartbea
-00018bd0: 7454 6963 6b20 6973 2074 6865 206e 756d  tTick is the num
-00018be0: 6265 7220 6f66 206e 6f64 652e 7469 636b  ber of node.tick
-00018bf0: 2069 6e76 6f63 6174 696f 6e73 2074 6861   invocations tha
-00018c00: 7420 6d75 7374 2070 6173 7320 6265 7477  t must pass betw
-00018c10: 6565 6e0a 2020 2020 2020 2020 6865 6172  een.        hear
-00018c20: 7462 6561 7473 2e20 5468 6174 2069 732c  tbeats. That is,
-00018c30: 2061 206c 6561 6465 7220 7365 6e64 7320   a leader sends 
-00018c40: 6865 6172 7462 6561 7420 6d65 7373 6167  heartbeat messag
-00018c50: 6573 2074 6f20 6d61 696e 7461 696e 2069  es to maintain i
-00018c60: 7473 0a20 2020 2020 2020 206c 6561 6465  ts.        leade
-00018c70: 7273 6869 7020 6576 6572 7920 6865 6172  rship every hear
-00018c80: 7462 6561 7420 7469 636b 732e 0a20 2020  tbeat ticks..   
-00018c90: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00018ca0: 2073 6574 5f68 6561 7274 6265 6174 5f74   set_heartbeat_t
-00018cb0: 6963 6b28 7365 6c66 2c20 6865 6172 7462  ick(self, heartb
-00018cc0: 6561 745f 7469 636b 3a20 696e 7429 202d  eat_tick: int) -
-00018cd0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00018ce0: 2222 220a 2020 2020 2020 2020 6068 6561  """.        `hea
-00018cf0: 7274 6265 6174 5f74 6963 6b60 3a20 4865  rtbeat_tick`: He
-00018d00: 6172 7462 6561 7454 6963 6b20 6973 2074  artbeatTick is t
-00018d10: 6865 206e 756d 6265 7220 6f66 206e 6f64  he number of nod
-00018d20: 652e 7469 636b 2069 6e76 6f63 6174 696f  e.tick invocatio
-00018d30: 6e73 2074 6861 7420 6d75 7374 2070 6173  ns that must pas
-00018d40: 7320 6265 7477 6565 6e0a 2020 2020 2020  s between.      
-00018d50: 2020 6865 6172 7462 6561 7473 2e20 5468    heartbeats. Th
-00018d60: 6174 2069 732c 2061 206c 6561 6465 7220  at is, a leader 
-00018d70: 7365 6e64 7320 6865 6172 7462 6561 7420  sends heartbeat 
-00018d80: 6d65 7373 6167 6573 2074 6f20 6d61 696e  messages to main
-00018d90: 7461 696e 2069 7473 0a20 2020 2020 2020  tain its.       
-00018da0: 206c 6561 6465 7273 6869 7020 6576 6572   leadership ever
-00018db0: 7920 6865 6172 7462 6561 7420 7469 636b  y heartbeat tick
-00018dc0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00018dd0: 2020 2064 6566 2067 6574 5f6d 6178 5f73     def get_max_s
-00018de0: 697a 655f 7065 725f 6d73 6728 7365 6c66  ize_per_msg(self
-00018df0: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-00018e00: 2020 2222 220a 2020 2020 2020 2020 606d    """.        `m
-00018e10: 6178 5f73 697a 655f 7065 725f 6d73 6760  ax_size_per_msg`
-00018e20: 3a20 4c69 6d69 7420 7468 6520 6d61 7820  : Limit the max 
-00018e30: 7369 7a65 206f 6620 6561 6368 2061 7070  size of each app
-00018e40: 656e 6420 6d65 7373 6167 652e 2053 6d61  end message. Sma
-00018e50: 6c6c 6572 2076 616c 7565 206c 6f77 6572  ller value lower
-00018e60: 730a 2020 2020 2020 2020 7468 6520 7261  s.        the ra
-00018e70: 6674 2072 6563 6f76 6572 7920 636f 7374  ft recovery cost
-00018e80: 2869 6e69 7469 616c 2070 726f 6269 6e67  (initial probing
-00018e90: 2061 6e64 206d 6573 7361 6765 206c 6f73   and message los
-00018ea0: 7420 6475 7269 6e67 206e 6f72 6d61 6c20  t during normal 
-00018eb0: 6f70 6572 6174 696f 6e29 2e0a 2020 2020  operation)..    
-00018ec0: 2020 2020 4f6e 2074 6865 206f 7468 6572      On the other
-00018ed0: 2073 6964 652c 2069 7420 6d69 6768 7420   side, it might 
-00018ee0: 6166 6665 6374 2074 6865 2074 6872 6f75  affect the throu
-00018ef0: 6768 7075 7420 6475 7269 6e67 206e 6f72  ghput during nor
-00018f00: 6d61 6c20 7265 706c 6963 6174 696f 6e2e  mal replication.
-00018f10: 0a20 2020 2020 2020 204e 6f74 653a 206d  .        Note: m
-00018f20: 6174 682e 4d61 7855 7573 697a 6536 3420  ath.MaxUusize64 
-00018f30: 666f 7220 756e 6c69 6d69 7465 642c 2030  for unlimited, 0
-00018f40: 2066 6f72 2061 7420 6d6f 7374 206f 6e65   for at most one
-00018f50: 2065 6e74 7279 2070 6572 206d 6573 7361   entry per messa
-00018f60: 6765 2e0a 2020 2020 2020 2020 2222 220a  ge..        """.
-00018f70: 2020 2020 6465 6620 7365 745f 6d61 785f      def set_max_
-00018f80: 7369 7a65 5f70 6572 5f6d 7367 2873 656c  size_per_msg(sel
-00018f90: 662c 206d 6178 5f73 697a 655f 7065 725f  f, max_size_per_
-00018fa0: 6d73 673a 2069 6e74 2920 2d3e 204e 6f6e  msg: int) -> Non
-00018fb0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00018fc0: 2020 2020 2020 2060 6d61 785f 7369 7a65         `max_size
-00018fd0: 5f70 6572 5f6d 7367 603a 204c 696d 6974  _per_msg`: Limit
-00018fe0: 2074 6865 206d 6178 2073 697a 6520 6f66   the max size of
-00018ff0: 2065 6163 6820 6170 7065 6e64 206d 6573   each append mes
-00019000: 7361 6765 2e20 536d 616c 6c65 7220 7661  sage. Smaller va
-00019010: 6c75 6520 6c6f 7765 7273 0a20 2020 2020  lue lowers.     
-00019020: 2020 2074 6865 2072 6166 7420 7265 636f     the raft reco
-00019030: 7665 7279 2063 6f73 7428 696e 6974 6961  very cost(initia
-00019040: 6c20 7072 6f62 696e 6720 616e 6420 6d65  l probing and me
-00019050: 7373 6167 6520 6c6f 7374 2064 7572 696e  ssage lost durin
-00019060: 6720 6e6f 726d 616c 206f 7065 7261 7469  g normal operati
-00019070: 6f6e 292e 0a20 2020 2020 2020 204f 6e20  on)..        On 
-00019080: 7468 6520 6f74 6865 7220 7369 6465 2c20  the other side, 
-00019090: 6974 206d 6967 6874 2061 6666 6563 7420  it might affect 
-000190a0: 7468 6520 7468 726f 7567 6870 7574 2064  the throughput d
-000190b0: 7572 696e 6720 6e6f 726d 616c 2072 6570  uring normal rep
-000190c0: 6c69 6361 7469 6f6e 2e0a 2020 2020 2020  lication..      
-000190d0: 2020 4e6f 7465 3a20 6d61 7468 2e4d 6178    Note: math.Max
-000190e0: 5575 7369 7a65 3634 2066 6f72 2075 6e6c  Uusize64 for unl
-000190f0: 696d 6974 6564 2c20 3020 666f 7220 6174  imited, 0 for at
-00019100: 206d 6f73 7420 6f6e 6520 656e 7472 7920   most one entry 
-00019110: 7065 7220 6d65 7373 6167 652e 0a20 2020  per message..   
-00019120: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-00019130: 2067 6574 5f6d 6178 5f69 6e66 6c69 6768   get_max_infligh
-00019140: 745f 6d73 6773 2873 656c 6629 202d 3e20  t_msgs(self) -> 
-00019150: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-00019160: 0a20 2020 2020 2020 2060 6d61 785f 696e  .        `max_in
-00019170: 666c 6967 6874 5f6d 7367 7360 3a20 4c69  flight_msgs`: Li
-00019180: 6d69 7420 7468 6520 6d61 7820 6e75 6d62  mit the max numb
-00019190: 6572 206f 6620 696e 2d66 6c69 6768 7420  er of in-flight 
-000191a0: 6170 7065 6e64 206d 6573 7361 6765 7320  append messages 
-000191b0: 6475 7269 6e67 206f 7074 696d 6973 7469  during optimisti
-000191c0: 630a 2020 2020 2020 2020 7265 706c 6963  c.        replic
-000191d0: 6174 696f 6e20 7068 6173 652e 2054 6865  ation phase. The
-000191e0: 2061 7070 6c69 6361 7469 6f6e 2074 7261   application tra
-000191f0: 6e73 706f 7274 6174 696f 6e20 6c61 7965  nsportation laye
-00019200: 7220 7573 7561 6c6c 7920 6861 7320 6974  r usually has it
-00019210: 7320 6f77 6e20 7365 6e64 696e 670a 2020  s own sending.  
-00019220: 2020 2020 2020 6275 6666 6572 206f 7665        buffer ove
-00019230: 7220 5443 502f 5544 502e 2053 6574 2074  r TCP/UDP. Set t
-00019240: 6f20 6176 6f69 6420 6f76 6572 666c 6f77  o avoid overflow
-00019250: 696e 6720 7468 6174 2073 656e 6469 6e67  ing that sending
-00019260: 2062 7566 6665 722e 0a20 2020 2020 2020   buffer..       
-00019270: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
-00019280: 5f6d 6178 5f69 6e66 6c69 6768 745f 6d73  _max_inflight_ms
-00019290: 6773 2873 656c 662c 206d 6178 5f69 6e66  gs(self, max_inf
-000192a0: 6c69 6768 745f 6d73 6773 3a20 696e 7429  light_msgs: int)
-000192b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000192c0: 2020 2222 220a 2020 2020 2020 2020 606d    """.        `m
-000192d0: 6178 5f69 6e66 6c69 6768 745f 6d73 6773  ax_inflight_msgs
-000192e0: 603a 204c 696d 6974 2074 6865 206d 6178  `: Limit the max
-000192f0: 206e 756d 6265 7220 6f66 2069 6e2d 666c   number of in-fl
-00019300: 6967 6874 2061 7070 656e 6420 6d65 7373  ight append mess
-00019310: 6167 6573 2064 7572 696e 6720 6f70 7469  ages during opti
-00019320: 6d69 7374 6963 0a20 2020 2020 2020 2072  mistic.        r
-00019330: 6570 6c69 6361 7469 6f6e 2070 6861 7365  eplication phase
-00019340: 2e20 5468 6520 6170 706c 6963 6174 696f  . The applicatio
-00019350: 6e20 7472 616e 7370 6f72 7461 7469 6f6e  n transportation
-00019360: 206c 6179 6572 2075 7375 616c 6c79 2068   layer usually h
-00019370: 6173 2069 7473 206f 776e 2073 656e 6469  as its own sendi
-00019380: 6e67 0a20 2020 2020 2020 2062 7566 6665  ng.        buffe
-00019390: 7220 6f76 6572 2054 4350 2f55 4450 2e20  r over TCP/UDP. 
-000193a0: 5365 7420 746f 2061 766f 6964 206f 7665  Set to avoid ove
-000193b0: 7266 6c6f 7769 6e67 2074 6861 7420 7365  rflowing that se
-000193c0: 6e64 696e 6720 6275 6666 6572 2e0a 2020  nding buffer..  
-000193d0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-000193e0: 6620 6765 745f 6170 706c 6965 6428 7365  f get_applied(se
-000193f0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
-00019400: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00019410: 6061 7070 6c69 6564 603a 2041 7070 6c69  `applied`: Appli
-00019420: 6564 2069 7320 7468 6520 6c61 7374 2061  ed is the last a
-00019430: 7070 6c69 6564 2069 6e64 6578 2e20 4974  pplied index. It
-00019440: 2073 686f 756c 6420 6f6e 6c79 2062 6520   should only be 
-00019450: 7365 7420 7768 656e 2072 6573 7461 7274  set when restart
-00019460: 696e 670a 2020 2020 2020 2020 7261 6674  ing.        raft
-00019470: 2e20 7261 6674 2077 696c 6c20 6e6f 7420  . raft will not 
-00019480: 7265 7475 726e 2065 6e74 7269 6573 2074  return entries t
-00019490: 6f20 7468 6520 6170 706c 6963 6174 696f  o the applicatio
-000194a0: 6e20 736d 616c 6c65 7220 6f72 2065 7175  n smaller or equ
-000194b0: 616c 2074 6f20 4170 706c 6965 642e 0a20  al to Applied.. 
-000194c0: 2020 2020 2020 2049 6620 4170 706c 6965         If Applie
-000194d0: 6420 6973 2075 6e73 6574 2077 6865 6e20  d is unset when 
-000194e0: 7265 7374 6172 7469 6e67 2c20 7261 6674  restarting, raft
-000194f0: 206d 6967 6874 2072 6574 7572 6e20 7072   might return pr
-00019500: 6576 696f 7573 2061 7070 6c69 6564 2065  evious applied e
-00019510: 6e74 7269 6573 2e0a 2020 2020 2020 2020  ntries..        
-00019520: 5468 6973 2069 7320 6120 7665 7279 2061  This is a very a
-00019530: 7070 6c69 6361 7469 6f6e 2064 6570 656e  pplication depen
-00019540: 6465 6e74 2063 6f6e 6669 6775 7261 7469  dent configurati
-00019550: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
-00019560: 2020 2020 6465 6620 7365 745f 6170 706c      def set_appl
-00019570: 6965 6428 7365 6c66 2c20 6170 706c 6965  ied(self, applie
-00019580: 643a 2069 6e74 2920 2d3e 204e 6f6e 653a  d: int) -> None:
-00019590: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000195a0: 2020 2020 2060 6170 706c 6965 6460 3a20       `applied`: 
-000195b0: 4170 706c 6965 6420 6973 2074 6865 206c  Applied is the l
-000195c0: 6173 7420 6170 706c 6965 6420 696e 6465  ast applied inde
-000195d0: 782e 2049 7420 7368 6f75 6c64 206f 6e6c  x. It should onl
-000195e0: 7920 6265 2073 6574 2077 6865 6e20 7265  y be set when re
-000195f0: 7374 6172 7469 6e67 0a20 2020 2020 2020  starting.       
-00019600: 2072 6166 742e 2072 6166 7420 7769 6c6c   raft. raft will
-00019610: 206e 6f74 2072 6574 7572 6e20 656e 7472   not return entr
-00019620: 6965 7320 746f 2074 6865 2061 7070 6c69  ies to the appli
-00019630: 6361 7469 6f6e 2073 6d61 6c6c 6572 206f  cation smaller o
-00019640: 7220 6571 7561 6c20 746f 2041 7070 6c69  r equal to Appli
-00019650: 6564 2e0a 2020 2020 2020 2020 4966 2041  ed..        If A
-00019660: 7070 6c69 6564 2069 7320 756e 7365 7420  pplied is unset 
-00019670: 7768 656e 2072 6573 7461 7274 696e 672c  when restarting,
-00019680: 2072 6166 7420 6d69 6768 7420 7265 7475   raft might retu
-00019690: 726e 2070 7265 7669 6f75 7320 6170 706c  rn previous appl
-000196a0: 6965 6420 656e 7472 6965 732e 0a20 2020  ied entries..   
-000196b0: 2020 2020 2054 6869 7320 6973 2061 2076       This is a v
-000196c0: 6572 7920 6170 706c 6963 6174 696f 6e20  ery application 
-000196d0: 6465 7065 6e64 656e 7420 636f 6e66 6967  dependent config
-000196e0: 7572 6174 696f 6e2e 0a20 2020 2020 2020  uration..       
-000196f0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-00019700: 5f63 6865 636b 5f71 756f 7275 6d28 7365  _check_quorum(se
-00019710: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
-00019720: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00019730: 2060 6368 6563 6b5f 7175 6f72 756d 603a   `check_quorum`:
-00019740: 2053 7065 6369 6679 2069 6620 7468 6520   Specify if the 
-00019750: 6c65 6164 6572 2073 686f 756c 6420 6368  leader should ch
-00019760: 6563 6b20 7175 6f72 756d 2061 6374 6976  eck quorum activ
-00019770: 6974 792e 204c 6561 6465 7220 7374 6570  ity. Leader step
-00019780: 7320 646f 776e 2077 6865 6e0a 2020 2020  s down when.    
-00019790: 2020 2020 7175 6f72 756d 2069 7320 6e6f      quorum is no
-000197a0: 7420 6163 7469 7665 2066 6f72 2061 6e20  t active for an 
-000197b0: 656c 6563 7469 6f6e 5469 6d65 6f75 742e  electionTimeout.
-000197c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000197d0: 2064 6566 2073 6574 5f63 6865 636b 5f71   def set_check_q
-000197e0: 756f 7275 6d28 7365 6c66 2c20 6368 6563  uorum(self, chec
-000197f0: 6b5f 7175 6f72 756d 3a20 626f 6f6c 2920  k_quorum: bool) 
-00019800: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00019810: 2022 2222 0a20 2020 2020 2020 2060 6368   """.        `ch
-00019820: 6563 6b5f 7175 6f72 756d 603a 2053 7065  eck_quorum`: Spe
-00019830: 6369 6679 2069 6620 7468 6520 6c65 6164  cify if the lead
-00019840: 6572 2073 686f 756c 6420 6368 6563 6b20  er should check 
-00019850: 7175 6f72 756d 2061 6374 6976 6974 792e  quorum activity.
-00019860: 204c 6561 6465 7220 7374 6570 7320 646f   Leader steps do
-00019870: 776e 2077 6865 6e0a 2020 2020 2020 2020  wn when.        
-00019880: 7175 6f72 756d 2069 7320 6e6f 7420 6163  quorum is not ac
-00019890: 7469 7665 2066 6f72 2061 6e20 656c 6563  tive for an elec
-000198a0: 7469 6f6e 5469 6d65 6f75 742e 0a20 2020  tionTimeout..   
-000198b0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
-000198c0: 2067 6574 5f70 7265 5f76 6f74 6528 7365   get_pre_vote(se
-000198d0: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
-000198e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000198f0: 2060 7072 655f 766f 7465 603a 2045 6e61   `pre_vote`: Ena
-00019900: 626c 6573 2074 6865 2050 7265 2d56 6f74  bles the Pre-Vot
-00019910: 6520 616c 676f 7269 7468 6d20 6465 7363  e algorithm desc
-00019920: 7269 6265 6420 696e 2072 6166 7420 7468  ribed in raft th
-00019930: 6573 6973 2073 6563 7469 6f6e 0a20 2020  esis section.   
-00019940: 2020 2020 2039 2e36 2e20 5468 6973 2070       9.6. This p
-00019950: 7265 7665 6e74 7320 6469 7372 7570 7469  revents disrupti
-00019960: 6f6e 2077 6865 6e20 6120 6e6f 6465 2074  on when a node t
-00019970: 6861 7420 6861 7320 6265 656e 2070 6172  hat has been par
-00019980: 7469 7469 6f6e 6564 2061 7761 790a 2020  titioned away.  
-00019990: 2020 2020 2020 7265 6a6f 696e 7320 7468        rejoins th
-000199a0: 6520 636c 7573 7465 722e 0a20 2020 2020  e cluster..     
-000199b0: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
-000199c0: 6574 5f70 7265 5f76 6f74 6528 7365 6c66  et_pre_vote(self
-000199d0: 2c20 7072 655f 766f 7465 3a20 626f 6f6c  , pre_vote: bool
-000199e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000199f0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-00019a00: 7072 655f 766f 7465 603a 2045 6e61 626c  pre_vote`: Enabl
-00019a10: 6573 2074 6865 2050 7265 2d56 6f74 6520  es the Pre-Vote 
-00019a20: 616c 676f 7269 7468 6d20 6465 7363 7269  algorithm descri
-00019a30: 6265 6420 696e 2072 6166 7420 7468 6573  bed in raft thes
-00019a40: 6973 2073 6563 7469 6f6e 0a20 2020 2020  is section.     
-00019a50: 2020 2039 2e36 2e20 5468 6973 2070 7265     9.6. This pre
-00019a60: 7665 6e74 7320 6469 7372 7570 7469 6f6e  vents disruption
-00019a70: 2077 6865 6e20 6120 6e6f 6465 2074 6861   when a node tha
-00019a80: 7420 6861 7320 6265 656e 2070 6172 7469  t has been parti
-00019a90: 7469 6f6e 6564 2061 7761 790a 2020 2020  tioned away.    
-00019aa0: 2020 2020 7265 6a6f 696e 7320 7468 6520      rejoins the 
-00019ab0: 636c 7573 7465 722e 0a20 2020 2020 2020  cluster..       
-00019ac0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
-00019ad0: 5f62 6174 6368 5f61 7070 656e 6428 7365  _batch_append(se
-00019ae0: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
-00019af0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00019b00: 2060 6261 7463 685f 6170 7065 6e64 603a   `batch_append`:
-00019b10: 2042 6174 6368 6573 2065 7665 7279 2061   Batches every a
-00019b20: 7070 656e 6420 6d73 6720 6966 2061 6e79  ppend msg if any
-00019b30: 2061 7070 656e 6420 6d73 6720 616c 7265   append msg alre
-00019b40: 6164 7920 6578 6973 7473 0a20 2020 2020  ady exists.     
-00019b50: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
-00019b60: 6574 5f62 6174 6368 5f61 7070 656e 6428  et_batch_append(
-00019b70: 7365 6c66 2c20 6261 7463 685f 6170 7065  self, batch_appe
-00019b80: 6e64 3a20 626f 6f6c 2920 2d3e 204e 6f6e  nd: bool) -> Non
-00019b90: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00019ba0: 2020 2020 2020 2060 6261 7463 685f 6170         `batch_ap
-00019bb0: 7065 6e64 603a 2042 6174 6368 6573 2065  pend`: Batches e
-00019bc0: 7665 7279 2061 7070 656e 6420 6d73 6720  very append msg 
-00019bd0: 6966 2061 6e79 2061 7070 656e 6420 6d73  if any append ms
-00019be0: 6720 616c 7265 6164 7920 6578 6973 7473  g already exists
-00019bf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00019c00: 2064 6566 2067 6574 5f73 6b69 705f 6263   def get_skip_bc
-00019c10: 6173 745f 636f 6d6d 6974 2873 656c 6629  ast_commit(self)
-00019c20: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-00019c30: 2020 2222 220a 2020 2020 2020 2020 6073    """.        `s
-00019c40: 6b69 705f 6263 6173 745f 636f 6d6d 6974  kip_bcast_commit
-00019c50: 603a 2044 6f6e 2774 2062 726f 6164 6361  `: Don't broadca
-00019c60: 7374 2061 6e20 656d 7074 7920 7261 6674  st an empty raft
-00019c70: 2065 6e74 7279 2074 6f20 6e6f 7469 6679   entry to notify
-00019c80: 2066 6f6c 6c6f 7765 7220 746f 2063 6f6d   follower to com
-00019c90: 6d69 7420 616e 2065 6e74 7279 2e0a 2020  mit an entry..  
-00019ca0: 2020 2020 2020 5468 6973 206d 6179 206d        This may m
-00019cb0: 616b 6520 666f 6c6c 6f77 6572 2077 6169  ake follower wai
-00019cc0: 7420 6120 6c6f 6e67 6572 2074 696d 6520  t a longer time 
-00019cd0: 746f 2061 7070 6c79 2061 6e20 656e 7472  to apply an entr
-00019ce0: 792e 2054 6869 7320 636f 6e66 6967 7572  y. This configur
-00019cf0: 6174 696f 6e0a 2020 2020 2020 2020 4d61  ation.        Ma
-00019d00: 7920 6166 6665 6374 2070 726f 706f 7361  y affect proposa
-00019d10: 6c20 666f 7277 6172 6469 6e67 2061 6e64  l forwarding and
-00019d20: 2066 6f6c 6c6f 7765 7220 7265 6164 2e0a   follower read..
-00019d30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00019d40: 6465 6620 7365 745f 736b 6970 5f62 6361  def set_skip_bca
-00019d50: 7374 5f63 6f6d 6d69 7428 7365 6c66 2c20  st_commit(self, 
-00019d60: 736b 6970 5f62 6361 7374 5f63 6f6d 6d69  skip_bcast_commi
-00019d70: 743a 2062 6f6f 6c29 202d 3e20 4e6f 6e65  t: bool) -> None
-00019d80: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00019d90: 2020 2020 2020 6073 6b69 705f 6263 6173        `skip_bcas
-00019da0: 745f 636f 6d6d 6974 603a 2044 6f6e 2774  t_commit`: Don't
-00019db0: 2062 726f 6164 6361 7374 2061 6e20 656d   broadcast an em
-00019dc0: 7074 7920 7261 6674 2065 6e74 7279 2074  pty raft entry t
-00019dd0: 6f20 6e6f 7469 6679 2066 6f6c 6c6f 7765  o notify followe
-00019de0: 7220 746f 2063 6f6d 6d69 7420 616e 2065  r to commit an e
-00019df0: 6e74 7279 2e0a 2020 2020 2020 2020 5468  ntry..        Th
-00019e00: 6973 206d 6179 206d 616b 6520 666f 6c6c  is may make foll
-00019e10: 6f77 6572 2077 6169 7420 6120 6c6f 6e67  ower wait a long
-00019e20: 6572 2074 696d 6520 746f 2061 7070 6c79  er time to apply
-00019e30: 2061 6e20 656e 7472 792e 2054 6869 7320   an entry. This 
-00019e40: 636f 6e66 6967 7572 6174 696f 6e0a 2020  configuration.  
-00019e50: 2020 2020 2020 4d61 7920 6166 6665 6374        May affect
-00019e60: 2070 726f 706f 7361 6c20 666f 7277 6172   proposal forwar
-00019e70: 6469 6e67 2061 6e64 2066 6f6c 6c6f 7765  ding and followe
-00019e80: 7220 7265 6164 2e0a 2020 2020 2020 2020  r read..        
-00019e90: 2222 220a 2020 2020 6465 6620 6765 745f  """.    def get_
-00019ea0: 7072 696f 7269 7479 2873 656c 6629 202d  priority(self) -
-00019eb0: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-00019ec0: 2222 0a20 2020 2020 2020 2060 7072 696f  "".        `prio
-00019ed0: 7269 7479 603a 2054 6865 2065 6c65 6374  rity`: The elect
-00019ee0: 696f 6e20 7072 696f 7269 7479 206f 6620  ion priority of 
-00019ef0: 7468 6973 206e 6f64 652e 0a20 2020 2020  this node..     
-00019f00: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
-00019f10: 6574 5f70 7269 6f72 6974 7928 7365 6c66  et_priority(self
-00019f20: 2c20 7072 696f 7269 7479 3a20 696e 7429  , priority: int)
-00019f30: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00019f40: 2020 2222 220a 2020 2020 2020 2020 6070    """.        `p
-00019f50: 7269 6f72 6974 7960 3a20 5468 6520 656c  riority`: The el
-00019f60: 6563 7469 6f6e 2070 7269 6f72 6974 7920  ection priority 
-00019f70: 6f66 2074 6869 7320 6e6f 6465 2e0a 2020  of this node..  
-00019f80: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
-00019f90: 6620 6765 745f 6d61 785f 756e 636f 6d6d  f get_max_uncomm
-00019fa0: 6974 7465 645f 7369 7a65 2873 656c 6629  itted_size(self)
-00019fb0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-00019fc0: 2022 2222 0a20 2020 2020 2020 2060 6d61   """.        `ma
-00019fd0: 785f 756e 636f 6d6d 6974 7465 645f 7369  x_uncommitted_si
-00019fe0: 7a65 603a 2053 7065 6369 6679 206d 6178  ze`: Specify max
-00019ff0: 696d 756d 206f 6620 756e 636f 6d6d 6974  imum of uncommit
-0001a000: 7465 6420 656e 7472 7920 7369 7a65 2e0a  ted entry size..
-0001a010: 2020 2020 2020 2020 5768 656e 2074 6869          When thi
-0001a020: 7320 6c69 6d69 7420 6973 2072 6561 6368  s limit is reach
-0001a030: 6564 2c20 616c 6c20 7072 6f70 6f73 616c  ed, all proposal
-0001a040: 7320 746f 2061 7070 656e 6420 6e65 7720  s to append new 
-0001a050: 6c6f 6720 7769 6c6c 2062 6520 6472 6f70  log will be drop
-0001a060: 7065 640a 2020 2020 2020 2020 2222 220a  ped.        """.
-0001a070: 2020 2020 6465 6620 7365 745f 6d61 785f      def set_max_
-0001a080: 756e 636f 6d6d 6974 7465 645f 7369 7a65  uncommitted_size
-0001a090: 2873 656c 662c 206d 6178 5f75 6e63 6f6d  (self, max_uncom
-0001a0a0: 6d69 7474 6564 5f73 697a 653a 2069 6e74  mitted_size: int
-0001a0b0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0001a0c0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
-0001a0d0: 6d61 785f 756e 636f 6d6d 6974 7465 645f  max_uncommitted_
-0001a0e0: 7369 7a65 603a 2053 7065 6369 6679 206d  size`: Specify m
-0001a0f0: 6178 696d 756d 206f 6620 756e 636f 6d6d  aximum of uncomm
-0001a100: 6974 7465 6420 656e 7472 7920 7369 7a65  itted entry size
-0001a110: 2e0a 2020 2020 2020 2020 5768 656e 2074  ..        When t
-0001a120: 6869 7320 6c69 6d69 7420 6973 2072 6561  his limit is rea
-0001a130: 6368 6564 2c20 616c 6c20 7072 6f70 6f73  ched, all propos
-0001a140: 616c 7320 746f 2061 7070 656e 6420 6e65  als to append ne
-0001a150: 7720 6c6f 6720 7769 6c6c 2062 6520 6472  w log will be dr
-0001a160: 6f70 7065 640a 2020 2020 2020 2020 2222  opped.        ""
-0001a170: 220a 2020 2020 6465 6620 6765 745f 6d61  ".    def get_ma
-0001a180: 785f 636f 6d6d 6974 7465 645f 7369 7a65  x_committed_size
-0001a190: 5f70 6572 5f72 6561 6479 2873 656c 6629  _per_ready(self)
-0001a1a0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-0001a1b0: 2022 2222 0a20 2020 2020 2020 2060 6d61   """.        `ma
-0001a1c0: 785f 636f 6d6d 6974 7465 645f 7369 7a65  x_committed_size
-0001a1d0: 5f70 6572 5f72 6561 6479 603a 204d 6178  _per_ready`: Max
-0001a1e0: 2073 697a 6520 666f 7220 636f 6d6d 6974   size for commit
-0001a1f0: 7465 6420 656e 7472 6965 7320 696e 2061  ted entries in a
-0001a200: 2060 5265 6164 7960 2e0a 2020 2020 2020   `Ready`..      
-0001a210: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
-0001a220: 745f 6d61 785f 636f 6d6d 6974 7465 645f  t_max_committed_
-0001a230: 7369 7a65 5f70 6572 5f72 6561 6479 280a  size_per_ready(.
-0001a240: 2020 2020 2020 2020 7365 6c66 2c20 6d61          self, ma
-0001a250: 785f 636f 6d6d 6974 7465 645f 7369 7a65  x_committed_size
-0001a260: 5f70 6572 5f72 6561 6479 3a20 696e 740a  _per_ready: int.
-0001a270: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-0001a280: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001a290: 2020 2060 6d61 785f 636f 6d6d 6974 7465     `max_committe
-0001a2a0: 645f 7369 7a65 5f70 6572 5f72 6561 6479  d_size_per_ready
-0001a2b0: 603a 204d 6178 2073 697a 6520 666f 7220  `: Max size for 
-0001a2c0: 636f 6d6d 6974 7465 6420 656e 7472 6965  committed entrie
-0001a2d0: 7320 696e 2061 2060 5265 6164 7960 2e0a  s in a `Ready`..
-0001a2e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001a2f0: 6465 6620 7661 6c69 6461 7465 2873 656c  def validate(sel
-0001a300: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0001a310: 2020 2020 2222 2252 756e 7320 7661 6c69      """Runs vali
-0001a320: 6461 7469 6f6e 7320 6167 6169 6e73 7420  dations against 
-0001a330: 7468 6520 636f 6e66 6967 2e22 2222 0a0a  the config."""..
-0001a340: 636c 6173 7320 436f 6e66 6967 285f 5f41  class Config(__A
-0001a350: 5049 5f43 6f6e 6669 6729 3a0a 2020 2020  PI_Config):.    
-0001a360: 2222 220a 2020 2020 436f 6e66 6967 2063  """.    Config c
-0001a370: 6f6e 7461 696e 7320 7468 6520 7061 7261  ontains the para
-0001a380: 6d65 7465 7273 2074 6f20 7374 6172 7420  meters to start 
-0001a390: 6120 7261 6674 2e0a 2020 2020 2222 220a  a raft..    """.
-0001a3a0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0001a3b0: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
-0001a3c0: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
-0001a3d0: 2020 2020 6964 3a20 4f70 7469 6f6e 616c      id: Optional
-0001a3e0: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-0001a3f0: 2020 2020 2020 656c 6563 7469 6f6e 5f74        election_t
-0001a400: 6963 6b3a 204f 7074 696f 6e61 6c5b 696e  ick: Optional[in
-0001a410: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-0001a420: 2020 2068 6561 7274 6265 6174 5f74 6963     heartbeat_tic
-0001a430: 6b3a 204f 7074 696f 6e61 6c5b 696e 745d  k: Optional[int]
-0001a440: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001a450: 2061 7070 6c69 6564 3a20 4f70 7469 6f6e   applied: Option
-0001a460: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
-0001a470: 2020 2020 2020 2020 6d61 785f 7369 7a65          max_size
-0001a480: 5f70 6572 5f6d 7367 3a20 4f70 7469 6f6e  _per_msg: Option
-0001a490: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
-0001a4a0: 2020 2020 2020 2020 6d61 785f 696e 666c          max_infl
-0001a4b0: 6967 6874 5f6d 7367 733a 204f 7074 696f  ight_msgs: Optio
-0001a4c0: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-0001a4d0: 0a20 2020 2020 2020 2063 6865 636b 5f71  .        check_q
-0001a4e0: 756f 7275 6d3a 204f 7074 696f 6e61 6c5b  uorum: Optional[
-0001a4f0: 626f 6f6c 5d20 3d20 4e6f 6e65 2c0a 2020  bool] = None,.  
-0001a500: 2020 2020 2020 7072 655f 766f 7465 3a20        pre_vote: 
-0001a510: 4f70 7469 6f6e 616c 5b62 6f6f 6c5d 203d  Optional[bool] =
-0001a520: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
-0001a530: 696e 5f65 6c65 6374 696f 6e5f 7469 636b  in_election_tick
-0001a540: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-0001a550: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0001a560: 6d61 785f 656c 6563 7469 6f6e 5f74 6963  max_election_tic
-0001a570: 6b3a 204f 7074 696f 6e61 6c5b 696e 745d  k: Optional[int]
-0001a580: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001a590: 2072 6561 645f 6f6e 6c79 5f6f 7074 696f   read_only_optio
-0001a5a0: 6e3a 204f 7074 696f 6e61 6c5b 2252 6561  n: Optional["Rea
-0001a5b0: 644f 6e6c 794f 7074 696f 6e22 5d20 3d20  dOnlyOption"] = 
-0001a5c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 736b  None,.        sk
-0001a5d0: 6970 5f62 6361 7374 5f63 6f6d 6d69 743a  ip_bcast_commit:
-0001a5e0: 204f 7074 696f 6e61 6c5b 626f 6f6c 5d20   Optional[bool] 
-0001a5f0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0001a600: 6261 7463 685f 6170 7065 6e64 3a20 4f70  batch_append: Op
-0001a610: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 204e  tional[bool] = N
-0001a620: 6f6e 652c 0a20 2020 2020 2020 2070 7269  one,.        pri
-0001a630: 6f72 6974 793a 204f 7074 696f 6e61 6c5b  ority: Optional[
-0001a640: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-0001a650: 2020 2020 206d 6178 5f75 6e63 6f6d 6d69       max_uncommi
-0001a660: 7474 6564 5f73 697a 653a 204f 7074 696f  tted_size: Optio
-0001a670: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-0001a680: 0a20 2020 2020 2020 206d 6178 5f63 6f6d  .        max_com
-0001a690: 6d69 7474 6564 5f73 697a 655f 7065 725f  mitted_size_per_
-0001a6a0: 7265 6164 793a 204f 7074 696f 6e61 6c5b  ready: Optional[
-0001a6b0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-0001a6c0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
-0001a6d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001a6e0: 3a70 6172 616d 2069 643a 2054 6865 2069  :param id: The i
-0001a6f0: 6465 6e74 6974 7920 6f66 2074 6865 206c  dentity of the l
-0001a700: 6f63 616c 2072 6166 742e 2049 7420 6361  ocal raft. It ca
-0001a710: 6e6e 6f74 2062 6520 302c 2061 6e64 206d  nnot be 0, and m
-0001a720: 7573 7420 6265 2075 6e69 7175 6520 696e  ust be unique in
-0001a730: 2074 6865 2067 726f 7570 2e0a 0a20 2020   the group...   
-0001a740: 2020 2020 203a 7061 7261 6d20 656c 6563       :param elec
-0001a750: 7469 6f6e 5f74 6963 6b3a 2054 6865 206e  tion_tick: The n
-0001a760: 756d 6265 7220 6f66 206e 6f64 652e 7469  umber of node.ti
-0001a770: 636b 2069 6e76 6f63 6174 696f 6e73 2074  ck invocations t
-0001a780: 6861 7420 6d75 7374 2070 6173 7320 6265  hat must pass be
-0001a790: 7477 6565 6e0a 2020 2020 2020 2020 656c  tween.        el
-0001a7a0: 6563 7469 6f6e 732e 2054 6861 7420 6973  ections. That is
-0001a7b0: 2c20 6966 2061 2066 6f6c 6c6f 7765 7220  , if a follower 
-0001a7c0: 646f 6573 206e 6f74 2072 6563 6569 7665  does not receive
-0001a7d0: 2061 6e79 206d 6573 7361 6765 2066 726f   any message fro
-0001a7e0: 6d20 7468 650a 2020 2020 2020 2020 6c65  m the.        le
-0001a7f0: 6164 6572 206f 6620 6375 7272 656e 7420  ader of current 
-0001a800: 7465 726d 2062 6566 6f72 6520 456c 6563  term before Elec
-0001a810: 7469 6f6e 5469 636b 2068 6173 2065 6c61  tionTick has ela
-0001a820: 7073 6564 2c20 6974 2077 696c 6c20 6265  psed, it will be
-0001a830: 636f 6d65 0a20 2020 2020 2020 2063 616e  come.        can
-0001a840: 6469 6461 7465 2061 6e64 2073 7461 7274  didate and start
-0001a850: 2061 6e20 656c 6563 7469 6f6e 2e20 656c   an election. el
-0001a860: 6563 7469 6f6e 5f74 6963 6b20 6d75 7374  ection_tick must
-0001a870: 2062 6520 6772 6561 7465 7220 7468 616e   be greater than
-0001a880: 0a20 2020 2020 2020 2048 6561 7274 6265  .        Heartbe
-0001a890: 6174 5469 636b 2e20 5765 2073 7567 6765  atTick. We sugge
-0001a8a0: 7374 2065 6c65 6374 696f 6e5f 7469 636b  st election_tick
-0001a8b0: 203d 2031 3020 2a20 4865 6172 7462 6561   = 10 * Heartbea
-0001a8c0: 7454 6963 6b20 746f 2061 766f 6964 0a20  tTick to avoid. 
-0001a8d0: 2020 2020 2020 2075 6e6e 6563 6573 7361         unnecessa
-0001a8e0: 7279 206c 6561 6465 7220 7377 6974 6368  ry leader switch
-0001a8f0: 696e 670a 0a20 2020 2020 2020 203a 7061  ing..        :pa
-0001a900: 7261 6d20 6865 6172 7462 6561 745f 7469  ram heartbeat_ti
-0001a910: 636b 3a20 4865 6172 7462 6561 7454 6963  ck: HeartbeatTic
-0001a920: 6b20 6973 2074 6865 206e 756d 6265 7220  k is the number 
-0001a930: 6f66 206e 6f64 652e 7469 636b 2069 6e76  of node.tick inv
-0001a940: 6f63 6174 696f 6e73 2074 6861 7420 6d75  ocations that mu
-0001a950: 7374 2070 6173 7320 6265 7477 6565 6e0a  st pass between.
-0001a960: 2020 2020 2020 2020 6865 6172 7462 6561          heartbea
-0001a970: 7473 2e20 5468 6174 2069 732c 2061 206c  ts. That is, a l
-0001a980: 6561 6465 7220 7365 6e64 7320 6865 6172  eader sends hear
-0001a990: 7462 6561 7420 6d65 7373 6167 6573 2074  tbeat messages t
-0001a9a0: 6f20 6d61 696e 7461 696e 2069 7473 0a20  o maintain its. 
-0001a9b0: 2020 2020 2020 206c 6561 6465 7273 6869         leadershi
-0001a9c0: 7020 6576 6572 7920 6865 6172 7462 6561  p every heartbea
-0001a9d0: 7420 7469 636b 732e 0a0a 2020 2020 2020  t ticks...      
-0001a9e0: 2020 3a70 6172 616d 2061 7070 6c69 6564    :param applied
-0001a9f0: 3a20 4170 706c 6965 6420 6973 2074 6865  : Applied is the
-0001aa00: 206c 6173 7420 6170 706c 6965 6420 696e   last applied in
-0001aa10: 6465 782e 2049 7420 7368 6f75 6c64 206f  dex. It should o
-0001aa20: 6e6c 7920 6265 2073 6574 2077 6865 6e20  nly be set when 
-0001aa30: 7265 7374 6172 7469 6e67 0a20 2020 2020  restarting.     
-0001aa40: 2020 2072 6166 742e 2072 6166 7420 7769     raft. raft wi
-0001aa50: 6c6c 206e 6f74 2072 6574 7572 6e20 656e  ll not return en
-0001aa60: 7472 6965 7320 746f 2074 6865 2061 7070  tries to the app
-0001aa70: 6c69 6361 7469 6f6e 2073 6d61 6c6c 6572  lication smaller
-0001aa80: 206f 7220 6571 7561 6c20 746f 2041 7070   or equal to App
-0001aa90: 6c69 6564 2e0a 2020 2020 2020 2020 4966  lied..        If
-0001aaa0: 2041 7070 6c69 6564 2069 7320 756e 7365   Applied is unse
-0001aab0: 7420 7768 656e 2072 6573 7461 7274 696e  t when restartin
-0001aac0: 672c 2072 6166 7420 6d69 6768 7420 7265  g, raft might re
-0001aad0: 7475 726e 2070 7265 7669 6f75 7320 6170  turn previous ap
-0001aae0: 706c 6965 6420 656e 7472 6965 732e 0a20  plied entries.. 
-0001aaf0: 2020 2020 2020 2054 6869 7320 6973 2061         This is a
-0001ab00: 2076 6572 7920 6170 706c 6963 6174 696f   very applicatio
-0001ab10: 6e20 6465 7065 6e64 656e 7420 636f 6e66  n dependent conf
-0001ab20: 6967 7572 6174 696f 6e2e 0a0a 2020 2020  iguration...    
-0001ab30: 2020 2020 3a70 6172 616d 206d 6178 5f73      :param max_s
-0001ab40: 697a 655f 7065 725f 6d73 673a 204c 696d  ize_per_msg: Lim
-0001ab50: 6974 2074 6865 206d 6178 2073 697a 6520  it the max size 
-0001ab60: 6f66 2065 6163 6820 6170 7065 6e64 206d  of each append m
-0001ab70: 6573 7361 6765 2e20 536d 616c 6c65 7220  essage. Smaller 
-0001ab80: 7661 6c75 6520 6c6f 7765 7273 0a20 2020  value lowers.   
-0001ab90: 2020 2020 2074 6865 2072 6166 7420 7265       the raft re
-0001aba0: 636f 7665 7279 2063 6f73 7428 696e 6974  covery cost(init
-0001abb0: 6961 6c20 7072 6f62 696e 6720 616e 6420  ial probing and 
-0001abc0: 6d65 7373 6167 6520 6c6f 7374 2064 7572  message lost dur
-0001abd0: 696e 6720 6e6f 726d 616c 206f 7065 7261  ing normal opera
-0001abe0: 7469 6f6e 292e 0a20 2020 2020 2020 204f  tion)..        O
-0001abf0: 6e20 7468 6520 6f74 6865 7220 7369 6465  n the other side
-0001ac00: 2c20 6974 206d 6967 6874 2061 6666 6563  , it might affec
-0001ac10: 7420 7468 6520 7468 726f 7567 6870 7574  t the throughput
-0001ac20: 2064 7572 696e 6720 6e6f 726d 616c 2072   during normal r
-0001ac30: 6570 6c69 6361 7469 6f6e 2e0a 2020 2020  eplication..    
-0001ac40: 2020 2020 4e6f 7465 3a20 6d61 7468 2e4d      Note: math.M
-0001ac50: 6178 5575 7369 7a65 3634 2066 6f72 2075  axUusize64 for u
-0001ac60: 6e6c 696d 6974 6564 2c20 3020 666f 7220  nlimited, 0 for 
-0001ac70: 6174 206d 6f73 7420 6f6e 6520 656e 7472  at most one entr
-0001ac80: 7920 7065 7220 6d65 7373 6167 652e 0a0a  y per message...
-0001ac90: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
-0001aca0: 6178 5f69 6e66 6c69 6768 745f 6d73 6773  ax_inflight_msgs
-0001acb0: 3a20 4c69 6d69 7420 7468 6520 6d61 7820  : Limit the max 
-0001acc0: 6e75 6d62 6572 206f 6620 696e 2d66 6c69  number of in-fli
-0001acd0: 6768 7420 6170 7065 6e64 206d 6573 7361  ght append messa
-0001ace0: 6765 7320 6475 7269 6e67 206f 7074 696d  ges during optim
-0001acf0: 6973 7469 630a 2020 2020 2020 2020 7265  istic.        re
-0001ad00: 706c 6963 6174 696f 6e20 7068 6173 652e  plication phase.
-0001ad10: 2054 6865 2061 7070 6c69 6361 7469 6f6e   The application
-0001ad20: 2074 7261 6e73 706f 7274 6174 696f 6e20   transportation 
-0001ad30: 6c61 7965 7220 7573 7561 6c6c 7920 6861  layer usually ha
-0001ad40: 7320 6974 7320 6f77 6e20 7365 6e64 696e  s its own sendin
-0001ad50: 670a 2020 2020 2020 2020 6275 6666 6572  g.        buffer
-0001ad60: 206f 7665 7220 5443 502f 5544 502e 2053   over TCP/UDP. S
-0001ad70: 6574 2074 6f20 6176 6f69 6420 6f76 6572  et to avoid over
-0001ad80: 666c 6f77 696e 6720 7468 6174 2073 656e  flowing that sen
-0001ad90: 6469 6e67 2062 7566 6665 722e 0a0a 2020  ding buffer...  
-0001ada0: 2020 2020 2020 3a70 6172 616d 2063 6865        :param che
-0001adb0: 636b 5f71 756f 7275 6d3a 2053 7065 6369  ck_quorum: Speci
-0001adc0: 6679 2069 6620 7468 6520 6c65 6164 6572  fy if the leader
-0001add0: 2073 686f 756c 6420 6368 6563 6b20 7175   should check qu
-0001ade0: 6f72 756d 2061 6374 6976 6974 792e 204c  orum activity. L
-0001adf0: 6561 6465 7220 7374 6570 7320 646f 776e  eader steps down
-0001ae00: 2077 6865 6e0a 2020 2020 2020 2020 7175   when.        qu
-0001ae10: 6f72 756d 2069 7320 6e6f 7420 6163 7469  orum is not acti
-0001ae20: 7665 2066 6f72 2061 6e20 656c 6563 7469  ve for an electi
-0001ae30: 6f6e 5469 6d65 6f75 742e 0a0a 2020 2020  onTimeout...    
-0001ae40: 2020 2020 3a70 6172 616d 2070 7265 5f76      :param pre_v
-0001ae50: 6f74 653a 2045 6e61 626c 6573 2074 6865  ote: Enables the
-0001ae60: 2050 7265 2d56 6f74 6520 616c 676f 7269   Pre-Vote algori
-0001ae70: 7468 6d20 6465 7363 7269 6265 6420 696e  thm described in
-0001ae80: 2072 6166 7420 7468 6573 6973 2073 6563   raft thesis sec
-0001ae90: 7469 6f6e 0a20 2020 2020 2020 2039 2e36  tion.        9.6
-0001aea0: 2e20 5468 6973 2070 7265 7665 6e74 7320  . This prevents 
-0001aeb0: 6469 7372 7570 7469 6f6e 2077 6865 6e20  disruption when 
-0001aec0: 6120 6e6f 6465 2074 6861 7420 6861 7320  a node that has 
-0001aed0: 6265 656e 2070 6172 7469 7469 6f6e 6564  been partitioned
-0001aee0: 2061 7761 790a 2020 2020 2020 2020 7265   away.        re
-0001aef0: 6a6f 696e 7320 7468 6520 636c 7573 7465  joins the cluste
-0001af00: 722e 0a0a 2020 2020 2020 2020 3a70 6172  r...        :par
-0001af10: 616d 206d 696e 5f65 6c65 6374 696f 6e5f  am min_election_
-0001af20: 7469 636b 3a20 5468 6520 7261 6e67 6520  tick: The range 
-0001af30: 6f66 2065 6c65 6374 696f 6e20 7469 6d65  of election time
-0001af40: 6f75 742e 2049 6e20 736f 6d65 2063 6173  out. In some cas
-0001af50: 6573 2c20 7765 2068 6f70 6520 736f 6d65  es, we hope some
-0001af60: 206e 6f64 6573 2068 6173 206c 6573 7320   nodes has less 
-0001af70: 706f 7373 6962 696c 6974 790a 2020 2020  possibility.    
-0001af80: 2020 2020 746f 2062 6563 6f6d 6520 6c65      to become le
-0001af90: 6164 6572 2e20 5468 6973 2063 6f6e 6669  ader. This confi
-0001afa0: 6775 7261 7469 6f6e 2065 6e73 7572 6573  guration ensures
-0001afb0: 2074 6861 7420 7468 6520 7261 6e64 6f6d   that the random
-0001afc0: 697a 6564 2065 6c65 6374 696f 6e5f 7469  ized election_ti
-0001afd0: 6d65 6f75 740a 2020 2020 2020 2020 7769  meout.        wi
-0001afe0: 6c6c 2061 6c77 6179 7320 6265 2073 7569  ll always be sui
-0001aff0: 7420 696e 205b 6d69 6e5f 656c 6563 7469  t in [min_electi
-0001b000: 6f6e 5f74 6963 6b2c 206d 6178 5f65 6c65  on_tick, max_ele
-0001b010: 6374 696f 6e5f 7469 636b 292e 0a20 2020  ction_tick)..   
-0001b020: 2020 2020 2049 6620 6974 2069 7320 302c       If it is 0,
-0001b030: 2074 6865 6e20 656c 6563 7469 6f6e 5f74   then election_t
-0001b040: 6963 6b20 7769 6c6c 2062 6520 6368 6f73  ick will be chos
-0001b050: 656e 2e0a 0a20 2020 2020 2020 203a 7061  en...        :pa
-0001b060: 7261 6d20 6d61 785f 656c 6563 7469 6f6e  ram max_election
-0001b070: 5f74 6963 6b3a 2049 6620 6974 2069 7320  _tick: If it is 
-0001b080: 302c 2074 6865 6e20 3220 2a20 656c 6563  0, then 2 * elec
-0001b090: 7469 6f6e 5f74 6963 6b20 7769 6c6c 2062  tion_tick will b
-0001b0a0: 6520 6368 6f73 656e 2e0a 0a20 2020 2020  e chosen...     
-0001b0b0: 2020 203a 7061 7261 6d20 7265 6164 5f6f     :param read_o
-0001b0c0: 6e6c 795f 6f70 7469 6f6e 3a20 4368 6f6f  nly_option: Choo
-0001b0d0: 7365 2074 6865 206c 696e 6561 7269 7a61  se the lineariza
-0001b0e0: 6269 6c69 7479 206d 6f64 6520 6f72 2074  bility mode or t
-0001b0f0: 6865 206c 6561 7365 206d 6f64 6520 746f  he lease mode to
-0001b100: 2072 6561 6420 6461 7461 2e20 4966 2079   read data. If y
-0001b110: 6f75 2064 6f6e e280 9974 2063 6172 6520  ou don...t care 
-0001b120: 6162 6f75 7420 7468 6520 7265 6164 2063  about the read c
-0001b130: 6f6e 7369 7374 656e 6379 2061 6e64 2077  onsistency and w
-0001b140: 616e 7420 6120 6869 6768 6572 2072 6561  ant a higher rea
-0001b150: 6420 7065 7266 6f72 6d61 6e63 652c 2079  d performance, y
-0001b160: 6f75 2063 616e 2075 7365 2074 6865 206c  ou can use the l
-0001b170: 6561 7365 206d 6f64 652e 0a20 2020 2020  ease mode..     
-0001b180: 2020 2053 6574 7469 6e67 2074 6869 7320     Setting this 
-0001b190: 746f 2060 4c65 6173 6542 6173 6564 6020  to `LeaseBased` 
-0001b1a0: 7265 7175 6972 6573 2060 6368 6563 6b5f  requires `check_
-0001b1b0: 7175 6f72 756d 203d 2074 7275 6560 2e0a  quorum = true`..
-0001b1c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001b1d0: 736b 6970 5f62 6361 7374 5f63 6f6d 6d69  skip_bcast_commi
-0001b1e0: 743a 2044 6f6e 2774 2062 726f 6164 6361  t: Don't broadca
-0001b1f0: 7374 2061 6e20 656d 7074 7920 7261 6674  st an empty raft
-0001b200: 2065 6e74 7279 2074 6f20 6e6f 7469 6679   entry to notify
-0001b210: 2066 6f6c 6c6f 7765 7220 746f 2063 6f6d   follower to com
-0001b220: 6d69 7420 616e 2065 6e74 7279 2e0a 2020  mit an entry..  
-0001b230: 2020 2020 2020 5468 6973 206d 6179 206d        This may m
-0001b240: 616b 6520 666f 6c6c 6f77 6572 2077 6169  ake follower wai
-0001b250: 7420 6120 6c6f 6e67 6572 2074 696d 6520  t a longer time 
-0001b260: 746f 2061 7070 6c79 2061 6e20 656e 7472  to apply an entr
-0001b270: 792e 2054 6869 7320 636f 6e66 6967 7572  y. This configur
-0001b280: 6174 696f 6e0a 2020 2020 2020 2020 4d61  ation.        Ma
-0001b290: 7920 6166 6665 6374 2070 726f 706f 7361  y affect proposa
-0001b2a0: 6c20 666f 7277 6172 6469 6e67 2061 6e64  l forwarding and
-0001b2b0: 2066 6f6c 6c6f 7765 7220 7265 6164 2e0a   follower read..
-0001b2c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001b2d0: 6261 7463 685f 6170 7065 6e64 3a20 4261  batch_append: Ba
-0001b2e0: 7463 6865 7320 6576 6572 7920 6170 7065  tches every appe
-0001b2f0: 6e64 206d 7367 2069 6620 616e 7920 6170  nd msg if any ap
-0001b300: 7065 6e64 206d 7367 2061 6c72 6561 6479  pend msg already
-0001b310: 2065 7869 7374 730a 0a20 2020 2020 2020   exists..       
-0001b320: 203a 7061 7261 6d20 7072 696f 7269 7479   :param priority
-0001b330: 3a20 5468 6520 656c 6563 7469 6f6e 2070  : The election p
-0001b340: 7269 6f72 6974 7920 6f66 2074 6869 7320  riority of this 
-0001b350: 6e6f 6465 2e0a 0a20 2020 2020 2020 203a  node...        :
-0001b360: 7061 7261 6d20 6d61 785f 756e 636f 6d6d  param max_uncomm
-0001b370: 6974 7465 645f 7369 7a65 3a20 5370 6563  itted_size: Spec
-0001b380: 6966 7920 6d61 7869 6d75 6d20 6f66 2075  ify maximum of u
-0001b390: 6e63 6f6d 6d69 7474 6564 2065 6e74 7279  ncommitted entry
-0001b3a0: 2073 697a 652e 0a20 2020 2020 2020 2057   size..        W
-0001b3b0: 6865 6e20 7468 6973 206c 696d 6974 2069  hen this limit i
-0001b3c0: 7320 7265 6163 6865 642c 2061 6c6c 2070  s reached, all p
-0001b3d0: 726f 706f 7361 6c73 2074 6f20 6170 7065  roposals to appe
-0001b3e0: 6e64 206e 6577 206c 6f67 2077 696c 6c20  nd new log will 
-0001b3f0: 6265 2064 726f 7070 6564 0a0a 2020 2020  be dropped..    
-0001b400: 2020 2020 3a70 6172 616d 206d 6178 5f63      :param max_c
-0001b410: 6f6d 6d69 7474 6564 5f73 697a 655f 7065  ommitted_size_pe
-0001b420: 725f 7265 6164 793a 204d 6178 2073 697a  r_ready: Max siz
-0001b430: 6520 666f 7220 636f 6d6d 6974 7465 6420  e for committed 
-0001b440: 656e 7472 6965 7320 696e 2061 2060 5265  entries in a `Re
-0001b450: 6164 7960 2e0a 2020 2020 2020 2020 2222  ady`..        ""
-0001b460: 220a 2020 2020 6465 6620 6d61 6b65 5f72  ".    def make_r
-0001b470: 6566 2873 656c 6629 202d 3e20 2243 6f6e  ef(self) -> "Con
-0001b480: 6669 6752 6566 223a 202e 2e2e 0a20 2020  figRef": ....   
-0001b490: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-0001b4a0: 2020 2064 6566 2064 6566 6175 6c74 2829     def default()
-0001b4b0: 202d 3e20 2243 6f6e 6669 6722 3a20 2e2e   -> "Config": ..
-0001b4c0: 2e0a 0a63 6c61 7373 2043 6f6e 6669 6752  ...class ConfigR
-0001b4d0: 6566 285f 5f41 5049 5f43 6f6e 6669 6729  ef(__API_Config)
-0001b4e0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-0001b4f0: 6665 7265 6e63 6520 7479 7065 206f 6620  ference type of 
-0001b500: 3a63 6c61 7373 3a60 496e 666c 6967 6874  :class:`Inflight
-0001b510: 7352 6566 602e 0a20 2020 2022 2222 0a0a  sRef`..    """..
-0001b520: 2320 544f 444f 3a20 4164 6420 6265 6c6f  # TODO: Add belo
-0001b530: 7720 696d 706c 656d 656e 7461 7469 6f6e  w implementation
-0001b540: 2069 6620 6e65 6564 6564 2c20 6f74 6865   if needed, othe
-0001b550: 7277 6973 6520 7265 6d6f 7665 2062 656c  rwise remove bel
-0001b560: 6f77 2063 6f64 6573 2e0a 2320 636c 6173  ow codes..# clas
-0001b570: 7320 5f5f 4150 495f 5374 6174 7573 3a0a  s __API_Status:.
-0001b580: 2320 2020 2020 6465 6620 6765 745f 6170  #     def get_ap
-0001b590: 706c 6965 6428 7365 6c66 2920 2d3e 2069  plied(self) -> i
-0001b5a0: 6e74 3a0a 2320 2020 2020 2020 2020 2222  nt:.#         ""
-0001b5b0: 2220 2222 220a 2320 2020 2020 6465 6620  " """.#     def 
-0001b5c0: 7365 745f 6170 706c 6965 6428 7365 6c66  set_applied(self
-0001b5d0: 2c20 6170 706c 6965 643a 2069 6e74 2920  , applied: int) 
-0001b5e0: 2d3e 204e 6f6e 653a 0a23 2020 2020 2020  -> None:.#      
-0001b5f0: 2020 2022 2222 2022 2222 0a23 2020 2020     """ """.#    
-0001b600: 2064 6566 2067 6574 5f69 6428 7365 6c66   def get_id(self
-0001b610: 2920 2d3e 2069 6e74 3a0a 2320 2020 2020  ) -> int:.#     
-0001b620: 2020 2020 2222 2220 2222 220a 2320 2020      """ """.#   
-0001b630: 2020 6465 6620 7365 745f 6964 2873 656c    def set_id(sel
-0001b640: 662c 2069 643a 2069 6e74 2920 2d3e 204e  f, id: int) -> N
-0001b650: 6f6e 653a 0a23 2020 2020 2020 2020 2022  one:.#         "
-0001b660: 2222 2022 2222 0a23 2020 2020 2064 6566  "" """.#     def
-0001b670: 2067 6574 5f68 7328 7365 6c66 2920 2d3e   get_hs(self) ->
-0001b680: 2048 6172 6453 7461 7465 5265 663a 0a23   HardStateRef:.#
-0001b690: 2020 2020 2020 2020 2022 2222 2022 2222           """ """
-0001b6a0: 0a23 2020 2020 2064 6566 2073 6574 5f68  .#     def set_h
-0001b6b0: 7328 7365 6c66 2c20 6873 3a20 4861 7264  s(self, hs: Hard
-0001b6c0: 5374 6174 6552 6566 2920 2d3e 204e 6f6e  StateRef) -> Non
-0001b6d0: 653a 0a23 2020 2020 2020 2020 2022 2222  e:.#         """
-0001b6e0: 2022 2222 0a23 2020 2020 2064 6566 2067   """.#     def g
-0001b6f0: 6574 5f73 7328 7365 6c66 2920 2d3e 2053  et_ss(self) -> S
-0001b700: 6f66 7453 7461 7465 5265 663a 0a23 2020  oftStateRef:.#  
-0001b710: 2020 2020 2020 2022 2222 2022 2222 0a23         """ """.#
-0001b720: 2020 2020 2064 6566 2073 6574 5f73 7328       def set_ss(
-0001b730: 7365 6c66 2c20 7373 3a20 536f 6674 5374  self, ss: SoftSt
-0001b740: 6174 6552 6566 2920 2d3e 204e 6f6e 653a  ateRef) -> None:
-0001b750: 0a23 2020 2020 2020 2020 2022 2222 2022  .#         """ "
-0001b760: 2222 0a23 2020 2020 2064 6566 2067 6574  "".#     def get
-0001b770: 5f70 726f 6772 6573 7328 7365 6c66 2920  _progress(self) 
-0001b780: 2d3e 204f 7074 696f 6e61 6c5b 5072 6f67  -> Optional[Prog
-0001b790: 7265 7373 5472 6163 6b65 7252 6566 5d3a  ressTrackerRef]:
-0001b7a0: 0a23 2020 2020 2020 2020 2022 2222 2022  .#         """ "
-0001b7b0: 2222 0a23 2020 2020 2064 6566 2073 6574  "".#     def set
-0001b7c0: 5f70 726f 6772 6573 7328 0a23 2020 2020  _progress(.#    
-0001b7d0: 2020 2020 2073 656c 662c 2074 7261 636b       self, track
-0001b7e0: 6572 3a20 4f70 7469 6f6e 616c 5b50 726f  er: Optional[Pro
-0001b7f0: 6772 6573 7354 7261 636b 6572 5d20 7c20  gressTracker] | 
-0001b800: 4f70 7469 6f6e 616c 5b50 726f 6772 6573  Optional[Progres
-0001b810: 7354 7261 636b 6572 5265 665d 0a23 2020  sTrackerRef].#  
-0001b820: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2320     ) -> None:.# 
-0001b830: 2020 2020 2020 2020 2222 2220 2222 220a          """ """.
-0001b840: 0a23 2063 6c61 7373 2049 6e4d 656d 6f72  .# class InMemor
-0001b850: 7953 7461 7475 7328 5f5f 4150 495f 5374  yStatus(__API_St
-0001b860: 6174 7573 293a 0a23 2020 2020 2022 2222  atus):.#     """
-0001b870: 0a23 2020 2020 2052 6570 7265 7365 6e74  .#     Represent
-0001b880: 7320 7468 6520 6375 7272 656e 7420 7374  s the current st
-0001b890: 6174 7573 206f 6620 7468 6520 7261 6674  atus of the raft
-0001b8a0: 0a23 2020 2020 2022 2222 0a0a 2320 2020  .#     """..#   
-0001b8b0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0001b8c0: 656c 662c 2072 6166 743a 2049 6e4d 656d  elf, raft: InMem
-0001b8d0: 6f72 7952 6166 7429 202d 3e20 4e6f 6e65  oryRaft) -> None
-0001b8e0: 3a20 2e2e 2e0a 2320 2020 2020 6465 6620  : ....#     def 
-0001b8f0: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
-0001b900: 3e20 5374 6174 7573 5f5f 4d65 6d73 746f  > Status__Memsto
-0001b910: 7261 6765 5265 663a 202e 2e2e 0a0a 2320  rageRef: .....# 
-0001b920: 636c 6173 7320 496e 4d65 6d6f 7279 5374  class InMemorySt
-0001b930: 6174 7573 5265 6628 5f5f 4150 495f 5374  atusRef(__API_St
-0001b940: 6174 7573 293a 0a23 2020 2020 2022 2222  atus):.#     """
-0001b950: 0a23 2020 2020 2052 6566 6572 656e 6365  .#     Reference
-0001b960: 2074 7970 6520 6f66 203a 636c 6173 733a   type of :class:
-0001b970: 6053 7461 7475 735f 5f4d 656d 7374 6f72  `Status__Memstor
-0001b980: 6167 6560 2e0a 2320 2020 2020 2222 220a  age`..#     """.
-0001b990: 0a63 6c61 7373 2044 6573 7472 6f79 6564  .class Destroyed
-0001b9a0: 5265 6655 7365 6445 7272 6f72 2845 7863  RefUsedError(Exc
-0001b9b0: 6570 7469 6f6e 293a 0a20 2020 2022 2222  eption):.    """
-0001b9c0: 2022 2222 0a0a 636c 6173 7320 5261 6674   """..class Raft
-0001b9d0: 4572 726f 7228 4578 6365 7074 696f 6e29  Error(Exception)
-0001b9e0: 3a0a 2020 2020 2222 2220 2222 220a 0a63  :.    """ """..c
-0001b9f0: 6c61 7373 2045 7869 7374 7345 7272 6f72  lass ExistsError
-0001ba00: 2852 6166 7445 7272 6f72 293a 0a20 2020  (RaftError):.   
-0001ba10: 2022 2222 0a20 2020 2054 6865 206e 6f64   """.    The nod
-0001ba20: 6520 7b69 647d 2061 6c72 6561 6479 2065  e {id} already e
-0001ba30: 7869 7374 7320 696e 2074 6865 207b 7365  xists in the {se
-0001ba40: 747d 2073 6574 2e0a 2020 2020 2222 220a  t} set..    """.
-0001ba50: 0a20 2020 2069 643a 2069 6e74 0a20 2020  .    id: int.   
-0001ba60: 2073 6574 3a20 7374 720a 0a63 6c61 7373   set: str..class
-0001ba70: 204e 6f74 4578 6973 7473 2852 6166 7445   NotExists(RaftE
-0001ba80: 7272 6f72 293a 0a20 2020 2022 2222 0a20  rror):.    """. 
-0001ba90: 2020 2054 6865 206e 6f64 6520 7b69 647d     The node {id}
-0001baa0: 2069 7320 6e6f 7420 696e 2074 6865 207b   is not in the {
-0001bab0: 7365 747d 2073 6574 2e0a 2020 2020 2222  set} set..    ""
-0001bac0: 220a 0a20 2020 2069 643a 2069 6e74 0a20  "..    id: int. 
-0001bad0: 2020 2073 6574 3a20 7374 720a 0a63 6c61     set: str..cla
-0001bae0: 7373 2043 6f64 6563 4572 726f 7228 5261  ss CodecError(Ra
-0001baf0: 6674 4572 726f 7229 3a0a 2020 2020 2222  ftError):.    ""
-0001bb00: 220a 2020 2020 4120 7072 6f74 6f62 7566  ".    A protobuf
-0001bb10: 206d 6573 7361 6765 2063 6f64 6563 2066   message codec f
-0001bb20: 6169 6c65 6420 696e 2073 6f6d 6520 6d61  ailed in some ma
-0001bb30: 6e6e 6572 2e0a 2020 2020 2222 220a 0a63  nner..    """..c
-0001bb40: 6c61 7373 2043 6f6e 6669 6749 6e76 616c  lass ConfigInval
-0001bb50: 6964 4572 726f 7228 5261 6674 4572 726f  idError(RaftErro
-0001bb60: 7229 3a0a 2020 2020 2222 220a 2020 2020  r):.    """.    
-0001bb70: 5468 6520 636f 6e66 6967 7572 6174 696f  The configuratio
-0001bb80: 6e20 6973 2069 6e76 616c 6964 2e0a 2020  n is invalid..  
-0001bb90: 2020 2222 220a 0a63 6c61 7373 2050 726f    """..class Pro
-0001bba0: 706f 7361 6c44 726f 7070 6564 4572 726f  posalDroppedErro
-0001bbb0: 7228 5261 6674 4572 726f 7229 3a0a 2020  r(RaftError):.  
-0001bbc0: 2020 2222 220a 2020 2020 5468 6520 7072    """.    The pr
-0001bbd0: 6f70 6f73 616c 206f 6620 6368 616e 6765  oposal of change
-0001bbe0: 7320 7761 7320 6472 6f70 7065 642e 0a20  s was dropped.. 
-0001bbf0: 2020 2022 2222 0a0a 636c 6173 7320 5265     """..class Re
-0001bc00: 7175 6573 7453 6e61 7073 686f 7444 726f  questSnapshotDro
-0001bc10: 7070 6564 4572 726f 7228 5261 6674 4572  ppedError(RaftEr
-0001bc20: 726f 7229 3a0a 2020 2020 2222 220a 2020  ror):.    """.  
-0001bc30: 2020 5468 6520 7265 7175 6573 7420 736e    The request sn
-0001bc40: 6170 7368 6f74 2069 7320 6472 6f70 7065  apshot is droppe
-0001bc50: 642e 0a20 2020 2022 2222 0a0a 636c 6173  d..    """..clas
-0001bc60: 7320 436f 6e66 4368 616e 6765 4572 726f  s ConfChangeErro
-0001bc70: 7228 5261 6674 4572 726f 7229 3a0a 2020  r(RaftError):.  
-0001bc80: 2020 2222 220a 2020 2020 436f 6e66 4368    """.    ConfCh
-0001bc90: 616e 6765 2070 726f 706f 7361 6c20 6973  ange proposal is
-0001bca0: 2069 6e76 616c 6964 2e0a 2020 2020 2222   invalid..    ""
-0001bcb0: 220a 0a63 6c61 7373 2049 6f45 7272 6f72  "..class IoError
-0001bcc0: 2852 6166 7445 7272 6f72 293a 0a20 2020  (RaftError):.   
-0001bcd0: 2022 2222 0a20 2020 2041 6e20 494f 2065   """.    An IO e
-0001bce0: 7272 6f72 206f 6363 7572 7265 642e 0a20  rror occurred.. 
-0001bcf0: 2020 2022 2222 0a0a 636c 6173 7320 5374     """..class St
-0001bd00: 6f72 6545 7272 6f72 2852 6166 7445 7272  oreError(RaftErr
-0001bd10: 6f72 293a 0a20 2020 2022 2222 0a20 2020  or):.    """.   
-0001bd20: 2041 2073 746f 7261 6765 2065 7272 6f72   A storage error
-0001bd30: 206f 6363 7572 7265 642e 0a20 2020 2022   occurred..    "
-0001bd40: 2222 0a0a 636c 6173 7320 5374 6570 4c6f  ""..class StepLo
-0001bd50: 6361 6c4d 7367 2852 6166 7445 7272 6f72  calMsg(RaftError
-0001bd60: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-0001bd70: 6166 7420 6361 6e6e 6f74 2073 7465 7020  aft cannot step 
-0001bd80: 7468 6520 6c6f 6361 6c20 6d65 7373 6167  the local messag
-0001bd90: 652e 0a20 2020 2022 2222 0a0a 636c 6173  e..    """..clas
-0001bda0: 7320 5374 6570 5065 6572 4e6f 7446 6f75  s StepPeerNotFou
-0001bdb0: 6e64 2852 6166 7445 7272 6f72 293a 0a20  nd(RaftError):. 
-0001bdc0: 2020 2022 2222 0a20 2020 2054 6865 2072     """.    The r
-0001bdd0: 6166 7420 7065 6572 2069 7320 6e6f 7420  aft peer is not 
-0001bde0: 666f 756e 6420 616e 6420 7468 7573 2063  found and thus c
-0001bdf0: 616e 6e6f 7420 7374 6570 2e0a 2020 2020  annot step..    
-0001be00: 2222 220a 0a63 6c61 7373 2052 6166 7453  """..class RaftS
-0001be10: 746f 7261 6765 4572 726f 7228 4578 6365  torageError(Exce
-0001be20: 7074 696f 6e29 3a0a 2020 2020 2222 220a  ption):.    """.
-0001be30: 2020 2020 416e 2065 7272 6f72 2077 6974      An error wit
-0001be40: 6820 7468 6520 7374 6f72 6167 652e 0a20  h the storage.. 
-0001be50: 2020 2022 2222 0a0a 636c 6173 7320 436f     """..class Co
-0001be60: 6d70 6163 7465 6445 7272 6f72 2852 6166  mpactedError(Raf
-0001be70: 7453 746f 7261 6765 4572 726f 7229 3a0a  tStorageError):.
-0001be80: 2020 2020 2222 220a 2020 2020 5468 6520      """.    The 
-0001be90: 7374 6f72 6167 6520 7761 7320 636f 6d70  storage was comp
-0001bea0: 6163 7465 6420 616e 6420 6e6f 7420 6163  acted and not ac
-0001beb0: 6365 7373 6962 6c65 0a20 2020 2022 2222  cessible.    """
-0001bec0: 0a0a 636c 6173 7320 556e 6176 6169 6c61  ..class Unavaila
-0001bed0: 626c 6545 7272 6f72 2852 6166 7453 746f  bleError(RaftSto
-0001bee0: 7261 6765 4572 726f 7229 3a0a 2020 2020  rageError):.    
-0001bef0: 2222 220a 2020 2020 5468 6520 6c6f 6720  """.    The log 
-0001bf00: 6973 206e 6f74 2061 7661 696c 6162 6c65  is not available
-0001bf10: 2e0a 2020 2020 2222 220a 0a63 6c61 7373  ..    """..class
-0001bf20: 204c 6f67 5465 6d70 6f72 6172 696c 7955   LogTemporarilyU
-0001bf30: 6e61 7661 696c 6162 6c65 4572 726f 7228  navailableError(
-0001bf40: 5261 6674 5374 6f72 6167 6545 7272 6f72  RaftStorageError
-0001bf50: 293a 0a20 2020 2022 2222 0a20 2020 2054  ):.    """.    T
-0001bf60: 6865 206c 6f67 2069 7320 6265 696e 6720  he log is being 
-0001bf70: 6665 7463 6865 642e 0a20 2020 2022 2222  fetched..    """
-0001bf80: 0a0a 636c 6173 7320 536e 6170 7368 6f74  ..class Snapshot
-0001bf90: 4f75 744f 6644 6174 6545 7272 6f72 2852  OutOfDateError(R
-0001bfa0: 6166 7453 746f 7261 6765 4572 726f 7229  aftStorageError)
-0001bfb0: 3a0a 2020 2020 2222 220a 2020 2020 5468  :.    """.    Th
-0001bfc0: 6520 736e 6170 7368 6f74 2069 7320 6f75  e snapshot is ou
-0001bfd0: 7420 6f66 2064 6174 652e 0a20 2020 2022  t of date..    "
-0001bfe0: 2222 0a0a 636c 6173 7320 536e 6170 7368  ""..class Snapsh
-0001bff0: 6f74 5465 6d70 6f72 6172 696c 7955 6e61  otTemporarilyUna
-0001c000: 7661 696c 6162 6c65 2852 6166 7453 746f  vailable(RaftSto
-0001c010: 7261 6765 4572 726f 7229 3a0a 2020 2020  rageError):.    
-0001c020: 2222 220a 2020 2020 5468 6520 736e 6170  """.    The snap
-0001c030: 7368 6f74 2069 7320 6265 696e 6720 6372  shot is being cr
-0001c040: 6561 7465 642e 0a20 2020 2022 2222 0a0a  eated..    """..
-0001c050: 636c 6173 7320 4f74 6865 7245 7272 6f72  class OtherError
-0001c060: 2852 6166 7453 746f 7261 6765 4572 726f  (RaftStorageErro
-0001c070: 7229 3a0a 2020 2020 2222 220a 2020 2020  r):.    """.    
-0001c080: 536f 6d65 206f 7468 6572 2065 7272 6f72  Some other error
-0001c090: 206f 6363 7572 7265 642e 0a20 2020 2022   occurred..    "
-0001c0a0: 2222 0a                                  "".
+0000d7b0: 5f72 6571 7565 7374 5f63 7478 2873 656c  _request_ctx(sel
+0000d7c0: 662c 2072 6571 7565 7374 5f63 7478 3a20  f, request_ctx: 
+0000d7d0: 6279 7465 7329 202d 3e20 4e6f 6e65 3a0a  bytes) -> None:.
+0000d7e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000d7f0: 2020 2020 6072 6571 7565 7374 5f63 7478      `request_ctx
+0000d800: 603a 2041 2064 6174 6167 7261 6d20 636f  `: A datagram co
+0000d810: 6e73 6973 7469 6e67 206f 6620 636f 6e74  nsisting of cont
+0000d820: 6578 7420 6162 6f75 7420 7468 6520 7265  ext about the re
+0000d830: 7175 6573 742e 0a20 2020 2020 2020 2022  quest..        "
+0000d840: 2222 0a0a 636c 6173 7320 5265 6164 5374  ""..class ReadSt
+0000d850: 6174 6528 5f5f 4150 495f 5265 6164 5374  ate(__API_ReadSt
+0000d860: 6174 6529 3a0a 2020 2020 2222 220a 2020  ate):.    """.  
+0000d870: 2020 5265 6164 5374 6174 6520 7072 6f76    ReadState prov
+0000d880: 6964 6573 2073 7461 7465 2066 6f72 2072  ides state for r
+0000d890: 6561 6420 6f6e 6c79 2071 7565 7279 2e0a  ead only query..
+0000d8a0: 2020 2020 4974 2773 2063 616c 6c65 7227      It's caller'
+0000d8b0: 7320 7265 7370 6f6e 7369 6269 6c69 7479  s responsibility
+0000d8c0: 2074 6f20 7365 6e64 204d 7367 5265 6164   to send MsgRead
+0000d8d0: 496e 6465 7820 6669 7273 7420 6265 666f  Index first befo
+0000d8e0: 7265 2067 6574 7469 6e67 0a20 2020 2074  re getting.    t
+0000d8f0: 6869 7320 7374 6174 6520 6672 6f6d 2072  his state from r
+0000d900: 6561 6479 2e20 4974 2773 2061 6c73 6f20  eady. It's also 
+0000d910: 6361 6c6c 6572 2773 2064 7574 7920 746f  caller's duty to
+0000d920: 2064 6966 6665 7265 6e74 6961 7465 2069   differentiate i
+0000d930: 6620 7468 6973 0a20 2020 2073 7461 7465  f this.    state
+0000d940: 2069 7320 7768 6174 2069 7420 7265 7175   is what it requ
+0000d950: 6573 7473 2074 6872 6f75 6768 2072 6571  ests through req
+0000d960: 7565 7374 5f63 7478 2c20 652e 672e 2067  uest_ctx, e.g. g
+0000d970: 6976 656e 2061 2075 6e69 7175 6520 6964  iven a unique id
+0000d980: 2061 730a 2020 2020 7265 7175 6573 745f   as.    request_
+0000d990: 6374 782e 0a20 2020 2022 2222 0a0a 2020  ctx..    """..  
+0000d9a0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+0000d9b0: 656c 6629 202d 3e20 4e6f 6e65 3a20 2e2e  elf) -> None: ..
+0000d9c0: 2e0a 2020 2020 6465 6620 6d61 6b65 5f72  ..    def make_r
+0000d9d0: 6566 2873 656c 6629 202d 3e20 2252 6561  ef(self) -> "Rea
+0000d9e0: 6453 7461 7465 5265 6622 3a20 2e2e 2e0a  dStateRef": ....
+0000d9f0: 0a63 6c61 7373 2052 6561 6453 7461 7465  .class ReadState
+0000da00: 5265 6628 5f5f 4150 495f 5265 6164 5374  Ref(__API_ReadSt
+0000da10: 6174 6529 3a0a 2020 2020 2222 220a 2020  ate):.    """.  
+0000da20: 2020 5265 6665 7265 6e63 6520 7479 7065    Reference type
+0000da30: 206f 6620 3a63 6c61 7373 3a60 5265 6164   of :class:`Read
+0000da40: 5374 6174 6560 2e0a 2020 2020 2222 220a  State`..    """.
+0000da50: 0a63 6c61 7373 205f 5f41 5049 5f52 6166  .class __API_Raf
+0000da60: 744c 6f67 3a0a 2020 2020 6465 6620 656e  tLog:.    def en
+0000da70: 7472 6965 7328 0a20 2020 2020 2020 2073  tries(.        s
+0000da80: 656c 662c 2069 6478 3a20 696e 742c 2063  elf, idx: int, c
+0000da90: 6f6e 7465 7874 3a20 2247 6574 456e 7472  ontext: "GetEntr
+0000daa0: 6965 7343 6f6e 7465 7874 5265 6622 2c20  iesContextRef", 
+0000dab0: 6d61 785f 7369 7a65 3a20 4f70 7469 6f6e  max_size: Option
+0000dac0: 616c 5b69 6e74 5d0a 2020 2020 2920 2d3e  al[int].    ) ->
+0000dad0: 204c 6973 745b 2245 6e74 7279 225d 3a0a   List["Entry"]:.
+0000dae0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000daf0: 2020 2020 5265 7475 726e 7320 656e 7472      Returns entr
+0000db00: 6965 7320 7374 6172 7469 6e67 2066 726f  ies starting fro
+0000db10: 6d20 6120 7061 7274 6963 756c 6172 2069  m a particular i
+0000db20: 6e64 6578 2061 6e64 206e 6f74 2065 7863  ndex and not exc
+0000db30: 6565 6469 6e67 2061 2062 7974 6573 697a  eeding a bytesiz
+0000db40: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+0000db50: 2020 2064 6566 2061 6c6c 5f65 6e74 7269     def all_entri
+0000db60: 6573 2873 656c 6629 202d 3e20 4c69 7374  es(self) -> List
+0000db70: 5b22 456e 7472 7922 5d3a 0a20 2020 2020  ["Entry"]:.     
+0000db80: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+0000db90: 6574 7572 6e73 2061 6c6c 2074 6865 2065  eturns all the e
+0000dba0: 6e74 7269 6573 2e20 4f6e 6c79 2075 7365  ntries. Only use
+0000dbb0: 6420 6279 2074 6573 7473 2e0a 2020 2020  d by tests..    
+0000dbc0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+0000dbd0: 6170 7065 6e64 2873 656c 662c 2065 6e74  append(self, ent
+0000dbe0: 733a 204c 6973 745b 2245 6e74 7279 225d  s: List["Entry"]
+0000dbf0: 207c 204c 6973 745b 2245 6e74 7279 5265   | List["EntryRe
+0000dc00: 6622 5d29 202d 3e20 696e 743a 0a20 2020  f"]) -> int:.   
+0000dc10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000dc20: 2041 7070 656e 6473 2061 2073 6574 206f   Appends a set o
+0000dc30: 6620 656e 7472 6965 7320 746f 2074 6865  f entries to the
+0000dc40: 2075 6e73 7461 626c 6520 6c69 7374 2e0a   unstable list..
+0000dc50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000dc60: 6465 6620 6170 706c 6965 6428 7365 6c66  def applied(self
+0000dc70: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+0000dc80: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+0000dc90: 7475 726e 7320 7468 6520 6c61 7374 2061  turns the last a
+0000dca0: 7070 6c69 6564 2069 6e64 6578 2e0a 2020  pplied index..  
+0000dcb0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0000dcc0: 6620 6669 6e64 5f63 6f6e 666c 6963 7428  f find_conflict(
+0000dcd0: 7365 6c66 2c20 656e 7473 3a20 4c69 7374  self, ents: List
+0000dce0: 5b22 456e 7472 7922 5d20 7c20 4c69 7374  ["Entry"] | List
+0000dcf0: 5b22 456e 7472 7952 6566 225d 2920 2d3e  ["EntryRef"]) ->
+0000dd00: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+0000dd10: 220a 2020 2020 2020 2020 4669 6e64 7320  ".        Finds 
+0000dd20: 7468 6520 696e 6465 7820 6f66 2074 6865  the index of the
+0000dd30: 2063 6f6e 666c 6963 742e 0a0a 2020 2020   conflict...    
+0000dd40: 2020 2020 4974 2072 6574 7572 6e73 2074      It returns t
+0000dd50: 6865 2066 6972 7374 2069 6e64 6578 206f  he first index o
+0000dd60: 6620 636f 6e66 6c69 6374 696e 6720 656e  f conflicting en
+0000dd70: 7472 6965 7320 6265 7477 6565 6e20 7468  tries between th
+0000dd80: 6520 6578 6973 7469 6e67 0a20 2020 2020  e existing.     
+0000dd90: 2020 2065 6e74 7269 6573 2061 6e64 2074     entries and t
+0000dda0: 6865 2067 6976 656e 2065 6e74 7269 6573  he given entries
+0000ddb0: 2c20 6966 2074 6865 7265 2061 7265 2061  , if there are a
+0000ddc0: 6e79 2e0a 0a20 2020 2020 2020 2049 6620  ny...        If 
+0000ddd0: 7468 6572 6520 6172 6520 6e6f 2063 6f6e  there are no con
+0000dde0: 666c 6963 7469 6e67 2065 6e74 7269 6573  flicting entries
+0000ddf0: 2c20 616e 6420 7468 6520 6578 6973 7469  , and the existi
+0000de00: 6e67 2065 6e74 7269 6573 2063 6f6e 7461  ng entries conta
+0000de10: 696e 0a20 2020 2020 2020 2061 6c6c 2074  in.        all t
+0000de20: 6865 2067 6976 656e 2065 6e74 7269 6573  he given entries
+0000de30: 2c20 7a65 726f 2077 696c 6c20 6265 2072  , zero will be r
+0000de40: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
+0000de50: 2020 4966 2074 6865 7265 2061 7265 206e    If there are n
+0000de60: 6f20 636f 6e66 6c69 6374 696e 6720 656e  o conflicting en
+0000de70: 7472 6965 732c 2062 7574 2074 6865 2067  tries, but the g
+0000de80: 6976 656e 2065 6e74 7269 6573 2063 6f6e  iven entries con
+0000de90: 7461 696e 7320 6e65 770a 2020 2020 2020  tains new.      
+0000dea0: 2020 656e 7472 6965 732c 2074 6865 2069    entries, the i
+0000deb0: 6e64 6578 206f 6620 7468 6520 6669 7273  ndex of the firs
+0000dec0: 7420 6e65 7720 656e 7472 7920 7769 6c6c  t new entry will
+0000ded0: 2062 6520 7265 7475 726e 6564 2e0a 0a20   be returned... 
+0000dee0: 2020 2020 2020 2041 6e20 656e 7472 7920         An entry 
+0000def0: 6973 2063 6f6e 7369 6465 7265 6420 746f  is considered to
+0000df00: 2062 6520 636f 6e66 6c69 6374 696e 6720   be conflicting 
+0000df10: 6966 2069 7420 6861 7320 7468 6520 7361  if it has the sa
+0000df20: 6d65 2069 6e64 6578 2062 7574 0a20 2020  me index but.   
+0000df30: 2020 2020 2061 2064 6966 6665 7265 6e74       a different
+0000df40: 2074 6572 6d2e 0a0a 2020 2020 2020 2020   term...        
+0000df50: 5468 6520 6669 7273 7420 656e 7472 7920  The first entry 
+0000df60: 4d55 5354 2068 6176 6520 616e 2069 6e64  MUST have an ind
+0000df70: 6578 2065 7175 616c 2074 6f20 7468 6520  ex equal to the 
+0000df80: 6172 6775 6d65 6e74 2027 6672 6f6d 272e  argument 'from'.
+0000df90: 0a20 2020 2020 2020 2054 6865 2069 6e64  .        The ind
+0000dfa0: 6578 206f 6620 7468 6520 6769 7665 6e20  ex of the given 
+0000dfb0: 656e 7472 6965 7320 4d55 5354 2062 6520  entries MUST be 
+0000dfc0: 636f 6e74 696e 756f 7573 6c79 2069 6e63  continuously inc
+0000dfd0: 7265 6173 696e 672e 0a20 2020 2020 2020  reasing..       
+0000dfe0: 2022 2222 0a20 2020 2064 6566 2066 696e   """.    def fin
+0000dff0: 645f 636f 6e66 6c69 6374 5f62 795f 7465  d_conflict_by_te
+0000e000: 726d 2873 656c 662c 2069 6e64 6578 3a20  rm(self, index: 
+0000e010: 696e 742c 2074 6572 6d3a 2069 6e74 2920  int, term: int) 
+0000e020: 2d3e 2054 7570 6c65 5b69 6e74 2c20 4f70  -> Tuple[int, Op
+0000e030: 7469 6f6e 616c 5b69 6e74 5d5d 3a0a 2020  tional[int]]:.  
+0000e040: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000e050: 2020 6669 6e64 5f63 6f6e 666c 6963 745f    find_conflict_
+0000e060: 6279 5f74 6572 6d20 7461 6b65 7320 616e  by_term takes an
+0000e070: 2028 6069 6e64 6578 602c 2060 7465 726d   (`index`, `term
+0000e080: 6029 2070 6169 7220 2869 6e64 6963 6174  `) pair (indicat
+0000e090: 696e 6720 6120 636f 6e66 6c69 6374 696e  ing a conflictin
+0000e0a0: 6720 6c6f 670a 2020 2020 2020 2020 656e  g log.        en
+0000e0b0: 7472 7920 6f6e 2061 206c 6561 6465 722f  try on a leader/
+0000e0c0: 666f 6c6c 6f77 6572 2064 7572 696e 6720  follower during 
+0000e0d0: 616e 2061 7070 656e 6429 2061 6e64 2066  an append) and f
+0000e0e0: 696e 6473 2074 6865 206c 6172 6765 7374  inds the largest
+0000e0f0: 2069 6e64 6578 2069 6e0a 2020 2020 2020   index in.      
+0000e100: 2020 6c6f 6720 7769 7468 206c 6f67 2e74    log with log.t
+0000e110: 6572 6d20 3c3d 2060 7465 726d 6020 616e  erm <= `term` an
+0000e120: 6420 6c6f 672e 696e 6465 7820 3c3d 2060  d log.index <= `
+0000e130: 696e 6465 7860 2e20 4966 206e 6f20 7375  index`. If no su
+0000e140: 6368 2069 6e64 6578 2065 7869 7374 730a  ch index exists.
+0000e150: 2020 2020 2020 2020 696e 2074 6865 206c          in the l
+0000e160: 6f67 2c20 7468 6520 6c6f 6727 7320 6669  og, the log's fi
+0000e170: 7273 7420 696e 6465 7820 6973 2072 6574  rst index is ret
+0000e180: 7572 6e65 642e 0a0a 2020 2020 2020 2020  urned...        
+0000e190: 5468 6520 696e 6465 7820 7072 6f76 6964  The index provid
+0000e1a0: 6564 204d 5553 5420 6265 2065 7175 616c  ed MUST be equal
+0000e1b0: 2074 6f20 6f72 206c 6573 7320 7468 616e   to or less than
+0000e1c0: 2073 656c 662e 6c61 7374 5f69 6e64 6578   self.last_index
+0000e1d0: 2829 2e20 496e 7661 6c69 640a 2020 2020  (). Invalid.    
+0000e1e0: 2020 2020 696e 7075 7473 206c 6f67 2061      inputs log a
+0000e1f0: 2077 6172 6e69 6e67 2061 6e64 2074 6865   warning and the
+0000e200: 2069 6e70 7574 2069 6e64 6578 2069 7320   input index is 
+0000e210: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
+0000e220: 2020 2052 6574 7572 6e20 2869 6e64 6578     Return (index
+0000e230: 2c20 7465 726d 290a 2020 2020 2020 2020  , term).        
+0000e240: 2222 220a 2020 2020 6465 6620 636f 6d6d  """.    def comm
+0000e250: 6974 5f74 6f28 7365 6c66 2c20 746f 5f63  it_to(self, to_c
+0000e260: 6f6d 6d69 743a 2069 6e74 2920 2d3e 204e  ommit: int) -> N
+0000e270: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000e280: 0a20 2020 2020 2020 2053 6574 7320 7468  .        Sets th
+0000e290: 6520 6c61 7374 2063 6f6d 6d69 7474 6564  e last committed
+0000e2a0: 2076 616c 7565 2074 6f20 7468 6520 7061   value to the pa
+0000e2b0: 7373 6564 2069 6e20 7661 6c75 652e 0a0a  ssed in value...
+0000e2c0: 2020 2020 2020 2020 2320 5061 6e69 6373          # Panics
+0000e2d0: 0a0a 2020 2020 2020 2020 5061 6e69 6373  ..        Panics
+0000e2e0: 2069 6620 7468 6520 696e 6465 7820 676f   if the index go
+0000e2f0: 6573 2070 6173 7420 7468 6520 6c61 7374  es past the last
+0000e300: 2069 6e64 6578 2e0a 2020 2020 2020 2020   index..        
+0000e310: 2222 220a 2020 2020 6465 6620 636f 6d6d  """.    def comm
+0000e320: 6974 5f69 6e66 6f28 7365 6c66 2920 2d3e  it_info(self) ->
+0000e330: 2054 7570 6c65 5b69 6e74 2c20 696e 745d   Tuple[int, int]
+0000e340: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e350: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
+0000e360: 6520 636f 6d6d 6974 7465 6420 696e 6465  e committed inde
+0000e370: 7820 616e 6420 6974 7320 7465 726d 2e0a  x and its term..
+0000e380: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e390: 6465 6620 7374 6f72 6528 7365 6c66 2920  def store(self) 
+0000e3a0: 2d3e 2022 4d65 6d53 746f 7261 6765 5265  -> "MemStorageRe
+0000e3b0: 6622 3a0a 2020 2020 2020 2020 2222 2220  f":.        """ 
+0000e3c0: 2222 220a 2020 2020 6465 6620 6e65 7874  """.    def next
+0000e3d0: 5f65 6e74 7269 6573 2873 656c 662c 206d  _entries(self, m
+0000e3e0: 6178 5f73 697a 653a 204f 7074 696f 6e61  ax_size: Optiona
+0000e3f0: 6c5b 696e 745d 2920 2d3e 204f 7074 696f  l[int]) -> Optio
+0000e400: 6e61 6c5b 4c69 7374 5b22 456e 7472 7922  nal[List["Entry"
+0000e410: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
+0000e420: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+0000e430: 616c 6c20 7468 6520 6176 6169 6c61 626c  all the availabl
+0000e440: 6520 656e 7472 6965 7320 666f 7220 6578  e entries for ex
+0000e450: 6563 7574 696f 6e2e 0a20 2020 2020 2020  ecution..       
+0000e460: 2049 6620 6170 706c 6965 6420 6973 2073   If applied is s
+0000e470: 6d61 6c6c 6572 2074 6861 6e20 7468 6520  maller than the 
+0000e480: 696e 6465 7820 6f66 2073 6e61 7073 686f  index of snapsho
+0000e490: 742c 2069 7420 7265 7475 726e 7320 616c  t, it returns al
+0000e4a0: 6c20 636f 6d6d 6974 7465 640a 2020 2020  l committed.    
+0000e4b0: 2020 2020 656e 7472 6965 7320 6166 7465      entries afte
+0000e4c0: 7220 7468 6520 696e 6465 7820 6f66 2073  r the index of s
+0000e4d0: 6e61 7073 686f 742e 0a20 2020 2020 2020  napshot..       
+0000e4e0: 2022 2222 0a20 2020 2064 6566 206e 6578   """.    def nex
+0000e4f0: 745f 656e 7472 6965 735f 7369 6e63 6528  t_entries_since(
+0000e500: 0a20 2020 2020 2020 2073 656c 662c 2073  .        self, s
+0000e510: 696e 6365 5f69 6478 3a20 696e 742c 206d  ince_idx: int, m
+0000e520: 6178 5f73 697a 653a 204f 7074 696f 6e61  ax_size: Optiona
+0000e530: 6c5b 696e 745d 0a20 2020 2029 202d 3e20  l[int].    ) -> 
+0000e540: 4f70 7469 6f6e 616c 5b4c 6973 745b 2245  Optional[List["E
+0000e550: 6e74 7279 225d 5d3a 0a20 2020 2020 2020  ntry"]]:.       
+0000e560: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+0000e570: 7572 6e73 2063 6f6d 6d69 7474 6564 2061  urns committed a
+0000e580: 6e64 2070 6572 7369 7374 6564 2065 6e74  nd persisted ent
+0000e590: 7269 6573 2073 696e 6365 206d 6178 2860  ries since max(`
+0000e5a0: 7369 6e63 655f 6964 7860 202b 2031 2c20  since_idx` + 1, 
+0000e5b0: 6669 7273 745f 696e 6465 7829 2e0a 2020  first_index)..  
+0000e5c0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0000e5d0: 6620 6861 735f 6e65 7874 5f65 6e74 7269  f has_next_entri
+0000e5e0: 6573 2873 656c 6629 202d 3e20 626f 6f6c  es(self) -> bool
+0000e5f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e600: 2020 2020 2020 5265 7475 726e 7320 7768        Returns wh
+0000e610: 6574 6865 7220 7468 6572 6520 6172 6520  ether there are 
+0000e620: 6e65 7720 656e 7472 6965 732e 0a20 2020  new entries..   
+0000e630: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+0000e640: 2068 6173 5f6e 6578 745f 656e 7472 6965   has_next_entrie
+0000e650: 735f 7369 6e63 6528 7365 6c66 2c20 7369  s_since(self, si
+0000e660: 6e63 655f 6964 783a 2069 6e74 2920 2d3e  nce_idx: int) ->
+0000e670: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+0000e680: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+0000e690: 6e73 2077 6865 7468 6572 2074 6865 7265  ns whether there
+0000e6a0: 2061 7265 2063 6f6d 6d69 7474 6564 2061   are committed a
+0000e6b0: 6e64 2070 6572 7369 7374 6564 2065 6e74  nd persisted ent
+0000e6c0: 7269 6573 2073 696e 6365 0a20 2020 2020  ries since.     
+0000e6d0: 2020 206d 6178 2860 7369 6e63 655f 6964     max(`since_id
+0000e6e0: 7860 202b 2031 2c20 6669 7273 745f 696e  x` + 1, first_in
+0000e6f0: 6465 7829 2e0a 2020 2020 2020 2020 2222  dex)..        ""
+0000e700: 220a 2020 2020 6465 6620 6973 5f75 705f  ".    def is_up_
+0000e710: 746f 5f64 6174 6528 7365 6c66 2c20 6c61  to_date(self, la
+0000e720: 7374 5f69 6e64 6578 3a20 696e 742c 2074  st_index: int, t
+0000e730: 6572 6d3a 2069 6e74 2920 2d3e 2062 6f6f  erm: int) -> boo
+0000e740: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
+0000e750: 2020 2020 2020 2044 6574 6572 6d69 6e65         Determine
+0000e760: 7320 6966 2074 6865 2067 6976 656e 2028  s if the given (
+0000e770: 6c61 7374 496e 6465 782c 7465 726d 2920  lastIndex,term) 
+0000e780: 6c6f 6720 6973 206d 6f72 6520 7570 2d74  log is more up-t
+0000e790: 6f2d 6461 7465 0a20 2020 2020 2020 2062  o-date.        b
+0000e7a0: 7920 636f 6d70 6172 696e 6720 7468 6520  y comparing the 
+0000e7b0: 696e 6465 7820 616e 6420 7465 726d 206f  index and term o
+0000e7c0: 6620 7468 6520 6c61 7374 2065 6e74 7279  f the last entry
+0000e7d0: 2069 6e20 7468 6520 6578 6973 7469 6e67   in the existing
+0000e7e0: 206c 6f67 732e 0a20 2020 2020 2020 2049   logs..        I
+0000e7f0: 6620 7468 6520 6c6f 6773 2068 6176 6520  f the logs have 
+0000e800: 6c61 7374 2065 6e74 7279 2077 6974 6820  last entry with 
+0000e810: 6469 6666 6572 656e 7420 7465 726d 732c  different terms,
+0000e820: 2074 6865 6e20 7468 6520 6c6f 6720 7769   then the log wi
+0000e830: 7468 2074 6865 0a20 2020 2020 2020 206c  th the.        l
+0000e840: 6174 6572 2074 6572 6d20 6973 206d 6f72  ater term is mor
+0000e850: 6520 7570 2d74 6f2d 6461 7465 2e20 4966  e up-to-date. If
+0000e860: 2074 6865 206c 6f67 7320 656e 6420 7769   the logs end wi
+0000e870: 7468 2074 6865 2073 616d 6520 7465 726d  th the same term
+0000e880: 2c20 7468 656e 0a20 2020 2020 2020 2077  , then.        w
+0000e890: 6869 6368 6576 6572 206c 6f67 2068 6173  hichever log has
+0000e8a0: 2074 6865 206c 6172 6765 7220 6c61 7374   the larger last
+0000e8b0: 5f69 6e64 6578 2069 7320 6d6f 7265 2075  _index is more u
+0000e8c0: 702d 746f 2d64 6174 652e 2049 6620 7468  p-to-date. If th
+0000e8d0: 6520 6c6f 6773 2061 7265 0a20 2020 2020  e logs are.     
+0000e8e0: 2020 2074 6865 2073 616d 652c 2074 6865     the same, the
+0000e8f0: 2067 6976 656e 206c 6f67 2069 7320 7570   given log is up
+0000e900: 2d74 6f2d 6461 7465 2e0a 2020 2020 2020  -to-date..      
+0000e910: 2020 2222 220a 2020 2020 6465 6620 6d61    """.    def ma
+0000e920: 7962 655f 636f 6d6d 6974 2873 656c 662c  ybe_commit(self,
+0000e930: 206d 6178 5f69 6e64 6578 3a20 696e 742c   max_index: int,
+0000e940: 2074 6572 6d3a 2069 6e74 2920 2d3e 2062   term: int) -> b
+0000e950: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+0000e960: 0a20 2020 2020 2020 2041 7474 656d 7074  .        Attempt
+0000e970: 7320 746f 2063 6f6d 6d69 7420 7468 6520  s to commit the 
+0000e980: 696e 6465 7820 616e 6420 7465 726d 2061  index and term a
+0000e990: 6e64 2072 6574 7572 6e73 2077 6865 7468  nd returns wheth
+0000e9a0: 6572 2069 7420 6469 642e 0a20 2020 2020  er it did..     
+0000e9b0: 2020 2022 2222 0a20 2020 2064 6566 206d     """.    def m
+0000e9c0: 6179 6265 5f70 6572 7369 7374 2873 656c  aybe_persist(sel
+0000e9d0: 662c 2069 6e64 6578 3a20 696e 742c 2074  f, index: int, t
+0000e9e0: 6572 6d3a 2069 6e74 2920 2d3e 2062 6f6f  erm: int) -> boo
+0000e9f0: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
+0000ea00: 2020 2020 2020 2041 7474 656d 7074 7320         Attempts 
+0000ea10: 746f 2070 6572 7369 7374 2074 6865 2069  to persist the i
+0000ea20: 6e64 6578 2061 6e64 2074 6572 6d20 616e  ndex and term an
+0000ea30: 6420 7265 7475 726e 7320 7768 6574 6865  d returns whethe
+0000ea40: 7220 6974 2064 6964 2e0a 2020 2020 2020  r it did..      
+0000ea50: 2020 2222 220a 2020 2020 6465 6620 6d61    """.    def ma
+0000ea60: 7962 655f 7065 7273 6973 745f 736e 6170  ybe_persist_snap
+0000ea70: 2873 656c 662c 2069 6e64 6578 3a20 696e  (self, index: in
+0000ea80: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
+0000ea90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000eaa0: 4174 7465 6d70 7473 2074 6f20 7065 7273  Attempts to pers
+0000eab0: 6973 7420 7468 6520 736e 6170 7368 6f74  ist the snapshot
+0000eac0: 2061 6e64 2072 6574 7572 6e73 2077 6865   and returns whe
+0000ead0: 7468 6572 2069 7420 6469 642e 0a20 2020  ther it did..   
+0000eae0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+0000eaf0: 206d 6179 6265 5f61 7070 656e 6428 0a20   maybe_append(. 
+0000eb00: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000eb10: 2020 2020 2069 6478 3a20 696e 742c 0a20       idx: int,. 
+0000eb20: 2020 2020 2020 2074 6572 6d3a 2069 6e74         term: int
+0000eb30: 2c0a 2020 2020 2020 2020 636f 6d6d 6974  ,.        commit
+0000eb40: 7465 643a 2069 6e74 2c0a 2020 2020 2020  ted: int,.      
+0000eb50: 2020 656e 7473 3a20 4c69 7374 5b22 456e    ents: List["En
+0000eb60: 7472 7922 5d20 7c20 4c69 7374 5b22 456e  try"] | List["En
+0000eb70: 7472 7952 6566 225d 2c0a 2020 2020 2920  tryRef"],.    ) 
+0000eb80: 2d3e 204f 7074 696f 6e61 6c5b 5475 706c  -> Optional[Tupl
+0000eb90: 655b 696e 742c 2069 6e74 5d5d 3a0a 2020  e[int, int]]:.  
+0000eba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ebb0: 2020 5265 7475 726e 7320 4e6f 6e65 2069    Returns None i
+0000ebc0: 6620 7468 6520 656e 7472 6965 7320 6361  f the entries ca
+0000ebd0: 6e6e 6f74 2062 6520 6170 7065 6e64 6564  nnot be appended
+0000ebe0: 2e20 4f74 6865 7277 6973 652c 0a20 2020  . Otherwise,.   
+0000ebf0: 2020 2020 2069 7420 7265 7475 726e 7320       it returns 
+0000ec00: 536f 6d65 2828 636f 6e66 6c69 6374 5f69  Some((conflict_i
+0000ec10: 6e64 6578 2c20 6c61 7374 5f69 6e64 6578  ndex, last_index
+0000ec20: 2929 2e0a 0a20 2020 2020 2020 2023 2050  ))...        # P
+0000ec30: 616e 6963 730a 0a20 2020 2020 2020 2050  anics..        P
+0000ec40: 616e 6963 7320 6966 2069 7420 6669 6e64  anics if it find
+0000ec50: 7320 6120 636f 6e66 6c69 6374 696e 6720  s a conflicting 
+0000ec60: 696e 6465 7820 6c65 7373 2074 6861 6e20  index less than 
+0000ec70: 636f 6d6d 6974 7465 6420 696e 6465 782e  committed index.
+0000ec80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ec90: 2064 6566 2073 6e61 7073 686f 7428 7365   def snapshot(se
+0000eca0: 6c66 2c20 7265 7175 6573 745f 696e 6465  lf, request_inde
+0000ecb0: 783a 2069 6e74 2c20 746f 3a20 696e 7429  x: int, to: int)
+0000ecc0: 202d 3e20 2253 6e61 7073 686f 7452 6566   -> "SnapshotRef
+0000ecd0: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
+0000ece0: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
+0000ecf0: 6865 2063 7572 7265 6e74 2073 6e61 7073  he current snaps
+0000ed00: 686f 740a 2020 2020 2020 2020 2222 220a  hot.        """.
+0000ed10: 2020 2020 6465 6620 7374 6162 6c65 5f65      def stable_e
+0000ed20: 6e74 7269 6573 2873 656c 662c 2069 6e64  ntries(self, ind
+0000ed30: 6578 3a20 696e 742c 2074 6572 6d3a 2069  ex: int, term: i
+0000ed40: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
+0000ed50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ed60: 2043 6c65 6172 7320 7468 6520 756e 7374   Clears the unst
+0000ed70: 6162 6c65 2065 6e74 7269 6573 2061 6e64  able entries and
+0000ed80: 206d 6f76 6573 2074 6865 2073 7461 626c   moves the stabl
+0000ed90: 6520 6f66 6673 6574 2075 7020 746f 2074  e offset up to t
+0000eda0: 6865 0a20 2020 2020 2020 206c 6173 7420  he.        last 
+0000edb0: 696e 6465 782c 2069 6620 7468 6572 6520  index, if there 
+0000edc0: 6973 2061 6e79 2e0a 2020 2020 2020 2020  is any..        
+0000edd0: 2222 220a 2020 2020 6465 6620 7374 6162  """.    def stab
+0000ede0: 6c65 5f73 6e61 7028 7365 6c66 2c20 696e  le_snap(self, in
+0000edf0: 6465 783a 2069 6e74 2920 2d3e 204e 6f6e  dex: int) -> Non
+0000ee00: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+0000ee10: 2020 2020 2020 2043 6c65 6172 7320 7468         Clears th
+0000ee20: 6520 756e 7374 6162 6c65 2073 6e61 7073  e unstable snaps
+0000ee30: 686f 742e 0a20 2020 2020 2020 2022 2222  hot..        """
+0000ee40: 0a20 2020 2064 6566 2074 6572 6d28 7365  .    def term(se
+0000ee50: 6c66 2c20 6964 783a 2069 6e74 2920 2d3e  lf, idx: int) ->
+0000ee60: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+0000ee70: 220a 2020 2020 2020 2020 466f 7220 6120  ".        For a 
+0000ee80: 6769 7665 6e20 696e 6465 782c 2066 696e  given index, fin
+0000ee90: 6473 2074 6865 2074 6572 6d20 6173 736f  ds the term asso
+0000eea0: 6369 6174 6564 2077 6974 6820 6974 2e0a  ciated with it..
+0000eeb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000eec0: 6465 6620 6c61 7374 5f74 6572 6d28 7365  def last_term(se
+0000eed0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+0000eee0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000eef0: 4772 6162 7320 7468 6520 7465 726d 2066  Grabs the term f
+0000ef00: 726f 6d20 7468 6520 6c61 7374 2065 6e74  rom the last ent
+0000ef10: 7279 2e0a 0a20 2020 2020 2020 2023 2050  ry...        # P
+0000ef20: 616e 6963 730a 0a20 2020 2020 2020 2050  anics..        P
+0000ef30: 616e 6963 7320 6966 2074 6865 7265 2061  anics if there a
+0000ef40: 7265 2065 6e74 7269 6573 2062 7574 2074  re entries but t
+0000ef50: 6865 206c 6173 7420 7465 726d 2068 6173  he last term has
+0000ef60: 2062 6565 6e20 6469 7363 6172 6465 642e   been discarded.
+0000ef70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ef80: 2064 6566 206d 6174 6368 5f74 6572 6d28   def match_term(
+0000ef90: 7365 6c66 2c20 6964 783a 2069 6e74 2c20  self, idx: int, 
+0000efa0: 7465 726d 3a20 696e 7429 202d 3e20 626f  term: int) -> bo
+0000efb0: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
+0000efc0: 2020 2020 2020 2020 416e 7377 6572 7320          Answers 
+0000efd0: 7468 6520 7175 6573 7469 6f6e 3a20 446f  the question: Do
+0000efe0: 6573 2074 6869 7320 696e 6465 7820 6265  es this index be
+0000eff0: 6c6f 6e67 2074 6f20 7468 6973 2074 6572  long to this ter
+0000f000: 6d3f 0a20 2020 2020 2020 2022 2222 0a20  m?.        """. 
+0000f010: 2020 2064 6566 2066 6972 7374 5f69 6e64     def first_ind
+0000f020: 6578 2873 656c 6629 202d 3e20 696e 743a  ex(self) -> int:
+0000f030: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000f040: 2020 2020 2052 6574 7572 6e73 2074 6820       Returns th 
+0000f050: 6669 7273 7420 696e 6465 7820 696e 2074  first index in t
+0000f060: 6865 2073 746f 7265 2074 6861 7420 6973  he store that is
+0000f070: 2061 7661 696c 6162 6c65 2076 6961 2065   available via e
+0000f080: 6e74 7269 6573 0a0a 2020 2020 2020 2020  ntries..        
+0000f090: 2320 5061 6e69 6373 0a0a 2020 2020 2020  # Panics..      
+0000f0a0: 2020 5061 6e69 6373 2069 6620 7468 6520    Panics if the 
+0000f0b0: 7374 6f72 6520 646f 6573 6e27 7420 6861  store doesn't ha
+0000f0c0: 7665 2061 2066 6972 7374 2069 6e64 6578  ve a first index
+0000f0d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000f0e0: 2020 6465 6620 6c61 7374 5f69 6e64 6578    def last_index
+0000f0f0: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+0000f100: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000f110: 2020 2052 6574 7572 6e73 2074 6865 206c     Returns the l
+0000f120: 6173 7420 696e 6465 7820 696e 2074 6865  ast index in the
+0000f130: 2073 746f 7265 2074 6861 7420 6973 2061   store that is a
+0000f140: 7661 696c 6162 6c65 2076 6961 2065 6e74  vailable via ent
+0000f150: 7269 6573 2e0a 0a20 2020 2020 2020 2023  ries...        #
+0000f160: 2050 616e 6963 730a 0a20 2020 2020 2020   Panics..       
+0000f170: 2050 616e 6963 7320 6966 2074 6865 2073   Panics if the s
+0000f180: 746f 7265 2064 6f65 736e 2774 2068 6176  tore doesn't hav
+0000f190: 6520 6120 6c61 7374 2069 6e64 6578 2e0a  e a last index..
+0000f1a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000f1b0: 6465 6620 756e 7374 6162 6c65 2873 656c  def unstable(sel
+0000f1c0: 6629 202d 3e20 2255 6e73 7461 626c 6552  f) -> "UnstableR
+0000f1d0: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+0000f1e0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0000f1f0: 2061 2072 6566 6572 656e 6365 2074 6f20   a reference to 
+0000f200: 7468 6520 756e 7374 6162 6c65 206c 6f67  the unstable log
+0000f210: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000f220: 2020 6465 6620 756e 7374 6162 6c65 5f65    def unstable_e
+0000f230: 6e74 7269 6573 2873 656c 6629 202d 3e20  ntries(self) -> 
+0000f240: 4c69 7374 5b22 456e 7472 7952 6566 225d  List["EntryRef"]
+0000f250: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000f260: 2020 2020 2020 5265 7475 726e 7320 736c        Returns sl
+0000f270: 6963 6520 6f66 2065 6e74 7269 6573 2074  ice of entries t
+0000f280: 6861 7420 6172 6520 6e6f 7420 7065 7273  hat are not pers
+0000f290: 6973 7465 642e 0a20 2020 2020 2020 2022  isted..        "
+0000f2a0: 2222 0a20 2020 2064 6566 2075 6e73 7461  "".    def unsta
+0000f2b0: 626c 655f 736e 6170 7368 6f74 2873 656c  ble_snapshot(sel
+0000f2c0: 6629 202d 3e20 4f70 7469 6f6e 616c 5b22  f) -> Optional["
+0000f2d0: 536e 6170 7368 6f74 5265 6622 5d3a 0a20  SnapshotRef"]:. 
+0000f2e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000f2f0: 2020 2052 6574 7572 6e73 2074 6865 2073     Returns the s
+0000f300: 6e61 7073 686f 7420 7468 6174 2061 7265  napshot that are
+0000f310: 206e 6f74 2070 6572 7369 7374 6564 2e0a   not persisted..
+0000f320: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000f330: 6465 6620 6765 745f 6170 706c 6965 6428  def get_applied(
+0000f340: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
+0000f350: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000f360: 2020 6061 7070 6c69 6564 603a 2054 6865    `applied`: The
+0000f370: 2068 6967 6865 7374 206c 6f67 2070 6f73   highest log pos
+0000f380: 6974 696f 6e20 7468 6174 2074 6865 2061  ition that the a
+0000f390: 7070 6c69 6361 7469 6f6e 2068 6173 2062  pplication has b
+0000f3a0: 6565 6e20 696e 7374 7275 6374 6564 0a20  een instructed. 
+0000f3b0: 2020 2020 2020 2074 6f20 6170 706c 7920         to apply 
+0000f3c0: 746f 2069 7473 2073 7461 7465 206d 6163  to its state mac
+0000f3d0: 6869 6e65 2e0a 0a20 2020 2020 2020 2049  hine...        I
+0000f3e0: 6e76 6172 6961 6e74 3a20 6170 706c 6965  nvariant: applie
+0000f3f0: 6420 3c3d 206d 696e 2863 6f6d 6d69 7474  d <= min(committ
+0000f400: 6564 2c20 7065 7273 6973 7465 6429 0a20  ed, persisted). 
+0000f410: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+0000f420: 6566 2073 6574 5f61 7070 6c69 6564 2873  ef set_applied(s
+0000f430: 656c 662c 2061 7070 6c69 6564 3a20 696e  elf, applied: in
+0000f440: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
+0000f450: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000f460: 6061 7070 6c69 6564 603a 2054 6865 2068  `applied`: The h
+0000f470: 6967 6865 7374 206c 6f67 2070 6f73 6974  ighest log posit
+0000f480: 696f 6e20 7468 6174 2074 6865 2061 7070  ion that the app
+0000f490: 6c69 6361 7469 6f6e 2068 6173 2062 6565  lication has bee
+0000f4a0: 6e20 696e 7374 7275 6374 6564 0a20 2020  n instructed.   
+0000f4b0: 2020 2020 2074 6f20 6170 706c 7920 746f       to apply to
+0000f4c0: 2069 7473 2073 7461 7465 206d 6163 6869   its state machi
+0000f4d0: 6e65 2e0a 0a20 2020 2020 2020 2049 6e76  ne...        Inv
+0000f4e0: 6172 6961 6e74 3a20 6170 706c 6965 6420  ariant: applied 
+0000f4f0: 3c3d 206d 696e 2863 6f6d 6d69 7474 6564  <= min(committed
+0000f500: 2c20 7065 7273 6973 7465 6429 0a20 2020  , persisted).   
+0000f510: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+0000f520: 2067 6574 5f63 6f6d 6d69 7474 6564 2873   get_committed(s
+0000f530: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+0000f540: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000f550: 2060 636f 6d6d 6974 7465 6460 3a20 5468   `committed`: Th
+0000f560: 6520 6869 6768 6573 7420 6c6f 6720 706f  e highest log po
+0000f570: 7369 7469 6f6e 2074 6861 7420 6973 206b  sition that is k
+0000f580: 6e6f 776e 2074 6f20 6265 2069 6e20 7374  nown to be in st
+0000f590: 6162 6c65 2073 746f 7261 6765 0a20 2020  able storage.   
+0000f5a0: 2020 2020 206f 6e20 6120 7175 6f72 756d       on a quorum
+0000f5b0: 206f 6620 6e6f 6465 732e 0a0a 2020 2020   of nodes...    
+0000f5c0: 2020 2020 496e 7661 7269 616e 743a 2061      Invariant: a
+0000f5d0: 7070 6c69 6564 203c 3d20 636f 6d6d 6974  pplied <= commit
+0000f5e0: 7465 640a 2020 2020 2020 2020 2222 220a  ted.        """.
+0000f5f0: 2020 2020 6465 6620 7365 745f 636f 6d6d      def set_comm
+0000f600: 6974 7465 6428 7365 6c66 2c20 636f 6d6d  itted(self, comm
+0000f610: 6974 7465 643a 2069 6e74 2920 2d3e 204e  itted: int) -> N
+0000f620: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000f630: 0a20 2020 2020 2020 2060 636f 6d6d 6974  .        `commit
+0000f640: 7465 6460 3a20 5468 6520 6869 6768 6573  ted`: The highes
+0000f650: 7420 6c6f 6720 706f 7369 7469 6f6e 2074  t log position t
+0000f660: 6861 7420 6973 206b 6e6f 776e 2074 6f20  hat is known to 
+0000f670: 6265 2069 6e20 7374 6162 6c65 2073 746f  be in stable sto
+0000f680: 7261 6765 0a20 2020 2020 2020 206f 6e20  rage.        on 
+0000f690: 6120 7175 6f72 756d 206f 6620 6e6f 6465  a quorum of node
+0000f6a0: 732e 0a0a 2020 2020 2020 2020 496e 7661  s...        Inva
+0000f6b0: 7269 616e 743a 2061 7070 6c69 6564 203c  riant: applied <
+0000f6c0: 3d20 636f 6d6d 6974 7465 640a 2020 2020  = committed.    
+0000f6d0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+0000f6e0: 6765 745f 7065 7273 6973 7465 6428 7365  get_persisted(se
+0000f6f0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+0000f700: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000f710: 6070 6572 7369 7374 6564 603a 2054 6865  `persisted`: The
+0000f720: 2068 6967 6865 7374 206c 6f67 2070 6f73   highest log pos
+0000f730: 6974 696f 6e20 7468 6174 2069 7320 6b6e  ition that is kn
+0000f740: 6f77 6e20 746f 2062 6520 7065 7273 6973  own to be persis
+0000f750: 7465 6420 696e 2073 7461 626c 650a 2020  ted in stable.  
+0000f760: 2020 2020 2020 7374 6f72 6167 652e 2049        storage. I
+0000f770: 7427 7320 7573 6564 2066 6f72 206c 696d  t's used for lim
+0000f780: 6974 696e 6720 7468 6520 7570 7065 7220  iting the upper 
+0000f790: 626f 756e 6420 6f66 2063 6f6d 6d69 7474  bound of committ
+0000f7a0: 6564 2061 6e64 0a20 2020 2020 2020 2070  ed and.        p
+0000f7b0: 6572 7369 7374 6564 2065 6e74 7269 6573  ersisted entries
+0000f7c0: 2e0a 0a20 2020 2020 2020 2049 6e76 6172  ...        Invar
+0000f7d0: 6961 6e74 3a20 7065 7273 6973 7465 6420  iant: persisted 
+0000f7e0: 3c20 756e 7374 6162 6c65 2e6f 6666 7365  < unstable.offse
+0000f7f0: 7420 2626 2061 7070 6c69 6564 203c 3d20  t && applied <= 
+0000f800: 7065 7273 6973 7465 640a 2020 2020 2020  persisted.      
+0000f810: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+0000f820: 745f 7065 7273 6973 7465 6428 7365 6c66  t_persisted(self
+0000f830: 2c20 7065 7273 6973 7465 643a 2069 6e74  , persisted: int
+0000f840: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000f850: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+0000f860: 7065 7273 6973 7465 6460 3a20 5468 6520  persisted`: The 
+0000f870: 6869 6768 6573 7420 6c6f 6720 706f 7369  highest log posi
+0000f880: 7469 6f6e 2074 6861 7420 6973 206b 6e6f  tion that is kno
+0000f890: 776e 2074 6f20 6265 2070 6572 7369 7374  wn to be persist
+0000f8a0: 6564 2069 6e20 7374 6162 6c65 0a20 2020  ed in stable.   
+0000f8b0: 2020 2020 2073 746f 7261 6765 2e20 4974       storage. It
+0000f8c0: 2773 2075 7365 6420 666f 7220 6c69 6d69  's used for limi
+0000f8d0: 7469 6e67 2074 6865 2075 7070 6572 2062  ting the upper b
+0000f8e0: 6f75 6e64 206f 6620 636f 6d6d 6974 7465  ound of committe
+0000f8f0: 6420 616e 640a 2020 2020 2020 2020 7065  d and.        pe
+0000f900: 7273 6973 7465 6420 656e 7472 6965 732e  rsisted entries.
+0000f910: 0a0a 2020 2020 2020 2020 496e 7661 7269  ..        Invari
+0000f920: 616e 743a 2070 6572 7369 7374 6564 203c  ant: persisted <
+0000f930: 2075 6e73 7461 626c 652e 6f66 6673 6574   unstable.offset
+0000f940: 2026 2620 6170 706c 6965 6420 3c3d 2070   && applied <= p
+0000f950: 6572 7369 7374 6564 0a20 2020 2020 2020  ersisted.       
+0000f960: 2022 2222 0a20 2020 2064 6566 2073 6c69   """.    def sli
+0000f970: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
+0000f980: 2c0a 2020 2020 2020 2020 6c6f 773a 2069  ,.        low: i
+0000f990: 6e74 2c0a 2020 2020 2020 2020 6869 6768  nt,.        high
+0000f9a0: 3a20 696e 742c 0a20 2020 2020 2020 206d  : int,.        m
+0000f9b0: 6178 5f73 697a 653a 204f 7074 696f 6e61  ax_size: Optiona
+0000f9c0: 6c5b 696e 745d 2c0a 2020 2020 2020 2020  l[int],.        
+0000f9d0: 636f 6e74 6578 743a 2022 4765 7445 6e74  context: "GetEnt
+0000f9e0: 7269 6573 436f 6e74 6578 7452 6566 222c  riesContextRef",
+0000f9f0: 0a20 2020 2029 202d 3e20 4c69 7374 5b22  .    ) -> List["
+0000fa00: 456e 7472 7952 6566 225d 3a0a 2020 2020  EntryRef"]:.    
+0000fa10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000fa20: 4772 6162 7320 6120 736c 6963 6520 6f66  Grabs a slice of
+0000fa30: 2065 6e74 7269 6573 2066 726f 6d20 7468   entries from th
+0000fa40: 6520 7261 6674 2e20 556e 6c69 6b65 2061  e raft. Unlike a
+0000fa50: 2072 7573 7420 736c 6963 6520 706f 696e   rust slice poin
+0000fa60: 7465 722c 2074 6865 7365 2061 7265 0a20  ter, these are. 
+0000fa70: 2020 2020 2020 2072 6574 7572 6e65 6420         returned 
+0000fa80: 6279 2076 616c 7565 2e20 5468 6520 7265  by value. The re
+0000fa90: 7375 6c74 2069 7320 7472 756e 6361 7465  sult is truncate
+0000faa0: 6420 746f 2074 6865 206d 6178 5f73 697a  d to the max_siz
+0000fab0: 6520 696e 2062 7974 6573 2e0a 2020 2020  e in bytes..    
+0000fac0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+0000fad0: 7265 7374 6f72 6528 7365 6c66 2c20 736e  restore(self, sn
+0000fae0: 6170 7368 6f74 3a20 2253 6e61 7073 686f  apshot: "Snapsho
+0000faf0: 7422 207c 2022 536e 6170 7368 6f74 5265  t" | "SnapshotRe
+0000fb00: 6622 2920 2d3e 204e 6f6e 653a 0a20 2020  f") -> None:.   
+0000fb10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000fb20: 2052 6573 746f 7265 7320 7468 6520 6375   Restores the cu
+0000fb30: 7272 656e 7420 6c6f 6720 6672 6f6d 2061  rrent log from a
+0000fb40: 2073 6e61 7073 686f 742e 0a20 2020 2020   snapshot..     
+0000fb50: 2020 2022 2222 0a0a 636c 6173 7320 496e     """..class In
+0000fb60: 4d65 6d6f 7279 5261 6674 4c6f 6728 5f5f  MemoryRaftLog(__
+0000fb70: 4150 495f 5261 6674 4c6f 6729 3a0a 2020  API_RaftLog):.  
+0000fb80: 2020 2222 220a 2020 2020 5261 6674 206c    """.    Raft l
+0000fb90: 6f67 2069 6d70 6c65 6d65 6e74 6174 696f  og implementatio
+0000fba0: 6e0a 2020 2020 2222 220a 0a20 2020 2064  n.    """..    d
+0000fbb0: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
+0000fbc0: 2020 2020 2073 656c 662c 2073 746f 7265       self, store
+0000fbd0: 3a20 224d 656d 5374 6f72 6167 6552 6566  : "MemStorageRef
+0000fbe0: 222c 206c 6f67 6765 723a 2022 4c6f 6767  ", logger: "Logg
+0000fbf0: 6572 2220 7c20 224c 6f67 6765 7252 6566  er" | "LoggerRef
+0000fc00: 220a 2020 2020 2920 2d3e 204e 6f6e 653a  ".    ) -> None:
+0000fc10: 202e 2e2e 0a20 2020 2064 6566 206d 616b   ....    def mak
+0000fc20: 655f 7265 6628 7365 6c66 2920 2d3e 2022  e_ref(self) -> "
+0000fc30: 496e 4d65 6d6f 7279 5261 6674 4c6f 6752  InMemoryRaftLogR
+0000fc40: 6566 223a 202e 2e2e 0a20 2020 2064 6566  ef": ....    def
+0000fc50: 2067 6574 5f73 746f 7265 2873 656c 6629   get_store(self)
+0000fc60: 202d 3e20 224d 656d 5374 6f72 6167 6552   -> "MemStorageR
+0000fc70: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+0000fc80: 0a20 2020 2020 2020 2047 7261 6220 6120  .        Grab a 
+0000fc90: 7265 6164 2d6f 6e6c 7920 7265 6665 7265  read-only refere
+0000fca0: 6e63 6520 746f 2074 6865 2075 6e64 6572  nce to the under
+0000fcb0: 6c79 696e 6720 7374 6f72 6167 652e 0a20  lying storage.. 
+0000fcc0: 2020 2020 2020 2022 2222 0a0a 636c 6173         """..clas
+0000fcd0: 7320 496e 4d65 6d6f 7279 5261 6674 4c6f  s InMemoryRaftLo
+0000fce0: 6752 6566 285f 5f41 5049 5f52 6166 744c  gRef(__API_RaftL
+0000fcf0: 6f67 293a 0a20 2020 2022 2222 0a20 2020  og):.    """.   
+0000fd00: 2052 6566 6572 656e 6365 2074 7970 6520   Reference type 
+0000fd10: 6f66 203a 636c 6173 733a 6049 6e4d 656d  of :class:`InMem
+0000fd20: 6f72 7952 6166 744c 6f67 602e 0a20 2020  oryRaftLog`..   
+0000fd30: 2022 2222 0a0a 2020 2020 6465 6620 6765   """..    def ge
+0000fd40: 745f 7374 6f72 6528 7365 6c66 2920 2d3e  t_store(self) ->
+0000fd50: 2022 4d65 6d53 746f 7261 6765 5265 6622   "MemStorageRef"
+0000fd60: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000fd70: 2020 2020 2020 4772 6162 2061 2072 6561        Grab a rea
+0000fd80: 642d 6f6e 6c79 2072 6566 6572 656e 6365  d-only reference
+0000fd90: 2074 6f20 7468 6520 756e 6465 726c 7969   to the underlyi
+0000fda0: 6e67 2073 746f 7261 6765 2e0a 2020 2020  ng storage..    
+0000fdb0: 2020 2020 2222 220a 0a63 6c61 7373 2052      """..class R
+0000fdc0: 6166 744c 6f67 285f 5f41 5049 5f52 6166  aftLog(__API_Raf
+0000fdd0: 744c 6f67 293a 0a20 2020 2022 2222 2022  tLog):.    """ "
+0000fde0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+0000fdf0: 6974 5f5f 2873 656c 662c 2073 746f 7265  it__(self, store
+0000fe00: 3a20 2253 746f 7261 6765 5265 6622 2c20  : "StorageRef", 
+0000fe10: 6c6f 6767 6572 3a20 224c 6f67 6765 7222  logger: "Logger"
+0000fe20: 207c 2022 4c6f 6767 6572 5265 6622 2920   | "LoggerRef") 
+0000fe30: 2d3e 204e 6f6e 653a 202e 2e2e 0a20 2020  -> None: ....   
+0000fe40: 2064 6566 206d 616b 655f 7265 6628 7365   def make_ref(se
+0000fe50: 6c66 2920 2d3e 2022 5261 6674 4c6f 6752  lf) -> "RaftLogR
+0000fe60: 6566 223a 202e 2e2e 0a20 2020 2064 6566  ef": ....    def
+0000fe70: 2067 6574 5f73 746f 7265 2873 656c 6629   get_store(self)
+0000fe80: 202d 3e20 2253 746f 7261 6765 5265 6622   -> "StorageRef"
+0000fe90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000fea0: 2020 2020 2020 4772 6162 2061 2072 6561        Grab a rea
+0000feb0: 642d 6f6e 6c79 2072 6566 6572 656e 6365  d-only reference
+0000fec0: 2074 6f20 7468 6520 756e 6465 726c 7969   to the underlyi
+0000fed0: 6e67 2073 746f 7261 6765 2e0a 2020 2020  ng storage..    
+0000fee0: 2020 2020 2222 220a 0a63 6c61 7373 2052      """..class R
+0000fef0: 6166 744c 6f67 5265 6628 5f5f 4150 495f  aftLogRef(__API_
+0000ff00: 5261 6674 4c6f 6729 3a0a 2020 2020 2222  RaftLog):.    ""
+0000ff10: 220a 2020 2020 5265 6665 7265 6e63 6520  ".    Reference 
+0000ff20: 7479 7065 206f 6620 3a63 6c61 7373 3a60  type of :class:`
+0000ff30: 5261 6674 4c6f 6760 2e0a 2020 2020 2222  RaftLog`..    ""
+0000ff40: 220a 0a20 2020 2064 6566 2067 6574 5f73  "..    def get_s
+0000ff50: 746f 7265 2873 656c 6629 202d 3e20 2253  tore(self) -> "S
+0000ff60: 746f 7261 6765 5265 6622 3a0a 2020 2020  torageRef":.    
+0000ff70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ff80: 4772 6162 2061 2072 6561 642d 6f6e 6c79  Grab a read-only
+0000ff90: 2072 6566 6572 656e 6365 2074 6f20 7468   reference to th
+0000ffa0: 6520 756e 6465 726c 7969 6e67 2073 746f  e underlying sto
+0000ffb0: 7261 6765 2e0a 2020 2020 2020 2020 2222  rage..        ""
+0000ffc0: 220a 0a63 6c61 7373 205f 5f41 5049 5f52  "..class __API_R
+0000ffd0: 6166 743a 0a20 2020 2064 6566 2061 7070  aft:.    def app
+0000ffe0: 656e 645f 656e 7472 7928 7365 6c66 2c20  end_entry(self, 
+0000fff0: 656e 7473 3a20 4c69 7374 5b22 456e 7472  ents: List["Entr
+00010000: 7922 5d20 7c20 4c69 7374 5b22 456e 7472  y"] | List["Entr
+00010010: 7952 6566 225d 2920 2d3e 2062 6f6f 6c3a  yRef"]) -> bool:
+00010020: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010030: 2020 2020 2041 7070 656e 6473 2061 2073       Appends a s
+00010040: 6c69 6365 206f 6620 656e 7472 6965 7320  lice of entries 
+00010050: 746f 2074 6865 206c 6f67 2e0a 2020 2020  to the log..    
+00010060: 2020 2020 5468 6520 656e 7472 6965 7320      The entries 
+00010070: 6172 6520 7570 6461 7465 6420 746f 206d  are updated to m
+00010080: 6174 6368 2074 6865 2063 7572 7265 6e74  atch the current
+00010090: 2069 6e64 6578 2061 6e64 2074 6572 6d2e   index and term.
+000100a0: 0a20 2020 2020 2020 204f 6e6c 7920 6361  .        Only ca
+000100b0: 6c6c 6564 2062 7920 6c65 6164 6572 2063  lled by leader c
+000100c0: 7572 7265 6e74 6c79 0a20 2020 2020 2020  urrently.       
+000100d0: 2022 2222 0a20 2020 2064 6566 2073 656e   """.    def sen
+000100e0: 645f 6170 7065 6e64 2873 656c 662c 2074  d_append(self, t
+000100f0: 6f3a 2069 6e74 2920 2d3e 204e 6f6e 653a  o: int) -> None:
+00010100: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010110: 2020 2020 2053 656e 6473 2061 6e20 6170       Sends an ap
+00010120: 7065 6e64 2052 5043 2077 6974 6820 6e65  pend RPC with ne
+00010130: 7720 656e 7472 6965 7320 2869 6620 616e  w entries (if an
+00010140: 7929 2061 6e64 2074 6865 2063 7572 7265  y) and the curre
+00010150: 6e74 2063 6f6d 6d69 7420 696e 6465 7820  nt commit index 
+00010160: 746f 2074 6865 2067 6976 656e 0a20 2020  to the given.   
+00010170: 2020 2020 2070 6565 722e 0a20 2020 2020       peer..     
+00010180: 2020 2022 2222 0a20 2020 2064 6566 206f     """.    def o
+00010190: 6e5f 7065 7273 6973 745f 656e 7472 6965  n_persist_entrie
+000101a0: 7328 7365 6c66 2c20 696e 6465 783a 2069  s(self, index: i
+000101b0: 6e74 2c20 7465 726d 3a20 696e 7429 202d  nt, term: int) -
+000101c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000101d0: 2222 220a 2020 2020 2020 2020 4e6f 7469  """.        Noti
+000101e0: 6669 6573 2074 6861 7420 7468 6573 6520  fies that these 
+000101f0: 7261 6674 206c 6f67 7320 6861 7665 2062  raft logs have b
+00010200: 6565 6e20 7065 7273 6973 7465 642e 0a20  een persisted.. 
+00010210: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00010220: 6566 2061 7070 6c79 5f74 6f5f 6375 7272  ef apply_to_curr
+00010230: 656e 745f 7465 726d 2873 656c 6629 202d  ent_term(self) -
+00010240: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
+00010250: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
+00010260: 6b73 2069 6620 6c6f 6773 2061 7265 2061  ks if logs are a
+00010270: 7070 6c69 6564 2074 6f20 6375 7272 656e  pplied to curren
+00010280: 7420 7465 726d 2e0a 2020 2020 2020 2020  t term..        
+00010290: 2222 220a 2020 2020 6465 6620 636f 6d6d  """.    def comm
+000102a0: 6974 5f74 6f5f 6375 7272 656e 745f 7465  it_to_current_te
+000102b0: 726d 2873 656c 6629 202d 3e20 626f 6f6c  rm(self) -> bool
+000102c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000102d0: 2020 2020 2020 4368 6563 6b73 2069 6620        Checks if 
+000102e0: 6c6f 6773 2061 7265 2063 6f6d 6d69 7474  logs are committ
+000102f0: 6564 2074 6f20 6974 7320 7465 726d 2e0a  ed to its term..
+00010300: 0a20 2020 2020 2020 2054 6865 2063 6865  .        The che
+00010310: 636b 2069 7320 7573 6566 756c 2075 7375  ck is useful usu
+00010320: 616c 6c79 2077 6865 6e20 7261 6674 2069  ally when raft i
+00010330: 7320 6c65 6164 6572 2e0a 2020 2020 2020  s leader..      
+00010340: 2020 2222 220a 2020 2020 6465 6620 6772    """.    def gr
+00010350: 6f75 705f 636f 6d6d 6974 2873 656c 6629  oup_commit(self)
+00010360: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00010370: 2020 2222 220a 2020 2020 2020 2020 5768    """.        Wh
+00010380: 6574 6865 7220 656e 6162 6c65 2067 726f  ether enable gro
+00010390: 7570 2063 6f6d 6d69 742e 0a20 2020 2020  up commit..     
+000103a0: 2020 2022 2222 0a20 2020 2064 6566 2065     """.    def e
+000103b0: 6e61 626c 655f 6772 6f75 705f 636f 6d6d  nable_group_comm
+000103c0: 6974 2873 656c 662c 2065 6e61 626c 653a  it(self, enable:
+000103d0: 2062 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a   bool) -> None:.
+000103e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000103f0: 2020 2020 436f 6e66 6967 7572 6573 2067      Configures g
+00010400: 726f 7570 2063 6f6d 6d69 742e 0a0a 2020  roup commit...  
+00010410: 2020 2020 2020 4966 2067 726f 7570 2063        If group c
+00010420: 6f6d 6d69 7420 6973 2065 6e61 626c 6564  ommit is enabled
+00010430: 2c20 6f6e 6c79 206c 6f67 7320 7265 706c  , only logs repl
+00010440: 6963 6174 6564 2074 6f20 6174 206c 6561  icated to at lea
+00010450: 7374 2074 776f 0a20 2020 2020 2020 2064  st two.        d
+00010460: 6966 6665 7265 6e74 2067 726f 7570 7320  ifferent groups 
+00010470: 6172 6520 636f 6d6d 6974 7465 642e 0a0a  are committed...
+00010480: 2020 2020 2020 2020 596f 7520 7368 6f75          You shou
+00010490: 6c64 2075 7365 2060 6173 7369 676e 5f63  ld use `assign_c
+000104a0: 6f6d 6d69 745f 6772 6f75 7073 6020 746f  ommit_groups` to
+000104b0: 2063 6f6e 6669 6775 7265 2070 6565 7220   configure peer 
+000104c0: 6772 6f75 7073 2e0a 2020 2020 2020 2020  groups..        
+000104d0: 2222 220a 2020 2020 6465 6620 636c 6561  """.    def clea
+000104e0: 725f 636f 6d6d 6974 5f67 726f 7570 2873  r_commit_group(s
+000104f0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00010500: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010510: 2020 5265 6d6f 7665 7320 616c 6c20 636f    Removes all co
+00010520: 6d6d 6974 2067 726f 7570 2063 6f6e 6669  mmit group confi
+00010530: 6775 7261 7469 6f6e 732e 0a20 2020 2020  gurations..     
+00010540: 2020 2022 2222 0a20 2020 2064 6566 2063     """.    def c
+00010550: 6865 636b 5f67 726f 7570 5f63 6f6d 6d69  heck_group_commi
+00010560: 745f 636f 6e73 6973 7465 6e74 2873 656c  t_consistent(sel
+00010570: 6629 202d 3e20 4f70 7469 6f6e 616c 5b62  f) -> Optional[b
+00010580: 6f6f 6c5d 3a0a 2020 2020 2020 2020 2222  ool]:.        ""
+00010590: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
+000105a0: 2077 6865 7468 6572 2074 6865 2072 6166   whether the raf
+000105b0: 7420 6772 6f75 7020 6973 2075 7369 6e67  t group is using
+000105c0: 2067 726f 7570 2063 6f6d 6d69 7420 616e   group commit an
+000105d0: 6420 636f 6e73 6973 7465 6e74 0a20 2020  d consistent.   
+000105e0: 2020 2020 206f 7665 7220 6772 6f75 702e       over group.
+000105f0: 0a0a 2020 2020 2020 2020 4966 2069 7420  ..        If it 
+00010600: 6361 6e27 7420 6765 7420 6120 636f 7272  can't get a corr
+00010610: 6563 7420 616e 7377 6572 2c20 604e 6f6e  ect answer, `Non
+00010620: 6560 2069 7320 7265 7475 726e 6564 2e0a  e` is returned..
+00010630: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010640: 6465 6620 6173 7369 676e 5f63 6f6d 6d69  def assign_commi
+00010650: 745f 6772 6f75 7073 2873 656c 662c 2069  t_groups(self, i
+00010660: 6473 3a20 4c69 7374 5b54 7570 6c65 5b69  ds: List[Tuple[i
+00010670: 6e74 2c20 696e 745d 5d29 202d 3e20 4e6f  nt, int]]) -> No
+00010680: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00010690: 2020 2020 2020 2020 4173 7369 676e 7320          Assigns 
+000106a0: 6772 6f75 7073 2074 6f20 7065 6572 732e  groups to peers.
+000106b0: 0a0a 2020 2020 2020 2020 5468 6520 7475  ..        The tu
+000106c0: 706c 6520 6973 2028 6070 6565 725f 6964  ple is (`peer_id
+000106d0: 602c 2060 6772 6f75 705f 6964 6029 2e20  `, `group_id`). 
+000106e0: 6067 726f 7570 5f69 6460 2073 686f 756c  `group_id` shoul
+000106f0: 6420 6265 206c 6172 6765 7220 7468 616e  d be larger than
+00010700: 2030 2e0a 0a20 2020 2020 2020 2054 6865   0...        The
+00010710: 2067 726f 7570 2069 6e66 6f72 6d61 7469   group informati
+00010720: 6f6e 2069 7320 6f6e 6c79 2073 746f 7265  on is only store
+00010730: 6420 696e 206d 656d 6f72 792e 2053 6f20  d in memory. So 
+00010740: 796f 7520 6e65 6564 2074 6f20 636f 6e66  you need to conf
+00010750: 6967 7572 650a 2020 2020 2020 2020 6974  igure.        it
+00010760: 2065 7665 7279 2074 696d 6520 6120 7261   every time a ra
+00010770: 6674 2073 7461 7465 206d 6163 6869 6e65  ft state machine
+00010780: 2069 7320 696e 6974 6961 6c69 7a65 6420   is initialized 
+00010790: 6f72 2061 2073 6e61 7073 686f 7420 6973  or a snapshot is
+000107a0: 2061 7070 6c69 6564 2e0a 2020 2020 2020   applied..      
+000107b0: 2020 2222 220a 2020 2020 6465 6620 636f    """.    def co
+000107c0: 6d6d 6974 5f61 7070 6c79 2873 656c 662c  mmit_apply(self,
+000107d0: 2061 7070 6c69 6564 3a20 696e 7429 202d   applied: int) -
+000107e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000107f0: 2222 220a 2020 2020 2020 2020 436f 6d6d  """.        Comm
+00010800: 6974 2074 6861 7420 7468 6520 5261 6674  it that the Raft
+00010810: 2070 6565 7220 6861 7320 6170 706c 6965   peer has applie
+00010820: 6420 7570 2074 6f20 7468 6520 6769 7665  d up to the give
+00010830: 6e20 696e 6465 782e 0a0a 2020 2020 2020  n index...      
+00010840: 2020 5265 6769 7374 6572 7320 7468 6520    Registers the 
+00010850: 6e65 7720 6170 706c 6965 6420 696e 6465  new applied inde
+00010860: 7820 746f 2074 6865 2052 6166 7420 6c6f  x to the Raft lo
+00010870: 672e 0a0a 2020 2020 2020 2020 2320 486f  g...        # Ho
+00010880: 6f6b 730a 0a20 2020 2020 2020 202a 2050  oks..        * P
+00010890: 6f73 743a 2043 6865 636b 7320 746f 2073  ost: Checks to s
+000108a0: 6565 2069 6620 6974 2773 2074 696d 6520  ee if it's time 
+000108b0: 746f 2066 696e 616c 697a 6520 6120 4a6f  to finalize a Jo
+000108c0: 696e 7420 436f 6e73 656e 7375 7320 7374  int Consensus st
+000108d0: 6174 652e 0a20 2020 2020 2020 2022 2222  ate..        """
+000108e0: 0a20 2020 2064 6566 206d 6179 6265 5f63  .    def maybe_c
+000108f0: 6f6d 6d69 7428 7365 6c66 2920 2d3e 2062  ommit(self) -> b
+00010900: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+00010910: 0a20 2020 2020 2020 2041 7474 656d 7074  .        Attempt
+00010920: 7320 746f 2061 6476 616e 6365 2074 6865  s to advance the
+00010930: 2063 6f6d 6d69 7420 696e 6465 782e 2052   commit index. R
+00010940: 6574 7572 6e73 2074 7275 6520 6966 2074  eturns true if t
+00010950: 6865 2063 6f6d 6d69 7420 696e 6465 780a  he commit index.
+00010960: 2020 2020 2020 2020 6368 616e 6765 6420          changed 
+00010970: 2869 6e20 7768 6963 6820 6361 7365 2074  (in which case t
+00010980: 6865 2063 616c 6c65 7220 7368 6f75 6c64  he caller should
+00010990: 2063 616c 6c20 6072 2e62 6361 7374 5f61   call `r.bcast_a
+000109a0: 7070 656e 6460 292e 0a20 2020 2020 2020  ppend`)..       
+000109b0: 2022 2222 0a20 2020 2064 6566 2075 6e63   """.    def unc
+000109c0: 6f6d 6d69 7474 6564 5f73 697a 6528 7365  ommitted_size(se
+000109d0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+000109e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000109f0: 5265 7475 726e 2063 7572 7265 6e74 2075  Return current u
+00010a00: 6e63 6f6d 6d69 7474 6564 2073 697a 6520  ncommitted size 
+00010a10: 7265 636f 7264 6564 2062 7920 756e 636f  recorded by unco
+00010a20: 6d6d 6974 7465 645f 7374 6174 650a 2020  mmitted_state.  
+00010a30: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00010a40: 6620 6d61 7962 655f 696e 6372 6561 7365  f maybe_increase
+00010a50: 5f75 6e63 6f6d 6d69 7474 6564 5f73 697a  _uncommitted_siz
+00010a60: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+00010a70: 2065 6e74 733a 204c 6973 745b 2245 6e74   ents: List["Ent
+00010a80: 7279 225d 207c 204c 6973 745b 2245 6e74  ry"] | List["Ent
+00010a90: 7279 5265 6622 5d0a 2020 2020 2920 2d3e  ryRef"].    ) ->
+00010aa0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+00010ab0: 2222 0a20 2020 2020 2020 2049 6e63 7265  "".        Incre
+00010ac0: 6173 6520 7369 7a65 206f 6620 2765 6e74  ase size of 'ent
+00010ad0: 7327 2074 6f20 756e 636f 6d6d 6974 7465  s' to uncommitte
+00010ae0: 6420 7369 7a65 2e20 5265 7475 726e 2074  d size. Return t
+00010af0: 7275 6520 7768 656e 2073 697a 6520 6c69  rue when size li
+00010b00: 6d69 740a 2020 2020 2020 2020 6973 2073  mit.        is s
+00010b10: 6174 6973 6669 6564 2e20 4f74 6865 7277  atisfied. Otherw
+00010b20: 6973 6520 7265 7475 726e 2066 616c 7365  ise return false
+00010b30: 2061 6e64 2075 6e63 6f6d 6d69 7474 6564   and uncommitted
+00010b40: 2073 697a 6520 7265 6d61 696e 7320 756e   size remains un
+00010b50: 6368 616e 6765 642e 0a20 2020 2020 2020  changed..       
+00010b60: 2046 6f72 2072 6166 7420 7769 7468 206e   For raft with n
+00010b70: 6f20 6c69 6d69 7428 6f72 206e 6f6e 2d6c  o limit(or non-l
+00010b80: 6561 6465 7220 7261 6674 292c 2069 7420  eader raft), it 
+00010b90: 616c 7761 7973 2072 6574 7572 6e20 7472  always return tr
+00010ba0: 7565 2e0a 2020 2020 2020 2020 2222 220a  ue..        """.
+00010bb0: 2020 2020 6465 6620 7265 6475 6365 5f75      def reduce_u
+00010bc0: 6e63 6f6d 6d69 7474 6564 5f73 697a 6528  ncommitted_size(
+00010bd0: 7365 6c66 2c20 656e 7473 3a20 4c69 7374  self, ents: List
+00010be0: 5b22 456e 7472 7922 5d20 7c20 4c69 7374  ["Entry"] | List
+00010bf0: 5b22 456e 7472 7952 6566 225d 2920 2d3e  ["EntryRef"]) ->
+00010c00: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00010c10: 2222 0a20 2020 2020 2020 2052 6564 7563  "".        Reduc
+00010c20: 6520 7369 7a65 206f 6620 2765 6e74 7327  e size of 'ents'
+00010c30: 2066 726f 6d20 756e 636f 6d6d 6974 7465   from uncommitte
+00010c40: 6420 7369 7a65 2e0a 2020 2020 2020 2020  d size..        
+00010c50: 2222 220a 2020 2020 6465 6620 6263 6173  """.    def bcas
+00010c60: 745f 6170 7065 6e64 2873 656c 6629 202d  t_append(self) -
+00010c70: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00010c80: 2222 220a 2020 2020 2020 2020 5365 6e64  """.        Send
+00010c90: 7320 5250 432c 2077 6974 6820 656e 7472  s RPC, with entr
+00010ca0: 6965 7320 746f 2061 6c6c 2070 6565 7273  ies to all peers
+00010cb0: 2074 6861 7420 6172 6520 6e6f 7420 7570   that are not up
+00010cc0: 2d74 6f2d 6461 7465 0a20 2020 2020 2020  -to-date.       
+00010cd0: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+00010ce0: 6520 7072 6f67 7265 7373 2072 6563 6f72  e progress recor
+00010cf0: 6465 6420 696e 2072 2e70 7273 2829 2e0a  ded in r.prs()..
+00010d00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010d10: 6465 6620 6263 6173 745f 6865 6172 7462  def bcast_heartb
+00010d20: 6561 7428 7365 6c66 2920 2d3e 204e 6f6e  eat(self) -> Non
+00010d30: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00010d40: 2020 2020 2020 2053 656e 6473 2052 5043         Sends RPC
+00010d50: 2c20 7769 7468 6f75 7420 656e 7472 6965  , without entrie
+00010d60: 7320 746f 2061 6c6c 2074 6865 2070 6565  s to all the pee
+00010d70: 7273 2e0a 2020 2020 2020 2020 2222 220a  rs..        """.
+00010d80: 2020 2020 6465 6620 7368 6f75 6c64 5f62      def should_b
+00010d90: 6361 7374 5f63 6f6d 6d69 7428 7365 6c66  cast_commit(self
+00010da0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+00010db0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+00010dc0: 7065 6369 6669 6573 2069 6620 7468 6520  pecifies if the 
+00010dd0: 636f 6d6d 6974 2073 686f 756c 6420 6265  commit should be
+00010de0: 2062 726f 6164 6361 7374 2e0a 2020 2020   broadcast..    
+00010df0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00010e00: 736b 6970 5f62 6361 7374 5f63 6f6d 6d69  skip_bcast_commi
+00010e10: 7428 7365 6c66 2c20 736b 6970 3a20 626f  t(self, skip: bo
+00010e20: 6f6c 2920 2d3e 204e 6f6e 653a 0a20 2020  ol) -> None:.   
+00010e30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010e40: 2053 6574 2077 6865 7468 6572 2073 6b69   Set whether ski
+00010e50: 7020 6272 6f61 6463 6173 7420 656d 7074  p broadcast empt
+00010e60: 7920 636f 6d6d 6974 206d 6573 7361 6765  y commit message
+00010e70: 7320 6174 2072 756e 7469 6d65 2e0a 2020  s at runtime..  
+00010e80: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00010e90: 6620 6265 636f 6d65 5f6c 6561 6465 7228  f become_leader(
+00010ea0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00010eb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00010ec0: 2020 204d 616b 6573 2074 6869 7320 7261     Makes this ra
+00010ed0: 6674 2074 6865 206c 6561 6465 722e 0a0a  ft the leader...
+00010ee0: 2020 2020 2020 2020 2320 5061 6e69 6373          # Panics
+00010ef0: 0a0a 2020 2020 2020 2020 5061 6e69 6373  ..        Panics
+00010f00: 2069 6620 7468 6973 2069 7320 6120 666f   if this is a fo
+00010f10: 6c6c 6f77 6572 206e 6f64 652e 0a20 2020  llower node..   
+00010f20: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00010f30: 2062 6563 6f6d 655f 666f 6c6c 6f77 6572   become_follower
+00010f40: 2873 656c 662c 2074 6572 6d3a 2069 6e74  (self, term: int
+00010f50: 2c20 6c65 6164 6572 5f69 643a 2069 6e74  , leader_id: int
+00010f60: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00010f70: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+00010f80: 6f6e 7665 7274 7320 7468 6973 206e 6f64  onverts this nod
+00010f90: 6520 746f 2061 2066 6f6c 6c6f 7765 722e  e to a follower.
+00010fa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010fb0: 2064 6566 2062 6563 6f6d 655f 7072 655f   def become_pre_
+00010fc0: 6361 6e64 6964 6174 6528 7365 6c66 2920  candidate(self) 
+00010fd0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00010fe0: 2022 2222 0a20 2020 2020 2020 2043 6f6e   """.        Con
+00010ff0: 7665 7274 7320 7468 6973 206e 6f64 6520  verts this node 
+00011000: 746f 2061 2070 7265 2d63 616e 6469 6461  to a pre-candida
+00011010: 7465 0a0a 2020 2020 2020 2020 2320 5061  te..        # Pa
+00011020: 6e69 6373 0a0a 2020 2020 2020 2020 5061  nics..        Pa
+00011030: 6e69 6373 2069 6620 6120 6c65 6164 6572  nics if a leader
+00011040: 2061 6c72 6561 6479 2065 7869 7374 732e   already exists.
+00011050: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011060: 2064 6566 2062 6563 6f6d 655f 6361 6e64   def become_cand
+00011070: 6964 6174 6528 7365 6c66 2920 2d3e 204e  idate(self) -> N
+00011080: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00011090: 0a20 2020 2020 2020 2043 6f6e 7665 7274  .        Convert
+000110a0: 7320 7468 6973 206e 6f64 6520 746f 2061  s this node to a
+000110b0: 2063 616e 6469 6461 7465 0a0a 2020 2020   candidate..    
+000110c0: 2020 2020 2320 5061 6e69 6373 0a0a 2020      # Panics..  
+000110d0: 2020 2020 2020 5061 6e69 6373 2069 6620        Panics if 
+000110e0: 6120 6c65 6164 6572 2061 6c72 6561 6479  a leader already
+000110f0: 2065 7869 7374 732e 0a20 2020 2020 2020   exists..       
+00011100: 2022 2222 0a20 2020 2064 6566 2068 6561   """.    def hea
+00011110: 7274 6265 6174 5f74 696d 656f 7574 2873  rtbeat_timeout(s
+00011120: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+00011130: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00011140: 2046 6574 6368 2074 6865 206c 656e 6774   Fetch the lengt
+00011150: 6820 6f66 2074 6865 2068 6561 7274 6265  h of the heartbe
+00011160: 6174 2074 696d 656f 7574 0a20 2020 2020  at timeout.     
+00011170: 2020 2022 2222 0a20 2020 2064 6566 2068     """.    def h
+00011180: 6561 7274 6265 6174 5f65 6c61 7073 6564  eartbeat_elapsed
+00011190: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+000111a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000111b0: 2020 2046 6574 6368 2074 6865 206e 756d     Fetch the num
+000111c0: 6265 7220 6f66 2074 6963 6b73 2065 6c61  ber of ticks ela
+000111d0: 7073 6564 2073 696e 6365 206c 6173 7420  psed since last 
+000111e0: 6865 6172 7462 6561 742e 0a20 2020 2020  heartbeat..     
+000111f0: 2020 2022 2222 0a20 2020 2064 6566 2065     """.    def e
+00011200: 6c65 6374 696f 6e5f 7469 6d65 6f75 7428  lection_timeout(
+00011210: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
+00011220: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011230: 2020 4665 7463 6820 7468 6520 6c65 6e67    Fetch the leng
+00011240: 7468 206f 6620 7468 6520 656c 6563 7469  th of the electi
+00011250: 6f6e 2074 696d 656f 7574 2e0a 2020 2020  on timeout..    
+00011260: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00011270: 7261 6e64 6f6d 697a 6564 5f65 6c65 6374  randomized_elect
+00011280: 696f 6e5f 7469 6d65 6f75 7428 7365 6c66  ion_timeout(self
+00011290: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+000112a0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+000112b0: 7475 726e 2074 6865 206c 656e 6774 6820  turn the length 
+000112c0: 6f66 2074 6865 2063 7572 7265 6e74 2072  of the current r
+000112d0: 616e 646f 6d69 7a65 6420 656c 6563 7469  andomized electi
+000112e0: 6f6e 2074 696d 656f 7574 2e0a 2020 2020  on timeout..    
+000112f0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00011300: 7365 745f 7261 6e64 6f6d 697a 6564 5f65  set_randomized_e
+00011310: 6c65 6374 696f 6e5f 7469 6d65 6f75 7428  lection_timeout(
+00011320: 7365 6c66 2c20 7261 6e64 6f6d 697a 6564  self, randomized
+00011330: 5f65 6c65 6374 696f 6e5f 7469 6d65 6f75  _election_timeou
+00011340: 743a 2069 6e74 2920 2d3e 204e 6f6e 653a  t: int) -> None:
+00011350: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011360: 2020 2020 2046 6f72 2074 6573 7469 6e67       For testing
+00011370: 206c 6561 6465 7220 6c65 6173 650a 2020   leader lease.  
+00011380: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00011390: 6620 7265 7365 745f 7261 6e64 6f6d 697a  f reset_randomiz
+000113a0: 6564 5f65 6c65 6374 696f 6e5f 7469 6d65  ed_election_time
+000113b0: 6f75 7428 7365 6c66 2920 2d3e 204e 6f6e  out(self) -> Non
+000113c0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+000113d0: 2020 2020 2020 2052 6567 656e 6572 6174         Regenerat
+000113e0: 6573 2061 6e64 2073 746f 7265 7320 7468  es and stores th
+000113f0: 6520 656c 6563 7469 6f6e 2074 696d 656f  e election timeo
+00011400: 7574 2e0a 2020 2020 2020 2020 2222 220a  ut..        """.
+00011410: 2020 2020 6465 6620 7061 7373 5f65 6c65      def pass_ele
+00011420: 6374 696f 6e5f 7469 6d65 6f75 7428 7365  ction_timeout(se
+00011430: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
+00011440: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00011450: 2060 7061 7373 5f65 6c65 6374 696f 6e5f   `pass_election_
+00011460: 7469 6d65 6f75 7460 2072 6574 7572 6e73  timeout` returns
+00011470: 2074 7275 6520 6966 2060 656c 6563 7469   true if `electi
+00011480: 6f6e 5f65 6c61 7073 6564 6020 6973 2067  on_elapsed` is g
+00011490: 7265 6174 6572 0a20 2020 2020 2020 2074  reater.        t
+000114a0: 6861 6e20 6f72 2065 7175 616c 2074 6f20  han or equal to 
+000114b0: 7468 6520 7261 6e64 6f6d 697a 6564 2065  the randomized e
+000114c0: 6c65 6374 696f 6e20 7469 6d65 6f75 7420  lection timeout 
+000114d0: 696e 0a20 2020 2020 2020 205b 6065 6c65  in.        [`ele
+000114e0: 6374 696f 6e5f 7469 6d65 6f75 7460 2c20  ction_timeout`, 
+000114f0: 3220 2a20 6065 6c65 6374 696f 6e5f 7469  2 * `election_ti
+00011500: 6d65 6f75 7460 202d 2031 5d2e 0a20 2020  meout` - 1]..   
+00011510: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00011520: 2073 656e 645f 7469 6d65 6f75 745f 6e6f   send_timeout_no
+00011530: 7728 7365 6c66 2c20 746f 3a20 696e 7429  w(self, to: int)
+00011540: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00011550: 2020 2222 220a 2020 2020 2020 2020 4973    """.        Is
+00011560: 7375 6573 2061 206d 6573 7361 6765 2074  sues a message t
+00011570: 6f20 7469 6d65 6f75 7420 696d 6d65 6469  o timeout immedi
+00011580: 6174 656c 792e 0a20 2020 2020 2020 2022  ately..        "
+00011590: 2222 0a20 2020 2064 6566 2072 6561 6479  "".    def ready
+000115a0: 5f72 6561 645f 636f 756e 7428 7365 6c66  _read_count(self
+000115b0: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+000115c0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+000115d0: 7475 726e 7320 686f 7720 6d61 6e79 2072  turns how many r
+000115e0: 6561 6420 7374 6174 6573 2065 7869 7374  ead states exist
+000115f0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00011600: 2020 6465 6620 7065 6e64 696e 675f 7265    def pending_re
+00011610: 6164 5f63 6f75 6e74 2873 656c 6629 202d  ad_count(self) -
+00011620: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
+00011630: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00011640: 6e73 2074 6865 206e 756d 6265 7220 6f66  ns the number of
+00011650: 2070 656e 6469 6e67 2072 6561 642d 6f6e   pending read-on
+00011660: 6c79 206d 6573 7361 6765 732e 0a20 2020  ly messages..   
+00011670: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00011680: 206c 6f61 645f 7374 6174 6528 7365 6c66   load_state(self
+00011690: 2c20 6873 3a20 2248 6172 6453 7461 7465  , hs: "HardState
+000116a0: 2220 7c20 2248 6172 6453 7461 7465 5265  " | "HardStateRe
+000116b0: 6622 2920 2d3e 204e 6f6e 653a 0a20 2020  f") -> None:.   
+000116c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000116d0: 2046 6f72 2061 2067 6976 656e 2068 6172   For a given har
+000116e0: 6473 7461 7465 2c20 6c6f 6164 2074 6865  dstate, load the
+000116f0: 2073 7461 7465 2069 6e74 6f20 7365 6c66   state into self
+00011700: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00011710: 2020 6465 6620 736f 6674 5f73 7461 7465    def soft_state
+00011720: 2873 656c 6629 202d 3e20 2253 6f66 7453  (self) -> "SoftS
+00011730: 7461 7465 223a 0a20 2020 2020 2020 2022  tate":.        "
+00011740: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00011750: 6e73 2061 2076 616c 7565 2072 6570 7265  ns a value repre
+00011760: 7365 6e74 696e 6720 7468 6520 736f 6674  senting the soft
+00011770: 7374 6174 6520 6174 2074 6865 2074 696d  state at the tim
+00011780: 6520 6f66 2063 616c 6c69 6e67 2e0a 2020  e of calling..  
+00011790: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+000117a0: 6620 6861 7264 5f73 7461 7465 2873 656c  f hard_state(sel
+000117b0: 6629 202d 3e20 2248 6172 6453 7461 7465  f) -> "HardState
+000117c0: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
+000117d0: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
+000117e0: 2076 616c 7565 2072 6570 7265 7365 6e74   value represent
+000117f0: 696e 6720 7468 6520 6861 7264 7374 6174  ing the hardstat
+00011800: 6520 6174 2074 6865 2074 696d 6520 6f66  e at the time of
+00011810: 2063 616c 6c69 6e67 2e0a 2020 2020 2020   calling..      
+00011820: 2020 2222 220a 2020 2020 6465 6620 7069    """.    def pi
+00011830: 6e67 2873 656c 6629 202d 3e20 4e6f 6e65  ng(self) -> None
+00011840: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00011850: 2020 2020 2020 4272 6f61 6463 6173 7473        Broadcasts
+00011860: 2068 6561 7274 6265 6174 7320 746f 2061   heartbeats to a
+00011870: 6c6c 2074 6865 2066 6f6c 6c6f 7765 7273  ll the followers
+00011880: 2069 6620 6974 2773 206c 6561 6465 722e   if it's leader.
+00011890: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000118a0: 2064 6566 2074 6963 6b28 7365 6c66 2920   def tick(self) 
+000118b0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+000118c0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+000118d0: 7572 6e73 2074 7275 6520 746f 2069 6e64  urns true to ind
+000118e0: 6963 6174 6520 7468 6174 2074 6865 7265  icate that there
+000118f0: 2077 696c 6c20 7072 6f62 6162 6c79 2062   will probably b
+00011900: 6520 736f 6d65 2072 6561 6469 6e65 7373  e some readiness
+00011910: 206e 6565 6420 746f 2062 6520 6861 6e64   need to be hand
+00011920: 6c65 642e 0a20 2020 2020 2020 2022 2222  led..        """
+00011930: 0a20 2020 2064 6566 2074 6963 6b5f 656c  .    def tick_el
+00011940: 6563 7469 6f6e 2873 656c 6629 202d 3e20  ection(self) -> 
+00011950: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+00011960: 220a 2020 2020 2020 2020 5275 6e20 6279  ".        Run by
+00011970: 2066 6f6c 6c6f 7765 7273 2061 6e64 2063   followers and c
+00011980: 616e 6469 6461 7465 7320 6166 7465 7220  andidates after 
+00011990: 7365 6c66 2e65 6c65 6374 696f 6e5f 7469  self.election_ti
+000119a0: 6d65 6f75 742e 0a0a 2020 2020 2020 2020  meout...        
+000119b0: 5265 7475 726e 7320 7472 7565 2074 6f20  Returns true to 
+000119c0: 696e 6469 6361 7465 2074 6861 7420 7468  indicate that th
+000119d0: 6572 6520 7769 6c6c 2070 726f 6261 626c  ere will probabl
+000119e0: 7920 6265 2073 6f6d 6520 7265 6164 696e  y be some readin
+000119f0: 6573 7320 6e65 6564 2074 6f20 6265 2068  ess need to be h
+00011a00: 616e 646c 6564 2e0a 2020 2020 2020 2020  andled..        
+00011a10: 2222 220a 2020 2020 6465 6620 7374 6570  """.    def step
+00011a20: 2873 656c 662c 206d 7367 3a20 224d 6573  (self, msg: "Mes
+00011a30: 7361 6765 2220 7c20 224d 6573 7361 6765  sage" | "Message
+00011a40: 5265 6622 2920 2d3e 204e 6f6e 653a 0a20  Ref") -> None:. 
+00011a50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011a60: 2020 2053 7465 7073 2074 6865 2072 6166     Steps the raf
+00011a70: 7420 616c 6f6e 6720 7669 6120 6120 6d65  t along via a me
+00011a80: 7373 6167 652e 2054 6869 7320 7368 6f75  ssage. This shou
+00011a90: 6c64 2062 6520 6361 6c6c 6564 2065 7665  ld be called eve
+00011aa0: 7279 7469 6d65 2079 6f75 7220 7261 6674  rytime your raft
+00011ab0: 2072 6563 6569 7665 7320 610a 2020 2020   receives a.    
+00011ac0: 2020 2020 6d65 7373 6167 6520 6672 6f6d      message from
+00011ad0: 2061 2070 6565 722e 0a20 2020 2020 2020   a peer..       
+00011ae0: 2022 2222 0a20 2020 2064 6566 2068 6173   """.    def has
+00011af0: 5f70 656e 6469 6e67 5f63 6f6e 6628 7365  _pending_conf(se
+00011b00: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
+00011b10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00011b20: 2043 6865 636b 2069 6620 7468 6572 6520   Check if there 
+00011b30: 6973 2061 6e79 2070 656e 6469 6e67 2063  is any pending c
+00011b40: 6f6e 6663 6861 6e67 652e 0a0a 2020 2020  onfchange...    
+00011b50: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+00011b60: 6361 6e20 6265 2066 616c 7365 2070 6f73  can be false pos
+00011b70: 6974 6976 652e 0a20 2020 2020 2020 2022  itive..        "
+00011b80: 2222 0a20 2020 2064 6566 2070 726f 6d6f  "".    def promo
+00011b90: 7461 626c 6528 7365 6c66 2920 2d3e 2062  table(self) -> b
+00011ba0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+00011bb0: 0a20 2020 2020 2020 2049 6e64 6963 6174  .        Indicat
+00011bc0: 6573 2077 6865 7468 6572 2073 7461 7465  es whether state
+00011bd0: 206d 6163 6869 6e65 2063 616e 2062 6520   machine can be 
+00011be0: 7072 6f6d 6f74 6564 2074 6f20 6c65 6164  promoted to lead
+00011bf0: 6572 2c0a 2020 2020 2020 2020 7768 6963  er,.        whic
+00011c00: 6820 6973 2074 7275 6520 7768 656e 2069  h is true when i
+00011c10: 7427 7320 6120 766f 7465 7220 616e 6420  t's a voter and 
+00011c20: 6974 7320 6f77 6e20 6964 2069 7320 696e  its own id is in
+00011c30: 2070 726f 6772 6573 7320 6c69 7374 2e0a   progress list..
+00011c40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011c50: 6465 6620 706f 7374 5f63 6f6e 665f 6368  def post_conf_ch
+00011c60: 616e 6765 2873 656c 6629 202d 3e20 2243  ange(self) -> "C
+00011c70: 6f6e 6653 7461 7465 5265 6622 3a0a 2020  onfStateRef":.  
+00011c80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011c90: 2020 5570 6461 7465 7320 7468 6520 696e    Updates the in
+00011ca0: 2d6d 656d 6f72 7920 7374 6174 6520 616e  -memory state an
+00011cb0: 642c 2077 6865 6e20 6e65 6365 7373 6172  d, when necessar
+00011cc0: 792c 2063 6172 7269 6573 206f 7574 2061  y, carries out a
+00011cd0: 6464 6974 696f 6e61 6c20 6163 7469 6f6e  dditional action
+00011ce0: 730a 2020 2020 2020 2020 7375 6368 2061  s.        such a
+00011cf0: 7320 7265 6163 7469 6e67 2074 6f20 7468  s reacting to th
+00011d00: 6520 7265 6d6f 7661 6c20 6f66 206e 6f64  e removal of nod
+00011d10: 6573 206f 7220 6368 616e 6765 6420 7175  es or changed qu
+00011d20: 6f72 756d 2072 6571 7569 7265 6d65 6e74  orum requirement
+00011d30: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00011d40: 2020 2064 6566 2069 6e5f 6c65 6173 6528     def in_lease(
+00011d50: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
+00011d60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011d70: 2020 2052 6574 7572 6e73 2077 6865 7468     Returns wheth
+00011d80: 6572 2074 6865 2063 7572 7265 6e74 2072  er the current r
+00011d90: 6166 7420 6973 2069 6e20 6c65 6173 652e  aft is in lease.
+00011da0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011db0: 2064 6566 2068 616e 646c 655f 6865 6172   def handle_hear
+00011dc0: 7462 6561 7428 7365 6c66 2c20 6d73 673a  tbeat(self, msg:
+00011dd0: 2022 4d65 7373 6167 6522 207c 2022 4d65   "Message" | "Me
+00011de0: 7373 6167 6552 6566 2229 202d 3e20 4e6f  ssageRef") -> No
+00011df0: 6e65 3a0a 2020 2020 2020 2020 2222 2246  ne:.        """F
+00011e00: 6f72 2061 206d 6573 7361 6765 2c20 636f  or a message, co
+00011e10: 6d6d 6974 2061 6e64 2073 656e 6420 6f75  mmit and send ou
+00011e20: 7420 6865 6172 7462 6561 742e 2222 220a  t heartbeat.""".
+00011e30: 2020 2020 6465 6620 6861 6e64 6c65 5f61      def handle_a
+00011e40: 7070 656e 645f 656e 7472 6965 7328 7365  ppend_entries(se
+00011e50: 6c66 2c20 6d73 673a 2022 4d65 7373 6167  lf, msg: "Messag
+00011e60: 6522 207c 2022 4d65 7373 6167 6552 6566  e" | "MessageRef
+00011e70: 2229 202d 3e20 4e6f 6e65 3a0a 2020 2020  ") -> None:.    
+00011e80: 2020 2020 2222 2246 6f72 2061 2067 6976      """For a giv
+00011e90: 656e 206d 6573 7361 6765 2c20 6170 7065  en message, appe
+00011ea0: 6e64 2074 6865 2065 6e74 7269 6573 2074  nd the entries t
+00011eb0: 6f20 7468 6520 6c6f 672e 2222 220a 2020  o the log.""".  
+00011ec0: 2020 6465 6620 7265 7175 6573 745f 736e    def request_sn
+00011ed0: 6170 7368 6f74 2873 656c 6629 202d 3e20  apshot(self) -> 
+00011ee0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00011ef0: 220a 2020 2020 2020 2020 5265 7175 6573  ".        Reques
+00011f00: 7420 6120 736e 6170 7368 6f74 2066 726f  t a snapshot fro
+00011f10: 6d20 6120 6c65 6164 6572 2e0a 2020 2020  m a leader..    
+00011f20: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00011f30: 7072 7328 7365 6c66 2920 2d3e 2022 5072  prs(self) -> "Pr
+00011f40: 6f67 7265 7373 5472 6163 6b65 7252 6566  ogressTrackerRef
+00011f50: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
+00011f60: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
+00011f70: 2072 6561 642d 6f6e 6c79 2072 6566 6572   read-only refer
+00011f80: 656e 6365 2074 6f20 7468 6520 7072 6f67  ence to the prog
+00011f90: 7265 7373 2073 6574 2e0a 2020 2020 2020  ress set..      
+00011fa0: 2020 2222 220a 2020 2020 6465 6620 7265    """.    def re
+00011fb0: 7365 7428 7365 6c66 2c20 7465 726d 3a20  set(self, term: 
+00011fc0: 696e 7429 202d 3e20 4e6f 6e65 3a0a 2020  int) -> None:.  
+00011fd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011fe0: 2020 5265 7365 7473 2074 6865 2063 7572    Resets the cur
+00011ff0: 7265 6e74 206e 6f64 6520 746f 2061 2067  rent node to a g
+00012000: 6976 656e 2074 6572 6d2e 0a20 2020 2020  iven term..     
+00012010: 2020 2022 2222 0a20 2020 2064 6566 2072     """.    def r
+00012020: 6573 746f 7265 2873 656c 662c 2073 6e61  estore(self, sna
+00012030: 7073 686f 743a 2022 536e 6170 7368 6f74  pshot: "Snapshot
+00012040: 2220 7c20 2253 6e61 7073 686f 7452 6566  " | "SnapshotRef
+00012050: 2229 202d 3e20 626f 6f6c 3a0a 2020 2020  ") -> bool:.    
+00012060: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00012070: 5265 636f 7665 7273 2074 6865 2073 7461  Recovers the sta
+00012080: 7465 206d 6163 6869 6e65 2066 726f 6d20  te machine from 
+00012090: 6120 736e 6170 7368 6f74 2e20 4974 2072  a snapshot. It r
+000120a0: 6573 746f 7265 7320 7468 6520 6c6f 6720  estores the log 
+000120b0: 616e 6420 7468 650a 2020 2020 2020 2020  and the.        
+000120c0: 636f 6e66 6967 7572 6174 696f 6e20 6f66  configuration of
+000120d0: 2073 7461 7465 206d 6163 6869 6e65 2e0a   state machine..
+000120e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000120f0: 6465 6620 736e 6170 2873 656c 6629 202d  def snap(self) -
+00012100: 3e20 4f70 7469 6f6e 616c 5b22 536e 6170  > Optional["Snap
+00012110: 7368 6f74 5265 6622 5d3a 0a20 2020 2020  shotRef"]:.     
+00012120: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+00012130: 7261 6273 2061 2072 6566 6572 656e 6365  rabs a reference
+00012140: 2074 6f20 7468 6520 736e 6170 7368 6f74   to the snapshot
+00012150: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012160: 2064 6566 2073 746f 7265 2873 656c 6629   def store(self)
+00012170: 202d 3e20 224d 656d 5374 6f72 6167 6552   -> "MemStorageR
+00012180: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+00012190: 0a20 2020 2020 2020 2047 7261 6273 2061  .        Grabs a
+000121a0: 6e20 696d 6d75 7461 626c 6520 7265 6665  n immutable refe
+000121b0: 7265 6e63 6520 746f 2074 6865 2073 746f  rence to the sto
+000121c0: 7265 2e0a 2020 2020 2020 2020 2222 220a  re..        """.
+000121d0: 2020 2020 6465 6620 6f6e 5f70 6572 7369      def on_persi
+000121e0: 7374 5f73 6e61 7028 7365 6c66 2c20 696e  st_snap(self, in
+000121f0: 6465 783a 2069 6e74 2920 2d3e 204e 6f6e  dex: int) -> Non
+00012200: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00012210: 2020 2020 2020 204e 6f74 6966 6965 7320         Notifies 
+00012220: 7468 6174 2074 6865 2073 6e61 7073 686f  that the snapsho
+00012230: 7420 6861 7665 2062 6565 6e20 7065 7273  t have been pers
+00012240: 6973 7465 642e 0a20 2020 2020 2020 2022  isted..        "
+00012250: 2222 0a20 2020 2064 6566 2061 626f 7274  "".    def abort
+00012260: 5f6c 6561 6465 725f 7472 616e 7366 6572  _leader_transfer
+00012270: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00012280: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012290: 2020 2020 5374 6f70 7320 7468 6520 7472      Stops the tr
+000122a0: 616e 7366 6572 206f 6620 6120 6c65 6164  ansfer of a lead
+000122b0: 6572 2e0a 2020 2020 2020 2020 2222 220a  er..        """.
+000122c0: 2020 2020 6465 6620 6361 6d70 6169 676e      def campaign
+000122d0: 2873 656c 662c 2074 7970 3a20 7374 7229  (self, typ: str)
+000122e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000122f0: 2020 2222 220a 2020 2020 2020 2020 4361    """.        Ca
+00012300: 6d70 6169 676e 2074 6f20 6174 7465 6d70  mpaign to attemp
+00012310: 7420 746f 2062 6563 6f6d 6520 6120 6c65  t to become a le
+00012320: 6164 6572 2e0a 0a20 2020 2020 2020 2049  ader...        I
+00012330: 6620 7072 6576 6f74 6520 6973 2065 6e61  f prevote is ena
+00012340: 626c 6564 2c20 7468 6973 2069 7320 6861  bled, this is ha
+00012350: 6e64 6c65 6420 6173 2077 656c 6c2e 0a20  ndled as well.. 
+00012360: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00012370: 6566 2067 6574 5f6c 6561 645f 7472 616e  ef get_lead_tran
+00012380: 7366 6572 6565 2873 656c 6629 202d 3e20  sferee(self) -> 
+00012390: 4f70 7469 6f6e 616c 5b69 6e74 5d3a 0a20  Optional[int]:. 
+000123a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000123b0: 2020 2060 6c65 6164 5f74 7261 6e73 6665     `lead_transfe
+000123c0: 7265 6560 3a20 4944 206f 6620 7468 6520  ree`: ID of the 
+000123d0: 6c65 6164 6572 2074 7261 6e73 6665 7220  leader transfer 
+000123e0: 7461 7267 6574 2077 6865 6e20 6974 7320  target when its 
+000123f0: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
+00012400: 652e 0a0a 2020 2020 2020 2020 4966 2074  e...        If t
+00012410: 6869 7320 6973 2053 6f6d 6528 6964 292c  his is Some(id),
+00012420: 2077 6520 666f 6c6c 6f77 2074 6865 2070   we follow the p
+00012430: 726f 6365 6475 7265 2064 6566 696e 6564  rocedure defined
+00012440: 2069 6e20 7261 6674 2074 6865 7369 7320   in raft thesis 
+00012450: 332e 3130 2e0a 2020 2020 2020 2020 2222  3.10..        ""
+00012460: 220a 2020 2020 6465 6620 7365 745f 6c65  ".    def set_le
+00012470: 6164 5f74 7261 6e73 6665 7265 6528 7365  ad_transferee(se
+00012480: 6c66 2c20 6c65 6164 5f74 7261 6e73 6665  lf, lead_transfe
+00012490: 7265 653a 2069 6e74 2920 2d3e 204e 6f6e  ree: int) -> Non
+000124a0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+000124b0: 2020 2020 2020 2060 6c65 6164 5f74 7261         `lead_tra
+000124c0: 6e73 6665 7265 6560 3a20 4944 206f 6620  nsferee`: ID of 
+000124d0: 7468 6520 6c65 6164 6572 2074 7261 6e73  the leader trans
+000124e0: 6665 7220 7461 7267 6574 2077 6865 6e20  fer target when 
+000124f0: 6974 7320 7661 6c75 6520 6973 206e 6f74  its value is not
+00012500: 204e 6f6e 652e 0a0a 2020 2020 2020 2020   None...        
+00012510: 4966 2074 6869 7320 6973 2053 6f6d 6528  If this is Some(
+00012520: 6964 292c 2077 6520 666f 6c6c 6f77 2074  id), we follow t
+00012530: 6865 2070 726f 6365 6475 7265 2064 6566  he procedure def
+00012540: 696e 6564 2069 6e20 7261 6674 2074 6865  ined in raft the
+00012550: 7369 7320 332e 3130 2e0a 2020 2020 2020  sis 3.10..      
+00012560: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
+00012570: 745f 7465 726d 2873 656c 6629 202d 3e20  t_term(self) -> 
+00012580: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+00012590: 0a20 2020 2020 2020 2060 7465 726d 603a  .        `term`:
+000125a0: 2054 6865 2063 7572 7265 6e74 2065 6c65   The current ele
+000125b0: 6374 696f 6e20 7465 726d 2e0a 2020 2020  ction term..    
+000125c0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+000125d0: 7365 745f 7465 726d 2873 656c 662c 2074  set_term(self, t
+000125e0: 6572 6d3a 2069 6e74 2920 2d3e 204e 6f6e  erm: int) -> Non
+000125f0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00012600: 2020 2020 2020 2060 7465 726d 603a 2054         `term`: T
+00012610: 6865 2063 7572 7265 6e74 2065 6c65 6374  he current elect
+00012620: 696f 6e20 7465 726d 2e0a 2020 2020 2020  ion term..      
+00012630: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
+00012640: 745f 766f 7465 2873 656c 6629 202d 3e20  t_vote(self) -> 
+00012650: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+00012660: 0a20 2020 2020 2020 2060 766f 7465 603a  .        `vote`:
+00012670: 2057 6869 6368 2070 6565 7220 7468 6973   Which peer this
+00012680: 2072 6166 7420 6973 2076 6f74 696e 6720   raft is voting 
+00012690: 666f 722e 0a20 2020 2020 2020 2022 2222  for..        """
+000126a0: 0a20 2020 2064 6566 2073 6574 5f76 6f74  .    def set_vot
+000126b0: 6528 7365 6c66 2c20 766f 7465 3a20 696e  e(self, vote: in
+000126c0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
+000126d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000126e0: 6076 6f74 6560 3a20 5768 6963 6820 7065  `vote`: Which pe
+000126f0: 6572 2074 6869 7320 7261 6674 2069 7320  er this raft is 
+00012700: 766f 7469 6e67 2066 6f72 2e0a 2020 2020  voting for..    
+00012710: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00012720: 6765 745f 7072 696f 7269 7479 2873 656c  get_priority(sel
+00012730: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00012740: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00012750: 7072 696f 7269 7479 603a 2054 6865 2065  priority`: The e
+00012760: 6c65 6374 696f 6e20 7072 696f 7269 7479  lection priority
+00012770: 206f 6620 7468 6973 206e 6f64 652e 0a20   of this node.. 
+00012780: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00012790: 6566 2073 6574 5f70 7269 6f72 6974 7928  ef set_priority(
+000127a0: 7365 6c66 2c20 7072 696f 7269 7479 3a20  self, priority: 
+000127b0: 696e 7429 202d 3e20 4e6f 6e65 3a0a 2020  int) -> None:.  
+000127c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000127d0: 2020 6070 7269 6f72 6974 7960 3a20 5468    `priority`: Th
+000127e0: 6520 656c 6563 7469 6f6e 2070 7269 6f72  e election prior
+000127f0: 6974 7920 6f66 2074 6869 7320 6e6f 6465  ity of this node
+00012800: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00012810: 2020 6465 6620 6765 745f 6c65 6164 6572    def get_leader
+00012820: 5f69 6428 7365 6c66 2920 2d3e 2069 6e74  _id(self) -> int
+00012830: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00012840: 2020 2020 2020 606c 6561 6465 725f 6964        `leader_id
+00012850: 603a 2054 6865 206c 6561 6465 7220 6964  `: The leader id
+00012860: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012870: 2064 6566 2073 6574 5f6c 6561 6465 725f   def set_leader_
+00012880: 6964 2873 656c 662c 206c 6561 6465 725f  id(self, leader_
+00012890: 6964 3a20 696e 7429 202d 3e20 4e6f 6e65  id: int) -> None
+000128a0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000128b0: 2020 2020 2020 606c 6561 6465 725f 6964        `leader_id
+000128c0: 603a 2054 6865 206c 6561 6465 7220 6964  `: The leader id
+000128d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000128e0: 2064 6566 2067 6574 5f6d 6178 5f6d 7367   def get_max_msg
+000128f0: 5f73 697a 6528 7365 6c66 2920 2d3e 2069  _size(self) -> i
+00012900: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
+00012910: 2020 2020 2020 2020 606d 6178 5f6d 7367          `max_msg
+00012920: 5f73 697a 6560 3a20 5468 6520 6d61 7869  _size`: The maxi
+00012930: 6d75 6d20 6c65 6e67 7468 2028 696e 2062  mum length (in b
+00012940: 7974 6573 2920 6f66 2061 6c6c 2074 6865  ytes) of all the
+00012950: 2065 6e74 7269 6573 2e0a 2020 2020 2020   entries..      
+00012960: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+00012970: 745f 6d61 785f 6d73 675f 7369 7a65 2873  t_max_msg_size(s
+00012980: 656c 662c 206d 6178 5f6d 7367 5f73 697a  elf, max_msg_siz
+00012990: 653a 2069 6e74 2920 2d3e 204e 6f6e 653a  e: int) -> None:
+000129a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000129b0: 2020 2020 2060 6d61 785f 6d73 675f 7369       `max_msg_si
+000129c0: 7a65 603a 2054 6865 206d 6178 696d 756d  ze`: The maximum
+000129d0: 206c 656e 6774 6820 2869 6e20 6279 7465   length (in byte
+000129e0: 7329 206f 6620 616c 6c20 7468 6520 656e  s) of all the en
+000129f0: 7472 6965 732e 0a20 2020 2020 2020 2022  tries..        "
+00012a00: 2222 0a20 2020 2064 6566 2067 6574 5f70  "".    def get_p
+00012a10: 656e 6469 6e67 5f63 6f6e 665f 696e 6465  ending_conf_inde
+00012a20: 7828 7365 6c66 2920 2d3e 2069 6e74 3a0a  x(self) -> int:.
+00012a30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012a40: 2020 2020 6070 656e 6469 6e67 5f63 6f6e      `pending_con
+00012a50: 665f 696e 6465 7860 3a20 4f6e 6c79 206f  f_index`: Only o
+00012a60: 6e65 2063 6f6e 6620 6368 616e 6765 206d  ne conf change m
+00012a70: 6179 2062 6520 7065 6e64 696e 6720 2869  ay be pending (i
+00012a80: 6e20 7468 6520 6c6f 672c 2062 7574 206e  n the log, but n
+00012a90: 6f74 2079 6574 0a20 2020 2020 2020 2061  ot yet.        a
+00012aa0: 7070 6c69 6564 2920 6174 2061 2074 696d  pplied) at a tim
+00012ab0: 652e 2054 6869 7320 6973 2065 6e66 6f72  e. This is enfor
+00012ac0: 6365 6420 7669 6120 6070 656e 6469 6e67  ced via `pending
+00012ad0: 5f63 6f6e 665f 696e 6465 7860 2c20 7768  _conf_index`, wh
+00012ae0: 6963 680a 2020 2020 2020 2020 6973 2073  ich.        is s
+00012af0: 6574 2074 6f20 6120 7661 6c75 6520 3e3d  et to a value >=
+00012b00: 2074 6865 206c 6f67 2069 6e64 6578 206f   the log index o
+00012b10: 6620 7468 6520 6c61 7465 7374 2070 656e  f the latest pen
+00012b20: 6469 6e67 0a20 2020 2020 2020 2063 6f6e  ding.        con
+00012b30: 6669 6775 7261 7469 6f6e 2063 6861 6e67  figuration chang
+00012b40: 6520 2869 6620 616e 7929 2e20 436f 6e66  e (if any). Conf
+00012b50: 6967 2063 6861 6e67 6573 2061 7265 206f  ig changes are o
+00012b60: 6e6c 7920 616c 6c6f 7765 6420 746f 0a20  nly allowed to. 
+00012b70: 2020 2020 2020 2062 6520 7072 6f70 6f73         be propos
+00012b80: 6564 2069 6620 7468 6520 6c65 6164 6572  ed if the leader
+00012b90: 2773 2061 7070 6c69 6564 2069 6e64 6578  's applied index
+00012ba0: 2069 7320 6772 6561 7465 7220 7468 616e   is greater than
+00012bb0: 2074 6869 730a 2020 2020 2020 2020 7661   this.        va
+00012bc0: 6c75 652e 0a0a 2020 2020 2020 2020 5468  lue...        Th
+00012bd0: 6973 2076 616c 7565 2069 7320 636f 6e73  is value is cons
+00012be0: 6572 7661 7469 7665 6c79 2073 6574 2069  ervatively set i
+00012bf0: 6e20 6361 7365 7320 7768 6572 6520 7468  n cases where th
+00012c00: 6572 6520 6d61 7920 6265 2061 2063 6f6e  ere may be a con
+00012c10: 6669 6775 7261 7469 6f6e 2063 6861 6e67  figuration chang
+00012c20: 6520 7065 6e64 696e 672c 0a20 2020 2020  e pending,.     
+00012c30: 2020 2062 7574 2073 6361 6e6e 696e 6720     but scanning 
+00012c40: 7468 6520 6c6f 6720 6973 2070 6f73 7369  the log is possi
+00012c50: 626c 7920 6578 7065 6e73 6976 652e 2054  bly expensive. T
+00012c60: 6869 7320 696d 706c 6965 7320 7468 6174  his implies that
+00012c70: 2074 6865 2069 6e64 6578 2073 7461 7465   the index state
+00012c80: 6420 6865 7265 206d 6179 206e 6f74 0a20  d here may not. 
+00012c90: 2020 2020 2020 206e 6563 6573 7361 7269         necessari
+00012ca0: 6c79 2062 6520 6120 636f 6e66 6967 2063  ly be a config c
+00012cb0: 6861 6e67 6520 656e 7472 792c 2061 6e64  hange entry, and
+00012cc0: 2069 7420 6d61 7920 6e6f 7420 6265 2061   it may not be a
+00012cd0: 2060 4265 6769 6e4d 656d 6265 7273 6869   `BeginMembershi
+00012ce0: 7043 6861 6e67 6560 2065 6e74 7279 2c20  pChange` entry, 
+00012cf0: 6576 656e 2069 660a 2020 2020 2020 2020  even if.        
+00012d00: 7765 2073 6574 2074 6869 7320 746f 206f  we set this to o
+00012d10: 6e65 2e0a 2020 2020 2020 2020 2222 220a  ne..        """.
+00012d20: 2020 2020 6465 6620 7365 745f 7065 6e64      def set_pend
+00012d30: 696e 675f 636f 6e66 5f69 6e64 6578 2873  ing_conf_index(s
+00012d40: 656c 662c 2070 656e 6469 6e67 5f63 6f6e  elf, pending_con
+00012d50: 665f 696e 6465 783a 2069 6e74 2920 2d3e  f_index: int) ->
+00012d60: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00012d70: 2222 0a20 2020 2020 2020 2060 7065 6e64  "".        `pend
+00012d80: 696e 675f 636f 6e66 5f69 6e64 6578 603a  ing_conf_index`:
+00012d90: 204f 6e6c 7920 6f6e 6520 636f 6e66 2063   Only one conf c
+00012da0: 6861 6e67 6520 6d61 7920 6265 2070 656e  hange may be pen
+00012db0: 6469 6e67 2028 696e 2074 6865 206c 6f67  ding (in the log
+00012dc0: 2c20 6275 7420 6e6f 7420 7965 740a 2020  , but not yet.  
+00012dd0: 2020 2020 2020 6170 706c 6965 6429 2061        applied) a
+00012de0: 7420 6120 7469 6d65 2e20 5468 6973 2069  t a time. This i
+00012df0: 7320 656e 666f 7263 6564 2076 6961 2060  s enforced via `
+00012e00: 7065 6e64 696e 675f 636f 6e66 5f69 6e64  pending_conf_ind
+00012e10: 6578 602c 2077 6869 6368 0a20 2020 2020  ex`, which.     
+00012e20: 2020 2069 7320 7365 7420 746f 2061 2076     is set to a v
+00012e30: 616c 7565 203e 3d20 7468 6520 6c6f 6720  alue >= the log 
+00012e40: 696e 6465 7820 6f66 2074 6865 206c 6174  index of the lat
+00012e50: 6573 7420 7065 6e64 696e 670a 2020 2020  est pending.    
+00012e60: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
+00012e70: 6e20 6368 616e 6765 2028 6966 2061 6e79  n change (if any
+00012e80: 292e 2043 6f6e 6669 6720 6368 616e 6765  ). Config change
+00012e90: 7320 6172 6520 6f6e 6c79 2061 6c6c 6f77  s are only allow
+00012ea0: 6564 2074 6f0a 2020 2020 2020 2020 6265  ed to.        be
+00012eb0: 2070 726f 706f 7365 6420 6966 2074 6865   proposed if the
+00012ec0: 206c 6561 6465 7227 7320 6170 706c 6965   leader's applie
+00012ed0: 6420 696e 6465 7820 6973 2067 7265 6174  d index is great
+00012ee0: 6572 2074 6861 6e20 7468 6973 0a20 2020  er than this.   
+00012ef0: 2020 2020 2076 616c 7565 2e0a 0a20 2020       value...   
+00012f00: 2020 2020 2054 6869 7320 7661 6c75 6520       This value 
+00012f10: 6973 2063 6f6e 7365 7276 6174 6976 656c  is conservativel
+00012f20: 7920 7365 7420 696e 2063 6173 6573 2077  y set in cases w
+00012f30: 6865 7265 2074 6865 7265 206d 6179 2062  here there may b
+00012f40: 6520 6120 636f 6e66 6967 7572 6174 696f  e a configuratio
+00012f50: 6e20 6368 616e 6765 2070 656e 6469 6e67  n change pending
+00012f60: 2c0a 2020 2020 2020 2020 6275 7420 7363  ,.        but sc
+00012f70: 616e 6e69 6e67 2074 6865 206c 6f67 2069  anning the log i
+00012f80: 7320 706f 7373 6962 6c79 2065 7870 656e  s possibly expen
+00012f90: 7369 7665 2e20 5468 6973 2069 6d70 6c69  sive. This impli
+00012fa0: 6573 2074 6861 7420 7468 6520 696e 6465  es that the inde
+00012fb0: 7820 7374 6174 6564 2068 6572 6520 6d61  x stated here ma
+00012fc0: 7920 6e6f 740a 2020 2020 2020 2020 6e65  y not.        ne
+00012fd0: 6365 7373 6172 696c 7920 6265 2061 2063  cessarily be a c
+00012fe0: 6f6e 6669 6720 6368 616e 6765 2065 6e74  onfig change ent
+00012ff0: 7279 2c20 616e 6420 6974 206d 6179 206e  ry, and it may n
+00013000: 6f74 2062 6520 6120 6042 6567 696e 4d65  ot be a `BeginMe
+00013010: 6d62 6572 7368 6970 4368 616e 6765 6020  mbershipChange` 
+00013020: 656e 7472 792c 2065 7665 6e20 6966 0a20  entry, even if. 
+00013030: 2020 2020 2020 2077 6520 7365 7420 7468         we set th
+00013040: 6973 2074 6f20 6f6e 652e 0a20 2020 2020  is to one..     
+00013050: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
+00013060: 6574 5f70 656e 6469 6e67 5f72 6571 7565  et_pending_reque
+00013070: 7374 5f73 6e61 7073 686f 7428 7365 6c66  st_snapshot(self
+00013080: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+00013090: 2020 2222 220a 2020 2020 2020 2020 6070    """.        `p
+000130a0: 656e 6469 6e67 5f72 6571 7565 7374 5f73  ending_request_s
+000130b0: 6e61 7073 686f 7460 3a20 5468 6520 7065  napshot`: The pe
+000130c0: 6572 2069 7320 7265 7175 6573 7469 6e67  er is requesting
+000130d0: 2073 6e61 7073 686f 742c 2069 7420 6973   snapshot, it is
+000130e0: 2074 6865 2069 6e64 6578 2074 6861 7420   the index that 
+000130f0: 7468 6520 666f 6c6c 6f77 6572 0a20 2020  the follower.   
+00013100: 2020 2020 206e 6565 6473 2069 7420 746f       needs it to
+00013110: 2062 6520 696e 636c 7564 6564 2069 6e20   be included in 
+00013120: 6120 736e 6170 7368 6f74 2e0a 2020 2020  a snapshot..    
+00013130: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00013140: 7365 745f 7065 6e64 696e 675f 7265 7175  set_pending_requ
+00013150: 6573 745f 736e 6170 7368 6f74 2873 656c  est_snapshot(sel
+00013160: 662c 2070 656e 6469 6e67 5f72 6571 7565  f, pending_reque
+00013170: 7374 5f73 6e61 7073 686f 743a 2069 6e74  st_snapshot: int
+00013180: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00013190: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+000131a0: 7065 6e64 696e 675f 7265 7175 6573 745f  pending_request_
+000131b0: 736e 6170 7368 6f74 603a 2054 6865 2070  snapshot`: The p
+000131c0: 6565 7220 6973 2072 6571 7565 7374 696e  eer is requestin
+000131d0: 6720 736e 6170 7368 6f74 2c20 6974 2069  g snapshot, it i
+000131e0: 7320 7468 6520 696e 6465 7820 7468 6174  s the index that
+000131f0: 2074 6865 2066 6f6c 6c6f 7765 720a 2020   the follower.  
+00013200: 2020 2020 2020 6e65 6564 7320 6974 2074        needs it t
+00013210: 6f20 6265 2069 6e63 6c75 6465 6420 696e  o be included in
+00013220: 2061 2073 6e61 7073 686f 742e 0a20 2020   a snapshot..   
+00013230: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00013240: 2067 6574 5f69 6428 7365 6c66 2920 2d3e   get_id(self) ->
+00013250: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+00013260: 220a 2020 2020 2020 2020 6069 6460 3a20  ".        `id`: 
+00013270: 5468 6520 4944 206f 6620 7468 6973 206e  The ID of this n
+00013280: 6f64 652e 0a20 2020 2020 2020 2022 2222  ode..        """
+00013290: 0a20 2020 2064 6566 2073 6574 5f69 6428  .    def set_id(
+000132a0: 7365 6c66 2c20 6964 3a20 696e 7429 202d  self, id: int) -
+000132b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000132c0: 2222 220a 2020 2020 2020 2020 6069 6460  """.        `id`
+000132d0: 3a20 5468 6520 4944 206f 6620 7468 6973  : The ID of this
+000132e0: 206e 6f64 652e 0a20 2020 2020 2020 2022   node..        "
+000132f0: 2222 0a20 2020 2064 6566 2067 6574 5f6d  "".    def get_m
+00013300: 7367 7328 7365 6c66 2920 2d3e 204c 6973  sgs(self) -> Lis
+00013310: 745b 224d 6573 7361 6765 5265 6622 5d3a  t["MessageRef"]:
+00013320: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013330: 2020 2020 2060 6d73 6773 603a 2054 6865       `msgs`: The
+00013340: 206c 6973 7420 6f66 206d 6573 7361 6765   list of message
+00013350: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00013360: 2020 2064 6566 2073 6574 5f6d 7367 7328     def set_msgs(
+00013370: 7365 6c66 2c20 6d73 6773 3a20 4c69 7374  self, msgs: List
+00013380: 5b22 4d65 7373 6167 6522 207c 2022 4d65  ["Message" | "Me
+00013390: 7373 6167 6552 6566 225d 2920 2d3e 204e  ssageRef"]) -> N
+000133a0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000133b0: 0a20 2020 2020 2020 2060 6d73 6773 603a  .        `msgs`:
+000133c0: 2054 6865 206c 6973 7420 6f66 206d 6573   The list of mes
+000133d0: 7361 6765 732e 0a20 2020 2020 2020 2022  sages..        "
+000133e0: 2222 0a20 2020 2064 6566 2074 616b 655f  "".    def take_
+000133f0: 6d73 6773 2873 656c 6629 202d 3e20 4c69  msgs(self) -> Li
+00013400: 7374 5b22 4d65 7373 6167 6522 5d3a 0a20  st["Message"]:. 
+00013410: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013420: 2020 2060 6d73 6773 603a 2054 6865 206c     `msgs`: The l
+00013430: 6973 7420 6f66 206d 6573 7361 6765 732e  ist of messages.
+00013440: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013450: 2064 6566 2067 6574 5f6d 6178 5f69 6e66   def get_max_inf
+00013460: 6c69 6768 7428 7365 6c66 2920 2d3e 2069  light(self) -> i
+00013470: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
+00013480: 2020 2020 2020 2020 606d 6178 5f69 6e66          `max_inf
+00013490: 6c69 6768 7460 3a20 5468 6520 6d61 7869  light`: The maxi
+000134a0: 6d75 6d20 6e75 6d62 6572 206f 6620 6d65  mum number of me
+000134b0: 7373 6167 6573 2074 6861 7420 6361 6e20  ssages that can 
+000134c0: 6265 2069 6e66 6c69 6768 742e 0a20 2020  be inflight..   
+000134d0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+000134e0: 2073 6574 5f6d 6178 5f69 6e66 6c69 6768   set_max_infligh
+000134f0: 7428 7365 6c66 2c20 6d61 785f 696e 666c  t(self, max_infl
+00013500: 6967 6874 3a20 696e 7429 202d 3e20 4e6f  ight: int) -> No
+00013510: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00013520: 2020 2020 2020 2020 606d 6178 5f69 6e66          `max_inf
+00013530: 6c69 6768 7460 3a20 5468 6520 6d61 7869  light`: The maxi
+00013540: 6d75 6d20 6e75 6d62 6572 206f 6620 6d65  mum number of me
+00013550: 7373 6167 6573 2074 6861 7420 6361 6e20  ssages that can 
+00013560: 6265 2069 6e66 6c69 6768 742e 0a20 2020  be inflight..   
+00013570: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00013580: 2067 6574 5f73 7461 7465 2873 656c 6629   get_state(self)
+00013590: 202d 3e20 2253 7461 7465 526f 6c65 223a   -> "StateRole":
+000135a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000135b0: 2020 2020 2060 7374 6174 6560 3a20 5468       `state`: Th
+000135c0: 6520 6375 7272 656e 7420 726f 6c65 206f  e current role o
+000135d0: 6620 7468 6973 206e 6f64 652e 0a20 2020  f this node..   
+000135e0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+000135f0: 2073 6574 5f73 7461 7465 2873 656c 662c   set_state(self,
+00013600: 2073 7461 7465 5f72 6f6c 653a 2022 5374   state_role: "St
+00013610: 6174 6552 6f6c 6522 2920 2d3e 204e 6f6e  ateRole") -> Non
+00013620: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00013630: 2020 2020 2020 2060 7374 6174 6560 3a20         `state`: 
+00013640: 5468 6520 6375 7272 656e 7420 726f 6c65  The current role
+00013650: 206f 6620 7468 6973 206e 6f64 652e 0a20   of this node.. 
+00013660: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00013670: 6566 2067 6574 5f65 6c65 6374 696f 6e5f  ef get_election_
+00013680: 656c 6170 7365 6428 7365 6c66 2920 2d3e  elapsed(self) ->
+00013690: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+000136a0: 220a 2020 2020 2020 2020 6065 6c65 6374  ".        `elect
+000136b0: 696f 6e5f 656c 6170 7365 6460 3a20 5469  ion_elapsed`: Ti
+000136c0: 636b 7320 7369 6e63 6520 6974 2072 6561  cks since it rea
+000136d0: 6368 6564 206c 6173 7420 656c 6563 7469  ched last electi
+000136e0: 6f6e 5469 6d65 6f75 7420 7768 656e 2069  onTimeout when i
+000136f0: 7420 6973 206c 6561 6465 7220 6f72 2063  t is leader or c
+00013700: 616e 6469 6461 7465 2e0a 2020 2020 2020  andidate..      
+00013710: 2020 4e75 6d62 6572 206f 6620 7469 636b    Number of tick
+00013720: 7320 7369 6e63 6520 6974 2072 6561 6368  s since it reach
+00013730: 6564 206c 6173 7420 656c 6563 7469 6f6e  ed last election
+00013740: 5469 6d65 6f75 7420 6f72 2072 6563 6569  Timeout or recei
+00013750: 7665 6420 610a 2020 2020 2020 2020 7661  ved a.        va
+00013760: 6c69 6420 6d65 7373 6167 6520 6672 6f6d  lid message from
+00013770: 2063 7572 7265 6e74 206c 6561 6465 7220   current leader 
+00013780: 7768 656e 2069 7420 6973 2061 2066 6f6c  when it is a fol
+00013790: 6c6f 7765 722e 0a20 2020 2020 2020 2022  lower..        "
+000137a0: 2222 0a20 2020 2064 6566 2073 6574 5f65  "".    def set_e
+000137b0: 6c65 6374 696f 6e5f 656c 6170 7365 6428  lection_elapsed(
+000137c0: 7365 6c66 2c20 656c 6563 7469 6f6e 5f65  self, election_e
+000137d0: 6c61 7073 6564 3a20 696e 7429 202d 3e20  lapsed: int) -> 
+000137e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000137f0: 220a 2020 2020 2020 2020 6065 6c65 6374  ".        `elect
+00013800: 696f 6e5f 656c 6170 7365 6460 3a20 5469  ion_elapsed`: Ti
+00013810: 636b 7320 7369 6e63 6520 6974 2072 6561  cks since it rea
+00013820: 6368 6564 206c 6173 7420 656c 6563 7469  ched last electi
+00013830: 6f6e 5469 6d65 6f75 7420 7768 656e 2069  onTimeout when i
+00013840: 7420 6973 206c 6561 6465 7220 6f72 2063  t is leader or c
+00013850: 616e 6469 6461 7465 2e0a 2020 2020 2020  andidate..      
+00013860: 2020 4e75 6d62 6572 206f 6620 7469 636b    Number of tick
+00013870: 7320 7369 6e63 6520 6974 2072 6561 6368  s since it reach
+00013880: 6564 206c 6173 7420 656c 6563 7469 6f6e  ed last election
+00013890: 5469 6d65 6f75 7420 6f72 2072 6563 6569  Timeout or recei
+000138a0: 7665 6420 610a 2020 2020 2020 2020 7661  ved a.        va
+000138b0: 6c69 6420 6d65 7373 6167 6520 6672 6f6d  lid message from
+000138c0: 2063 7572 7265 6e74 206c 6561 6465 7220   current leader 
+000138d0: 7768 656e 2069 7420 6973 2061 2066 6f6c  when it is a fol
+000138e0: 6c6f 7765 722e 0a20 2020 2020 2020 2022  lower..        "
+000138f0: 2222 0a20 2020 2064 6566 2067 6574 5f63  "".    def get_c
+00013900: 6865 636b 5f71 756f 7275 6d28 7365 6c66  heck_quorum(self
+00013910: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+00013920: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00013930: 6368 6563 6b5f 7175 6f72 756d 603a 2057  check_quorum`: W
+00013940: 6865 7468 6572 2074 6f20 6368 6563 6b20  hether to check 
+00013950: 7468 6520 7175 6f72 756d 0a20 2020 2020  the quorum.     
+00013960: 2020 2022 2222 0a20 2020 2064 6566 2073     """.    def s
+00013970: 6574 5f63 6865 636b 5f71 756f 7275 6d28  et_check_quorum(
+00013980: 7365 6c66 2c20 6368 6563 6b5f 7175 6f72  self, check_quor
+00013990: 756d 3a20 626f 6f6c 2920 2d3e 204e 6f6e  um: bool) -> Non
+000139a0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+000139b0: 2020 2020 2020 2060 6368 6563 6b5f 7175         `check_qu
+000139c0: 6f72 756d 603a 2057 6865 7468 6572 2074  orum`: Whether t
+000139d0: 6f20 6368 6563 6b20 7468 6520 7175 6f72  o check the quor
+000139e0: 756d 0a20 2020 2020 2020 2022 2222 0a20  um.        """. 
+000139f0: 2020 2064 6566 2067 6574 5f70 7265 5f76     def get_pre_v
+00013a00: 6f74 6528 7365 6c66 2920 2d3e 2062 6f6f  ote(self) -> boo
+00013a10: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
+00013a20: 2020 2020 2020 2060 7072 655f 766f 7465         `pre_vote
+00013a30: 603a 2045 6e61 626c 6520 7468 6520 7072  `: Enable the pr
+00013a40: 6576 6f74 6520 616c 676f 7269 7468 6d2e  evote algorithm.
+00013a50: 0a0a 2020 2020 2020 2020 5468 6973 2065  ..        This e
+00013a60: 6e61 626c 6573 2061 2070 7265 2d65 6c65  nables a pre-ele
+00013a70: 6374 696f 6e20 766f 7465 2072 6f75 6e64  ction vote round
+00013a80: 206f 6e20 4361 6e64 6964 6174 6573 2070   on Candidates p
+00013a90: 7269 6f72 2074 6f20 6469 7372 7570 7469  rior to disrupti
+00013aa0: 6e67 2074 6865 2063 6c75 7374 6572 2e0a  ng the cluster..
+00013ab0: 0a20 2020 2020 2020 2045 6e61 626c 6520  .        Enable 
+00013ac0: 7468 6973 2069 6620 6772 6561 7465 7220  this if greater 
+00013ad0: 636c 7573 7465 7220 7374 6162 696c 6974  cluster stabilit
+00013ae0: 7920 6973 2070 7265 6665 7272 6564 206f  y is preferred o
+00013af0: 7665 7220 6661 7374 6572 2065 6c65 6374  ver faster elect
+00013b00: 696f 6e73 2e0a 2020 2020 2020 2020 2222  ions..        ""
+00013b10: 220a 2020 2020 6465 6620 7365 745f 7072  ".    def set_pr
+00013b20: 655f 766f 7465 2873 656c 662c 2070 7265  e_vote(self, pre
+00013b30: 5f76 6f74 653a 2062 6f6f 6c29 202d 3e20  _vote: bool) -> 
+00013b40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00013b50: 220a 2020 2020 2020 2020 6070 7265 5f76  ".        `pre_v
+00013b60: 6f74 6560 3a20 456e 6162 6c65 2074 6865  ote`: Enable the
+00013b70: 2070 7265 766f 7465 2061 6c67 6f72 6974   prevote algorit
+00013b80: 686d 2e0a 0a20 2020 2020 2020 2054 6869  hm...        Thi
+00013b90: 7320 656e 6162 6c65 7320 6120 7072 652d  s enables a pre-
+00013ba0: 656c 6563 7469 6f6e 2076 6f74 6520 726f  election vote ro
+00013bb0: 756e 6420 6f6e 2043 616e 6469 6461 7465  und on Candidate
+00013bc0: 7320 7072 696f 7220 746f 2064 6973 7275  s prior to disru
+00013bd0: 7074 696e 6720 7468 6520 636c 7573 7465  pting the cluste
+00013be0: 722e 0a0a 2020 2020 2020 2020 456e 6162  r...        Enab
+00013bf0: 6c65 2074 6869 7320 6966 2067 7265 6174  le this if great
+00013c00: 6572 2063 6c75 7374 6572 2073 7461 6269  er cluster stabi
+00013c10: 6c69 7479 2069 7320 7072 6566 6572 7265  lity is preferre
+00013c20: 6420 6f76 6572 2066 6173 7465 7220 656c  d over faster el
+00013c30: 6563 7469 6f6e 732e 0a20 2020 2020 2020  ections..       
+00013c40: 2022 2222 0a20 2020 2064 6566 2061 7070   """.    def app
+00013c50: 6c79 5f63 6f6e 665f 6368 616e 6765 2873  ly_conf_change(s
+00013c60: 656c 662c 2063 6f6e 665f 6368 616e 6765  elf, conf_change
+00013c70: 3a20 2243 6f6e 6643 6861 6e67 6556 3252  : "ConfChangeV2R
+00013c80: 6566 2229 202d 3e20 2243 6f6e 6643 6861  ef") -> "ConfCha
+00013c90: 6e67 6552 6566 223a 0a20 2020 2020 2020  ngeRef":.       
+00013ca0: 2022 2222 2022 2222 0a20 2020 2064 6566   """ """.    def
+00013cb0: 2067 6574 5f72 6561 645f 7374 6174 6573   get_read_states
+00013cc0: 2873 656c 6629 202d 3e20 4c69 7374 5b22  (self) -> List["
+00013cd0: 5265 6164 5374 6174 6522 5d3a 0a20 2020  ReadState"]:.   
+00013ce0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013cf0: 2060 7265 6164 5f73 7461 7465 7360 3a20   `read_states`: 
+00013d00: 5468 6520 6375 7272 656e 7420 7265 6164  The current read
+00013d10: 2073 7461 7465 732e 0a20 2020 2020 2020   states..       
+00013d20: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
+00013d30: 5f72 6561 645f 7374 6174 6573 280a 2020  _read_states(.  
+00013d40: 2020 2020 2020 7365 6c66 2c20 7265 6164        self, read
+00013d50: 5f73 7461 7465 733a 204c 6973 745b 2252  _states: List["R
+00013d60: 6561 6453 7461 7465 225d 207c 204c 6973  eadState"] | Lis
+00013d70: 745b 2252 6561 6453 7461 7465 5265 6622  t["ReadStateRef"
+00013d80: 5d0a 2020 2020 2920 2d3e 204e 6f6e 653a  ].    ) -> None:
+00013d90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013da0: 2020 2020 2060 7265 6164 5f73 7461 7465       `read_state
+00013db0: 7360 3a20 5468 6520 6375 7272 656e 7420  s`: The current 
+00013dc0: 7265 6164 2073 7461 7465 732e 0a20 2020  read states..   
+00013dd0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00013de0: 2067 6574 5f72 6561 645f 6f6e 6c79 5f6f   get_read_only_o
+00013df0: 7074 696f 6e28 7365 6c66 2920 2d3e 2022  ption(self) -> "
+00013e00: 5265 6164 4f6e 6c79 4f70 7469 6f6e 223a  ReadOnlyOption":
+00013e10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013e20: 2020 2020 2060 7265 6164 5f6f 6e6c 795f       `read_only_
+00013e30: 6f70 7469 6f6e 603a 2043 686f 6f73 6520  option`: Choose 
+00013e40: 7468 6520 6c69 6e65 6172 697a 6162 696c  the linearizabil
+00013e50: 6974 7920 6d6f 6465 206f 7220 7468 6520  ity mode or the 
+00013e60: 6c65 6173 6520 6d6f 6465 2074 6f20 7265  lease mode to re
+00013e70: 6164 2064 6174 612e 2049 6620 796f 7520  ad data. If you 
+00013e80: 646f 6ee2 8099 7420 6361 7265 2061 626f  don...t care abo
+00013e90: 7574 2074 6865 2072 6561 6420 636f 6e73  ut the read cons
+00013ea0: 6973 7465 6e63 7920 616e 6420 7761 6e74  istency and want
+00013eb0: 2061 2068 6967 6865 7220 7265 6164 2070   a higher read p
+00013ec0: 6572 666f 726d 616e 6365 2c20 796f 7520  erformance, you 
+00013ed0: 6361 6e20 7573 6520 7468 6520 6c65 6173  can use the leas
+00013ee0: 6520 6d6f 6465 2e0a 2020 2020 2020 2020  e mode..        
+00013ef0: 5365 7474 696e 6720 7468 6973 2074 6f20  Setting this to 
+00013f00: 604c 6561 7365 4261 7365 6460 2072 6571  `LeaseBased` req
+00013f10: 7569 7265 7320 6063 6865 636b 5f71 756f  uires `check_quo
+00013f20: 7275 6d20 3d20 7472 7565 602e 0a20 2020  rum = true`..   
+00013f30: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00013f40: 2073 6574 5f72 6561 645f 6f6e 6c79 5f6f   set_read_only_o
+00013f50: 7074 696f 6e28 7365 6c66 2c20 6f70 7469  ption(self, opti
+00013f60: 6f6e 3a20 2252 6561 644f 6e6c 794f 7074  on: "ReadOnlyOpt
+00013f70: 696f 6e22 2920 2d3e 204e 6f6e 653a 0a20  ion") -> None:. 
+00013f80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013f90: 2020 2060 7265 6164 5f6f 6e6c 795f 6f70     `read_only_op
+00013fa0: 7469 6f6e 603a 2043 686f 6f73 6520 7468  tion`: Choose th
+00013fb0: 6520 6c69 6e65 6172 697a 6162 696c 6974  e linearizabilit
+00013fc0: 7920 6d6f 6465 206f 7220 7468 6520 6c65  y mode or the le
+00013fd0: 6173 6520 6d6f 6465 2074 6f20 7265 6164  ase mode to read
+00013fe0: 2064 6174 612e 2049 6620 796f 7520 646f   data. If you do
+00013ff0: 6ee2 8099 7420 6361 7265 2061 626f 7574  n...t care about
+00014000: 2074 6865 2072 6561 6420 636f 6e73 6973   the read consis
+00014010: 7465 6e63 7920 616e 6420 7761 6e74 2061  tency and want a
+00014020: 2068 6967 6865 7220 7265 6164 2070 6572   higher read per
+00014030: 666f 726d 616e 6365 2c20 796f 7520 6361  formance, you ca
+00014040: 6e20 7573 6520 7468 6520 6c65 6173 6520  n use the lease 
+00014050: 6d6f 6465 2e0a 2020 2020 2020 2020 5365  mode..        Se
+00014060: 7474 696e 6720 7468 6973 2074 6f20 604c  tting this to `L
+00014070: 6561 7365 4261 7365 6460 2072 6571 7569  easeBased` requi
+00014080: 7265 7320 6063 6865 636b 5f71 756f 7275  res `check_quoru
+00014090: 6d20 3d20 7472 7565 602e 0a20 2020 2020  m = true`..     
+000140a0: 2020 2022 2222 0a20 2020 2064 6566 2069     """.    def i
+000140b0: 6e66 6c69 6768 745f 6275 6666 6572 735f  nflight_buffers_
+000140c0: 7369 7a65 2873 656c 6629 202d 3e20 696e  size(self) -> in
+000140d0: 743a 0a20 2020 2020 2020 2022 2222 4765  t:.        """Ge
+000140e0: 7420 7468 6520 696e 666c 6967 6874 2062  t the inflight b
+000140f0: 7566 6665 7220 7369 7a65 2e22 2222 0a20  uffer size.""". 
+00014100: 2020 2064 6566 206d 6179 6265 5f66 7265     def maybe_fre
+00014110: 655f 696e 666c 6967 6874 5f62 7566 6665  e_inflight_buffe
+00014120: 7273 2873 656c 6629 202d 3e20 4e6f 6e65  rs(self) -> None
+00014130: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00014140: 2020 2020 2020 4120 5261 6674 206c 6561        A Raft lea
+00014150: 6465 7220 616c 6c6f 6361 7465 7320 6120  der allocates a 
+00014160: 7665 6374 6f72 2077 6974 6820 6361 7061  vector with capa
+00014170: 6369 7479 2060 6d61 785f 696e 666c 6967  city `max_inflig
+00014180: 6874 5f6d 7367 7360 2066 6f72 2065 7665  ht_msgs` for eve
+00014190: 7279 2070 6565 722e 0a20 2020 2020 2020  ry peer..       
+000141a0: 2049 7420 7461 6b65 7320 6120 6c6f 7420   It takes a lot 
+000141b0: 6f66 206d 656d 6f72 7920 6966 2074 6865  of memory if the
+000141c0: 7265 2061 7265 2074 6f6f 206d 616e 7920  re are too many 
+000141d0: 5261 6674 2067 726f 7570 732e 2060 6d61  Raft groups. `ma
+000141e0: 7962 655f 6672 6565 5f69 6e66 6c69 6768  ybe_free_infligh
+000141f0: 745f 6275 6666 6572 7360 0a20 2020 2020  t_buffers`.     
+00014200: 2020 2069 7320 7573 6564 2074 6f20 6672     is used to fr
+00014210: 6565 206d 656d 6f72 7920 6966 206e 6563  ee memory if nec
+00014220: 6573 7361 7279 2e0a 2020 2020 2020 2020  essary..        
+00014230: 2222 220a 2020 2020 6465 6620 6164 6a75  """.    def adju
+00014240: 7374 5f6d 6178 5f69 6e66 6c69 6768 745f  st_max_inflight_
+00014250: 6d73 6773 2873 656c 662c 2074 6172 6765  msgs(self, targe
+00014260: 743a 2069 6e74 2c20 6361 703a 2069 6e74  t: int, cap: int
+00014270: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00014280: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00014290: 6f20 6164 6a75 7374 2060 6d61 785f 696e  o adjust `max_in
+000142a0: 666c 6967 6874 5f6d 7367 7360 2066 6f72  flight_msgs` for
+000142b0: 2074 6865 2073 7065 6369 6669 6564 2070   the specified p
+000142c0: 6565 722e 0a20 2020 2020 2020 2053 6574  eer..        Set
+000142d0: 2074 6f20 6030 6020 7769 6c6c 2064 6973   to `0` will dis
+000142e0: 6162 6c65 2074 6865 2070 726f 6772 6573  able the progres
+000142f0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00014300: 2020 2064 6566 2067 6574 5f72 6561 646f     def get_reado
+00014310: 6e6c 795f 7265 6164 5f69 6e64 6578 5f71  nly_read_index_q
+00014320: 7565 7565 2873 656c 6629 202d 3e20 4c69  ueue(self) -> Li
+00014330: 7374 5b4c 6973 745b 696e 745d 5d3a 0a20  st[List[int]]:. 
+00014340: 2020 2020 2020 2022 2222 2022 2222 0a20         """ """. 
+00014350: 2020 2064 6566 2073 6574 5f62 6174 6368     def set_batch
+00014360: 5f61 7070 656e 6428 7365 6c66 2c20 6261  _append(self, ba
+00014370: 7463 685f 6170 7065 6e64 3a20 626f 6f6c  tch_append: bool
+00014380: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00014390: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+000143a0: 6574 2077 6865 7468 6572 2062 6174 6368  et whether batch
+000143b0: 2061 7070 656e 6420 6d73 6720 6174 2072   append msg at r
+000143c0: 756e 7469 6d65 2e0a 2020 2020 2020 2020  untime..        
+000143d0: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+000143e0: 6d61 785f 636f 6d6d 6974 7465 645f 7369  max_committed_si
+000143f0: 7a65 5f70 6572 5f72 6561 6479 2873 656c  ze_per_ready(sel
+00014400: 662c 2073 697a 653a 2069 6e74 2920 2d3e  f, size: int) ->
+00014410: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00014420: 2222 0a20 2020 2020 2020 2053 6574 2060  "".        Set `
+00014430: 6d61 785f 636f 6d6d 6974 7465 645f 7369  max_committed_si
+00014440: 7a65 5f70 6572 5f72 6561 6479 6020 746f  ze_per_ready` to
+00014450: 2060 7369 7a65 602e 0a20 2020 2020 2020   `size`..       
+00014460: 2022 2222 0a0a 636c 6173 7320 496e 4d65   """..class InMe
+00014470: 6d6f 7279 5261 6674 285f 5f41 5049 5f52  moryRaft(__API_R
+00014480: 6166 7429 3a0a 2020 2020 2222 220a 2020  aft):.    """.  
+00014490: 2020 4120 7374 7275 6374 2074 6861 7420    A struct that 
+000144a0: 7265 7072 6573 656e 7473 2074 6865 2072  represents the r
+000144b0: 6166 7420 636f 6e73 656e 7375 7320 6974  aft consensus it
+000144c0: 7365 6c66 2e20 5374 6f72 6573 2064 6574  self. Stores det
+000144d0: 6169 6c73 2063 6f6e 6365 726e 696e 6720  ails concerning 
+000144e0: 7468 6520 6375 7272 656e 740a 2020 2020  the current.    
+000144f0: 616e 6420 706f 7373 6962 6c65 2073 7461  and possible sta
+00014500: 7465 2074 6865 2073 7973 7465 6d20 6361  te the system ca
+00014510: 6e20 7461 6b65 2e0a 2020 2020 2222 220a  n take..    """.
+00014520: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00014530: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
+00014540: 0a20 2020 2020 2020 2063 6667 3a20 2243  .        cfg: "C
+00014550: 6f6e 6669 6722 207c 2022 436f 6e66 6967  onfig" | "Config
+00014560: 5265 6622 2c0a 2020 2020 2020 2020 7374  Ref",.        st
+00014570: 6f72 653a 2022 4d65 6d53 746f 7261 6765  ore: "MemStorage
+00014580: 2220 7c20 224d 656d 5374 6f72 6167 6552  " | "MemStorageR
+00014590: 6566 222c 0a20 2020 2020 2020 206c 6f67  ef",.        log
+000145a0: 6765 723a 2022 4c6f 6767 6572 2220 7c20  ger: "Logger" | 
+000145b0: 224c 6f67 6765 7252 6566 222c 0a20 2020  "LoggerRef",.   
+000145c0: 2029 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a   ) -> None: ....
+000145d0: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
+000145e0: 2873 656c 6629 202d 3e20 2249 6e4d 656d  (self) -> "InMem
+000145f0: 6f72 7952 6166 7452 6566 223a 202e 2e2e  oryRaftRef": ...
+00014600: 0a20 2020 2064 6566 2067 6574 5f72 6166  .    def get_raf
+00014610: 745f 6c6f 6728 7365 6c66 2920 2d3e 2022  t_log(self) -> "
+00014620: 496e 4d65 6d6f 7279 5261 6674 4c6f 6752  InMemoryRaftLogR
+00014630: 6566 223a 0a20 2020 2020 2020 2022 2222  ef":.        """
+00014640: 2022 2222 0a0a 636c 6173 7320 496e 4d65   """..class InMe
+00014650: 6d6f 7279 5261 6674 5265 6628 5f5f 4150  moryRaftRef(__AP
+00014660: 495f 5261 6674 293a 0a20 2020 2022 2222  I_Raft):.    """
+00014670: 0a20 2020 2052 6566 6572 656e 6365 2074  .    Reference t
+00014680: 7970 6520 6f66 203a 636c 6173 733a 6049  ype of :class:`I
+00014690: 6e4d 656d 6f72 7952 6166 7460 2e0a 2020  nMemoryRaft`..  
+000146a0: 2020 2222 220a 0a20 2020 2064 6566 2067    """..    def g
+000146b0: 6574 5f72 6166 745f 6c6f 6728 7365 6c66  et_raft_log(self
+000146c0: 2920 2d3e 2022 496e 4d65 6d6f 7279 5261  ) -> "InMemoryRa
+000146d0: 6674 4c6f 6752 6566 223a 0a20 2020 2020  ftLogRef":.     
+000146e0: 2020 2022 2222 2022 2222 0a0a 636c 6173     """ """..clas
+000146f0: 7320 5261 6674 285f 5f41 5049 5f52 6166  s Raft(__API_Raf
+00014700: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
+00014710: 4120 7374 7275 6374 2074 6861 7420 7265  A struct that re
+00014720: 7072 6573 656e 7473 2074 6865 2072 6166  presents the raf
+00014730: 7420 636f 6e73 656e 7375 7320 6974 7365  t consensus itse
+00014740: 6c66 2e20 5374 6f72 6573 2064 6574 6169  lf. Stores detai
+00014750: 6c73 2063 6f6e 6365 726e 696e 6720 7468  ls concerning th
+00014760: 6520 6375 7272 656e 740a 2020 2020 616e  e current.    an
+00014770: 6420 706f 7373 6962 6c65 2073 7461 7465  d possible state
+00014780: 2074 6865 2073 7973 7465 6d20 6361 6e20   the system can 
+00014790: 7461 6b65 2e0a 2020 2020 2222 220a 0a20  take..    """.. 
+000147a0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+000147b0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000147c0: 2020 2020 2020 2063 6667 3a20 2243 6f6e         cfg: "Con
+000147d0: 6669 6722 207c 2022 436f 6e66 6967 5265  fig" | "ConfigRe
+000147e0: 6622 2c0a 2020 2020 2020 2020 7374 6f72  f",.        stor
+000147f0: 653a 2022 5374 6f72 6167 6522 207c 2022  e: "Storage" | "
+00014800: 5374 6f72 6167 6552 6566 222c 0a20 2020  StorageRef",.   
+00014810: 2020 2020 206c 6f67 6765 723a 2022 4c6f       logger: "Lo
+00014820: 6767 6572 2220 7c20 224c 6f67 6765 7252  gger" | "LoggerR
+00014830: 6566 222c 0a20 2020 2029 202d 3e20 4e6f  ef",.    ) -> No
+00014840: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
+00014850: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+00014860: 3e20 2252 6166 7452 6566 223a 202e 2e2e  > "RaftRef": ...
+00014870: 0a20 2020 2064 6566 2067 6574 5f72 6166  .    def get_raf
+00014880: 745f 6c6f 6728 7365 6c66 2920 2d3e 2022  t_log(self) -> "
+00014890: 5261 6674 4c6f 6752 6566 223a 0a20 2020  RaftLogRef":.   
+000148a0: 2020 2020 2022 2222 2022 2222 0a0a 636c       """ """..cl
+000148b0: 6173 7320 5261 6674 5265 6628 5f5f 4150  ass RaftRef(__AP
+000148c0: 495f 5261 6674 293a 0a20 2020 2022 2222  I_Raft):.    """
+000148d0: 0a20 2020 2052 6566 6572 656e 6365 2074  .    Reference t
+000148e0: 7970 6520 6f66 203a 636c 6173 733a 6052  ype of :class:`R
+000148f0: 6166 7460 2e0a 2020 2020 2222 220a 0a20  aft`..    """.. 
+00014900: 2020 2064 6566 2067 6574 5f72 6166 745f     def get_raft_
+00014910: 6c6f 6728 7365 6c66 2920 2d3e 2022 5261  log(self) -> "Ra
+00014920: 6674 4c6f 6752 6566 223a 0a20 2020 2020  ftLogRef":.     
+00014930: 2020 2022 2222 2022 2222 0a0a 636c 6173     """ """..clas
+00014940: 7320 5072 6f67 7265 7373 4d61 7049 7465  s ProgressMapIte
+00014950: 6d3a 0a20 2020 2064 6566 2069 6428 7365  m:.    def id(se
+00014960: 6c66 2920 2d3e 2069 6e74 3a20 2e2e 2e0a  lf) -> int: ....
+00014970: 2020 2020 6465 6620 7072 6f67 7265 7373      def progress
+00014980: 2873 656c 6629 202d 3e20 2250 726f 6772  (self) -> "Progr
+00014990: 6573 7322 3a20 2e2e 2e0a 0a63 6c61 7373  ess": .....class
+000149a0: 205f 5f41 5049 5f50 726f 6772 6573 7354   __API_ProgressT
+000149b0: 7261 636b 6572 285f 5f43 6c6f 6e65 6162  racker(__Cloneab
+000149c0: 6c65 293a 0a20 2020 2064 6566 2063 6c6f  le):.    def clo
+000149d0: 6e65 2873 656c 6629 202d 3e20 2250 726f  ne(self) -> "Pro
+000149e0: 6772 6573 7354 7261 636b 6572 223a 202e  gressTracker": .
+000149f0: 2e2e 0a20 2020 2064 6566 2067 6574 2873  ...    def get(s
+00014a00: 656c 662c 2069 643a 2069 6e74 2920 2d3e  elf, id: int) ->
+00014a10: 204f 7074 696f 6e61 6c5b 2250 726f 6772   Optional["Progr
+00014a20: 6573 7352 6566 225d 3a0a 2020 2020 2020  essRef"]:.      
+00014a30: 2020 2222 2222 2222 0a20 2020 2064 6566    """""".    def
+00014a40: 2067 726f 7570 5f63 6f6d 6d69 7428 7365   group_commit(se
+00014a50: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
+00014a60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00014a70: 2057 6865 7468 6572 2065 6e61 626c 6520   Whether enable 
+00014a80: 6772 6f75 7020 636f 6d6d 6974 2e0a 2020  group commit..  
+00014a90: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00014aa0: 6620 656e 6162 6c65 5f67 726f 7570 5f63  f enable_group_c
+00014ab0: 6f6d 6d69 7428 7365 6c66 2c20 656e 6162  ommit(self, enab
+00014ac0: 6c65 3a20 626f 6f6c 2920 2d3e 204e 6f6e  le: bool) -> Non
+00014ad0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00014ae0: 2020 2020 2020 2043 6f6e 6669 6775 7265         Configure
+00014af0: 7320 6772 6f75 7020 636f 6d6d 6974 2e0a  s group commit..
+00014b00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014b10: 6465 6620 6861 735f 7175 6f72 756d 2873  def has_quorum(s
+00014b20: 656c 662c 2070 6f74 656e 7469 616c 5f71  elf, potential_q
+00014b30: 756f 7275 6d3a 2053 6574 5b69 6e74 5d29  uorum: Set[int])
+00014b40: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00014b50: 2020 2222 220a 2020 2020 2020 2020 4465    """.        De
+00014b60: 7465 726d 696e 6520 6966 2061 2071 756f  termine if a quo
+00014b70: 7275 6d20 6973 2066 6f72 6d65 6420 6672  rum is formed fr
+00014b80: 6f6d 2074 6865 2067 6976 656e 2073 6574  om the given set
+00014b90: 206f 6620 6e6f 6465 732e 0a0a 2020 2020   of nodes...    
+00014ba0: 2020 2020 5468 6973 2069 7320 7468 6520      This is the 
+00014bb0: 6f6e 6c79 2063 6f72 7265 6374 2077 6179  only correct way
+00014bc0: 2074 6f20 7665 7269 6679 2079 6f75 2068   to verify you h
+00014bd0: 6176 6520 7265 6163 6865 6420 6120 7175  ave reached a qu
+00014be0: 6f72 756d 2066 6f72 2074 6865 2077 686f  orum for the who
+00014bf0: 6c65 2067 726f 7570 2e0a 2020 2020 2020  le group..      
+00014c00: 2020 2222 220a 2020 2020 6465 6620 6973    """.    def is
+00014c10: 5f73 696e 676c 6574 6f6e 2873 656c 6629  _singleton(self)
+00014c20: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00014c30: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+00014c40: 7475 726e 7320 7472 7565 2069 6620 2861  turns true if (a
+00014c50: 6e64 206f 6e6c 7920 6966 2920 7468 6572  nd only if) ther
+00014c60: 6520 6973 206f 6e6c 7920 6f6e 6520 766f  e is only one vo
+00014c70: 7469 6e67 206d 656d 6265 720a 2020 2020  ting member.    
+00014c80: 2020 2020 2869 2e65 2e20 7468 6520 6c65      (i.e. the le
+00014c90: 6164 6572 2920 696e 2074 6865 2063 7572  ader) in the cur
+00014ca0: 7265 6e74 2063 6f6e 6669 6775 7261 7469  rent configurati
+00014cb0: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
+00014cc0: 2020 2020 6465 6620 7175 6f72 756d 5f72      def quorum_r
+00014cd0: 6563 656e 746c 795f 6163 7469 7665 2873  ecently_active(s
+00014ce0: 656c 662c 2070 6572 7370 6563 7469 7665  elf, perspective
+00014cf0: 5f6f 663a 2069 6e74 2920 2d3e 2062 6f6f  _of: int) -> boo
+00014d00: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
+00014d10: 2020 2020 2020 2044 6574 6572 6d69 6e65         Determine
+00014d20: 7320 6966 2074 6865 2063 7572 7265 6e74  s if the current
+00014d30: 2071 756f 7275 6d20 6973 2061 6374 6976   quorum is activ
+00014d40: 6520 6163 636f 7264 696e 6720 746f 2074  e according to t
+00014d50: 6865 2074 6869 7320 7261 6674 206e 6f64  he this raft nod
+00014d60: 652e 0a20 2020 2020 2020 2044 6f69 6e67  e..        Doing
+00014d70: 2074 6869 7320 7769 6c6c 2073 6574 2074   this will set t
+00014d80: 6865 2060 7265 6365 6e74 5f61 6374 6976  he `recent_activ
+00014d90: 6560 206f 6620 6561 6368 2070 6565 7220  e` of each peer 
+00014da0: 746f 2066 616c 7365 2e0a 0a20 2020 2020  to false...     
+00014db0: 2020 2054 6869 7320 7368 6f75 6c64 206f     This should o
+00014dc0: 6e6c 7920 6265 2063 616c 6c65 6420 6279  nly be called by
+00014dd0: 2074 6865 206c 6561 6465 722e 0a20 2020   the leader..   
+00014de0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00014df0: 206d 6178 696d 616c 5f63 6f6d 6d69 7474   maximal_committ
+00014e00: 6564 5f69 6e64 6578 2873 656c 6629 202d  ed_index(self) -
+00014e10: 3e20 5475 706c 655b 696e 742c 2062 6f6f  > Tuple[int, boo
+00014e20: 6c5d 3a0a 2020 2020 2020 2020 2222 220a  l]:.        """.
+00014e30: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+00014e40: 7468 6520 6d61 7869 6d61 6c20 636f 6d6d  the maximal comm
+00014e50: 6974 7465 6420 696e 6465 7820 666f 7220  itted index for 
+00014e60: 7468 6520 636c 7573 7465 722e 2054 6865  the cluster. The
+00014e70: 2062 6f6f 6c20 666c 6167 2069 6e64 6963   bool flag indic
+00014e80: 6174 6573 2077 6865 7468 6572 0a20 2020  ates whether.   
+00014e90: 2020 2020 2074 6865 2069 6e64 6578 2069       the index i
+00014ea0: 7320 636f 6d70 7574 6564 2062 7920 6772  s computed by gr
+00014eb0: 6f75 7020 636f 6d6d 6974 2061 6c67 6f72  oup commit algor
+00014ec0: 6974 686d 2073 7563 6365 7373 6675 6c6c  ithm successfull
+00014ed0: 790a 0a20 2020 2020 2020 2045 672e 2049  y..        Eg. I
+00014ee0: 6620 7468 6520 6d61 7463 6865 6420 696e  f the matched in
+00014ef0: 6465 7865 7320 6172 6520 605b 322c 322c  dexes are `[2,2,
+00014f00: 322c 342c 355d 602c 2069 7420 7769 6c6c  2,4,5]`, it will
+00014f10: 2072 6574 7572 6e20 6032 602e 0a20 2020   return `2`..   
+00014f20: 2020 2020 2049 6620 7468 6520 6d61 7463       If the matc
+00014f30: 6865 6420 696e 6465 7865 7320 616e 6420  hed indexes and 
+00014f40: 6772 6f75 7073 2061 7265 2060 5b28 312c  groups are `[(1,
+00014f50: 2031 292c 2028 322c 2032 292c 2028 332c   1), (2, 2), (3,
+00014f60: 2032 295d 602c 2069 7420 7769 6c6c 2072   2)]`, it will r
+00014f70: 6574 7572 6e20 6031 602e 0a20 2020 2020  eturn `1`..     
+00014f80: 2020 2022 2222 0a20 2020 2064 6566 2072     """.    def r
+00014f90: 6563 6f72 645f 766f 7465 2873 656c 662c  ecord_vote(self,
+00014fa0: 2069 643a 2069 6e74 2c20 766f 7465 3a20   id: int, vote: 
+00014fb0: 626f 6f6c 2920 2d3e 204e 6f6e 653a 0a20  bool) -> None:. 
+00014fc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014fd0: 2020 2052 6563 6f72 6473 2074 6861 7420     Records that 
+00014fe0: 7468 6520 6e6f 6465 2077 6974 6820 7468  the node with th
+00014ff0: 6520 6769 7665 6e20 6964 2076 6f74 6564  e given id voted
+00015000: 2066 6f72 2074 6869 7320 5261 6674 0a20   for this Raft. 
+00015010: 2020 2020 2020 2069 6e73 7461 6e63 6520         instance 
+00015020: 6966 2076 203d 3d20 7472 7565 2028 616e  if v == true (an
+00015030: 6420 6465 636c 696e 6564 2069 7420 6f74  d declined it ot
+00015040: 6865 7277 6973 6529 2e0a 2020 2020 2020  herwise)..      
+00015050: 2020 2222 220a 2020 2020 6465 6620 7265    """.    def re
+00015060: 7365 745f 766f 7465 7328 7365 6c66 2920  set_votes(self) 
+00015070: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00015080: 2022 2222 0a20 2020 2020 2020 2050 7265   """.        Pre
+00015090: 7061 7265 7320 666f 7220 6120 6e65 7720  pares for a new 
+000150a0: 726f 756e 6420 6f66 2076 6f74 6520 636f  round of vote co
+000150b0: 756e 7469 6e67 2076 6961 2072 6563 6f72  unting via recor
+000150c0: 6456 6f74 652e 0a20 2020 2020 2020 2022  dVote..        "
+000150d0: 2222 0a20 2020 2064 6566 2063 6f6e 665f  "".    def conf_
+000150e0: 766f 7465 7273 2873 656c 6629 202d 3e20  voters(self) -> 
+000150f0: 224a 6f69 6e74 436f 6e66 6967 5265 6622  "JointConfigRef"
+00015100: 3a0a 2020 2020 2020 2020 2222 2220 2222  :.        """ ""
+00015110: 220a 2020 2020 6465 6620 636f 6e66 5f6c  ".    def conf_l
+00015120: 6561 726e 6572 7328 7365 6c66 2920 2d3e  earners(self) ->
+00015130: 2053 6574 5b69 6e74 5d3a 0a20 2020 2020   Set[int]:.     
+00015140: 2020 2022 2222 2022 2222 0a20 2020 2064     """ """.    d
+00015150: 6566 2063 6f6c 6c65 6374 2873 656c 6629  ef collect(self)
+00015160: 202d 3e20 4c69 7374 5b22 5072 6f67 7265   -> List["Progre
+00015170: 7373 4d61 7049 7465 6d22 5d3a 0a20 2020  ssMapItem"]:.   
+00015180: 2020 2020 2022 2222 2022 2222 0a0a 636c       """ """..cl
+00015190: 6173 7320 5072 6f67 7265 7373 5472 6163  ass ProgressTrac
+000151a0: 6b65 7228 5f5f 4150 495f 5072 6f67 7265  ker(__API_Progre
+000151b0: 7373 5472 6163 6b65 7229 3a0a 2020 2020  ssTracker):.    
+000151c0: 2222 220a 2020 2020 6050 726f 6772 6573  """.    `Progres
+000151d0: 7354 7261 636b 6572 6020 636f 6e74 6169  sTracker` contai
+000151e0: 6e73 2073 6576 6572 616c 2060 5072 6f67  ns several `Prog
+000151f0: 7265 7373 6065 732c 0a20 2020 2077 6869  ress`es,.    whi
+00015200: 6368 2063 6f75 6c64 2062 6520 604c 6561  ch could be `Lea
+00015210: 6465 7260 2c20 6046 6f6c 6c6f 7765 7260  der`, `Follower`
+00015220: 2061 6e64 2060 4c65 6172 6e65 7260 2e0a   and `Learner`..
+00015230: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00015240: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00015250: 6d61 785f 696e 666c 6967 6874 3a20 696e  max_inflight: in
+00015260: 7429 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a  t) -> None: ....
+00015270: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
+00015280: 2873 656c 6629 202d 3e20 2250 726f 6772  (self) -> "Progr
+00015290: 6573 7354 7261 636b 6572 5265 6622 3a20  essTrackerRef": 
+000152a0: 2e2e 2e0a 0a63 6c61 7373 2050 726f 6772  .....class Progr
+000152b0: 6573 7354 7261 636b 6572 5265 6628 5f5f  essTrackerRef(__
+000152c0: 4150 495f 5072 6f67 7265 7373 5472 6163  API_ProgressTrac
+000152d0: 6b65 7229 3a0a 2020 2020 2222 220a 2020  ker):.    """.  
+000152e0: 2020 5265 6665 7265 6e63 6520 7479 7065    Reference type
+000152f0: 206f 6620 3a63 6c61 7373 3a60 5072 6f67   of :class:`Prog
+00015300: 7265 7373 5472 6163 6b65 7260 2e0a 2020  ressTracker`..  
+00015310: 2020 2222 220a 0a63 6c61 7373 205f 5f41    """..class __A
+00015320: 5049 5f50 726f 6772 6573 7328 5f5f 436c  PI_Progress(__Cl
+00015330: 6f6e 6561 626c 6529 3a0a 2020 2020 6465  oneable):.    de
+00015340: 6620 636c 6f6e 6528 7365 6c66 2920 2d3e  f clone(self) ->
+00015350: 2022 5072 6f67 7265 7373 223a 202e 2e2e   "Progress": ...
+00015360: 0a20 2020 2064 6566 2062 6563 6f6d 655f  .    def become_
+00015370: 7072 6f62 6528 7365 6c66 2920 2d3e 204e  probe(self) -> N
+00015380: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00015390: 4368 616e 6765 7320 7468 6520 7072 6f67  Changes the prog
+000153a0: 7265 7373 2074 6f20 6120 7072 6f62 652e  ress to a probe.
+000153b0: 2222 220a 2020 2020 6465 6620 6265 636f  """.    def beco
+000153c0: 6d65 5f72 6570 6c69 6361 7465 2873 656c  me_replicate(sel
+000153d0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+000153e0: 2020 2020 2222 2243 6861 6e67 6573 2074      """Changes t
+000153f0: 6865 2070 726f 6772 6573 7320 746f 2061  he progress to a
+00015400: 2052 6570 6c69 6361 7465 2e22 2222 0a20   Replicate.""". 
+00015410: 2020 2064 6566 2062 6563 6f6d 655f 736e     def become_sn
+00015420: 6170 7368 6f74 2873 656c 662c 2073 6e61  apshot(self, sna
+00015430: 7073 686f 745f 6964 783a 2069 6e74 2920  pshot_idx: int) 
+00015440: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00015450: 2022 2222 4368 616e 6765 7320 7468 6520   """Changes the 
+00015460: 7072 6f67 7265 7373 2074 6f20 6120 736e  progress to a sn
+00015470: 6170 7368 6f74 2e22 2222 0a20 2020 2064  apshot.""".    d
+00015480: 6566 206d 6179 6265 5f75 7064 6174 6528  ef maybe_update(
+00015490: 7365 6c66 2c20 6e3a 2069 6e74 2920 2d3e  self, n: int) ->
+000154a0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+000154b0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+000154c0: 6e73 2066 616c 7365 2069 6620 7468 6520  ns false if the 
+000154d0: 6769 7665 6e20 6e20 696e 6465 7820 636f  given n index co
+000154e0: 6d65 7320 6672 6f6d 2061 6e20 6f75 7464  mes from an outd
+000154f0: 6174 6564 206d 6573 7361 6765 2e0a 2020  ated message..  
+00015500: 2020 2020 2020 4f74 6865 7277 6973 6520        Otherwise 
+00015510: 6974 2075 7064 6174 6573 2074 6865 2070  it updates the p
+00015520: 726f 6772 6573 7320 616e 6420 7265 7475  rogress and retu
+00015530: 726e 7320 7472 7565 2e0a 2020 2020 2020  rns true..      
+00015540: 2020 2222 220a 2020 2020 6465 6620 6d61    """.    def ma
+00015550: 7962 655f 6465 6372 5f74 6f28 0a20 2020  ybe_decr_to(.   
+00015560: 2020 2020 2073 656c 662c 2072 656a 6563       self, rejec
+00015570: 7465 643a 2069 6e74 2c20 6d61 7463 685f  ted: int, match_
+00015580: 6869 6e74 3a20 696e 742c 2072 6571 7565  hint: int, reque
+00015590: 7374 5f73 6e61 7073 686f 743a 2069 6e74  st_snapshot: int
+000155a0: 0a20 2020 2029 202d 3e20 626f 6f6c 3a0a  .    ) -> bool:.
+000155b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000155c0: 2020 2020 5265 7475 726e 7320 6661 6c73      Returns fals
+000155d0: 6520 6966 2074 6865 2067 6976 656e 2069  e if the given i
+000155e0: 6e64 6578 2063 6f6d 6573 2066 726f 6d20  ndex comes from 
+000155f0: 616e 206f 7574 206f 6620 6f72 6465 7220  an out of order 
+00015600: 6d65 7373 6167 652e 0a20 2020 2020 2020  message..       
+00015610: 204f 7468 6572 7769 7365 2069 7420 6465   Otherwise it de
+00015620: 6372 6561 7365 7320 7468 6520 7072 6f67  creases the prog
+00015630: 7265 7373 206e 6578 7420 696e 6465 7820  ress next index 
+00015640: 746f 206d 696e 2872 656a 6563 7465 642c  to min(rejected,
+00015650: 206c 6173 7429 0a20 2020 2020 2020 2061   last).        a
+00015660: 6e64 2072 6574 7572 6e73 2074 7275 652e  nd returns true.
+00015670: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00015680: 2064 6566 2073 6e61 7073 686f 745f 6661   def snapshot_fa
+00015690: 696c 7572 6528 7365 6c66 2920 2d3e 204e  ilure(self) -> N
+000156a0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000156b0: 0a20 2020 2020 2020 2053 6574 7320 7468  .        Sets th
+000156c0: 6520 736e 6170 7368 6f74 2074 6f20 6661  e snapshot to fa
+000156d0: 696c 7572 652e 0a20 2020 2020 2020 2022  ilure..        "
+000156e0: 2222 0a20 2020 2064 6566 2070 6175 7365  "".    def pause
+000156f0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00015700: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015710: 2020 2020 5061 7573 6520 7072 6f67 7265      Pause progre
+00015720: 7373 2e0a 2020 2020 2020 2020 2222 220a  ss..        """.
+00015730: 2020 2020 6465 6620 6973 5f70 6175 7365      def is_pause
+00015740: 6428 7365 6c66 2920 2d3e 2062 6f6f 6c3a  d(self) -> bool:
+00015750: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00015760: 2020 2020 2044 6574 6572 6d69 6e65 2077       Determine w
+00015770: 6865 7468 6572 2070 726f 6772 6573 7320  hether progress 
+00015780: 6973 2070 6175 7365 642e 0a20 2020 2020  is paused..     
+00015790: 2020 2022 2222 0a20 2020 2064 6566 2069     """.    def i
+000157a0: 735f 736e 6170 7368 6f74 5f63 6175 6768  s_snapshot_caugh
+000157b0: 745f 7570 2873 656c 6629 202d 3e20 626f  t_up(self) -> bo
+000157c0: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
+000157d0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+000157e0: 7472 7565 2069 6620 4d61 7463 6820 6973  true if Match is
+000157f0: 2065 7175 616c 206f 7220 6869 6768 6572   equal or higher
+00015800: 2074 6861 6e20 7468 6520 7065 6e64 696e   than the pendin
+00015810: 6753 6e61 7073 686f 742e 0a20 2020 2020  gSnapshot..     
+00015820: 2020 2022 2222 0a20 2020 2064 6566 2072     """.    def r
+00015830: 6573 756d 6528 7365 6c66 2920 2d3e 204e  esume(self) -> N
+00015840: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00015850: 0a20 2020 2020 2020 2052 6573 756d 6520  .        Resume 
+00015860: 7072 6f67 7265 7373 0a20 2020 2020 2020  progress.       
+00015870: 2022 2222 0a20 2020 2064 6566 2075 7064   """.    def upd
+00015880: 6174 655f 7374 6174 6528 7365 6c66 2c20  ate_state(self, 
+00015890: 6c61 7374 3a20 696e 7429 202d 3e20 4e6f  last: int) -> No
+000158a0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+000158b0: 2020 2020 2020 2020 5570 6461 7465 2069          Update i
+000158c0: 6e66 6c69 6768 7420 6d73 6773 2061 6e64  nflight msgs and
+000158d0: 206e 6578 745f 6964 780a 2020 2020 2020   next_idx.      
+000158e0: 2020 2222 220a 2020 2020 6465 6620 7570    """.    def up
+000158f0: 6461 7465 5f63 6f6d 6d69 7474 6564 2873  date_committed(s
+00015900: 656c 662c 2063 6f6d 6d69 7474 6564 5f69  elf, committed_i
+00015910: 6e64 6578 3a20 696e 7429 202d 3e20 4e6f  ndex: int) -> No
+00015920: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00015930: 2020 2020 2020 2020 5570 6461 7465 2063          Update c
+00015940: 6f6d 6d69 7474 6564 5f69 6e64 6578 2e0a  ommitted_index..
+00015950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015960: 6465 6620 6f70 7469 6d69 7374 6963 5f75  def optimistic_u
+00015970: 7064 6174 6528 7365 6c66 2c20 6e3a 2069  pdate(self, n: i
+00015980: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
+00015990: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000159a0: 204f 7074 696d 6973 7469 6361 6c6c 7920   Optimistically 
+000159b0: 6164 7661 6e63 6520 7468 6520 696e 6465  advance the inde
+000159c0: 780a 2020 2020 2020 2020 2222 220a 2020  x.        """.  
+000159d0: 2020 6465 6620 6765 745f 696e 7328 7365    def get_ins(se
+000159e0: 6c66 2920 2d3e 2022 496e 666c 6967 6874  lf) -> "Inflight
+000159f0: 7352 6566 223a 0a20 2020 2020 2020 2022  sRef":.        "
+00015a00: 2222 0a20 2020 2020 2020 2060 696e 7360  "".        `ins`
+00015a10: 3a20 496e 666c 6967 6874 7320 6973 2061  : Inflights is a
+00015a20: 2073 6c69 6469 6e67 2077 696e 646f 7720   sliding window 
+00015a30: 666f 7220 7468 6520 696e 666c 6967 6874  for the inflight
+00015a40: 206d 6573 7361 6765 732e 0a20 2020 2020   messages..     
+00015a50: 2020 2057 6865 6e20 696e 666c 6967 6874     When inflight
+00015a60: 7320 6973 2066 756c 6c2c 206e 6f20 6d6f  s is full, no mo
+00015a70: 7265 206d 6573 7361 6765 2073 686f 756c  re message shoul
+00015a80: 6420 6265 2073 656e 742e 0a20 2020 2020  d be sent..     
+00015a90: 2020 2057 6865 6e20 6120 6c65 6164 6572     When a leader
+00015aa0: 2073 656e 6473 206f 7574 2061 206d 6573   sends out a mes
+00015ab0: 7361 6765 2c20 7468 6520 696e 6465 7820  sage, the index 
+00015ac0: 6f66 2074 6865 206c 6173 740a 2020 2020  of the last.    
+00015ad0: 2020 2020 656e 7472 7920 7368 6f75 6c64      entry should
+00015ae0: 2062 6520 6164 6465 6420 746f 2069 6e66   be added to inf
+00015af0: 6c69 6768 7473 2e20 5468 6520 696e 6465  lights. The inde
+00015b00: 7820 4d55 5354 2062 6520 6164 6465 640a  x MUST be added.
+00015b10: 2020 2020 2020 2020 696e 746f 2069 6e66          into inf
+00015b20: 6c69 6768 7473 2069 6e20 6f72 6465 722e  lights in order.
+00015b30: 0a20 2020 2020 2020 2057 6865 6e20 6120  .        When a 
+00015b40: 6c65 6164 6572 2072 6563 6569 7665 7320  leader receives 
+00015b50: 6120 7265 706c 792c 2074 6865 2070 7265  a reply, the pre
+00015b60: 7669 6f75 7320 696e 666c 6967 6874 7320  vious inflights 
+00015b70: 7368 6f75 6c64 0a20 2020 2020 2020 2062  should.        b
+00015b80: 6520 6672 6565 6420 6279 2063 616c 6c69  e freed by calli
+00015b90: 6e67 2069 6e66 6c69 6768 7473 2e66 7265  ng inflights.fre
+00015ba0: 6554 6f2e 0a20 2020 2020 2020 2022 2222  eTo..        """
+00015bb0: 0a20 2020 2064 6566 2073 6574 5f69 6e73  .    def set_ins
+00015bc0: 2873 656c 662c 2069 6e66 6c69 6768 7473  (self, inflights
+00015bd0: 3a20 2249 6e66 6c69 6768 7473 2220 7c20  : "Inflights" | 
+00015be0: 2249 6e66 6c69 6768 7473 5265 6622 2920  "InflightsRef") 
+00015bf0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00015c00: 2022 2222 0a20 2020 2020 2020 2060 696e   """.        `in
+00015c10: 7360 3a20 496e 666c 6967 6874 7320 6973  s`: Inflights is
+00015c20: 2061 2073 6c69 6469 6e67 2077 696e 646f   a sliding windo
+00015c30: 7720 666f 7220 7468 6520 696e 666c 6967  w for the inflig
+00015c40: 6874 206d 6573 7361 6765 732e 0a20 2020  ht messages..   
+00015c50: 2020 2020 2057 6865 6e20 696e 666c 6967       When inflig
+00015c60: 6874 7320 6973 2066 756c 6c2c 206e 6f20  hts is full, no 
+00015c70: 6d6f 7265 206d 6573 7361 6765 2073 686f  more message sho
+00015c80: 756c 6420 6265 2073 656e 742e 0a20 2020  uld be sent..   
+00015c90: 2020 2020 2057 6865 6e20 6120 6c65 6164       When a lead
+00015ca0: 6572 2073 656e 6473 206f 7574 2061 206d  er sends out a m
+00015cb0: 6573 7361 6765 2c20 7468 6520 696e 6465  essage, the inde
+00015cc0: 7820 6f66 2074 6865 206c 6173 740a 2020  x of the last.  
+00015cd0: 2020 2020 2020 656e 7472 7920 7368 6f75        entry shou
+00015ce0: 6c64 2062 6520 6164 6465 6420 746f 2069  ld be added to i
+00015cf0: 6e66 6c69 6768 7473 2e20 5468 6520 696e  nflights. The in
+00015d00: 6465 7820 4d55 5354 2062 6520 6164 6465  dex MUST be adde
+00015d10: 640a 2020 2020 2020 2020 696e 746f 2069  d.        into i
+00015d20: 6e66 6c69 6768 7473 2069 6e20 6f72 6465  nflights in orde
+00015d30: 722e 0a20 2020 2020 2020 2057 6865 6e20  r..        When 
+00015d40: 6120 6c65 6164 6572 2072 6563 6569 7665  a leader receive
+00015d50: 7320 6120 7265 706c 792c 2074 6865 2070  s a reply, the p
+00015d60: 7265 7669 6f75 7320 696e 666c 6967 6874  revious inflight
+00015d70: 7320 7368 6f75 6c64 0a20 2020 2020 2020  s should.       
+00015d80: 2062 6520 6672 6565 6420 6279 2063 616c   be freed by cal
+00015d90: 6c69 6e67 2069 6e66 6c69 6768 7473 2e66  ling inflights.f
+00015da0: 7265 6554 6f2e 0a20 2020 2020 2020 2022  reeTo..        "
+00015db0: 2222 0a20 2020 2064 6566 2067 6574 5f63  "".    def get_c
+00015dc0: 6f6d 6d69 745f 6772 6f75 705f 6964 2873  ommit_group_id(s
+00015dd0: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+00015de0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00015df0: 2060 636f 6d6d 6974 5f67 726f 7570 5f69   `commit_group_i
+00015e00: 6460 3a20 4f6e 6c79 206c 6f67 7320 7265  d`: Only logs re
+00015e10: 706c 6963 6174 6564 2074 6f20 6469 6666  plicated to diff
+00015e20: 6572 656e 7420 6772 6f75 7020 7769 6c6c  erent group will
+00015e30: 2062 6520 636f 6d6d 6974 7465 6420 6966   be committed if
+00015e40: 2061 6e79 2067 726f 7570 2069 7320 636f   any group is co
+00015e50: 6e66 6967 7572 6564 2e0a 2020 2020 2020  nfigured..      
+00015e60: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+00015e70: 745f 636f 6d6d 6974 5f67 726f 7570 5f69  t_commit_group_i
+00015e80: 6428 7365 6c66 2c20 636f 6d6d 6974 5f67  d(self, commit_g
+00015e90: 726f 7570 5f69 643a 2069 6e74 2920 2d3e  roup_id: int) ->
+00015ea0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00015eb0: 2222 0a20 2020 2020 2020 2060 636f 6d6d  "".        `comm
+00015ec0: 6974 5f67 726f 7570 5f69 6460 3a20 4f6e  it_group_id`: On
+00015ed0: 6c79 206c 6f67 7320 7265 706c 6963 6174  ly logs replicat
+00015ee0: 6564 2074 6f20 6469 6666 6572 656e 7420  ed to different 
+00015ef0: 6772 6f75 7020 7769 6c6c 2062 6520 636f  group will be co
+00015f00: 6d6d 6974 7465 6420 6966 2061 6e79 2067  mmitted if any g
+00015f10: 726f 7570 2069 7320 636f 6e66 6967 7572  roup is configur
+00015f20: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+00015f30: 2020 2020 6465 6620 6765 745f 636f 6d6d      def get_comm
+00015f40: 6974 7465 645f 696e 6465 7828 7365 6c66  itted_index(self
+00015f50: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+00015f60: 2020 2222 220a 2020 2020 2020 2020 6063    """.        `c
+00015f70: 6f6d 6d69 7474 6564 5f69 6e64 6578 603a  ommitted_index`:
+00015f80: 2043 6f6d 6d69 7474 6564 2069 6e64 6578   Committed index
+00015f90: 2069 6e20 7261 6674 5f6c 6f67 0a20 2020   in raft_log.   
+00015fa0: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00015fb0: 2073 6574 5f63 6f6d 6d69 7474 6564 5f69   set_committed_i
+00015fc0: 6e64 6578 2873 656c 662c 2063 6f6d 6d69  ndex(self, commi
+00015fd0: 7474 6564 5f69 6e64 6578 3a20 696e 7429  tted_index: int)
+00015fe0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00015ff0: 2020 2222 220a 2020 2020 2020 2020 6063    """.        `c
+00016000: 6f6d 6d69 7474 6564 5f69 6e64 6578 603a  ommitted_index`:
+00016010: 2043 6f6d 6d69 7474 6564 2069 6e64 6578   Committed index
+00016020: 2069 6e20 7261 6674 5f6c 6f67 0a20 2020   in raft_log.   
+00016030: 2020 2020 2022 2222 0a20 2020 2064 6566       """.    def
+00016040: 2067 6574 5f6d 6174 6368 6564 2873 656c   get_matched(sel
+00016050: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00016060: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00016070: 6d61 7463 6865 6460 3a20 486f 7720 6d75  matched`: How mu
+00016080: 6368 2073 7461 7465 2069 7320 6d61 7463  ch state is matc
+00016090: 6865 642e 0a20 2020 2020 2020 2022 2222  hed..        """
+000160a0: 0a20 2020 2064 6566 2073 6574 5f6d 6174  .    def set_mat
+000160b0: 6368 6564 2873 656c 662c 206d 6174 6368  ched(self, match
+000160c0: 6564 3a20 696e 7429 202d 3e20 4e6f 6e65  ed: int) -> None
+000160d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000160e0: 2020 2020 2020 606d 6174 6368 6564 603a        `matched`:
+000160f0: 2048 6f77 206d 7563 6820 7374 6174 6520   How much state 
+00016100: 6973 206d 6174 6368 6564 2e0a 2020 2020  is matched..    
+00016110: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00016120: 6765 745f 6e65 7874 5f69 6478 2873 656c  get_next_idx(sel
+00016130: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00016140: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00016150: 6e65 7874 5f69 6478 603a 2054 6865 206e  next_idx`: The n
+00016160: 6578 7420 696e 6465 7820 746f 2061 7070  ext index to app
+00016170: 6c79 0a20 2020 2020 2020 2022 2222 0a20  ly.        """. 
+00016180: 2020 2064 6566 2073 6574 5f6e 6578 745f     def set_next_
+00016190: 6964 7828 7365 6c66 2c20 6e65 7874 5f69  idx(self, next_i
+000161a0: 6478 3a20 696e 7429 202d 3e20 4e6f 6e65  dx: int) -> None
+000161b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000161c0: 2020 2020 2020 606e 6578 745f 6964 7860        `next_idx`
+000161d0: 3a20 5468 6520 6e65 7874 2069 6e64 6578  : The next index
+000161e0: 2074 6f20 6170 706c 790a 2020 2020 2020   to apply.      
+000161f0: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
+00016200: 745f 7065 6e64 696e 675f 736e 6170 7368  t_pending_snapsh
+00016210: 6f74 2873 656c 6629 202d 3e20 696e 743a  ot(self) -> int:
+00016220: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00016230: 2020 2020 2060 7065 6e64 696e 675f 736e       `pending_sn
+00016240: 6170 7368 6f74 603a 2054 6869 7320 6669  apshot`: This fi
+00016250: 656c 6420 6973 2075 7365 6420 696e 2050  eld is used in P
+00016260: 726f 6772 6573 7353 7461 7465 536e 6170  rogressStateSnap
+00016270: 7368 6f74 2e0a 2020 2020 2020 2020 4966  shot..        If
+00016280: 2074 6865 7265 2069 7320 6120 7065 6e64   there is a pend
+00016290: 696e 6720 736e 6170 7368 6f74 2c20 7468  ing snapshot, th
+000162a0: 6520 7065 6e64 696e 6753 6e61 7073 686f  e pendingSnapsho
+000162b0: 7420 7769 6c6c 2062 6520 7365 7420 746f  t will be set to
+000162c0: 2074 6865 0a20 2020 2020 2020 2069 6e64   the.        ind
+000162d0: 6578 206f 6620 7468 6520 736e 6170 7368  ex of the snapsh
+000162e0: 6f74 2e20 4966 2070 656e 6469 6e67 536e  ot. If pendingSn
+000162f0: 6170 7368 6f74 2069 7320 7365 742c 2074  apshot is set, t
+00016300: 6865 2072 6570 6c69 6361 7469 6f6e 2070  he replication p
+00016310: 726f 6365 7373 206f 660a 2020 2020 2020  rocess of.      
+00016320: 2020 7468 6973 2050 726f 6772 6573 7320    this Progress 
+00016330: 7769 6c6c 2062 6520 7061 7573 6564 2e20  will be paused. 
+00016340: 7261 6674 2077 696c 6c20 6e6f 7420 7265  raft will not re
+00016350: 7365 6e64 2073 6e61 7073 686f 7420 756e  send snapshot un
+00016360: 7469 6c20 7468 6520 7065 6e64 696e 6720  til the pending 
+00016370: 6f6e 650a 2020 2020 2020 2020 6973 2072  one.        is r
+00016380: 6570 6f72 7465 6420 746f 2062 6520 6661  eported to be fa
+00016390: 696c 6564 2e0a 2020 2020 2020 2020 2222  iled..        ""
+000163a0: 220a 2020 2020 6465 6620 7365 745f 7065  ".    def set_pe
+000163b0: 6e64 696e 675f 736e 6170 7368 6f74 2873  nding_snapshot(s
+000163c0: 656c 662c 2070 656e 6469 6e67 5f73 6e61  elf, pending_sna
+000163d0: 7073 686f 743a 2069 6e74 2920 2d3e 204e  pshot: int) -> N
+000163e0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000163f0: 0a20 2020 2020 2020 2060 7065 6e64 696e  .        `pendin
+00016400: 675f 736e 6170 7368 6f74 603a 2054 6869  g_snapshot`: Thi
+00016410: 7320 6669 656c 6420 6973 2075 7365 6420  s field is used 
+00016420: 696e 2050 726f 6772 6573 7353 7461 7465  in ProgressState
+00016430: 536e 6170 7368 6f74 2e0a 2020 2020 2020  Snapshot..      
+00016440: 2020 4966 2074 6865 7265 2069 7320 6120    If there is a 
+00016450: 7065 6e64 696e 6720 736e 6170 7368 6f74  pending snapshot
+00016460: 2c20 7468 6520 7065 6e64 696e 6753 6e61  , the pendingSna
+00016470: 7073 686f 7420 7769 6c6c 2062 6520 7365  pshot will be se
+00016480: 7420 746f 2074 6865 0a20 2020 2020 2020  t to the.       
+00016490: 2069 6e64 6578 206f 6620 7468 6520 736e   index of the sn
+000164a0: 6170 7368 6f74 2e20 4966 2070 656e 6469  apshot. If pendi
+000164b0: 6e67 536e 6170 7368 6f74 2069 7320 7365  ngSnapshot is se
+000164c0: 742c 2074 6865 2072 6570 6c69 6361 7469  t, the replicati
+000164d0: 6f6e 2070 726f 6365 7373 206f 660a 2020  on process of.  
+000164e0: 2020 2020 2020 7468 6973 2050 726f 6772        this Progr
+000164f0: 6573 7320 7769 6c6c 2062 6520 7061 7573  ess will be paus
+00016500: 6564 2e20 7261 6674 2077 696c 6c20 6e6f  ed. raft will no
+00016510: 7420 7265 7365 6e64 2073 6e61 7073 686f  t resend snapsho
+00016520: 7420 756e 7469 6c20 7468 6520 7065 6e64  t until the pend
+00016530: 696e 6720 6f6e 650a 2020 2020 2020 2020  ing one.        
+00016540: 6973 2072 6570 6f72 7465 6420 746f 2062  is reported to b
+00016550: 6520 6661 696c 6564 2e0a 2020 2020 2020  e failed..      
+00016560: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
+00016570: 745f 7065 6e64 696e 675f 7265 7175 6573  t_pending_reques
+00016580: 745f 736e 6170 7368 6f74 2873 656c 6629  t_snapshot(self)
+00016590: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+000165a0: 2022 2222 0a20 2020 2020 2020 2060 7065   """.        `pe
+000165b0: 6e64 696e 675f 7265 7175 6573 745f 736e  nding_request_sn
+000165c0: 6170 7368 6f74 603a 2054 6869 7320 6669  apshot`: This fi
+000165d0: 656c 6420 6973 2075 7365 6420 696e 2072  eld is used in r
+000165e0: 6571 7565 7374 2073 6e61 7073 686f 742e  equest snapshot.
+000165f0: 0a20 2020 2020 2020 2049 6620 7468 6572  .        If ther
+00016600: 6520 6973 2061 2070 656e 6469 6e67 2072  e is a pending r
+00016610: 6571 7565 7374 2073 6e61 7073 686f 742c  equest snapshot,
+00016620: 2074 6869 7320 7769 6c6c 2062 6520 7365   this will be se
+00016630: 7420 746f 2074 6865 2072 6571 7565 7374  t to the request
+00016640: 0a20 2020 2020 2020 2069 6e64 6578 206f  .        index o
+00016650: 6620 7468 6520 736e 6170 7368 6f74 2e0a  f the snapshot..
+00016660: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016670: 6465 6620 7365 745f 7065 6e64 696e 675f  def set_pending_
+00016680: 7265 7175 6573 745f 736e 6170 7368 6f74  request_snapshot
+00016690: 2873 656c 662c 2070 656e 6469 6e67 5f72  (self, pending_r
+000166a0: 6571 7565 7374 5f73 6e61 7073 686f 743a  equest_snapshot:
+000166b0: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
+000166c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000166d0: 2020 2060 7065 6e64 696e 675f 7265 7175     `pending_requ
+000166e0: 6573 745f 736e 6170 7368 6f74 603a 2054  est_snapshot`: T
+000166f0: 6869 7320 6669 656c 6420 6973 2075 7365  his field is use
+00016700: 6420 696e 2072 6571 7565 7374 2073 6e61  d in request sna
+00016710: 7073 686f 742e 0a20 2020 2020 2020 2049  pshot..        I
+00016720: 6620 7468 6572 6520 6973 2061 2070 656e  f there is a pen
+00016730: 6469 6e67 2072 6571 7565 7374 2073 6e61  ding request sna
+00016740: 7073 686f 742c 2074 6869 7320 7769 6c6c  pshot, this will
+00016750: 2062 6520 7365 7420 746f 2074 6865 2072   be set to the r
+00016760: 6571 7565 7374 0a20 2020 2020 2020 2069  equest.        i
+00016770: 6e64 6578 206f 6620 7468 6520 736e 6170  ndex of the snap
+00016780: 7368 6f74 2e0a 2020 2020 2020 2020 2222  shot..        ""
+00016790: 220a 2020 2020 6465 6620 6765 745f 7265  ".    def get_re
+000167a0: 6365 6e74 5f61 6374 6976 6528 7365 6c66  cent_active(self
+000167b0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+000167c0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+000167d0: 7265 6365 6e74 5f61 6374 6976 6560 3a20  recent_active`: 
+000167e0: 5468 6973 2069 7320 7472 7565 2069 6620  This is true if 
+000167f0: 7468 6520 7072 6f67 7265 7373 2069 7320  the progress is 
+00016800: 7265 6365 6e74 6c79 2061 6374 6976 652e  recently active.
+00016810: 2052 6563 6569 7669 6e67 2061 6e79 206d   Receiving any m
+00016820: 6573 7361 6765 730a 2020 2020 2020 2020  essages.        
+00016830: 6672 6f6d 2074 6865 2063 6f72 7265 7370  from the corresp
+00016840: 6f6e 6469 6e67 2066 6f6c 6c6f 7765 7220  onding follower 
+00016850: 696e 6469 6361 7465 7320 7468 6520 7072  indicates the pr
+00016860: 6f67 7265 7373 2069 7320 6163 7469 7665  ogress is active
+00016870: 2e0a 2020 2020 2020 2020 5265 6365 6e74  ..        Recent
+00016880: 4163 7469 7665 2063 616e 2062 6520 7265  Active can be re
+00016890: 7365 7420 746f 2066 616c 7365 2061 6674  set to false aft
+000168a0: 6572 2061 6e20 656c 6563 7469 6f6e 2074  er an election t
+000168b0: 696d 656f 7574 2e0a 2020 2020 2020 2020  imeout..        
+000168c0: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+000168d0: 7265 6365 6e74 5f61 6374 6976 6528 7365  recent_active(se
+000168e0: 6c66 2c20 7265 6365 6e74 5f61 6374 6976  lf, recent_activ
+000168f0: 653a 2062 6f6f 6c29 202d 3e20 4e6f 6e65  e: bool) -> None
+00016900: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00016910: 2020 2020 2020 6072 6563 656e 745f 6163        `recent_ac
+00016920: 7469 7665 603a 2054 6869 7320 6973 2074  tive`: This is t
+00016930: 7275 6520 6966 2074 6865 2070 726f 6772  rue if the progr
+00016940: 6573 7320 6973 2072 6563 656e 746c 7920  ess is recently 
+00016950: 6163 7469 7665 2e20 5265 6365 6976 696e  active. Receivin
+00016960: 6720 616e 7920 6d65 7373 6167 6573 0a20  g any messages. 
+00016970: 2020 2020 2020 2066 726f 6d20 7468 6520         from the 
+00016980: 636f 7272 6573 706f 6e64 696e 6720 666f  corresponding fo
+00016990: 6c6c 6f77 6572 2069 6e64 6963 6174 6573  llower indicates
+000169a0: 2074 6865 2070 726f 6772 6573 7320 6973   the progress is
+000169b0: 2061 6374 6976 652e 0a20 2020 2020 2020   active..       
+000169c0: 2052 6563 656e 7441 6374 6976 6520 6361   RecentActive ca
+000169d0: 6e20 6265 2072 6573 6574 2074 6f20 6661  n be reset to fa
+000169e0: 6c73 6520 6166 7465 7220 616e 2065 6c65  lse after an ele
+000169f0: 6374 696f 6e20 7469 6d65 6f75 742e 0a20  ction timeout.. 
+00016a00: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+00016a10: 6566 2067 6574 5f70 6175 7365 6428 7365  ef get_paused(se
+00016a20: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
+00016a30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016a40: 2060 7061 7573 6564 603a 2050 6175 7365   `paused`: Pause
+00016a50: 6420 6973 2075 7365 6420 696e 2050 726f  d is used in Pro
+00016a60: 6772 6573 7353 7461 7465 5072 6f62 652e  gressStateProbe.
+00016a70: 0a20 2020 2020 2020 2057 6865 6e20 5061  .        When Pa
+00016a80: 7573 6564 2069 7320 7472 7565 2c20 7261  used is true, ra
+00016a90: 6674 2073 686f 756c 6420 7061 7573 6520  ft should pause 
+00016aa0: 7365 6e64 696e 6720 7265 706c 6963 6174  sending replicat
+00016ab0: 696f 6e20 6d65 7373 6167 6520 746f 2074  ion message to t
+00016ac0: 6869 7320 7065 6572 2e0a 2020 2020 2020  his peer..      
+00016ad0: 2020 2222 220a 2020 2020 6465 6620 7365    """.    def se
+00016ae0: 745f 7061 7573 6564 2873 656c 662c 2070  t_paused(self, p
+00016af0: 6175 7365 643a 2062 6f6f 6c29 202d 3e20  aused: bool) -> 
+00016b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00016b10: 220a 2020 2020 2020 2020 6070 6175 7365  ".        `pause
+00016b20: 6460 3a20 5061 7573 6564 2069 7320 7573  d`: Paused is us
+00016b30: 6564 2069 6e20 5072 6f67 7265 7373 5374  ed in ProgressSt
+00016b40: 6174 6550 726f 6265 2e0a 2020 2020 2020  ateProbe..      
+00016b50: 2020 5768 656e 2050 6175 7365 6420 6973    When Paused is
+00016b60: 2074 7275 652c 2072 6166 7420 7368 6f75   true, raft shou
+00016b70: 6c64 2070 6175 7365 2073 656e 6469 6e67  ld pause sending
+00016b80: 2072 6570 6c69 6361 7469 6f6e 206d 6573   replication mes
+00016b90: 7361 6765 2074 6f20 7468 6973 2070 6565  sage to this pee
+00016ba0: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
+00016bb0: 2020 2064 6566 2067 6574 5f73 7461 7465     def get_state
+00016bc0: 2873 656c 6629 202d 3e20 2250 726f 6772  (self) -> "Progr
+00016bd0: 6573 7353 7461 7465 223a 0a20 2020 2020  essState":.     
+00016be0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00016bf0: 7374 6174 6560 3a20 5768 656e 2069 6e20  state`: When in 
+00016c00: 5072 6f67 7265 7373 5374 6174 6550 726f  ProgressStatePro
+00016c10: 6265 2c20 6c65 6164 6572 2073 656e 6473  be, leader sends
+00016c20: 2061 7420 6d6f 7374 206f 6e65 2072 6570   at most one rep
+00016c30: 6c69 6361 7469 6f6e 206d 6573 7361 6765  lication message
+00016c40: 0a20 2020 2020 2020 2070 6572 2068 6561  .        per hea
+00016c50: 7274 6265 6174 2069 6e74 6572 7661 6c2e  rtbeat interval.
+00016c60: 2049 7420 616c 736f 2070 726f 6265 7320   It also probes 
+00016c70: 6163 7475 616c 2070 726f 6772 6573 7320  actual progress 
+00016c80: 6f66 2074 6865 2066 6f6c 6c6f 7765 722e  of the follower.
+00016c90: 0a0a 2020 2020 2020 2020 5768 656e 2069  ..        When i
+00016ca0: 6e20 5072 6f67 7265 7373 5374 6174 6552  n ProgressStateR
+00016cb0: 6570 6c69 6361 7465 2c20 6c65 6164 6572  eplicate, leader
+00016cc0: 206f 7074 696d 6973 7469 6361 6c6c 7920   optimistically 
+00016cd0: 696e 6372 6561 7365 7320 6e65 7874 0a20  increases next. 
+00016ce0: 2020 2020 2020 2074 6f20 7468 6520 6c61         to the la
+00016cf0: 7465 7374 2065 6e74 7279 2073 656e 7420  test entry sent 
+00016d00: 6166 7465 7220 7365 6e64 696e 6720 7265  after sending re
+00016d10: 706c 6963 6174 696f 6e20 6d65 7373 6167  plication messag
+00016d20: 652e 2054 6869 7320 6973 0a20 2020 2020  e. This is.     
+00016d30: 2020 2061 6e20 6f70 7469 6d69 7a65 6420     an optimized 
+00016d40: 7374 6174 6520 666f 7220 6661 7374 2072  state for fast r
+00016d50: 6570 6c69 6361 7469 6e67 206c 6f67 2065  eplicating log e
+00016d60: 6e74 7269 6573 2074 6f20 7468 6520 666f  ntries to the fo
+00016d70: 6c6c 6f77 6572 2e0a 0a20 2020 2020 2020  llower...       
+00016d80: 2057 6865 6e20 696e 2050 726f 6772 6573   When in Progres
+00016d90: 7353 7461 7465 536e 6170 7368 6f74 2c20  sStateSnapshot, 
+00016da0: 6c65 6164 6572 2073 686f 756c 6420 6861  leader should ha
+00016db0: 7665 2073 656e 7420 6f75 7420 736e 6170  ve sent out snap
+00016dc0: 7368 6f74 0a20 2020 2020 2020 2062 6566  shot.        bef
+00016dd0: 6f72 6520 616e 6420 7374 6f70 2073 656e  ore and stop sen
+00016de0: 6469 6e67 2061 6e79 2072 6570 6c69 6361  ding any replica
+00016df0: 7469 6f6e 206d 6573 7361 6765 2e0a 2020  tion message..  
+00016e00: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00016e10: 6620 7365 745f 7374 6174 6528 7365 6c66  f set_state(self
+00016e20: 2c20 7374 6174 653a 2022 5072 6f67 7265  , state: "Progre
+00016e30: 7373 5374 6174 6522 2920 2d3e 204e 6f6e  ssState") -> Non
+00016e40: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00016e50: 2020 2020 2020 2060 7374 6174 6560 3a20         `state`: 
+00016e60: 5768 656e 2069 6e20 5072 6f67 7265 7373  When in Progress
+00016e70: 5374 6174 6550 726f 6265 2c20 6c65 6164  StateProbe, lead
+00016e80: 6572 2073 656e 6473 2061 7420 6d6f 7374  er sends at most
+00016e90: 206f 6e65 2072 6570 6c69 6361 7469 6f6e   one replication
+00016ea0: 206d 6573 7361 6765 0a20 2020 2020 2020   message.       
+00016eb0: 2070 6572 2068 6561 7274 6265 6174 2069   per heartbeat i
+00016ec0: 6e74 6572 7661 6c2e 2049 7420 616c 736f  nterval. It also
+00016ed0: 2070 726f 6265 7320 6163 7475 616c 2070   probes actual p
+00016ee0: 726f 6772 6573 7320 6f66 2074 6865 2066  rogress of the f
+00016ef0: 6f6c 6c6f 7765 722e 0a0a 2020 2020 2020  ollower...      
+00016f00: 2020 5768 656e 2069 6e20 5072 6f67 7265    When in Progre
+00016f10: 7373 5374 6174 6552 6570 6c69 6361 7465  ssStateReplicate
+00016f20: 2c20 6c65 6164 6572 206f 7074 696d 6973  , leader optimis
+00016f30: 7469 6361 6c6c 7920 696e 6372 6561 7365  tically increase
+00016f40: 7320 6e65 7874 0a20 2020 2020 2020 2074  s next.        t
+00016f50: 6f20 7468 6520 6c61 7465 7374 2065 6e74  o the latest ent
+00016f60: 7279 2073 656e 7420 6166 7465 7220 7365  ry sent after se
+00016f70: 6e64 696e 6720 7265 706c 6963 6174 696f  nding replicatio
+00016f80: 6e20 6d65 7373 6167 652e 2054 6869 7320  n message. This 
+00016f90: 6973 0a20 2020 2020 2020 2061 6e20 6f70  is.        an op
+00016fa0: 7469 6d69 7a65 6420 7374 6174 6520 666f  timized state fo
+00016fb0: 7220 6661 7374 2072 6570 6c69 6361 7469  r fast replicati
+00016fc0: 6e67 206c 6f67 2065 6e74 7269 6573 2074  ng log entries t
+00016fd0: 6f20 7468 6520 666f 6c6c 6f77 6572 2e0a  o the follower..
+00016fe0: 0a20 2020 2020 2020 2057 6865 6e20 696e  .        When in
+00016ff0: 2050 726f 6772 6573 7353 7461 7465 536e   ProgressStateSn
+00017000: 6170 7368 6f74 2c20 6c65 6164 6572 2073  apshot, leader s
+00017010: 686f 756c 6420 6861 7665 2073 656e 7420  hould have sent 
+00017020: 6f75 7420 736e 6170 7368 6f74 0a20 2020  out snapshot.   
+00017030: 2020 2020 2062 6566 6f72 6520 616e 6420       before and 
+00017040: 7374 6f70 2073 656e 6469 6e67 2061 6e79  stop sending any
+00017050: 2072 6570 6c69 6361 7469 6f6e 206d 6573   replication mes
+00017060: 7361 6765 2e0a 2020 2020 2020 2020 2222  sage..        ""
+00017070: 220a 0a63 6c61 7373 2050 726f 6772 6573  "..class Progres
+00017080: 7328 5f5f 4150 495f 5072 6f67 7265 7373  s(__API_Progress
+00017090: 293a 0a20 2020 2022 2222 0a20 2020 2054  ):.    """.    T
+000170a0: 6865 2070 726f 6772 6573 7320 6f66 2063  he progress of c
+000170b0: 6174 6368 696e 6720 7570 2066 726f 6d20  atching up from 
+000170c0: 6120 7265 7374 6172 742e 0a20 2020 2022  a restart..    "
+000170d0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+000170e0: 6974 5f5f 2873 656c 662c 206e 6578 745f  it__(self, next_
+000170f0: 6964 783a 2069 6e74 2c20 696e 735f 7369  idx: int, ins_si
+00017100: 7a65 3a20 696e 7429 202d 3e20 4e6f 6e65  ze: int) -> None
+00017110: 3a20 2e2e 2e0a 2020 2020 6465 6620 6d61  : ....    def ma
+00017120: 6b65 5f72 6566 2873 656c 6629 202d 3e20  ke_ref(self) -> 
+00017130: 2250 726f 6772 6573 7352 6566 223a 202e  "ProgressRef": .
+00017140: 2e2e 0a0a 636c 6173 7320 5072 6f67 7265  ....class Progre
+00017150: 7373 5265 6628 5f5f 4150 495f 5072 6f67  ssRef(__API_Prog
+00017160: 7265 7373 293a 0a20 2020 2022 2222 0a20  ress):.    """. 
+00017170: 2020 2052 6566 6572 656e 6365 2074 7970     Reference typ
+00017180: 6520 6f66 203a 636c 6173 733a 6050 726f  e of :class:`Pro
+00017190: 6772 6573 7360 2e0a 2020 2020 2222 220a  gress`..    """.
+000171a0: 0a63 6c61 7373 205f 5f41 5049 5f4a 6f69  .class __API_Joi
+000171b0: 6e74 436f 6e66 6967 285f 5f43 6c6f 6e65  ntConfig(__Clone
+000171c0: 6162 6c65 293a 0a20 2020 2064 6566 2063  able):.    def c
+000171d0: 6c6f 6e65 2873 656c 6629 202d 3e20 224a  lone(self) -> "J
+000171e0: 6f69 6e74 436f 6e66 6967 223a 202e 2e2e  ointConfig": ...
+000171f0: 0a20 2020 2064 6566 2063 6c65 6172 2873  .    def clear(s
+00017200: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00017210: 2020 2020 2020 2222 2243 6c65 6172 7320        """Clears 
+00017220: 616c 6c20 4944 732e 2222 220a 2020 2020  all IDs.""".    
+00017230: 6465 6620 636f 6e74 6169 6e73 2873 656c  def contains(sel
+00017240: 662c 2069 643a 2069 6e74 2920 2d3e 2062  f, id: int) -> b
+00017250: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+00017260: 4368 6563 6b20 6966 2061 6e20 6964 2069  Check if an id i
+00017270: 7320 6120 766f 7465 722e 2222 220a 2020  s a voter.""".  
+00017280: 2020 6465 6620 6964 7328 2920 2d3e 2053    def ids() -> S
+00017290: 6574 5b69 6e74 5d3a 0a20 2020 2020 2020  et[int]:.       
+000172a0: 2022 2222 5265 7475 726e 7320 616e 2069   """Returns an i
+000172b0: 7465 7261 746f 7220 6f76 6572 2074 776f  terator over two
+000172c0: 2068 6173 6820 7365 7420 7769 7468 6f75   hash set withou
+000172d0: 7420 636c 6f6e 696e 672e 2222 220a 2020  t cloning.""".  
+000172e0: 2020 6465 6620 6973 5f73 696e 676c 6574    def is_singlet
+000172f0: 6f6e 2873 656c 6629 202d 3e20 626f 6f6c  on(self) -> bool
+00017300: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00017310: 2020 2020 2020 5265 7475 726e 7320 7472        Returns tr
+00017320: 7565 2069 6620 2861 6e64 206f 6e6c 7920  ue if (and only 
+00017330: 6966 2920 7468 6572 6520 6973 206f 6e6c  if) there is onl
+00017340: 7920 6f6e 6520 766f 7469 6e67 206d 656d  y one voting mem
+00017350: 6265 720a 2020 2020 2020 2020 2869 2e65  ber.        (i.e
+00017360: 2e20 7468 6520 6c65 6164 6572 2920 696e  . the leader) in
+00017370: 2074 6865 2063 7572 7265 6e74 2063 6f6e   the current con
+00017380: 6669 6775 7261 7469 6f6e 2e0a 2020 2020  figuration..    
+00017390: 2020 2020 2222 220a 0a63 6c61 7373 204a      """..class J
+000173a0: 6f69 6e74 436f 6e66 6967 285f 5f41 5049  ointConfig(__API
+000173b0: 5f4a 6f69 6e74 436f 6e66 6967 293a 0a20  _JointConfig):. 
+000173c0: 2020 2022 2222 0a20 2020 2041 2063 6f6e     """.    A con
+000173d0: 6669 6775 7261 7469 6f6e 206f 6620 7477  figuration of tw
+000173e0: 6f20 6772 6f75 7073 206f 6620 2870 6f73  o groups of (pos
+000173f0: 7369 626c 7920 6f76 6572 6c61 7070 696e  sibly overlappin
+00017400: 6729 206d 616a 6f72 6974 7920 636f 6e66  g) majority conf
+00017410: 6967 7572 6174 696f 6e73 2e0a 2020 2020  igurations..    
+00017420: 4465 6369 7369 6f6e 7320 7265 7175 6972  Decisions requir
+00017430: 6520 7468 6520 7375 7070 6f72 7420 6f66  e the support of
+00017440: 2062 6f74 6820 6d61 6a6f 7269 7469 6573   both majorities
+00017450: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00017460: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00017470: 2c20 766f 7465 7273 3a20 5365 745b 696e  , voters: Set[in
+00017480: 745d 2920 2d3e 204e 6f6e 653a 202e 2e2e  t]) -> None: ...
+00017490: 0a20 2020 2064 6566 206d 616b 655f 7265  .    def make_re
+000174a0: 6628 7365 6c66 2920 2d3e 2022 4a6f 696e  f(self) -> "Join
+000174b0: 7443 6f6e 6669 6752 6566 223a 202e 2e2e  tConfigRef": ...
+000174c0: 0a0a 636c 6173 7320 4a6f 696e 7443 6f6e  ..class JointCon
+000174d0: 6669 6752 6566 285f 5f41 5049 5f4a 6f69  figRef(__API_Joi
+000174e0: 6e74 436f 6e66 6967 293a 0a20 2020 2022  ntConfig):.    "
+000174f0: 2222 0a20 2020 2052 6566 6572 656e 6365  "".    Reference
+00017500: 2074 7970 6520 6f66 203a 636c 6173 733a   type of :class:
+00017510: 604a 6f69 6e74 436f 6e66 6967 602e 0a20  `JointConfig`.. 
+00017520: 2020 2022 2222 0a0a 636c 6173 7320 5f5f     """..class __
+00017530: 4150 495f 4d61 6a6f 7269 7479 436f 6e66  API_MajorityConf
+00017540: 6967 285f 5f43 6c6f 6e65 6162 6c65 293a  ig(__Cloneable):
+00017550: 0a20 2020 2064 6566 2063 6c6f 6e65 2873  .    def clone(s
+00017560: 656c 6629 202d 3e20 224d 616a 6f72 6974  elf) -> "Majorit
+00017570: 7943 6f6e 6669 6722 3a20 2e2e 2e0a 2020  yConfig": ....  
+00017580: 2020 6465 6620 7261 775f 736c 6963 6528    def raw_slice(
+00017590: 7365 6c66 2920 2d3e 204c 6973 745b 696e  self) -> List[in
+000175a0: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
+000175b0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+000175c0: 7468 6520 4d61 6a6f 7269 7479 436f 6e66  the MajorityConf
+000175d0: 6967 2061 7320 6120 736c 6963 652e 0a20  ig as a slice.. 
+000175e0: 2020 2020 2020 2022 2222 0a20 2020 2064         """.    d
+000175f0: 6566 2063 6170 6163 6974 7928 7365 6c66  ef capacity(self
+00017600: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+00017610: 2020 2222 2222 2222 0a20 2020 2064 6566    """""".    def
+00017620: 2065 7874 656e 6428 7365 6c66 2c20 6f74   extend(self, ot
+00017630: 6865 725f 7365 743a 2053 6574 5b69 6e74  her_set: Set[int
+00017640: 5d29 202d 3e20 4e6f 6e65 3a0a 2020 2020  ]) -> None:.    
+00017650: 2020 2020 2222 2222 2222 0a20 2020 2064      """""".    d
+00017660: 6566 2067 6574 2873 656c 662c 2069 6e64  ef get(self, ind
+00017670: 6578 3a20 696e 7429 202d 3e20 4f70 7469  ex: int) -> Opti
+00017680: 6f6e 616c 5b69 6e74 5d3a 0a20 2020 2020  onal[int]:.     
+00017690: 2020 2022 2222 2222 220a 2020 2020 6465     """""".    de
+000176a0: 6620 696e 7365 7274 2873 656c 662c 2076  f insert(self, v
+000176b0: 616c 7565 3a20 696e 7429 202d 3e20 626f  alue: int) -> bo
+000176c0: 6f6c 3a0a 2020 2020 2020 2020 2222 2222  ol:.        """"
+000176d0: 2222 0a20 2020 2064 6566 2072 6570 6c61  "".    def repla
+000176e0: 6365 2873 656c 662c 2076 616c 7565 3a20  ce(self, value: 
+000176f0: 696e 7429 202d 3e20 696e 743a 0a20 2020  int) -> int:.   
+00017700: 2020 2020 2022 2222 2222 220a 2020 2020       """""".    
+00017710: 6465 6620 6973 5f64 6973 6a6f 696e 7428  def is_disjoint(
+00017720: 7365 6c66 2c20 6f74 6865 723a 2053 6574  self, other: Set
+00017730: 5b69 6e74 5d29 202d 3e20 626f 6f6c 3a0a  [int]) -> bool:.
+00017740: 2020 2020 2020 2020 2222 2222 2222 0a20          """""". 
+00017750: 2020 2064 6566 2069 735f 7375 7065 7273     def is_supers
+00017760: 6574 2873 656c 662c 206f 7468 6572 3a20  et(self, other: 
+00017770: 5365 745b 696e 745d 2920 2d3e 2062 6f6f  Set[int]) -> boo
+00017780: 6c3a 0a20 2020 2020 2020 2022 2222 2222  l:.        """""
+00017790: 220a 2020 2020 6465 6620 6973 5f73 7562  ".    def is_sub
+000177a0: 7365 7428 7365 6c66 2c20 6f74 6865 723a  set(self, other:
+000177b0: 2053 6574 5b69 6e74 5d29 202d 3e20 626f   Set[int]) -> bo
+000177c0: 6f6c 3a0a 2020 2020 2020 2020 2222 2222  ol:.        """"
+000177d0: 2222 0a20 2020 2064 6566 2072 6573 6572  "".    def reser
+000177e0: 7665 2873 656c 662c 2061 6464 6974 696f  ve(self, additio
+000177f0: 6e61 6c3a 2069 6e74 2920 2d3e 204e 6f6e  nal: int) -> Non
+00017800: 653a 0a20 2020 2020 2020 2022 2222 2222  e:.        """""
+00017810: 220a 2020 2020 6465 6620 7265 6d6f 7665  ".    def remove
+00017820: 2873 656c 662c 2076 616c 7565 3a20 696e  (self, value: in
+00017830: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
+00017840: 2020 2020 2222 2222 2222 0a20 2020 2064      """""".    d
+00017850: 6566 2073 6872 696e 6b5f 746f 2873 656c  ef shrink_to(sel
+00017860: 662c 206d 696e 5f63 6170 6163 6974 793a  f, min_capacity:
+00017870: 2069 6e74 2920 2d3e 204e 6f6e 653a 0a20   int) -> None:. 
+00017880: 2020 2020 2020 2022 2222 2222 220a 2020         """""".  
+00017890: 2020 6465 6620 7368 7269 6e6b 5f74 6f5f    def shrink_to_
+000178a0: 6669 7428 7365 6c66 2920 2d3e 204e 6f6e  fit(self) -> Non
+000178b0: 653a 0a20 2020 2020 2020 2022 2222 2222  e:.        """""
+000178c0: 220a 2020 2020 6465 6620 7472 795f 7265  ".    def try_re
+000178d0: 7365 7276 6528 7365 6c66 2c20 6164 6469  serve(self, addi
+000178e0: 7469 6f6e 616c 3a20 696e 7429 202d 3e20  tional: int) -> 
+000178f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00017900: 2222 2222 0a0a 636c 6173 7320 4d61 6a6f  """"..class Majo
+00017910: 7269 7479 436f 6e66 6967 285f 5f41 5049  rityConfig(__API
+00017920: 5f4d 616a 6f72 6974 7943 6f6e 6669 6729  _MajorityConfig)
+00017930: 3a0a 2020 2020 2222 220a 2020 2020 4120  :.    """.    A 
+00017940: 7365 7420 6f66 2049 4473 2074 6861 7420  set of IDs that 
+00017950: 7573 6573 206d 616a 6f72 6974 7920 7175  uses majority qu
+00017960: 6f72 756d 7320 746f 206d 616b 6520 6465  orums to make de
+00017970: 6369 7369 6f6e 732e 0a20 2020 2022 2222  cisions..    """
+00017980: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00017990: 5f5f 2873 656c 662c 2076 6f74 6572 733a  __(self, voters:
+000179a0: 2053 6574 5b69 6e74 5d29 202d 3e20 4e6f   Set[int]) -> No
+000179b0: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
+000179c0: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+000179d0: 3e20 224d 616a 6f72 6974 7943 6f6e 6669  > "MajorityConfi
+000179e0: 6752 6566 223a 202e 2e2e 0a0a 636c 6173  gRef": .....clas
+000179f0: 7320 4d61 6a6f 7269 7479 436f 6e66 6967  s MajorityConfig
+00017a00: 5265 6628 5f5f 4150 495f 4d61 6a6f 7269  Ref(__API_Majori
+00017a10: 7479 436f 6e66 6967 293a 0a20 2020 2022  tyConfig):.    "
+00017a20: 2222 0a20 2020 2052 6566 6572 656e 6365  "".    Reference
+00017a30: 2074 7970 6520 6f66 203a 636c 6173 733a   type of :class:
+00017a40: 604d 616a 6f72 6974 7943 6f6e 6669 6760  `MajorityConfig`
+00017a50: 2e0a 2020 2020 2222 220a 0a63 6c61 7373  ..    """..class
+00017a60: 205f 5f41 5049 5f49 6e66 6c69 6768 7473   __API_Inflights
+00017a70: 285f 5f43 6c6f 6e65 6162 6c65 293a 0a20  (__Cloneable):. 
+00017a80: 2020 2064 6566 2063 6c6f 6e65 2873 656c     def clone(sel
+00017a90: 6629 202d 3e20 2249 6e66 6c69 6768 7473  f) -> "Inflights
+00017aa0: 223a 202e 2e2e 0a20 2020 2064 6566 2061  ": ....    def a
+00017ab0: 6464 2873 656c 662c 2069 6e66 6c69 6768  dd(self, infligh
+00017ac0: 743a 2069 6e74 2920 2d3e 204e 6f6e 653a  t: int) -> None:
+00017ad0: 0a20 2020 2020 2020 2022 2222 4164 6473  .        """Adds
+00017ae0: 2061 6e20 696e 666c 6967 6874 2069 6e74   an inflight int
+00017af0: 6f20 696e 666c 6967 6874 7322 2222 0a20  o inflights""". 
+00017b00: 2020 2064 6566 2066 756c 6c28 7365 6c66     def full(self
+00017b10: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+00017b20: 2020 2022 2222 5265 7475 726e 7320 7472     """Returns tr
+00017b30: 7565 2069 6620 7468 6520 696e 666c 6967  ue if the inflig
+00017b40: 6874 7320 6973 2066 756c 6c2e 2222 220a  hts is full.""".
+00017b50: 2020 2020 6465 6620 7265 7365 7428 7365      def reset(se
+00017b60: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00017b70: 2020 2020 2022 2222 4672 6565 7320 616c       """Frees al
+00017b80: 6c20 696e 666c 6967 6874 732e 2222 220a  l inflights.""".
+00017b90: 2020 2020 6465 6620 6672 6565 5f74 6f28      def free_to(
+00017ba0: 7365 6c66 2c20 746f 3a20 696e 7429 202d  self, to: int) -
+00017bb0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00017bc0: 2222 2246 7265 6573 2074 6865 2069 6e66  """Frees the inf
+00017bd0: 6c69 6768 7473 2073 6d61 6c6c 6572 206f  lights smaller o
+00017be0: 7220 6571 7561 6c20 746f 2074 6865 2067  r equal to the g
+00017bf0: 6976 656e 2060 746f 6020 666c 6967 6874  iven `to` flight
+00017c00: 2e22 2222 0a20 2020 2064 6566 2066 7265  .""".    def fre
+00017c10: 655f 6669 7273 745f 6f6e 6528 7365 6c66  e_first_one(self
+00017c20: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00017c30: 2020 2022 2222 4672 6565 7320 7468 6520     """Frees the 
+00017c40: 6669 7273 7420 6275 6666 6572 2065 6e74  first buffer ent
+00017c50: 7279 2e22 2222 0a20 2020 2064 6566 206d  ry.""".    def m
+00017c60: 6179 6265 5f66 7265 655f 6275 6666 6572  aybe_free_buffer
+00017c70: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00017c80: 2020 2020 2020 2020 2222 2246 7265 6520          """Free 
+00017c90: 756e 7573 6564 206d 656d 6f72 7922 2222  unused memory"""
+00017ca0: 0a20 2020 2064 6566 2062 7566 6665 725f  .    def buffer_
+00017cb0: 6361 7061 6369 7479 2873 656c 6629 202d  capacity(self) -
+00017cc0: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
+00017cd0: 2222 4361 7061 6369 7479 206f 6620 7468  ""Capacity of th
+00017ce0: 6520 696e 7465 726e 616c 2062 7566 6665  e internal buffe
+00017cf0: 722e 2222 220a 2020 2020 6465 6620 6275  r.""".    def bu
+00017d00: 6666 6572 5f69 735f 616c 6c6f 6361 7465  ffer_is_allocate
+00017d10: 6428 7365 6c66 2920 2d3e 2062 6f6f 6c3a  d(self) -> bool:
+00017d20: 0a20 2020 2020 2020 2022 2222 5768 6574  .        """Whet
+00017d30: 6865 7220 6275 6666 6572 2069 7320 616c  her buffer is al
+00017d40: 6c6f 6361 7465 6420 6f72 206e 6f74 2e20  located or not. 
+00017d50: 4974 2773 2066 6f72 2074 6573 7473 2e22  It's for tests."
+00017d60: 2222 0a20 2020 2064 6566 2063 6f75 6e74  "".    def count
+00017d70: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+00017d80: 2020 2020 2020 2022 2222 4e75 6d62 6572         """Number
+00017d90: 206f 6620 696e 666c 6967 6874 206d 6573   of inflight mes
+00017da0: 7361 6765 732e 2049 7427 7320 666f 7220  sages. It's for 
+00017db0: 7465 7374 732e 2222 220a 2020 2020 6465  tests.""".    de
+00017dc0: 6620 7365 745f 6361 7028 7365 6c66 2c20  f set_cap(self, 
+00017dd0: 696e 636f 6d69 6e67 5f63 6170 3a20 696e  incoming_cap: in
+00017de0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
+00017df0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00017e00: 4164 6a75 7374 2069 6e66 6c69 6768 7420  Adjust inflight 
+00017e10: 6275 6666 6572 2063 6170 6163 6974 792e  buffer capacity.
+00017e20: 2053 6574 2069 7420 746f 2060 3060 2077   Set it to `0` w
+00017e30: 696c 6c20 6469 7361 626c 6520 7468 6520  ill disable the 
+00017e40: 7072 6f67 7265 7373 2e0a 2020 2020 2020  progress..      
+00017e50: 2020 4361 6c6c 696e 6720 6974 2062 6574    Calling it bet
+00017e60: 7765 656e 2060 7365 6c66 2e66 756c 6c28  ween `self.full(
+00017e70: 2960 2061 6e64 2060 7365 6c66 2e61 6464  )` and `self.add
+00017e80: 2829 6020 6361 6e20 6361 7573 6520 6120  ()` can cause a 
+00017e90: 7061 6e69 632e 0a20 2020 2020 2020 2022  panic..        "
+00017ea0: 2222 0a0a 636c 6173 7320 496e 666c 6967  ""..class Inflig
+00017eb0: 6874 7328 5f5f 4150 495f 496e 666c 6967  hts(__API_Inflig
+00017ec0: 6874 7329 3a0a 2020 2020 2222 220a 2020  hts):.    """.  
+00017ed0: 2020 4120 6275 6666 6572 206f 6620 696e    A buffer of in
+00017ee0: 666c 6967 6874 206d 6573 7361 6765 732e  flight messages.
+00017ef0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00017f00: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00017f10: 2063 6170 3a20 696e 7429 202d 3e20 4e6f   cap: int) -> No
+00017f20: 6e65 3a20 2e2e 2e0a 2020 2020 6465 6620  ne: ....    def 
+00017f30: 6d61 6b65 5f72 6566 2873 656c 6629 202d  make_ref(self) -
+00017f40: 3e20 2249 6e66 6c69 6768 7473 5265 6622  > "InflightsRef"
+00017f50: 3a20 2e2e 2e0a 0a63 6c61 7373 2049 6e66  : .....class Inf
+00017f60: 6c69 6768 7473 5265 6628 5f5f 4150 495f  lightsRef(__API_
+00017f70: 496e 666c 6967 6874 7329 3a0a 2020 2020  Inflights):.    
+00017f80: 2222 220a 2020 2020 5265 6665 7265 6e63  """.    Referenc
+00017f90: 6520 7479 7065 206f 6620 3a63 6c61 7373  e type of :class
+00017fa0: 3a60 496e 666c 6967 6874 7352 6566 602e  :`InflightsRef`.
+00017fb0: 0a20 2020 2022 2222 0a0a 636c 6173 7320  .    """..class 
+00017fc0: 5f5f 4150 495f 436f 6e66 6967 285f 5f43  __API_Config(__C
+00017fd0: 6c6f 6e65 6162 6c65 293a 0a20 2020 2064  loneable):.    d
+00017fe0: 6566 2063 6c6f 6e65 2873 656c 6629 202d  ef clone(self) -
+00017ff0: 3e20 2243 6f6e 6669 6722 3a20 2e2e 2e0a  > "Config": ....
+00018000: 2020 2020 6465 6620 6d69 6e5f 656c 6563      def min_elec
+00018010: 7469 6f6e 5f74 6963 6b28 7365 6c66 2920  tion_tick(self) 
+00018020: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+00018030: 2222 220a 2020 2020 2020 2020 606d 696e  """.        `min
+00018040: 5f65 6c65 6374 696f 6e5f 7469 636b 603a  _election_tick`:
+00018050: 2054 6865 206d 696e 696d 756d 206e 756d   The minimum num
+00018060: 6265 7220 6f66 2074 6963 6b73 2062 6566  ber of ticks bef
+00018070: 6f72 6520 616e 2065 6c65 6374 696f 6e2e  ore an election.
+00018080: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018090: 2064 6566 2073 6574 5f6d 696e 5f65 6c65   def set_min_ele
+000180a0: 6374 696f 6e5f 7469 636b 2873 656c 662c  ction_tick(self,
+000180b0: 206d 696e 5f65 6c65 6374 696f 6e5f 7469   min_election_ti
+000180c0: 636b 3a20 696e 7429 202d 3e20 4e6f 6e65  ck: int) -> None
+000180d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000180e0: 2020 2020 2020 606d 696e 5f65 6c65 6374        `min_elect
+000180f0: 696f 6e5f 7469 636b 603a 2054 6865 206d  ion_tick`: The m
+00018100: 696e 696d 756d 206e 756d 6265 7220 6f66  inimum number of
+00018110: 2074 6963 6b73 2062 6566 6f72 6520 616e   ticks before an
+00018120: 2065 6c65 6374 696f 6e2e 0a20 2020 2020   election..     
+00018130: 2020 2022 2222 0a20 2020 2064 6566 206d     """.    def m
+00018140: 6178 5f65 6c65 6374 696f 6e5f 7469 636b  ax_election_tick
+00018150: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+00018160: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00018170: 2020 2060 6d61 785f 656c 6563 7469 6f6e     `max_election
+00018180: 5f74 6963 6b60 3a20 5468 6520 6d61 7869  _tick`: The maxi
+00018190: 6d75 6d20 6e75 6d62 6572 206f 6620 7469  mum number of ti
+000181a0: 636b 7320 6265 666f 7265 2061 6e20 656c  cks before an el
+000181b0: 6563 7469 6f6e 2e0a 2020 2020 2020 2020  ection..        
+000181c0: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+000181d0: 6d61 785f 656c 6563 7469 6f6e 5f74 6963  max_election_tic
+000181e0: 6b28 7365 6c66 2c20 6d61 785f 656c 6563  k(self, max_elec
+000181f0: 7469 6f6e 5f74 6963 6b3a 2069 6e74 2920  tion_tick: int) 
+00018200: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00018210: 2022 2222 0a20 2020 2020 2020 2060 6d61   """.        `ma
+00018220: 785f 656c 6563 7469 6f6e 5f74 6963 6b60  x_election_tick`
+00018230: 3a20 5468 6520 6d61 7869 6d75 6d20 6e75  : The maximum nu
+00018240: 6d62 6572 206f 6620 7469 636b 7320 6265  mber of ticks be
+00018250: 666f 7265 2061 6e20 656c 6563 7469 6f6e  fore an election
+00018260: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00018270: 2020 6465 6620 6765 745f 7265 6164 5f6f    def get_read_o
+00018280: 6e6c 795f 6f70 7469 6f6e 2873 656c 6629  nly_option(self)
+00018290: 202d 3e20 2252 6561 644f 6e6c 794f 7074   -> "ReadOnlyOpt
+000182a0: 696f 6e22 3a0a 2020 2020 2020 2020 2222  ion":.        ""
+000182b0: 220a 2020 2020 2020 2020 6072 6561 645f  ".        `read_
+000182c0: 6f6e 6c79 5f6f 7074 696f 6e60 3a20 4368  only_option`: Ch
+000182d0: 6f6f 7365 2074 6865 206c 696e 6561 7269  oose the lineari
+000182e0: 7a61 6269 6c69 7479 206d 6f64 6520 6f72  zability mode or
+000182f0: 2074 6865 206c 6561 7365 206d 6f64 6520   the lease mode 
+00018300: 746f 2072 6561 6420 6461 7461 2e20 4966  to read data. If
+00018310: 2079 6f75 2064 6f6e e280 9974 2063 6172   you don...t car
+00018320: 6520 6162 6f75 7420 7468 6520 7265 6164  e about the read
+00018330: 2063 6f6e 7369 7374 656e 6379 2061 6e64   consistency and
+00018340: 2077 616e 7420 6120 6869 6768 6572 2072   want a higher r
+00018350: 6561 6420 7065 7266 6f72 6d61 6e63 652c  ead performance,
+00018360: 2079 6f75 2063 616e 2075 7365 2074 6865   you can use the
+00018370: 206c 6561 7365 206d 6f64 652e 0a20 2020   lease mode..   
+00018380: 2020 2020 2053 6574 7469 6e67 2074 6869       Setting thi
+00018390: 7320 746f 2060 4c65 6173 6542 6173 6564  s to `LeaseBased
+000183a0: 6020 7265 7175 6972 6573 2060 6368 6563  ` requires `chec
+000183b0: 6b5f 7175 6f72 756d 203d 2074 7275 6560  k_quorum = true`
+000183c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000183d0: 2020 6465 6620 7365 745f 7265 6164 5f6f    def set_read_o
+000183e0: 6e6c 795f 6f70 7469 6f6e 2873 656c 662c  nly_option(self,
+000183f0: 2072 6561 645f 6f6e 6c79 5f6f 7074 696f   read_only_optio
+00018400: 6e3a 2022 5265 6164 4f6e 6c79 4f70 7469  n: "ReadOnlyOpti
+00018410: 6f6e 2229 202d 3e20 4e6f 6e65 3a0a 2020  on") -> None:.  
+00018420: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018430: 2020 6072 6561 645f 6f6e 6c79 5f6f 7074    `read_only_opt
+00018440: 696f 6e60 3a20 4368 6f6f 7365 2074 6865  ion`: Choose the
+00018450: 206c 696e 6561 7269 7a61 6269 6c69 7479   linearizability
+00018460: 206d 6f64 6520 6f72 2074 6865 206c 6561   mode or the lea
+00018470: 7365 206d 6f64 6520 746f 2072 6561 6420  se mode to read 
+00018480: 6461 7461 2e20 4966 2079 6f75 2064 6f6e  data. If you don
+00018490: e280 9974 2063 6172 6520 6162 6f75 7420  ...t care about 
+000184a0: 7468 6520 7265 6164 2063 6f6e 7369 7374  the read consist
+000184b0: 656e 6379 2061 6e64 2077 616e 7420 6120  ency and want a 
+000184c0: 6869 6768 6572 2072 6561 6420 7065 7266  higher read perf
+000184d0: 6f72 6d61 6e63 652c 2079 6f75 2063 616e  ormance, you can
+000184e0: 2075 7365 2074 6865 206c 6561 7365 206d   use the lease m
+000184f0: 6f64 652e 0a20 2020 2020 2020 2053 6574  ode..        Set
+00018500: 7469 6e67 2074 6869 7320 746f 2060 4c65  ting this to `Le
+00018510: 6173 6542 6173 6564 6020 7265 7175 6972  aseBased` requir
+00018520: 6573 2060 6368 6563 6b5f 7175 6f72 756d  es `check_quorum
+00018530: 203d 2074 7275 6560 2e0a 2020 2020 2020   = true`..      
+00018540: 2020 2222 220a 2020 2020 6465 6620 6765    """.    def ge
+00018550: 745f 6964 2873 656c 6629 202d 3e20 696e  t_id(self) -> in
+00018560: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+00018570: 2020 2020 2020 2060 6964 603a 2054 6865         `id`: The
+00018580: 2069 6465 6e74 6974 7920 6f66 2074 6865   identity of the
+00018590: 206c 6f63 616c 2072 6166 742e 2049 7420   local raft. It 
+000185a0: 6361 6e6e 6f74 2062 6520 302c 2061 6e64  cannot be 0, and
+000185b0: 206d 7573 7420 6265 2075 6e69 7175 6520   must be unique 
+000185c0: 696e 2074 6865 2067 726f 7570 2e0a 2020  in the group..  
+000185d0: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+000185e0: 6620 7365 745f 6964 2873 656c 662c 2069  f set_id(self, i
+000185f0: 643a 2069 6e74 2920 2d3e 204e 6f6e 653a  d: int) -> None:
+00018600: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018610: 2020 2020 2060 6964 603a 2054 6865 2069       `id`: The i
+00018620: 6465 6e74 6974 7920 6f66 2074 6865 206c  dentity of the l
+00018630: 6f63 616c 2072 6166 742e 2049 7420 6361  ocal raft. It ca
+00018640: 6e6e 6f74 2062 6520 302c 2061 6e64 206d  nnot be 0, and m
+00018650: 7573 7420 6265 2075 6e69 7175 6520 696e  ust be unique in
+00018660: 2074 6865 2067 726f 7570 2e0a 2020 2020   the group..    
+00018670: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00018680: 6765 745f 656c 6563 7469 6f6e 5f74 6963  get_election_tic
+00018690: 6b28 7365 6c66 2920 2d3e 2069 6e74 3a0a  k(self) -> int:.
+000186a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000186b0: 2020 2020 6065 6c65 6374 696f 6e5f 7469      `election_ti
+000186c0: 636b 603a 2054 6865 206e 756d 6265 7220  ck`: The number 
+000186d0: 6f66 206e 6f64 652e 7469 636b 2069 6e76  of node.tick inv
+000186e0: 6f63 6174 696f 6e73 2074 6861 7420 6d75  ocations that mu
+000186f0: 7374 2070 6173 7320 6265 7477 6565 6e0a  st pass between.
+00018700: 2020 2020 2020 2020 656c 6563 7469 6f6e          election
+00018710: 732e 2054 6861 7420 6973 2c20 6966 2061  s. That is, if a
+00018720: 2066 6f6c 6c6f 7765 7220 646f 6573 206e   follower does n
+00018730: 6f74 2072 6563 6569 7665 2061 6e79 206d  ot receive any m
+00018740: 6573 7361 6765 2066 726f 6d20 7468 650a  essage from the.
+00018750: 2020 2020 2020 2020 6c65 6164 6572 206f          leader o
+00018760: 6620 6375 7272 656e 7420 7465 726d 2062  f current term b
+00018770: 6566 6f72 6520 456c 6563 7469 6f6e 5469  efore ElectionTi
+00018780: 636b 2068 6173 2065 6c61 7073 6564 2c20  ck has elapsed, 
+00018790: 6974 2077 696c 6c20 6265 636f 6d65 0a20  it will become. 
+000187a0: 2020 2020 2020 2063 616e 6469 6461 7465         candidate
+000187b0: 2061 6e64 2073 7461 7274 2061 6e20 656c   and start an el
+000187c0: 6563 7469 6f6e 2e20 656c 6563 7469 6f6e  ection. election
+000187d0: 5f74 6963 6b20 6d75 7374 2062 6520 6772  _tick must be gr
+000187e0: 6561 7465 7220 7468 616e 0a20 2020 2020  eater than.     
+000187f0: 2020 2048 6561 7274 6265 6174 5469 636b     HeartbeatTick
+00018800: 2e20 5765 2073 7567 6765 7374 2065 6c65  . We suggest ele
+00018810: 6374 696f 6e5f 7469 636b 203d 2031 3020  ction_tick = 10 
+00018820: 2a20 4865 6172 7462 6561 7454 6963 6b20  * HeartbeatTick 
+00018830: 746f 2061 766f 6964 0a20 2020 2020 2020  to avoid.       
+00018840: 2075 6e6e 6563 6573 7361 7279 206c 6561   unnecessary lea
+00018850: 6465 7220 7377 6974 6368 696e 670a 2020  der switching.  
+00018860: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+00018870: 6620 7365 745f 656c 6563 7469 6f6e 5f74  f set_election_t
+00018880: 6963 6b28 7365 6c66 2c20 656c 6563 7469  ick(self, electi
+00018890: 6f6e 5f74 6963 6b3a 2069 6e74 2920 2d3e  on_tick: int) ->
+000188a0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+000188b0: 2222 0a20 2020 2020 2020 2060 656c 6563  "".        `elec
+000188c0: 7469 6f6e 5f74 6963 6b60 3a20 5468 6520  tion_tick`: The 
+000188d0: 6e75 6d62 6572 206f 6620 6e6f 6465 2e74  number of node.t
+000188e0: 6963 6b20 696e 766f 6361 7469 6f6e 7320  ick invocations 
+000188f0: 7468 6174 206d 7573 7420 7061 7373 2062  that must pass b
+00018900: 6574 7765 656e 0a20 2020 2020 2020 2065  etween.        e
+00018910: 6c65 6374 696f 6e73 2e20 5468 6174 2069  lections. That i
+00018920: 732c 2069 6620 6120 666f 6c6c 6f77 6572  s, if a follower
+00018930: 2064 6f65 7320 6e6f 7420 7265 6365 6976   does not receiv
+00018940: 6520 616e 7920 6d65 7373 6167 6520 6672  e any message fr
+00018950: 6f6d 2074 6865 0a20 2020 2020 2020 206c  om the.        l
+00018960: 6561 6465 7220 6f66 2063 7572 7265 6e74  eader of current
+00018970: 2074 6572 6d20 6265 666f 7265 2045 6c65   term before Ele
+00018980: 6374 696f 6e54 6963 6b20 6861 7320 656c  ctionTick has el
+00018990: 6170 7365 642c 2069 7420 7769 6c6c 2062  apsed, it will b
+000189a0: 6563 6f6d 650a 2020 2020 2020 2020 6361  ecome.        ca
+000189b0: 6e64 6964 6174 6520 616e 6420 7374 6172  ndidate and star
+000189c0: 7420 616e 2065 6c65 6374 696f 6e2e 2065  t an election. e
+000189d0: 6c65 6374 696f 6e5f 7469 636b 206d 7573  lection_tick mus
+000189e0: 7420 6265 2067 7265 6174 6572 2074 6861  t be greater tha
+000189f0: 6e0a 2020 2020 2020 2020 4865 6172 7462  n.        Heartb
+00018a00: 6561 7454 6963 6b2e 2057 6520 7375 6767  eatTick. We sugg
+00018a10: 6573 7420 656c 6563 7469 6f6e 5f74 6963  est election_tic
+00018a20: 6b20 3d20 3130 202a 2048 6561 7274 6265  k = 10 * Heartbe
+00018a30: 6174 5469 636b 2074 6f20 6176 6f69 640a  atTick to avoid.
+00018a40: 2020 2020 2020 2020 756e 6e65 6365 7373          unnecess
+00018a50: 6172 7920 6c65 6164 6572 2073 7769 7463  ary leader switc
+00018a60: 6869 6e67 0a20 2020 2020 2020 2022 2222  hing.        """
+00018a70: 0a20 2020 2064 6566 2067 6574 5f68 6561  .    def get_hea
+00018a80: 7274 6265 6174 5f74 6963 6b28 7365 6c66  rtbeat_tick(self
+00018a90: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+00018aa0: 2020 2222 220a 2020 2020 2020 2020 6068    """.        `h
+00018ab0: 6561 7274 6265 6174 5f74 6963 6b60 3a20  eartbeat_tick`: 
+00018ac0: 4865 6172 7462 6561 7454 6963 6b20 6973  HeartbeatTick is
+00018ad0: 2074 6865 206e 756d 6265 7220 6f66 206e   the number of n
+00018ae0: 6f64 652e 7469 636b 2069 6e76 6f63 6174  ode.tick invocat
+00018af0: 696f 6e73 2074 6861 7420 6d75 7374 2070  ions that must p
+00018b00: 6173 7320 6265 7477 6565 6e0a 2020 2020  ass between.    
+00018b10: 2020 2020 6865 6172 7462 6561 7473 2e20      heartbeats. 
+00018b20: 5468 6174 2069 732c 2061 206c 6561 6465  That is, a leade
+00018b30: 7220 7365 6e64 7320 6865 6172 7462 6561  r sends heartbea
+00018b40: 7420 6d65 7373 6167 6573 2074 6f20 6d61  t messages to ma
+00018b50: 696e 7461 696e 2069 7473 0a20 2020 2020  intain its.     
+00018b60: 2020 206c 6561 6465 7273 6869 7020 6576     leadership ev
+00018b70: 6572 7920 6865 6172 7462 6561 7420 7469  ery heartbeat ti
+00018b80: 636b 732e 0a20 2020 2020 2020 2022 2222  cks..        """
+00018b90: 0a20 2020 2064 6566 2073 6574 5f68 6561  .    def set_hea
+00018ba0: 7274 6265 6174 5f74 6963 6b28 7365 6c66  rtbeat_tick(self
+00018bb0: 2c20 6865 6172 7462 6561 745f 7469 636b  , heartbeat_tick
+00018bc0: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
+00018bd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00018be0: 2020 2020 6068 6561 7274 6265 6174 5f74      `heartbeat_t
+00018bf0: 6963 6b60 3a20 4865 6172 7462 6561 7454  ick`: HeartbeatT
+00018c00: 6963 6b20 6973 2074 6865 206e 756d 6265  ick is the numbe
+00018c10: 7220 6f66 206e 6f64 652e 7469 636b 2069  r of node.tick i
+00018c20: 6e76 6f63 6174 696f 6e73 2074 6861 7420  nvocations that 
+00018c30: 6d75 7374 2070 6173 7320 6265 7477 6565  must pass betwee
+00018c40: 6e0a 2020 2020 2020 2020 6865 6172 7462  n.        heartb
+00018c50: 6561 7473 2e20 5468 6174 2069 732c 2061  eats. That is, a
+00018c60: 206c 6561 6465 7220 7365 6e64 7320 6865   leader sends he
+00018c70: 6172 7462 6561 7420 6d65 7373 6167 6573  artbeat messages
+00018c80: 2074 6f20 6d61 696e 7461 696e 2069 7473   to maintain its
+00018c90: 0a20 2020 2020 2020 206c 6561 6465 7273  .        leaders
+00018ca0: 6869 7020 6576 6572 7920 6865 6172 7462  hip every heartb
+00018cb0: 6561 7420 7469 636b 732e 0a20 2020 2020  eat ticks..     
+00018cc0: 2020 2022 2222 0a20 2020 2064 6566 2067     """.    def g
+00018cd0: 6574 5f6d 6178 5f73 697a 655f 7065 725f  et_max_size_per_
+00018ce0: 6d73 6728 7365 6c66 2920 2d3e 2069 6e74  msg(self) -> int
+00018cf0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00018d00: 2020 2020 2020 606d 6178 5f73 697a 655f        `max_size_
+00018d10: 7065 725f 6d73 6760 3a20 4c69 6d69 7420  per_msg`: Limit 
+00018d20: 7468 6520 6d61 7820 7369 7a65 206f 6620  the max size of 
+00018d30: 6561 6368 2061 7070 656e 6420 6d65 7373  each append mess
+00018d40: 6167 652e 2053 6d61 6c6c 6572 2076 616c  age. Smaller val
+00018d50: 7565 206c 6f77 6572 730a 2020 2020 2020  ue lowers.      
+00018d60: 2020 7468 6520 7261 6674 2072 6563 6f76    the raft recov
+00018d70: 6572 7920 636f 7374 2869 6e69 7469 616c  ery cost(initial
+00018d80: 2070 726f 6269 6e67 2061 6e64 206d 6573   probing and mes
+00018d90: 7361 6765 206c 6f73 7420 6475 7269 6e67  sage lost during
+00018da0: 206e 6f72 6d61 6c20 6f70 6572 6174 696f   normal operatio
+00018db0: 6e29 2e0a 2020 2020 2020 2020 4f6e 2074  n)..        On t
+00018dc0: 6865 206f 7468 6572 2073 6964 652c 2069  he other side, i
+00018dd0: 7420 6d69 6768 7420 6166 6665 6374 2074  t might affect t
+00018de0: 6865 2074 6872 6f75 6768 7075 7420 6475  he throughput du
+00018df0: 7269 6e67 206e 6f72 6d61 6c20 7265 706c  ring normal repl
+00018e00: 6963 6174 696f 6e2e 0a20 2020 2020 2020  ication..       
+00018e10: 204e 6f74 653a 206d 6174 682e 4d61 7855   Note: math.MaxU
+00018e20: 7573 697a 6536 3420 666f 7220 756e 6c69  usize64 for unli
+00018e30: 6d69 7465 642c 2030 2066 6f72 2061 7420  mited, 0 for at 
+00018e40: 6d6f 7374 206f 6e65 2065 6e74 7279 2070  most one entry p
+00018e50: 6572 206d 6573 7361 6765 2e0a 2020 2020  er message..    
+00018e60: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00018e70: 7365 745f 6d61 785f 7369 7a65 5f70 6572  set_max_size_per
+00018e80: 5f6d 7367 2873 656c 662c 206d 6178 5f73  _msg(self, max_s
+00018e90: 697a 655f 7065 725f 6d73 673a 2069 6e74  ize_per_msg: int
+00018ea0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00018eb0: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00018ec0: 6d61 785f 7369 7a65 5f70 6572 5f6d 7367  max_size_per_msg
+00018ed0: 603a 204c 696d 6974 2074 6865 206d 6178  `: Limit the max
+00018ee0: 2073 697a 6520 6f66 2065 6163 6820 6170   size of each ap
+00018ef0: 7065 6e64 206d 6573 7361 6765 2e20 536d  pend message. Sm
+00018f00: 616c 6c65 7220 7661 6c75 6520 6c6f 7765  aller value lowe
+00018f10: 7273 0a20 2020 2020 2020 2074 6865 2072  rs.        the r
+00018f20: 6166 7420 7265 636f 7665 7279 2063 6f73  aft recovery cos
+00018f30: 7428 696e 6974 6961 6c20 7072 6f62 696e  t(initial probin
+00018f40: 6720 616e 6420 6d65 7373 6167 6520 6c6f  g and message lo
+00018f50: 7374 2064 7572 696e 6720 6e6f 726d 616c  st during normal
+00018f60: 206f 7065 7261 7469 6f6e 292e 0a20 2020   operation)..   
+00018f70: 2020 2020 204f 6e20 7468 6520 6f74 6865       On the othe
+00018f80: 7220 7369 6465 2c20 6974 206d 6967 6874  r side, it might
+00018f90: 2061 6666 6563 7420 7468 6520 7468 726f   affect the thro
+00018fa0: 7567 6870 7574 2064 7572 696e 6720 6e6f  ughput during no
+00018fb0: 726d 616c 2072 6570 6c69 6361 7469 6f6e  rmal replication
+00018fc0: 2e0a 2020 2020 2020 2020 4e6f 7465 3a20  ..        Note: 
+00018fd0: 6d61 7468 2e4d 6178 5575 7369 7a65 3634  math.MaxUusize64
+00018fe0: 2066 6f72 2075 6e6c 696d 6974 6564 2c20   for unlimited, 
+00018ff0: 3020 666f 7220 6174 206d 6f73 7420 6f6e  0 for at most on
+00019000: 6520 656e 7472 7920 7065 7220 6d65 7373  e entry per mess
+00019010: 6167 652e 0a20 2020 2020 2020 2022 2222  age..        """
+00019020: 0a20 2020 2064 6566 2067 6574 5f6d 6178  .    def get_max
+00019030: 5f69 6e66 6c69 6768 745f 6d73 6773 2873  _inflight_msgs(s
+00019040: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+00019050: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00019060: 2060 6d61 785f 696e 666c 6967 6874 5f6d   `max_inflight_m
+00019070: 7367 7360 3a20 4c69 6d69 7420 7468 6520  sgs`: Limit the 
+00019080: 6d61 7820 6e75 6d62 6572 206f 6620 696e  max number of in
+00019090: 2d66 6c69 6768 7420 6170 7065 6e64 206d  -flight append m
+000190a0: 6573 7361 6765 7320 6475 7269 6e67 206f  essages during o
+000190b0: 7074 696d 6973 7469 630a 2020 2020 2020  ptimistic.      
+000190c0: 2020 7265 706c 6963 6174 696f 6e20 7068    replication ph
+000190d0: 6173 652e 2054 6865 2061 7070 6c69 6361  ase. The applica
+000190e0: 7469 6f6e 2074 7261 6e73 706f 7274 6174  tion transportat
+000190f0: 696f 6e20 6c61 7965 7220 7573 7561 6c6c  ion layer usuall
+00019100: 7920 6861 7320 6974 7320 6f77 6e20 7365  y has its own se
+00019110: 6e64 696e 670a 2020 2020 2020 2020 6275  nding.        bu
+00019120: 6666 6572 206f 7665 7220 5443 502f 5544  ffer over TCP/UD
+00019130: 502e 2053 6574 2074 6f20 6176 6f69 6420  P. Set to avoid 
+00019140: 6f76 6572 666c 6f77 696e 6720 7468 6174  overflowing that
+00019150: 2073 656e 6469 6e67 2062 7566 6665 722e   sending buffer.
+00019160: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00019170: 2064 6566 2073 6574 5f6d 6178 5f69 6e66   def set_max_inf
+00019180: 6c69 6768 745f 6d73 6773 2873 656c 662c  light_msgs(self,
+00019190: 206d 6178 5f69 6e66 6c69 6768 745f 6d73   max_inflight_ms
+000191a0: 6773 3a20 696e 7429 202d 3e20 4e6f 6e65  gs: int) -> None
+000191b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000191c0: 2020 2020 2020 606d 6178 5f69 6e66 6c69        `max_infli
+000191d0: 6768 745f 6d73 6773 603a 204c 696d 6974  ght_msgs`: Limit
+000191e0: 2074 6865 206d 6178 206e 756d 6265 7220   the max number 
+000191f0: 6f66 2069 6e2d 666c 6967 6874 2061 7070  of in-flight app
+00019200: 656e 6420 6d65 7373 6167 6573 2064 7572  end messages dur
+00019210: 696e 6720 6f70 7469 6d69 7374 6963 0a20  ing optimistic. 
+00019220: 2020 2020 2020 2072 6570 6c69 6361 7469         replicati
+00019230: 6f6e 2070 6861 7365 2e20 5468 6520 6170  on phase. The ap
+00019240: 706c 6963 6174 696f 6e20 7472 616e 7370  plication transp
+00019250: 6f72 7461 7469 6f6e 206c 6179 6572 2075  ortation layer u
+00019260: 7375 616c 6c79 2068 6173 2069 7473 206f  sually has its o
+00019270: 776e 2073 656e 6469 6e67 0a20 2020 2020  wn sending.     
+00019280: 2020 2062 7566 6665 7220 6f76 6572 2054     buffer over T
+00019290: 4350 2f55 4450 2e20 5365 7420 746f 2061  CP/UDP. Set to a
+000192a0: 766f 6964 206f 7665 7266 6c6f 7769 6e67  void overflowing
+000192b0: 2074 6861 7420 7365 6e64 696e 6720 6275   that sending bu
+000192c0: 6666 6572 2e0a 2020 2020 2020 2020 2222  ffer..        ""
+000192d0: 220a 2020 2020 6465 6620 6765 745f 6170  ".    def get_ap
+000192e0: 706c 6965 6428 7365 6c66 2920 2d3e 2069  plied(self) -> i
+000192f0: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
+00019300: 2020 2020 2020 2020 6061 7070 6c69 6564          `applied
+00019310: 603a 2041 7070 6c69 6564 2069 7320 7468  `: Applied is th
+00019320: 6520 6c61 7374 2061 7070 6c69 6564 2069  e last applied i
+00019330: 6e64 6578 2e20 4974 2073 686f 756c 6420  ndex. It should 
+00019340: 6f6e 6c79 2062 6520 7365 7420 7768 656e  only be set when
+00019350: 2072 6573 7461 7274 696e 670a 2020 2020   restarting.    
+00019360: 2020 2020 7261 6674 2e20 7261 6674 2077      raft. raft w
+00019370: 696c 6c20 6e6f 7420 7265 7475 726e 2065  ill not return e
+00019380: 6e74 7269 6573 2074 6f20 7468 6520 6170  ntries to the ap
+00019390: 706c 6963 6174 696f 6e20 736d 616c 6c65  plication smalle
+000193a0: 7220 6f72 2065 7175 616c 2074 6f20 4170  r or equal to Ap
+000193b0: 706c 6965 642e 0a20 2020 2020 2020 2049  plied..        I
+000193c0: 6620 4170 706c 6965 6420 6973 2075 6e73  f Applied is uns
+000193d0: 6574 2077 6865 6e20 7265 7374 6172 7469  et when restarti
+000193e0: 6e67 2c20 7261 6674 206d 6967 6874 2072  ng, raft might r
+000193f0: 6574 7572 6e20 7072 6576 696f 7573 2061  eturn previous a
+00019400: 7070 6c69 6564 2065 6e74 7269 6573 2e0a  pplied entries..
+00019410: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+00019420: 6120 7665 7279 2061 7070 6c69 6361 7469  a very applicati
+00019430: 6f6e 2064 6570 656e 6465 6e74 2063 6f6e  on dependent con
+00019440: 6669 6775 7261 7469 6f6e 2e0a 2020 2020  figuration..    
+00019450: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00019460: 7365 745f 6170 706c 6965 6428 7365 6c66  set_applied(self
+00019470: 2c20 6170 706c 6965 643a 2069 6e74 2920  , applied: int) 
+00019480: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00019490: 2022 2222 0a20 2020 2020 2020 2060 6170   """.        `ap
+000194a0: 706c 6965 6460 3a20 4170 706c 6965 6420  plied`: Applied 
+000194b0: 6973 2074 6865 206c 6173 7420 6170 706c  is the last appl
+000194c0: 6965 6420 696e 6465 782e 2049 7420 7368  ied index. It sh
+000194d0: 6f75 6c64 206f 6e6c 7920 6265 2073 6574  ould only be set
+000194e0: 2077 6865 6e20 7265 7374 6172 7469 6e67   when restarting
+000194f0: 0a20 2020 2020 2020 2072 6166 742e 2072  .        raft. r
+00019500: 6166 7420 7769 6c6c 206e 6f74 2072 6574  aft will not ret
+00019510: 7572 6e20 656e 7472 6965 7320 746f 2074  urn entries to t
+00019520: 6865 2061 7070 6c69 6361 7469 6f6e 2073  he application s
+00019530: 6d61 6c6c 6572 206f 7220 6571 7561 6c20  maller or equal 
+00019540: 746f 2041 7070 6c69 6564 2e0a 2020 2020  to Applied..    
+00019550: 2020 2020 4966 2041 7070 6c69 6564 2069      If Applied i
+00019560: 7320 756e 7365 7420 7768 656e 2072 6573  s unset when res
+00019570: 7461 7274 696e 672c 2072 6166 7420 6d69  tarting, raft mi
+00019580: 6768 7420 7265 7475 726e 2070 7265 7669  ght return previ
+00019590: 6f75 7320 6170 706c 6965 6420 656e 7472  ous applied entr
+000195a0: 6965 732e 0a20 2020 2020 2020 2054 6869  ies..        Thi
+000195b0: 7320 6973 2061 2076 6572 7920 6170 706c  s is a very appl
+000195c0: 6963 6174 696f 6e20 6465 7065 6e64 656e  ication dependen
+000195d0: 7420 636f 6e66 6967 7572 6174 696f 6e2e  t configuration.
+000195e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000195f0: 2064 6566 2067 6574 5f63 6865 636b 5f71   def get_check_q
+00019600: 756f 7275 6d28 7365 6c66 2920 2d3e 2062  uorum(self) -> b
+00019610: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+00019620: 0a20 2020 2020 2020 2060 6368 6563 6b5f  .        `check_
+00019630: 7175 6f72 756d 603a 2053 7065 6369 6679  quorum`: Specify
+00019640: 2069 6620 7468 6520 6c65 6164 6572 2073   if the leader s
+00019650: 686f 756c 6420 6368 6563 6b20 7175 6f72  hould check quor
+00019660: 756d 2061 6374 6976 6974 792e 204c 6561  um activity. Lea
+00019670: 6465 7220 7374 6570 7320 646f 776e 2077  der steps down w
+00019680: 6865 6e0a 2020 2020 2020 2020 7175 6f72  hen.        quor
+00019690: 756d 2069 7320 6e6f 7420 6163 7469 7665  um is not active
+000196a0: 2066 6f72 2061 6e20 656c 6563 7469 6f6e   for an election
+000196b0: 5469 6d65 6f75 742e 0a20 2020 2020 2020  Timeout..       
+000196c0: 2022 2222 0a20 2020 2064 6566 2073 6574   """.    def set
+000196d0: 5f63 6865 636b 5f71 756f 7275 6d28 7365  _check_quorum(se
+000196e0: 6c66 2c20 6368 6563 6b5f 7175 6f72 756d  lf, check_quorum
+000196f0: 3a20 626f 6f6c 2920 2d3e 204e 6f6e 653a  : bool) -> None:
+00019700: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00019710: 2020 2020 2060 6368 6563 6b5f 7175 6f72       `check_quor
+00019720: 756d 603a 2053 7065 6369 6679 2069 6620  um`: Specify if 
+00019730: 7468 6520 6c65 6164 6572 2073 686f 756c  the leader shoul
+00019740: 6420 6368 6563 6b20 7175 6f72 756d 2061  d check quorum a
+00019750: 6374 6976 6974 792e 204c 6561 6465 7220  ctivity. Leader 
+00019760: 7374 6570 7320 646f 776e 2077 6865 6e0a  steps down when.
+00019770: 2020 2020 2020 2020 7175 6f72 756d 2069          quorum i
+00019780: 7320 6e6f 7420 6163 7469 7665 2066 6f72  s not active for
+00019790: 2061 6e20 656c 6563 7469 6f6e 5469 6d65   an electionTime
+000197a0: 6f75 742e 0a20 2020 2020 2020 2022 2222  out..        """
+000197b0: 0a20 2020 2064 6566 2067 6574 5f70 7265  .    def get_pre
+000197c0: 5f76 6f74 6528 7365 6c66 2920 2d3e 2062  _vote(self) -> b
+000197d0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+000197e0: 0a20 2020 2020 2020 2060 7072 655f 766f  .        `pre_vo
+000197f0: 7465 603a 2045 6e61 626c 6573 2074 6865  te`: Enables the
+00019800: 2050 7265 2d56 6f74 6520 616c 676f 7269   Pre-Vote algori
+00019810: 7468 6d20 6465 7363 7269 6265 6420 696e  thm described in
+00019820: 2072 6166 7420 7468 6573 6973 2073 6563   raft thesis sec
+00019830: 7469 6f6e 0a20 2020 2020 2020 2039 2e36  tion.        9.6
+00019840: 2e20 5468 6973 2070 7265 7665 6e74 7320  . This prevents 
+00019850: 6469 7372 7570 7469 6f6e 2077 6865 6e20  disruption when 
+00019860: 6120 6e6f 6465 2074 6861 7420 6861 7320  a node that has 
+00019870: 6265 656e 2070 6172 7469 7469 6f6e 6564  been partitioned
+00019880: 2061 7761 790a 2020 2020 2020 2020 7265   away.        re
+00019890: 6a6f 696e 7320 7468 6520 636c 7573 7465  joins the cluste
+000198a0: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
+000198b0: 2020 2064 6566 2073 6574 5f70 7265 5f76     def set_pre_v
+000198c0: 6f74 6528 7365 6c66 2c20 7072 655f 766f  ote(self, pre_vo
+000198d0: 7465 3a20 626f 6f6c 2920 2d3e 204e 6f6e  te: bool) -> Non
+000198e0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+000198f0: 2020 2020 2020 2060 7072 655f 766f 7465         `pre_vote
+00019900: 603a 2045 6e61 626c 6573 2074 6865 2050  `: Enables the P
+00019910: 7265 2d56 6f74 6520 616c 676f 7269 7468  re-Vote algorith
+00019920: 6d20 6465 7363 7269 6265 6420 696e 2072  m described in r
+00019930: 6166 7420 7468 6573 6973 2073 6563 7469  aft thesis secti
+00019940: 6f6e 0a20 2020 2020 2020 2039 2e36 2e20  on.        9.6. 
+00019950: 5468 6973 2070 7265 7665 6e74 7320 6469  This prevents di
+00019960: 7372 7570 7469 6f6e 2077 6865 6e20 6120  sruption when a 
+00019970: 6e6f 6465 2074 6861 7420 6861 7320 6265  node that has be
+00019980: 656e 2070 6172 7469 7469 6f6e 6564 2061  en partitioned a
+00019990: 7761 790a 2020 2020 2020 2020 7265 6a6f  way.        rejo
+000199a0: 696e 7320 7468 6520 636c 7573 7465 722e  ins the cluster.
+000199b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000199c0: 2064 6566 2067 6574 5f62 6174 6368 5f61   def get_batch_a
+000199d0: 7070 656e 6428 7365 6c66 2920 2d3e 2062  ppend(self) -> b
+000199e0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+000199f0: 0a20 2020 2020 2020 2060 6261 7463 685f  .        `batch_
+00019a00: 6170 7065 6e64 603a 2042 6174 6368 6573  append`: Batches
+00019a10: 2065 7665 7279 2061 7070 656e 6420 6d73   every append ms
+00019a20: 6720 6966 2061 6e79 2061 7070 656e 6420  g if any append 
+00019a30: 6d73 6720 616c 7265 6164 7920 6578 6973  msg already exis
+00019a40: 7473 0a20 2020 2020 2020 2022 2222 0a20  ts.        """. 
+00019a50: 2020 2064 6566 2073 6574 5f62 6174 6368     def set_batch
+00019a60: 5f61 7070 656e 6428 7365 6c66 2c20 6261  _append(self, ba
+00019a70: 7463 685f 6170 7065 6e64 3a20 626f 6f6c  tch_append: bool
+00019a80: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00019a90: 2020 2022 2222 0a20 2020 2020 2020 2060     """.        `
+00019aa0: 6261 7463 685f 6170 7065 6e64 603a 2042  batch_append`: B
+00019ab0: 6174 6368 6573 2065 7665 7279 2061 7070  atches every app
+00019ac0: 656e 6420 6d73 6720 6966 2061 6e79 2061  end msg if any a
+00019ad0: 7070 656e 6420 6d73 6720 616c 7265 6164  ppend msg alread
+00019ae0: 7920 6578 6973 7473 0a20 2020 2020 2020  y exists.       
+00019af0: 2022 2222 0a20 2020 2064 6566 2067 6574   """.    def get
+00019b00: 5f73 6b69 705f 6263 6173 745f 636f 6d6d  _skip_bcast_comm
+00019b10: 6974 2873 656c 6629 202d 3e20 626f 6f6c  it(self) -> bool
+00019b20: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00019b30: 2020 2020 2020 6073 6b69 705f 6263 6173        `skip_bcas
+00019b40: 745f 636f 6d6d 6974 603a 2044 6f6e 2774  t_commit`: Don't
+00019b50: 2062 726f 6164 6361 7374 2061 6e20 656d   broadcast an em
+00019b60: 7074 7920 7261 6674 2065 6e74 7279 2074  pty raft entry t
+00019b70: 6f20 6e6f 7469 6679 2066 6f6c 6c6f 7765  o notify followe
+00019b80: 7220 746f 2063 6f6d 6d69 7420 616e 2065  r to commit an e
+00019b90: 6e74 7279 2e0a 2020 2020 2020 2020 5468  ntry..        Th
+00019ba0: 6973 206d 6179 206d 616b 6520 666f 6c6c  is may make foll
+00019bb0: 6f77 6572 2077 6169 7420 6120 6c6f 6e67  ower wait a long
+00019bc0: 6572 2074 696d 6520 746f 2061 7070 6c79  er time to apply
+00019bd0: 2061 6e20 656e 7472 792e 2054 6869 7320   an entry. This 
+00019be0: 636f 6e66 6967 7572 6174 696f 6e0a 2020  configuration.  
+00019bf0: 2020 2020 2020 4d61 7920 6166 6665 6374        May affect
+00019c00: 2070 726f 706f 7361 6c20 666f 7277 6172   proposal forwar
+00019c10: 6469 6e67 2061 6e64 2066 6f6c 6c6f 7765  ding and followe
+00019c20: 7220 7265 6164 2e0a 2020 2020 2020 2020  r read..        
+00019c30: 2222 220a 2020 2020 6465 6620 7365 745f  """.    def set_
+00019c40: 736b 6970 5f62 6361 7374 5f63 6f6d 6d69  skip_bcast_commi
+00019c50: 7428 7365 6c66 2c20 736b 6970 5f62 6361  t(self, skip_bca
+00019c60: 7374 5f63 6f6d 6d69 743a 2062 6f6f 6c29  st_commit: bool)
+00019c70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00019c80: 2020 2222 220a 2020 2020 2020 2020 6073    """.        `s
+00019c90: 6b69 705f 6263 6173 745f 636f 6d6d 6974  kip_bcast_commit
+00019ca0: 603a 2044 6f6e 2774 2062 726f 6164 6361  `: Don't broadca
+00019cb0: 7374 2061 6e20 656d 7074 7920 7261 6674  st an empty raft
+00019cc0: 2065 6e74 7279 2074 6f20 6e6f 7469 6679   entry to notify
+00019cd0: 2066 6f6c 6c6f 7765 7220 746f 2063 6f6d   follower to com
+00019ce0: 6d69 7420 616e 2065 6e74 7279 2e0a 2020  mit an entry..  
+00019cf0: 2020 2020 2020 5468 6973 206d 6179 206d        This may m
+00019d00: 616b 6520 666f 6c6c 6f77 6572 2077 6169  ake follower wai
+00019d10: 7420 6120 6c6f 6e67 6572 2074 696d 6520  t a longer time 
+00019d20: 746f 2061 7070 6c79 2061 6e20 656e 7472  to apply an entr
+00019d30: 792e 2054 6869 7320 636f 6e66 6967 7572  y. This configur
+00019d40: 6174 696f 6e0a 2020 2020 2020 2020 4d61  ation.        Ma
+00019d50: 7920 6166 6665 6374 2070 726f 706f 7361  y affect proposa
+00019d60: 6c20 666f 7277 6172 6469 6e67 2061 6e64  l forwarding and
+00019d70: 2066 6f6c 6c6f 7765 7220 7265 6164 2e0a   follower read..
+00019d80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00019d90: 6465 6620 6765 745f 7072 696f 7269 7479  def get_priority
+00019da0: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+00019db0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00019dc0: 2020 2060 7072 696f 7269 7479 603a 2054     `priority`: T
+00019dd0: 6865 2065 6c65 6374 696f 6e20 7072 696f  he election prio
+00019de0: 7269 7479 206f 6620 7468 6973 206e 6f64  rity of this nod
+00019df0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+00019e00: 2020 2064 6566 2073 6574 5f70 7269 6f72     def set_prior
+00019e10: 6974 7928 7365 6c66 2c20 7072 696f 7269  ity(self, priori
+00019e20: 7479 3a20 696e 7429 202d 3e20 4e6f 6e65  ty: int) -> None
+00019e30: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00019e40: 2020 2020 2020 6070 7269 6f72 6974 7960        `priority`
+00019e50: 3a20 5468 6520 656c 6563 7469 6f6e 2070  : The election p
+00019e60: 7269 6f72 6974 7920 6f66 2074 6869 7320  riority of this 
+00019e70: 6e6f 6465 2e0a 2020 2020 2020 2020 2222  node..        ""
+00019e80: 220a 2020 2020 6465 6620 6765 745f 6d61  ".    def get_ma
+00019e90: 785f 756e 636f 6d6d 6974 7465 645f 7369  x_uncommitted_si
+00019ea0: 7a65 2873 656c 6629 202d 3e20 696e 743a  ze(self) -> int:
+00019eb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00019ec0: 2020 2020 2060 6d61 785f 756e 636f 6d6d       `max_uncomm
+00019ed0: 6974 7465 645f 7369 7a65 603a 2053 7065  itted_size`: Spe
+00019ee0: 6369 6679 206d 6178 696d 756d 206f 6620  cify maximum of 
+00019ef0: 756e 636f 6d6d 6974 7465 6420 656e 7472  uncommitted entr
+00019f00: 7920 7369 7a65 2e0a 2020 2020 2020 2020  y size..        
+00019f10: 5768 656e 2074 6869 7320 6c69 6d69 7420  When this limit 
+00019f20: 6973 2072 6561 6368 6564 2c20 616c 6c20  is reached, all 
+00019f30: 7072 6f70 6f73 616c 7320 746f 2061 7070  proposals to app
+00019f40: 656e 6420 6e65 7720 6c6f 6720 7769 6c6c  end new log will
+00019f50: 2062 6520 6472 6f70 7065 640a 2020 2020   be dropped.    
+00019f60: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+00019f70: 7365 745f 6d61 785f 756e 636f 6d6d 6974  set_max_uncommit
+00019f80: 7465 645f 7369 7a65 2873 656c 662c 206d  ted_size(self, m
+00019f90: 6178 5f75 6e63 6f6d 6d69 7474 6564 5f73  ax_uncommitted_s
+00019fa0: 697a 653a 2069 6e74 2920 2d3e 204e 6f6e  ize: int) -> Non
+00019fb0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00019fc0: 2020 2020 2020 2060 6d61 785f 756e 636f         `max_unco
+00019fd0: 6d6d 6974 7465 645f 7369 7a65 603a 2053  mmitted_size`: S
+00019fe0: 7065 6369 6679 206d 6178 696d 756d 206f  pecify maximum o
+00019ff0: 6620 756e 636f 6d6d 6974 7465 6420 656e  f uncommitted en
+0001a000: 7472 7920 7369 7a65 2e0a 2020 2020 2020  try size..      
+0001a010: 2020 5768 656e 2074 6869 7320 6c69 6d69    When this limi
+0001a020: 7420 6973 2072 6561 6368 6564 2c20 616c  t is reached, al
+0001a030: 6c20 7072 6f70 6f73 616c 7320 746f 2061  l proposals to a
+0001a040: 7070 656e 6420 6e65 7720 6c6f 6720 7769  ppend new log wi
+0001a050: 6c6c 2062 6520 6472 6f70 7065 640a 2020  ll be dropped.  
+0001a060: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0001a070: 6620 6765 745f 6d61 785f 636f 6d6d 6974  f get_max_commit
+0001a080: 7465 645f 7369 7a65 5f70 6572 5f72 6561  ted_size_per_rea
+0001a090: 6479 2873 656c 6629 202d 3e20 696e 743a  dy(self) -> int:
+0001a0a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001a0b0: 2020 2020 2060 6d61 785f 636f 6d6d 6974       `max_commit
+0001a0c0: 7465 645f 7369 7a65 5f70 6572 5f72 6561  ted_size_per_rea
+0001a0d0: 6479 603a 204d 6178 2073 697a 6520 666f  dy`: Max size fo
+0001a0e0: 7220 636f 6d6d 6974 7465 6420 656e 7472  r committed entr
+0001a0f0: 6965 7320 696e 2061 2060 5265 6164 7960  ies in a `Ready`
+0001a100: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001a110: 2020 6465 6620 7365 745f 6d61 785f 636f    def set_max_co
+0001a120: 6d6d 6974 7465 645f 7369 7a65 5f70 6572  mmitted_size_per
+0001a130: 5f72 6561 6479 280a 2020 2020 2020 2020  _ready(.        
+0001a140: 7365 6c66 2c20 6d61 785f 636f 6d6d 6974  self, max_commit
+0001a150: 7465 645f 7369 7a65 5f70 6572 5f72 6561  ted_size_per_rea
+0001a160: 6479 3a20 696e 740a 2020 2020 2920 2d3e  dy: int.    ) ->
+0001a170: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0001a180: 2222 0a20 2020 2020 2020 2060 6d61 785f  "".        `max_
+0001a190: 636f 6d6d 6974 7465 645f 7369 7a65 5f70  committed_size_p
+0001a1a0: 6572 5f72 6561 6479 603a 204d 6178 2073  er_ready`: Max s
+0001a1b0: 697a 6520 666f 7220 636f 6d6d 6974 7465  ize for committe
+0001a1c0: 6420 656e 7472 6965 7320 696e 2061 2060  d entries in a `
+0001a1d0: 5265 6164 7960 2e0a 2020 2020 2020 2020  Ready`..        
+0001a1e0: 2222 220a 2020 2020 6465 6620 7661 6c69  """.    def vali
+0001a1f0: 6461 7465 2873 656c 6629 202d 3e20 4e6f  date(self) -> No
+0001a200: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
+0001a210: 756e 7320 7661 6c69 6461 7469 6f6e 7320  uns validations 
+0001a220: 6167 6169 6e73 7420 7468 6520 636f 6e66  against the conf
+0001a230: 6967 2e22 2222 0a0a 636c 6173 7320 436f  ig."""..class Co
+0001a240: 6e66 6967 285f 5f41 5049 5f43 6f6e 6669  nfig(__API_Confi
+0001a250: 6729 3a0a 2020 2020 2222 220a 2020 2020  g):.    """.    
+0001a260: 436f 6e66 6967 2063 6f6e 7461 696e 7320  Config contains 
+0001a270: 7468 6520 7061 7261 6d65 7465 7273 2074  the parameters t
+0001a280: 6f20 7374 6172 7420 6120 7261 6674 2e0a  o start a raft..
+0001a290: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+0001a2a0: 205f 5f69 6e69 745f 5f28 0a20 2020 2020   __init__(.     
+0001a2b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0001a2c0: 202a 2c0a 2020 2020 2020 2020 6964 3a20   *,.        id: 
+0001a2d0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+0001a2e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 656c  None,.        el
+0001a2f0: 6563 7469 6f6e 5f74 6963 6b3a 204f 7074  ection_tick: Opt
+0001a300: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+0001a310: 652c 0a20 2020 2020 2020 2068 6561 7274  e,.        heart
+0001a320: 6265 6174 5f74 6963 6b3a 204f 7074 696f  beat_tick: Optio
+0001a330: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
+0001a340: 0a20 2020 2020 2020 2061 7070 6c69 6564  .        applied
+0001a350: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0001a360: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001a370: 6d61 785f 7369 7a65 5f70 6572 5f6d 7367  max_size_per_msg
+0001a380: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0001a390: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001a3a0: 6d61 785f 696e 666c 6967 6874 5f6d 7367  max_inflight_msg
+0001a3b0: 733a 204f 7074 696f 6e61 6c5b 696e 745d  s: Optional[int]
+0001a3c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001a3d0: 2063 6865 636b 5f71 756f 7275 6d3a 204f   check_quorum: O
+0001a3e0: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
+0001a3f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7072  None,.        pr
+0001a400: 655f 766f 7465 3a20 4f70 7469 6f6e 616c  e_vote: Optional
+0001a410: 5b62 6f6f 6c5d 203d 204e 6f6e 652c 0a20  [bool] = None,. 
+0001a420: 2020 2020 2020 206d 696e 5f65 6c65 6374         min_elect
+0001a430: 696f 6e5f 7469 636b 3a20 4f70 7469 6f6e  ion_tick: Option
+0001a440: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
+0001a450: 2020 2020 2020 2020 6d61 785f 656c 6563          max_elec
+0001a460: 7469 6f6e 5f74 6963 6b3a 204f 7074 696f  tion_tick: Optio
+0001a470: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
+0001a480: 0a20 2020 2020 2020 2072 6561 645f 6f6e  .        read_on
+0001a490: 6c79 5f6f 7074 696f 6e3a 204f 7074 696f  ly_option: Optio
+0001a4a0: 6e61 6c5b 2252 6561 644f 6e6c 794f 7074  nal["ReadOnlyOpt
+0001a4b0: 696f 6e22 5d20 3d20 4e6f 6e65 2c0a 2020  ion"] = None,.  
+0001a4c0: 2020 2020 2020 736b 6970 5f62 6361 7374        skip_bcast
+0001a4d0: 5f63 6f6d 6d69 743a 204f 7074 696f 6e61  _commit: Optiona
+0001a4e0: 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65 2c0a  l[bool] = None,.
+0001a4f0: 2020 2020 2020 2020 6261 7463 685f 6170          batch_ap
+0001a500: 7065 6e64 3a20 4f70 7469 6f6e 616c 5b62  pend: Optional[b
+0001a510: 6f6f 6c5d 203d 204e 6f6e 652c 0a20 2020  ool] = None,.   
+0001a520: 2020 2020 2070 7269 6f72 6974 793a 204f       priority: O
+0001a530: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+0001a540: 6f6e 652c 0a20 2020 2020 2020 206d 6178  one,.        max
+0001a550: 5f75 6e63 6f6d 6d69 7474 6564 5f73 697a  _uncommitted_siz
+0001a560: 653a 204f 7074 696f 6e61 6c5b 696e 745d  e: Optional[int]
+0001a570: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001a580: 206d 6178 5f63 6f6d 6d69 7474 6564 5f73   max_committed_s
+0001a590: 697a 655f 7065 725f 7265 6164 793a 204f  ize_per_ready: O
+0001a5a0: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+0001a5b0: 6f6e 652c 0a20 2020 2029 202d 3e20 4e6f  one,.    ) -> No
+0001a5c0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+0001a5d0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+0001a5e0: 643a 2054 6865 2069 6465 6e74 6974 7920  d: The identity 
+0001a5f0: 6f66 2074 6865 206c 6f63 616c 2072 6166  of the local raf
+0001a600: 742e 2049 7420 6361 6e6e 6f74 2062 6520  t. It cannot be 
+0001a610: 302c 2061 6e64 206d 7573 7420 6265 2075  0, and must be u
+0001a620: 6e69 7175 6520 696e 2074 6865 2067 726f  nique in the gro
+0001a630: 7570 2e0a 0a20 2020 2020 2020 203a 7061  up...        :pa
+0001a640: 7261 6d20 656c 6563 7469 6f6e 5f74 6963  ram election_tic
+0001a650: 6b3a 2054 6865 206e 756d 6265 7220 6f66  k: The number of
+0001a660: 206e 6f64 652e 7469 636b 2069 6e76 6f63   node.tick invoc
+0001a670: 6174 696f 6e73 2074 6861 7420 6d75 7374  ations that must
+0001a680: 2070 6173 7320 6265 7477 6565 6e0a 2020   pass between.  
+0001a690: 2020 2020 2020 656c 6563 7469 6f6e 732e        elections.
+0001a6a0: 2054 6861 7420 6973 2c20 6966 2061 2066   That is, if a f
+0001a6b0: 6f6c 6c6f 7765 7220 646f 6573 206e 6f74  ollower does not
+0001a6c0: 2072 6563 6569 7665 2061 6e79 206d 6573   receive any mes
+0001a6d0: 7361 6765 2066 726f 6d20 7468 650a 2020  sage from the.  
+0001a6e0: 2020 2020 2020 6c65 6164 6572 206f 6620        leader of 
+0001a6f0: 6375 7272 656e 7420 7465 726d 2062 6566  current term bef
+0001a700: 6f72 6520 456c 6563 7469 6f6e 5469 636b  ore ElectionTick
+0001a710: 2068 6173 2065 6c61 7073 6564 2c20 6974   has elapsed, it
+0001a720: 2077 696c 6c20 6265 636f 6d65 0a20 2020   will become.   
+0001a730: 2020 2020 2063 616e 6469 6461 7465 2061       candidate a
+0001a740: 6e64 2073 7461 7274 2061 6e20 656c 6563  nd start an elec
+0001a750: 7469 6f6e 2e20 656c 6563 7469 6f6e 5f74  tion. election_t
+0001a760: 6963 6b20 6d75 7374 2062 6520 6772 6561  ick must be grea
+0001a770: 7465 7220 7468 616e 0a20 2020 2020 2020  ter than.       
+0001a780: 2048 6561 7274 6265 6174 5469 636b 2e20   HeartbeatTick. 
+0001a790: 5765 2073 7567 6765 7374 2065 6c65 6374  We suggest elect
+0001a7a0: 696f 6e5f 7469 636b 203d 2031 3020 2a20  ion_tick = 10 * 
+0001a7b0: 4865 6172 7462 6561 7454 6963 6b20 746f  HeartbeatTick to
+0001a7c0: 2061 766f 6964 0a20 2020 2020 2020 2075   avoid.        u
+0001a7d0: 6e6e 6563 6573 7361 7279 206c 6561 6465  nnecessary leade
+0001a7e0: 7220 7377 6974 6368 696e 670a 0a20 2020  r switching..   
+0001a7f0: 2020 2020 203a 7061 7261 6d20 6865 6172       :param hear
+0001a800: 7462 6561 745f 7469 636b 3a20 4865 6172  tbeat_tick: Hear
+0001a810: 7462 6561 7454 6963 6b20 6973 2074 6865  tbeatTick is the
+0001a820: 206e 756d 6265 7220 6f66 206e 6f64 652e   number of node.
+0001a830: 7469 636b 2069 6e76 6f63 6174 696f 6e73  tick invocations
+0001a840: 2074 6861 7420 6d75 7374 2070 6173 7320   that must pass 
+0001a850: 6265 7477 6565 6e0a 2020 2020 2020 2020  between.        
+0001a860: 6865 6172 7462 6561 7473 2e20 5468 6174  heartbeats. That
+0001a870: 2069 732c 2061 206c 6561 6465 7220 7365   is, a leader se
+0001a880: 6e64 7320 6865 6172 7462 6561 7420 6d65  nds heartbeat me
+0001a890: 7373 6167 6573 2074 6f20 6d61 696e 7461  ssages to mainta
+0001a8a0: 696e 2069 7473 0a20 2020 2020 2020 206c  in its.        l
+0001a8b0: 6561 6465 7273 6869 7020 6576 6572 7920  eadership every 
+0001a8c0: 6865 6172 7462 6561 7420 7469 636b 732e  heartbeat ticks.
+0001a8d0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001a8e0: 2061 7070 6c69 6564 3a20 4170 706c 6965   applied: Applie
+0001a8f0: 6420 6973 2074 6865 206c 6173 7420 6170  d is the last ap
+0001a900: 706c 6965 6420 696e 6465 782e 2049 7420  plied index. It 
+0001a910: 7368 6f75 6c64 206f 6e6c 7920 6265 2073  should only be s
+0001a920: 6574 2077 6865 6e20 7265 7374 6172 7469  et when restarti
+0001a930: 6e67 0a20 2020 2020 2020 2072 6166 742e  ng.        raft.
+0001a940: 2072 6166 7420 7769 6c6c 206e 6f74 2072   raft will not r
+0001a950: 6574 7572 6e20 656e 7472 6965 7320 746f  eturn entries to
+0001a960: 2074 6865 2061 7070 6c69 6361 7469 6f6e   the application
+0001a970: 2073 6d61 6c6c 6572 206f 7220 6571 7561   smaller or equa
+0001a980: 6c20 746f 2041 7070 6c69 6564 2e0a 2020  l to Applied..  
+0001a990: 2020 2020 2020 4966 2041 7070 6c69 6564        If Applied
+0001a9a0: 2069 7320 756e 7365 7420 7768 656e 2072   is unset when r
+0001a9b0: 6573 7461 7274 696e 672c 2072 6166 7420  estarting, raft 
+0001a9c0: 6d69 6768 7420 7265 7475 726e 2070 7265  might return pre
+0001a9d0: 7669 6f75 7320 6170 706c 6965 6420 656e  vious applied en
+0001a9e0: 7472 6965 732e 0a20 2020 2020 2020 2054  tries..        T
+0001a9f0: 6869 7320 6973 2061 2076 6572 7920 6170  his is a very ap
+0001aa00: 706c 6963 6174 696f 6e20 6465 7065 6e64  plication depend
+0001aa10: 656e 7420 636f 6e66 6967 7572 6174 696f  ent configuratio
+0001aa20: 6e2e 0a0a 2020 2020 2020 2020 3a70 6172  n...        :par
+0001aa30: 616d 206d 6178 5f73 697a 655f 7065 725f  am max_size_per_
+0001aa40: 6d73 673a 204c 696d 6974 2074 6865 206d  msg: Limit the m
+0001aa50: 6178 2073 697a 6520 6f66 2065 6163 6820  ax size of each 
+0001aa60: 6170 7065 6e64 206d 6573 7361 6765 2e20  append message. 
+0001aa70: 536d 616c 6c65 7220 7661 6c75 6520 6c6f  Smaller value lo
+0001aa80: 7765 7273 0a20 2020 2020 2020 2074 6865  wers.        the
+0001aa90: 2072 6166 7420 7265 636f 7665 7279 2063   raft recovery c
+0001aaa0: 6f73 7428 696e 6974 6961 6c20 7072 6f62  ost(initial prob
+0001aab0: 696e 6720 616e 6420 6d65 7373 6167 6520  ing and message 
+0001aac0: 6c6f 7374 2064 7572 696e 6720 6e6f 726d  lost during norm
+0001aad0: 616c 206f 7065 7261 7469 6f6e 292e 0a20  al operation).. 
+0001aae0: 2020 2020 2020 204f 6e20 7468 6520 6f74         On the ot
+0001aaf0: 6865 7220 7369 6465 2c20 6974 206d 6967  her side, it mig
+0001ab00: 6874 2061 6666 6563 7420 7468 6520 7468  ht affect the th
+0001ab10: 726f 7567 6870 7574 2064 7572 696e 6720  roughput during 
+0001ab20: 6e6f 726d 616c 2072 6570 6c69 6361 7469  normal replicati
+0001ab30: 6f6e 2e0a 2020 2020 2020 2020 4e6f 7465  on..        Note
+0001ab40: 3a20 6d61 7468 2e4d 6178 5575 7369 7a65  : math.MaxUusize
+0001ab50: 3634 2066 6f72 2075 6e6c 696d 6974 6564  64 for unlimited
+0001ab60: 2c20 3020 666f 7220 6174 206d 6f73 7420  , 0 for at most 
+0001ab70: 6f6e 6520 656e 7472 7920 7065 7220 6d65  one entry per me
+0001ab80: 7373 6167 652e 0a0a 2020 2020 2020 2020  ssage...        
+0001ab90: 3a70 6172 616d 206d 6178 5f69 6e66 6c69  :param max_infli
+0001aba0: 6768 745f 6d73 6773 3a20 4c69 6d69 7420  ght_msgs: Limit 
+0001abb0: 7468 6520 6d61 7820 6e75 6d62 6572 206f  the max number o
+0001abc0: 6620 696e 2d66 6c69 6768 7420 6170 7065  f in-flight appe
+0001abd0: 6e64 206d 6573 7361 6765 7320 6475 7269  nd messages duri
+0001abe0: 6e67 206f 7074 696d 6973 7469 630a 2020  ng optimistic.  
+0001abf0: 2020 2020 2020 7265 706c 6963 6174 696f        replicatio
+0001ac00: 6e20 7068 6173 652e 2054 6865 2061 7070  n phase. The app
+0001ac10: 6c69 6361 7469 6f6e 2074 7261 6e73 706f  lication transpo
+0001ac20: 7274 6174 696f 6e20 6c61 7965 7220 7573  rtation layer us
+0001ac30: 7561 6c6c 7920 6861 7320 6974 7320 6f77  ually has its ow
+0001ac40: 6e20 7365 6e64 696e 670a 2020 2020 2020  n sending.      
+0001ac50: 2020 6275 6666 6572 206f 7665 7220 5443    buffer over TC
+0001ac60: 502f 5544 502e 2053 6574 2074 6f20 6176  P/UDP. Set to av
+0001ac70: 6f69 6420 6f76 6572 666c 6f77 696e 6720  oid overflowing 
+0001ac80: 7468 6174 2073 656e 6469 6e67 2062 7566  that sending buf
+0001ac90: 6665 722e 0a0a 2020 2020 2020 2020 3a70  fer...        :p
+0001aca0: 6172 616d 2063 6865 636b 5f71 756f 7275  aram check_quoru
+0001acb0: 6d3a 2053 7065 6369 6679 2069 6620 7468  m: Specify if th
+0001acc0: 6520 6c65 6164 6572 2073 686f 756c 6420  e leader should 
+0001acd0: 6368 6563 6b20 7175 6f72 756d 2061 6374  check quorum act
+0001ace0: 6976 6974 792e 204c 6561 6465 7220 7374  ivity. Leader st
+0001acf0: 6570 7320 646f 776e 2077 6865 6e0a 2020  eps down when.  
+0001ad00: 2020 2020 2020 7175 6f72 756d 2069 7320        quorum is 
+0001ad10: 6e6f 7420 6163 7469 7665 2066 6f72 2061  not active for a
+0001ad20: 6e20 656c 6563 7469 6f6e 5469 6d65 6f75  n electionTimeou
+0001ad30: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
+0001ad40: 616d 2070 7265 5f76 6f74 653a 2045 6e61  am pre_vote: Ena
+0001ad50: 626c 6573 2074 6865 2050 7265 2d56 6f74  bles the Pre-Vot
+0001ad60: 6520 616c 676f 7269 7468 6d20 6465 7363  e algorithm desc
+0001ad70: 7269 6265 6420 696e 2072 6166 7420 7468  ribed in raft th
+0001ad80: 6573 6973 2073 6563 7469 6f6e 0a20 2020  esis section.   
+0001ad90: 2020 2020 2039 2e36 2e20 5468 6973 2070       9.6. This p
+0001ada0: 7265 7665 6e74 7320 6469 7372 7570 7469  revents disrupti
+0001adb0: 6f6e 2077 6865 6e20 6120 6e6f 6465 2074  on when a node t
+0001adc0: 6861 7420 6861 7320 6265 656e 2070 6172  hat has been par
+0001add0: 7469 7469 6f6e 6564 2061 7761 790a 2020  titioned away.  
+0001ade0: 2020 2020 2020 7265 6a6f 696e 7320 7468        rejoins th
+0001adf0: 6520 636c 7573 7465 722e 0a0a 2020 2020  e cluster...    
+0001ae00: 2020 2020 3a70 6172 616d 206d 696e 5f65      :param min_e
+0001ae10: 6c65 6374 696f 6e5f 7469 636b 3a20 5468  lection_tick: Th
+0001ae20: 6520 7261 6e67 6520 6f66 2065 6c65 6374  e range of elect
+0001ae30: 696f 6e20 7469 6d65 6f75 742e 2049 6e20  ion timeout. In 
+0001ae40: 736f 6d65 2063 6173 6573 2c20 7765 2068  some cases, we h
+0001ae50: 6f70 6520 736f 6d65 206e 6f64 6573 2068  ope some nodes h
+0001ae60: 6173 206c 6573 7320 706f 7373 6962 696c  as less possibil
+0001ae70: 6974 790a 2020 2020 2020 2020 746f 2062  ity.        to b
+0001ae80: 6563 6f6d 6520 6c65 6164 6572 2e20 5468  ecome leader. Th
+0001ae90: 6973 2063 6f6e 6669 6775 7261 7469 6f6e  is configuration
+0001aea0: 2065 6e73 7572 6573 2074 6861 7420 7468   ensures that th
+0001aeb0: 6520 7261 6e64 6f6d 697a 6564 2065 6c65  e randomized ele
+0001aec0: 6374 696f 6e5f 7469 6d65 6f75 740a 2020  ction_timeout.  
+0001aed0: 2020 2020 2020 7769 6c6c 2061 6c77 6179        will alway
+0001aee0: 7320 6265 2073 7569 7420 696e 205b 6d69  s be suit in [mi
+0001aef0: 6e5f 656c 6563 7469 6f6e 5f74 6963 6b2c  n_election_tick,
+0001af00: 206d 6178 5f65 6c65 6374 696f 6e5f 7469   max_election_ti
+0001af10: 636b 292e 0a20 2020 2020 2020 2049 6620  ck)..        If 
+0001af20: 6974 2069 7320 302c 2074 6865 6e20 656c  it is 0, then el
+0001af30: 6563 7469 6f6e 5f74 6963 6b20 7769 6c6c  ection_tick will
+0001af40: 2062 6520 6368 6f73 656e 2e0a 0a20 2020   be chosen...   
+0001af50: 2020 2020 203a 7061 7261 6d20 6d61 785f       :param max_
+0001af60: 656c 6563 7469 6f6e 5f74 6963 6b3a 2049  election_tick: I
+0001af70: 6620 6974 2069 7320 302c 2074 6865 6e20  f it is 0, then 
+0001af80: 3220 2a20 656c 6563 7469 6f6e 5f74 6963  2 * election_tic
+0001af90: 6b20 7769 6c6c 2062 6520 6368 6f73 656e  k will be chosen
+0001afa0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0001afb0: 6d20 7265 6164 5f6f 6e6c 795f 6f70 7469  m read_only_opti
+0001afc0: 6f6e 3a20 4368 6f6f 7365 2074 6865 206c  on: Choose the l
+0001afd0: 696e 6561 7269 7a61 6269 6c69 7479 206d  inearizability m
+0001afe0: 6f64 6520 6f72 2074 6865 206c 6561 7365  ode or the lease
+0001aff0: 206d 6f64 6520 746f 2072 6561 6420 6461   mode to read da
+0001b000: 7461 2e20 4966 2079 6f75 2064 6f6e e280  ta. If you don..
+0001b010: 9974 2063 6172 6520 6162 6f75 7420 7468  .t care about th
+0001b020: 6520 7265 6164 2063 6f6e 7369 7374 656e  e read consisten
+0001b030: 6379 2061 6e64 2077 616e 7420 6120 6869  cy and want a hi
+0001b040: 6768 6572 2072 6561 6420 7065 7266 6f72  gher read perfor
+0001b050: 6d61 6e63 652c 2079 6f75 2063 616e 2075  mance, you can u
+0001b060: 7365 2074 6865 206c 6561 7365 206d 6f64  se the lease mod
+0001b070: 652e 0a20 2020 2020 2020 2053 6574 7469  e..        Setti
+0001b080: 6e67 2074 6869 7320 746f 2060 4c65 6173  ng this to `Leas
+0001b090: 6542 6173 6564 6020 7265 7175 6972 6573  eBased` requires
+0001b0a0: 2060 6368 6563 6b5f 7175 6f72 756d 203d   `check_quorum =
+0001b0b0: 2074 7275 6560 2e0a 0a20 2020 2020 2020   true`...       
+0001b0c0: 203a 7061 7261 6d20 736b 6970 5f62 6361   :param skip_bca
+0001b0d0: 7374 5f63 6f6d 6d69 743a 2044 6f6e 2774  st_commit: Don't
+0001b0e0: 2062 726f 6164 6361 7374 2061 6e20 656d   broadcast an em
+0001b0f0: 7074 7920 7261 6674 2065 6e74 7279 2074  pty raft entry t
+0001b100: 6f20 6e6f 7469 6679 2066 6f6c 6c6f 7765  o notify followe
+0001b110: 7220 746f 2063 6f6d 6d69 7420 616e 2065  r to commit an e
+0001b120: 6e74 7279 2e0a 2020 2020 2020 2020 5468  ntry..        Th
+0001b130: 6973 206d 6179 206d 616b 6520 666f 6c6c  is may make foll
+0001b140: 6f77 6572 2077 6169 7420 6120 6c6f 6e67  ower wait a long
+0001b150: 6572 2074 696d 6520 746f 2061 7070 6c79  er time to apply
+0001b160: 2061 6e20 656e 7472 792e 2054 6869 7320   an entry. This 
+0001b170: 636f 6e66 6967 7572 6174 696f 6e0a 2020  configuration.  
+0001b180: 2020 2020 2020 4d61 7920 6166 6665 6374        May affect
+0001b190: 2070 726f 706f 7361 6c20 666f 7277 6172   proposal forwar
+0001b1a0: 6469 6e67 2061 6e64 2066 6f6c 6c6f 7765  ding and followe
+0001b1b0: 7220 7265 6164 2e0a 0a20 2020 2020 2020  r read...       
+0001b1c0: 203a 7061 7261 6d20 6261 7463 685f 6170   :param batch_ap
+0001b1d0: 7065 6e64 3a20 4261 7463 6865 7320 6576  pend: Batches ev
+0001b1e0: 6572 7920 6170 7065 6e64 206d 7367 2069  ery append msg i
+0001b1f0: 6620 616e 7920 6170 7065 6e64 206d 7367  f any append msg
+0001b200: 2061 6c72 6561 6479 2065 7869 7374 730a   already exists.
+0001b210: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001b220: 7072 696f 7269 7479 3a20 5468 6520 656c  priority: The el
+0001b230: 6563 7469 6f6e 2070 7269 6f72 6974 7920  ection priority 
+0001b240: 6f66 2074 6869 7320 6e6f 6465 2e0a 0a20  of this node... 
+0001b250: 2020 2020 2020 203a 7061 7261 6d20 6d61         :param ma
+0001b260: 785f 756e 636f 6d6d 6974 7465 645f 7369  x_uncommitted_si
+0001b270: 7a65 3a20 5370 6563 6966 7920 6d61 7869  ze: Specify maxi
+0001b280: 6d75 6d20 6f66 2075 6e63 6f6d 6d69 7474  mum of uncommitt
+0001b290: 6564 2065 6e74 7279 2073 697a 652e 0a20  ed entry size.. 
+0001b2a0: 2020 2020 2020 2057 6865 6e20 7468 6973         When this
+0001b2b0: 206c 696d 6974 2069 7320 7265 6163 6865   limit is reache
+0001b2c0: 642c 2061 6c6c 2070 726f 706f 7361 6c73  d, all proposals
+0001b2d0: 2074 6f20 6170 7065 6e64 206e 6577 206c   to append new l
+0001b2e0: 6f67 2077 696c 6c20 6265 2064 726f 7070  og will be dropp
+0001b2f0: 6564 0a0a 2020 2020 2020 2020 3a70 6172  ed..        :par
+0001b300: 616d 206d 6178 5f63 6f6d 6d69 7474 6564  am max_committed
+0001b310: 5f73 697a 655f 7065 725f 7265 6164 793a  _size_per_ready:
+0001b320: 204d 6178 2073 697a 6520 666f 7220 636f   Max size for co
+0001b330: 6d6d 6974 7465 6420 656e 7472 6965 7320  mmitted entries 
+0001b340: 696e 2061 2060 5265 6164 7960 2e0a 2020  in a `Ready`..  
+0001b350: 2020 2020 2020 2222 220a 2020 2020 6465        """.    de
+0001b360: 6620 6d61 6b65 5f72 6566 2873 656c 6629  f make_ref(self)
+0001b370: 202d 3e20 2243 6f6e 6669 6752 6566 223a   -> "ConfigRef":
+0001b380: 202e 2e2e 0a20 2020 2040 7374 6174 6963   ....    @static
+0001b390: 6d65 7468 6f64 0a20 2020 2064 6566 2064  method.    def d
+0001b3a0: 6566 6175 6c74 2829 202d 3e20 2243 6f6e  efault() -> "Con
+0001b3b0: 6669 6722 3a20 2e2e 2e0a 0a63 6c61 7373  fig": .....class
+0001b3c0: 2043 6f6e 6669 6752 6566 285f 5f41 5049   ConfigRef(__API
+0001b3d0: 5f43 6f6e 6669 6729 3a0a 2020 2020 2222  _Config):.    ""
+0001b3e0: 220a 2020 2020 5265 6665 7265 6e63 6520  ".    Reference 
+0001b3f0: 7479 7065 206f 6620 3a63 6c61 7373 3a60  type of :class:`
+0001b400: 496e 666c 6967 6874 7352 6566 602e 0a20  InflightsRef`.. 
+0001b410: 2020 2022 2222 0a0a 2320 544f 444f 3a20     """..# TODO: 
+0001b420: 4164 6420 6265 6c6f 7720 696d 706c 656d  Add below implem
+0001b430: 656e 7461 7469 6f6e 2069 6620 6e65 6564  entation if need
+0001b440: 6564 2c20 6f74 6865 7277 6973 6520 7265  ed, otherwise re
+0001b450: 6d6f 7665 2062 656c 6f77 2063 6f64 6573  move below codes
+0001b460: 2e0a 2320 636c 6173 7320 5f5f 4150 495f  ..# class __API_
+0001b470: 5374 6174 7573 3a0a 2320 2020 2020 6465  Status:.#     de
+0001b480: 6620 6765 745f 6170 706c 6965 6428 7365  f get_applied(se
+0001b490: 6c66 2920 2d3e 2069 6e74 3a0a 2320 2020  lf) -> int:.#   
+0001b4a0: 2020 2020 2020 2222 2220 2222 220a 2320        """ """.# 
+0001b4b0: 2020 2020 6465 6620 7365 745f 6170 706c      def set_appl
+0001b4c0: 6965 6428 7365 6c66 2c20 6170 706c 6965  ied(self, applie
+0001b4d0: 643a 2069 6e74 2920 2d3e 204e 6f6e 653a  d: int) -> None:
+0001b4e0: 0a23 2020 2020 2020 2020 2022 2222 2022  .#         """ "
+0001b4f0: 2222 0a23 2020 2020 2064 6566 2067 6574  "".#     def get
+0001b500: 5f69 6428 7365 6c66 2920 2d3e 2069 6e74  _id(self) -> int
+0001b510: 3a0a 2320 2020 2020 2020 2020 2222 2220  :.#         """ 
+0001b520: 2222 220a 2320 2020 2020 6465 6620 7365  """.#     def se
+0001b530: 745f 6964 2873 656c 662c 2069 643a 2069  t_id(self, id: i
+0001b540: 6e74 2920 2d3e 204e 6f6e 653a 0a23 2020  nt) -> None:.#  
+0001b550: 2020 2020 2020 2022 2222 2022 2222 0a23         """ """.#
+0001b560: 2020 2020 2064 6566 2067 6574 5f68 7328       def get_hs(
+0001b570: 7365 6c66 2920 2d3e 2048 6172 6453 7461  self) -> HardSta
+0001b580: 7465 5265 663a 0a23 2020 2020 2020 2020  teRef:.#        
+0001b590: 2022 2222 2022 2222 0a23 2020 2020 2064   """ """.#     d
+0001b5a0: 6566 2073 6574 5f68 7328 7365 6c66 2c20  ef set_hs(self, 
+0001b5b0: 6873 3a20 4861 7264 5374 6174 6552 6566  hs: HardStateRef
+0001b5c0: 2920 2d3e 204e 6f6e 653a 0a23 2020 2020  ) -> None:.#    
+0001b5d0: 2020 2020 2022 2222 2022 2222 0a23 2020       """ """.#  
+0001b5e0: 2020 2064 6566 2067 6574 5f73 7328 7365     def get_ss(se
+0001b5f0: 6c66 2920 2d3e 2053 6f66 7453 7461 7465  lf) -> SoftState
+0001b600: 5265 663a 0a23 2020 2020 2020 2020 2022  Ref:.#         "
+0001b610: 2222 2022 2222 0a23 2020 2020 2064 6566  "" """.#     def
+0001b620: 2073 6574 5f73 7328 7365 6c66 2c20 7373   set_ss(self, ss
+0001b630: 3a20 536f 6674 5374 6174 6552 6566 2920  : SoftStateRef) 
+0001b640: 2d3e 204e 6f6e 653a 0a23 2020 2020 2020  -> None:.#      
+0001b650: 2020 2022 2222 2022 2222 0a23 2020 2020     """ """.#    
+0001b660: 2064 6566 2067 6574 5f70 726f 6772 6573   def get_progres
+0001b670: 7328 7365 6c66 2920 2d3e 204f 7074 696f  s(self) -> Optio
+0001b680: 6e61 6c5b 5072 6f67 7265 7373 5472 6163  nal[ProgressTrac
+0001b690: 6b65 7252 6566 5d3a 0a23 2020 2020 2020  kerRef]:.#      
+0001b6a0: 2020 2022 2222 2022 2222 0a23 2020 2020     """ """.#    
+0001b6b0: 2064 6566 2073 6574 5f70 726f 6772 6573   def set_progres
+0001b6c0: 7328 0a23 2020 2020 2020 2020 2073 656c  s(.#         sel
+0001b6d0: 662c 2074 7261 636b 6572 3a20 4f70 7469  f, tracker: Opti
+0001b6e0: 6f6e 616c 5b50 726f 6772 6573 7354 7261  onal[ProgressTra
+0001b6f0: 636b 6572 5d20 7c20 4f70 7469 6f6e 616c  cker] | Optional
+0001b700: 5b50 726f 6772 6573 7354 7261 636b 6572  [ProgressTracker
+0001b710: 5265 665d 0a23 2020 2020 2029 202d 3e20  Ref].#     ) -> 
+0001b720: 4e6f 6e65 3a0a 2320 2020 2020 2020 2020  None:.#         
+0001b730: 2222 2220 2222 220a 0a23 2063 6c61 7373  """ """..# class
+0001b740: 2049 6e4d 656d 6f72 7953 7461 7475 7328   InMemoryStatus(
+0001b750: 5f5f 4150 495f 5374 6174 7573 293a 0a23  __API_Status):.#
+0001b760: 2020 2020 2022 2222 0a23 2020 2020 2052       """.#     R
+0001b770: 6570 7265 7365 6e74 7320 7468 6520 6375  epresents the cu
+0001b780: 7272 656e 7420 7374 6174 7573 206f 6620  rrent status of 
+0001b790: 7468 6520 7261 6674 0a23 2020 2020 2022  the raft.#     "
+0001b7a0: 2222 0a0a 2320 2020 2020 6465 6620 5f5f  ""..#     def __
+0001b7b0: 696e 6974 5f5f 2873 656c 662c 2072 6166  init__(self, raf
+0001b7c0: 743a 2049 6e4d 656d 6f72 7952 6166 7429  t: InMemoryRaft)
+0001b7d0: 202d 3e20 4e6f 6e65 3a20 2e2e 2e0a 2320   -> None: ....# 
+0001b7e0: 2020 2020 6465 6620 6d61 6b65 5f72 6566      def make_ref
+0001b7f0: 2873 656c 6629 202d 3e20 5374 6174 7573  (self) -> Status
+0001b800: 5f5f 4d65 6d73 746f 7261 6765 5265 663a  __MemstorageRef:
+0001b810: 202e 2e2e 0a0a 2320 636c 6173 7320 496e   .....# class In
+0001b820: 4d65 6d6f 7279 5374 6174 7573 5265 6628  MemoryStatusRef(
+0001b830: 5f5f 4150 495f 5374 6174 7573 293a 0a23  __API_Status):.#
+0001b840: 2020 2020 2022 2222 0a23 2020 2020 2052       """.#     R
+0001b850: 6566 6572 656e 6365 2074 7970 6520 6f66  eference type of
+0001b860: 203a 636c 6173 733a 6053 7461 7475 735f   :class:`Status_
+0001b870: 5f4d 656d 7374 6f72 6167 6560 2e0a 2320  _Memstorage`..# 
+0001b880: 2020 2020 2222 220a 0a63 6c61 7373 2044      """..class D
+0001b890: 6573 7472 6f79 6564 5265 6655 7365 6445  estroyedRefUsedE
+0001b8a0: 7272 6f72 2845 7863 6570 7469 6f6e 293a  rror(Exception):
+0001b8b0: 0a20 2020 2022 2222 2022 2222 0a0a 636c  .    """ """..cl
+0001b8c0: 6173 7320 5261 6674 4572 726f 7228 4578  ass RaftError(Ex
+0001b8d0: 6365 7074 696f 6e29 3a0a 2020 2020 2222  ception):.    ""
+0001b8e0: 2220 2222 220a 0a63 6c61 7373 2045 7869  " """..class Exi
+0001b8f0: 7374 7345 7272 6f72 2852 6166 7445 7272  stsError(RaftErr
+0001b900: 6f72 293a 0a20 2020 2022 2222 0a20 2020  or):.    """.   
+0001b910: 2054 6865 206e 6f64 6520 7b69 647d 2061   The node {id} a
+0001b920: 6c72 6561 6479 2065 7869 7374 7320 696e  lready exists in
+0001b930: 2074 6865 207b 7365 747d 2073 6574 2e0a   the {set} set..
+0001b940: 2020 2020 2222 220a 0a20 2020 2069 643a      """..    id:
+0001b950: 2069 6e74 0a20 2020 2073 6574 3a20 7374   int.    set: st
+0001b960: 720a 0a63 6c61 7373 204e 6f74 4578 6973  r..class NotExis
+0001b970: 7473 2852 6166 7445 7272 6f72 293a 0a20  ts(RaftError):. 
+0001b980: 2020 2022 2222 0a20 2020 2054 6865 206e     """.    The n
+0001b990: 6f64 6520 7b69 647d 2069 7320 6e6f 7420  ode {id} is not 
+0001b9a0: 696e 2074 6865 207b 7365 747d 2073 6574  in the {set} set
+0001b9b0: 2e0a 2020 2020 2222 220a 0a20 2020 2069  ..    """..    i
+0001b9c0: 643a 2069 6e74 0a20 2020 2073 6574 3a20  d: int.    set: 
+0001b9d0: 7374 720a 0a63 6c61 7373 2043 6f64 6563  str..class Codec
+0001b9e0: 4572 726f 7228 5261 6674 4572 726f 7229  Error(RaftError)
+0001b9f0: 3a0a 2020 2020 2222 220a 2020 2020 4120  :.    """.    A 
+0001ba00: 7072 6f74 6f62 7566 206d 6573 7361 6765  protobuf message
+0001ba10: 2063 6f64 6563 2066 6169 6c65 6420 696e   codec failed in
+0001ba20: 2073 6f6d 6520 6d61 6e6e 6572 2e0a 2020   some manner..  
+0001ba30: 2020 2222 220a 0a63 6c61 7373 2043 6f6e    """..class Con
+0001ba40: 6669 6749 6e76 616c 6964 4572 726f 7228  figInvalidError(
+0001ba50: 5261 6674 4572 726f 7229 3a0a 2020 2020  RaftError):.    
+0001ba60: 2222 220a 2020 2020 5468 6520 636f 6e66  """.    The conf
+0001ba70: 6967 7572 6174 696f 6e20 6973 2069 6e76  iguration is inv
+0001ba80: 616c 6964 2e0a 2020 2020 2222 220a 0a63  alid..    """..c
+0001ba90: 6c61 7373 2050 726f 706f 7361 6c44 726f  lass ProposalDro
+0001baa0: 7070 6564 4572 726f 7228 5261 6674 4572  ppedError(RaftEr
+0001bab0: 726f 7229 3a0a 2020 2020 2222 220a 2020  ror):.    """.  
+0001bac0: 2020 5468 6520 7072 6f70 6f73 616c 206f    The proposal o
+0001bad0: 6620 6368 616e 6765 7320 7761 7320 6472  f changes was dr
+0001bae0: 6f70 7065 642e 0a20 2020 2022 2222 0a0a  opped..    """..
+0001baf0: 636c 6173 7320 5265 7175 6573 7453 6e61  class RequestSna
+0001bb00: 7073 686f 7444 726f 7070 6564 4572 726f  pshotDroppedErro
+0001bb10: 7228 5261 6674 4572 726f 7229 3a0a 2020  r(RaftError):.  
+0001bb20: 2020 2222 220a 2020 2020 5468 6520 7265    """.    The re
+0001bb30: 7175 6573 7420 736e 6170 7368 6f74 2069  quest snapshot i
+0001bb40: 7320 6472 6f70 7065 642e 0a20 2020 2022  s dropped..    "
+0001bb50: 2222 0a0a 636c 6173 7320 436f 6e66 4368  ""..class ConfCh
+0001bb60: 616e 6765 4572 726f 7228 5261 6674 4572  angeError(RaftEr
+0001bb70: 726f 7229 3a0a 2020 2020 2222 220a 2020  ror):.    """.  
+0001bb80: 2020 436f 6e66 4368 616e 6765 2070 726f    ConfChange pro
+0001bb90: 706f 7361 6c20 6973 2069 6e76 616c 6964  posal is invalid
+0001bba0: 2e0a 2020 2020 2222 220a 0a63 6c61 7373  ..    """..class
+0001bbb0: 2049 6f45 7272 6f72 2852 6166 7445 7272   IoError(RaftErr
+0001bbc0: 6f72 293a 0a20 2020 2022 2222 0a20 2020  or):.    """.   
+0001bbd0: 2041 6e20 494f 2065 7272 6f72 206f 6363   An IO error occ
+0001bbe0: 7572 7265 642e 0a20 2020 2022 2222 0a0a  urred..    """..
+0001bbf0: 636c 6173 7320 5374 6f72 6545 7272 6f72  class StoreError
+0001bc00: 2852 6166 7445 7272 6f72 293a 0a20 2020  (RaftError):.   
+0001bc10: 2022 2222 0a20 2020 2041 2073 746f 7261   """.    A stora
+0001bc20: 6765 2065 7272 6f72 206f 6363 7572 7265  ge error occurre
+0001bc30: 642e 0a20 2020 2022 2222 0a0a 636c 6173  d..    """..clas
+0001bc40: 7320 5374 6570 4c6f 6361 6c4d 7367 2852  s StepLocalMsg(R
+0001bc50: 6166 7445 7272 6f72 293a 0a20 2020 2022  aftError):.    "
+0001bc60: 2222 0a20 2020 2052 6166 7420 6361 6e6e  "".    Raft cann
+0001bc70: 6f74 2073 7465 7020 7468 6520 6c6f 6361  ot step the loca
+0001bc80: 6c20 6d65 7373 6167 652e 0a20 2020 2022  l message..    "
+0001bc90: 2222 0a0a 636c 6173 7320 5374 6570 5065  ""..class StepPe
+0001bca0: 6572 4e6f 7446 6f75 6e64 2852 6166 7445  erNotFound(RaftE
+0001bcb0: 7272 6f72 293a 0a20 2020 2022 2222 0a20  rror):.    """. 
+0001bcc0: 2020 2054 6865 2072 6166 7420 7065 6572     The raft peer
+0001bcd0: 2069 7320 6e6f 7420 666f 756e 6420 616e   is not found an
+0001bce0: 6420 7468 7573 2063 616e 6e6f 7420 7374  d thus cannot st
+0001bcf0: 6570 2e0a 2020 2020 2222 220a 0a63 6c61  ep..    """..cla
+0001bd00: 7373 2052 6166 7453 746f 7261 6765 4572  ss RaftStorageEr
+0001bd10: 726f 7228 4578 6365 7074 696f 6e29 3a0a  ror(Exception):.
+0001bd20: 2020 2020 2222 220a 2020 2020 416e 2065      """.    An e
+0001bd30: 7272 6f72 2077 6974 6820 7468 6520 7374  rror with the st
+0001bd40: 6f72 6167 652e 0a20 2020 2022 2222 0a0a  orage..    """..
+0001bd50: 636c 6173 7320 436f 6d70 6163 7465 6445  class CompactedE
+0001bd60: 7272 6f72 2852 6166 7453 746f 7261 6765  rror(RaftStorage
+0001bd70: 4572 726f 7229 3a0a 2020 2020 2222 220a  Error):.    """.
+0001bd80: 2020 2020 5468 6520 7374 6f72 6167 6520      The storage 
+0001bd90: 7761 7320 636f 6d70 6163 7465 6420 616e  was compacted an
+0001bda0: 6420 6e6f 7420 6163 6365 7373 6962 6c65  d not accessible
+0001bdb0: 0a20 2020 2022 2222 0a0a 636c 6173 7320  .    """..class 
+0001bdc0: 556e 6176 6169 6c61 626c 6545 7272 6f72  UnavailableError
+0001bdd0: 2852 6166 7453 746f 7261 6765 4572 726f  (RaftStorageErro
+0001bde0: 7229 3a0a 2020 2020 2222 220a 2020 2020  r):.    """.    
+0001bdf0: 5468 6520 6c6f 6720 6973 206e 6f74 2061  The log is not a
+0001be00: 7661 696c 6162 6c65 2e0a 2020 2020 2222  vailable..    ""
+0001be10: 220a 0a63 6c61 7373 204c 6f67 5465 6d70  "..class LogTemp
+0001be20: 6f72 6172 696c 7955 6e61 7661 696c 6162  orarilyUnavailab
+0001be30: 6c65 4572 726f 7228 5261 6674 5374 6f72  leError(RaftStor
+0001be40: 6167 6545 7272 6f72 293a 0a20 2020 2022  ageError):.    "
+0001be50: 2222 0a20 2020 2054 6865 206c 6f67 2069  "".    The log i
+0001be60: 7320 6265 696e 6720 6665 7463 6865 642e  s being fetched.
+0001be70: 0a20 2020 2022 2222 0a0a 636c 6173 7320  .    """..class 
+0001be80: 536e 6170 7368 6f74 4f75 744f 6644 6174  SnapshotOutOfDat
+0001be90: 6545 7272 6f72 2852 6166 7453 746f 7261  eError(RaftStora
+0001bea0: 6765 4572 726f 7229 3a0a 2020 2020 2222  geError):.    ""
+0001beb0: 220a 2020 2020 5468 6520 736e 6170 7368  ".    The snapsh
+0001bec0: 6f74 2069 7320 6f75 7420 6f66 2064 6174  ot is out of dat
+0001bed0: 652e 0a20 2020 2022 2222 0a0a 636c 6173  e..    """..clas
+0001bee0: 7320 536e 6170 7368 6f74 5465 6d70 6f72  s SnapshotTempor
+0001bef0: 6172 696c 7955 6e61 7661 696c 6162 6c65  arilyUnavailable
+0001bf00: 2852 6166 7453 746f 7261 6765 4572 726f  (RaftStorageErro
+0001bf10: 7229 3a0a 2020 2020 2222 220a 2020 2020  r):.    """.    
+0001bf20: 5468 6520 736e 6170 7368 6f74 2069 7320  The snapshot is 
+0001bf30: 6265 696e 6720 6372 6561 7465 642e 0a20  being created.. 
+0001bf40: 2020 2022 2222 0a0a 636c 6173 7320 4f74     """..class Ot
+0001bf50: 6865 7245 7272 6f72 2852 6166 7453 746f  herError(RaftSto
+0001bf60: 7261 6765 4572 726f 7229 3a0a 2020 2020  rageError):.    
+0001bf70: 2222 220a 2020 2020 536f 6d65 206f 7468  """.    Some oth
+0001bf80: 6572 2065 7272 6f72 206f 6363 7572 7265  er error occurre
+0001bf90: 642e 0a20 2020 2022 2222 0a              d..    """.
```

### Comparing `rraft_py-0.1.0/src/bindings/config.rs` & `rraft_py-0.1.1/src/bindings/config.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/get_entries_context.rs` & `rraft_py-0.1.1/src/bindings/get_entries_context.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/global.rs` & `rraft_py-0.1.1/src/bindings/global.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/inflights.rs` & `rraft_py-0.1.1/src/bindings/inflights.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/joint_config.rs` & `rraft_py-0.1.1/src/bindings/joint_config.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/light_ready.rs` & `rraft_py-0.1.1/src/bindings/light_ready.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/majority_config.rs` & `rraft_py-0.1.1/src/bindings/majority_config.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/peer.rs` & `rraft_py-0.1.1/src/bindings/peer.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/progress.rs` & `rraft_py-0.1.1/src/bindings/progress.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/progress_state.rs` & `rraft_py-0.1.1/src/bindings/progress_state.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/progress_tracker.rs` & `rraft_py-0.1.1/src/bindings/progress_tracker.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/raft_state.rs` & `rraft_py-0.1.1/src/bindings/raft_state.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/read_state.rs` & `rraft_py-0.1.1/src/bindings/read_state.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/readonly_option.rs` & `rraft_py-0.1.1/src/bindings/readonly_option.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/ready.rs` & `rraft_py-0.1.1/src/bindings/ready.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/snapshot_status.rs` & `rraft_py-0.1.1/src/bindings/snapshot_status.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/soft_state.rs` & `rraft_py-0.1.1/src/bindings/soft_state.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/state_role.rs` & `rraft_py-0.1.1/src/bindings/state_role.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/bindings/unstable.rs` & `rraft_py-0.1.1/src/bindings/unstable.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/external_bindings/slog.rs` & `rraft_py-0.1.1/src/external_bindings/slog.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/lib.rs` & `rraft_py-0.1.1/src/lib.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/mem_storage_bindings/mem_storage.rs` & `rraft_py-0.1.1/src/mem_storage_bindings/mem_storage.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/mem_storage_bindings/mem_storage_core.rs` & `rraft_py-0.1.1/src/mem_storage_bindings/mem_storage_core.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/mem_storage_bindings/raft.rs` & `rraft_py-0.1.1/src/mem_storage_bindings/raft.rs`

 * *Files 0% similar despite different names*

```diff
@@ -67,25 +67,14 @@
         let reference = this.call_method0(py, intern!(py, "make_ref"))?;
         reference.getattr(py, attr)
     }
 }
 
 #[pymethods]
 impl PyInMemoryRaftRef {
-    pub fn __repr__(&mut self) -> PyResult<String> {
-        self.inner.map_as_mut(|inner| {
-            format!(
-                "Raft {{ \
-                    msgs: {:?} \
-                }}",
-                inner.msgs,
-            )
-        })
-    }
-
     pub fn append_entry(&mut self, ents: &PyList) -> PyResult<bool> {
         let mut entries = ents.extract::<Vec<PyEntryMut>>()?;
 
         self.inner.map_as_mut(|inner| {
             inner.append_entry(
                 entries
                     .iter_mut()
```

### Comparing `rraft_py-0.1.0/src/mem_storage_bindings/raft_log.rs` & `rraft_py-0.1.1/src/mem_storage_bindings/raft_log.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/mem_storage_bindings/raw_node.rs` & `rraft_py-0.1.1/src/mem_storage_bindings/raw_node.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/py_storage_bindings/py_storage.rs` & `rraft_py-0.1.1/src/py_storage_bindings/py_storage.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/py_storage_bindings/raft.rs` & `rraft_py-0.1.1/src/py_storage_bindings/raft.rs`

 * *Files 0% similar despite different names*

```diff
@@ -66,25 +66,14 @@
         let reference = this.call_method0(py, intern!(py, "make_ref"))?;
         reference.getattr(py, attr)
     }
 }
 
 #[pymethods]
 impl PyRaftRef {
-    pub fn __repr__(&mut self) -> PyResult<String> {
-        self.inner.map_as_mut(|inner| {
-            format!(
-                "Raft {{ \
-                    msgs: {:?} \
-                }}",
-                inner.msgs,
-            )
-        })
-    }
-
     pub fn append_entry(&mut self, ents: &PyList) -> PyResult<bool> {
         let mut entries = ents.extract::<Vec<PyEntryMut>>()?;
 
         self.inner.map_as_mut(|inner| {
             inner.append_entry(
                 entries
                     .iter_mut()
```

### Comparing `rraft_py-0.1.0/src/py_storage_bindings/raft_log.rs` & `rraft_py-0.1.1/src/py_storage_bindings/raft_log.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/py_storage_bindings/raw_node.rs` & `rraft_py-0.1.1/src/py_storage_bindings/raw_node.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/conf_change.rs` & `rraft_py-0.1.1/src/raftpb_bindings/conf_change.rs`

 * *Files 4% similar despite different names*

```diff
@@ -1,12 +1,12 @@
-use crate::implement_type_conversion;
 use crate::utils::{
     errors::to_pyresult,
     reference::{RefMutContainer, RefMutOwner},
 };
+use crate::{deserialize_bytes, implement_type_conversion};
 use prost::Message as ProstMessage;
 use protobuf::Message as PbMessage;
 use pyo3::{intern, prelude::*, pyclass::CompareOp, types::PyBytes};
 
 use super::{conf_change_type::PyConfChangeType, conf_change_v2::PyConfChangeV2};
 
 use raft::{
@@ -30,14 +30,24 @@
 pub enum PyConfChangeMut<'p> {
     Owned(PyRefMut<'p, PyConfChange>),
     RefMut(PyConfChangeRef),
 }
 
 implement_type_conversion!(ConfChange, PyConfChangeMut);
 
+pub fn format_confchange(cc: &ConfChange, py: Python) -> String {
+    format!(
+        "ConfChange {{ change_type: {change_type:?}, node_id: {node_id:?}, context: {context:?}, id: {id:?} }}",
+        change_type = cc.get_change_type(),
+        node_id = cc.get_node_id(),
+        id = cc.get_id(),
+        context = deserialize_bytes!(cc, "confchange_context_deserializer", context, py)
+    )
+}
+
 #[pymethods]
 impl PyConfChange {
     #[new]
     pub fn new() -> Self {
         PyConfChange {
             inner: RefMutOwner::new(ConfChange::new()),
         }
@@ -59,16 +69,16 @@
 
     pub fn make_ref(&mut self) -> PyConfChangeRef {
         PyConfChangeRef {
             inner: RefMutContainer::new(&mut self.inner),
         }
     }
 
-    pub fn __repr__(&self) -> String {
-        format!("{:?}", self.inner.inner)
+    pub fn __repr__(&self, py: Python) -> String {
+        format_confchange(&self.inner.inner, py)
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PyConfChangeMut, op: CompareOp) -> PyObject {
         let rhs: ConfChange = rhs.into();
 
         match op {
             CompareOp::Eq => (self.inner.inner == rhs).into_py(py),
@@ -81,16 +91,16 @@
         let reference = this.call_method0(py, intern!(py, "make_ref"))?;
         reference.getattr(py, attr)
     }
 }
 
 #[pymethods]
 impl PyConfChangeRef {
-    pub fn __repr__(&self) -> PyResult<String> {
-        self.inner.map_as_ref(|inner| format!("{:?}", inner))
+    pub fn __repr__(&self, py: Python) -> PyResult<String> {
+        self.inner.map_as_ref(|inner| format_confchange(inner, py))
     }
 
     pub fn __richcmp__(
         &self,
         py: Python,
         rhs: PyConfChangeMut,
         op: CompareOp,
```

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/conf_change_single.rs` & `rraft_py-0.1.1/src/raftpb_bindings/conf_change_single.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/conf_change_transition.rs` & `rraft_py-0.1.1/src/raftpb_bindings/conf_change_transition.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/conf_change_type.rs` & `rraft_py-0.1.1/src/raftpb_bindings/conf_change_type.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/conf_change_v2.rs` & `rraft_py-0.1.1/src/raftpb_bindings/conf_change_v2.rs`

 * *Files 7% similar despite different names*

```diff
@@ -1,13 +1,13 @@
-use crate::implement_type_conversion;
 use crate::utils::{
     errors::to_pyresult,
     reference::{RefMutContainer, RefMutOwner},
     unsafe_cast::make_mut,
 };
+use crate::{deserialize_bytes, implement_type_conversion};
 use prost::Message as ProstMessage;
 use protobuf::Message as PbMessage;
 use pyo3::{
     intern,
     prelude::*,
     pyclass::CompareOp,
     types::{PyBytes, PyList},
@@ -16,14 +16,23 @@
 
 use super::{
     conf_change::PyConfChangeRef,
     conf_change_single::{PyConfChangeSingleMut, PyConfChangeSingleRef},
     conf_change_transition::PyConfChangeTransition,
 };
 
+pub fn format_confchangev2(cc: &ConfChangeV2, py: Python) -> String {
+    format!(
+        "ConfChangeV2 {{ transition: {transition:?}, changes: {changes:?}, context: {context:?} }}",
+        transition = cc.transition(),
+        changes = cc.changes,
+        context = deserialize_bytes!(cc, "confchangev2_context_deserializer", context, py)
+    )
+}
+
 #[derive(Clone)]
 #[pyclass(name = "ConfChangeV2")]
 pub struct PyConfChangeV2 {
     pub inner: RefMutOwner<ConfChangeV2>,
 }
 
 #[derive(Clone)]
@@ -65,16 +74,16 @@
 
     pub fn make_ref(&mut self) -> PyConfChangeV2Ref {
         PyConfChangeV2Ref {
             inner: RefMutContainer::new(&mut self.inner),
         }
     }
 
-    pub fn __repr__(&self) -> String {
-        format!("{:?}", self.inner.inner)
+    pub fn __repr__(&self, py: Python) -> String {
+        format_confchangev2(&self.inner.inner, py)
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PyConfChangeV2Mut, op: CompareOp) -> PyObject {
         let rhs: ConfChangeV2 = rhs.into();
 
         match op {
             CompareOp::Eq => (self.inner.inner == rhs).into_py(py),
@@ -93,16 +102,17 @@
     fn default() -> Self {
         Self::new()
     }
 }
 
 #[pymethods]
 impl PyConfChangeV2Ref {
-    pub fn __repr__(&self) -> PyResult<String> {
-        self.inner.map_as_ref(|inner| format!("{:?}", inner))
+    pub fn __repr__(&self, py: Python) -> PyResult<String> {
+        self.inner
+            .map_as_ref(|inner| format_confchangev2(inner, py))
     }
 
     pub fn __richcmp__(
         &self,
         py: Python,
         rhs: PyConfChangeV2Mut,
         op: CompareOp,
```

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/conf_state.rs` & `rraft_py-0.1.1/src/raftpb_bindings/conf_state.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/entry.rs` & `rraft_py-0.1.1/src/raftpb_bindings/entry.rs`

 * *Files 22% similar despite different names*

```diff
@@ -1,10 +1,10 @@
-use crate::implement_type_conversion;
 use crate::utils::errors::to_pyresult;
 use crate::utils::reference::{RefMutContainer, RefMutOwner};
+use crate::{deserialize_bytes, implement_type_conversion};
 use prost::Message as ProstMessage;
 use protobuf::Message as PbMessage;
 use pyo3::pyclass::CompareOp;
 use pyo3::types::PyBytes;
 use pyo3::{intern, prelude::*};
 use raft::eraftpb::Entry;
 
@@ -26,14 +26,26 @@
 pub enum PyEntryMut<'p> {
     Owned(PyRefMut<'p, PyEntry>),
     RefMut(PyEntryRef),
 }
 
 implement_type_conversion!(Entry, PyEntryMut);
 
+pub fn format_entry(entry: &Entry, py: Python) -> String {
+    format!(
+        "Entry {{ context: {context:?}, data: {data:?}, entry_type: {entry_type:?}, index: {index:?}, sync_log: {sync_log:?}, term: {term:?} }}",
+        data=deserialize_bytes!(entry, "entry_data_deserializer", data, py),
+        context=deserialize_bytes!(entry, "entry_context_deserializer", context, py),
+        entry_type=entry.get_entry_type(),
+        index=entry.get_index(),
+        sync_log=entry.get_sync_log(),
+        term=entry.get_term(),
+    )
+}
+
 #[pymethods]
 impl PyEntry {
     #[new]
     pub fn new() -> Self {
         PyEntry {
             inner: RefMutOwner::new(Entry::new()),
         }
@@ -55,16 +67,16 @@
 
     pub fn make_ref(&mut self) -> PyEntryRef {
         PyEntryRef {
             inner: RefMutContainer::new(&mut self.inner),
         }
     }
 
-    pub fn __repr__(&self) -> String {
-        format!("{:?}", self.inner.inner)
+    pub fn __repr__(&self, py: Python) -> String {
+        format_entry(&self.inner.inner, py)
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PyEntryMut, op: CompareOp) -> PyObject {
         let rhs: Entry = rhs.into();
 
         match op {
             CompareOp::Eq => (self.inner.inner == rhs).into_py(py),
@@ -77,16 +89,16 @@
         let reference = this.call_method0(py, intern!(py, "make_ref"))?;
         reference.getattr(py, attr)
     }
 }
 
 #[pymethods]
 impl PyEntryRef {
-    pub fn __repr__(&self) -> PyResult<String> {
-        self.inner.map_as_ref(|inner| format!("{:?}", inner))
+    pub fn __repr__(&self, py: Python) -> PyResult<String> {
+        self.inner.map_as_ref(|inner| format_entry(inner, py))
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PyEntryMut, op: CompareOp) -> PyResult<PyObject> {
         self.inner.map_as_ref(|inner| {
             let rhs: Entry = rhs.into();
 
             match op {
```

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/entry_type.rs` & `rraft_py-0.1.1/src/raftpb_bindings/entry_type.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/hard_state.rs` & `rraft_py-0.1.1/src/raftpb_bindings/hard_state.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/message.rs` & `rraft_py-0.1.1/src/raftpb_bindings/message.rs`

 * *Files 6% similar despite different names*

```diff
@@ -3,20 +3,23 @@
 use pyo3::{
     intern,
     prelude::*,
     pyclass::CompareOp,
     types::{PyBytes, PyList},
 };
 
-use crate::implement_type_conversion;
 use crate::utils::{
     errors::to_pyresult,
     reference::{RefMutContainer, RefMutOwner},
     unsafe_cast::make_mut,
 };
+use crate::{
+    deserialize_bytes, implement_type_conversion, raftpb_bindings::entry::format_entry,
+    raftpb_bindings::snapshot::format_snapshot,
+};
 use raft::eraftpb::Message;
 
 use super::{
     entry::{PyEntryMut, PyEntryRef},
     message_type::PyMessageType,
     snapshot::{PySnapshotMut, PySnapshotRef},
 };
@@ -37,14 +40,36 @@
 pub enum PyMessageMut<'p> {
     Owned(PyRefMut<'p, PyMessage>),
     RefMut(PyMessageRef),
 }
 
 implement_type_conversion!(Message, PyMessageMut);
 
+pub fn format_message(msg: &Message, py: Python) -> String {
+    format!(
+        "Message {{ msg_type: {msg_type:?}, to: {to:?}, from: {from:?}, term: {term:?}, log_term: {log_term:?}, index: {index:?}, entries: [{entries:?}], commit: {commit:?}, commit_term: {commit_term:?}, snapshot: {snapshot:?}, request_snapshot: {request_snapshot:?}, reject: {reject:?}, reject_hint: {reject_hint:?}, context: {context:?}, deprecated_priority: {deprecated_priority:?}, priority: {priority:?} }}",
+        msg_type=msg.get_msg_type(),
+        to=msg.get_to(),
+        from=msg.get_from(),
+        term=msg.get_term(),
+        log_term=msg.get_log_term(),
+        index=msg.get_index(),
+        entries=msg.get_entries().iter().map(|e| format_entry(e, py)).collect::<Vec<String>>().join(", "),
+        commit=msg.get_commit(),
+        commit_term=msg.get_commit_term(),
+        snapshot=format_snapshot(msg.get_snapshot(), py),
+        request_snapshot=msg.get_request_snapshot(),
+        reject=msg.get_reject(),
+        reject_hint=msg.get_reject_hint(),
+        context=deserialize_bytes!(msg, "message_context_deserializer", context, py),
+        deprecated_priority=msg.get_deprecated_priority(),
+        priority=msg.get_priority(),
+    )
+}
+
 #[pymethods]
 impl PyMessage {
     #[new]
     pub fn new() -> Self {
         PyMessage {
             inner: RefMutOwner::new(Message::new()),
         }
@@ -66,16 +91,16 @@
 
     pub fn make_ref(&mut self) -> PyMessageRef {
         PyMessageRef {
             inner: RefMutContainer::new(&mut self.inner),
         }
     }
 
-    pub fn __repr__(&self) -> String {
-        format!("{:?}", self.inner.inner)
+    pub fn __repr__(&self, py: Python) -> String {
+        format_message(&self.inner.inner, py)
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PyMessageMut, op: CompareOp) -> PyObject {
         let rhs: Message = rhs.into();
 
         match op {
             CompareOp::Eq => (self.inner.inner == rhs).into_py(py),
@@ -88,16 +113,16 @@
         let reference = this.call_method0(py, intern!(py, "make_ref"))?;
         reference.getattr(py, attr)
     }
 }
 
 #[pymethods]
 impl PyMessageRef {
-    pub fn __repr__(&self) -> PyResult<String> {
-        self.inner.map_as_ref(|inner| format!("{:?}", inner))
+    pub fn __repr__(&self, py: Python) -> PyResult<String> {
+        self.inner.map_as_ref(|inner| format_message(inner, py))
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PyMessageMut, op: CompareOp) -> PyResult<PyObject> {
         self.inner.map_as_ref(|inner| {
             let rhs: Message = rhs.into();
 
             match op {
```

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/message_type.rs` & `rraft_py-0.1.1/src/raftpb_bindings/message_type.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/snapshot.rs` & `rraft_py-0.1.1/src/raftpb_bindings/snapshot.rs`

 * *Files 9% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 use prost::Message as ProstMessage;
 use protobuf::Message as PbMessage;
 use pyo3::{intern, prelude::*, pyclass::CompareOp, types::PyBytes};
 
-use crate::implement_type_conversion;
 use crate::utils::{
     errors::to_pyresult,
     reference::{RefMutContainer, RefMutOwner},
 };
+use crate::{deserialize_bytes, implement_type_conversion};
 use raft::eraftpb::Snapshot;
 
 use super::snapshot_metadata::{PySnapshotMetadataMut, PySnapshotMetadataRef};
 
 #[derive(Clone)]
 #[pyclass(name = "Snapshot")]
 pub struct PySnapshot {
@@ -27,14 +27,22 @@
 pub enum PySnapshotMut<'p> {
     Owned(PyRefMut<'p, PySnapshot>),
     RefMut(PySnapshotRef),
 }
 
 implement_type_conversion!(Snapshot, PySnapshotMut);
 
+pub fn format_snapshot(snapshot: &Snapshot, py: Python) -> String {
+    format!(
+        "Snapshot {{ data: {data:?}, metadata: {metadata:?} }}",
+        data = deserialize_bytes!(snapshot, "snapshot_data_deserializer", data, py),
+        metadata = snapshot.metadata,
+    )
+}
+
 #[pymethods]
 impl PySnapshot {
     #[new]
     pub fn new() -> Self {
         PySnapshot {
             inner: RefMutOwner::new(Snapshot::new()),
         }
@@ -56,16 +64,16 @@
 
     pub fn make_ref(&mut self) -> PySnapshotRef {
         PySnapshotRef {
             inner: RefMutContainer::new(&mut self.inner),
         }
     }
 
-    pub fn __repr__(&self) -> String {
-        format!("{:?}", self.inner.inner)
+    pub fn __repr__(&self, py: Python) -> String {
+        format_snapshot(&self.inner, py)
     }
 
     pub fn __bool__(&self) -> bool {
         !self.inner.is_empty()
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PySnapshotMut, op: CompareOp) -> PyObject {
@@ -82,16 +90,16 @@
         let reference = this.call_method0(py, intern!(py, "make_ref"))?;
         reference.getattr(py, attr)
     }
 }
 
 #[pymethods]
 impl PySnapshotRef {
-    pub fn __repr__(&self) -> PyResult<String> {
-        self.inner.map_as_ref(|inner| format!("{:?}", inner))
+    pub fn __repr__(&self, py: Python) -> PyResult<String> {
+        self.inner.map_as_ref(|inner| format_snapshot(inner, py))
     }
 
     pub fn __richcmp__(&self, py: Python, rhs: PySnapshotMut, op: CompareOp) -> PyResult<PyObject> {
         self.inner.map_as_ref(|inner| {
             let rhs: Snapshot = rhs.into();
 
             match op {
```

### Comparing `rraft_py-0.1.0/src/raftpb_bindings/snapshot_metadata.rs` & `rraft_py-0.1.1/src/raftpb_bindings/snapshot_metadata.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/utils/errors.rs` & `rraft_py-0.1.1/src/utils/errors.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/src/utils/reference.rs` & `rraft_py-0.1.1/src/utils/reference.rs`

 * *Files identical despite different names*

### Comparing `rraft_py-0.1.0/Cargo.lock` & `rraft_py-0.1.1/Cargo.lock`

 * *Files 1% similar despite different names*

```diff
@@ -528,17 +528,17 @@
  "prost-build",
  "quote",
  "syn 1.0.109",
 ]
 
 [[package]]
 name = "pyo3"
-version = "0.19.1"
+version = "0.19.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "ffb88ae05f306b4bfcde40ac4a51dc0b05936a9207a4b75b798c7729c4258a59"
+checksum = "e681a6cfdc4adcc93b4d3cf993749a4552018ee0a9b65fc0ccfad74352c72a38"
 dependencies = [
  "cfg-if",
  "indoc",
  "inventory",
  "libc",
  "memoffset",
  "parking_lot",
@@ -546,49 +546,49 @@
  "pyo3-ffi",
  "pyo3-macros",
  "unindent",
 ]
 
 [[package]]
 name = "pyo3-build-config"
-version = "0.19.1"
+version = "0.19.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "554db24f0b3c180a9c0b1268f91287ab3f17c162e15b54caaae5a6b3773396b0"
+checksum = "076c73d0bc438f7a4ef6fdd0c3bb4732149136abd952b110ac93e4edb13a6ba5"
 dependencies = [
  "once_cell",
  "target-lexicon",
 ]
 
 [[package]]
 name = "pyo3-ffi"
-version = "0.19.1"
+version = "0.19.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "922ede8759e8600ad4da3195ae41259654b9c55da4f7eec84a0ccc7d067a70a4"
+checksum = "e53cee42e77ebe256066ba8aa77eff722b3bb91f3419177cf4cd0f304d3284d9"
 dependencies = [
  "libc",
  "pyo3-build-config",
 ]
 
 [[package]]
 name = "pyo3-macros"
-version = "0.19.1"
+version = "0.19.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "8a5caec6a1dd355964a841fcbeeb1b89fe4146c87295573f94228911af3cc5a2"
+checksum = "dfeb4c99597e136528c6dd7d5e3de5434d1ceaf487436a3f03b2d56b6fc9efd1"
 dependencies = [
  "proc-macro2",
  "pyo3-macros-backend",
  "quote",
  "syn 1.0.109",
 ]
 
 [[package]]
 name = "pyo3-macros-backend"
-version = "0.19.1"
+version = "0.19.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e0b78ccbb160db1556cdb6fd96c50334c5d4ec44dc5e0a968d0a1208fa0efa8b"
+checksum = "947dc12175c254889edc0c02e399476c2f652b4b9ebd123aa655c224de259536"
 dependencies = [
  "proc-macro2",
  "quote",
  "syn 1.0.109",
 ]
 
 [[package]]
@@ -704,15 +704,15 @@
 name = "regex-syntax"
 version = "0.6.29"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "f162c6dd7b008981e4d40210aca20b4bd0f9b60ca9271061b07f78537722f2e1"
 
 [[package]]
 name = "rraft-py"
-version = "0.1.0"
+version = "0.1.1"
 dependencies = [
  "bincode",
  "fxhash",
  "prost",
  "protobuf",
  "pyo3",
  "raft",
```

### Comparing `rraft_py-0.1.0/PKG-INFO` & `rraft_py-0.1.1/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: rraft-py
-Version: 0.1.0
+Version: 0.1.1
 Classifier: Programming Language :: Rust
 Classifier: Programming Language :: Python :: Implementation :: CPython
 License-File: LICENSE
 Summary: Unofficial Python Binding of the tikv/raft-rs
 
 Keywords: raft,distributed-systems,consensus-algorithm,replication,distributed-database
 Home-Page: https://github.com/lablup/rraft-py
@@ -32,15 +32,15 @@
 
 There have been several attempts to implement a *Raft implementation* in the Python ecosystem before, but unfortunately, there is no library being used as a *de-facto* standard as of now.
 
 This binding was created to resolve this problem and to make it possible to integrate your Python code with *low-level Raft implementation*.
 
 ### When to use and when not to use
 
-This library is a binding for *tikv/raft-rs* and only contains an implementation of the consensus module. Therefore, you need to write the logic for both the transport and storage layers yourself. If you just want to quickly integrate Raft with your Python application, using this library might not be suitable. I'd personally recommend considering using [*PySyncObj*](https://github.com/bakwc/PySyncObj).
+This library is a binding for *tikv/raft-rs* and only contains an implementation of the consensus module. Therefore, you need to write the logic for both the transport and storage layers yourself. If you just want to quickly integrate Raft with your Python application, using this library might not be suitable. In this case, you can consider to using [*Raftify*](https://github.com/lablup/raftify) or [*PySyncObj*](https://github.com/bakwc/PySyncObj).
 
 However, if you want to integrate *well-tested* Raft implementation that is reliable for production-level use in Python, or want to change the transport layer to a different layer, or want to change *fine-grained* settings according to your application's specific use case, this binding could provide you a valid starting point.
 
 ### Disclaimer
 
 #### Memory management
```

