# Comparing `tmp/gdsfactory-7.1.3.tar.gz` & `tmp/gdsfactory-7.1.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "gdsfactory-7.1.3.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
+gzip compressed data, was "gdsfactory-7.1.4.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `gdsfactory-7.1.3.tar` & `gdsfactory-7.1.4.tar`

### file list

```diff
@@ -1,477 +1,467 @@
--rw-r--r--   0        0        0     1072 2023-08-08 05:06:21.769632 gdsfactory-7.1.3/LICENSE
--rw-r--r--   0        0        0     7441 2023-08-08 05:06:21.769632 gdsfactory-7.1.3/README.md
--rw-r--r--   0        0        0     3417 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/__init__.py
--rw-r--r--   0        0        0     1870 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_keepout.py
--rw-r--r--   0        0        0    12537 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_labels.py
--rw-r--r--   0        0        0     3682 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_loopback.py
--rw-r--r--   0        0        0     5016 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_padding.py
--rw-r--r--   0        0        0    16012 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_pins.py
--rw-r--r--   0        0        0    14682 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_ports.py
--rw-r--r--   0        0        0     2864 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_tapers.py
--rw-r--r--   0        0        0     2253 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_tapers_cross_section.py
--rw-r--r--   0        0        0     1791 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/add_termination.py
--rw-r--r--   0        0        0     1856 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/asserts.py
--rw-r--r--   0        0        0    14884 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/cell.py
--rw-r--r--   0        0        0     5620 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/cli.py
--rw-r--r--   0        0        0   102902 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/component.py
--rw-r--r--   0        0        0    24269 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/component_layout.py
--rw-r--r--   0        0        0    30803 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/component_reference.py
--rw-r--r--   0        0        0     1179 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/C.py
--rw-r--r--   0        0        0     1105 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/L.py
--rw-r--r--   0        0        0    21495 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/__init__.py
--rw-r--r--   0        0        0     2599 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/add_fiducials.py
--rw-r--r--   0        0        0    13939 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/add_grating_couplers.py
--rw-r--r--   0        0        0     2014 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/add_trenches.py
--rw-r--r--   0        0        0     3168 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/align.py
--rw-r--r--   0        0        0     2528 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/array_component.py
--rw-r--r--   0        0        0     4664 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/array_with_fanout.py
--rw-r--r--   0        0        0     4319 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/array_with_via.py
--rw-r--r--   0        0        0     4042 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/awg.py
--rw-r--r--   0        0        0     1636 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bbox.py
--rw-r--r--   0        0        0     3048 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bend_circular.py
--rw-r--r--   0        0        0     2614 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bend_circular_heater.py
--rw-r--r--   0        0        0     8029 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bend_euler.py
--rw-r--r--   0        0        0     2663 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bend_port.py
--rw-r--r--   0        0        0     3807 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bend_s.py
--rw-r--r--   0        0        0     5417 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/bezier.py
--rw-r--r--   0        0        0     1605 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cavity.py
--rw-r--r--   0        0        0     5740 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cdc.py
--rw-r--r--   0        0        0     2888 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cdsem_all.py
--rw-r--r--   0        0        0     1788 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cdsem_bend180.py
--rw-r--r--   0        0        0     1593 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cdsem_coupler.py
--rw-r--r--   0        0        0     1374 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cdsem_straight.py
--rw-r--r--   0        0        0     1552 2023-08-08 05:06:21.777632 gdsfactory-7.1.3/gdsfactory/components/cdsem_straight_density.py
--rw-r--r--   0        0        0      793 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/circle.py
--rw-r--r--   0        0        0     5933 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coh_rx_dual_pol.py
--rw-r--r--   0        0        0     8880 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coh_rx_single_pol.py
--rw-r--r--   0        0        0     5005 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coh_tx_dual_pol.py
--rw-r--r--   0        0        0     6080 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coh_tx_single_pol.py
--rw-r--r--   0        0        0     2514 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/compass.py
--rw-r--r--   0        0        0     9898 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/component_lattice.py
--rw-r--r--   0        0        0    11731 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/component_lattice_generic.py
--rw-r--r--   0        0        0     7130 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/component_sequence.py
--rw-r--r--   0        0        0      812 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/copy_layers.py
--rw-r--r--   0        0        0     3460 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler.py
--rw-r--r--   0        0        0     2128 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler90.py
--rw-r--r--   0        0        0     1802 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler90bend.py
--rw-r--r--   0        0        0     4666 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_adiabatic.py
--rw-r--r--   0        0        0     1909 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_asymmetric.py
--rw-r--r--   0        0        0     4667 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_bent.py
--rw-r--r--   0        0        0     3970 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_full.py
--rw-r--r--   0        0        0     5829 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_ring.py
--rw-r--r--   0        0        0     1060 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_straight.py
--rw-r--r--   0        0        0     1164 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_straight_asymmetric.py
--rw-r--r--   0        0        0     2192 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/coupler_symmetric.py
--rw-r--r--   0        0        0     1816 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/cross.py
--rw-r--r--   0        0        0    13157 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/crossing_waveguide.py
--rw-r--r--   0        0        0      500 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
--rw-r--r--   0        0        0     1014 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
--rw-r--r--   0        0        0    19749 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
--rw-r--r--   0        0        0    19751 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
--rw-r--r--   0        0        0    19749 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
--rw-r--r--   0        0        0    19751 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
--rw-r--r--   0        0        0    19775 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
--rw-r--r--   0        0        0     3143 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
--rw-r--r--   0        0        0     5256 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/cutback_2x2.py
--rw-r--r--   0        0        0     6743 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/cutback_bend.py
--rw-r--r--   0        0        0     3759 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/cutback_component.py
--rw-r--r--   0        0        0     2708 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/cutback_splitter.py
--rw-r--r--   0        0        0     2971 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/dbr.py
--rw-r--r--   0        0        0     4262 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/dbr_tapered.py
--rw-r--r--   0        0        0     2481 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/delay_snake.py
--rw-r--r--   0        0        0     3176 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/delay_snake2.py
--rw-r--r--   0        0        0     3245 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/delay_snake3.py
--rw-r--r--   0        0        0     4313 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/delay_snake_sbend.py
--rw-r--r--   0        0        0     1254 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/dicing_lane.py
--rw-r--r--   0        0        0     3578 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/die.py
--rw-r--r--   0        0        0     2968 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/die_bbox.py
--rw-r--r--   0        0        0     2816 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/die_bbox_frame.py
--rw-r--r--   0        0        0     7984 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/disk.py
--rw-r--r--   0        0        0     4121 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/edge_coupler_array.py
--rw-r--r--   0        0        0     1188 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/ellipse.py
--rw-r--r--   0        0        0     1756 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/extend_ports_list.py
--rw-r--r--   0        0        0     7046 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/extension.py
--rw-r--r--   0        0        0      981 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/fiber.py
--rw-r--r--   0        0        0     1432 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/fiber_array.py
--rw-r--r--   0        0        0      722 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/fiducial_squares.py
--rw-r--r--   0        0        0     3225 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/ge_detector_straight_si_contacts.py
--rw-r--r--   0        0        0     2458 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_array.py
--rw-r--r--   0        0        0     4651 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_dual_pol.py
--rw-r--r--   0        0        0     7137 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical.py
--rw-r--r--   0        0        0     7209 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
--rw-r--r--   0        0        0     4942 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical_lumerical.py
--rw-r--r--   0        0        0     4694 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical_trenches.py
--rw-r--r--   0        0        0     1747 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_functions.py
--rw-r--r--   0        0        0     9054 2023-08-08 05:06:21.781632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_loss.py
--rw-r--r--   0        0        0     1814 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_loss_fiber_single.py
--rw-r--r--   0        0        0     4110 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_rectangular.py
--rw-r--r--   0        0        0     4650 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
--rw-r--r--   0        0        0     3855 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
--rw-r--r--   0        0        0     1579 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/grating_coupler_tree.py
--rw-r--r--   0        0        0     8722 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/greek_cross.py
--rw-r--r--   0        0        0     1019 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/hline.py
--rw-r--r--   0        0        0     3643 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/interdigital_capacitor.py
--rw-r--r--   0        0        0     1799 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/litho_calipers.py
--rw-r--r--   0        0        0     1218 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/litho_ruler.py
--rw-r--r--   0        0        0     1278 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/litho_steps.py
--rw-r--r--   0        0        0      650 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/logo.py
--rw-r--r--   0        0        0     1679 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/loop_mirror.py
--rw-r--r--   0        0        0     5005 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mmi.py
--rw-r--r--   0        0        0     3978 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mmi1x2.py
--rw-r--r--   0        0        0     2769 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mmi1x2_with_sbend.py
--rw-r--r--   0        0        0     3801 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mmi2x2.py
--rw-r--r--   0        0        0     3192 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mmi2x2_with_sbend.py
--rw-r--r--   0        0        0     4944 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mmi_90degree_hybrid.py
--rw-r--r--   0        0        0     3293 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mode_converter.py
--rw-r--r--   0        0        0     7610 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzi.py
--rw-r--r--   0        0        0     2464 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzi_arm.py
--rw-r--r--   0        0        0     5822 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzi_arms.py
--rw-r--r--   0        0        0    12188 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzi_lattice.py
--rw-r--r--   0        0        0     4020 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzi_pads_center.py
--rw-r--r--   0        0        0     1264 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzi_phase_shifter.py
--rw-r--r--   0        0        0     6310 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzit.py
--rw-r--r--   0        0        0     3476 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzit_lattice.py
--rw-r--r--   0        0        0     6016 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/mzm.py
--rw-r--r--   0        0        0     3518 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/nxn.py
--rw-r--r--   0        0        0     1940 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/optimal_90deg.py
--rw-r--r--   0        0        0     3876 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/optimal_hairpin.py
--rw-r--r--   0        0        0     6131 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/optimal_step.py
--rw-r--r--   0        0        0     6289 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/pack_doe.py
--rw-r--r--   0        0        0     3833 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/pad.py
--rw-r--r--   0        0        0     1915 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/pad_gsg.py
--rw-r--r--   0        0        0     1157 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/pads_shorted.py
--rw-r--r--   0        0        0     3799 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/polarization_splitter_rotator.py
--rw-r--r--   0        0        0     1115 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ramp.py
--rw-r--r--   0        0        0     1475 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/rectangle.py
--rw-r--r--   0        0        0     2933 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/rectangle_with_slits.py
--rw-r--r--   0        0        0     1059 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/rectangular_ring.py
--rw-r--r--   0        0        0     1476 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/regular_polygon.py
--rw-r--r--   0        0        0     3276 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/resistance_meander.py
--rw-r--r--   0        0        0     2629 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/resistance_sheet.py
--rw-r--r--   0        0        0     1260 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring.py
--rw-r--r--   0        0        0     4118 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_crow.py
--rw-r--r--   0        0        0     3247 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_crow_couplers.py
--rw-r--r--   0        0        0     2348 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_double.py
--rw-r--r--   0        0        0     2846 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_double_bend_coupler.py
--rw-r--r--   0        0        0     5102 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_double_heater.py
--rw-r--r--   0        0        0     7747 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_double_pn.py
--rw-r--r--   0        0        0    12046 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_section_based.py
--rw-r--r--   0        0        0     2909 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_single.py
--rw-r--r--   0        0        0     1923 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_single_array.py
--rw-r--r--   0        0        0     6868 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_single_bend_coupler.py
--rw-r--r--   0        0        0     2743 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_single_dut.py
--rw-r--r--   0        0        0     4231 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_single_heater.py
--rw-r--r--   0        0        0     5307 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/ring_single_pn.py
--rw-r--r--   0        0        0     2281 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/seal_ring.py
--rw-r--r--   0        0        0     3745 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/snspd.py
--rw-r--r--   0        0        0     2059 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/spiral_double.py
--rw-r--r--   0        0        0     5832 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/spiral_external_io.py
--rw-r--r--   0        0        0    16624 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/spiral_heater.py
--rw-r--r--   0        0        0     9155 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/spiral_inner_io.py
--rw-r--r--   0        0        0     1733 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/splitter_chain.py
--rw-r--r--   0        0        0     5289 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/splitter_tree.py
--rw-r--r--   0        0        0     2640 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/straight.py
--rw-r--r--   0        0        0     1033 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/straight_array.py
--rw-r--r--   0        0        0     7863 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/straight_heater_doped_rib.py
--rw-r--r--   0        0        0     1922 2023-08-08 05:06:21.785632 gdsfactory-7.1.3/gdsfactory/components/straight_heater_doped_strip.py
--rw-r--r--   0        0        0     8266 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/straight_heater_meander.py
--rw-r--r--   0        0        0     8519 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/straight_heater_meander_doped.py
--rw-r--r--   0        0        0     6044 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/straight_heater_metal.py
--rw-r--r--   0        0        0     2805 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/straight_pin.py
--rw-r--r--   0        0        0     3955 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/straight_pin_slot.py
--rw-r--r--   0        0        0      656 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/straight_rib.py
--rw-r--r--   0        0        0      821 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/switch_tree.py
--rw-r--r--   0        0        0     7973 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/taper.py
--rw-r--r--   0        0        0     3539 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/taper_adiabatic.py
--rw-r--r--   0        0        0     2801 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/taper_cross_section.py
--rw-r--r--   0        0        0     2363 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/taper_from_csv.py
--rw-r--r--   0        0        0     1235 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/taper_parabolic.py
--rw-r--r--   0        0        0     1787 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/terminator.py
--rw-r--r--   0        0        0     2870 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/text.py
--rw-r--r--   0        0        0     3886 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/text_freetype.py
--rw-r--r--   0        0        0     3186 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/text_rectangular.py
--rw-r--r--   0        0        0     3897 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/text_rectangular_font.py
--rw-r--r--   0        0        0     2536 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/triangles.py
--rw-r--r--   0        0        0      715 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/verniers.py
--rw-r--r--   0        0        0     2430 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/version_stamp.py
--rw-r--r--   0        0        0     2413 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/via.py
--rw-r--r--   0        0        0     3034 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/via_corner.py
--rw-r--r--   0        0        0     5342 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/via_cutback.py
--rw-r--r--   0        0        0    15895 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/via_stack.py
--rw-r--r--   0        0        0     4516 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/via_stack_slot.py
--rw-r--r--   0        0        0     4918 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/via_stack_with_offset.py
--rw-r--r--   0        0        0     1065 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/wafer.py
--rw-r--r--   0        0        0     7181 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/wire.py
--rw-r--r--   0        0        0      978 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/components/wire_sbend.py
--rw-r--r--   0        0        0    10209 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/config.py
--rw-r--r--   0        0        0    38409 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/constants.py
--rw-r--r--   0        0        0    83618 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/cross_section.py
--rw-r--r--   0        0        0     2963 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/decorators.py
--rw-r--r--   0        0        0     8529 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/difftest.py
--rw-r--r--   0        0        0      668 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/difftest_git.py
--rw-r--r--   0        0        0     1029 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/events.py
--rw-r--r--   0        0        0      267 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/export/__init__.py
--rw-r--r--   0        0        0     3308 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/export/to_3d.py
--rw-r--r--   0        0        0     7531 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/export/to_gerber.py
--rw-r--r--   0        0        0     1908 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/export/to_np.py
--rw-r--r--   0        0        0     3095 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/export/to_stl.py
--rw-r--r--   0        0        0    11831 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/fill.py
--rw-r--r--   0        0        0     7780 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/font.py
--rw-r--r--   0        0        0     8067 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/functions.py
--rw-r--r--   0        0        0     1025 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/README.md
--rw-r--r--   0        0        0     1957 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/__init__.py
--rw-r--r--   0        0        0     1008 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/containers.py
--rw-r--r--   0        0        0      169 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/generic_tech.sh
--rw-r--r--   0        0        0     8117 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/get_klayout_pyxs.py
--rw-r--r--   0        0        0      161 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/README.md
--rw-r--r--   0        0        0      104 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/drc/Makefile
--rw-r--r--   0        0        0        0 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/drc/__init__.py
--rw-r--r--   0        0        0     2842 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/drc/errors.py
--rw-r--r--   0        0        0     6192 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/grain.xml
--rw-r--r--   0        0        0    10140 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/icon_128x128.png
--rw-r--r--   0        0        0     4248 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/icon_64x64.png
--rw-r--r--   0        0        0       27 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/.gitignore
--rw-r--r--   0        0        0      494 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/Makefile
--rw-r--r--   0        0        0     4062 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/README.md
--rw-r--r--   0        0        0     2419 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
--rw-r--r--   0        0        0     9696 2023-08-08 05:06:21.789632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
--rw-r--r--   0        0        0    12379 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
--rw-r--r--   0        0        0     7235 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
--rw-r--r--   0        0        0     3446 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
--rw-r--r--   0        0        0      479 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
--rw-r--r--   0        0        0      582 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
--rw-r--r--   0        0        0      108 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
--rw-r--r--   0        0        0      186 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
--rw-r--r--   0        0        0      398 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
--rw-r--r--   0        0        0      574 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
--rw-r--r--   0        0        0     6034 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
--rw-r--r--   0        0        0    10697 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
--rw-r--r--   0        0        0      477 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
--rw-r--r--   0        0        0     4338 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
--rw-r--r--   0        0        0      926 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
--rw-r--r--   0        0        0    10945 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
--rw-r--r--   0        0        0      709 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
--rw-r--r--   0        0        0      538 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
--rw-r--r--   0        0        0        0 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/python/__init__.py
--rw-r--r--   0        0        0      114 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
--rw-r--r--   0        0        0     4312 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
--rw-r--r--   0        0        0      269 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/Makefile
--rw-r--r--   0        0        0     1800 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
--rw-r--r--   0        0        0     1519 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/generic.layerstack
--rw-r--r--   0        0        0    41073 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
--rw-r--r--   0        0        0    40616 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/layers.lyp
--rw-r--r--   0        0        0     5977 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/tech.lyt
--rw-r--r--   0        0        0     4258 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
--rw-r--r--   0        0        0     4537 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
--rw-r--r--   0        0        0     4690 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
--rw-r--r--   0        0        0     5508 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
--rw-r--r--   0        0        0     1857 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/layer_map.py
--rw-r--r--   0        0        0    10460 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/layer_stack.py
--rw-r--r--   0        0        0    10780 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/layer_views.yaml
--rw-r--r--   0        0        0     3916 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/generic_tech/simulation_settings.py
--rw-r--r--   0        0        0     1431 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/__init__.py
--rw-r--r--   0        0        0     4869 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/boolean.py
--rw-r--r--   0        0        0     3789 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/boolean_klayout.py
--rw-r--r--   0        0        0     1862 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/boolean_polygons.py
--rw-r--r--   0        0        0      567 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/check_duplicated_cells.py
--rw-r--r--   0        0        0     2693 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/check_exclusion.py
--rw-r--r--   0        0        0     2803 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/check_inclusion.py
--rw-r--r--   0        0        0     3540 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/check_space.py
--rw-r--r--   0        0        0     1867 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/check_width.py
--rw-r--r--   0        0        0     4954 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/fill_klayout.py
--rw-r--r--   0        0        0     7017 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/fill_tiled.py
--rw-r--r--   0        0        0     1655 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/fillet.py
--rw-r--r--   0        0        0     6614 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/functions.py
--rw-r--r--   0        0        0     2167 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/invert.py
--rw-r--r--   0        0        0     3686 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/layer_priority.py
--rw-r--r--   0        0        0     3055 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/manhattanize.py
--rw-r--r--   0        0        0     4184 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/maskprep.py
--rw-r--r--   0        0        0     4759 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/maskprep_flat.py
--rw-r--r--   0        0        0     3248 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/offset.py
--rw-r--r--   0        0        0     3810 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/outline.py
--rw-r--r--   0        0        0     2465 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/trim.py
--rw-r--r--   0        0        0     2952 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/union.py
--rw-r--r--   0        0        0     3626 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/write_connectivity.py
--rw-r--r--   0        0        0    10476 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/write_drc.py
--rw-r--r--   0        0        0     1783 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/geometry/xor_diff.py
--rw-r--r--   0        0        0     1152 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/get_factories.py
--rw-r--r--   0        0        0    23637 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/get_netlist.py
--rw-r--r--   0        0        0    14481 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/get_netlist_flat.py
--rw-r--r--   0        0        0     9689 2023-08-08 05:06:21.793632 gdsfactory-7.1.3/gdsfactory/grid.py
--rw-r--r--   0        0        0     5083 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/install.py
--rw-r--r--   0        0        0     1855 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/klive.py
--rw-r--r--   0        0        0      585 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/labels/__init__.py
--rw-r--r--   0        0        0     3519 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/labels/add_label_yaml.py
--rw-r--r--   0        0        0     3818 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/labels/ehva.py
--rw-r--r--   0        0        0     3796 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/labels/merge_test_metadata.py
--rw-r--r--   0        0        0     4644 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/labels/siepic.py
--rw-r--r--   0        0        0     4840 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/labels/write_labels.py
--rw-r--r--   0        0        0     5247 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/name.py
--rw-r--r--   0        0        0    11574 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/pack.py
--rw-r--r--   0        0        0    52172 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/path.py
--rw-r--r--   0        0        0    29991 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/pdk.py
--rw-r--r--   0        0        0     6092 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/picmodel.py
--rw-r--r--   0        0        0     5029 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/pixelate.py
--rw-r--r--   0        0        0      303 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/plugins/__init__.py
--rw-r--r--   0        0        0     4262 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/polygon.py
--rw-r--r--   0        0        0    33003 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/port.py
--rw-r--r--   0        0        0    37674 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/quickplotter.py
--rw-r--r--   0        0        0      696 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/__init__.py
--rw-r--r--   0        0        0     1639 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_dphox.py
--rw-r--r--   0        0        0     1259 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_gdspaths.py
--rw-r--r--   0        0        0     1927 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_np.py
--rw-r--r--   0        0        0     2773 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_phidl.py
--rw-r--r--   0        0        0     5320 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_updk.py
--rw-r--r--   0        0        0    37973 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_yaml.py
--rw-r--r--   0        0        0     5997 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/from_yaml_template.py
--rw-r--r--   0        0        0     5632 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/import_gds.py
--rw-r--r--   0        0        0     3369 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/read/labels.py
--rw-r--r--   0        0        0     1614 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/route_info.py
--rw-r--r--   0        0        0     3767 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/__init__.py
--rw-r--r--   0        0        0     2907 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/add_electrical_pads_shortest.py
--rw-r--r--   0        0        0     3075 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/add_electrical_pads_top.py
--rw-r--r--   0        0        0     3031 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/add_electrical_pads_top_dc.py
--rw-r--r--   0        0        0     8726 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/add_fiber_array.py
--rw-r--r--   0        0        0    10573 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/add_fiber_single.py
--rw-r--r--   0        0        0     9220 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/add_pads.py
--rw-r--r--   0        0        0    38995 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/all_angle.py
--rw-r--r--   0        0        0     3879 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/auto_taper.py
--rw-r--r--   0        0        0      981 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/factories.py
--rw-r--r--   0        0        0     4324 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/fanout.py
--rw-r--r--   0        0        0     2796 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/fanout2x2.py
--rw-r--r--   0        0        0    25075 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle.py
--rw-r--r--   0        0        0     8642 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle_corner.py
--rw-r--r--   0        0        0     6904 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle_from_steps.py
--rw-r--r--   0        0        0    12925 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle_from_waypoints.py
--rw-r--r--   0        0        0     5258 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle_path_length_match.py
--rw-r--r--   0        0        0     1912 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle_sbend.py
--rw-r--r--   0        0        0    17052 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_bundle_u.py
--rw-r--r--   0        0        0     1486 2023-08-08 05:06:21.797632 gdsfactory-7.1.3/gdsfactory/routing/get_input_labels.py
--rw-r--r--   0        0        0     9226 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/get_route.py
--rw-r--r--   0        0        0    10829 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/get_route_astar.py
--rw-r--r--   0        0        0     6090 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/get_route_from_steps.py
--rw-r--r--   0        0        0     2962 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/get_route_sbend.py
--rw-r--r--   0        0        0     3246 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/get_routes_bend180.py
--rw-r--r--   0        0        0     1773 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/get_routes_straight.py
--rw-r--r--   0        0        0    34260 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/manhattan.py
--rw-r--r--   0        0        0    10037 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/path_length_matching.py
--rw-r--r--   0        0        0    22673 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/route_fiber_array.py
--rw-r--r--   0        0        0     8643 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/route_fiber_single.py
--rw-r--r--   0        0        0    18074 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/route_ports_to_side.py
--rw-r--r--   0        0        0     4341 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/route_quad.py
--rw-r--r--   0        0        0    14296 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/route_sharp.py
--rw-r--r--   0        0        0    10141 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/route_south.py
--rw-r--r--   0        0        0     5040 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/sort_ports.py
--rw-r--r--   0        0        0     2433 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/routing/utils.py
--rw-r--r--   0        0        0     2767 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/01_component_pcell.py
--rw-r--r--   0        0        0      646 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
--rw-r--r--   0        0        0      974 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/01_component_pcell_with_pins.py
--rw-r--r--   0        0        0      664 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
--rw-r--r--   0        0        0      347 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/02_component_autoname.py
--rw-r--r--   0        0        0      887 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/03_move.py
--rw-r--r--   0        0        0      881 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/04_connect.py
--rw-r--r--   0        0        0      698 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/05_remove_layers.py
--rw-r--r--   0        0        0      925 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/06_remapping_layers.py
--rw-r--r--   0        0        0     1081 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/07_flattening_device.py
--rw-r--r--   0        0        0      475 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/08_group.py
--rw-r--r--   0        0        0     1621 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/11_component_layout.py
--rw-r--r--   0        0        0     2225 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/12_component_refs.py
--rw-r--r--   0        0        0     1013 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/13_component_netlist.py
--rw-r--r--   0        0        0     2592 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/14_component_connectivity.py
--rw-r--r--   0        0        0     1683 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/15_component_sequence1.py
--rw-r--r--   0        0        0     1733 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/16_component_sequence2.py
--rw-r--r--   0        0        0     1030 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/17_ports.py
--rw-r--r--   0        0        0      272 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/18_port_markers.py
--rw-r--r--   0        0        0      361 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/19_references.py
--rw-r--r--   0        0        0      561 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/20_components.py
--rw-r--r--   0        0        0      565 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/21_add_fiber_array.py
--rw-r--r--   0        0        0      550 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/22_add_fiber_single.py
--rw-r--r--   0        0        0      632 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/22_add_pads.py
--rw-r--r--   0        0        0      847 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/23_reticle.py
--rw-r--r--   0        0        0      924 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/23_reticle_passives_grid.py
--rw-r--r--   0        0        0     1177 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/23_reticle_passives_pack.py
--rw-r--r--   0        0        0      381 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/24_doe.py
--rw-r--r--   0        0        0      715 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/24_doe_2.py
--rw-r--r--   0        0        0      720 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/24_doe_3.py
--rw-r--r--   0        0        0      306 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/25_slot_cross_section.py
--rw-r--r--   0        0        0     1363 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/30_lidar.py
--rw-r--r--   0        0        0     1434 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/30_lidar_pcell.py
--rw-r--r--   0        0        0     1943 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/30_lidar_with_pads.py
--rw-r--r--   0        0        0        0 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/__init__.py
--rw-r--r--   0        0        0     1308 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing.py
--rw-r--r--   0        0        0      558 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
--rw-r--r--   0        0        0     6062 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
--rw-r--r--   0        0        0      444 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
--rw-r--r--   0        0        0      463 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
--rw-r--r--   0        0        0     1552 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
--rw-r--r--   0        0        0     1315 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
--rw-r--r--   0        0        0      602 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
--rw-r--r--   0        0        0     3317 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
--rw-r--r--   0        0        0     1484 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
--rw-r--r--   0        0        0     3045 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
--rw-r--r--   0        0        0     3782 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
--rw-r--r--   0        0        0     2393 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/big_device.py
--rw-r--r--   0        0        0       19 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/Makefile
--rw-r--r--   0        0        0        0 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/__init__.py
--rw-r--r--   0        0        0     1129 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/benchmark/fill_demo.py
--rw-r--r--   0        0        0      343 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
--rw-r--r--   0        0        0      637 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/mask.pic.yml
--rw-r--r--   0        0        0      614 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
--rw-r--r--   0        0        0      638 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
--rw-r--r--   0        0        0      453 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/pads.pic.yml
--rw-r--r--   0        0        0      287 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/rectangles.pic.yml
--rw-r--r--   0        0        0     2296 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/drc_errors.py
--rw-r--r--   0        0        0      989 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/drc_write.py
--rw-r--r--   0        0        0     4494 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/layers.py
--rw-r--r--   0        0        0      158 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/layers_sky130.py
--rw-r--r--   0        0        0      363 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/layers_xsection.py
--rw-r--r--   0        0        0     1065 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/lvs.py
--rw-r--r--   0        0        0      574 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/demo/pcell.py
--rw-r--r--   0        0        0     4174 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/netlists/mzi.yml
--rw-r--r--   0        0        0     5840 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/netlists/mzi_full.yml
--rw-r--r--   0        0        0        0 2023-08-08 05:06:21.801633 gdsfactory-7.1.3/gdsfactory/samples/pdk/__init__.py
--rw-r--r--   0        0        0     3668 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/fab_c.py
--rw-r--r--   0        0        0      233 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/fab_c_to_updk.py
--rw-r--r--   0        0        0      475 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/fab_d/__init__.py
--rw-r--r--   0        0        0     1893 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/fab_d/phase_shifters.py
--rw-r--r--   0        0        0     1745 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c.py
--rw-r--r--   0        0        0       50 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
--rw-r--r--   0        0        0       93 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
--rw-r--r--   0        0        0       85 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
--rw-r--r--   0        0        0      139 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
--rw-r--r--   0        0        0       90 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
--rw-r--r--   0        0        0      126 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
--rw-r--r--   0        0        0       48 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
--rw-r--r--   0        0        0     1023 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
--rw-r--r--   0        0        0     3102 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
--rw-r--r--   0        0        0     2419 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
--rw-r--r--   0        0        0     1283 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
--rw-r--r--   0        0        0     2252 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
--rw-r--r--   0        0        0     1061 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
--rw-r--r--   0        0        0     1054 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
--rw-r--r--   0        0        0     2237 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
--rw-r--r--   0        0        0     6899 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
--rw-r--r--   0        0        0     3625 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
--rw-r--r--   0        0        0     3603 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
--rw-r--r--   0        0        0     6857 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
--rw-r--r--   0        0        0      840 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
--rw-r--r--   0        0        0     3434 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
--rw-r--r--   0        0        0     4531 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/serialization.py
--rw-r--r--   0        0        0     1569 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/show.py
--rw-r--r--   0        0        0      525 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/simulation/__init__.py
--rw-r--r--   0        0        0     1689 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/snap.py
--rw-r--r--   0        0        0     4254 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/symbols.py
--rw-r--r--   0        0        0      308 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/__init__.py
--rw-r--r--   0        0        0      343 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/color_utils.py
--rw-r--r--   0        0        0     7550 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/klayout_tech.py
--rw-r--r--   0        0        0     1041 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/layer_map.py
--rw-r--r--   0        0        0    19780 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/layer_stack.py
--rw-r--r--   0        0        0    41893 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/layer_views.py
--rw-r--r--   0        0        0     7428 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/processes.py
--rw-r--r--   0        0        0      674 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/xml_utils.py
--rw-r--r--   0        0        0     1413 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/technology/yaml_utils.py
--rw-r--r--   0        0        0    11084 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/typings.py
--rw-r--r--   0        0        0     5622 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/watch.py
--rw-r--r--   0        0        0     7419 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/gdsfactory/write_cells.py
--rw-r--r--   0        0        0     4300 2023-08-08 05:06:21.805632 gdsfactory-7.1.3/pyproject.toml
--rw-r--r--   0        0        0     9974 1970-01-01 00:00:00.000000 gdsfactory-7.1.3/PKG-INFO
+-rw-r--r--   0        0        0     1072 2023-08-09 05:15:13.037564 gdsfactory-7.1.4/LICENSE
+-rw-r--r--   0        0        0     7441 2023-08-09 05:15:13.037564 gdsfactory-7.1.4/README.md
+-rw-r--r--   0        0        0     3417 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/__init__.py
+-rw-r--r--   0        0        0     1870 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_keepout.py
+-rw-r--r--   0        0        0    12537 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_labels.py
+-rw-r--r--   0        0        0     3682 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_loopback.py
+-rw-r--r--   0        0        0     5016 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_padding.py
+-rw-r--r--   0        0        0    16012 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_pins.py
+-rw-r--r--   0        0        0    14682 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_ports.py
+-rw-r--r--   0        0        0     2864 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_tapers.py
+-rw-r--r--   0        0        0     2253 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_tapers_cross_section.py
+-rw-r--r--   0        0        0     1791 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/add_termination.py
+-rw-r--r--   0        0        0     1856 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/asserts.py
+-rw-r--r--   0        0        0    15562 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/cell.py
+-rw-r--r--   0        0        0     5620 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/cli.py
+-rw-r--r--   0        0        0   103026 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/component.py
+-rw-r--r--   0        0        0    24269 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/component_layout.py
+-rw-r--r--   0        0        0    30803 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/component_reference.py
+-rw-r--r--   0        0        0     1179 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/components/C.py
+-rw-r--r--   0        0        0     1105 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/components/L.py
+-rw-r--r--   0        0        0    21495 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/components/__init__.py
+-rw-r--r--   0        0        0     2599 2023-08-09 05:15:13.041565 gdsfactory-7.1.4/gdsfactory/components/add_fiducials.py
+-rw-r--r--   0        0        0    13939 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/add_grating_couplers.py
+-rw-r--r--   0        0        0     2014 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/add_trenches.py
+-rw-r--r--   0        0        0     3168 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/align.py
+-rw-r--r--   0        0        0     2528 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/array_component.py
+-rw-r--r--   0        0        0     4664 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/array_with_fanout.py
+-rw-r--r--   0        0        0     4319 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/array_with_via.py
+-rw-r--r--   0        0        0     4042 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/awg.py
+-rw-r--r--   0        0        0     1636 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bbox.py
+-rw-r--r--   0        0        0     3048 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bend_circular.py
+-rw-r--r--   0        0        0     2614 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bend_circular_heater.py
+-rw-r--r--   0        0        0     8029 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bend_euler.py
+-rw-r--r--   0        0        0     2663 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bend_port.py
+-rw-r--r--   0        0        0     3807 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bend_s.py
+-rw-r--r--   0        0        0     5417 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/bezier.py
+-rw-r--r--   0        0        0     1605 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cavity.py
+-rw-r--r--   0        0        0     5740 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cdc.py
+-rw-r--r--   0        0        0     2888 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cdsem_all.py
+-rw-r--r--   0        0        0     1788 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cdsem_bend180.py
+-rw-r--r--   0        0        0     1593 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cdsem_coupler.py
+-rw-r--r--   0        0        0     1374 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cdsem_straight.py
+-rw-r--r--   0        0        0     1552 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cdsem_straight_density.py
+-rw-r--r--   0        0        0      793 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/circle.py
+-rw-r--r--   0        0        0     5933 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coh_rx_dual_pol.py
+-rw-r--r--   0        0        0     8880 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coh_rx_single_pol.py
+-rw-r--r--   0        0        0     5005 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coh_tx_dual_pol.py
+-rw-r--r--   0        0        0     6080 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coh_tx_single_pol.py
+-rw-r--r--   0        0        0     2514 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/compass.py
+-rw-r--r--   0        0        0     9898 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/component_lattice.py
+-rw-r--r--   0        0        0    11731 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/component_lattice_generic.py
+-rw-r--r--   0        0        0     7130 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/component_sequence.py
+-rw-r--r--   0        0        0      812 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/copy_layers.py
+-rw-r--r--   0        0        0     3460 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler.py
+-rw-r--r--   0        0        0     2128 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler90.py
+-rw-r--r--   0        0        0     1802 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler90bend.py
+-rw-r--r--   0        0        0     4666 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_adiabatic.py
+-rw-r--r--   0        0        0     1909 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_asymmetric.py
+-rw-r--r--   0        0        0     4667 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_bent.py
+-rw-r--r--   0        0        0     3970 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_full.py
+-rw-r--r--   0        0        0     5829 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_ring.py
+-rw-r--r--   0        0        0     1060 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_straight.py
+-rw-r--r--   0        0        0     1164 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_straight_asymmetric.py
+-rw-r--r--   0        0        0     2192 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/coupler_symmetric.py
+-rw-r--r--   0        0        0     1816 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cross.py
+-rw-r--r--   0        0        0    13157 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/crossing_waveguide.py
+-rw-r--r--   0        0        0      500 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
+-rw-r--r--   0        0        0     1014 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
+-rw-r--r--   0        0        0    19749 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
+-rw-r--r--   0        0        0    19751 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
+-rw-r--r--   0        0        0    19749 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
+-rw-r--r--   0        0        0    19751 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
+-rw-r--r--   0        0        0    19775 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
+-rw-r--r--   0        0        0     3143 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
+-rw-r--r--   0        0        0     5256 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cutback_2x2.py
+-rw-r--r--   0        0        0     6743 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cutback_bend.py
+-rw-r--r--   0        0        0     3759 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cutback_component.py
+-rw-r--r--   0        0        0     2708 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/cutback_splitter.py
+-rw-r--r--   0        0        0     2971 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/dbr.py
+-rw-r--r--   0        0        0     4262 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/dbr_tapered.py
+-rw-r--r--   0        0        0     2481 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/delay_snake.py
+-rw-r--r--   0        0        0     3176 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/delay_snake2.py
+-rw-r--r--   0        0        0     3245 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/delay_snake3.py
+-rw-r--r--   0        0        0     4313 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/delay_snake_sbend.py
+-rw-r--r--   0        0        0     1254 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/dicing_lane.py
+-rw-r--r--   0        0        0     3578 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/die.py
+-rw-r--r--   0        0        0     2968 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/die_bbox.py
+-rw-r--r--   0        0        0     2816 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/die_bbox_frame.py
+-rw-r--r--   0        0        0     7984 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/disk.py
+-rw-r--r--   0        0        0     4121 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/edge_coupler_array.py
+-rw-r--r--   0        0        0     1188 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/ellipse.py
+-rw-r--r--   0        0        0     1756 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/extend_ports_list.py
+-rw-r--r--   0        0        0     7046 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/extension.py
+-rw-r--r--   0        0        0      981 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/fiber.py
+-rw-r--r--   0        0        0     1432 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/fiber_array.py
+-rw-r--r--   0        0        0      722 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/fiducial_squares.py
+-rw-r--r--   0        0        0     3225 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/ge_detector_straight_si_contacts.py
+-rw-r--r--   0        0        0     2458 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_array.py
+-rw-r--r--   0        0        0     4651 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_dual_pol.py
+-rw-r--r--   0        0        0     7137 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical.py
+-rw-r--r--   0        0        0     7209 2023-08-09 05:15:13.045565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
+-rw-r--r--   0        0        0     4942 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical_lumerical.py
+-rw-r--r--   0        0        0     4694 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical_trenches.py
+-rw-r--r--   0        0        0     1747 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_functions.py
+-rw-r--r--   0        0        0     9054 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_loss.py
+-rw-r--r--   0        0        0     1814 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_loss_fiber_single.py
+-rw-r--r--   0        0        0     4110 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_rectangular.py
+-rw-r--r--   0        0        0     4650 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
+-rw-r--r--   0        0        0     3855 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
+-rw-r--r--   0        0        0     1579 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/grating_coupler_tree.py
+-rw-r--r--   0        0        0     8722 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/greek_cross.py
+-rw-r--r--   0        0        0     1019 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/hline.py
+-rw-r--r--   0        0        0     3643 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/interdigital_capacitor.py
+-rw-r--r--   0        0        0     1799 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/litho_calipers.py
+-rw-r--r--   0        0        0     1218 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/litho_ruler.py
+-rw-r--r--   0        0        0     1278 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/litho_steps.py
+-rw-r--r--   0        0        0      650 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/logo.py
+-rw-r--r--   0        0        0     1679 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/loop_mirror.py
+-rw-r--r--   0        0        0     5005 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mmi.py
+-rw-r--r--   0        0        0     3978 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mmi1x2.py
+-rw-r--r--   0        0        0     2769 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mmi1x2_with_sbend.py
+-rw-r--r--   0        0        0     3801 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mmi2x2.py
+-rw-r--r--   0        0        0     3192 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mmi2x2_with_sbend.py
+-rw-r--r--   0        0        0     4944 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mmi_90degree_hybrid.py
+-rw-r--r--   0        0        0     3293 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mode_converter.py
+-rw-r--r--   0        0        0     7610 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzi.py
+-rw-r--r--   0        0        0     2464 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzi_arm.py
+-rw-r--r--   0        0        0     5822 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzi_arms.py
+-rw-r--r--   0        0        0    12188 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzi_lattice.py
+-rw-r--r--   0        0        0     4020 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzi_pads_center.py
+-rw-r--r--   0        0        0     1264 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzi_phase_shifter.py
+-rw-r--r--   0        0        0     6310 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzit.py
+-rw-r--r--   0        0        0     3476 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzit_lattice.py
+-rw-r--r--   0        0        0     6016 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/mzm.py
+-rw-r--r--   0        0        0     3518 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/nxn.py
+-rw-r--r--   0        0        0     1940 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/optimal_90deg.py
+-rw-r--r--   0        0        0     3876 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/optimal_hairpin.py
+-rw-r--r--   0        0        0     6131 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/optimal_step.py
+-rw-r--r--   0        0        0     6289 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/pack_doe.py
+-rw-r--r--   0        0        0     3833 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/pad.py
+-rw-r--r--   0        0        0     1915 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/pad_gsg.py
+-rw-r--r--   0        0        0     1157 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/pads_shorted.py
+-rw-r--r--   0        0        0     3799 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/polarization_splitter_rotator.py
+-rw-r--r--   0        0        0     1115 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ramp.py
+-rw-r--r--   0        0        0     1475 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/rectangle.py
+-rw-r--r--   0        0        0     2933 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/rectangle_with_slits.py
+-rw-r--r--   0        0        0     1059 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/rectangular_ring.py
+-rw-r--r--   0        0        0     1476 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/regular_polygon.py
+-rw-r--r--   0        0        0     3276 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/resistance_meander.py
+-rw-r--r--   0        0        0     2629 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/resistance_sheet.py
+-rw-r--r--   0        0        0     1260 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring.py
+-rw-r--r--   0        0        0     4118 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_crow.py
+-rw-r--r--   0        0        0     3247 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_crow_couplers.py
+-rw-r--r--   0        0        0     2348 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_double.py
+-rw-r--r--   0        0        0     2846 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_double_bend_coupler.py
+-rw-r--r--   0        0        0     5102 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_double_heater.py
+-rw-r--r--   0        0        0     7747 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_double_pn.py
+-rw-r--r--   0        0        0    12046 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_section_based.py
+-rw-r--r--   0        0        0     2909 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_single.py
+-rw-r--r--   0        0        0     1923 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_single_array.py
+-rw-r--r--   0        0        0     6868 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_single_bend_coupler.py
+-rw-r--r--   0        0        0     2743 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_single_dut.py
+-rw-r--r--   0        0        0     4231 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_single_heater.py
+-rw-r--r--   0        0        0     5307 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/ring_single_pn.py
+-rw-r--r--   0        0        0     2281 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/seal_ring.py
+-rw-r--r--   0        0        0     3745 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/snspd.py
+-rw-r--r--   0        0        0     2059 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/spiral_double.py
+-rw-r--r--   0        0        0     5832 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/spiral_external_io.py
+-rw-r--r--   0        0        0    16624 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/spiral_heater.py
+-rw-r--r--   0        0        0     9155 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/spiral_inner_io.py
+-rw-r--r--   0        0        0     1733 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/splitter_chain.py
+-rw-r--r--   0        0        0     5289 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/splitter_tree.py
+-rw-r--r--   0        0        0     2640 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight.py
+-rw-r--r--   0        0        0     1033 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_array.py
+-rw-r--r--   0        0        0     7863 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_heater_doped_rib.py
+-rw-r--r--   0        0        0     1922 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_heater_doped_strip.py
+-rw-r--r--   0        0        0     8266 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_heater_meander.py
+-rw-r--r--   0        0        0     8519 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_heater_meander_doped.py
+-rw-r--r--   0        0        0     6044 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_heater_metal.py
+-rw-r--r--   0        0        0     2805 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_pin.py
+-rw-r--r--   0        0        0     3955 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_pin_slot.py
+-rw-r--r--   0        0        0      656 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/straight_rib.py
+-rw-r--r--   0        0        0      821 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/switch_tree.py
+-rw-r--r--   0        0        0     7973 2023-08-09 05:15:13.049565 gdsfactory-7.1.4/gdsfactory/components/taper.py
+-rw-r--r--   0        0        0     3539 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/taper_adiabatic.py
+-rw-r--r--   0        0        0     2801 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/taper_cross_section.py
+-rw-r--r--   0        0        0     2363 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/taper_from_csv.py
+-rw-r--r--   0        0        0     1235 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/taper_parabolic.py
+-rw-r--r--   0        0        0     1787 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/terminator.py
+-rw-r--r--   0        0        0     2870 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/text.py
+-rw-r--r--   0        0        0     3886 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/text_freetype.py
+-rw-r--r--   0        0        0     3186 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/text_rectangular.py
+-rw-r--r--   0        0        0     3897 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/text_rectangular_font.py
+-rw-r--r--   0        0        0     2536 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/triangles.py
+-rw-r--r--   0        0        0      715 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/verniers.py
+-rw-r--r--   0        0        0     2430 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/version_stamp.py
+-rw-r--r--   0        0        0     2413 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/via.py
+-rw-r--r--   0        0        0     3034 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/via_corner.py
+-rw-r--r--   0        0        0     5342 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/via_cutback.py
+-rw-r--r--   0        0        0    15895 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/via_stack.py
+-rw-r--r--   0        0        0     4516 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/via_stack_slot.py
+-rw-r--r--   0        0        0     4918 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/via_stack_with_offset.py
+-rw-r--r--   0        0        0     1065 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/wafer.py
+-rw-r--r--   0        0        0     7181 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/wire.py
+-rw-r--r--   0        0        0      978 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/components/wire_sbend.py
+-rw-r--r--   0        0        0    10209 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/config.py
+-rw-r--r--   0        0        0    38409 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/constants.py
+-rw-r--r--   0        0        0    84307 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/cross_section.py
+-rw-r--r--   0        0        0     2963 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/decorators.py
+-rw-r--r--   0        0        0     8529 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/difftest.py
+-rw-r--r--   0        0        0      668 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/difftest_git.py
+-rw-r--r--   0        0        0     1029 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/events.py
+-rw-r--r--   0        0        0      267 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/export/__init__.py
+-rw-r--r--   0        0        0     3308 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/export/to_3d.py
+-rw-r--r--   0        0        0     7531 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/export/to_gerber.py
+-rw-r--r--   0        0        0     1908 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/export/to_np.py
+-rw-r--r--   0        0        0     3095 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/export/to_stl.py
+-rw-r--r--   0        0        0    11831 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/fill.py
+-rw-r--r--   0        0        0     7780 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/font.py
+-rw-r--r--   0        0        0     8067 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/functions.py
+-rw-r--r--   0        0        0     1025 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/README.md
+-rw-r--r--   0        0        0     1957 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/__init__.py
+-rw-r--r--   0        0        0     1008 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/containers.py
+-rw-r--r--   0        0        0      169 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/generic_tech.sh
+-rw-r--r--   0        0        0     8117 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/get_klayout_pyxs.py
+-rw-r--r--   0        0        0      161 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/README.md
+-rw-r--r--   0        0        0      104 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/drc/Makefile
+-rw-r--r--   0        0        0        0 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/drc/__init__.py
+-rw-r--r--   0        0        0     2842 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/drc/errors.py
+-rw-r--r--   0        0        0     6192 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/grain.xml
+-rw-r--r--   0        0        0    10140 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/icon_128x128.png
+-rw-r--r--   0        0        0     4248 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/icon_64x64.png
+-rw-r--r--   0        0        0       27 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/.gitignore
+-rw-r--r--   0        0        0      494 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/Makefile
+-rw-r--r--   0        0        0     4062 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/README.md
+-rw-r--r--   0        0        0     2419 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
+-rw-r--r--   0        0        0     9696 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
+-rw-r--r--   0        0        0    12379 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
+-rw-r--r--   0        0        0     7235 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
+-rw-r--r--   0        0        0     3446 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
+-rw-r--r--   0        0        0      479 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
+-rw-r--r--   0        0        0      582 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
+-rw-r--r--   0        0        0      108 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
+-rw-r--r--   0        0        0      186 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
+-rw-r--r--   0        0        0      398 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
+-rw-r--r--   0        0        0      574 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
+-rw-r--r--   0        0        0     6034 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
+-rw-r--r--   0        0        0    10697 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
+-rw-r--r--   0        0        0      477 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
+-rw-r--r--   0        0        0     4338 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
+-rw-r--r--   0        0        0      926 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
+-rw-r--r--   0        0        0    10945 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
+-rw-r--r--   0        0        0      709 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
+-rw-r--r--   0        0        0      538 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
+-rw-r--r--   0        0        0        0 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/python/__init__.py
+-rw-r--r--   0        0        0      114 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
+-rw-r--r--   0        0        0     4312 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
+-rw-r--r--   0        0        0      269 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/Makefile
+-rw-r--r--   0        0        0     1800 2023-08-09 05:15:13.053565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
+-rw-r--r--   0        0        0     1519 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/generic.layerstack
+-rw-r--r--   0        0        0    41073 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
+-rw-r--r--   0        0        0    40616 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/layers.lyp
+-rw-r--r--   0        0        0     5977 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/tech.lyt
+-rw-r--r--   0        0        0     4258 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
+-rw-r--r--   0        0        0     4537 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
+-rw-r--r--   0        0        0     4690 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
+-rw-r--r--   0        0        0     5508 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
+-rw-r--r--   0        0        0     1857 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/layer_map.py
+-rw-r--r--   0        0        0    10460 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/layer_stack.py
+-rw-r--r--   0        0        0    10780 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/layer_views.yaml
+-rw-r--r--   0        0        0     3916 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/generic_tech/simulation_settings.py
+-rw-r--r--   0        0        0      999 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/__init__.py
+-rw-r--r--   0        0        0     4869 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/boolean.py
+-rw-r--r--   0        0        0     3789 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/boolean_klayout.py
+-rw-r--r--   0        0        0     1862 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/boolean_polygons.py
+-rw-r--r--   0        0        0     4954 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/fill_klayout.py
+-rw-r--r--   0        0        0     7017 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/fill_tiled.py
+-rw-r--r--   0        0        0     1655 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/fillet.py
+-rw-r--r--   0        0        0     6614 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/functions.py
+-rw-r--r--   0        0        0     2167 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/invert.py
+-rw-r--r--   0        0        0     3686 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/layer_priority.py
+-rw-r--r--   0        0        0     3066 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/manhattanize.py
+-rw-r--r--   0        0        0     4184 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/maskprep.py
+-rw-r--r--   0        0        0     1203 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/maskprep_flat.py
+-rw-r--r--   0        0        0     3248 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/offset.py
+-rw-r--r--   0        0        0     3810 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/outline.py
+-rw-r--r--   0        0        0     2465 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/trim.py
+-rw-r--r--   0        0        0     2952 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/union.py
+-rw-r--r--   0        0        0     1783 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/geometry/xor_diff.py
+-rw-r--r--   0        0        0     1152 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/get_factories.py
+-rw-r--r--   0        0        0    23637 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/get_netlist.py
+-rw-r--r--   0        0        0    14481 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/get_netlist_flat.py
+-rw-r--r--   0        0        0     9689 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/grid.py
+-rw-r--r--   0        0        0     5083 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/install.py
+-rw-r--r--   0        0        0     1855 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/klive.py
+-rw-r--r--   0        0        0      585 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/labels/__init__.py
+-rw-r--r--   0        0        0     3519 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/labels/add_label_yaml.py
+-rw-r--r--   0        0        0     3818 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/labels/ehva.py
+-rw-r--r--   0        0        0     3796 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/labels/merge_test_metadata.py
+-rw-r--r--   0        0        0     4644 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/labels/siepic.py
+-rw-r--r--   0        0        0     4840 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/labels/write_labels.py
+-rw-r--r--   0        0        0     5528 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/name.py
+-rw-r--r--   0        0        0    11574 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/pack.py
+-rw-r--r--   0        0        0    53955 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/path.py
+-rw-r--r--   0        0        0    30140 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/pdk.py
+-rw-r--r--   0        0        0     6092 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/picmodel.py
+-rw-r--r--   0        0        0     5029 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/pixelate.py
+-rw-r--r--   0        0        0      303 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/plugins/__init__.py
+-rw-r--r--   0        0        0     4262 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/polygon.py
+-rw-r--r--   0        0        0    33003 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/port.py
+-rw-r--r--   0        0        0    37674 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/quickplotter.py
+-rw-r--r--   0        0        0      696 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/__init__.py
+-rw-r--r--   0        0        0     1639 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_dphox.py
+-rw-r--r--   0        0        0     1259 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_gdspaths.py
+-rw-r--r--   0        0        0     1927 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_np.py
+-rw-r--r--   0        0        0     2773 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_phidl.py
+-rw-r--r--   0        0        0     5860 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_updk.py
+-rw-r--r--   0        0        0    37973 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_yaml.py
+-rw-r--r--   0        0        0     5997 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/from_yaml_template.py
+-rw-r--r--   0        0        0     5632 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/import_gds.py
+-rw-r--r--   0        0        0     3369 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/read/labels.py
+-rw-r--r--   0        0        0     1614 2023-08-09 05:15:13.057565 gdsfactory-7.1.4/gdsfactory/route_info.py
+-rw-r--r--   0        0        0     3767 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/__init__.py
+-rw-r--r--   0        0        0     2907 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/add_electrical_pads_shortest.py
+-rw-r--r--   0        0        0     3075 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/add_electrical_pads_top.py
+-rw-r--r--   0        0        0     3031 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/add_electrical_pads_top_dc.py
+-rw-r--r--   0        0        0     8726 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/add_fiber_array.py
+-rw-r--r--   0        0        0    10573 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/add_fiber_single.py
+-rw-r--r--   0        0        0     9220 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/add_pads.py
+-rw-r--r--   0        0        0    38995 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/all_angle.py
+-rw-r--r--   0        0        0     3879 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/auto_taper.py
+-rw-r--r--   0        0        0      981 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/factories.py
+-rw-r--r--   0        0        0     4324 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/fanout.py
+-rw-r--r--   0        0        0     2796 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/fanout2x2.py
+-rw-r--r--   0        0        0    25075 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle.py
+-rw-r--r--   0        0        0     8642 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle_corner.py
+-rw-r--r--   0        0        0     6904 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle_from_steps.py
+-rw-r--r--   0        0        0    12925 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle_from_waypoints.py
+-rw-r--r--   0        0        0     5258 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle_path_length_match.py
+-rw-r--r--   0        0        0     1912 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle_sbend.py
+-rw-r--r--   0        0        0    17052 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_bundle_u.py
+-rw-r--r--   0        0        0     1486 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_input_labels.py
+-rw-r--r--   0        0        0     9226 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_route.py
+-rw-r--r--   0        0        0    10829 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_route_astar.py
+-rw-r--r--   0        0        0     6090 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_route_from_steps.py
+-rw-r--r--   0        0        0     2962 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_route_sbend.py
+-rw-r--r--   0        0        0     3246 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_routes_bend180.py
+-rw-r--r--   0        0        0     1773 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/get_routes_straight.py
+-rw-r--r--   0        0        0    34260 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/manhattan.py
+-rw-r--r--   0        0        0    10037 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/path_length_matching.py
+-rw-r--r--   0        0        0    22673 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/route_fiber_array.py
+-rw-r--r--   0        0        0     8643 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/route_fiber_single.py
+-rw-r--r--   0        0        0    18074 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/route_ports_to_side.py
+-rw-r--r--   0        0        0     4341 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/route_quad.py
+-rw-r--r--   0        0        0    14296 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/route_sharp.py
+-rw-r--r--   0        0        0    10141 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/route_south.py
+-rw-r--r--   0        0        0     5040 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/sort_ports.py
+-rw-r--r--   0        0        0     2433 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/routing/utils.py
+-rw-r--r--   0        0        0     2767 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/01_component_pcell.py
+-rw-r--r--   0        0        0      974 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/01_component_pcell_with_pins.py
+-rw-r--r--   0        0        0      347 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/02_component_autoname.py
+-rw-r--r--   0        0        0      887 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/03_move.py
+-rw-r--r--   0        0        0      881 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/04_connect.py
+-rw-r--r--   0        0        0      698 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/05_remove_layers.py
+-rw-r--r--   0        0        0      925 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/06_remapping_layers.py
+-rw-r--r--   0        0        0     1081 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/07_flattening_device.py
+-rw-r--r--   0        0        0      475 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/08_group.py
+-rw-r--r--   0        0        0     1621 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/11_component_layout.py
+-rw-r--r--   0        0        0     2225 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/12_component_refs.py
+-rw-r--r--   0        0        0     1013 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/13_component_netlist.py
+-rw-r--r--   0        0        0     2592 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/14_component_connectivity.py
+-rw-r--r--   0        0        0     1683 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/15_component_sequence1.py
+-rw-r--r--   0        0        0     1733 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/16_component_sequence2.py
+-rw-r--r--   0        0        0     1030 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/17_ports.py
+-rw-r--r--   0        0        0      272 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/18_port_markers.py
+-rw-r--r--   0        0        0      361 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/19_references.py
+-rw-r--r--   0        0        0      561 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/20_components.py
+-rw-r--r--   0        0        0      565 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/21_add_fiber_array.py
+-rw-r--r--   0        0        0      550 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/22_add_fiber_single.py
+-rw-r--r--   0        0        0      632 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/22_add_pads.py
+-rw-r--r--   0        0        0      847 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/23_reticle.py
+-rw-r--r--   0        0        0      924 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/23_reticle_passives_grid.py
+-rw-r--r--   0        0        0     1177 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/23_reticle_passives_pack.py
+-rw-r--r--   0        0        0      381 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/24_doe.py
+-rw-r--r--   0        0        0      715 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/24_doe_2.py
+-rw-r--r--   0        0        0      720 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/24_doe_3.py
+-rw-r--r--   0        0        0      306 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/25_slot_cross_section.py
+-rw-r--r--   0        0        0     1363 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/30_lidar.py
+-rw-r--r--   0        0        0     1434 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/30_lidar_pcell.py
+-rw-r--r--   0        0        0     1943 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/30_lidar_with_pads.py
+-rw-r--r--   0        0        0        0 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/__init__.py
+-rw-r--r--   0        0        0     1308 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing.py
+-rw-r--r--   0        0        0      558 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
+-rw-r--r--   0        0        0     6062 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
+-rw-r--r--   0        0        0      444 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
+-rw-r--r--   0        0        0      463 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
+-rw-r--r--   0        0        0     1552 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
+-rw-r--r--   0        0        0     1315 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
+-rw-r--r--   0        0        0      602 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
+-rw-r--r--   0        0        0     3317 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
+-rw-r--r--   0        0        0     1484 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
+-rw-r--r--   0        0        0     3045 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
+-rw-r--r--   0        0        0     3782 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
+-rw-r--r--   0        0        0     2393 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/big_device.py
+-rw-r--r--   0        0        0       19 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/demo/Makefile
+-rw-r--r--   0        0        0        0 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/demo/__init__.py
+-rw-r--r--   0        0        0     1129 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/demo/benchmark/fill_demo.py
+-rw-r--r--   0        0        0      343 2023-08-09 05:15:13.061565 gdsfactory-7.1.4/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
+-rw-r--r--   0        0        0      637 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/mask.pic.yml
+-rw-r--r--   0        0        0      614 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
+-rw-r--r--   0        0        0      638 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
+-rw-r--r--   0        0        0      453 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/pads.pic.yml
+-rw-r--r--   0        0        0      287 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/rectangles.pic.yml
+-rw-r--r--   0        0        0     2296 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/drc_errors.py
+-rw-r--r--   0        0        0     4494 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/layers.py
+-rw-r--r--   0        0        0      158 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/layers_sky130.py
+-rw-r--r--   0        0        0      363 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/layers_xsection.py
+-rw-r--r--   0        0        0     1065 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/lvs.py
+-rw-r--r--   0        0        0      574 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/demo/pcell.py
+-rw-r--r--   0        0        0     4174 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/netlists/mzi.yml
+-rw-r--r--   0        0        0     5840 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/netlists/mzi_full.yml
+-rw-r--r--   0        0        0        0 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/__init__.py
+-rw-r--r--   0        0        0     3668 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/fab_c.py
+-rw-r--r--   0        0        0      233 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/fab_c_to_updk.py
+-rw-r--r--   0        0        0      475 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/fab_d/__init__.py
+-rw-r--r--   0        0        0     1893 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/fab_d/phase_shifters.py
+-rw-r--r--   0        0        0     1745 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c.py
+-rw-r--r--   0        0        0       50 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
+-rw-r--r--   0        0        0       93 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
+-rw-r--r--   0        0        0       85 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
+-rw-r--r--   0        0        0      139 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
+-rw-r--r--   0        0        0       90 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
+-rw-r--r--   0        0        0      126 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
+-rw-r--r--   0        0        0       48 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
+-rw-r--r--   0        0        0     1023 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
+-rw-r--r--   0        0        0     3102 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
+-rw-r--r--   0        0        0     2419 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
+-rw-r--r--   0        0        0     1283 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
+-rw-r--r--   0        0        0     2252 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
+-rw-r--r--   0        0        0     1061 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
+-rw-r--r--   0        0        0     1054 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
+-rw-r--r--   0        0        0     2237 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
+-rw-r--r--   0        0        0     6899 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
+-rw-r--r--   0        0        0     3625 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
+-rw-r--r--   0        0        0     3603 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
+-rw-r--r--   0        0        0     6857 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
+-rw-r--r--   0        0        0      840 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
+-rw-r--r--   0        0        0     3434 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
+-rw-r--r--   0        0        0     4531 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/serialization.py
+-rw-r--r--   0        0        0     1569 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/show.py
+-rw-r--r--   0        0        0      525 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/simulation/__init__.py
+-rw-r--r--   0        0        0     1689 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/snap.py
+-rw-r--r--   0        0        0     4254 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/symbols.py
+-rw-r--r--   0        0        0      308 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/__init__.py
+-rw-r--r--   0        0        0      343 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/color_utils.py
+-rw-r--r--   0        0        0     7550 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/klayout_tech.py
+-rw-r--r--   0        0        0     1041 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/layer_map.py
+-rw-r--r--   0        0        0    19780 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/layer_stack.py
+-rw-r--r--   0        0        0    41893 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/layer_views.py
+-rw-r--r--   0        0        0     7428 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/processes.py
+-rw-r--r--   0        0        0      674 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/xml_utils.py
+-rw-r--r--   0        0        0     1413 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/technology/yaml_utils.py
+-rw-r--r--   0        0        0    11102 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/typings.py
+-rw-r--r--   0        0        0     5622 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/watch.py
+-rw-r--r--   0        0        0     7419 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/gdsfactory/write_cells.py
+-rw-r--r--   0        0        0     4300 2023-08-09 05:15:13.065565 gdsfactory-7.1.4/pyproject.toml
+-rw-r--r--   0        0        0     9974 1970-01-01 00:00:00.000000 gdsfactory-7.1.4/PKG-INFO
```

### Comparing `gdsfactory-7.1.3/LICENSE` & `gdsfactory-7.1.4/LICENSE`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/README.md` & `gdsfactory-7.1.4/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# gdsfactory 7.1.3
+# gdsfactory 7.1.4
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![Downloads](https://pepy.tech/badge/gdsfactory)](https://pepy.tech/project/gdsfactory)
```

### Comparing `gdsfactory-7.1.3/gdsfactory/__init__.py` & `gdsfactory-7.1.4/gdsfactory/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -144,8 +144,8 @@
     "technology",
     "write_cells",
     "xsection",
     "PATH",
 )
 
 
-__version__ = "7.1.3"
+__version__ = "7.1.4"
```

### Comparing `gdsfactory-7.1.3/gdsfactory/add_keepout.py` & `gdsfactory-7.1.4/gdsfactory/add_keepout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_labels.py` & `gdsfactory-7.1.4/gdsfactory/add_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_loopback.py` & `gdsfactory-7.1.4/gdsfactory/add_loopback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_padding.py` & `gdsfactory-7.1.4/gdsfactory/add_padding.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_pins.py` & `gdsfactory-7.1.4/gdsfactory/add_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_ports.py` & `gdsfactory-7.1.4/gdsfactory/add_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_tapers.py` & `gdsfactory-7.1.4/gdsfactory/add_tapers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_tapers_cross_section.py` & `gdsfactory-7.1.4/gdsfactory/add_tapers_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/add_termination.py` & `gdsfactory-7.1.4/gdsfactory/add_termination.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/asserts.py` & `gdsfactory-7.1.4/gdsfactory/asserts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/cell.py` & `gdsfactory-7.1.4/gdsfactory/cell.py`

 * *Files 2% similar despite different names*

```diff
@@ -122,49 +122,61 @@
         ]
         # list of explicitly passed args as strings
         passed_args_list = [
             f"{key}={clean_value_name(changed2[key])}" for key in sorted(changed.keys())
         ]
 
         # get only the args which are explicitly passed and different from defaults
-        changed_arg_set = set(passed_args_list).difference(default_args_list)
-        changed_arg_list = sorted(changed_arg_set)
-
         # if any args were different from default, append a hash of those args.
         # else, keep only the base name
-        named_args_string = "_".join(changed_arg_list)
         # print(named_args_string)
 
-        if changed_arg_list or include_module:
-            if include_module and changed_arg_list:
-                named_args_module_string = f"{named_args_string}_{func.__module__}"
-            elif include_module:
-                named_args_module_string = func.__module__
-            elif changed_arg_list:
-                named_args_module_string = named_args_string
-
-            named_args_module_string = (
-                hashlib.md5(named_args_module_string.encode()).hexdigest()[:8]
-                if with_hash
-                or len(named_args_module_string) > 28
-                or "'" in named_args_module_string
-                or "{" in named_args_module_string
-                else named_args_module_string
-            )
-            name_signature = clean_name(f"{prefix}_{named_args_module_string}")
+        if active_pdk.cell_decorator_settings.naming_style == "updk":
+            full_args_list = [
+                f"{key}={clean_value_name(full[key])}" for key in sorted(full.keys())
+            ]
+            named_args_string = ",".join(full_args_list)
+            name = f"{prefix}:{named_args_string}" if named_args_string else prefix
+            name = clean_name(name, allowed_characters=[":", ".", "="])
+
+        elif active_pdk.cell_decorator_settings.naming_style == "default":
+            changed_arg_set = set(passed_args_list).difference(default_args_list)
+            changed_arg_list = sorted(changed_arg_set)
+            named_args_string = "_".join(changed_arg_list)
+            if changed_arg_list or include_module:
+                if include_module and changed_arg_list:
+                    named_args_module_string = f"{named_args_string}_{func.__module__}"
+                elif include_module:
+                    named_args_module_string = func.__module__
+                elif changed_arg_list:
+                    named_args_module_string = named_args_string
+
+                named_args_module_string = (
+                    hashlib.md5(named_args_module_string.encode()).hexdigest()[:8]
+                    if with_hash
+                    or len(named_args_module_string) > 28
+                    or "'" in named_args_module_string
+                    or "{" in named_args_module_string
+                    else named_args_module_string
+                )
+                name_signature = clean_name(f"{prefix}_{named_args_module_string}")
+            else:
+                name_signature = prefix
+
+            # filter the changed dictionary to only keep entries which have truly changed
+            changed_arg_names = [carg.split("=")[0] for carg in changed_arg_list]
+            changed = {k: changed[k] for k in changed_arg_names}
+            name = name or name_signature
+
         else:
-            name_signature = prefix
+            raise ValueError('naming_style must be "default" or "updk"')
 
-        # filter the changed dictionary to only keep entries which have truly changed
-        changed_arg_names = [carg.split("=")[0] for carg in changed_arg_list]
-        changed = {k: changed[k] for k in changed_arg_names}
+        name = get_name_short(name, max_name_length=max_name_length)
         default_decorator = active_pdk.default_decorator if active_pdk else None
-        name = name or name_signature
         decorator = kwargs.pop("decorator", default_decorator)
-        name = get_name_short(name, max_name_length=max_name_length)
 
         if (
             "args" not in sig.parameters
             and "kwargs" not in sig.parameters
             and "settings" not in sig.parameters
         ):
             for key in kwargs:
```

### Comparing `gdsfactory-7.1.3/gdsfactory/cli.py` & `gdsfactory-7.1.4/gdsfactory/cli.py`

 * *Files 0% similar despite different names*

```diff
@@ -20,15 +20,15 @@
 from gdsfactory.write_cells import write_cells as write_cells_to_separate_gds
 
 try:
     import rich_click as click
 except ImportError:
     import click
 
-VERSION = "7.1.3"
+VERSION = "7.1.4"
 LAYER_LABEL = LAYER.LABEL
 
 
 def print_version(ctx: Context, param: Option, value: bool) -> None:
     """Prints the version."""
     if not value or ctx.resilient_parsing:
         return
```

### Comparing `gdsfactory-7.1.3/gdsfactory/component.py` & `gdsfactory-7.1.4/gdsfactory/component.py`

 * *Files 1% similar despite different names*

```diff
@@ -697,5736 +697,5744 @@
 00002b80: 2020 2020 2020 202d 206e 616d 6520 6368         - name ch
 00002b90: 6172 6163 7465 7273 203c 204d 4158 5f4e  aracters < MAX_N
 00002ba0: 414d 455f 4c45 4e47 5448 0a20 2020 2020  AME_LENGTH.     
 00002bb0: 2020 202d 2069 7320 6e6f 7420 656d 7074     - is not empt
 00002bc0: 7920 2868 6173 2072 6566 6572 656e 6365  y (has reference
 00002bd0: 7320 6f72 2070 6f6c 7967 6f6e 7329 0a20  s or polygons). 
 00002be0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00002bf0: 2020 204d 4158 5f4e 414d 455f 4c45 4e47     MAX_NAME_LENG
-00002c00: 5448 203d 2039 390a 2020 2020 2020 2020  TH = 99.        
-00002c10: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-00002c20: 6528 0a20 2020 2020 2020 2020 2020 2076  e(.            v
-00002c30: 2c20 436f 6d70 6f6e 656e 740a 2020 2020  , Component.    
-00002c40: 2020 2020 292c 2066 2254 7970 6545 7272      ), f"TypeErr
-00002c50: 6f72 2c20 476f 7420 7b74 7970 6528 7629  or, Got {type(v)
-00002c60: 7d2c 2065 7870 6563 7469 6e67 2043 6f6d  }, expecting Com
-00002c70: 706f 6e65 6e74 220a 2020 2020 2020 2020  ponent".        
-00002c80: 6173 7365 7274 2028 0a20 2020 2020 2020  assert (.       
-00002c90: 2020 2020 206c 656e 2876 2e6e 616d 6529       len(v.name)
-00002ca0: 203c 3d20 4d41 585f 4e41 4d45 5f4c 454e   <= MAX_NAME_LEN
-00002cb0: 4754 480a 2020 2020 2020 2020 292c 2066  GTH.        ), f
-00002cc0: 226e 616d 6520 607b 762e 6e61 6d65 7d60  "name `{v.name}`
-00002cd0: 207b 6c65 6e28 762e 6e61 6d65 297d 203e   {len(v.name)} >
-00002ce0: 207b 4d41 585f 4e41 4d45 5f4c 454e 4754   {MAX_NAME_LENGT
-00002cf0: 487d 2022 0a20 2020 2020 2020 2072 6574  H} ".        ret
-00002d00: 7572 6e20 760a 0a20 2020 2040 7072 6f70  urn v..    @prop
-00002d10: 6572 7479 0a20 2020 2064 6566 206e 616d  erty.    def nam
-00002d20: 6564 5f72 6566 6572 656e 6365 7328 7365  ed_references(se
-00002d30: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00002d40: 7572 6e20 7365 6c66 2e5f 6e61 6d65 645f  urn self._named_
-00002d50: 7265 6665 7265 6e63 6573 0a0a 2020 2020  references..    
-00002d60: 6465 6620 6164 645f 6c61 6265 6c28 0a20  def add_label(. 
-00002d70: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00002d80: 2020 2020 2074 6578 743a 2073 7472 203d       text: str =
-00002d90: 2022 6865 6c6c 6f22 2c0a 2020 2020 2020   "hello",.      
-00002da0: 2020 706f 7369 7469 6f6e 3a20 7475 706c    position: tupl
-00002db0: 655b 666c 6f61 742c 2066 6c6f 6174 5d20  e[float, float] 
-00002dc0: 3d20 2830 2e30 2c20 302e 3029 2c0a 2020  = (0.0, 0.0),.  
-00002dd0: 2020 2020 2020 6d61 676e 6966 6963 6174        magnificat
-00002de0: 696f 6e3a 2066 6c6f 6174 203d 2031 2e30  ion: float = 1.0
-00002df0: 2c0a 2020 2020 2020 2020 726f 7461 7469  ,.        rotati
-00002e00: 6f6e 3a20 666c 6f61 7420 3d20 302c 0a20  on: float = 0,. 
-00002e10: 2020 2020 2020 2061 6e63 686f 723a 2073         anchor: s
-00002e20: 7472 203d 2022 6f22 2c0a 2020 2020 2020  tr = "o",.      
-00002e30: 2020 6c61 7965 723d 2254 4558 5422 2c0a    layer="TEXT",.
-00002e40: 2020 2020 2020 2020 785f 7265 666c 6563          x_reflec
-00002e50: 7469 6f6e 3d46 616c 7365 2c0a 2020 2020  tion=False,.    
-00002e60: 2920 2d3e 204c 6162 656c 3a0a 2020 2020  ) -> Label:.    
-00002e70: 2020 2020 2222 2241 6464 7320 4c61 6265      """Adds Labe
-00002e80: 6c20 746f 2074 6865 2043 6f6d 706f 6e65  l to the Compone
-00002e90: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
-00002ea0: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-00002eb0: 6578 743a 204c 6162 656c 2074 6578 742e  ext: Label text.
-00002ec0: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
-00002ed0: 6974 696f 6e3a 2078 2d2c 2079 2d63 6f6f  ition: x-, y-coo
-00002ee0: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
-00002ef0: 4c61 6265 6c20 6c6f 6361 7469 6f6e 2e0a  Label location..
-00002f00: 2020 2020 2020 2020 2020 2020 6d61 676e              magn
-00002f10: 6966 6963 6174 696f 6e3a 204d 6167 6e69  ification: Magni
-00002f20: 6669 6361 7469 6f6e 2066 6163 746f 7220  fication factor 
-00002f30: 666f 7220 7468 6520 4c61 6265 6c20 7465  for the Label te
-00002f40: 7874 2e0a 2020 2020 2020 2020 2020 2020  xt..            
-00002f50: 726f 7461 7469 6f6e 3a20 416e 676c 6520  rotation: Angle 
-00002f60: 726f 7461 7469 6f6e 206f 6620 7468 6520  rotation of the 
-00002f70: 4c61 6265 6c20 7465 7874 2e0a 2020 2020  Label text..    
-00002f80: 2020 2020 2020 2020 616e 6368 6f72 3a20          anchor: 
-00002f90: 7b27 6e27 2c20 2765 272c 2027 7327 2c20  {'n', 'e', 's', 
-00002fa0: 2777 272c 2027 6f27 2c20 276e 6527 2c20  'w', 'o', 'ne', 
-00002fb0: 276e 7727 2c20 2e2e 2e7d 0a20 2020 2020  'nw', ...}.     
-00002fc0: 2020 2020 2020 2020 2020 2050 6f73 6974             Posit
-00002fd0: 696f 6e20 6f66 2074 6865 2061 6e63 686f  ion of the ancho
-00002fe0: 7220 7265 6c61 7469 7665 2074 6f20 7468  r relative to th
-00002ff0: 6520 7465 7874 2e0a 2020 2020 2020 2020  e text..        
-00003000: 2020 2020 6c61 7965 723a 2053 7065 6369      layer: Speci
-00003010: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
-00003020: 7075 7420 4c61 6265 6c20 6f6e 2e0a 2020  put Label on..  
-00003030: 2020 2020 2020 2020 2020 785f 7265 666c            x_refl
-00003040: 6563 7469 6f6e 3a20 5472 7565 2072 6566  ection: True ref
-00003050: 6c65 6374 7320 6163 726f 7373 2074 6865  lects across the
-00003060: 2068 6f72 697a 6f6e 7461 6c20 6178 6973   horizontal axis
-00003070: 2062 6566 6f72 6520 726f 7461 7469 6f6e   before rotation
-00003080: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00003090: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-000030a0: 6374 6f72 792e 7064 6b20 696d 706f 7274  ctory.pdk import
-000030b0: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
-000030c0: 2020 2020 6c61 7965 7220 3d20 6765 745f      layer = get_
-000030d0: 6c61 7965 7228 6c61 7965 7229 0a0a 2020  layer(layer)..  
-000030e0: 2020 2020 2020 6764 735f 6c61 7965 722c        gds_layer,
-000030f0: 2067 6473 5f64 6174 6174 7970 6520 3d20   gds_datatype = 
-00003100: 6c61 7965 720a 0a20 2020 2020 2020 2069  layer..        i
-00003110: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00003120: 2874 6578 742c 2073 7472 293a 0a20 2020  (text, str):.   
-00003130: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-00003140: 7465 7874 0a20 2020 2020 2020 206c 6162  text.        lab
-00003150: 656c 203d 204c 6162 656c 280a 2020 2020  el = Label(.    
-00003160: 2020 2020 2020 2020 7465 7874 3d74 6578          text=tex
-00003170: 742c 0a20 2020 2020 2020 2020 2020 206f  t,.            o
-00003180: 7269 6769 6e3d 706f 7369 7469 6f6e 2c0a  rigin=position,.
-00003190: 2020 2020 2020 2020 2020 2020 616e 6368              anch
-000031a0: 6f72 3d61 6e63 686f 722c 0a20 2020 2020  or=anchor,.     
-000031b0: 2020 2020 2020 206d 6167 6e69 6669 6361         magnifica
-000031c0: 7469 6f6e 3d6d 6167 6e69 6669 6361 7469  tion=magnificati
-000031d0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-000031e0: 726f 7461 7469 6f6e 3d72 6f74 6174 696f  rotation=rotatio
-000031f0: 6e2c 0a20 2020 2020 2020 2020 2020 206c  n,.            l
-00003200: 6179 6572 3d67 6473 5f6c 6179 6572 2c0a  ayer=gds_layer,.
-00003210: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00003220: 7479 7065 3d67 6473 5f64 6174 6174 7970  type=gds_datatyp
-00003230: 652c 0a20 2020 2020 2020 2020 2020 2078  e,.            x
-00003240: 5f72 6566 6c65 6374 696f 6e3d 785f 7265  _reflection=x_re
-00003250: 666c 6563 7469 6f6e 2c0a 2020 2020 2020  flection,.      
-00003260: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
-00003270: 2e61 6464 286c 6162 656c 290a 2020 2020  .add(label).    
-00003280: 2020 2020 7265 7475 726e 206c 6162 656c      return label
-00003290: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-000032a0: 2020 2020 6465 6620 6262 6f78 2873 656c      def bbox(sel
-000032b0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
-000032c0: 6574 7572 6e73 2074 6865 2062 6f75 6e64  eturns the bound
-000032d0: 696e 6720 626f 7820 6f66 2074 6865 2043  ing box of the C
-000032e0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-000032f0: 652e 2222 220a 2020 2020 2020 2020 6262  e.""".        bb
-00003300: 6f78 203d 2073 656c 662e 5f63 656c 6c2e  ox = self._cell.
-00003310: 626f 756e 6469 6e67 5f62 6f78 2829 0a20  bounding_box(). 
-00003320: 2020 2020 2020 2069 6620 6262 6f78 2069         if bbox i
-00003330: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00003340: 2020 2020 6262 6f78 203d 2028 2830 2c20      bbox = ((0, 
-00003350: 3029 2c20 2830 2c20 3029 290a 2020 2020  0), (0, 0)).    
-00003360: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
-00003370: 7261 7928 6262 6f78 290a 0a20 2020 2040  ray(bbox)..    @
-00003380: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00003390: 2070 6f72 7473 5f6c 6179 6572 2873 656c   ports_layer(sel
-000033a0: 6629 202d 3e20 6469 6374 5b73 7472 2c20  f) -> dict[str, 
-000033b0: 7374 725d 3a0a 2020 2020 2020 2020 2222  str]:.        ""
-000033c0: 2252 6574 7572 6e73 2061 206d 6170 7069  "Returns a mappi
-000033d0: 6e67 2066 726f 6d20 6c61 7965 7230 5f6c  ng from layer0_l
-000033e0: 6179 6572 315f 4530 3a20 706f 7274 4e61  ayer1_E0: portNa
-000033f0: 6d65 2e22 2222 0a20 2020 2020 2020 2072  me.""".        r
-00003400: 6574 7572 6e20 6d61 705f 706f 7274 735f  eturn map_ports_
-00003410: 6c61 7965 725f 746f 5f6f 7269 656e 7461  layer_to_orienta
-00003420: 7469 6f6e 2873 656c 662e 706f 7274 7329  tion(self.ports)
-00003430: 0a0a 2020 2020 6465 6620 706f 7274 5f62  ..    def port_b
-00003440: 795f 6f72 6965 6e74 6174 696f 6e5f 6377  y_orientation_cw
-00003450: 2873 656c 662c 206b 6579 3a20 7374 722c  (self, key: str,
-00003460: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00003470: 2020 2020 2222 2252 6574 7572 6e73 2070      """Returns p
-00003480: 6f72 7420 6279 2069 6e64 6578 696e 6720  ort by indexing 
-00003490: 7468 656d 2063 6c6f 636b 7769 7365 2e22  them clockwise."
-000034a0: 2222 0a20 2020 2020 2020 206d 203d 206d  "".        m = m
-000034b0: 6170 5f70 6f72 7473 5f74 6f5f 6f72 6965  ap_ports_to_orie
-000034c0: 6e74 6174 696f 6e5f 6377 2873 656c 662e  ntation_cw(self.
-000034d0: 706f 7274 732c 202a 2a6b 7761 7267 7329  ports, **kwargs)
-000034e0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
-000034f0: 6e6f 7420 696e 206d 3a0a 2020 2020 2020  not in m:.      
-00003500: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
-00003510: 7272 6f72 2866 227b 6b65 797d 206e 6f74  rror(f"{key} not
-00003520: 2069 6e20 7b6c 6973 7428 6d2e 6b65 7973   in {list(m.keys
-00003530: 2829 297d 2229 0a20 2020 2020 2020 206b  ())}").        k
-00003540: 6579 3220 3d20 6d5b 6b65 795d 0a20 2020  ey2 = m[key].   
-00003550: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00003560: 2e70 6f72 7473 5b6b 6579 325d 0a0a 2020  .ports[key2]..  
-00003570: 2020 6465 6620 706f 7274 5f62 795f 6f72    def port_by_or
-00003580: 6965 6e74 6174 696f 6e5f 6363 7728 7365  ientation_ccw(se
-00003590: 6c66 2c20 6b65 793a 2073 7472 2c20 2a2a  lf, key: str, **
-000035a0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-000035b0: 2022 2222 5265 7475 726e 7320 706f 7274   """Returns port
-000035c0: 2062 7920 696e 6465 7869 6e67 2074 6865   by indexing the
-000035d0: 6d20 636c 6f63 6b77 6973 652e 2222 220a  m clockwise.""".
-000035e0: 2020 2020 2020 2020 6d20 3d20 6d61 705f          m = map_
-000035f0: 706f 7274 735f 746f 5f6f 7269 656e 7461  ports_to_orienta
-00003600: 7469 6f6e 5f63 6377 2873 656c 662e 706f  tion_ccw(self.po
-00003610: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
-00003620: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-00003630: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
-00003640: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
-00003650: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
-00003660: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
-00003670: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
-00003680: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
-00003690: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
-000036a0: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
-000036b0: 6465 6620 6765 745f 706f 7274 735f 7873  def get_ports_xs
-000036c0: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
-000036d0: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
-000036e0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000036f0: 2078 6469 7374 616e 6365 2066 726f 6d20   xdistance from 
-00003700: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
-00003710: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
-00003720: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-00003730: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
-00003740: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
-00003750: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00003760: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
-00003770: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-00003780: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
-00003790: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
-000037a0: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
-000037b0: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
-000037c0: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
-000037d0: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
-000037e0: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
-000037f0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-00003800: 745f 7479 7065 3a20 6f70 7469 6361 6c2c  t_type: optical,
-00003810: 2065 6c65 6374 7269 6361 6c2c 202e 2e2e   electrical, ...
-00003820: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00003830: 2020 2020 2070 6f72 7473 5f63 7720 3d20       ports_cw = 
-00003840: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
-00003850: 6973 7428 636c 6f63 6b77 6973 653d 5472  ist(clockwise=Tr
-00003860: 7565 2c20 2a2a 6b77 6172 6773 290a 2020  ue, **kwargs).  
-00003870: 2020 2020 2020 706f 7274 735f 6363 7720        ports_ccw 
-00003880: 3d20 7365 6c66 2e67 6574 5f70 6f72 7473  = self.get_ports
-00003890: 5f6c 6973 7428 636c 6f63 6b77 6973 653d  _list(clockwise=
-000038a0: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
-000038b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000038c0: 706f 7274 735f 6363 775b 305d 2e78 202d  ports_ccw[0].x -
-000038d0: 2070 6f72 7473 5f63 775b 305d 2e78 0a0a   ports_cw[0].x..
-000038e0: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
-000038f0: 735f 7973 697a 6528 7365 6c66 2c20 2a2a  s_ysize(self, **
-00003900: 6b77 6172 6773 2920 2d3e 2066 6c6f 6174  kwargs) -> float
-00003910: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00003920: 7572 6e73 2079 6469 7374 616e 6365 2066  urns ydistance f
-00003930: 726f 6d20 6561 7374 2074 6f20 7765 7374  rom east to west
-00003940: 2070 6f72 7473 2e0a 0a20 2020 2020 2020   ports...       
-00003950: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-00003960: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00003970: 3a20 706f 7274 2047 4453 206c 6179 6572  : port GDS layer
-00003980: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00003990: 6566 6978 3a20 7769 7468 2069 6e20 706f  efix: with in po
-000039a0: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
-000039b0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-000039c0: 3a20 696e 2064 6567 7265 6573 2e0a 2020  : in degrees..  
-000039d0: 2020 2020 2020 2020 2020 7769 6474 683a            width:
-000039e0: 2070 6f72 7420 7769 6474 6820 2875 6d29   port width (um)
-000039f0: 2e0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-00003a00: 7965 7273 5f65 7863 6c75 6465 643a 204c  yers_excluded: L
-00003a10: 6973 7420 6f66 206c 6179 6572 7320 746f  ist of layers to
-00003a20: 2065 7863 6c75 6465 2e0a 2020 2020 2020   exclude..      
-00003a30: 2020 2020 2020 706f 7274 5f74 7970 653a        port_type:
-00003a40: 206f 7074 6963 616c 2c20 656c 6563 7472   optical, electr
-00003a50: 6963 616c 2c20 2e2e 2e0a 2020 2020 2020  ical, ....      
-00003a60: 2020 2222 220a 2020 2020 2020 2020 706f    """.        po
-00003a70: 7274 735f 6377 203d 2073 656c 662e 6765  rts_cw = self.ge
-00003a80: 745f 706f 7274 735f 6c69 7374 2863 6c6f  t_ports_list(clo
-00003a90: 636b 7769 7365 3d54 7275 652c 202a 2a6b  ckwise=True, **k
-00003aa0: 7761 7267 7329 0a20 2020 2020 2020 2070  wargs).        p
-00003ab0: 6f72 7473 5f63 6377 203d 2073 656c 662e  orts_ccw = self.
-00003ac0: 6765 745f 706f 7274 735f 6c69 7374 2863  get_ports_list(c
-00003ad0: 6c6f 636b 7769 7365 3d46 616c 7365 2c20  lockwise=False, 
-00003ae0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-00003af0: 2020 7265 7475 726e 2070 6f72 7473 5f63    return ports_c
-00003b00: 6377 5b30 5d2e 7920 2d20 706f 7274 735f  cw[0].y - ports_
-00003b10: 6377 5b30 5d2e 790a 0a20 2020 2064 6566  cw[0].y..    def
-00003b20: 2070 6c6f 745f 6e65 746c 6973 7428 0a20   plot_netlist(. 
-00003b30: 2020 2020 2020 2073 656c 662c 2077 6974         self, wit
-00003b40: 685f 6c61 6265 6c73 3a20 626f 6f6c 203d  h_labels: bool =
-00003b50: 2054 7275 652c 2066 6f6e 745f 7765 6967   True, font_weig
-00003b60: 6874 3a20 7374 7220 3d20 226e 6f72 6d61  ht: str = "norma
-00003b70: 6c22 2c20 2a2a 6b77 6172 6773 0a20 2020  l", **kwargs.   
-00003b80: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
-00003b90: 6c6f 7473 2061 206e 6574 6c69 7374 2067  lots a netlist g
-00003ba0: 7261 7068 2077 6974 6820 6e65 7477 6f72  raph with networ
-00003bb0: 6b78 2e0a 0a20 2020 2020 2020 2041 7267  kx...        Arg
-00003bc0: 733a 0a20 2020 2020 2020 2020 2020 2077  s:.            w
-00003bd0: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
-00003be0: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
-00003bf0: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
-00003c00: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
-00003c10: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
-00003c20: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
-00003c30: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00003c40: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
-00003c50: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
-00003c60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003c70: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
-00003c80: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
-00003c90: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
-00003ca0: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
-00003cb0: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
-00003cc0: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
-00003cd0: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
-00003ce0: 6574 5f6e 6574 6c69 7374 282a 2a6b 7761  et_netlist(**kwa
-00003cf0: 7267 7329 0a20 2020 2020 2020 2063 6f6e  rgs).        con
-00003d00: 6e65 6374 696f 6e73 203d 206e 6574 6c69  nections = netli
-00003d10: 7374 5b22 636f 6e6e 6563 7469 6f6e 7322  st["connections"
-00003d20: 5d0a 2020 2020 2020 2020 706c 6163 656d  ].        placem
-00003d30: 656e 7473 203d 206e 6574 6c69 7374 5b22  ents = netlist["
-00003d40: 706c 6163 656d 656e 7473 225d 0a20 2020  placements"].   
-00003d50: 2020 2020 2047 203d 206e 782e 4772 6170       G = nx.Grap
-00003d60: 6828 290a 2020 2020 2020 2020 472e 6164  h().        G.ad
-00003d70: 645f 6564 6765 735f 6672 6f6d 280a 2020  d_edges_from(.  
-00003d80: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-00003d90: 2020 2020 2020 2020 2020 2020 2822 2c22              (","
-00003da0: 2e6a 6f69 6e28 6b2e 7370 6c69 7428 222c  .join(k.split(",
-00003db0: 2229 5b3a 2d31 5d29 2c20 222c 222e 6a6f  ")[:-1]), ",".jo
-00003dc0: 696e 2876 2e73 706c 6974 2822 2c22 295b  in(v.split(",")[
-00003dd0: 3a2d 315d 2929 0a20 2020 2020 2020 2020  :-1])).         
-00003de0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00003df0: 696e 2063 6f6e 6e65 6374 696f 6e73 2e69  in connections.i
-00003e00: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
-00003e10: 2020 205d 0a20 2020 2020 2020 2029 0a20     ].        ). 
-00003e20: 2020 2020 2020 2070 6f73 203d 207b 6b3a         pos = {k:
-00003e30: 2028 765b 2278 225d 2c20 765b 2279 225d   (v["x"], v["y"]
-00003e40: 2920 666f 7220 6b2c 2076 2069 6e20 706c  ) for k, v in pl
-00003e50: 6163 656d 656e 7473 2e69 7465 6d73 2829  acements.items()
-00003e60: 7d0a 2020 2020 2020 2020 6c61 6265 6c73  }.        labels
-00003e70: 203d 207b 6b3a 2022 2c22 2e6a 6f69 6e28   = {k: ",".join(
-00003e80: 6b2e 7370 6c69 7428 222c 2229 5b3a 315d  k.split(",")[:1]
-00003e90: 2920 666f 7220 6b20 696e 2070 6c61 6365  ) for k in place
-00003ea0: 6d65 6e74 732e 6b65 7973 2829 7d0a 2020  ments.keys()}.  
-00003eb0: 2020 2020 2020 6e78 2e64 7261 7728 0a20        nx.draw(. 
-00003ec0: 2020 2020 2020 2020 2020 2047 2c0a 2020             G,.  
-00003ed0: 2020 2020 2020 2020 2020 7769 7468 5f6c            with_l
-00003ee0: 6162 656c 733d 7769 7468 5f6c 6162 656c  abels=with_label
-00003ef0: 732c 0a20 2020 2020 2020 2020 2020 2066  s,.            f
-00003f00: 6f6e 745f 7765 6967 6874 3d66 6f6e 745f  ont_weight=font_
-00003f10: 7765 6967 6874 2c0a 2020 2020 2020 2020  weight,.        
-00003f20: 2020 2020 6c61 6265 6c73 3d6c 6162 656c      labels=label
-00003f30: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
-00003f40: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
-00003f50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00003f60: 2047 0a0a 2020 2020 6465 6620 706c 6f74   G..    def plot
-00003f70: 5f6e 6574 6c69 7374 5f66 6c61 7428 0a20  _netlist_flat(. 
-00003f80: 2020 2020 2020 2073 656c 662c 2077 6974         self, wit
-00003f90: 685f 6c61 6265 6c73 3a20 626f 6f6c 203d  h_labels: bool =
-00003fa0: 2054 7275 652c 2066 6f6e 745f 7765 6967   True, font_weig
-00003fb0: 6874 3a20 7374 7220 3d20 226e 6f72 6d61  ht: str = "norma
-00003fc0: 6c22 2c20 2a2a 6b77 6172 6773 0a20 2020  l", **kwargs.   
-00003fd0: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
-00003fe0: 6c6f 7473 2061 206e 6574 6c69 7374 2067  lots a netlist g
-00003ff0: 7261 7068 2077 6974 6820 6e65 7477 6f72  raph with networ
-00004000: 6b78 2e0a 0a20 2020 2020 2020 2041 7267  kx...        Arg
-00004010: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-00004020: 6c61 743a 2069 6620 7472 7565 2c20 7769  lat: if true, wi
-00004030: 6c6c 2070 6c6f 7420 7468 6520 666c 6174  ll plot the flat
-00004040: 206e 6574 6c69 7374 0a20 2020 2020 2020   netlist.       
-00004050: 2020 2020 2077 6974 685f 6c61 6265 6c73       with_labels
-00004060: 3a20 6164 6420 6c61 6265 6c20 746f 2065  : add label to e
-00004070: 6163 6820 6e6f 6465 2e0a 2020 2020 2020  ach node..      
-00004080: 2020 2020 2020 666f 6e74 5f77 6569 6768        font_weigh
-00004090: 743a 206e 6f72 6d61 6c2c 2062 6f6c 642e  t: normal, bold.
-000040a0: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
-000040b0: 7761 7267 733a 206b 6579 776f 7264 2061  wargs: keyword a
-000040c0: 7267 756d 656e 7473 2066 6f72 2074 6865  rguments for the
-000040d0: 2067 6574 5f6e 6574 6c69 7374 2066 756e   get_netlist fun
-000040e0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-000040f0: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
-00004100: 206d 6174 706c 6f74 6c69 622e 7079 706c   matplotlib.pypl
-00004110: 6f74 2061 7320 706c 740a 2020 2020 2020  ot as plt.      
-00004120: 2020 696d 706f 7274 206e 6574 776f 726b    import network
-00004130: 7820 6173 206e 780a 0a20 2020 2020 2020  x as nx..       
-00004140: 2070 6c74 2e66 6967 7572 6528 290a 2020   plt.figure().  
-00004150: 2020 2020 2020 6e65 746c 6973 7420 3d20        netlist = 
-00004160: 7365 6c66 2e67 6574 5f6e 6574 6c69 7374  self.get_netlist
-00004170: 5f66 6c61 7428 2a2a 6b77 6172 6773 290a  _flat(**kwargs).
-00004180: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00004190: 6f6e 7320 3d20 6e65 746c 6973 745b 2263  ons = netlist["c
-000041a0: 6f6e 6e65 6374 696f 6e73 225d 0a20 2020  onnections"].   
-000041b0: 2020 2020 2070 6c61 6365 6d65 6e74 7320       placements 
-000041c0: 3d20 6e65 746c 6973 745b 2270 6c61 6365  = netlist["place
-000041d0: 6d65 6e74 7322 5d0a 2020 2020 2020 2020  ments"].        
-000041e0: 636f 6e6e 6563 7469 6f6e 735f 6c69 7374  connections_list
-000041f0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00004200: 7220 6b2c 2076 5f6c 6973 7420 696e 2063  r k, v_list in c
-00004210: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
-00004220: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00004230: 636f 6e6e 6563 7469 6f6e 735f 6c69 7374  connections_list
-00004240: 2e65 7874 656e 6428 0a20 2020 2020 2020  .extend(.       
-00004250: 2020 2020 2020 2020 2028 222c 222e 6a6f           (",".jo
-00004260: 696e 286b 2e73 706c 6974 2822 2c22 295b  in(k.split(",")[
-00004270: 3a2d 315d 292c 2022 2c22 2e6a 6f69 6e28  :-1]), ",".join(
-00004280: 762e 7370 6c69 7428 222c 2229 5b3a 2d31  v.split(",")[:-1
-00004290: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-000042a0: 2020 2020 666f 7220 7620 696e 2076 5f6c      for v in v_l
-000042b0: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-000042c0: 290a 2020 2020 2020 2020 4720 3d20 6e78  ).        G = nx
-000042d0: 2e47 7261 7068 2829 0a20 2020 2020 2020  .Graph().       
-000042e0: 2047 2e61 6464 5f65 6467 6573 5f66 726f   G.add_edges_fro
-000042f0: 6d28 636f 6e6e 6563 7469 6f6e 735f 6c69  m(connections_li
-00004300: 7374 290a 2020 2020 2020 2020 706f 7320  st).        pos 
-00004310: 3d20 7b6b 3a20 2876 5b22 7822 5d2c 2076  = {k: (v["x"], v
-00004320: 5b22 7922 5d29 2066 6f72 206b 2c20 7620  ["y"]) for k, v 
-00004330: 696e 2070 6c61 6365 6d65 6e74 732e 6974  in placements.it
-00004340: 656d 7328 297d 0a20 2020 2020 2020 206c  ems()}.        l
-00004350: 6162 656c 7320 3d20 7b6b 3a20 222c 222e  abels = {k: ",".
-00004360: 6a6f 696e 286b 2e73 706c 6974 2822 2c22  join(k.split(","
-00004370: 295b 3a31 5d29 2066 6f72 206b 2069 6e20  )[:1]) for k in 
-00004380: 706c 6163 656d 656e 7473 2e6b 6579 7328  placements.keys(
-00004390: 297d 0a20 2020 2020 2020 206e 782e 6472  )}.        nx.dr
-000043a0: 6177 280a 2020 2020 2020 2020 2020 2020  aw(.            
-000043b0: 472c 0a20 2020 2020 2020 2020 2020 2077  G,.            w
-000043c0: 6974 685f 6c61 6265 6c73 3d77 6974 685f  ith_labels=with_
-000043d0: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
-000043e0: 2020 2020 666f 6e74 5f77 6569 6768 743d      font_weight=
-000043f0: 666f 6e74 5f77 6569 6768 742c 0a20 2020  font_weight,.   
-00004400: 2020 2020 2020 2020 206c 6162 656c 733d           labels=
-00004410: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
-00004420: 2020 2020 706f 733d 706f 732c 0a20 2020      pos=pos,.   
-00004430: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-00004440: 6574 7572 6e20 470a 0a20 2020 2064 6566  eturn G..    def
-00004450: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
-00004460: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
-00004470: 2920 2d3e 2064 6963 745b 7374 722c 2041  ) -> dict[str, A
-00004480: 6e79 5d3a 0a20 2020 2020 2020 2066 726f  ny]:.        fro
-00004490: 6d20 6764 7366 6163 746f 7279 2e67 6574  m gdsfactory.get
-000044a0: 5f6e 6574 6c69 7374 2069 6d70 6f72 7420  _netlist import 
-000044b0: 6765 745f 6e65 746c 6973 745f 7961 6d6c  get_netlist_yaml
-000044c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000044d0: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
-000044e0: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
-000044f0: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-00004500: 5f6e 6574 6c69 7374 2873 656c 662c 2066  _netlist(self, f
-00004510: 696c 6570 6174 683a 2073 7472 2920 2d3e  ilepath: str) ->
-00004520: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00004530: 2222 5772 6974 6520 6e65 746c 6973 7420  ""Write netlist 
-00004540: 696e 2059 414d 4c2e 2222 220a 2020 2020  in YAML.""".    
-00004550: 2020 2020 6e65 746c 6973 7420 3d20 7365      netlist = se
-00004560: 6c66 2e67 6574 5f6e 6574 6c69 7374 2829  lf.get_netlist()
-00004570: 0a20 2020 2020 2020 206e 6574 6c69 7374  .        netlist
-00004580: 203d 2063 6c65 616e 5f64 6963 7428 6e65   = clean_dict(ne
-00004590: 746c 6973 7429 0a20 2020 2020 2020 2066  tlist).        f
-000045a0: 696c 6570 6174 6820 3d20 7061 7468 6c69  ilepath = pathli
-000045b0: 622e 5061 7468 2866 696c 6570 6174 6829  b.Path(filepath)
-000045c0: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
-000045d0: 682e 7772 6974 655f 7465 7874 2879 616d  h.write_text(yam
-000045e0: 6c2e 6475 6d70 286e 6574 6c69 7374 2929  l.dump(netlist))
-000045f0: 0a0a 2020 2020 6465 6620 7772 6974 655f  ..    def write_
-00004600: 6e65 746c 6973 745f 646f 7428 7365 6c66  netlist_dot(self
-00004610: 2c20 6669 6c65 7061 7468 3a20 7374 7220  , filepath: str 
-00004620: 7c20 4e6f 6e65 203d 204e 6f6e 6529 202d  | None = None) -
-00004630: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00004640: 2222 2257 7269 7465 206e 6574 6c69 7374  """Write netlist
-00004650: 2067 7261 7068 2069 6e20 444f 5420 666f   graph in DOT fo
-00004660: 726d 6174 2e22 2222 0a20 2020 2020 2020  rmat.""".       
-00004670: 2066 726f 6d20 6e65 7477 6f72 6b78 2e64   from networkx.d
-00004680: 7261 7769 6e67 2e6e 785f 6167 7261 7068  rawing.nx_agraph
-00004690: 2069 6d70 6f72 7420 7772 6974 655f 646f   import write_do
-000046a0: 740a 0a20 2020 2020 2020 2066 696c 6570  t..        filep
-000046b0: 6174 6820 3d20 6669 6c65 7061 7468 206f  ath = filepath o
-000046c0: 7220 6622 7b73 656c 662e 6e61 6d65 7d2e  r f"{self.name}.
-000046d0: 646f 7422 0a0a 2020 2020 2020 2020 4720  dot"..        G 
-000046e0: 3d20 7365 6c66 2e70 6c6f 745f 6e65 746c  = self.plot_netl
-000046f0: 6973 7428 290a 2020 2020 2020 2020 7772  ist().        wr
-00004700: 6974 655f 646f 7428 472c 2066 696c 6570  ite_dot(G, filep
-00004710: 6174 6829 0a0a 2020 2020 6465 6620 6765  ath)..    def ge
-00004720: 745f 6e65 746c 6973 7428 7365 6c66 2c20  t_netlist(self, 
-00004730: 2a2a 6b77 6172 6773 2920 2d3e 2064 6963  **kwargs) -> dic
-00004740: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
-00004750: 2020 2020 2022 2222 4672 6f6d 2043 6f6d       """From Com
-00004760: 706f 6e65 6e74 2072 6574 7572 6e73 2069  ponent returns i
-00004770: 6e73 7461 6e63 6573 2c20 636f 6e6e 6563  nstances, connec
-00004780: 7469 6f6e 7320 616e 6420 706c 6163 656d  tions and placem
-00004790: 656e 7473 2064 6963 742e 0a0a 2020 2020  ents dict...    
-000047a0: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-000047b0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-000047c0: 6d70 6f6e 656e 743a 2074 6f20 6578 7472  mponent: to extr
-000047d0: 6163 7420 6e65 746c 6973 742e 0a20 2020  act netlist..   
-000047e0: 2020 2020 2020 2020 2066 756c 6c5f 7365           full_se
-000047f0: 7474 696e 6773 3a20 5472 7565 2072 6574  ttings: True ret
-00004800: 7572 6e73 2061 6c6c 2c20 6661 6c73 6520  urns all, false 
-00004810: 6368 616e 6765 6420 7365 7474 696e 6773  changed settings
-00004820: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00004830: 6c65 7261 6e63 653a 2074 6f6c 6572 616e  lerance: toleran
-00004840: 6365 2069 6e20 6e6d 2074 6f20 636f 6e73  ce in nm to cons
-00004850: 6964 6572 2074 776f 2070 6f72 7473 2063  ider two ports c
-00004860: 6f6e 6e65 6374 6564 2e0a 2020 2020 2020  onnected..      
-00004870: 2020 2020 2020 6578 636c 7564 655f 706f        exclude_po
-00004880: 7274 5f74 7970 6573 3a20 6f70 7469 6f6e  rt_types: option
-00004890: 616c 206c 6973 7420 6f66 2070 6f72 7420  al list of port 
-000048a0: 7479 7065 7320 746f 2065 7863 6c75 6465  types to exclude
-000048b0: 2066 726f 6d20 6e65 746c 6973 7469 6e67   from netlisting
-000048c0: 2e0a 2020 2020 2020 2020 2020 2020 6765  ..            ge
-000048d0: 745f 696e 7374 616e 6365 5f6e 616d 653a  t_instance_name:
-000048e0: 2066 756e 6374 696f 6e20 746f 2067 6574   function to get
-000048f0: 2069 6e73 7461 6e63 6520 6e61 6d65 2e0a   instance name..
-00004900: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
-00004910: 775f 6d75 6c74 6970 6c65 3a20 4661 6c73  w_multiple: Fals
-00004920: 6520 746f 2072 6169 7365 2061 6e20 6572  e to raise an er
-00004930: 726f 7220 6966 206d 6f72 6520 7468 616e  ror if more than
-00004940: 2074 776f 2070 6f72 7473 2073 6861 7265   two ports share
-00004950: 2074 6865 2073 616d 6520 636f 6e6e 6563   the same connec
-00004960: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
-00004970: 2020 2020 2020 6966 2054 7275 652c 2077        if True, w
-00004980: 696c 6c20 7265 7475 726e 206b 6579 3a20  ill return key: 
-00004990: 5b76 616c 7565 5d20 7061 6972 7320 7769  [value] pairs wi
-000049a0: 7468 205b 7661 6c75 655d 2061 206c 6973  th [value] a lis
-000049b0: 7420 6f66 2061 6c6c 2063 6f6e 6e65 6374  t of all connect
-000049c0: 6564 2069 6e73 7461 6e63 6573 2e0a 0a20  ed instances... 
-000049d0: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-000049e0: 2020 2020 2020 2020 2020 2020 4e65 746c              Netl
-000049f0: 6973 7420 6469 6374 2028 696e 7374 616e  ist dict (instan
-00004a00: 6365 732c 2063 6f6e 6e65 6374 696f 6e73  ces, connections
-00004a10: 2c20 706c 6163 656d 656e 7473 2c20 706f  , placements, po
-00004a20: 7274 7329 0a20 2020 2020 2020 2020 2020  rts).           
-00004a30: 2020 2020 2069 6e73 7461 6e63 6573 3a20       instances: 
-00004a40: 4469 6374 206f 6620 696e 7374 616e 6365  Dict of instance
-00004a50: 206e 616d 6520 616e 6420 7365 7474 696e   name and settin
-00004a60: 6773 2e0a 2020 2020 2020 2020 2020 2020  gs..            
-00004a70: 2020 2020 636f 6e6e 6563 7469 6f6e 733a      connections:
-00004a80: 2044 6963 7420 6f66 2049 6e73 7461 6e63   Dict of Instanc
-00004a90: 6531 4e61 6d65 2c70 6f72 744e 616d 653a  e1Name,portName:
-00004aa0: 2049 6e73 7461 6e63 6532 4e61 6d65 2c70   Instance2Name,p
-00004ab0: 6f72 744e 616d 652e 0a20 2020 2020 2020  ortName..       
-00004ac0: 2020 2020 2020 2020 2070 6c61 6365 6d65           placeme
-00004ad0: 6e74 733a 2044 6963 7420 6f66 2069 6e73  nts: Dict of ins
-00004ae0: 7461 6e63 6520 6e61 6d65 7320 616e 6420  tance names and 
-00004af0: 706c 6163 656d 656e 7473 2028 782c 2079  placements (x, y
-00004b00: 2c20 726f 7461 7469 6f6e 292e 0a20 2020  , rotation)..   
-00004b10: 2020 2020 2020 2020 2020 2020 2070 6f72               por
-00004b20: 7473 3a20 4469 6374 2070 6f72 744e 616d  ts: Dict portNam
-00004b30: 653a 2043 6f6d 706f 6e65 6e74 4e61 6d65  e: ComponentName
-00004b40: 2c70 6f72 742e 0a20 2020 2020 2020 2020  ,port..         
-00004b50: 2020 2020 2020 206e 616d 653a 206e 616d         name: nam
-00004b60: 6520 6f66 2063 6f6d 706f 6e65 6e74 2e0a  e of component..
-00004b70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00004b80: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-00004b90: 6f72 792e 6765 745f 6e65 746c 6973 7420  ory.get_netlist 
-00004ba0: 696d 706f 7274 2067 6574 5f6e 6574 6c69  import get_netli
-00004bb0: 7374 0a0a 2020 2020 2020 2020 7265 7475  st..        retu
-00004bc0: 726e 2067 6574 5f6e 6574 6c69 7374 2863  rn get_netlist(c
-00004bd0: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
-00004be0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-00004bf0: 6620 6765 745f 6e65 746c 6973 745f 7265  f get_netlist_re
-00004c00: 6375 7273 6976 6528 7365 6c66 2c20 2a2a  cursive(self, **
-00004c10: 6b77 6172 6773 2920 2d3e 2064 6963 745b  kwargs) -> dict[
-00004c20: 7374 722c 2044 6963 7443 6f6e 6669 675d  str, DictConfig]
-00004c30: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00004c40: 7572 6e73 2072 6563 7572 7369 7665 206e  urns recursive n
-00004c50: 6574 6c69 7374 2066 6f72 2061 2063 6f6d  etlist for a com
-00004c60: 706f 6e65 6e74 2061 6e64 2073 7562 636f  ponent and subco
-00004c70: 6d70 6f6e 656e 7473 2e0a 0a20 2020 2020  mponents...     
-00004c80: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
-00004c90: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-00004ca0: 706f 6e65 6e74 3a20 746f 2065 7874 7261  ponent: to extra
-00004cb0: 6374 206e 6574 6c69 7374 2e0a 2020 2020  ct netlist..    
-00004cc0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-00004cd0: 745f 7375 6666 6978 3a20 7375 6666 6978  t_suffix: suffix
-00004ce0: 2074 6f20 6170 7065 6e64 2074 6f20 6561   to append to ea
-00004cf0: 6368 2063 6f6d 706f 6e65 6e74 206e 616d  ch component nam
-00004d00: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
-00004d10: 2020 2075 7365 6675 6c20 6966 2074 6f20     useful if to 
-00004d20: 7361 7665 2061 6e64 2072 656c 6f61 6420  save and reload 
-00004d30: 6120 6261 636b 2d61 6e6e 6f74 6174 6564  a back-annotated
-00004d40: 206e 6574 6c69 7374 2e0a 2020 2020 2020   netlist..      
-00004d50: 2020 2020 2020 6765 745f 6e65 746c 6973        get_netlis
-00004d60: 745f 6675 6e63 3a20 6675 6e63 7469 6f6e  t_func: function
-00004d70: 2074 6f20 6578 7472 6163 7420 696e 6469   to extract indi
-00004d80: 7669 6475 616c 206e 6574 6c69 7374 732e  vidual netlists.
-00004d90: 0a20 2020 2020 2020 2020 2020 2066 756c  .            ful
-00004da0: 6c5f 7365 7474 696e 6773 3a20 5472 7565  l_settings: True
-00004db0: 2072 6574 7572 6e73 2061 6c6c 2c20 6661   returns all, fa
-00004dc0: 6c73 6520 6368 616e 6765 6420 7365 7474  lse changed sett
-00004dd0: 696e 6773 2e0a 2020 2020 2020 2020 2020  ings..          
-00004de0: 2020 746f 6c65 7261 6e63 653a 2074 6f6c    tolerance: tol
-00004df0: 6572 616e 6365 2069 6e20 6e6d 2074 6f20  erance in nm to 
-00004e00: 636f 6e73 6964 6572 2074 776f 2070 6f72  consider two por
-00004e10: 7473 2063 6f6e 6e65 6374 6564 2e0a 2020  ts connected..  
-00004e20: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00004e30: 655f 706f 7274 5f74 7970 6573 3a20 6f70  e_port_types: op
-00004e40: 7469 6f6e 616c 206c 6973 7420 6f66 2070  tional list of p
-00004e50: 6f72 7420 7479 7065 7320 746f 2065 7863  ort types to exc
-00004e60: 6c75 6465 2066 726f 6d20 6e65 746c 6973  lude from netlis
-00004e70: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
-00004e80: 2020 6765 745f 696e 7374 616e 6365 5f6e    get_instance_n
-00004e90: 616d 653a 2066 756e 6374 696f 6e20 746f  ame: function to
-00004ea0: 2067 6574 2069 6e73 7461 6e63 6520 6e61   get instance na
-00004eb0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-00004ec0: 616c 6c6f 775f 6d75 6c74 6970 6c65 3a20  allow_multiple: 
-00004ed0: 4661 6c73 6520 746f 2072 6169 7365 2061  False to raise a
-00004ee0: 6e20 6572 726f 7220 6966 206d 6f72 6520  n error if more 
-00004ef0: 7468 616e 2074 776f 2070 6f72 7473 2073  than two ports s
-00004f00: 6861 7265 2074 6865 2073 616d 6520 636f  hare the same co
-00004f10: 6e6e 6563 7469 6f6e 2e0a 2020 2020 2020  nnection..      
-00004f20: 2020 2020 2020 2020 2020 6966 2054 7275            if Tru
-00004f30: 652c 2077 696c 6c20 7265 7475 726e 206b  e, will return k
-00004f40: 6579 3a20 5b76 616c 7565 5d20 7061 6972  ey: [value] pair
-00004f50: 7320 7769 7468 205b 7661 6c75 655d 2061  s with [value] a
-00004f60: 206c 6973 7420 6f66 2061 6c6c 2063 6f6e   list of all con
-00004f70: 6e65 6374 6564 2069 6e73 7461 6e63 6573  nected instances
-00004f80: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00004f90: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00004fa0: 4469 6374 696f 6e61 7279 206f 6620 6e65  Dictionary of ne
-00004fb0: 746c 6973 7473 2c20 6b65 7965 6420 6279  tlists, keyed by
-00004fc0: 2074 6865 206e 616d 6520 6f66 2065 6163   the name of eac
-00004fd0: 6820 636f 6d70 6f6e 656e 742e 0a20 2020  h component..   
-00004fe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00004ff0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-00005000: 2e67 6574 5f6e 6574 6c69 7374 2069 6d70  .get_netlist imp
-00005010: 6f72 7420 6765 745f 6e65 746c 6973 745f  ort get_netlist_
-00005020: 7265 6375 7273 6976 650a 0a20 2020 2020  recursive..     
-00005030: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
-00005040: 746c 6973 745f 7265 6375 7273 6976 6528  tlist_recursive(
-00005050: 636f 6d70 6f6e 656e 743d 7365 6c66 2c20  component=self, 
-00005060: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00005070: 6566 2067 6574 5f6e 6574 6c69 7374 5f66  ef get_netlist_f
-00005080: 6c61 7428 7365 6c66 2c20 2a2a 6b77 6172  lat(self, **kwar
-00005090: 6773 2920 2d3e 2064 6963 745b 7374 722c  gs) -> dict[str,
-000050a0: 2044 6963 7443 6f6e 6669 675d 3a0a 2020   DictConfig]:.  
-000050b0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000050c0: 2061 206e 6574 6c69 7374 2077 6865 7265   a netlist where
-000050d0: 2061 6c6c 2073 7562 696e 7374 616e 6365   all subinstance
-000050e0: 7320 6172 6520 6578 706f 7365 6420 616e  s are exposed an
-000050f0: 6420 696e 6465 7065 6e64 656e 746c 7920  d independently 
-00005100: 6e61 6d65 642e 0a0a 2020 2020 2020 2020  named...        
-00005110: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
-00005120: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-00005130: 656e 743a 2074 6f20 6578 7472 6163 7420  ent: to extract 
-00005140: 6e65 746c 6973 742e 0a20 2020 2020 2020  netlist..       
-00005150: 2020 2020 2063 6f6d 706f 6e65 6e74 5f73       component_s
-00005160: 7566 6669 783a 2073 7566 6669 7820 746f  uffix: suffix to
-00005170: 2061 7070 656e 6420 746f 2065 6163 6820   append to each 
-00005180: 636f 6d70 6f6e 656e 7420 6e61 6d65 2e0a  component name..
-00005190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051a0: 7573 6566 756c 2069 6620 746f 2073 6176  useful if to sav
-000051b0: 6520 616e 6420 7265 6c6f 6164 2061 2062  e and reload a b
-000051c0: 6163 6b2d 616e 6e6f 7461 7465 6420 6e65  ack-annotated ne
-000051d0: 746c 6973 742e 0a20 2020 2020 2020 2020  tlist..         
-000051e0: 2020 2067 6574 5f6e 6574 6c69 7374 5f66     get_netlist_f
-000051f0: 756e 633a 2066 756e 6374 696f 6e20 746f  unc: function to
-00005200: 2065 7874 7261 6374 2069 6e64 6976 6964   extract individ
-00005210: 7561 6c20 6e65 746c 6973 7473 2e0a 2020  ual netlists..  
-00005220: 2020 2020 2020 2020 2020 6675 6c6c 5f73            full_s
-00005230: 6574 7469 6e67 733a 2054 7275 6520 7265  ettings: True re
-00005240: 7475 726e 7320 616c 6c2c 2066 616c 7365  turns all, false
-00005250: 2063 6861 6e67 6564 2073 6574 7469 6e67   changed setting
-00005260: 732e 0a20 2020 2020 2020 2020 2020 2074  s..            t
-00005270: 6f6c 6572 616e 6365 3a20 746f 6c65 7261  olerance: tolera
-00005280: 6e63 6520 696e 206e 6d20 746f 2063 6f6e  nce in nm to con
-00005290: 7369 6465 7220 7477 6f20 706f 7274 7320  sider two ports 
-000052a0: 636f 6e6e 6563 7465 642e 0a20 2020 2020  connected..     
-000052b0: 2020 2020 2020 2065 7863 6c75 6465 5f70         exclude_p
-000052c0: 6f72 745f 7479 7065 733a 206f 7074 696f  ort_types: optio
-000052d0: 6e61 6c20 6c69 7374 206f 6620 706f 7274  nal list of port
-000052e0: 2074 7970 6573 2074 6f20 6578 636c 7564   types to exclud
-000052f0: 6520 6672 6f6d 206e 6574 6c69 7374 696e  e from netlistin
-00005300: 672e 0a20 2020 2020 2020 2020 2020 2067  g..            g
-00005310: 6574 5f69 6e73 7461 6e63 655f 6e61 6d65  et_instance_name
-00005320: 3a20 6675 6e63 7469 6f6e 2074 6f20 6765  : function to ge
-00005330: 7420 696e 7374 616e 6365 206e 616d 652e  t instance name.
-00005340: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
-00005350: 6f77 5f6d 756c 7469 706c 653a 2046 616c  ow_multiple: Fal
-00005360: 7365 2074 6f20 7261 6973 6520 616e 2065  se to raise an e
-00005370: 7272 6f72 2069 6620 6d6f 7265 2074 6861  rror if more tha
-00005380: 6e20 7477 6f20 706f 7274 7320 7368 6172  n two ports shar
-00005390: 6520 7468 6520 7361 6d65 2063 6f6e 6e65  e the same conne
-000053a0: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-000053b0: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
-000053c0: 7769 6c6c 2072 6574 7572 6e20 6b65 793a  will return key:
-000053d0: 205b 7661 6c75 655d 2070 6169 7273 2077   [value] pairs w
-000053e0: 6974 6820 5b76 616c 7565 5d20 6120 6c69  ith [value] a li
-000053f0: 7374 206f 6620 616c 6c20 636f 6e6e 6563  st of all connec
-00005400: 7465 6420 696e 7374 616e 6365 732e 0a0a  ted instances...
-00005410: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00005420: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
-00005430: 7469 6f6e 6172 7920 6f66 206e 6574 6c69  tionary of netli
-00005440: 7374 732c 206b 6579 6564 2062 7920 7468  sts, keyed by th
-00005450: 6520 6e61 6d65 206f 6620 6561 6368 2063  e name of each c
-00005460: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
-00005470: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00005480: 6f6d 2067 6473 6661 6374 6f72 792e 6765  om gdsfactory.ge
-00005490: 745f 6e65 746c 6973 745f 666c 6174 2069  t_netlist_flat i
-000054a0: 6d70 6f72 7420 6765 745f 6e65 746c 6973  mport get_netlis
-000054b0: 745f 666c 6174 0a0a 2020 2020 2020 2020  t_flat..        
-000054c0: 7265 7475 726e 2067 6574 5f6e 6574 6c69  return get_netli
-000054d0: 7374 5f66 6c61 7428 636f 6d70 6f6e 656e  st_flat(componen
-000054e0: 743d 7365 6c66 2c20 2a2a 6b77 6172 6773  t=self, **kwargs
-000054f0: 290a 0a20 2020 2064 6566 2061 7373 6572  )..    def asser
-00005500: 745f 706f 7274 735f 6f6e 5f67 7269 6428  t_ports_on_grid(
-00005510: 7365 6c66 2c20 6e6d 3a20 696e 7420 3d20  self, nm: int = 
-00005520: 3129 202d 3e20 4e6f 6e65 3a0a 2020 2020  1) -> None:.    
-00005530: 2020 2020 2222 2241 7373 6572 7473 2074      """Asserts t
-00005540: 6861 7420 616c 6c20 706f 7274 7320 6172  hat all ports ar
-00005550: 6520 6f6e 2067 7269 642e 2222 220a 2020  e on grid.""".  
-00005560: 2020 2020 2020 666f 7220 706f 7274 2069        for port i
-00005570: 6e20 7365 6c66 2e70 6f72 7473 2e76 616c  n self.ports.val
-00005580: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
-00005590: 2020 2070 6f72 742e 6173 7365 7274 5f6f     port.assert_o
-000055a0: 6e5f 6772 6964 286e 6d3d 6e6d 290a 0a20  n_grid(nm=nm).. 
-000055b0: 2020 2064 6566 2067 6574 5f70 6f72 7473     def get_ports
-000055c0: 2873 656c 662c 2064 6570 7468 3d4e 6f6e  (self, depth=Non
-000055d0: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
-000055e0: 6574 7572 6e73 2063 6f70 6965 7320 6f66  eturns copies of
-000055f0: 2061 6c6c 2074 6865 2070 6f72 7473 206f   all the ports o
-00005600: 6620 7468 6520 436f 6d70 6f6e 656e 742c  f the Component,
-00005610: 2072 6f74 6174 6564 2061 6e64 205c 0a20   rotated and \. 
-00005620: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00005630: 7261 6e73 6c61 7465 6420 736f 2074 6861  ranslated so tha
-00005640: 7420 7468 6579 2772 6520 696e 2074 6865  t they're in the
-00005650: 6972 2074 6f70 2d6c 6576 656c 2070 6f73  ir top-level pos
-00005660: 6974 696f 6e2e 0a0a 2020 2020 2020 2020  ition...        
-00005670: 5468 6520 506f 7274 7320 7265 7475 726e  The Ports return
-00005680: 6564 2061 7265 2063 6f70 6965 7320 6f66  ed are copies of
-00005690: 2074 6865 206f 7269 6769 6e61 6c73 2c20   the originals, 
-000056a0: 6275 7420 6561 6368 2063 6f70 7920 6861  but each copy ha
-000056b0: 7320 7468 6520 7361 6d65 0a20 2020 2020  s the same.     
-000056c0: 2020 2060 6075 6964 6060 2061 7320 7468     ``uid`` as th
-000056d0: 6520 6f72 6967 696e 616c 2073 6f20 7468  e original so th
-000056e0: 6174 2074 6865 7920 6361 6e20 6265 2074  at they can be t
-000056f0: 7261 6365 6420 6261 636b 2074 6f20 7468  raced back to th
-00005700: 6520 6f72 6967 696e 616c 2069 6620 6e65  e original if ne
-00005710: 6564 6564 2e0a 0a20 2020 2020 2020 2041  eded...        A
-00005720: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00005730: 2064 6570 7468 203a 2069 6e74 206f 7220   depth : int or 
-00005740: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00005750: 2020 2020 2049 6620 6e6f 7420 4e6f 6e65       If not None
-00005760: 2c20 6465 6669 6e65 7320 6672 6f6d 2068  , defines from h
-00005770: 6f77 206d 616e 7920 7265 6665 7265 6e63  ow many referenc
-00005780: 6520 6c65 7665 6c73 2074 6f0a 2020 2020  e levels to.    
-00005790: 2020 2020 2020 2020 2020 2020 7265 7472              retr
-000057a0: 6965 7665 2050 6f72 7473 2066 726f 6d2e  ieve Ports from.
-000057b0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000057c0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-000057d0: 6f72 745f 6c69 7374 203a 206c 6973 7420  ort_list : list 
-000057e0: 6f66 2050 6f72 7420 4c69 7374 206f 6620  of Port List of 
-000057f0: 616c 6c20 506f 7274 7320 696e 2074 6865  all Ports in the
-00005800: 2043 6f6d 706f 6e65 6e74 2e0a 2020 2020   Component..    
-00005810: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00005820: 706f 7274 5f6c 6973 7420 3d20 5b70 2e5f  port_list = [p._
-00005830: 636f 7079 2829 2066 6f72 2070 2069 6e20  copy() for p in 
-00005840: 7365 6c66 2e70 6f72 7473 2e76 616c 7565  self.ports.value
-00005850: 7328 295d 0a0a 2020 2020 2020 2020 6966  s()]..        if
-00005860: 2064 6570 7468 2069 7320 4e6f 6e65 206f   depth is None o
-00005870: 7220 6465 7074 6820 3e20 303a 0a20 2020  r depth > 0:.   
-00005880: 2020 2020 2020 2020 2066 6f72 2072 2069           for r i
-00005890: 6e20 7365 6c66 2e72 6566 6572 656e 6365  n self.reference
-000058a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000058b0: 2020 206e 6577 5f64 6570 7468 203d 204e     new_depth = N
-000058c0: 6f6e 6520 6966 2064 6570 7468 2069 7320  one if depth is 
-000058d0: 4e6f 6e65 2065 6c73 6520 6465 7074 6820  None else depth 
-000058e0: 2d20 310a 2020 2020 2020 2020 2020 2020  - 1.            
-000058f0: 2020 2020 7265 665f 706f 7274 7320 3d20      ref_ports = 
-00005900: 722e 7061 7265 6e74 2e67 6574 5f70 6f72  r.parent.get_por
-00005910: 7473 2864 6570 7468 3d6e 6577 5f64 6570  ts(depth=new_dep
-00005920: 7468 290a 0a20 2020 2020 2020 2020 2020  th)..           
-00005930: 2020 2020 2023 2054 7261 6e73 666f 726d       # Transform
-00005940: 2070 6f72 7473 2074 6861 7420 6361 6d65   ports that came
-00005950: 2066 726f 6d20 6120 7265 6665 7265 6e63   from a referenc
-00005960: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00005970: 2020 7265 665f 706f 7274 735f 7472 616e    ref_ports_tran
-00005980: 7366 6f72 6d65 6420 3d20 5b5d 0a20 2020  sformed = [].   
-00005990: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000059a0: 2072 7020 696e 2072 6566 5f70 6f72 7473   rp in ref_ports
-000059b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000059c0: 2020 2020 2020 6e65 775f 706f 7274 203d        new_port =
-000059d0: 2072 702e 5f63 6f70 7928 290a 2020 2020   rp._copy().    
-000059e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059f0: 6e65 775f 6365 6e74 6572 2c20 6e65 775f  new_center, new_
-00005a00: 6f72 6965 6e74 6174 696f 6e20 3d20 722e  orientation = r.
-00005a10: 5f74 7261 6e73 666f 726d 5f70 6f72 7428  _transform_port(
-00005a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a30: 2020 2020 2020 2020 2072 702e 6365 6e74           rp.cent
-00005a40: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00005a50: 2020 2020 2020 2020 2020 2020 7270 2e6f              rp.o
-00005a60: 7269 656e 7461 7469 6f6e 2c0a 2020 2020  rientation,.    
-00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a80: 2020 2020 722e 6f72 6967 696e 2c0a 2020      r.origin,.  
-00005a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005aa0: 2020 2020 2020 722e 726f 7461 7469 6f6e        r.rotation
-00005ab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005ac0: 2020 2020 2020 2020 2020 722e 785f 7265            r.x_re
-00005ad0: 666c 6563 7469 6f6e 2c0a 2020 2020 2020  flection,.      
-00005ae0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00002bf0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+00002c00: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+00002c10: 745f 6163 7469 7665 5f70 646b 0a0a 2020  t_active_pdk..  
+00002c20: 2020 2020 2020 7064 6b20 3d20 6765 745f        pdk = get_
+00002c30: 6163 7469 7665 5f70 646b 2829 0a0a 2020  active_pdk()..  
+00002c40: 2020 2020 2020 6d61 785f 6e61 6d65 5f6c        max_name_l
+00002c50: 656e 6774 6820 3d20 7064 6b2e 6365 6c6c  ength = pdk.cell
+00002c60: 5f64 6563 6f72 6174 6f72 5f73 6574 7469  _decorator_setti
+00002c70: 6e67 732e 6d61 785f 6e61 6d65 5f6c 656e  ngs.max_name_len
+00002c80: 6774 680a 2020 2020 2020 2020 6173 7365  gth.        asse
+00002c90: 7274 2069 7369 6e73 7461 6e63 6528 0a20  rt isinstance(. 
+00002ca0: 2020 2020 2020 2020 2020 2076 2c20 436f             v, Co
+00002cb0: 6d70 6f6e 656e 740a 2020 2020 2020 2020  mponent.        
+00002cc0: 292c 2066 2254 7970 6545 7272 6f72 2c20  ), f"TypeError, 
+00002cd0: 476f 7420 7b74 7970 6528 7629 7d2c 2065  Got {type(v)}, e
+00002ce0: 7870 6563 7469 6e67 2043 6f6d 706f 6e65  xpecting Compone
+00002cf0: 6e74 220a 2020 2020 2020 2020 6173 7365  nt".        asse
+00002d00: 7274 2028 0a20 2020 2020 2020 2020 2020  rt (.           
+00002d10: 206c 656e 2876 2e6e 616d 6529 203c 3d20   len(v.name) <= 
+00002d20: 6d61 785f 6e61 6d65 5f6c 656e 6774 680a  max_name_length.
+00002d30: 2020 2020 2020 2020 292c 2066 226e 616d          ), f"nam
+00002d40: 6520 607b 762e 6e61 6d65 7d60 207b 6c65  e `{v.name}` {le
+00002d50: 6e28 762e 6e61 6d65 297d 203e 207b 6d61  n(v.name)} > {ma
+00002d60: 785f 6e61 6d65 5f6c 656e 6774 687d 2022  x_name_length} "
+00002d70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002d80: 760a 0a20 2020 2040 7072 6f70 6572 7479  v..    @property
+00002d90: 0a20 2020 2064 6566 206e 616d 6564 5f72  .    def named_r
+00002da0: 6566 6572 656e 6365 7328 7365 6c66 293a  eferences(self):
+00002db0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002dc0: 7365 6c66 2e5f 6e61 6d65 645f 7265 6665  self._named_refe
+00002dd0: 7265 6e63 6573 0a0a 2020 2020 6465 6620  rences..    def 
+00002de0: 6164 645f 6c61 6265 6c28 0a20 2020 2020  add_label(.     
+00002df0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00002e00: 2074 6578 743a 2073 7472 203d 2022 6865   text: str = "he
+00002e10: 6c6c 6f22 2c0a 2020 2020 2020 2020 706f  llo",.        po
+00002e20: 7369 7469 6f6e 3a20 7475 706c 655b 666c  sition: tuple[fl
+00002e30: 6f61 742c 2066 6c6f 6174 5d20 3d20 2830  oat, float] = (0
+00002e40: 2e30 2c20 302e 3029 2c0a 2020 2020 2020  .0, 0.0),.      
+00002e50: 2020 6d61 676e 6966 6963 6174 696f 6e3a    magnification:
+00002e60: 2066 6c6f 6174 203d 2031 2e30 2c0a 2020   float = 1.0,.  
+00002e70: 2020 2020 2020 726f 7461 7469 6f6e 3a20        rotation: 
+00002e80: 666c 6f61 7420 3d20 302c 0a20 2020 2020  float = 0,.     
+00002e90: 2020 2061 6e63 686f 723a 2073 7472 203d     anchor: str =
+00002ea0: 2022 6f22 2c0a 2020 2020 2020 2020 6c61   "o",.        la
+00002eb0: 7965 723d 2254 4558 5422 2c0a 2020 2020  yer="TEXT",.    
+00002ec0: 2020 2020 785f 7265 666c 6563 7469 6f6e      x_reflection
+00002ed0: 3d46 616c 7365 2c0a 2020 2020 2920 2d3e  =False,.    ) ->
+00002ee0: 204c 6162 656c 3a0a 2020 2020 2020 2020   Label:.        
+00002ef0: 2222 2241 6464 7320 4c61 6265 6c20 746f  """Adds Label to
+00002f00: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
+00002f10: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00002f20: 2020 2020 2020 2020 2020 2074 6578 743a             text:
+00002f30: 204c 6162 656c 2074 6578 742e 0a20 2020   Label text..   
+00002f40: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
+00002f50: 6e3a 2078 2d2c 2079 2d63 6f6f 7264 696e  n: x-, y-coordin
+00002f60: 6174 6573 206f 6620 7468 6520 4c61 6265  ates of the Labe
+00002f70: 6c20 6c6f 6361 7469 6f6e 2e0a 2020 2020  l location..    
+00002f80: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
+00002f90: 6174 696f 6e3a 204d 6167 6e69 6669 6361  ation: Magnifica
+00002fa0: 7469 6f6e 2066 6163 746f 7220 666f 7220  tion factor for 
+00002fb0: 7468 6520 4c61 6265 6c20 7465 7874 2e0a  the Label text..
+00002fc0: 2020 2020 2020 2020 2020 2020 726f 7461              rota
+00002fd0: 7469 6f6e 3a20 416e 676c 6520 726f 7461  tion: Angle rota
+00002fe0: 7469 6f6e 206f 6620 7468 6520 4c61 6265  tion of the Labe
+00002ff0: 6c20 7465 7874 2e0a 2020 2020 2020 2020  l text..        
+00003000: 2020 2020 616e 6368 6f72 3a20 7b27 6e27      anchor: {'n'
+00003010: 2c20 2765 272c 2027 7327 2c20 2777 272c  , 'e', 's', 'w',
+00003020: 2027 6f27 2c20 276e 6527 2c20 276e 7727   'o', 'ne', 'nw'
+00003030: 2c20 2e2e 2e7d 0a20 2020 2020 2020 2020  , ...}.         
+00003040: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
+00003050: 6f66 2074 6865 2061 6e63 686f 7220 7265  of the anchor re
+00003060: 6c61 7469 7665 2074 6f20 7468 6520 7465  lative to the te
+00003070: 7874 2e0a 2020 2020 2020 2020 2020 2020  xt..            
+00003080: 6c61 7965 723a 2053 7065 6369 6669 6320  layer: Specific 
+00003090: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
+000030a0: 4c61 6265 6c20 6f6e 2e0a 2020 2020 2020  Label on..      
+000030b0: 2020 2020 2020 785f 7265 666c 6563 7469        x_reflecti
+000030c0: 6f6e 3a20 5472 7565 2072 6566 6c65 6374  on: True reflect
+000030d0: 7320 6163 726f 7373 2074 6865 2068 6f72  s across the hor
+000030e0: 697a 6f6e 7461 6c20 6178 6973 2062 6566  izontal axis bef
+000030f0: 6f72 6520 726f 7461 7469 6f6e 2e0a 2020  ore rotation..  
+00003100: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003110: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+00003120: 792e 7064 6b20 696d 706f 7274 2067 6574  y.pdk import get
+00003130: 5f6c 6179 6572 0a0a 2020 2020 2020 2020  _layer..        
+00003140: 6c61 7965 7220 3d20 6765 745f 6c61 7965  layer = get_laye
+00003150: 7228 6c61 7965 7229 0a0a 2020 2020 2020  r(layer)..      
+00003160: 2020 6764 735f 6c61 7965 722c 2067 6473    gds_layer, gds
+00003170: 5f64 6174 6174 7970 6520 3d20 6c61 7965  _datatype = laye
+00003180: 720a 0a20 2020 2020 2020 2069 6620 6e6f  r..        if no
+00003190: 7420 6973 696e 7374 616e 6365 2874 6578  t isinstance(tex
+000031a0: 742c 2073 7472 293a 0a20 2020 2020 2020  t, str):.       
+000031b0: 2020 2020 2074 6578 7420 3d20 7465 7874       text = text
+000031c0: 0a20 2020 2020 2020 206c 6162 656c 203d  .        label =
+000031d0: 204c 6162 656c 280a 2020 2020 2020 2020   Label(.        
+000031e0: 2020 2020 7465 7874 3d74 6578 742c 0a20      text=text,. 
+000031f0: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00003200: 6e3d 706f 7369 7469 6f6e 2c0a 2020 2020  n=position,.    
+00003210: 2020 2020 2020 2020 616e 6368 6f72 3d61          anchor=a
+00003220: 6e63 686f 722c 0a20 2020 2020 2020 2020  nchor,.         
+00003230: 2020 206d 6167 6e69 6669 6361 7469 6f6e     magnification
+00003240: 3d6d 6167 6e69 6669 6361 7469 6f6e 2c0a  =magnification,.
+00003250: 2020 2020 2020 2020 2020 2020 726f 7461              rota
+00003260: 7469 6f6e 3d72 6f74 6174 696f 6e2c 0a20  tion=rotation,. 
+00003270: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00003280: 3d67 6473 5f6c 6179 6572 2c0a 2020 2020  =gds_layer,.    
+00003290: 2020 2020 2020 2020 7465 7874 7479 7065          texttype
+000032a0: 3d67 6473 5f64 6174 6174 7970 652c 0a20  =gds_datatype,. 
+000032b0: 2020 2020 2020 2020 2020 2078 5f72 6566             x_ref
+000032c0: 6c65 6374 696f 6e3d 785f 7265 666c 6563  lection=x_reflec
+000032d0: 7469 6f6e 2c0a 2020 2020 2020 2020 290a  tion,.        ).
+000032e0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+000032f0: 286c 6162 656c 290a 2020 2020 2020 2020  (label).        
+00003300: 7265 7475 726e 206c 6162 656c 0a0a 2020  return label..  
+00003310: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00003320: 6465 6620 6262 6f78 2873 656c 6629 3a0a  def bbox(self):.
+00003330: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00003340: 6e73 2074 6865 2062 6f75 6e64 696e 6720  ns the bounding 
+00003350: 626f 7820 6f66 2074 6865 2043 6f6d 706f  box of the Compo
+00003360: 6e65 6e74 5265 6665 7265 6e63 652e 2222  nentReference.""
+00003370: 220a 2020 2020 2020 2020 6262 6f78 203d  ".        bbox =
+00003380: 2073 656c 662e 5f63 656c 6c2e 626f 756e   self._cell.boun
+00003390: 6469 6e67 5f62 6f78 2829 0a20 2020 2020  ding_box().     
+000033a0: 2020 2069 6620 6262 6f78 2069 7320 4e6f     if bbox is No
+000033b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000033c0: 6262 6f78 203d 2028 2830 2c20 3029 2c20  bbox = ((0, 0), 
+000033d0: 2830 2c20 3029 290a 2020 2020 2020 2020  (0, 0)).        
+000033e0: 7265 7475 726e 206e 702e 6172 7261 7928  return np.array(
+000033f0: 6262 6f78 290a 0a20 2020 2040 7072 6f70  bbox)..    @prop
+00003400: 6572 7479 0a20 2020 2064 6566 2070 6f72  erty.    def por
+00003410: 7473 5f6c 6179 6572 2873 656c 6629 202d  ts_layer(self) -
+00003420: 3e20 6469 6374 5b73 7472 2c20 7374 725d  > dict[str, str]
+00003430: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00003440: 7572 6e73 2061 206d 6170 7069 6e67 2066  urns a mapping f
+00003450: 726f 6d20 6c61 7965 7230 5f6c 6179 6572  rom layer0_layer
+00003460: 315f 4530 3a20 706f 7274 4e61 6d65 2e22  1_E0: portName."
+00003470: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00003480: 6e20 6d61 705f 706f 7274 735f 6c61 7965  n map_ports_laye
+00003490: 725f 746f 5f6f 7269 656e 7461 7469 6f6e  r_to_orientation
+000034a0: 2873 656c 662e 706f 7274 7329 0a0a 2020  (self.ports)..  
+000034b0: 2020 6465 6620 706f 7274 5f62 795f 6f72    def port_by_or
+000034c0: 6965 6e74 6174 696f 6e5f 6377 2873 656c  ientation_cw(sel
+000034d0: 662c 206b 6579 3a20 7374 722c 202a 2a6b  f, key: str, **k
+000034e0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+000034f0: 2222 2252 6574 7572 6e73 2070 6f72 7420  """Returns port 
+00003500: 6279 2069 6e64 6578 696e 6720 7468 656d  by indexing them
+00003510: 2063 6c6f 636b 7769 7365 2e22 2222 0a20   clockwise.""". 
+00003520: 2020 2020 2020 206d 203d 206d 6170 5f70         m = map_p
+00003530: 6f72 7473 5f74 6f5f 6f72 6965 6e74 6174  orts_to_orientat
+00003540: 696f 6e5f 6377 2873 656c 662e 706f 7274  ion_cw(self.port
+00003550: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+00003560: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+00003570: 696e 206d 3a0a 2020 2020 2020 2020 2020  in m:.          
+00003580: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
+00003590: 2866 227b 6b65 797d 206e 6f74 2069 6e20  (f"{key} not in 
+000035a0: 7b6c 6973 7428 6d2e 6b65 7973 2829 297d  {list(m.keys())}
+000035b0: 2229 0a20 2020 2020 2020 206b 6579 3220  ").        key2 
+000035c0: 3d20 6d5b 6b65 795d 0a20 2020 2020 2020  = m[key].       
+000035d0: 2072 6574 7572 6e20 7365 6c66 2e70 6f72   return self.por
+000035e0: 7473 5b6b 6579 325d 0a0a 2020 2020 6465  ts[key2]..    de
+000035f0: 6620 706f 7274 5f62 795f 6f72 6965 6e74  f port_by_orient
+00003600: 6174 696f 6e5f 6363 7728 7365 6c66 2c20  ation_ccw(self, 
+00003610: 6b65 793a 2073 7472 2c20 2a2a 6b77 6172  key: str, **kwar
+00003620: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+00003630: 5265 7475 726e 7320 706f 7274 2062 7920  Returns port by 
+00003640: 696e 6465 7869 6e67 2074 6865 6d20 636c  indexing them cl
+00003650: 6f63 6b77 6973 652e 2222 220a 2020 2020  ockwise.""".    
+00003660: 2020 2020 6d20 3d20 6d61 705f 706f 7274      m = map_port
+00003670: 735f 746f 5f6f 7269 656e 7461 7469 6f6e  s_to_orientation
+00003680: 5f63 6377 2873 656c 662e 706f 7274 732c  _ccw(self.ports,
+00003690: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+000036a0: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
+000036b0: 206d 3a0a 2020 2020 2020 2020 2020 2020   m:.            
+000036c0: 7261 6973 6520 4b65 7945 7272 6f72 2866  raise KeyError(f
+000036d0: 227b 6b65 797d 206e 6f74 2069 6e20 7b6c  "{key} not in {l
+000036e0: 6973 7428 6d2e 6b65 7973 2829 297d 2229  ist(m.keys())}")
+000036f0: 0a20 2020 2020 2020 206b 6579 3220 3d20  .        key2 = 
+00003700: 6d5b 6b65 795d 0a20 2020 2020 2020 2072  m[key].        r
+00003710: 6574 7572 6e20 7365 6c66 2e70 6f72 7473  eturn self.ports
+00003720: 5b6b 6579 325d 0a0a 2020 2020 6465 6620  [key2]..    def 
+00003730: 6765 745f 706f 7274 735f 7873 697a 6528  get_ports_xsize(
+00003740: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
+00003750: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
+00003760: 2020 2222 2252 6574 7572 6e73 2078 6469    """Returns xdi
+00003770: 7374 616e 6365 2066 726f 6d20 6561 7374  stance from east
+00003780: 2074 6f20 7765 7374 2070 6f72 7473 2e0a   to west ports..
+00003790: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+000037a0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000037b0: 2020 206c 6179 6572 3a20 706f 7274 2047     layer: port G
+000037c0: 4453 206c 6179 6572 2e0a 2020 2020 2020  DS layer..      
+000037d0: 2020 2020 2020 7072 6566 6978 3a20 7769        prefix: wi
+000037e0: 7468 2069 6e20 706f 7274 206e 616d 652e  th in port name.
+000037f0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00003800: 656e 7461 7469 6f6e 3a20 696e 2064 6567  entation: in deg
+00003810: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
+00003820: 2020 7769 6474 683a 2070 6f72 7420 7769    width: port wi
+00003830: 6474 682e 0a20 2020 2020 2020 2020 2020  dth..           
+00003840: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+00003850: 3a20 4c69 7374 206f 6620 6c61 7965 7273  : List of layers
+00003860: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+00003870: 2020 2020 2020 2020 2070 6f72 745f 7479           port_ty
+00003880: 7065 3a20 6f70 7469 6361 6c2c 2065 6c65  pe: optical, ele
+00003890: 6374 7269 6361 6c2c 202e 2e2e 0a20 2020  ctrical, ....   
+000038a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000038b0: 2070 6f72 7473 5f63 7720 3d20 7365 6c66   ports_cw = self
+000038c0: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
+000038d0: 636c 6f63 6b77 6973 653d 5472 7565 2c20  clockwise=True, 
+000038e0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+000038f0: 2020 706f 7274 735f 6363 7720 3d20 7365    ports_ccw = se
+00003900: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
+00003910: 7428 636c 6f63 6b77 6973 653d 4661 6c73  t(clockwise=Fals
+00003920: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
+00003930: 2020 2020 2072 6574 7572 6e20 706f 7274       return port
+00003940: 735f 6363 775b 305d 2e78 202d 2070 6f72  s_ccw[0].x - por
+00003950: 7473 5f63 775b 305d 2e78 0a0a 2020 2020  ts_cw[0].x..    
+00003960: 6465 6620 6765 745f 706f 7274 735f 7973  def get_ports_ys
+00003970: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
+00003980: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
+00003990: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000039a0: 2079 6469 7374 616e 6365 2066 726f 6d20   ydistance from 
+000039b0: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
+000039c0: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+000039d0: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+000039e0: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+000039f0: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00003a00: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00003a10: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
+00003a20: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00003a30: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
+00003a40: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+00003a50: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
+00003a60: 7420 7769 6474 6820 2875 6d29 2e0a 2020  t width (um)..  
+00003a70: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00003a80: 5f65 7863 6c75 6465 643a 204c 6973 7420  _excluded: List 
+00003a90: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
+00003aa0: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
+00003ab0: 2020 706f 7274 5f74 7970 653a 206f 7074    port_type: opt
+00003ac0: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
+00003ad0: 2c20 2e2e 2e0a 2020 2020 2020 2020 2222  , ....        ""
+00003ae0: 220a 2020 2020 2020 2020 706f 7274 735f  ".        ports_
+00003af0: 6377 203d 2073 656c 662e 6765 745f 706f  cw = self.get_po
+00003b00: 7274 735f 6c69 7374 2863 6c6f 636b 7769  rts_list(clockwi
+00003b10: 7365 3d54 7275 652c 202a 2a6b 7761 7267  se=True, **kwarg
+00003b20: 7329 0a20 2020 2020 2020 2070 6f72 7473  s).        ports
+00003b30: 5f63 6377 203d 2073 656c 662e 6765 745f  _ccw = self.get_
+00003b40: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
+00003b50: 7769 7365 3d46 616c 7365 2c20 2a2a 6b77  wise=False, **kw
+00003b60: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
+00003b70: 7475 726e 2070 6f72 7473 5f63 6377 5b30  turn ports_ccw[0
+00003b80: 5d2e 7920 2d20 706f 7274 735f 6377 5b30  ].y - ports_cw[0
+00003b90: 5d2e 790a 0a20 2020 2064 6566 2070 6c6f  ].y..    def plo
+00003ba0: 745f 6e65 746c 6973 7428 0a20 2020 2020  t_netlist(.     
+00003bb0: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
+00003bc0: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00003bd0: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
+00003be0: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
+00003bf0: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
+00003c00: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
+00003c10: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
+00003c20: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
+00003c30: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00003c40: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00003c50: 6c61 6265 6c73 3a20 6164 6420 6c61 6265  labels: add labe
+00003c60: 6c20 746f 2065 6163 6820 6e6f 6465 2e0a  l to each node..
+00003c70: 2020 2020 2020 2020 2020 2020 666f 6e74              font
+00003c80: 5f77 6569 6768 743a 206e 6f72 6d61 6c2c  _weight: normal,
+00003c90: 2062 6f6c 642e 0a20 2020 2020 2020 2020   bold..         
+00003ca0: 2020 202a 2a6b 7761 7267 733a 206b 6579     **kwargs: key
+00003cb0: 776f 7264 2061 7267 756d 656e 7473 2066  word arguments f
+00003cc0: 6f72 2074 6865 2067 6574 5f6e 6574 6c69  or the get_netli
+00003cd0: 7374 2066 756e 6374 696f 6e0a 2020 2020  st function.    
+00003ce0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003cf0: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
+00003d00: 622e 7079 706c 6f74 2061 7320 706c 740a  b.pyplot as plt.
+00003d10: 2020 2020 2020 2020 696d 706f 7274 206e          import n
+00003d20: 6574 776f 726b 7820 6173 206e 780a 0a20  etworkx as nx.. 
+00003d30: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
+00003d40: 6528 290a 2020 2020 2020 2020 6e65 746c  e().        netl
+00003d50: 6973 7420 3d20 7365 6c66 2e67 6574 5f6e  ist = self.get_n
+00003d60: 6574 6c69 7374 282a 2a6b 7761 7267 7329  etlist(**kwargs)
+00003d70: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+00003d80: 696f 6e73 203d 206e 6574 6c69 7374 5b22  ions = netlist["
+00003d90: 636f 6e6e 6563 7469 6f6e 7322 5d0a 2020  connections"].  
+00003da0: 2020 2020 2020 706c 6163 656d 656e 7473        placements
+00003db0: 203d 206e 6574 6c69 7374 5b22 706c 6163   = netlist["plac
+00003dc0: 656d 656e 7473 225d 0a20 2020 2020 2020  ements"].       
+00003dd0: 2047 203d 206e 782e 4772 6170 6828 290a   G = nx.Graph().
+00003de0: 2020 2020 2020 2020 472e 6164 645f 6564          G.add_ed
+00003df0: 6765 735f 6672 6f6d 280a 2020 2020 2020  ges_from(.      
+00003e00: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
+00003e10: 2020 2020 2020 2020 2822 2c22 2e6a 6f69          (",".joi
+00003e20: 6e28 6b2e 7370 6c69 7428 222c 2229 5b3a  n(k.split(",")[:
+00003e30: 2d31 5d29 2c20 222c 222e 6a6f 696e 2876  -1]), ",".join(v
+00003e40: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
+00003e50: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00003e60: 2020 2066 6f72 206b 2c20 7620 696e 2063     for k, v in c
+00003e70: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
+00003e80: 2829 0a20 2020 2020 2020 2020 2020 205d  ().            ]
+00003e90: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00003ea0: 2020 2070 6f73 203d 207b 6b3a 2028 765b     pos = {k: (v[
+00003eb0: 2278 225d 2c20 765b 2279 225d 2920 666f  "x"], v["y"]) fo
+00003ec0: 7220 6b2c 2076 2069 6e20 706c 6163 656d  r k, v in placem
+00003ed0: 656e 7473 2e69 7465 6d73 2829 7d0a 2020  ents.items()}.  
+00003ee0: 2020 2020 2020 6c61 6265 6c73 203d 207b        labels = {
+00003ef0: 6b3a 2022 2c22 2e6a 6f69 6e28 6b2e 7370  k: ",".join(k.sp
+00003f00: 6c69 7428 222c 2229 5b3a 315d 2920 666f  lit(",")[:1]) fo
+00003f10: 7220 6b20 696e 2070 6c61 6365 6d65 6e74  r k in placement
+00003f20: 732e 6b65 7973 2829 7d0a 2020 2020 2020  s.keys()}.      
+00003f30: 2020 6e78 2e64 7261 7728 0a20 2020 2020    nx.draw(.     
+00003f40: 2020 2020 2020 2047 2c0a 2020 2020 2020         G,.      
+00003f50: 2020 2020 2020 7769 7468 5f6c 6162 656c        with_label
+00003f60: 733d 7769 7468 5f6c 6162 656c 732c 0a20  s=with_labels,. 
+00003f70: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
+00003f80: 7765 6967 6874 3d66 6f6e 745f 7765 6967  weight=font_weig
+00003f90: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
+00003fa0: 6c61 6265 6c73 3d6c 6162 656c 732c 0a20  labels=labels,. 
+00003fb0: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
+00003fc0: 6f73 2c0a 2020 2020 2020 2020 290a 2020  os,.        ).  
+00003fd0: 2020 2020 2020 7265 7475 726e 2047 0a0a        return G..
+00003fe0: 2020 2020 6465 6620 706c 6f74 5f6e 6574      def plot_net
+00003ff0: 6c69 7374 5f66 6c61 7428 0a20 2020 2020  list_flat(.     
+00004000: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
+00004010: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00004020: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
+00004030: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
+00004040: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
+00004050: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
+00004060: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
+00004070: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
+00004080: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00004090: 2020 2020 2020 2020 2020 2066 6c61 743a             flat:
+000040a0: 2069 6620 7472 7565 2c20 7769 6c6c 2070   if true, will p
+000040b0: 6c6f 7420 7468 6520 666c 6174 206e 6574  lot the flat net
+000040c0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+000040d0: 2077 6974 685f 6c61 6265 6c73 3a20 6164   with_labels: ad
+000040e0: 6420 6c61 6265 6c20 746f 2065 6163 6820  d label to each 
+000040f0: 6e6f 6465 2e0a 2020 2020 2020 2020 2020  node..          
+00004100: 2020 666f 6e74 5f77 6569 6768 743a 206e    font_weight: n
+00004110: 6f72 6d61 6c2c 2062 6f6c 642e 0a20 2020  ormal, bold..   
+00004120: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+00004130: 733a 206b 6579 776f 7264 2061 7267 756d  s: keyword argum
+00004140: 656e 7473 2066 6f72 2074 6865 2067 6574  ents for the get
+00004150: 5f6e 6574 6c69 7374 2066 756e 6374 696f  _netlist functio
+00004160: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+00004170: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
+00004180: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
+00004190: 7320 706c 740a 2020 2020 2020 2020 696d  s plt.        im
+000041a0: 706f 7274 206e 6574 776f 726b 7820 6173  port networkx as
+000041b0: 206e 780a 0a20 2020 2020 2020 2070 6c74   nx..        plt
+000041c0: 2e66 6967 7572 6528 290a 2020 2020 2020  .figure().      
+000041d0: 2020 6e65 746c 6973 7420 3d20 7365 6c66    netlist = self
+000041e0: 2e67 6574 5f6e 6574 6c69 7374 5f66 6c61  .get_netlist_fla
+000041f0: 7428 2a2a 6b77 6172 6773 290a 2020 2020  t(**kwargs).    
+00004200: 2020 2020 636f 6e6e 6563 7469 6f6e 7320      connections 
+00004210: 3d20 6e65 746c 6973 745b 2263 6f6e 6e65  = netlist["conne
+00004220: 6374 696f 6e73 225d 0a20 2020 2020 2020  ctions"].       
+00004230: 2070 6c61 6365 6d65 6e74 7320 3d20 6e65   placements = ne
+00004240: 746c 6973 745b 2270 6c61 6365 6d65 6e74  tlist["placement
+00004250: 7322 5d0a 2020 2020 2020 2020 636f 6e6e  s"].        conn
+00004260: 6563 7469 6f6e 735f 6c69 7374 203d 205b  ections_list = [
+00004270: 5d0a 2020 2020 2020 2020 666f 7220 6b2c  ].        for k,
+00004280: 2076 5f6c 6973 7420 696e 2063 6f6e 6e65   v_list in conne
+00004290: 6374 696f 6e73 2e69 7465 6d73 2829 3a0a  ctions.items():.
+000042a0: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
+000042b0: 6563 7469 6f6e 735f 6c69 7374 2e65 7874  ections_list.ext
+000042c0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+000042d0: 2020 2020 2028 222c 222e 6a6f 696e 286b       (",".join(k
+000042e0: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
+000042f0: 292c 2022 2c22 2e6a 6f69 6e28 762e 7370  ), ",".join(v.sp
+00004300: 6c69 7428 222c 2229 5b3a 2d31 5d29 290a  lit(",")[:-1])).
+00004310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004320: 666f 7220 7620 696e 2076 5f6c 6973 740a  for v in v_list.
+00004330: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004340: 2020 2020 2020 4720 3d20 6e78 2e47 7261        G = nx.Gra
+00004350: 7068 2829 0a20 2020 2020 2020 2047 2e61  ph().        G.a
+00004360: 6464 5f65 6467 6573 5f66 726f 6d28 636f  dd_edges_from(co
+00004370: 6e6e 6563 7469 6f6e 735f 6c69 7374 290a  nnections_list).
+00004380: 2020 2020 2020 2020 706f 7320 3d20 7b6b          pos = {k
+00004390: 3a20 2876 5b22 7822 5d2c 2076 5b22 7922  : (v["x"], v["y"
+000043a0: 5d29 2066 6f72 206b 2c20 7620 696e 2070  ]) for k, v in p
+000043b0: 6c61 6365 6d65 6e74 732e 6974 656d 7328  lacements.items(
+000043c0: 297d 0a20 2020 2020 2020 206c 6162 656c  )}.        label
+000043d0: 7320 3d20 7b6b 3a20 222c 222e 6a6f 696e  s = {k: ",".join
+000043e0: 286b 2e73 706c 6974 2822 2c22 295b 3a31  (k.split(",")[:1
+000043f0: 5d29 2066 6f72 206b 2069 6e20 706c 6163  ]) for k in plac
+00004400: 656d 656e 7473 2e6b 6579 7328 297d 0a20  ements.keys()}. 
+00004410: 2020 2020 2020 206e 782e 6472 6177 280a         nx.draw(.
+00004420: 2020 2020 2020 2020 2020 2020 472c 0a20              G,. 
+00004430: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00004440: 6c61 6265 6c73 3d77 6974 685f 6c61 6265  labels=with_labe
+00004450: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00004460: 666f 6e74 5f77 6569 6768 743d 666f 6e74  font_weight=font
+00004470: 5f77 6569 6768 742c 0a20 2020 2020 2020  _weight,.       
+00004480: 2020 2020 206c 6162 656c 733d 6c61 6265       labels=labe
+00004490: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+000044a0: 706f 733d 706f 732c 0a20 2020 2020 2020  pos=pos,.       
+000044b0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+000044c0: 6e20 470a 0a20 2020 2064 6566 2067 6574  n G..    def get
+000044d0: 5f6e 6574 6c69 7374 5f79 616d 6c28 7365  _netlist_yaml(se
+000044e0: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
+000044f0: 2064 6963 745b 7374 722c 2041 6e79 5d3a   dict[str, Any]:
+00004500: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+00004510: 7366 6163 746f 7279 2e67 6574 5f6e 6574  sfactory.get_net
+00004520: 6c69 7374 2069 6d70 6f72 7420 6765 745f  list import get_
+00004530: 6e65 746c 6973 745f 7961 6d6c 0a0a 2020  netlist_yaml..  
+00004540: 2020 2020 2020 7265 7475 726e 2067 6574        return get
+00004550: 5f6e 6574 6c69 7374 5f79 616d 6c28 7365  _netlist_yaml(se
+00004560: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
+00004570: 2020 2064 6566 2077 7269 7465 5f6e 6574     def write_net
+00004580: 6c69 7374 2873 656c 662c 2066 696c 6570  list(self, filep
+00004590: 6174 683a 2073 7472 2920 2d3e 204e 6f6e  ath: str) -> Non
+000045a0: 653a 0a20 2020 2020 2020 2022 2222 5772  e:.        """Wr
+000045b0: 6974 6520 6e65 746c 6973 7420 696e 2059  ite netlist in Y
+000045c0: 414d 4c2e 2222 220a 2020 2020 2020 2020  AML.""".        
+000045d0: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
+000045e0: 6574 5f6e 6574 6c69 7374 2829 0a20 2020  et_netlist().   
+000045f0: 2020 2020 206e 6574 6c69 7374 203d 2063       netlist = c
+00004600: 6c65 616e 5f64 6963 7428 6e65 746c 6973  lean_dict(netlis
+00004610: 7429 0a20 2020 2020 2020 2066 696c 6570  t).        filep
+00004620: 6174 6820 3d20 7061 7468 6c69 622e 5061  ath = pathlib.Pa
+00004630: 7468 2866 696c 6570 6174 6829 0a20 2020  th(filepath).   
+00004640: 2020 2020 2066 696c 6570 6174 682e 7772       filepath.wr
+00004650: 6974 655f 7465 7874 2879 616d 6c2e 6475  ite_text(yaml.du
+00004660: 6d70 286e 6574 6c69 7374 2929 0a0a 2020  mp(netlist))..  
+00004670: 2020 6465 6620 7772 6974 655f 6e65 746c    def write_netl
+00004680: 6973 745f 646f 7428 7365 6c66 2c20 6669  ist_dot(self, fi
+00004690: 6c65 7061 7468 3a20 7374 7220 7c20 4e6f  lepath: str | No
+000046a0: 6e65 203d 204e 6f6e 6529 202d 3e20 4e6f  ne = None) -> No
+000046b0: 6e65 3a0a 2020 2020 2020 2020 2222 2257  ne:.        """W
+000046c0: 7269 7465 206e 6574 6c69 7374 2067 7261  rite netlist gra
+000046d0: 7068 2069 6e20 444f 5420 666f 726d 6174  ph in DOT format
+000046e0: 2e22 2222 0a20 2020 2020 2020 2066 726f  .""".        fro
+000046f0: 6d20 6e65 7477 6f72 6b78 2e64 7261 7769  m networkx.drawi
+00004700: 6e67 2e6e 785f 6167 7261 7068 2069 6d70  ng.nx_agraph imp
+00004710: 6f72 7420 7772 6974 655f 646f 740a 0a20  ort write_dot.. 
+00004720: 2020 2020 2020 2066 696c 6570 6174 6820         filepath 
+00004730: 3d20 6669 6c65 7061 7468 206f 7220 6622  = filepath or f"
+00004740: 7b73 656c 662e 6e61 6d65 7d2e 646f 7422  {self.name}.dot"
+00004750: 0a0a 2020 2020 2020 2020 4720 3d20 7365  ..        G = se
+00004760: 6c66 2e70 6c6f 745f 6e65 746c 6973 7428  lf.plot_netlist(
+00004770: 290a 2020 2020 2020 2020 7772 6974 655f  ).        write_
+00004780: 646f 7428 472c 2066 696c 6570 6174 6829  dot(G, filepath)
+00004790: 0a0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
+000047a0: 746c 6973 7428 7365 6c66 2c20 2a2a 6b77  tlist(self, **kw
+000047b0: 6172 6773 2920 2d3e 2064 6963 745b 7374  args) -> dict[st
+000047c0: 722c 2041 6e79 5d3a 0a20 2020 2020 2020  r, Any]:.       
+000047d0: 2022 2222 4672 6f6d 2043 6f6d 706f 6e65   """From Compone
+000047e0: 6e74 2072 6574 7572 6e73 2069 6e73 7461  nt returns insta
+000047f0: 6e63 6573 2c20 636f 6e6e 6563 7469 6f6e  nces, connection
+00004800: 7320 616e 6420 706c 6163 656d 656e 7473  s and placements
+00004810: 2064 6963 742e 0a0a 2020 2020 2020 2020   dict...        
+00004820: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
+00004830: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+00004840: 656e 743a 2074 6f20 6578 7472 6163 7420  ent: to extract 
+00004850: 6e65 746c 6973 742e 0a20 2020 2020 2020  netlist..       
+00004860: 2020 2020 2066 756c 6c5f 7365 7474 696e       full_settin
+00004870: 6773 3a20 5472 7565 2072 6574 7572 6e73  gs: True returns
+00004880: 2061 6c6c 2c20 6661 6c73 6520 6368 616e   all, false chan
+00004890: 6765 6420 7365 7474 696e 6773 2e0a 2020  ged settings..  
+000048a0: 2020 2020 2020 2020 2020 746f 6c65 7261            tolera
+000048b0: 6e63 653a 2074 6f6c 6572 616e 6365 2069  nce: tolerance i
+000048c0: 6e20 6e6d 2074 6f20 636f 6e73 6964 6572  n nm to consider
+000048d0: 2074 776f 2070 6f72 7473 2063 6f6e 6e65   two ports conne
+000048e0: 6374 6564 2e0a 2020 2020 2020 2020 2020  cted..          
+000048f0: 2020 6578 636c 7564 655f 706f 7274 5f74    exclude_port_t
+00004900: 7970 6573 3a20 6f70 7469 6f6e 616c 206c  ypes: optional l
+00004910: 6973 7420 6f66 2070 6f72 7420 7479 7065  ist of port type
+00004920: 7320 746f 2065 7863 6c75 6465 2066 726f  s to exclude fro
+00004930: 6d20 6e65 746c 6973 7469 6e67 2e0a 2020  m netlisting..  
+00004940: 2020 2020 2020 2020 2020 6765 745f 696e            get_in
+00004950: 7374 616e 6365 5f6e 616d 653a 2066 756e  stance_name: fun
+00004960: 6374 696f 6e20 746f 2067 6574 2069 6e73  ction to get ins
+00004970: 7461 6e63 6520 6e61 6d65 2e0a 2020 2020  tance name..    
+00004980: 2020 2020 2020 2020 616c 6c6f 775f 6d75          allow_mu
+00004990: 6c74 6970 6c65 3a20 4661 6c73 6520 746f  ltiple: False to
+000049a0: 2072 6169 7365 2061 6e20 6572 726f 7220   raise an error 
+000049b0: 6966 206d 6f72 6520 7468 616e 2074 776f  if more than two
+000049c0: 2070 6f72 7473 2073 6861 7265 2074 6865   ports share the
+000049d0: 2073 616d 6520 636f 6e6e 6563 7469 6f6e   same connection
+000049e0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000049f0: 2020 6966 2054 7275 652c 2077 696c 6c20    if True, will 
+00004a00: 7265 7475 726e 206b 6579 3a20 5b76 616c  return key: [val
+00004a10: 7565 5d20 7061 6972 7320 7769 7468 205b  ue] pairs with [
+00004a20: 7661 6c75 655d 2061 206c 6973 7420 6f66  value] a list of
+00004a30: 2061 6c6c 2063 6f6e 6e65 6374 6564 2069   all connected i
+00004a40: 6e73 7461 6e63 6573 2e0a 0a20 2020 2020  nstances...     
+00004a50: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+00004a60: 2020 2020 2020 2020 4e65 746c 6973 7420          Netlist 
+00004a70: 6469 6374 2028 696e 7374 616e 6365 732c  dict (instances,
+00004a80: 2063 6f6e 6e65 6374 696f 6e73 2c20 706c   connections, pl
+00004a90: 6163 656d 656e 7473 2c20 706f 7274 7329  acements, ports)
+00004aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ab0: 2069 6e73 7461 6e63 6573 3a20 4469 6374   instances: Dict
+00004ac0: 206f 6620 696e 7374 616e 6365 206e 616d   of instance nam
+00004ad0: 6520 616e 6420 7365 7474 696e 6773 2e0a  e and settings..
+00004ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004af0: 636f 6e6e 6563 7469 6f6e 733a 2044 6963  connections: Dic
+00004b00: 7420 6f66 2049 6e73 7461 6e63 6531 4e61  t of Instance1Na
+00004b10: 6d65 2c70 6f72 744e 616d 653a 2049 6e73  me,portName: Ins
+00004b20: 7461 6e63 6532 4e61 6d65 2c70 6f72 744e  tance2Name,portN
+00004b30: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00004b40: 2020 2020 2070 6c61 6365 6d65 6e74 733a       placements:
+00004b50: 2044 6963 7420 6f66 2069 6e73 7461 6e63   Dict of instanc
+00004b60: 6520 6e61 6d65 7320 616e 6420 706c 6163  e names and plac
+00004b70: 656d 656e 7473 2028 782c 2079 2c20 726f  ements (x, y, ro
+00004b80: 7461 7469 6f6e 292e 0a20 2020 2020 2020  tation)..       
+00004b90: 2020 2020 2020 2020 2070 6f72 7473 3a20           ports: 
+00004ba0: 4469 6374 2070 6f72 744e 616d 653a 2043  Dict portName: C
+00004bb0: 6f6d 706f 6e65 6e74 4e61 6d65 2c70 6f72  omponentName,por
+00004bc0: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
+00004bd0: 2020 206e 616d 653a 206e 616d 6520 6f66     name: name of
+00004be0: 2063 6f6d 706f 6e65 6e74 2e0a 2020 2020   component..    
+00004bf0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00004c00: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00004c10: 6765 745f 6e65 746c 6973 7420 696d 706f  get_netlist impo
+00004c20: 7274 2067 6574 5f6e 6574 6c69 7374 0a0a  rt get_netlist..
+00004c30: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00004c40: 6574 5f6e 6574 6c69 7374 2863 6f6d 706f  et_netlist(compo
+00004c50: 6e65 6e74 3d73 656c 662c 202a 2a6b 7761  nent=self, **kwa
+00004c60: 7267 7329 0a0a 2020 2020 6465 6620 6765  rgs)..    def ge
+00004c70: 745f 6e65 746c 6973 745f 7265 6375 7273  t_netlist_recurs
+00004c80: 6976 6528 7365 6c66 2c20 2a2a 6b77 6172  ive(self, **kwar
+00004c90: 6773 2920 2d3e 2064 6963 745b 7374 722c  gs) -> dict[str,
+00004ca0: 2044 6963 7443 6f6e 6669 675d 3a0a 2020   DictConfig]:.  
+00004cb0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00004cc0: 2072 6563 7572 7369 7665 206e 6574 6c69   recursive netli
+00004cd0: 7374 2066 6f72 2061 2063 6f6d 706f 6e65  st for a compone
+00004ce0: 6e74 2061 6e64 2073 7562 636f 6d70 6f6e  nt and subcompon
+00004cf0: 656e 7473 2e0a 0a20 2020 2020 2020 204b  ents...        K
+00004d00: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
+00004d10: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
+00004d20: 6e74 3a20 746f 2065 7874 7261 6374 206e  nt: to extract n
+00004d30: 6574 6c69 7374 2e0a 2020 2020 2020 2020  etlist..        
+00004d40: 2020 2020 636f 6d70 6f6e 656e 745f 7375      component_su
+00004d50: 6666 6978 3a20 7375 6666 6978 2074 6f20  ffix: suffix to 
+00004d60: 6170 7065 6e64 2074 6f20 6561 6368 2063  append to each c
+00004d70: 6f6d 706f 6e65 6e74 206e 616d 652e 0a20  omponent name.. 
+00004d80: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00004d90: 7365 6675 6c20 6966 2074 6f20 7361 7665  seful if to save
+00004da0: 2061 6e64 2072 656c 6f61 6420 6120 6261   and reload a ba
+00004db0: 636b 2d61 6e6e 6f74 6174 6564 206e 6574  ck-annotated net
+00004dc0: 6c69 7374 2e0a 2020 2020 2020 2020 2020  list..          
+00004dd0: 2020 6765 745f 6e65 746c 6973 745f 6675    get_netlist_fu
+00004de0: 6e63 3a20 6675 6e63 7469 6f6e 2074 6f20  nc: function to 
+00004df0: 6578 7472 6163 7420 696e 6469 7669 6475  extract individu
+00004e00: 616c 206e 6574 6c69 7374 732e 0a20 2020  al netlists..   
+00004e10: 2020 2020 2020 2020 2066 756c 6c5f 7365           full_se
+00004e20: 7474 696e 6773 3a20 5472 7565 2072 6574  ttings: True ret
+00004e30: 7572 6e73 2061 6c6c 2c20 6661 6c73 6520  urns all, false 
+00004e40: 6368 616e 6765 6420 7365 7474 696e 6773  changed settings
+00004e50: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00004e60: 6c65 7261 6e63 653a 2074 6f6c 6572 616e  lerance: toleran
+00004e70: 6365 2069 6e20 6e6d 2074 6f20 636f 6e73  ce in nm to cons
+00004e80: 6964 6572 2074 776f 2070 6f72 7473 2063  ider two ports c
+00004e90: 6f6e 6e65 6374 6564 2e0a 2020 2020 2020  onnected..      
+00004ea0: 2020 2020 2020 6578 636c 7564 655f 706f        exclude_po
+00004eb0: 7274 5f74 7970 6573 3a20 6f70 7469 6f6e  rt_types: option
+00004ec0: 616c 206c 6973 7420 6f66 2070 6f72 7420  al list of port 
+00004ed0: 7479 7065 7320 746f 2065 7863 6c75 6465  types to exclude
+00004ee0: 2066 726f 6d20 6e65 746c 6973 7469 6e67   from netlisting
+00004ef0: 2e0a 2020 2020 2020 2020 2020 2020 6765  ..            ge
+00004f00: 745f 696e 7374 616e 6365 5f6e 616d 653a  t_instance_name:
+00004f10: 2066 756e 6374 696f 6e20 746f 2067 6574   function to get
+00004f20: 2069 6e73 7461 6e63 6520 6e61 6d65 2e0a   instance name..
+00004f30: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+00004f40: 775f 6d75 6c74 6970 6c65 3a20 4661 6c73  w_multiple: Fals
+00004f50: 6520 746f 2072 6169 7365 2061 6e20 6572  e to raise an er
+00004f60: 726f 7220 6966 206d 6f72 6520 7468 616e  ror if more than
+00004f70: 2074 776f 2070 6f72 7473 2073 6861 7265   two ports share
+00004f80: 2074 6865 2073 616d 6520 636f 6e6e 6563   the same connec
+00004f90: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+00004fa0: 2020 2020 2020 6966 2054 7275 652c 2077        if True, w
+00004fb0: 696c 6c20 7265 7475 726e 206b 6579 3a20  ill return key: 
+00004fc0: 5b76 616c 7565 5d20 7061 6972 7320 7769  [value] pairs wi
+00004fd0: 7468 205b 7661 6c75 655d 2061 206c 6973  th [value] a lis
+00004fe0: 7420 6f66 2061 6c6c 2063 6f6e 6e65 6374  t of all connect
+00004ff0: 6564 2069 6e73 7461 6e63 6573 2e0a 0a20  ed instances... 
+00005000: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
+00005010: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+00005020: 696f 6e61 7279 206f 6620 6e65 746c 6973  ionary of netlis
+00005030: 7473 2c20 6b65 7965 6420 6279 2074 6865  ts, keyed by the
+00005040: 206e 616d 6520 6f66 2065 6163 6820 636f   name of each co
+00005050: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
+00005060: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00005070: 6d20 6764 7366 6163 746f 7279 2e67 6574  m gdsfactory.get
+00005080: 5f6e 6574 6c69 7374 2069 6d70 6f72 7420  _netlist import 
+00005090: 6765 745f 6e65 746c 6973 745f 7265 6375  get_netlist_recu
+000050a0: 7273 6976 650a 0a20 2020 2020 2020 2072  rsive..        r
+000050b0: 6574 7572 6e20 6765 745f 6e65 746c 6973  eturn get_netlis
+000050c0: 745f 7265 6375 7273 6976 6528 636f 6d70  t_recursive(comp
+000050d0: 6f6e 656e 743d 7365 6c66 2c20 2a2a 6b77  onent=self, **kw
+000050e0: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
+000050f0: 6574 5f6e 6574 6c69 7374 5f66 6c61 7428  et_netlist_flat(
+00005100: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
+00005110: 2d3e 2064 6963 745b 7374 722c 2044 6963  -> dict[str, Dic
+00005120: 7443 6f6e 6669 675d 3a0a 2020 2020 2020  tConfig]:.      
+00005130: 2020 2222 2252 6574 7572 6e73 2061 206e    """Returns a n
+00005140: 6574 6c69 7374 2077 6865 7265 2061 6c6c  etlist where all
+00005150: 2073 7562 696e 7374 616e 6365 7320 6172   subinstances ar
+00005160: 6520 6578 706f 7365 6420 616e 6420 696e  e exposed and in
+00005170: 6465 7065 6e64 656e 746c 7920 6e61 6d65  dependently name
+00005180: 642e 0a0a 2020 2020 2020 2020 4b65 7977  d...        Keyw
+00005190: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
+000051a0: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
+000051b0: 2074 6f20 6578 7472 6163 7420 6e65 746c   to extract netl
+000051c0: 6973 742e 0a20 2020 2020 2020 2020 2020  ist..           
+000051d0: 2063 6f6d 706f 6e65 6e74 5f73 7566 6669   component_suffi
+000051e0: 783a 2073 7566 6669 7820 746f 2061 7070  x: suffix to app
+000051f0: 656e 6420 746f 2065 6163 6820 636f 6d70  end to each comp
+00005200: 6f6e 656e 7420 6e61 6d65 2e0a 2020 2020  onent name..    
+00005210: 2020 2020 2020 2020 2020 2020 7573 6566              usef
+00005220: 756c 2069 6620 746f 2073 6176 6520 616e  ul if to save an
+00005230: 6420 7265 6c6f 6164 2061 2062 6163 6b2d  d reload a back-
+00005240: 616e 6e6f 7461 7465 6420 6e65 746c 6973  annotated netlis
+00005250: 742e 0a20 2020 2020 2020 2020 2020 2067  t..            g
+00005260: 6574 5f6e 6574 6c69 7374 5f66 756e 633a  et_netlist_func:
+00005270: 2066 756e 6374 696f 6e20 746f 2065 7874   function to ext
+00005280: 7261 6374 2069 6e64 6976 6964 7561 6c20  ract individual 
+00005290: 6e65 746c 6973 7473 2e0a 2020 2020 2020  netlists..      
+000052a0: 2020 2020 2020 6675 6c6c 5f73 6574 7469        full_setti
+000052b0: 6e67 733a 2054 7275 6520 7265 7475 726e  ngs: True return
+000052c0: 7320 616c 6c2c 2066 616c 7365 2063 6861  s all, false cha
+000052d0: 6e67 6564 2073 6574 7469 6e67 732e 0a20  nged settings.. 
+000052e0: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
+000052f0: 616e 6365 3a20 746f 6c65 7261 6e63 6520  ance: tolerance 
+00005300: 696e 206e 6d20 746f 2063 6f6e 7369 6465  in nm to conside
+00005310: 7220 7477 6f20 706f 7274 7320 636f 6e6e  r two ports conn
+00005320: 6563 7465 642e 0a20 2020 2020 2020 2020  ected..         
+00005330: 2020 2065 7863 6c75 6465 5f70 6f72 745f     exclude_port_
+00005340: 7479 7065 733a 206f 7074 696f 6e61 6c20  types: optional 
+00005350: 6c69 7374 206f 6620 706f 7274 2074 7970  list of port typ
+00005360: 6573 2074 6f20 6578 636c 7564 6520 6672  es to exclude fr
+00005370: 6f6d 206e 6574 6c69 7374 696e 672e 0a20  om netlisting.. 
+00005380: 2020 2020 2020 2020 2020 2067 6574 5f69             get_i
+00005390: 6e73 7461 6e63 655f 6e61 6d65 3a20 6675  nstance_name: fu
+000053a0: 6e63 7469 6f6e 2074 6f20 6765 7420 696e  nction to get in
+000053b0: 7374 616e 6365 206e 616d 652e 0a20 2020  stance name..   
+000053c0: 2020 2020 2020 2020 2061 6c6c 6f77 5f6d           allow_m
+000053d0: 756c 7469 706c 653a 2046 616c 7365 2074  ultiple: False t
+000053e0: 6f20 7261 6973 6520 616e 2065 7272 6f72  o raise an error
+000053f0: 2069 6620 6d6f 7265 2074 6861 6e20 7477   if more than tw
+00005400: 6f20 706f 7274 7320 7368 6172 6520 7468  o ports share th
+00005410: 6520 7361 6d65 2063 6f6e 6e65 6374 696f  e same connectio
+00005420: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
+00005430: 2020 2069 6620 5472 7565 2c20 7769 6c6c     if True, will
+00005440: 2072 6574 7572 6e20 6b65 793a 205b 7661   return key: [va
+00005450: 6c75 655d 2070 6169 7273 2077 6974 6820  lue] pairs with 
+00005460: 5b76 616c 7565 5d20 6120 6c69 7374 206f  [value] a list o
+00005470: 6620 616c 6c20 636f 6e6e 6563 7465 6420  f all connected 
+00005480: 696e 7374 616e 6365 732e 0a0a 2020 2020  instances...    
+00005490: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+000054a0: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
+000054b0: 6172 7920 6f66 206e 6574 6c69 7374 732c  ary of netlists,
+000054c0: 206b 6579 6564 2062 7920 7468 6520 6e61   keyed by the na
+000054d0: 6d65 206f 6620 6561 6368 2063 6f6d 706f  me of each compo
+000054e0: 6e65 6e74 2e0a 2020 2020 2020 2020 2222  nent..        ""
+000054f0: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00005500: 6473 6661 6374 6f72 792e 6765 745f 6e65  dsfactory.get_ne
+00005510: 746c 6973 745f 666c 6174 2069 6d70 6f72  tlist_flat impor
+00005520: 7420 6765 745f 6e65 746c 6973 745f 666c  t get_netlist_fl
+00005530: 6174 0a0a 2020 2020 2020 2020 7265 7475  at..        retu
+00005540: 726e 2067 6574 5f6e 6574 6c69 7374 5f66  rn get_netlist_f
+00005550: 6c61 7428 636f 6d70 6f6e 656e 743d 7365  lat(component=se
+00005560: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
+00005570: 2020 2064 6566 2061 7373 6572 745f 706f     def assert_po
+00005580: 7274 735f 6f6e 5f67 7269 6428 7365 6c66  rts_on_grid(self
+00005590: 2c20 6e6d 3a20 696e 7420 3d20 3129 202d  , nm: int = 1) -
+000055a0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000055b0: 2222 2241 7373 6572 7473 2074 6861 7420  """Asserts that 
+000055c0: 616c 6c20 706f 7274 7320 6172 6520 6f6e  all ports are on
+000055d0: 2067 7269 642e 2222 220a 2020 2020 2020   grid.""".      
+000055e0: 2020 666f 7220 706f 7274 2069 6e20 7365    for port in se
+000055f0: 6c66 2e70 6f72 7473 2e76 616c 7565 7328  lf.ports.values(
+00005600: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+00005610: 6f72 742e 6173 7365 7274 5f6f 6e5f 6772  ort.assert_on_gr
+00005620: 6964 286e 6d3d 6e6d 290a 0a20 2020 2064  id(nm=nm)..    d
+00005630: 6566 2067 6574 5f70 6f72 7473 2873 656c  ef get_ports(sel
+00005640: 662c 2064 6570 7468 3d4e 6f6e 6529 3a0a  f, depth=None):.
+00005650: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00005660: 6e73 2063 6f70 6965 7320 6f66 2061 6c6c  ns copies of all
+00005670: 2074 6865 2070 6f72 7473 206f 6620 7468   the ports of th
+00005680: 6520 436f 6d70 6f6e 656e 742c 2072 6f74  e Component, rot
+00005690: 6174 6564 2061 6e64 205c 0a20 2020 2020  ated and \.     
+000056a0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+000056b0: 6c61 7465 6420 736f 2074 6861 7420 7468  lated so that th
+000056c0: 6579 2772 6520 696e 2074 6865 6972 2074  ey're in their t
+000056d0: 6f70 2d6c 6576 656c 2070 6f73 6974 696f  op-level positio
+000056e0: 6e2e 0a0a 2020 2020 2020 2020 5468 6520  n...        The 
+000056f0: 506f 7274 7320 7265 7475 726e 6564 2061  Ports returned a
+00005700: 7265 2063 6f70 6965 7320 6f66 2074 6865  re copies of the
+00005710: 206f 7269 6769 6e61 6c73 2c20 6275 7420   originals, but 
+00005720: 6561 6368 2063 6f70 7920 6861 7320 7468  each copy has th
+00005730: 6520 7361 6d65 0a20 2020 2020 2020 2060  e same.        `
+00005740: 6075 6964 6060 2061 7320 7468 6520 6f72  `uid`` as the or
+00005750: 6967 696e 616c 2073 6f20 7468 6174 2074  iginal so that t
+00005760: 6865 7920 6361 6e20 6265 2074 7261 6365  hey can be trace
+00005770: 6420 6261 636b 2074 6f20 7468 6520 6f72  d back to the or
+00005780: 6967 696e 616c 2069 6620 6e65 6564 6564  iginal if needed
+00005790: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+000057a0: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+000057b0: 7468 203a 2069 6e74 206f 7220 4e6f 6e65  th : int or None
+000057c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000057d0: 2049 6620 6e6f 7420 4e6f 6e65 2c20 6465   If not None, de
+000057e0: 6669 6e65 7320 6672 6f6d 2068 6f77 206d  fines from how m
+000057f0: 616e 7920 7265 6665 7265 6e63 6520 6c65  any reference le
+00005800: 7665 6c73 2074 6f0a 2020 2020 2020 2020  vels to.        
+00005810: 2020 2020 2020 2020 7265 7472 6965 7665          retrieve
+00005820: 2050 6f72 7473 2066 726f 6d2e 0a0a 2020   Ports from...  
+00005830: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
+00005840: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00005850: 6c69 7374 203a 206c 6973 7420 6f66 2050  list : list of P
+00005860: 6f72 7420 4c69 7374 206f 6620 616c 6c20  ort List of all 
+00005870: 506f 7274 7320 696e 2074 6865 2043 6f6d  Ports in the Com
+00005880: 706f 6e65 6e74 2e0a 2020 2020 2020 2020  ponent..        
+00005890: 2222 220a 2020 2020 2020 2020 706f 7274  """.        port
+000058a0: 5f6c 6973 7420 3d20 5b70 2e5f 636f 7079  _list = [p._copy
+000058b0: 2829 2066 6f72 2070 2069 6e20 7365 6c66  () for p in self
+000058c0: 2e70 6f72 7473 2e76 616c 7565 7328 295d  .ports.values()]
+000058d0: 0a0a 2020 2020 2020 2020 6966 2064 6570  ..        if dep
+000058e0: 7468 2069 7320 4e6f 6e65 206f 7220 6465  th is None or de
+000058f0: 7074 6820 3e20 303a 0a20 2020 2020 2020  pth > 0:.       
+00005900: 2020 2020 2066 6f72 2072 2069 6e20 7365       for r in se
+00005910: 6c66 2e72 6566 6572 656e 6365 733a 0a20  lf.references:. 
+00005920: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00005930: 6577 5f64 6570 7468 203d 204e 6f6e 6520  ew_depth = None 
+00005940: 6966 2064 6570 7468 2069 7320 4e6f 6e65  if depth is None
+00005950: 2065 6c73 6520 6465 7074 6820 2d20 310a   else depth - 1.
+00005960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005970: 7265 665f 706f 7274 7320 3d20 722e 7061  ref_ports = r.pa
+00005980: 7265 6e74 2e67 6574 5f70 6f72 7473 2864  rent.get_ports(d
+00005990: 6570 7468 3d6e 6577 5f64 6570 7468 290a  epth=new_depth).
+000059a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000059b0: 2023 2054 7261 6e73 666f 726d 2070 6f72   # Transform por
+000059c0: 7473 2074 6861 7420 6361 6d65 2066 726f  ts that came fro
+000059d0: 6d20 6120 7265 6665 7265 6e63 650a 2020  m a reference.  
+000059e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000059f0: 665f 706f 7274 735f 7472 616e 7366 6f72  f_ports_transfor
+00005a00: 6d65 6420 3d20 5b5d 0a20 2020 2020 2020  med = [].       
+00005a10: 2020 2020 2020 2020 2066 6f72 2072 7020           for rp 
+00005a20: 696e 2072 6566 5f70 6f72 7473 3a0a 2020  in ref_ports:.  
+00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a40: 2020 6e65 775f 706f 7274 203d 2072 702e    new_port = rp.
+00005a50: 5f63 6f70 7928 290a 2020 2020 2020 2020  _copy().        
+00005a60: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00005a70: 6365 6e74 6572 2c20 6e65 775f 6f72 6965  center, new_orie
+00005a80: 6e74 6174 696f 6e20 3d20 722e 5f74 7261  ntation = r._tra
+00005a90: 6e73 666f 726d 5f70 6f72 7428 0a20 2020  nsform_port(.   
+00005aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ab0: 2020 2020 2072 702e 6365 6e74 6572 2c0a       rp.center,.
+00005ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ad0: 2020 2020 2020 2020 7270 2e6f 7269 656e          rp.orien
+00005ae0: 7461 7469 6f6e 2c0a 2020 2020 2020 2020  tation,.        
 00005af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b00: 2020 2020 6e65 775f 706f 7274 2e63 656e      new_port.cen
-00005b10: 7465 7220 3d20 6e65 775f 6365 6e74 6572  ter = new_center
-00005b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005b30: 2020 2020 206e 6577 5f70 6f72 742e 6e65       new_port.ne
-00005b40: 775f 6f72 6965 6e74 6174 696f 6e20 3d20  w_orientation = 
-00005b50: 6e65 775f 6f72 6965 6e74 6174 696f 6e0a  new_orientation.
-00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b70: 2020 2020 7265 665f 706f 7274 735f 7472      ref_ports_tr
-00005b80: 616e 7366 6f72 6d65 642e 6170 7065 6e64  ansformed.append
-00005b90: 286e 6577 5f70 6f72 7429 0a20 2020 2020  (new_port).     
-00005ba0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-00005bb0: 6c69 7374 202b 3d20 7265 665f 706f 7274  list += ref_port
-00005bc0: 735f 7472 616e 7366 6f72 6d65 640a 0a20  s_transformed.. 
-00005bd0: 2020 2020 2020 2072 6574 7572 6e20 706f         return po
-00005be0: 7274 5f6c 6973 740a 0a20 2020 2064 6566  rt_list..    def
-00005bf0: 2067 6574 5f70 6f72 7473 5f64 6963 7428   get_ports_dict(
-00005c00: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
-00005c10: 2d3e 2064 6963 745b 7374 722c 2050 6f72  -> dict[str, Por
-00005c20: 745d 3a0a 2020 2020 2020 2020 2222 2252  t]:.        """R
-00005c30: 6574 7572 6e73 2061 2064 6963 7420 6f66  eturns a dict of
-00005c40: 2070 6f72 7473 2e0a 0a20 2020 2020 2020   ports...       
-00005c50: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-00005c60: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00005c70: 3a20 706f 7274 2047 4453 206c 6179 6572  : port GDS layer
-00005c80: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00005c90: 6566 6978 3a20 7365 6c65 6374 2070 6f72  efix: select por
-00005ca0: 7473 2077 6974 6820 7072 6566 6978 2069  ts with prefix i
-00005cb0: 6e20 706f 7274 206e 616d 652e 0a20 2020  n port name..   
-00005cc0: 2020 2020 2020 2020 2073 7566 6669 783a           suffix:
-00005cd0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00005ce0: 7468 2070 6f72 7420 6e61 6d65 2073 7566  th port name suf
-00005cf0: 6669 782e 0a20 2020 2020 2020 2020 2020  fix..           
-00005d00: 206f 7269 656e 7461 7469 6f6e 3a20 7365   orientation: se
-00005d10: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
-00005d20: 6f72 6965 6e74 6174 696f 6e20 696e 2064  orientation in d
-00005d30: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
-00005d40: 2020 2020 7769 6474 683a 2073 656c 6563      width: selec
-00005d50: 7420 706f 7274 7320 7769 7468 2070 6f72  t ports with por
-00005d60: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
-00005d70: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
-00005d80: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
-00005d90: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
-00005da0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-00005db0: 745f 7479 7065 3a20 7365 6c65 6374 2070  t_type: select p
-00005dc0: 6f72 7473 2077 6974 6820 706f 7274 5f74  orts with port_t
-00005dd0: 7970 6520 286f 7074 6963 616c 2c20 656c  ype (optical, el
-00005de0: 6563 7472 6963 616c 2c20 7665 7274 6963  ectrical, vertic
-00005df0: 616c 5f74 6529 2e0a 2020 2020 2020 2020  al_te)..        
-00005e00: 2020 2020 636c 6f63 6b77 6973 653a 2069      clockwise: i
-00005e10: 6620 5472 7565 2c20 736f 7274 2070 6f72  f True, sort por
-00005e20: 7473 2063 6c6f 636b 7769 7365 2c20 4661  ts clockwise, Fa
-00005e30: 6c73 653a 2063 6f75 6e74 6572 2d63 6c6f  lse: counter-clo
-00005e40: 636b 7769 7365 2e0a 2020 2020 2020 2020  ckwise..        
-00005e50: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00005e60: 726e 2073 656c 6563 745f 706f 7274 7328  rn select_ports(
-00005e70: 7365 6c66 2e70 6f72 7473 2c20 2a2a 6b77  self.ports, **kw
-00005e80: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00005e90: 6574 5f70 6f72 7473 5f6c 6973 7428 7365  et_ports_list(se
-00005ea0: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
-00005eb0: 206c 6973 745b 506f 7274 5d3a 0a20 2020   list[Port]:.   
-00005ec0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00005ed0: 6c69 7374 206f 6620 706f 7274 732e 0a0a  list of ports...
-00005ee0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00005ef0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00005f00: 2020 6c61 7965 723a 2073 656c 6563 7420    layer: select 
-00005f10: 706f 7274 7320 7769 7468 2047 4453 206c  ports with GDS l
-00005f20: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
-00005f30: 2020 7072 6566 6978 3a20 7365 6c65 6374    prefix: select
-00005f40: 2070 6f72 7473 2077 6974 6820 7072 6566   ports with pref
-00005f50: 6978 2069 6e20 706f 7274 206e 616d 652e  ix in port name.
-00005f60: 0a20 2020 2020 2020 2020 2020 2073 7566  .            suf
-00005f70: 6669 783a 2073 656c 6563 7420 706f 7274  fix: select port
-00005f80: 7320 7769 7468 2070 6f72 7420 6e61 6d65  s with port name
-00005f90: 2073 7566 6669 782e 0a20 2020 2020 2020   suffix..       
-00005fa0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-00005fb0: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
-00005fc0: 6974 6820 6f72 6965 6e74 6174 696f 6e20  ith orientation 
-00005fd0: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
-00005fe0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-00005ff0: 696f 6e3a 2073 656c 6563 7420 706f 7274  ion: select port
-00006000: 7320 7769 7468 206f 7269 656e 7461 7469  s with orientati
-00006010: 6f6e 2069 6e20 6465 6772 6565 732e 0a20  on in degrees.. 
-00006020: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00006030: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
-00006040: 6974 6820 706f 7274 2077 6964 7468 2e0a  ith port width..
-00006050: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00006060: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
-00006070: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
-00006080: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
-00006090: 2020 2020 706f 7274 5f74 7970 653a 2073      port_type: s
-000060a0: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
-000060b0: 2070 6f72 745f 7479 7065 2028 6f70 7469   port_type (opti
-000060c0: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
-000060d0: 2076 6572 7469 6361 6c5f 7465 292e 0a20   vertical_te).. 
-000060e0: 2020 2020 2020 2020 2020 2063 6c6f 636b             clock
-000060f0: 7769 7365 3a20 6966 2054 7275 652c 2073  wise: if True, s
-00006100: 6f72 7420 706f 7274 7320 636c 6f63 6b77  ort ports clockw
-00006110: 6973 652c 2046 616c 7365 3a20 636f 756e  ise, False: coun
-00006120: 7465 722d 636c 6f63 6b77 6973 652e 0a20  ter-clockwise.. 
-00006130: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00006140: 2020 2072 6574 7572 6e20 6c69 7374 2873     return list(s
-00006150: 656c 6563 745f 706f 7274 7328 7365 6c66  elect_ports(self
-00006160: 2e70 6f72 7473 2c20 2a2a 6b77 6172 6773  .ports, **kwargs
-00006170: 292e 7661 6c75 6573 2829 290a 0a20 2020  ).values())..   
-00006180: 2064 6566 2067 6574 5f70 6f72 7473 5f70   def get_ports_p
-00006190: 616e 6461 7328 7365 6c66 293a 0a20 2020  andas(self):.   
-000061a0: 2020 2020 2069 6d70 6f72 7420 7061 6e64       import pand
-000061b0: 6173 2061 7320 7064 0a0a 2020 2020 2020  as as pd..      
-000061c0: 2020 636f 6c5f 7370 6563 203d 205b 0a20    col_spec = [. 
-000061d0: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
-000061e0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-000061f0: 7769 6474 6822 2c0a 2020 2020 2020 2020  width",.        
-00006200: 2020 2020 2263 656e 7465 7222 2c0a 2020      "center",.  
-00006210: 2020 2020 2020 2020 2020 226f 7269 656e            "orien
-00006220: 7461 7469 6f6e 222c 0a20 2020 2020 2020  tation",.       
-00006230: 2020 2020 2022 6c61 7965 7222 2c0a 2020       "layer",.  
-00006240: 2020 2020 2020 2020 2020 2270 6f72 745f            "port_
-00006250: 7479 7065 222c 0a20 2020 2020 2020 2020  type",.         
-00006260: 2020 2022 7368 6561 725f 616e 676c 6522     "shear_angle"
-00006270: 2c0a 2020 2020 2020 2020 5d0a 0a20 2020  ,.        ]..   
-00006280: 2020 2020 2072 6574 7572 6e20 7064 2e44       return pd.D
-00006290: 6174 6146 7261 6d65 280a 2020 2020 2020  ataFrame(.      
-000062a0: 2020 2020 2020 5b70 6f72 742e 746f 5f64        [port.to_d
-000062b0: 6963 7428 2920 666f 7220 706f 7274 2069  ict() for port i
-000062c0: 6e20 7365 6c66 2e67 6574 5f70 6f72 7473  n self.get_ports
-000062d0: 5f6c 6973 7428 295d 2c20 636f 6c75 6d6e  _list()], column
-000062e0: 733d 636f 6c5f 7370 6563 0a20 2020 2020  s=col_spec.     
-000062f0: 2020 2029 0a0a 2020 2020 6465 6620 6765     )..    def ge
-00006300: 745f 706f 7274 735f 706f 6c61 7273 2873  t_ports_polars(s
-00006310: 656c 6629 3a0a 2020 2020 2020 2020 696d  elf):.        im
-00006320: 706f 7274 2070 6f6c 6172 7320 6173 2070  port polars as p
-00006330: 6c0a 0a20 2020 2020 2020 2063 6f6c 5f73  l..        col_s
-00006340: 7065 6320 3d20 7b0a 2020 2020 2020 2020  pec = {.        
-00006350: 2020 2020 226e 616d 6522 3a20 706c 2e55      "name": pl.U
-00006360: 7466 382c 0a20 2020 2020 2020 2020 2020  tf8,.           
-00006370: 2022 7769 6474 6822 3a20 706c 2e46 6c6f   "width": pl.Flo
-00006380: 6174 3634 2c0a 2020 2020 2020 2020 2020  at64,.          
-00006390: 2020 2263 656e 7465 7222 3a20 706c 2e4c    "center": pl.L
-000063a0: 6973 7428 706c 2e46 6c6f 6174 3634 292c  ist(pl.Float64),
-000063b0: 0a20 2020 2020 2020 2020 2020 2022 6f72  .            "or
-000063c0: 6965 6e74 6174 696f 6e22 3a20 706c 2e46  ientation": pl.F
-000063d0: 6c6f 6174 3634 2c0a 2020 2020 2020 2020  loat64,.        
-000063e0: 2020 2020 226c 6179 6572 223a 2070 6c2e      "layer": pl.
-000063f0: 4c69 7374 2870 6c2e 5549 6e74 3136 292c  List(pl.UInt16),
-00006400: 0a20 2020 2020 2020 2020 2020 2022 706f  .            "po
-00006410: 7274 5f74 7970 6522 3a20 706c 2e55 7466  rt_type": pl.Utf
-00006420: 382c 0a20 2020 2020 2020 2020 2020 2022  8,.            "
-00006430: 7368 6561 725f 616e 676c 6522 3a20 706c  shear_angle": pl
-00006440: 2e46 6c6f 6174 3634 2c0a 2020 2020 2020  .Float64,.      
-00006450: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
-00006460: 7572 6e20 706c 2e44 6174 6146 7261 6d65  urn pl.DataFrame
-00006470: 280a 2020 2020 2020 2020 2020 2020 5b70  (.            [p
-00006480: 6f72 742e 746f 5f64 6963 7428 2920 666f  ort.to_dict() fo
-00006490: 7220 706f 7274 2069 6e20 7365 6c66 2e67  r port in self.g
-000064a0: 6574 5f70 6f72 7473 5f6c 6973 7428 295d  et_ports_list()]
-000064b0: 2c20 7363 6865 6d61 3d63 6f6c 5f73 7065  , schema=col_spe
-000064c0: 630a 2020 2020 2020 2020 290a 0a20 2020  c.        )..   
-000064d0: 2064 6566 2072 6566 280a 2020 2020 2020   def ref(.      
-000064e0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000064f0: 706f 7369 7469 6f6e 3a20 436f 6f72 6469  position: Coordi
-00006500: 6e61 7465 203d 2028 302c 2030 292c 0a20  nate = (0, 0),. 
-00006510: 2020 2020 2020 2070 6f72 745f 6964 3a20         port_id: 
-00006520: 7374 7220 7c20 4e6f 6e65 203d 204e 6f6e  str | None = Non
-00006530: 652c 0a20 2020 2020 2020 2072 6f74 6174  e,.        rotat
-00006540: 696f 6e3a 2066 6c6f 6174 203d 2030 2c0a  ion: float = 0,.
-00006550: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
-00006560: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00006570: 2020 2020 2020 2020 765f 6d69 7272 6f72          v_mirror
-00006580: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00006590: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
-000065a0: 6e74 5265 6665 7265 6e63 653a 0a20 2020  ntReference:.   
-000065b0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-000065c0: 436f 6d70 6f6e 656e 7420 7265 6665 7265  Component refere
-000065d0: 6e63 652e 0a0a 2020 2020 2020 2020 4172  nce...        Ar
-000065e0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-000065f0: 706f 7369 7469 6f6e 3a20 782c 2079 2070  position: x, y p
-00006600: 6f73 6974 696f 6e2e 0a20 2020 2020 2020  osition..       
-00006610: 2020 2020 2070 6f72 745f 6964 3a20 6e61       port_id: na
-00006620: 6d65 206f 6620 7468 6520 706f 7274 2e0a  me of the port..
-00006630: 2020 2020 2020 2020 2020 2020 726f 7461              rota
-00006640: 7469 6f6e 3a20 696e 2064 6567 7265 6573  tion: in degrees
-00006650: 2e0a 2020 2020 2020 2020 2020 2020 685f  ..            h_
-00006660: 6d69 7272 6f72 3a20 686f 7269 7a6f 6e74  mirror: horizont
-00006670: 616c 206d 6972 726f 7220 7573 696e 6720  al mirror using 
-00006680: 7920 6178 6973 2028 782c 2031 2920 2831  y axis (x, 1) (1
-00006690: 2c20 3029 2e0a 2020 2020 2020 2020 2020  , 0)..          
-000066a0: 2020 2020 2020 5468 6973 2069 7320 7468        This is th
-000066b0: 6520 6d6f 7374 2063 6f6d 6d6f 6e20 6d69  e most common mi
-000066c0: 7272 6f72 2e0a 2020 2020 2020 2020 2020  rror..          
-000066d0: 2020 765f 6d69 7272 6f72 3a20 7665 7274    v_mirror: vert
-000066e0: 6963 616c 206d 6972 726f 7220 7573 696e  ical mirror usin
-000066f0: 6720 7820 6178 6973 2028 312c 2079 2920  g x axis (1, y) 
-00006700: 2830 2c20 7929 2e0a 2020 2020 2020 2020  (0, y)..        
-00006710: 2222 220a 2020 2020 2020 2020 5f72 6566  """.        _ref
-00006720: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-00006730: 7265 6e63 6528 7365 6c66 290a 0a20 2020  rence(self)..   
-00006740: 2020 2020 2069 6620 706f 7274 5f69 6420       if port_id 
-00006750: 616e 6420 706f 7274 5f69 6420 6e6f 7420  and port_id not 
-00006760: 696e 2073 656c 662e 706f 7274 733a 0a20  in self.ports:. 
-00006770: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00006780: 2056 616c 7565 4572 726f 7228 6622 706f   ValueError(f"po
-00006790: 7274 207b 706f 7274 5f69 647d 206e 6f74  rt {port_id} not
-000067a0: 2069 6e20 7b73 656c 662e 706f 7274 732e   in {self.ports.
-000067b0: 6b65 7973 2829 7d22 290a 0a20 2020 2020  keys()}")..     
-000067c0: 2020 206f 7269 6769 6e20 3d20 7365 6c66     origin = self
-000067d0: 2e70 6f72 7473 5b70 6f72 745f 6964 5d2e  .ports[port_id].
-000067e0: 6365 6e74 6572 2069 6620 706f 7274 5f69  center if port_i
-000067f0: 6420 656c 7365 2028 302c 2030 290a 2020  d else (0, 0).  
-00006800: 2020 2020 2020 6966 2068 5f6d 6972 726f        if h_mirro
-00006810: 723a 0a20 2020 2020 2020 2020 2020 205f  r:.            _
-00006820: 7265 662e 6d69 7272 6f72 5f78 2870 6f72  ref.mirror_x(por
-00006830: 745f 6964 290a 0a20 2020 2020 2020 2069  t_id)..        i
-00006840: 6620 765f 6d69 7272 6f72 3a0a 2020 2020  f v_mirror:.    
-00006850: 2020 2020 2020 2020 5f72 6566 2e6d 6972          _ref.mir
-00006860: 726f 725f 7928 706f 7274 5f69 6429 0a0a  ror_y(port_id)..
-00006870: 2020 2020 2020 2020 6966 2072 6f74 6174          if rotat
-00006880: 696f 6e20 213d 2030 3a0a 2020 2020 2020  ion != 0:.      
-00006890: 2020 2020 2020 5f72 6566 2e72 6f74 6174        _ref.rotat
-000068a0: 6528 726f 7461 7469 6f6e 2c20 6f72 6967  e(rotation, orig
-000068b0: 696e 290a 2020 2020 2020 2020 5f72 6566  in).        _ref
-000068c0: 2e6d 6f76 6528 6f72 6967 696e 2c20 706f  .move(origin, po
-000068d0: 7369 7469 6f6e 290a 0a20 2020 2020 2020  sition)..       
-000068e0: 2072 6574 7572 6e20 5f72 6566 0a0a 2020   return _ref..  
-000068f0: 2020 6465 6620 7265 665f 6365 6e74 6572    def ref_center
-00006900: 2873 656c 662c 2070 6f73 6974 696f 6e3d  (self, position=
-00006910: 2830 2c20 3029 293a 0a20 2020 2020 2020  (0, 0)):.       
-00006920: 2022 2222 5265 7475 726e 7320 6120 7265   """Returns a re
-00006930: 6665 7265 6e63 6520 6f66 2074 6865 2063  ference of the c
-00006940: 6f6d 706f 6e65 6e74 2063 656e 7465 7265  omponent centere
-00006950: 6420 6174 2028 783d 302c 2079 3d30 292e  d at (x=0, y=0).
-00006960: 2222 220a 2020 2020 2020 2020 7369 203d  """.        si =
-00006970: 2073 656c 662e 7369 7a65 5f69 6e66 6f0a   self.size_info.
-00006980: 2020 2020 2020 2020 7963 203d 2073 692e          yc = si.
-00006990: 736f 7574 6820 2b20 7369 2e68 6569 6768  south + si.heigh
-000069a0: 7420 2f20 320a 2020 2020 2020 2020 7863  t / 2.        xc
-000069b0: 203d 2073 692e 7765 7374 202b 2073 692e   = si.west + si.
-000069c0: 7769 6474 6820 2f20 320a 2020 2020 2020  width / 2.      
-000069d0: 2020 6365 6e74 6572 203d 2028 7863 2c20    center = (xc, 
-000069e0: 7963 290a 2020 2020 2020 2020 5f72 6566  yc).        _ref
-000069f0: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-00006a00: 7265 6e63 6528 7365 6c66 290a 2020 2020  rence(self).    
-00006a10: 2020 2020 5f72 6566 2e6d 6f76 6528 6365      _ref.move(ce
-00006a20: 6e74 6572 2c20 706f 7369 7469 6f6e 290a  nter, position).
-00006a30: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-00006a40: 7265 660a 0a20 2020 2064 6566 205f 5f72  ref..    def __r
-00006a50: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-00006a60: 7472 3a0a 2020 2020 2020 2020 2222 2252  tr:.        """R
-00006a70: 6574 7572 6e20 6120 7374 7269 6e67 2072  eturn a string r
-00006a80: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
-00006a90: 2074 6865 206f 626a 6563 742e 2222 220a   the object.""".
-00006aa0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00006ab0: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
-00006ac0: 7365 6c66 2e6e 616d 657d 3a20 7569 6420  self.name}: uid 
-00006ad0: 7b73 656c 662e 7569 647d 2c20 220a 2020  {self.uid}, ".  
-00006ae0: 2020 2020 2020 2020 2020 6622 706f 7274            f"port
-00006af0: 7320 7b6c 6973 7428 7365 6c66 2e70 6f72  s {list(self.por
-00006b00: 7473 2e6b 6579 7328 2929 7d2c 2022 0a20  ts.keys())}, ". 
-00006b10: 2020 2020 2020 2020 2020 2066 2272 6566             f"ref
-00006b20: 6572 656e 6365 7320 7b6c 6973 7428 7365  erences {list(se
-00006b30: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
-00006b40: 6365 732e 6b65 7973 2829 297d 2c20 220a  ces.keys())}, ".
-00006b50: 2020 2020 2020 2020 2020 2020 6622 7b6c              f"{l
-00006b60: 656e 2873 656c 662e 706f 6c79 676f 6e73  en(self.polygons
-00006b70: 297d 2070 6f6c 7967 6f6e 7322 0a20 2020  )} polygons".   
-00006b80: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00006b90: 7070 7269 6e74 2873 656c 6629 202d 3e20  pprint(self) -> 
-00006ba0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00006bb0: 2250 7269 6e74 7320 636f 6d70 6f6e 656e  "Prints componen
-00006bc0: 7420 696e 666f 2e22 2222 0a20 2020 2020  t info.""".     
-00006bd0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00006be0: 2020 2020 6672 6f6d 2072 6963 6820 696d      from rich im
-00006bf0: 706f 7274 2070 7265 7474 790a 0a20 2020  port pretty..   
-00006c00: 2020 2020 2020 2020 2070 7265 7474 792e           pretty.
-00006c10: 696e 7374 616c 6c28 290a 2020 2020 2020  install().      
-00006c20: 2020 2020 2020 7072 6574 7479 2e70 7072        pretty.ppr
-00006c30: 696e 7428 7365 6c66 2e74 6f5f 6469 6374  int(self.to_dict
-00006c40: 2829 290a 2020 2020 2020 2020 6578 6365  ()).        exce
-00006c50: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
-00006c60: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00006c70: 7428 7961 6d6c 2e64 756d 7028 7365 6c66  t(yaml.dump(self
-00006c80: 2e74 6f5f 6469 6374 2829 2929 0a0a 2020  .to_dict()))..  
-00006c90: 2020 6465 6620 7070 7269 6e74 5f70 6f72    def pprint_por
-00006ca0: 7473 2873 656c 6629 202d 3e20 4e6f 6e65  ts(self) -> None
-00006cb0: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
-00006cc0: 6e74 7320 706f 7274 7320 696e 2061 2072  nts ports in a r
-00006cd0: 6963 6820 7461 626c 652e 2222 220a 2020  ich table.""".  
-00006ce0: 2020 2020 2020 6672 6f6d 2072 6963 682e        from rich.
-00006cf0: 636f 6e73 6f6c 6520 696d 706f 7274 2043  console import C
-00006d00: 6f6e 736f 6c65 0a20 2020 2020 2020 2066  onsole.        f
-00006d10: 726f 6d20 7269 6368 2e74 6162 6c65 2069  rom rich.table i
-00006d20: 6d70 6f72 7420 5461 626c 650a 0a20 2020  mport Table..   
-00006d30: 2020 2020 2063 6f6e 736f 6c65 203d 2043       console = C
-00006d40: 6f6e 736f 6c65 2829 0a0a 2020 2020 2020  onsole()..      
-00006d50: 2020 7461 626c 6520 3d20 5461 626c 6528    table = Table(
-00006d60: 7368 6f77 5f68 6561 6465 723d 5472 7565  show_header=True
-00006d70: 2c20 6865 6164 6572 5f73 7479 6c65 3d22  , header_style="
-00006d80: 626f 6c64 2229 0a20 2020 2020 2020 2070  bold").        p
-00006d90: 6f72 7473 5f6c 6973 7420 3d20 7365 6c66  orts_list = self
-00006da0: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
-00006db0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00006dc0: 2070 6f72 7473 5f6c 6973 743a 0a20 2020   ports_list:.   
-00006dd0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00006de0: 2020 2020 2020 2020 7030 203d 2070 6f72          p0 = por
-00006df0: 7473 5f6c 6973 745b 305d 0a20 2020 2020  ts_list[0].     
-00006e00: 2020 2066 696c 7465 7265 645f 6469 6374     filtered_dict
-00006e10: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00006e20: 206b 6579 3a20 7661 6c75 6520 666f 7220   key: value for 
-00006e30: 6b65 792c 2076 616c 7565 2069 6e20 7030  key, value in p0
-00006e40: 2e74 6f5f 6469 6374 2829 2e69 7465 6d73  .to_dict().items
-00006e50: 2829 2069 6620 7661 6c75 6520 6973 206e  () if value is n
-00006e60: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00006e70: 7d0a 2020 2020 2020 2020 6b65 7973 203d  }.        keys =
-00006e80: 2066 696c 7465 7265 645f 6469 6374 2e6b   filtered_dict.k
-00006e90: 6579 7328 290a 0a20 2020 2020 2020 2066  eys()..        f
-00006ea0: 6f72 206b 6579 2069 6e20 6b65 7973 3a0a  or key in keys:.
-00006eb0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00006ec0: 652e 6164 645f 636f 6c75 6d6e 286b 6579  e.add_column(key
-00006ed0: 290a 0a20 2020 2020 2020 2066 6f72 2070  )..        for p
-00006ee0: 6f72 7420 696e 2070 6f72 7473 5f6c 6973  ort in ports_lis
-00006ef0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
-00006f00: 6f72 745f 6469 6374 203d 2070 6f72 742e  ort_dict = port.
-00006f10: 746f 5f64 6963 7428 290a 2020 2020 2020  to_dict().      
-00006f20: 2020 2020 2020 726f 7720 3d20 5b73 7472        row = [str
-00006f30: 2870 6f72 745f 6469 6374 2e67 6574 286b  (port_dict.get(k
-00006f40: 6579 2c20 2222 2929 2066 6f72 206b 6579  ey, "")) for key
-00006f50: 2069 6e20 6b65 7973 5d0a 2020 2020 2020   in keys].      
-00006f60: 2020 2020 2020 7461 626c 652e 6164 645f        table.add_
-00006f70: 726f 7728 2a72 6f77 290a 0a20 2020 2020  row(*row)..     
-00006f80: 2020 2063 6f6e 736f 6c65 2e70 7269 6e74     console.print
-00006f90: 2874 6162 6c65 290a 0a20 2020 2040 7072  (table)..    @pr
-00006fa0: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
-00006fb0: 6574 6164 6174 615f 6368 696c 6428 7365  etadata_child(se
-00006fc0: 6c66 2920 2d3e 2064 6963 743a 0a20 2020  lf) -> dict:.   
-00006fd0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00006fe0: 6d65 7461 6461 7461 2066 726f 6d20 6368  metadata from ch
-00006ff0: 696c 6420 6966 2061 6e79 2c20 4f74 6865  ild if any, Othe
-00007000: 7277 6973 6520 7265 7475 726e 7320 636f  rwise returns co
-00007010: 6d70 6f6e 656e 7420 6f77 6e2e 0a0a 2020  mponent own...  
-00007020: 2020 2020 2020 6d65 7461 6461 7461 2047        metadata G
-00007030: 7265 6174 2074 6f20 6163 6365 7373 2074  reat to access t
-00007040: 6865 2063 6869 6c64 7265 6e20 6d65 7461  he children meta
-00007050: 6461 7461 2061 7420 7468 6520 626f 7474  data at the bott
-00007060: 6f6d 206f 6620 7468 650a 2020 2020 2020  om of the.      
-00007070: 2020 6869 6572 6172 6368 792e 0a20 2020    hierarchy..   
-00007080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007090: 2073 6574 7469 6e67 7320 3d20 6469 6374   settings = dict
-000070a0: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
-000070b0: 0a20 2020 2020 2020 2077 6869 6c65 2073  .        while s
-000070c0: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
-000070d0: 6c64 2229 3a0a 2020 2020 2020 2020 2020  ld"):.          
-000070e0: 2020 7365 7474 696e 6773 203d 2073 6574    settings = set
-000070f0: 7469 6e67 732e 6765 7428 2263 6869 6c64  tings.get("child
-00007100: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
-00007110: 726e 2064 6963 7428 7365 7474 696e 6773  rn dict(settings
-00007120: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
-00007130: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
-00007140: 6128 7365 6c66 2920 2d3e 2064 6963 743a  a(self) -> dict:
-00007150: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007160: 6469 6374 2873 656c 662e 7365 7474 696e  dict(self.settin
-00007170: 6773 290a 0a20 2020 2064 6566 2061 6464  gs)..    def add
-00007180: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
-00007190: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
-000071a0: 653a 2073 7472 207c 206f 626a 6563 7420  e: str | object 
-000071b0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-000071c0: 2020 2020 2020 2063 656e 7465 723a 2074         center: t
-000071d0: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
-000071e0: 745d 207c 204e 6f6e 6520 3d20 4e6f 6e65  t] | None = None
-000071f0: 2c0a 2020 2020 2020 2020 7769 6474 683a  ,.        width:
-00007200: 2066 6c6f 6174 207c 204e 6f6e 6520 3d20   float | None = 
-00007210: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f72  None,.        or
-00007220: 6965 6e74 6174 696f 6e3a 2066 6c6f 6174  ientation: float
-00007230: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00007240: 2020 2020 2020 2020 706f 7274 3a20 506f          port: Po
-00007250: 7274 207c 204e 6f6e 6520 3d20 4e6f 6e65  rt | None = None
-00007260: 2c0a 2020 2020 2020 2020 6c61 7965 723a  ,.        layer:
-00007270: 204c 6179 6572 5370 6563 207c 204e 6f6e   LayerSpec | Non
-00007280: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00007290: 2020 706f 7274 5f74 7970 653a 2073 7472    port_type: str
-000072a0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000072b0: 2020 2020 2020 2020 6372 6f73 735f 7365          cross_se
-000072c0: 6374 696f 6e3a 2043 726f 7373 5365 6374  ction: CrossSect
-000072d0: 696f 6e53 7065 6320 7c20 4e6f 6e65 203d  ionSpec | None =
-000072e0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-000072f0: 6865 6172 5f61 6e67 6c65 3a20 666c 6f61  hear_angle: floa
-00007300: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
-00007310: 0a20 2020 2029 202d 3e20 506f 7274 3a0a  .    ) -> Port:.
-00007320: 2020 2020 2020 2020 2222 2241 6464 2070          """Add p
-00007330: 6f72 7420 746f 2063 6f6d 706f 6e65 6e74  ort to component
-00007340: 2e0a 0a20 2020 2020 2020 2059 6f75 2063  ...        You c
-00007350: 616e 2063 6f70 7920 616e 2065 7869 7374  an copy an exist
-00007360: 696e 6720 706f 7274 206c 696b 6520 6164  ing port like ad
-00007370: 645f 706f 7274 2870 6f72 7420 3d20 6578  d_port(port = ex
-00007380: 6973 7469 6e67 5f70 6f72 7429 206f 720a  isting_port) or.
-00007390: 2020 2020 2020 2020 6372 6561 7465 2061          create a
-000073a0: 206e 6577 2070 6f72 7420 6164 645f 706f   new port add_po
-000073b0: 7274 286d 796e 616d 652c 206d 7963 656e  rt(myname, mycen
-000073c0: 7465 722c 206d 7977 6964 7468 2c20 6d79  ter, mywidth, my
-000073d0: 6f72 6965 6e74 6174 696f 6e29 2e0a 2020  orientation)..  
-000073e0: 2020 2020 2020 596f 7520 6361 6e20 616c        You can al
-000073f0: 736f 2063 6f70 7920 616e 2065 7869 7374  so copy an exist
-00007400: 696e 6720 706f 7274 0a20 2020 2020 2020  ing port.       
-00007410: 2077 6974 6820 6120 6e65 7720 6e61 6d65   with a new name
-00007420: 2061 6464 5f70 6f72 7428 706f 7274 203d   add_port(port =
-00007430: 2065 7869 7374 696e 675f 706f 7274 2c20   existing_port, 
-00007440: 6e61 6d65 203d 206e 6577 5f6e 616d 6529  name = new_name)
-00007450: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00007460: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00007470: 3a20 706f 7274 206e 616d 652e 0a20 2020  : port name..   
-00007480: 2020 2020 2020 2020 2063 656e 7465 723a           center:
-00007490: 2078 2c20 792e 0a20 2020 2020 2020 2020   x, y..         
-000074a0: 2020 2077 6964 7468 3a20 696e 2075 6d2e     width: in um.
-000074b0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-000074c0: 656e 7461 7469 6f6e 3a20 696e 2064 6567  entation: in deg
-000074d0: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-000074e0: 7274 3a20 6f70 7469 6f6e 616c 2070 6f72  rt: optional por
-000074f0: 742e 0a20 2020 2020 2020 2020 2020 206c  t..            l
-00007500: 6179 6572 3a20 706f 7274 206c 6179 6572  ayer: port layer
-00007510: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-00007520: 7274 5f74 7970 653a 206f 7074 6963 616c  rt_type: optical
-00007530: 2c20 656c 6563 7472 6963 616c 2c20 7665  , electrical, ve
-00007540: 7274 6963 616c 5f64 632c 2076 6572 7469  rtical_dc, verti
-00007550: 6361 6c5f 7465 2c20 7665 7274 6963 616c  cal_te, vertical
-00007560: 5f74 6d2e 2044 6566 6175 6c74 7320 746f  _tm. Defaults to
-00007570: 206f 7074 6963 616c 2e0a 2020 2020 2020   optical..      
-00007580: 2020 2020 2020 6372 6f73 735f 7365 6374        cross_sect
-00007590: 696f 6e3a 2070 6f72 7420 6372 6f73 735f  ion: port cross_
-000075a0: 7365 6374 696f 6e2e 0a20 2020 2020 2020  section..       
-000075b0: 2020 2020 2073 6865 6172 5f61 6e67 6c65       shear_angle
-000075c0: 3a20 616e 206f 7074 696f 6e61 6c20 616e  : an optional an
-000075d0: 676c 6520 746f 2073 6865 6172 2070 6f72  gle to shear por
-000075e0: 7420 6661 6365 2069 6e20 6465 6772 6565  t face in degree
-000075f0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00007600: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-00007610: 6163 746f 7279 2e70 646b 2069 6d70 6f72  actory.pdk impor
-00007620: 7420 6765 745f 6372 6f73 735f 7365 6374  t get_cross_sect
-00007630: 696f 6e2c 2067 6574 5f6c 6179 6572 0a0a  ion, get_layer..
-00007640: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
-00007650: 6765 745f 6c61 7965 7228 6c61 7965 7229  get_layer(layer)
-00007660: 0a0a 2020 2020 2020 2020 6966 2070 6f72  ..        if por
-00007670: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
-00007680: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00007690: 2870 6f72 742c 2050 6f72 7429 3a0a 2020  (port, Port):.  
-000076a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000076b0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-000076c0: 2261 6464 5f70 6f72 7428 2920 6e65 6564  "add_port() need
-000076d0: 7320 6120 506f 7274 2c20 676f 7420 7b74  s a Port, got {t
-000076e0: 7970 6528 706f 7274 297d 2229 0a20 2020  ype(port)}").   
-000076f0: 2020 2020 2020 2020 2070 203d 2070 6f72           p = por
-00007700: 742e 636f 7079 2829 0a20 2020 2020 2020  t.copy().       
-00007710: 2020 2020 2069 6620 6e61 6d65 2069 7320       if name is 
-00007720: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00007730: 2020 2020 2020 2020 2020 702e 6e61 6d65            p.name
-00007740: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
-00007750: 2020 2020 6966 2063 656e 7465 7220 6973      if center is
-00007760: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00007770: 2020 2020 2020 2020 2020 2070 2e63 656e             p.cen
-00007780: 7465 7220 3d20 6365 6e74 6572 0a20 2020  ter = center.   
-00007790: 2020 2020 2020 2020 2069 6620 7769 6474           if widt
-000077a0: 6820 6973 206e 6f74 204e 6f6e 653a 0a20  h is not None:. 
-000077b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000077c0: 2e77 6964 7468 203d 2077 6964 7468 0a20  .width = width. 
-000077d0: 2020 2020 2020 2020 2020 2069 6620 6f72             if or
-000077e0: 6965 6e74 6174 696f 6e20 6973 206e 6f74  ientation is not
-000077f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007800: 2020 2020 2020 2070 2e6f 7269 656e 7461         p.orienta
-00007810: 7469 6f6e 203d 206f 7269 656e 7461 7469  tion = orientati
-00007820: 6f6e 0a20 2020 2020 2020 2020 2020 2069  on.            i
-00007830: 6620 706f 7274 5f74 7970 6520 6973 206e  f port_type is n
-00007840: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00007850: 2020 2020 2020 2020 2070 2e70 6f72 745f           p.port_
-00007860: 7479 7065 203d 2070 6f72 745f 7479 7065  type = port_type
-00007870: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00007880: 6c61 7965 7220 6973 206e 6f74 204e 6f6e  layer is not Non
-00007890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000078a0: 2020 2070 2e6c 6179 6572 203d 206c 6179     p.layer = lay
-000078b0: 6572 0a20 2020 2020 2020 2020 2020 2070  er.            p
-000078c0: 2e70 6172 656e 7420 3d20 7365 6c66 0a0a  .parent = self..
-000078d0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-000078e0: 6e73 7461 6e63 6528 6e61 6d65 2c20 506f  nstance(name, Po
-000078f0: 7274 293a 0a20 2020 2020 2020 2020 2020  rt):.           
-00007900: 2070 203d 206e 616d 652e 636f 7079 2829   p = name.copy()
-00007910: 0a20 2020 2020 2020 2020 2020 2070 2e70  .            p.p
-00007920: 6172 656e 7420 3d20 7365 6c66 0a20 2020  arent = self.   
-00007930: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-00007940: 702e 6e61 6d65 0a20 2020 2020 2020 2065  p.name.        e
-00007950: 6c69 6620 6365 6e74 6572 2069 7320 4e6f  lif center is No
-00007960: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007970: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00007980: 2822 506f 7274 206e 6565 6473 2063 656e  ("Port needs cen
-00007990: 7465 7220 7061 7261 6d65 7465 7220 2878  ter parameter (x
-000079a0: 2c20 7929 2075 6d2e 2229 0a0a 2020 2020  , y) um.")..    
-000079b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000079c0: 2020 2020 2020 7020 3d20 506f 7274 280a        p = Port(.
-000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079e0: 6e61 6d65 3d6e 616d 652c 0a20 2020 2020  name=name,.     
-000079f0: 2020 2020 2020 2020 2020 2063 656e 7465             cente
-00007a00: 723d 6365 6e74 6572 2c0a 2020 2020 2020  r=center,.      
-00007a10: 2020 2020 2020 2020 2020 7769 6474 683d            width=
-00007a20: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-00007a30: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
-00007a40: 6f6e 3d6f 7269 656e 7461 7469 6f6e 2c0a  on=orientation,.
-00007a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a60: 7061 7265 6e74 3d73 656c 662c 0a20 2020  parent=self,.   
-00007a70: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-00007a80: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
-00007a90: 2020 2020 2020 2020 2020 706f 7274 5f74            port_t
-00007aa0: 7970 653d 706f 7274 5f74 7970 6520 6f72  ype=port_type or
-00007ab0: 2022 6f70 7469 6361 6c22 2c0a 2020 2020   "optical",.    
-00007ac0: 2020 2020 2020 2020 2020 2020 6372 6f73              cros
-00007ad0: 735f 7365 6374 696f 6e3d 6765 745f 6372  s_section=get_cr
-00007ae0: 6f73 735f 7365 6374 696f 6e28 6372 6f73  oss_section(cros
-00007af0: 735f 7365 6374 696f 6e29 0a20 2020 2020  s_section).     
-00007b00: 2020 2020 2020 2020 2020 2069 6620 6372             if cr
-00007b10: 6f73 735f 7365 6374 696f 6e0a 2020 2020  oss_section.    
-00007b20: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00007b30: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00007b40: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-00007b50: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-00007b60: 3a0a 2020 2020 2020 2020 2020 2020 702e  :.            p.
-00007b70: 6e61 6d65 203d 206e 616d 650a 2020 2020  name = name.    
-00007b80: 2020 2020 6966 2070 2e6e 616d 6520 696e      if p.name in
-00007b90: 2073 656c 662e 706f 7274 733a 0a20 2020   self.ports:.   
-00007ba0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00007bb0: 616c 7565 4572 726f 7228 6622 6164 645f  alueError(f"add_
-00007bc0: 706f 7274 2829 2050 6f72 7420 6e61 6d65  port() Port name
-00007bd0: 207b 702e 6e61 6d65 2172 7d20 6578 6973   {p.name!r} exis
-00007be0: 7473 2069 6e20 7b73 656c 662e 6e61 6d65  ts in {self.name
-00007bf0: 2172 7d22 290a 0a20 2020 2020 2020 2073  !r}")..        s
-00007c00: 656c 662e 706f 7274 735b 702e 6e61 6d65  elf.ports[p.name
-00007c10: 5d20 3d20 700a 2020 2020 2020 2020 7265  ] = p.        re
-00007c20: 7475 726e 2070 0a0a 2020 2020 6465 6620  turn p..    def 
-00007c30: 6164 645f 706f 7274 7328 0a20 2020 2020  add_ports(.     
-00007c40: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00007c50: 2070 6f72 7473 3a20 4974 6572 6162 6c65   ports: Iterable
-00007c60: 5b50 6f72 745d 207c 2064 6963 745b 7374  [Port] | dict[st
-00007c70: 722c 2050 6f72 745d 2c0a 2020 2020 2020  r, Port],.      
-00007c80: 2020 7072 6566 6978 3a20 7374 7220 3d20    prefix: str = 
-00007c90: 2222 2c0a 2020 2020 2020 2020 7375 6666  "",.        suff
-00007ca0: 6978 3a20 7374 7220 3d20 2222 2c0a 2020  ix: str = "",.  
-00007cb0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-00007cc0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00007cd0: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
-00007ce0: 6c69 7374 206f 7220 6469 6374 206f 6620  list or dict of 
-00007cf0: 706f 7274 732e 0a0a 2020 2020 2020 2020  ports...        
-00007d00: 796f 7520 6361 6e20 696e 636c 7564 6520  you can include 
-00007d10: 6120 7072 6566 6978 2074 6f20 6164 6420  a prefix to add 
-00007d20: 746f 2074 6865 206e 6577 2070 6f72 7420  to the new port 
-00007d30: 6e61 6d65 7320 746f 2061 766f 6964 206e  names to avoid n
-00007d40: 616d 6520 636f 6e66 6c69 6374 732e 0a0a  ame conflicts...
-00007d50: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00007d60: 2020 2020 2020 2020 2020 706f 7274 733a            ports:
-00007d70: 206c 6973 7420 6f72 2064 6963 7420 6f66   list or dict of
-00007d80: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
-00007d90: 2020 2020 7072 6566 6978 3a20 746f 2070      prefix: to p
-00007da0: 7265 7065 6e64 2074 6f20 6561 6368 2070  repend to each p
-00007db0: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
-00007dc0: 2020 2020 2020 7375 6666 6978 3a20 746f        suffix: to
-00007dd0: 2061 7070 656e 6420 746f 2065 6163 6820   append to each 
-00007de0: 706f 7274 206e 616d 652e 0a20 2020 2020  port name..     
-00007df0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-00007e00: 6f72 7473 203d 2070 6f72 7473 2e76 616c  orts = ports.val
-00007e10: 7565 7328 2920 6966 2069 7369 6e73 7461  ues() if isinsta
-00007e20: 6e63 6528 706f 7274 732c 204d 6170 7069  nce(ports, Mappi
-00007e30: 6e67 2920 656c 7365 2070 6f72 7473 0a20  ng) else ports. 
-00007e40: 2020 2020 2020 2066 6f72 2070 6f72 7420         for port 
-00007e50: 696e 2070 6f72 7473 3a0a 2020 2020 2020  in ports:.      
-00007e60: 2020 2020 2020 6e61 6d65 203d 2066 227b        name = f"{
-00007e70: 7072 6566 6978 7d7b 706f 7274 2e6e 616d  prefix}{port.nam
-00007e80: 657d 7b73 7566 6669 787d 220a 2020 2020  e}{suffix}".    
-00007e90: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00007ea0: 5f70 6f72 7428 6e61 6d65 3d6e 616d 652c  _port(name=name,
-00007eb0: 2070 6f72 743d 706f 7274 2c20 2a2a 6b77   port=port, **kw
-00007ec0: 6172 6773 290a 0a20 2020 2064 6566 2073  args)..    def s
-00007ed0: 6e61 705f 706f 7274 735f 746f 5f67 7269  nap_ports_to_gri
-00007ee0: 6428 7365 6c66 2c20 6e6d 3a20 696e 7420  d(self, nm: int 
-00007ef0: 3d20 3129 202d 3e20 4e6f 6e65 3a0a 2020  = 1) -> None:.  
-00007f00: 2020 2020 2020 666f 7220 706f 7274 2069        for port i
-00007f10: 6e20 7365 6c66 2e70 6f72 7473 2e76 616c  n self.ports.val
-00007f20: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
-00007f30: 2020 2070 6f72 742e 736e 6170 5f74 6f5f     port.snap_to_
-00007f40: 6772 6964 286e 6d3d 6e6d 290a 0a20 2020  grid(nm=nm)..   
-00007f50: 2064 6566 2072 656d 6f76 655f 6c61 7965   def remove_laye
-00007f60: 7273 280a 2020 2020 2020 2020 7365 6c66  rs(.        self
-00007f70: 2c0a 2020 2020 2020 2020 6c61 7965 7273  ,.        layers
-00007f80: 3a20 6c69 7374 5b4c 6179 6572 5370 6563  : list[LayerSpec
-00007f90: 5d2c 0a20 2020 2020 2020 2069 6e63 6c75  ],.        inclu
-00007fa0: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
-00007fb0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00007fc0: 696e 7665 7274 5f73 656c 6563 7469 6f6e  invert_selection
-00007fd0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00007fe0: 2020 2020 2020 2020 7265 6375 7273 6976          recursiv
-00007ff0: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
-00008000: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
-00008010: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
-00008020: 656d 6f76 6520 6120 6c69 7374 206f 6620  emove a list of 
-00008030: 6c61 7965 7273 2061 6e64 2072 6574 7572  layers and retur
-00008040: 6e73 2074 6865 2073 616d 6520 436f 6d70  ns the same Comp
-00008050: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-00008060: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00008070: 2020 6c61 7965 7273 3a20 6c69 7374 206f    layers: list o
-00008080: 6620 6c61 7965 7273 2074 6f20 7265 6d6f  f layers to remo
-00008090: 7665 2e0a 2020 2020 2020 2020 2020 2020  ve..            
-000080a0: 696e 636c 7564 655f 6c61 6265 6c73 3a20  include_labels: 
-000080b0: 7265 6d6f 7665 206c 6162 656c 7320 6f6e  remove labels on
-000080c0: 2074 686f 7365 206c 6179 6572 732e 0a20   those layers.. 
-000080d0: 2020 2020 2020 2020 2020 2069 6e76 6572             inver
-000080e0: 745f 7365 6c65 6374 696f 6e3a 2072 656d  t_selection: rem
-000080f0: 6f76 6573 2061 6c6c 206c 6179 6572 7320  oves all layers 
-00008100: 6578 6365 7074 206c 6179 6572 7320 7370  except layers sp
-00008110: 6563 6966 6965 642e 0a20 2020 2020 2020  ecified..       
-00008120: 2020 2020 2072 6563 7572 7369 7665 3a20       recursive: 
-00008130: 6f70 6572 6174 6520 6f6e 2074 6865 2063  operate on the c
-00008140: 656c 6c73 2069 6e63 6c75 6465 6420 696e  ells included in
-00008150: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
-00008160: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00008170: 6672 6f6d 2067 6473 6661 6374 6f72 7920  from gdsfactory 
-00008180: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
-00008190: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
-000081a0: 656e 7420 3d20 7365 6c66 2e66 6c61 7474  ent = self.flatt
-000081b0: 656e 2829 2069 6620 7265 6375 7273 6976  en() if recursiv
-000081c0: 6520 616e 6420 7365 6c66 2e72 6566 6572  e and self.refer
-000081d0: 656e 6365 7320 656c 7365 2073 656c 660a  ences else self.
-000081e0: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
-000081f0: 205b 6765 745f 6c61 7965 7228 6c61 7965   [get_layer(laye
-00008200: 7229 2066 6f72 206c 6179 6572 2069 6e20  r) for layer in 
-00008210: 6c61 7965 7273 5d0a 0a20 2020 2020 2020  layers]..       
-00008220: 2073 686f 756c 645f 7265 6d6f 7665 203d   should_remove =
-00008230: 206e 6f74 2069 6e76 6572 745f 7365 6c65   not invert_sele
-00008240: 6374 696f 6e0a 2020 2020 2020 2020 636f  ction.        co
-00008250: 6d70 6f6e 656e 742e 5f63 656c 6c2e 6669  mponent._cell.fi
-00008260: 6c74 6572 280a 2020 2020 2020 2020 2020  lter(.          
-00008270: 2020 7370 6563 3d6c 6179 6572 732c 0a20    spec=layers,. 
-00008280: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
-00008290: 653d 7368 6f75 6c64 5f72 656d 6f76 652c  e=should_remove,
-000082a0: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
-000082b0: 7967 6f6e 733d 5472 7565 2c0a 2020 2020  ygons=True,.    
-000082c0: 2020 2020 2020 2020 7061 7468 733d 5472          paths=Tr
-000082d0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-000082e0: 6c61 6265 6c73 3d69 6e63 6c75 6465 5f6c  labels=include_l
-000082f0: 6162 656c 732c 0a20 2020 2020 2020 2029  abels,.        )
-00008300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00008310: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
-00008320: 6566 2065 7874 7261 6374 280a 2020 2020  ef extract(.    
-00008330: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00008340: 2020 6c61 7965 7273 3a20 6c69 7374 5b74    layers: list[t
-00008350: 7570 6c65 5b69 6e74 2c20 696e 745d 207c  uple[int, int] |
-00008360: 2073 7472 5d2c 0a20 2020 2029 202d 3e20   str],.    ) -> 
-00008370: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
-00008380: 2020 2022 2222 4578 7472 6163 7420 706f     """Extract po
-00008390: 6c79 676f 6e73 2066 726f 6d20 6120 436f  lygons from a Co
-000083a0: 6d70 6f6e 656e 7420 616e 6420 7265 7475  mponent and retu
-000083b0: 726e 7320 6120 6e65 7720 436f 6d70 6f6e  rns a new Compon
-000083c0: 656e 742e 2222 220a 2020 2020 2020 2020  ent.""".        
-000083d0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-000083e0: 7064 6b20 696d 706f 7274 2067 6574 5f6c  pdk import get_l
-000083f0: 6179 6572 0a0a 2020 2020 2020 2020 6966  ayer..        if
-00008400: 2074 7970 6528 6c61 7965 7273 2920 6e6f   type(layers) no
-00008410: 7420 696e 2028 6c69 7374 2c20 7475 706c  t in (list, tupl
-00008420: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00008430: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00008440: 2866 226c 6179 6572 7320 7b6c 6179 6572  (f"layers {layer
-00008450: 7321 727d 206e 6565 6473 2074 6f20 6265  s!r} needs to be
-00008460: 2061 206c 6973 7420 6f72 2074 7570 6c65   a list or tuple
-00008470: 2229 0a0a 2020 2020 2020 2020 6c61 7965  ")..        laye
-00008480: 7273 203d 205b 6765 745f 6c61 7965 7228  rs = [get_layer(
-00008490: 6c61 7965 7229 2066 6f72 206c 6179 6572  layer) for layer
-000084a0: 2069 6e20 6c61 7965 7273 5d0a 2020 2020   in layers].    
-000084b0: 2020 2020 2320 636f 6d70 6f6e 656e 7420      # component 
-000084c0: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
-000084d0: 2020 2020 2020 2320 636f 6d70 6f6e 656e        # componen
-000084e0: 742e 5f63 656c 6c2e 6669 6c74 6572 2873  t._cell.filter(s
-000084f0: 7065 633d 6c61 7965 7273 2c20 7265 6d6f  pec=layers, remo
-00008500: 7665 3d46 616c 7365 290a 0a20 2020 2020  ve=False)..     
-00008510: 2020 2063 6f6d 706f 6e65 6e74 203d 2043     component = C
-00008520: 6f6d 706f 6e65 6e74 2829 0a20 2020 2020  omponent().     
-00008530: 2020 2070 6f6c 795f 6469 6374 203d 2073     poly_dict = s
-00008540: 656c 662e 6765 745f 706f 6c79 676f 6e73  elf.get_polygons
-00008550: 2862 795f 7370 6563 3d54 7275 652c 2069  (by_spec=True, i
-00008560: 6e63 6c75 6465 5f70 6174 6873 3d46 616c  nclude_paths=Fal
-00008570: 7365 290a 0a20 2020 2020 2020 2066 6f72  se)..        for
-00008580: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
-00008590: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000085a0: 206c 6179 6572 2069 6e20 706f 6c79 5f64   layer in poly_d
-000085b0: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
-000085c0: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
-000085d0: 706f 6c79 5f64 6963 745b 6c61 7965 725d  poly_dict[layer]
-000085e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000085f0: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
-00008600: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
-00008610: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00008620: 6d70 6f6e 656e 742e 6164 645f 706f 6c79  mponent.add_poly
-00008630: 676f 6e28 706f 6c79 676f 6e2c 206c 6179  gon(polygon, lay
-00008640: 6572 290a 0a20 2020 2020 2020 2066 6f72  er)..        for
-00008650: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
-00008660: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00008670: 7220 7061 7468 2069 6e20 7365 6c66 2e5f  r path in self._
-00008680: 6365 6c6c 2e67 6574 5f70 6174 6873 286c  cell.get_paths(l
-00008690: 6179 6572 3d6c 6179 6572 293a 0a20 2020  ayer=layer):.   
-000086a0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-000086b0: 706f 6e65 6e74 2e61 6464 2870 6174 6829  ponent.add(path)
-000086c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000086d0: 2063 6f6d 706f 6e65 6e74 0a0a 2020 2020   component..    
-000086e0: 6465 6620 6164 645f 706f 6c79 676f 6e28  def add_polygon(
-000086f0: 0a20 2020 2020 2020 2073 656c 662c 2070  .        self, p
-00008700: 6f69 6e74 732c 206c 6179 6572 3a20 7374  oints, layer: st
-00008710: 7220 7c20 696e 7420 7c20 7475 706c 655b  r | int | tuple[
-00008720: 696e 742c 2069 6e74 5d20 7c20 6e70 2e6e  int, int] | np.n
-00008730: 616e 203d 206e 702e 6e61 6e0a 2020 2020  an = np.nan.    
-00008740: 2920 2d3e 2050 6f6c 7967 6f6e 3a0a 2020  ) -> Polygon:.  
-00008750: 2020 2020 2020 2222 2241 6464 7320 6120        """Adds a 
-00008760: 506f 6c79 676f 6e20 746f 2074 6865 2043  Polygon to the C
-00008770: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-00008780: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00008790: 2020 2020 2070 6f69 6e74 733a 2043 6f6f       points: Coo
-000087a0: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
-000087b0: 7665 7274 6963 6573 206f 6620 7468 6520  vertices of the 
-000087c0: 506f 6c79 676f 6e2e 0a20 2020 2020 2020  Polygon..       
-000087d0: 2020 2020 206c 6179 6572 3a20 6c61 7965       layer: laye
-000087e0: 7220 7370 6563 2074 6f20 6164 6420 706f  r spec to add po
-000087f0: 6c79 676f 6e20 6f6e 2e0a 2020 2020 2020  lygon on..      
-00008800: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00008810: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
-00008820: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
-00008830: 6572 0a0a 2020 2020 2020 2020 6966 206c  er..        if l
-00008840: 6179 6572 2069 7320 4e6f 6e65 3a0a 2020  ayer is None:.  
-00008850: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008860: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-00008870: 6966 2069 7369 6e73 7461 6e63 6528 6c61  if isinstance(la
-00008880: 7965 722c 2073 6574 293a 0a20 2020 2020  yer, set):.     
-00008890: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
-000088a0: 3d20 5b73 656c 662e 6164 645f 706f 6c79  = [self.add_poly
-000088b0: 676f 6e28 706f 696e 7473 2c20 6c79 2920  gon(points, ly) 
-000088c0: 666f 7220 6c79 2069 6e20 6c61 7965 725d  for ly in layer]
-000088d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000088e0: 7572 6e20 706f 6c79 676f 6e73 5b30 5d0a  urn polygons[0].
-000088f0: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
-00008900: 2067 6574 5f6c 6179 6572 286c 6179 6572   get_layer(layer
-00008910: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
-00008920: 6e73 7461 6e63 6528 706f 696e 7473 2c20  nstance(points, 
-00008930: 6764 7374 6b2e 506f 6c79 676f 6e29 3a0a  gdstk.Polygon):.
-00008940: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00008950: 206c 6179 6572 2069 7320 756e 7370 6563   layer is unspec
-00008960: 6966 6965 6420 6f72 206d 6174 6368 6573  ified or matches
-00008970: 206f 7269 6769 6e61 6c20 706f 6c79 676f   original polygo
-00008980: 6e2c 206a 7573 7420 6164 6420 6974 2061  n, just add it a
-00008990: 732d 6973 0a20 2020 2020 2020 2020 2020  s-is.           
-000089a0: 2070 6f6c 7967 6f6e 203d 2070 6f69 6e74   polygon = point
-000089b0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-000089c0: 206c 6179 6572 2069 7320 6e70 2e6e 616e   layer is np.nan
-000089d0: 206f 7220 280a 2020 2020 2020 2020 2020   or (.          
-000089e0: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
-000089f0: 286c 6179 6572 2c20 7475 706c 6529 2061  (layer, tuple) a
-00008a00: 6e64 2028 706f 6c79 676f 6e2e 6c61 7965  nd (polygon.laye
-00008a10: 722c 2070 6f6c 7967 6f6e 2e64 6174 6174  r, polygon.datat
-00008a20: 7970 6529 203d 3d20 6c61 7965 720a 2020  ype) == layer.  
-00008a30: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00008a40: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-00008a50: 7967 6f6e 203d 2050 6f6c 7967 6f6e 2870  ygon = Polygon(p
-00008a60: 6f6c 7967 6f6e 2e70 6f69 6e74 732c 2028  olygon.points, (
-00008a70: 706f 6c79 676f 6e2e 6c61 7965 722c 2070  polygon.layer, p
-00008a80: 6f6c 7967 6f6e 2e64 6174 6174 7970 6529  olygon.datatype)
-00008a90: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00008aa0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008ab0: 2020 2020 6c61 7965 722c 2064 6174 6174      layer, datat
-00008ac0: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
-00008ad0: 6572 286c 6179 6572 290a 2020 2020 2020  er(layer).      
-00008ae0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
-00008af0: 6e20 3d20 506f 6c79 676f 6e28 706f 6c79  n = Polygon(poly
-00008b00: 676f 6e2e 706f 696e 7473 2c20 286c 6179  gon.points, (lay
-00008b10: 6572 2c20 6461 7461 7479 7065 2929 0a0a  er, datatype))..
-00008b20: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00008b30: 6173 6174 7472 2870 6f69 6e74 732c 2022  asattr(points, "
-00008b40: 7072 6f70 6572 7469 6573 2229 3a0a 2020  properties"):.  
-00008b50: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00008b60: 6c79 676f 6e2e 7072 6f70 6572 7469 6573  lygon.properties
-00008b70: 203d 2064 6565 7063 6f70 7928 706f 696e   = deepcopy(poin
-00008b80: 7473 2e70 726f 7065 7274 6965 7329 0a0a  ts.properties)..
-00008b90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008ba0: 2e5f 6164 645f 706f 6c79 676f 6e73 2870  ._add_polygons(p
-00008bb0: 6f6c 7967 6f6e 290a 2020 2020 2020 2020  olygon).        
-00008bc0: 2020 2020 7265 7475 726e 2070 6f6c 7967      return polyg
-00008bd0: 6f6e 0a0a 2020 2020 2020 2020 656c 6966  on..        elif
-00008be0: 2068 6173 6174 7472 2870 6f69 6e74 732c   hasattr(points,
-00008bf0: 2022 6765 6f6d 7322 293a 0a20 2020 2020   "geoms"):.     
-00008c00: 2020 2020 2020 2066 6f72 2067 656f 6d20         for geom 
-00008c10: 696e 2070 6f69 6e74 732e 6765 6f6d 733a  in points.geoms:
-00008c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c30: 2070 6f6c 7967 6f6e 203d 2073 656c 662e   polygon = self.
-00008c40: 6164 645f 706f 6c79 676f 6e28 6765 6f6d  add_polygon(geom
-00008c50: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
-00008c60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008c70: 6e20 706f 6c79 676f 6e0a 2020 2020 2020  n polygon.      
-00008c80: 2020 656c 6966 2068 6173 6174 7472 2870    elif hasattr(p
-00008c90: 6f69 6e74 732c 2022 6578 7465 7269 6f72  oints, "exterior
-00008ca0: 2229 3a20 2023 2070 6f69 6e74 7320 6973  "):  # points is
-00008cb0: 2061 2073 6861 7065 6c79 2050 6f6c 7967   a shapely Polyg
-00008cc0: 6f6e 0a20 2020 2020 2020 2020 2020 206c  on.            l
-00008cd0: 6179 6572 2c20 6461 7461 7479 7065 203d  ayer, datatype =
-00008ce0: 205f 7061 7273 655f 6c61 7965 7228 6c61   _parse_layer(la
-00008cf0: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
-00008d00: 2070 6f69 6e74 735f 6f6e 5f67 7269 6420   points_on_grid 
-00008d10: 3d20 6e70 2e72 6f75 6e64 2870 6f69 6e74  = np.round(point
-00008d20: 732e 6578 7465 7269 6f72 2e63 6f6f 7264  s.exterior.coord
-00008d30: 732c 2033 290a 2020 2020 2020 2020 2020  s, 3).          
-00008d40: 2020 706f 6c79 676f 6e20 3d20 506f 6c79    polygon = Poly
-00008d50: 676f 6e28 706f 696e 7473 5f6f 6e5f 6772  gon(points_on_gr
-00008d60: 6964 2c20 286c 6179 6572 2c20 6461 7461  id, (layer, data
-00008d70: 7479 7065 2929 0a0a 2020 2020 2020 2020  type))..        
-00008d80: 2020 2020 6966 2070 6f69 6e74 732e 696e      if points.in
-00008d90: 7465 7269 6f72 733a 0a20 2020 2020 2020  teriors:.       
-00008da0: 2020 2020 2020 2020 2066 726f 6d20 7368           from sh
-00008db0: 6170 656c 7920 696d 706f 7274 2067 6574  apely import get
-00008dc0: 5f63 6f6f 7264 696e 6174 6573 0a0a 2020  _coordinates..  
-00008dd0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00008de0: 696e 7473 5f6f 6e5f 6772 6964 5f69 6e74  ints_on_grid_int
-00008df0: 6572 696f 7220 3d20 6e70 2e72 6f75 6e64  erior = np.round
-00008e00: 2867 6574 5f63 6f6f 7264 696e 6174 6573  (get_coordinates
-00008e10: 2870 6f69 6e74 732e 696e 7465 7269 6f72  (points.interior
-00008e20: 7329 2c20 3329 0a20 2020 2020 2020 2020  s), 3).         
-00008e30: 2020 2020 2020 2070 6f6c 7967 6f6e 5f69         polygon_i
-00008e40: 6e74 6572 696f 7220 3d20 506f 6c79 676f  nterior = Polygo
-00008e50: 6e28 706f 696e 7473 5f6f 6e5f 6772 6964  n(points_on_grid
-00008e60: 5f69 6e74 6572 696f 722c 2028 6c61 7965  _interior, (laye
-00008e70: 722c 2064 6174 6174 7970 6529 290a 2020  r, datatype)).  
-00008e80: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00008e90: 6c79 676f 6e73 203d 2067 6473 746b 2e62  lygons = gdstk.b
-00008ea0: 6f6f 6c65 616e 280a 2020 2020 2020 2020  oolean(.        
-00008eb0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00008ec0: 676f 6e2c 0a20 2020 2020 2020 2020 2020  gon,.           
-00008ed0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00008ee0: 5f69 6e74 6572 696f 722c 0a20 2020 2020  _interior,.     
-00008ef0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00008f00: 7065 7261 7469 6f6e 3d22 6e6f 7422 2c0a  peration="not",.
-00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f20: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
-00008f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008f40: 2020 2020 2064 6174 6174 7970 653d 6461       datatype=da
-00008f50: 7461 7479 7065 2c0a 2020 2020 2020 2020  tatype,.        
-00008f60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00008f70: 2020 2020 2020 2020 2020 666f 7220 706f            for po
-00008f80: 6c79 676f 6e20 696e 2070 6f6c 7967 6f6e  lygon in polygon
-00008f90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00008fa0: 2020 2020 2020 2073 656c 662e 5f61 6464         self._add
-00008fb0: 5f70 6f6c 7967 6f6e 7328 706f 6c79 676f  _polygons(polygo
-00008fc0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-00008fd0: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-00008fe0: 6e0a 0a20 2020 2020 2020 2020 2020 2073  n..            s
-00008ff0: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
-00009000: 7328 706f 6c79 676f 6e29 0a20 2020 2020  s(polygon).     
-00009010: 2020 2020 2020 2072 6574 7572 6e20 706f         return po
-00009020: 6c79 676f 6e0a 0a20 2020 2020 2020 2070  lygon..        p
-00009030: 6f69 6e74 7320 3d20 6e70 2e61 7361 7272  oints = np.asarr
-00009040: 6179 2870 6f69 6e74 7329 0a20 2020 2020  ay(points).     
-00009050: 2020 2069 6620 706f 696e 7473 2e6e 6469     if points.ndi
-00009060: 6d20 3d3d 2031 3a0a 2020 2020 2020 2020  m == 1:.        
-00009070: 2020 2020 7265 7475 726e 205b 7365 6c66      return [self
-00009080: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f6c  .add_polygon(pol
-00009090: 792c 206c 6179 6572 3d6c 6179 6572 2920  y, layer=layer) 
-000090a0: 666f 7220 706f 6c79 2069 6e20 706f 696e  for poly in poin
-000090b0: 7473 5d0a 2020 2020 2020 2020 6966 206c  ts].        if l
-000090c0: 6179 6572 2069 7320 6e70 2e6e 616e 3a0a  ayer is np.nan:.
-000090d0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-000090e0: 7220 3d20 300a 0a20 2020 2020 2020 2069  r = 0..        i
-000090f0: 6620 706f 696e 7473 2e6e 6469 6d20 3d3d  f points.ndim ==
-00009100: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00009110: 2320 6164 6420 7369 6e67 6c65 2070 6f6c  # add single pol
-00009120: 7967 6f6e 2066 726f 6d20 706f 696e 7473  ygon from points
-00009130: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009140: 6c65 6e28 706f 696e 7473 5b30 5d29 203e  len(points[0]) >
-00009150: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00009160: 2020 2020 2320 436f 6e76 6572 7420 746f      # Convert to
-00009170: 2066 6f72 6d20 5b5b 312c 325d 2c5b 332c   form [[1,2],[3,
-00009180: 345d 2c5b 352c 365d 5d0a 2020 2020 2020  4],[5,6]].      
-00009190: 2020 2020 2020 2020 2020 706f 696e 7473            points
-000091a0: 203d 206e 702e 636f 6c75 6d6e 5f73 7461   = np.column_sta
-000091b0: 636b 2870 6f69 6e74 7329 0a20 2020 2020  ck(points).     
-000091c0: 2020 2020 2020 206c 6179 6572 2c20 6461         layer, da
-000091d0: 7461 7479 7065 203d 205f 7061 7273 655f  tatype = _parse_
-000091e0: 6c61 7965 7228 6c61 7965 7229 0a20 2020  layer(layer).   
-000091f0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00009200: 203d 2050 6f6c 7967 6f6e 2870 6f69 6e74   = Polygon(point
-00009210: 732c 2028 6c61 7965 722c 2064 6174 6174  s, (layer, datat
-00009220: 7970 6529 290a 2020 2020 2020 2020 2020  ype)).          
-00009230: 2020 7365 6c66 2e5f 6164 645f 706f 6c79    self._add_poly
-00009240: 676f 6e73 2870 6f6c 7967 6f6e 290a 2020  gons(polygon).  
-00009250: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009260: 2070 6f6c 7967 6f6e 0a20 2020 2020 2020   polygon.       
-00009270: 2065 6c69 6620 706f 696e 7473 2e6e 6469   elif points.ndi
-00009280: 6d20 3d3d 2033 3a0a 2020 2020 2020 2020  m == 3:.        
-00009290: 2020 2020 6c61 7965 722c 2064 6174 6174      layer, datat
-000092a0: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
-000092b0: 6572 286c 6179 6572 290a 2020 2020 2020  er(layer).      
-000092c0: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
-000092d0: 205b 506f 6c79 676f 6e28 7070 6f69 6e74   [Polygon(ppoint
-000092e0: 732c 2028 6c61 7965 722c 2064 6174 6174  s, (layer, datat
-000092f0: 7970 6529 2920 666f 7220 7070 6f69 6e74  ype)) for ppoint
-00009300: 7320 696e 2070 6f69 6e74 735d 0a20 2020  s in points].   
-00009310: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-00009320: 6464 5f70 6f6c 7967 6f6e 7328 2a70 6f6c  dd_polygons(*pol
-00009330: 7967 6f6e 7329 0a20 2020 2020 2020 2020  ygons).         
-00009340: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-00009350: 6e73 0a20 2020 2020 2020 2065 6c73 653a  ns.        else:
-00009360: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00009370: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00009380: 556e 6162 6c65 2074 6f20 6164 6420 7b70  Unable to add {p
-00009390: 6f69 6e74 732e 6e64 696d 7d2d 6469 6d65  oints.ndim}-dime
-000093a0: 6e73 696f 6e61 6c20 706f 696e 7473 206f  nsional points o
-000093b0: 626a 6563 7422 290a 0a20 2020 2064 6566  bject")..    def
-000093c0: 205f 6164 645f 706f 6c79 676f 6e73 2873   _add_polygons(s
-000093d0: 656c 662c 202a 706f 6c79 676f 6e73 3a20  elf, *polygons: 
-000093e0: 6c69 7374 5b50 6f6c 7967 6f6e 5d29 202d  list[Polygon]) -
-000093f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00009400: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
-00009410: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00009420: 5f63 656c 6c2e 6164 6428 2a70 6f6c 7967  _cell.add(*polyg
-00009430: 6f6e 7329 0a0a 2020 2020 6465 6620 636f  ons)..    def co
-00009440: 7079 2873 656c 6629 202d 3e20 436f 6d70  py(self) -> Comp
-00009450: 6f6e 656e 743a 0a20 2020 2020 2020 2072  onent:.        r
-00009460: 6574 7572 6e20 636f 7079 2873 656c 6629  eturn copy(self)
-00009470: 0a0a 2020 2020 6465 6620 6164 645f 7265  ..    def add_re
-00009480: 665f 636f 6e74 6169 6e65 7228 7365 6c66  f_container(self
-00009490: 2c20 636f 6d70 6f6e 656e 743a 2043 6f6d  , component: Com
-000094a0: 706f 6e65 6e74 2920 2d3e 2043 6f6d 706f  ponent) -> Compo
-000094b0: 6e65 6e74 5265 6665 7265 6e63 653a 0a20  nentReference:. 
-000094c0: 2020 2020 2020 2022 2222 4164 6420 7265         """Add re
-000094d0: 6665 7265 6e63 652c 2070 6f72 7473 2061  ference, ports a
-000094e0: 6e64 2063 6f70 795f 6368 696c 645f 696e  nd copy_child_in
-000094f0: 666f 2e22 2222 0a20 2020 2020 2020 2072  fo.""".        r
-00009500: 6566 203d 2073 656c 6620 3c3c 2063 6f6d  ef = self << com
-00009510: 706f 6e65 6e74 0a20 2020 2020 2020 2073  ponent.        s
-00009520: 656c 662e 6164 645f 706f 7274 7328 7265  elf.add_ports(re
-00009530: 662e 706f 7274 7329 0a20 2020 2020 2020  f.ports).       
-00009540: 2073 656c 662e 636f 7079 5f63 6869 6c64   self.copy_child
-00009550: 5f69 6e66 6f28 636f 6d70 6f6e 656e 7429  _info(component)
-00009560: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00009570: 7265 660a 0a20 2020 2064 6566 2063 6f70  ref..    def cop
-00009580: 795f 6368 696c 645f 696e 666f 2873 656c  y_child_info(sel
-00009590: 662c 2063 6f6d 706f 6e65 6e74 3a20 436f  f, component: Co
-000095a0: 6d70 6f6e 656e 7429 202d 3e20 4e6f 6e65  mponent) -> None
-000095b0: 3a0a 2020 2020 2020 2020 2222 2243 6f70  :.        """Cop
-000095c0: 7920 616e 6420 7365 7474 696e 6773 2069  y and settings i
-000095d0: 6e66 6f20 6672 6f6d 2063 6869 6c64 2063  nfo from child c
-000095e0: 6f6d 706f 6e65 6e74 2069 6e74 6f20 7061  omponent into pa
-000095f0: 7265 6e74 2e0a 0a20 2020 2020 2020 2050  rent...        P
-00009600: 6172 656e 7420 636f 6d70 6f6e 656e 7473  arent components
-00009610: 2063 616e 2061 6363 6573 7320 6368 696c   can access chil
-00009620: 6420 6365 6c6c 7320 7365 7474 696e 6773  d cells settings
-00009630: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00009640: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00009650: 6e73 7461 6e63 6528 636f 6d70 6f6e 656e  nstance(componen
-00009660: 742c 2043 6f6d 706f 6e65 6e74 207c 2043  t, Component | C
-00009670: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-00009680: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00009690: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000096a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000096b0: 2020 6622 7b74 7970 6528 636f 6d70 6f6e    f"{type(compon
-000096c0: 656e 7429 7d22 2022 6973 206e 6f74 2061  ent)}" "is not a
-000096d0: 2043 6f6d 706f 6e65 6e74 206f 7220 436f   Component or Co
-000096e0: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-000096f0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00009700: 0a20 2020 2020 2020 2073 656c 662e 5f67  .        self._g
-00009710: 6574 5f63 6869 6c64 5f6e 616d 6520 3d20  et_child_name = 
-00009720: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
-00009730: 662e 6368 696c 6420 3d20 636f 6d70 6f6e  f.child = compon
-00009740: 656e 740a 2020 2020 2020 2020 7365 6c66  ent.        self
-00009750: 2e69 6e66 6f2e 7570 6461 7465 2863 6f6d  .info.update(com
-00009760: 706f 6e65 6e74 2e69 6e66 6f29 0a20 2020  ponent.info).   
-00009770: 2020 2020 2073 656c 662e 7365 7474 696e       self.settin
-00009780: 6773 2e75 7064 6174 6528 636f 6d70 6f6e  gs.update(compon
-00009790: 656e 742e 7365 7474 696e 6773 290a 0a20  ent.settings).. 
-000097a0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-000097b0: 2064 6566 2073 697a 655f 696e 666f 2873   def size_info(s
-000097c0: 656c 6629 202d 3e20 5369 7a65 496e 666f  elf) -> SizeInfo
-000097d0: 3a0a 2020 2020 2020 2020 2222 2253 697a  :.        """Siz
-000097e0: 6520 696e 666f 206f 6620 7468 6520 636f  e info of the co
-000097f0: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
-00009800: 2020 2020 7265 7475 726e 2053 697a 6549      return SizeI
-00009810: 6e66 6f28 7365 6c66 2e62 626f 7829 0a0a  nfo(self.bbox)..
-00009820: 2020 2020 6465 6620 6765 745f 7365 7474      def get_sett
-00009830: 696e 6728 7365 6c66 2c20 7365 7474 696e  ing(self, settin
-00009840: 673a 2073 7472 2920 2d3e 2073 7472 207c  g: str) -> str |
-00009850: 2069 6e74 207c 2066 6c6f 6174 3a0a 2020   int | float:.  
-00009860: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
-00009870: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009880: 696e 666f 2e67 6574 2873 6574 7469 6e67  info.get(setting
-00009890: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-000098a0: 2073 656c 662e 7365 7474 696e 6773 2e66   self.settings.f
-000098b0: 756c 6c2e 6765 7428 7365 7474 696e 6729  ull.get(setting)
-000098c0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-000098d0: 7365 6c66 2e6d 6574 6164 6174 615f 6368  self.metadata_ch
-000098e0: 696c 642e 6765 7428 7365 7474 696e 6729  ild.get(setting)
-000098f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00009900: 6465 6620 6973 5f75 6e6c 6f63 6b65 6428  def is_unlocked(
-00009910: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00009920: 2020 2020 2020 2022 2222 5261 6973 6573         """Raises
-00009930: 2065 7272 6f72 2069 6620 436f 6d70 6f6e   error if Compon
-00009940: 656e 7420 6973 206c 6f63 6b65 642e 2222  ent is locked.""
-00009950: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
-00009960: 662e 5f6c 6f63 6b65 643a 0a20 2020 2020  f._locked:.     
-00009970: 2020 2020 2020 2072 6169 7365 204d 7574         raise Mut
-00009980: 6162 696c 6974 7945 7272 6f72 280a 2020  abilityError(.  
-00009990: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000099a0: 436f 6d70 6f6e 656e 7420 7b73 656c 662e  Component {self.
-000099b0: 6e61 6d65 2172 7d20 6361 6e6e 6f74 2062  name!r} cannot b
-000099c0: 6520 6d6f 6469 6669 6564 2061 7320 6974  e modified as it
-000099d0: 2773 2061 6c72 6561 6479 206f 6e20 6361  's already on ca
-000099e0: 6368 652e 2022 0a20 2020 2020 2020 2020  che. ".         
-000099f0: 2020 2020 2020 202b 206d 7574 6162 696c         + mutabil
-00009a00: 6974 795f 6572 726f 725f 6d65 7373 6167  ity_error_messag
-00009a10: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
-00009a20: 0a20 2020 2064 6566 205f 6164 6428 7365  .    def _add(se
-00009a30: 6c66 2c20 656c 656d 656e 7429 202d 3e20  lf, element) -> 
-00009a40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00009a50: 2241 6464 2061 206e 6577 2065 6c65 6d65  "Add a new eleme
-00009a60: 6e74 206f 7220 6c69 7374 206f 6620 656c  nt or list of el
-00009a70: 656d 656e 7473 2074 6f20 7468 6973 2043  ements to this C
-00009a80: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-00009a90: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00009aa0: 2020 2020 2065 6c65 6d65 6e74 3a20 506f       element: Po
-00009ab0: 6c79 676f 6e2c 2043 6f6d 706f 6e65 6e74  lygon, Component
-00009ac0: 5265 6665 7265 6e63 6520 6f72 2069 7465  Reference or ite
-00009ad0: 7261 626c 650a 2020 2020 2020 2020 2020  rable.          
-00009ae0: 2020 2020 2020 5468 6520 656c 656d 656e        The elemen
-00009af0: 7420 6f72 2069 7465 7261 626c 6520 6f66  t or iterable of
-00009b00: 2065 6c65 6d65 6e74 7320 746f 2062 6520   elements to be 
-00009b10: 696e 7365 7274 6564 2069 6e20 7468 6973  inserted in this
-00009b20: 2063 656c 6c2e 0a0a 2020 2020 2020 2020   cell...        
-00009b30: 5261 6973 6573 3a0a 2020 2020 2020 2020  Raises:.        
-00009b40: 2020 2020 4d75 7461 6269 6c69 7479 4572      MutabilityEr
-00009b50: 726f 723a 2069 6620 636f 6d70 6f6e 656e  ror: if componen
-00009b60: 7420 6973 206c 6f63 6b65 642e 0a20 2020  t is locked..   
-00009b70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00009b80: 2073 656c 662e 6973 5f75 6e6c 6f63 6b65   self.is_unlocke
-00009b90: 6428 290a 2020 2020 2020 2020 6966 2069  d().        if i
-00009ba0: 7369 6e73 7461 6e63 6528 656c 656d 656e  sinstance(elemen
-00009bb0: 742c 2043 6f6d 706f 6e65 6e74 5265 6665  t, ComponentRefe
-00009bc0: 7265 6e63 6529 3a0a 2020 2020 2020 2020  rence):.        
-00009bd0: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e61      self._cell.a
-00009be0: 6464 2865 6c65 6d65 6e74 2e5f 7265 6665  dd(element._refe
-00009bf0: 7265 6e63 6529 0a20 2020 2020 2020 2020  rence).         
-00009c00: 2020 2073 656c 662e 5f72 6566 6572 656e     self._referen
-00009c10: 6365 732e 6170 7065 6e64 2865 6c65 6d65  ces.append(eleme
-00009c20: 6e74 290a 2020 2020 2020 2020 656c 7365  nt).        else
-00009c30: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00009c40: 6c66 2e5f 6365 6c6c 2e61 6464 2865 6c65  lf._cell.add(ele
-00009c50: 6d65 6e74 290a 0a20 2020 2064 6566 2061  ment)..    def a
-00009c60: 6464 2873 656c 662c 2065 6c65 6d65 6e74  dd(self, element
-00009c70: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00009c80: 2020 2022 2222 4164 6420 6120 6e65 7720     """Add a new 
-00009c90: 656c 656d 656e 7420 6f72 206c 6973 7420  element or list 
-00009ca0: 6f66 2065 6c65 6d65 6e74 7320 746f 2074  of elements to t
-00009cb0: 6869 7320 436f 6d70 6f6e 656e 742e 0a0a  his Component...
-00009cc0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00009cd0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00009ce0: 743a 2050 6f6c 7967 6f6e 2c20 436f 6d70  t: Polygon, Comp
-00009cf0: 6f6e 656e 7452 6566 6572 656e 6365 206f  onentReference o
-00009d00: 7220 6974 6572 6162 6c65 0a20 2020 2020  r iterable.     
-00009d10: 2020 2020 2020 2020 2020 2054 6865 2065             The e
-00009d20: 6c65 6d65 6e74 206f 7220 6974 6572 6162  lement or iterab
-00009d30: 6c65 206f 6620 656c 656d 656e 7473 2074  le of elements t
-00009d40: 6f20 6265 2069 6e73 6572 7465 6420 696e  o be inserted in
-00009d50: 2074 6869 7320 6365 6c6c 2e0a 0a20 2020   this cell...   
-00009d60: 2020 2020 2052 6169 7365 733a 0a20 2020       Raises:.   
-00009d70: 2020 2020 2020 2020 204d 7574 6162 696c           Mutabil
-00009d80: 6974 7945 7272 6f72 3a20 6966 2063 6f6d  ityError: if com
-00009d90: 706f 6e65 6e74 2069 7320 6c6f 636b 6564  ponent is locked
-00009da0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00009db0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00009dc0: 6e63 6528 656c 656d 656e 742c 2043 6f6d  nce(element, Com
-00009dd0: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
-00009de0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00009df0: 6c66 2e5f 7265 6769 7374 6572 5f72 6566  lf._register_ref
-00009e00: 6572 656e 6365 2865 6c65 6d65 6e74 290a  erence(element).
-00009e10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009e20: 2e5f 6164 6428 656c 656d 656e 7429 0a20  ._add(element). 
-00009e30: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00009e40: 7374 616e 6365 2865 6c65 6d65 6e74 2c20  stance(element, 
-00009e50: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
-00009e60: 2020 2020 2020 2066 6f72 2073 7562 656c         for subel
-00009e70: 656d 656e 7420 696e 2065 6c65 6d65 6e74  ement in element
-00009e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009e90: 2020 7365 6c66 2e61 6464 2873 7562 656c    self.add(subel
-00009ea0: 656d 656e 7429 0a20 2020 2020 2020 2065  ement).        e
-00009eb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00009ec0: 2073 656c 662e 5f61 6464 2865 6c65 6d65   self._add(eleme
-00009ed0: 6e74 290a 0a20 2020 2064 6566 2061 6464  nt)..    def add
-00009ee0: 5f61 7272 6179 280a 2020 2020 2020 2020  _array(.        
-00009ef0: 7365 6c66 2c0a 2020 2020 2020 2020 636f  self,.        co
-00009f00: 6d70 6f6e 656e 743a 2043 6f6d 706f 6e65  mponent: Compone
-00009f10: 6e74 2c0a 2020 2020 2020 2020 636f 6c75  nt,.        colu
-00009f20: 6d6e 733a 2069 6e74 203d 2032 2c0a 2020  mns: int = 2,.  
-00009f30: 2020 2020 2020 726f 7773 3a20 696e 7420        rows: int 
-00009f40: 3d20 322c 0a20 2020 2020 2020 2073 7061  = 2,.        spa
-00009f50: 6369 6e67 3a20 7475 706c 655b 666c 6f61  cing: tuple[floa
-00009f60: 742c 2066 6c6f 6174 5d20 3d20 2831 3030  t, float] = (100
-00009f70: 2c20 3130 3029 2c0a 2020 2020 2020 2020  , 100),.        
-00009f80: 616c 6961 733a 2073 7472 207c 204e 6f6e  alias: str | Non
-00009f90: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
-00009fa0: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
-00009fb0: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
-00009fc0: 2222 4372 6561 7465 7320 6120 436f 6d70  ""Creates a Comp
-00009fd0: 6f6e 656e 7452 6566 6572 656e 6365 2072  onentReference r
-00009fe0: 6566 6572 656e 6365 2074 6f20 6120 436f  eference to a Co
-00009ff0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-0000a000: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000a010: 2020 2020 636f 6d70 6f6e 656e 743a 2054      component: T
-0000a020: 6865 2072 6566 6572 656e 6365 6420 636f  he referenced co
-0000a030: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-0000a040: 2020 2020 2063 6f6c 756d 6e73 3a20 4e75       columns: Nu
-0000a050: 6d62 6572 206f 6620 636f 6c75 6d6e 7320  mber of columns 
-0000a060: 696e 2074 6865 2061 7272 6179 2e0a 2020  in the array..  
-0000a070: 2020 2020 2020 2020 2020 726f 7773 3a20            rows: 
-0000a080: 4e75 6d62 6572 206f 6620 726f 7773 2069  Number of rows i
-0000a090: 6e20 7468 6520 6172 7261 792e 0a20 2020  n the array..   
-0000a0a0: 2020 2020 2020 2020 2073 7061 6369 6e67           spacing
-0000a0b0: 3a20 6172 7261 792d 6c69 6b65 5b32 5d20  : array-like[2] 
-0000a0c0: 6f66 2069 6e74 206f 7220 666c 6f61 742e  of int or float.
-0000a0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0e0: 2044 6973 7461 6e63 6520 6265 7477 6565   Distance betwee
-0000a0f0: 6e20 6164 6a61 6365 6e74 2063 6f6c 756d  n adjacent colum
-0000a100: 6e73 2061 6e64 2061 646a 6163 656e 7420  ns and adjacent 
-0000a110: 726f 7773 2e0a 2020 2020 2020 2020 2020  rows..          
-0000a120: 2020 616c 6961 733a 2073 7472 206f 7220    alias: str or 
-0000a130: 4e6f 6e65 2e20 416c 6961 7320 6f66 2074  None. Alias of t
-0000a140: 6865 2072 6566 6572 656e 6365 6420 436f  he referenced Co
-0000a150: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-0000a160: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0000a170: 2020 2020 2020 613a 2043 6f6d 706f 6e65        a: Compone
-0000a180: 6e74 5265 6665 7265 6e63 6520 636f 6e74  ntReference cont
-0000a190: 6169 6e69 6e67 2072 6566 6572 656e 6365  aining reference
-0000a1a0: 7320 746f 2074 6865 2043 6f6d 706f 6e65  s to the Compone
-0000a1b0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
-0000a1c0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0000a1d0: 7369 6e73 7461 6e63 6528 636f 6d70 6f6e  sinstance(compon
-0000a1e0: 656e 742c 2043 6f6d 706f 6e65 6e74 293a  ent, Component):
-0000a1f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000a200: 7365 2054 7970 6545 7272 6f72 2822 6164  se TypeError("ad
-0000a210: 645f 6172 7261 7928 2920 6e65 6564 7320  d_array() needs 
-0000a220: 6120 436f 6d70 6f6e 656e 7420 6f62 6a65  a Component obje
-0000a230: 6374 2e22 290a 2020 2020 2020 2020 7265  ct.").        re
-0000a240: 6620 3d20 436f 6d70 6f6e 656e 7452 6566  f = ComponentRef
-0000a250: 6572 656e 6365 280a 2020 2020 2020 2020  erence(.        
-0000a260: 2020 2020 636f 6d70 6f6e 656e 743d 636f      component=co
-0000a270: 6d70 6f6e 656e 742c 0a20 2020 2020 2020  mponent,.       
-0000a280: 2020 2020 2063 6f6c 756d 6e73 3d69 6e74       columns=int
-0000a290: 2872 6f75 6e64 2863 6f6c 756d 6e73 2929  (round(columns))
-0000a2a0: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
-0000a2b0: 7773 3d69 6e74 2872 6f75 6e64 2872 6f77  ws=int(round(row
-0000a2c0: 7329 292c 0a20 2020 2020 2020 2020 2020  s)),.           
-0000a2d0: 2073 7061 6369 6e67 3d73 7061 6369 6e67   spacing=spacing
-0000a2e0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-0000a2f0: 2020 2020 7265 662e 6e61 6d65 203d 204e      ref.name = N
-0000a300: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-0000a310: 2e5f 6164 6428 7265 6629 0a20 2020 2020  ._add(ref).     
-0000a320: 2020 2073 656c 662e 5f72 6567 6973 7465     self._registe
-0000a330: 725f 7265 6665 7265 6e63 6528 7265 6665  r_reference(refe
-0000a340: 7265 6e63 653d 7265 662c 2061 6c69 6173  rence=ref, alias
-0000a350: 3d61 6c69 6173 290a 2020 2020 2020 2020  =alias).        
-0000a360: 7265 7475 726e 2072 6566 0a0a 2020 2020  return ref..    
-0000a370: 6465 6620 6469 7374 7269 6275 7465 280a  def distribute(.
-0000a380: 2020 2020 2020 2020 7365 6c66 2c20 656c          self, el
-0000a390: 656d 656e 7473 3d22 616c 6c22 2c20 6469  ements="all", di
-0000a3a0: 7265 6374 696f 6e3d 2278 222c 2073 7061  rection="x", spa
-0000a3b0: 6369 6e67 3d31 3030 2c20 7365 7061 7261  cing=100, separa
-0000a3c0: 7469 6f6e 3d54 7275 652c 2065 6467 653d  tion=True, edge=
-0000a3d0: 2263 656e 7465 7222 0a20 2020 2029 3a0a  "center".    ):.
-0000a3e0: 2020 2020 2020 2020 2222 2244 6973 7472          """Distr
-0000a3f0: 6962 7574 6573 2074 6865 2073 7065 6369  ibutes the speci
-0000a400: 6669 6564 2065 6c65 6d65 6e74 7320 696e  fied elements in
-0000a410: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
-0000a420: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0000a430: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
-0000a440: 6e74 7320 3a20 6172 7261 792d 6c69 6b65  nts : array-like
-0000a450: 206f 6620 6f62 6a65 6374 7320 6f72 2027   of objects or '
-0000a460: 616c 6c27 0a20 2020 2020 2020 2020 2020  all'.           
-0000a470: 2020 2020 2045 6c65 6d65 6e74 7320 746f       Elements to
-0000a480: 2064 6973 7472 6962 7574 652e 0a20 2020   distribute..   
-0000a490: 2020 2020 2020 2020 2064 6972 6563 7469           directi
-0000a4a0: 6f6e 203a 207b 2778 272c 2027 7927 7d0a  on : {'x', 'y'}.
-0000a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4c0: 4469 7265 6374 696f 6e20 6f66 2064 6973  Direction of dis
-0000a4d0: 7472 6962 7574 696f 6e3b 2065 6974 6865  tribution; eithe
-0000a4e0: 7220 6120 6c69 6e65 2069 6e20 7468 6520  r a line in the 
-0000a4f0: 782d 6469 7265 6374 696f 6e20 6f72 0a20  x-direction or. 
-0000a500: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-0000a510: 2d64 6972 6563 7469 6f6e 2e0a 2020 2020  -direction..    
-0000a520: 2020 2020 2020 2020 7370 6163 696e 6720          spacing 
-0000a530: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2044                 D
-0000a550: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
-0000a560: 656c 656d 656e 7473 2e0a 2020 2020 2020  elements..      
-0000a570: 2020 2020 2020 7365 7061 7261 7469 6f6e        separation
-0000a580: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
-0000a590: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0000a5a0: 2067 7561 7261 6e74 6565 7320 656c 656d   guarantees elem
-0000a5b0: 656e 7473 2061 7265 2073 6570 6172 6174  ents are separat
-0000a5c0: 6564 2077 6974 6820 6120 6669 7865 6420  ed with a fixed 
-0000a5d0: 7370 6163 696e 670a 2020 2020 2020 2020  spacing.        
-0000a5e0: 2020 2020 2020 2020 6265 7477 6565 6e3b          between;
-0000a5f0: 2069 6620 2046 616c 7365 2c20 656c 656d   if  False, elem
-0000a600: 656e 7473 2061 7265 2073 7061 6365 6420  ents are spaced 
-0000a610: 6576 656e 6c79 2061 6c6f 6e67 2061 2067  evenly along a g
-0000a620: 7269 642e 0a20 2020 2020 2020 2020 2020  rid..           
-0000a630: 2065 6467 6520 3a20 7b27 7827 2c20 2778   edge : {'x', 'x
-0000a640: 6d69 6e27 2c20 2778 6d61 7827 2c20 2779  min', 'xmax', 'y
-0000a650: 272c 2027 796d 696e 272c 2027 796d 6178  ', 'ymin', 'ymax
-0000a660: 277d 0a20 2020 2020 2020 2020 2020 2020  '}.             
-0000a670: 2020 2057 6869 6368 2065 6467 6520 746f     Which edge to
-0000a680: 2070 6572 666f 726d 2074 6865 2064 6973   perform the dis
-0000a690: 7472 6962 7574 696f 6e20 616c 6f6e 6720  tribution along 
-0000a6a0: 2875 6e75 7365 6420 6966 0a20 2020 2020  (unused if.     
-0000a6b0: 2020 2020 2020 2020 2020 2073 6570 6172             separ
-0000a6c0: 6174 696f 6e20 3d3d 2054 7275 6529 0a0a  ation == True)..
-0000a6d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000a6e0: 2020 2020 6966 2065 6c65 6d65 6e74 7320      if elements 
-0000a6f0: 3d3d 2022 616c 6c22 3a0a 2020 2020 2020  == "all":.      
-0000a700: 2020 2020 2020 656c 656d 656e 7473 203d        elements =
-0000a710: 2073 656c 662e 706f 6c79 676f 6e73 202b   self.polygons +
-0000a720: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
-0000a730: 0a20 2020 2020 2020 205f 6469 7374 7269  .        _distri
-0000a740: 6275 7465 280a 2020 2020 2020 2020 2020  bute(.          
-0000a750: 2020 656c 656d 656e 7473 3d65 6c65 6d65    elements=eleme
-0000a760: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
-0000a770: 2064 6972 6563 7469 6f6e 3d64 6972 6563   direction=direc
-0000a780: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-0000a790: 2020 7370 6163 696e 673d 7370 6163 696e    spacing=spacin
-0000a7a0: 672c 0a20 2020 2020 2020 2020 2020 2073  g,.            s
-0000a7b0: 6570 6172 6174 696f 6e3d 7365 7061 7261  eparation=separa
-0000a7c0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-0000a7d0: 2020 6564 6765 3d65 6467 652c 0a20 2020    edge=edge,.   
-0000a7e0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0000a7f0: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
-0000a800: 6465 6620 616c 6967 6e28 7365 6c66 2c20  def align(self, 
-0000a810: 656c 656d 656e 7473 3d22 616c 6c22 2c20  elements="all", 
-0000a820: 616c 6967 6e6d 656e 743d 2279 6d61 7822  alignment="ymax"
-0000a830: 293a 0a20 2020 2020 2020 2022 2222 416c  ):.        """Al
-0000a840: 6967 6e20 656c 656d 656e 7473 2069 6e20  ign elements in 
-0000a850: 7468 6520 436f 6d70 6f6e 656e 742e 0a0a  the Component...
-0000a860: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000a870: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-0000a880: 7473 203a 2061 7272 6179 2d6c 696b 6520  ts : array-like 
-0000a890: 6f66 206f 626a 6563 7473 2c20 6f72 2027  of objects, or '
-0000a8a0: 616c 6c27 0a20 2020 2020 2020 2020 2020  all'.           
-0000a8b0: 2020 2020 2045 6c65 6d65 6e74 7320 696e       Elements in
-0000a8c0: 2074 6865 2043 6f6d 706f 6e65 6e74 2074   the Component t
-0000a8d0: 6f20 616c 6967 6e2e 0a20 2020 2020 2020  o align..       
-0000a8e0: 2020 2020 2061 6c69 676e 6d65 6e74 203a       alignment :
-0000a8f0: 207b 2778 272c 2027 7927 2c20 2778 6d69   {'x', 'y', 'xmi
-0000a900: 6e27 2c20 2778 6d61 7827 2c20 2779 6d69  n', 'xmax', 'ymi
-0000a910: 6e27 2c20 2779 6d61 7827 7d0a 2020 2020  n', 'ymax'}.    
-0000a920: 2020 2020 2020 2020 2020 2020 5768 6963              Whic
-0000a930: 6820 6564 6765 2074 6f20 616c 6967 6e20  h edge to align 
-0000a940: 616c 6f6e 6720 2865 2e67 2e20 2779 6d61  along (e.g. 'yma
-0000a950: 7827 2077 696c 6c20 6d6f 7665 2074 6865  x' will move the
-0000a960: 2065 6c65 6d65 6e74 7320 7375 6368 0a20   elements such. 
-0000a970: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000a980: 6861 7420 616c 6c20 6f66 2074 6865 6972  hat all of their
-0000a990: 2074 6f70 6d6f 7374 2070 6f69 6e74 7320   topmost points 
-0000a9a0: 6172 6520 616c 6967 6e65 6429 2e0a 2020  are aligned)..  
-0000a9b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a9c0: 2020 6966 2065 6c65 6d65 6e74 7320 3d3d    if elements ==
-0000a9d0: 2022 616c 6c22 3a0a 2020 2020 2020 2020   "all":.        
-0000a9e0: 2020 2020 656c 656d 656e 7473 203d 2073      elements = s
-0000a9f0: 656c 662e 706f 6c79 676f 6e73 202b 2073  elf.polygons + s
-0000aa00: 656c 662e 7265 6665 7265 6e63 6573 0a20  elf.references. 
-0000aa10: 2020 2020 2020 205f 616c 6967 6e28 656c         _align(el
-0000aa20: 656d 656e 7473 2c20 616c 6967 6e6d 656e  ements, alignmen
-0000aa30: 743d 616c 6967 6e6d 656e 7429 0a20 2020  t=alignment).   
-0000aa40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000aa50: 0a0a 2020 2020 6465 6620 666c 6174 7465  ..    def flatte
-0000aa60: 6e28 7365 6c66 2c20 7369 6e67 6c65 5f6c  n(self, single_l
-0000aa70: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
-0000aa80: 7c20 4e6f 6e65 203d 204e 6f6e 6529 3a0a  | None = None):.
-0000aa90: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000aaa0: 6e73 2061 2066 6c61 7474 656e 6564 2063  ns a flattened c
-0000aab0: 6f70 7920 6f66 2074 6865 2063 6f6d 706f  opy of the compo
-0000aac0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2046  nent...        F
-0000aad0: 6c61 7474 656e 7320 7468 6520 6869 6572  lattens the hier
-0000aae0: 6172 6368 7920 6f66 2074 6865 2043 6f6d  archy of the Com
-0000aaf0: 706f 6e65 6e74 2073 7563 6820 7468 6174  ponent such that
-0000ab00: 2074 6865 7265 2061 7265 206e 6f20 6c6f   there are no lo
-0000ab10: 6e67 6572 0a20 2020 2020 2020 2061 6e79  nger.        any
-0000ab20: 2072 6566 6572 656e 6365 7320 746f 206f   references to o
-0000ab30: 7468 6572 2043 6f6d 706f 6e65 6e74 732e  ther Components.
-0000ab40: 2041 6c6c 2070 6f6c 7967 6f6e 7320 616e   All polygons an
-0000ab50: 6420 6c61 6265 6c73 2066 726f 6d0a 2020  d labels from.  
-0000ab60: 2020 2020 2020 756e 6465 726c 7969 6e67        underlying
-0000ab70: 2072 6566 6572 656e 6365 7320 6172 6520   references are 
-0000ab80: 636f 7069 6564 2061 6e64 2070 6c61 6365  copied and place
-0000ab90: 6420 696e 2074 6865 2074 6f70 2d6c 6576  d in the top-lev
-0000aba0: 656c 2043 6f6d 706f 6e65 6e74 2e0a 2020  el Component..  
-0000abb0: 2020 2020 2020 4966 2073 696e 676c 655f        If single_
-0000abc0: 6c61 7965 7220 6973 2073 7065 6369 6669  layer is specifi
-0000abd0: 6564 2c20 616c 6c20 706f 6c79 676f 6e73  ed, all polygons
-0000abe0: 2061 7265 206d 6f76 6564 2074 6f20 7468   are moved to th
-0000abf0: 6174 206c 6179 6572 2e0a 0a20 2020 2020  at layer...     
-0000ac00: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000ac10: 2020 2020 2073 696e 676c 655f 6c61 7965       single_laye
-0000ac20: 723a 206d 6f76 6520 616c 6c20 706f 6c79  r: move all poly
-0000ac30: 676f 6e73 2061 7265 206d 6f76 6564 2074  gons are moved t
-0000ac40: 6f20 7468 6520 7370 6563 6966 6965 6420  o the specified 
-0000ac50: 286f 7074 696f 6e61 6c29 2e0a 2020 2020  (optional)..    
-0000ac60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ac70: 636f 6d70 6f6e 656e 745f 666c 6174 203d  component_flat =
-0000ac80: 2043 6f6d 706f 6e65 6e74 2829 0a0a 2020   Component()..  
-0000ac90: 2020 2020 2020 5f63 656c 6c20 3d20 7365        _cell = se
-0000aca0: 6c66 2e5f 6365 6c6c 2e63 6f70 7928 6e61  lf._cell.copy(na
-0000acb0: 6d65 3d63 6f6d 706f 6e65 6e74 5f66 6c61  me=component_fla
-0000acc0: 742e 6e61 6d65 290a 2020 2020 2020 2020  t.name).        
-0000acd0: 5f63 656c 6c20 3d20 5f63 656c 6c2e 666c  _cell = _cell.fl
-0000ace0: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
-0000acf0: 636f 6d70 6f6e 656e 745f 666c 6174 2e5f  component_flat._
-0000ad00: 6365 6c6c 203d 205f 6365 6c6c 0a20 2020  cell = _cell.   
-0000ad10: 2020 2020 2069 6620 7369 6e67 6c65 5f6c       if single_l
-0000ad20: 6179 6572 2069 7320 6e6f 7420 4e6f 6e65  ayer is not None
-0000ad30: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
-0000ad40: 6f6d 2067 6473 6661 6374 6f72 7920 696d  om gdsfactory im
-0000ad50: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
-0000ad60: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0000ad70: 722c 2064 6174 6174 7970 6520 3d20 6765  r, datatype = ge
-0000ad80: 745f 6c61 7965 7228 7369 6e67 6c65 5f6c  t_layer(single_l
-0000ad90: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-0000ada0: 2020 666f 7220 706f 6c79 676f 6e20 696e    for polygon in
-0000adb0: 205f 6365 6c6c 2e70 6f6c 7967 6f6e 733a   _cell.polygons:
-0000adc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000add0: 2070 6f6c 7967 6f6e 2e6c 6179 6572 203d   polygon.layer =
-0000ade0: 206c 6179 6572 0a20 2020 2020 2020 2020   layer.         
-0000adf0: 2020 2020 2020 2070 6f6c 7967 6f6e 2e64         polygon.d
-0000ae00: 6174 6174 7970 6520 3d20 6461 7461 7479  atatype = dataty
-0000ae10: 7065 0a20 2020 2020 2020 2020 2020 2066  pe.            f
-0000ae20: 6f72 2070 6174 6820 696e 205f 6365 6c6c  or path in _cell
-0000ae30: 2e70 6174 6873 3a0a 2020 2020 2020 2020  .paths:.        
-0000ae40: 2020 2020 2020 2020 7061 7468 2e73 6574          path.set
-0000ae50: 5f6c 6179 6572 7328 6c61 7965 7229 0a20  _layers(layer). 
-0000ae60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ae70: 6174 682e 7365 745f 6461 7461 7479 7065  ath.set_datatype
-0000ae80: 7328 6461 7461 7479 7065 290a 0a20 2020  s(datatype)..   
-0000ae90: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
-0000aea0: 6c61 742e 696e 666f 203d 2073 656c 662e  lat.info = self.
-0000aeb0: 696e 666f 2e63 6f70 7928 290a 2020 2020  info.copy().    
-0000aec0: 2020 2020 636f 6d70 6f6e 656e 745f 666c      component_fl
-0000aed0: 6174 2e61 6464 5f70 6f72 7473 2873 656c  at.add_ports(sel
-0000aee0: 662e 706f 7274 7329 0a20 2020 2020 2020  f.ports).       
-0000aef0: 2072 6574 7572 6e20 636f 6d70 6f6e 656e   return componen
-0000af00: 745f 666c 6174 0a0a 2020 2020 6465 6620  t_flat..    def 
-0000af10: 666c 6174 7465 6e5f 7265 6665 7265 6e63  flatten_referenc
-0000af20: 6528 7365 6c66 2c20 7265 663a 2043 6f6d  e(self, ref: Com
-0000af30: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
-0000af40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000af50: 2020 2222 2246 726f 6d20 6578 6973 7469    """From existi
-0000af60: 6e67 2063 656c 6c20 7265 706c 6163 6573  ng cell replaces
-0000af70: 2072 6566 6572 656e 6365 2077 6974 6820   reference with 
-0000af80: 6120 666c 6174 7465 6e20 7265 6665 7265  a flatten refere
-0000af90: 6e63 6520 5c0a 2020 2020 2020 2020 7768  nce \.        wh
-0000afa0: 6963 6820 6861 7320 7468 6520 7472 616e  ich has the tran
-0000afb0: 7366 6f72 6d61 7469 6f6e 7320 616c 7265  sformations alre
-0000afc0: 6164 7920 6170 706c 6965 642e 0a0a 2020  ady applied...  
-0000afd0: 2020 2020 2020 5472 616e 7366 6f72 6d65        Transforme
-0000afe0: 6420 7265 6665 7265 6e63 6520 6b65 6570  d reference keep
-0000aff0: 7320 7468 6520 6f72 6967 696e 616c 206e  s the original n
-0000b000: 616d 652e 0a0a 2020 2020 2020 2020 4172  ame...        Ar
-0000b010: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000b020: 7265 663a 2074 6865 2072 6566 6572 656e  ref: the referen
-0000b030: 6365 2074 6f20 666c 6174 7465 6e20 696e  ce to flatten in
-0000b040: 746f 2061 206e 6577 2063 656c 6c2e 0a0a  to a new cell...
-0000b050: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000b060: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-0000b070: 6f72 792e 6675 6e63 7469 6f6e 7320 696d  ory.functions im
-0000b080: 706f 7274 2074 7261 6e73 666f 726d 6564  port transformed
-0000b090: 0a0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-0000b0a0: 656d 6f76 6528 7265 6629 0a20 2020 2020  emove(ref).     
-0000b0b0: 2020 206e 6577 5f63 6f6d 706f 6e65 6e74     new_component
-0000b0c0: 203d 2074 7261 6e73 666f 726d 6564 2872   = transformed(r
-0000b0d0: 6566 2c20 6465 636f 7261 746f 723d 4e6f  ef, decorator=No
-0000b0e0: 6e65 290a 2020 2020 2020 2020 7365 6c66  ne).        self
-0000b0f0: 2e61 6464 5f72 6566 286e 6577 5f63 6f6d  .add_ref(new_com
-0000b100: 706f 6e65 6e74 2c20 616c 6961 733d 7265  ponent, alias=re
-0000b110: 662e 6e61 6d65 290a 0a20 2020 2064 6566  f.name)..    def
-0000b120: 2061 6464 5f72 6566 280a 2020 2020 2020   add_ref(.      
-0000b130: 2020 7365 6c66 2c20 636f 6d70 6f6e 656e    self, componen
-0000b140: 743a 2043 6f6d 706f 6e65 6e74 2c20 616c  t: Component, al
-0000b150: 6961 733a 2073 7472 207c 204e 6f6e 6520  ias: str | None 
-0000b160: 3d20 4e6f 6e65 2c20 2a2a 6b77 6172 6773  = None, **kwargs
-0000b170: 0a20 2020 2029 202d 3e20 436f 6d70 6f6e  .    ) -> Compon
-0000b180: 656e 7452 6566 6572 656e 6365 3a0a 2020  entReference:.  
-0000b190: 2020 2020 2020 2222 2241 6464 2043 6f6d        """Add Com
-0000b1a0: 706f 6e65 6e74 5265 6665 7265 6e63 6520  ponentReference 
-0000b1b0: 746f 2074 6865 2063 7572 7265 6e74 2043  to the current C
-0000b1c0: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-0000b1d0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000b1e0: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
-0000b1f0: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
-0000b200: 2020 2020 2020 2061 6c69 6173 3a20 6e61         alias: na
-0000b210: 6d65 645f 7265 6665 7265 6e63 6573 2e0a  med_references..
-0000b220: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
-0000b230: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000b240: 2020 2063 6f6c 756d 6e73 3a20 4e75 6d62     columns: Numb
-0000b250: 6572 206f 6620 636f 6c75 6d6e 7320 696e  er of columns in
-0000b260: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
-0000b270: 2020 2020 2020 2020 726f 7773 3a20 4e75          rows: Nu
-0000b280: 6d62 6572 206f 6620 726f 7773 2069 6e20  mber of rows in 
-0000b290: 7468 6520 6172 7261 792e 0a20 2020 2020  the array..     
-0000b2a0: 2020 2020 2020 2073 7061 6369 6e67 3a20         spacing: 
-0000b2b0: 4469 7374 616e 6365 7320 6265 7477 6565  Distances betwee
-0000b2c0: 6e20 6164 6a61 6365 6e74 2063 6f6c 756d  n adjacent colum
-0000b2d0: 6e73 2061 6e64 2061 646a 6163 656e 7420  ns and adjacent 
-0000b2e0: 726f 7773 2e0a 2020 2020 2020 2020 2020  rows..          
-0000b2f0: 2020 6f72 6967 696e 3a20 6172 7261 792d    origin: array-
-0000b300: 6c69 6b65 5b32 5d20 6f66 2069 6e74 206f  like[2] of int o
-0000b310: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0000b320: 2020 2020 2020 2020 506f 7369 7469 6f6e          Position
-0000b330: 2077 6865 7265 2074 6865 2063 656c 6c20   where the cell 
-0000b340: 6973 2069 6e73 6572 7465 642e 0a20 2020  is inserted..   
-0000b350: 2020 2020 2020 2020 2072 6f74 6174 696f           rotatio
-0000b360: 6e20 3a20 696e 7420 6f72 2066 6c6f 6174  n : int or float
-0000b370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b380: 2041 6e67 6c65 206f 6620 726f 7461 7469   Angle of rotati
-0000b390: 6f6e 206f 6620 7468 6520 7265 6665 7265  on of the refere
-0000b3a0: 6e63 6520 2869 6e20 6064 6567 7265 6573  nce (in `degrees
-0000b3b0: 6029 2e0a 2020 2020 2020 2020 2020 2020  `)..            
-0000b3c0: 6d61 676e 6966 6963 6174 696f 6e20 3a20  magnification : 
-0000b3d0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-0000b3e0: 2020 2020 2020 2020 2020 2020 204d 6167               Mag
-0000b3f0: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
-0000b400: 7220 666f 7220 7468 6520 7265 6665 7265  r for the refere
-0000b410: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
-0000b420: 2078 5f72 6566 6c65 6374 696f 6e20 3a20   x_reflection : 
-0000b430: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-0000b440: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0000b450: 6520 7265 6665 7265 6e63 6520 6973 2072  e reference is r
-0000b460: 6566 6c65 6374 6564 2070 6172 616c 6c65  eflected paralle
-0000b470: 6c20 746f 2074 6865 2078 2064 6972 6563  l to the x direc
-0000b480: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0000b490: 2020 2020 2062 6566 6f72 6520 6265 696e       before bein
-0000b4a0: 6720 726f 7461 7465 642e 0a20 2020 2020  g rotated..     
-0000b4b0: 2020 2020 2020 206e 616d 6520 3a20 7374         name : st
-0000b4c0: 7220 286f 7074 696f 6e61 6c29 0a20 2020  r (optional).   
-0000b4d0: 2020 2020 2020 2020 2020 2020 2041 206e               A n
-0000b4e0: 616d 6520 666f 7220 7468 6520 7265 6665  ame for the refe
-0000b4f0: 7265 6e63 6520 2869 6620 7072 6f76 6964  rence (if provid
-0000b500: 6564 292e 0a0a 2020 2020 2020 2020 2222  ed)...        ""
-0000b510: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0000b520: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
-0000b530: 6f6e 656e 742c 2043 6f6d 706f 6e65 6e74  onent, Component
-0000b540: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000b550: 6169 7365 2054 7970 6545 7272 6f72 2866  aise TypeError(f
-0000b560: 2274 7970 6520 3d20 7b74 7970 6528 436f  "type = {type(Co
-0000b570: 6d70 6f6e 656e 7429 7d20 6e65 6564 7320  mponent)} needs 
-0000b580: 746f 2062 6520 6120 436f 6d70 6f6e 656e  to be a Componen
-0000b590: 742e 2229 0a20 2020 2020 2020 2072 6566  t.").        ref
-0000b5a0: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-0000b5b0: 7265 6e63 6528 636f 6d70 6f6e 656e 742c  rence(component,
-0000b5c0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-0000b5d0: 2020 2073 656c 662e 5f61 6464 2872 6566     self._add(ref
-0000b5e0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0000b5f0: 7265 6769 7374 6572 5f72 6566 6572 656e  register_referen
-0000b600: 6365 2872 6566 6572 656e 6365 3d72 6566  ce(reference=ref
-0000b610: 2c20 616c 6961 733d 616c 6961 7329 0a20  , alias=alias). 
-0000b620: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000b630: 660a 0a20 2020 2064 6566 205f 7265 6769  f..    def _regi
-0000b640: 7374 6572 5f72 6566 6572 656e 6365 280a  ster_reference(.
-0000b650: 2020 2020 2020 2020 7365 6c66 2c20 7265          self, re
-0000b660: 6665 7265 6e63 653a 2043 6f6d 706f 6e65  ference: Compone
-0000b670: 6e74 5265 6665 7265 6e63 652c 2061 6c69  ntReference, ali
-0000b680: 6173 3a20 7374 7220 7c20 4e6f 6e65 203d  as: str | None =
-0000b690: 204e 6f6e 650a 2020 2020 2920 2d3e 204e   None.    ) -> N
-0000b6a0: 6f6e 653a 0a20 2020 2020 2020 2063 6f6d  one:.        com
-0000b6b0: 706f 6e65 6e74 203d 2072 6566 6572 656e  ponent = referen
-0000b6c0: 6365 2e70 6172 656e 740a 2020 2020 2020  ce.parent.      
-0000b6d0: 2020 7265 6665 7265 6e63 652e 6f77 6e65    reference.owne
-0000b6e0: 7220 3d20 7365 6c66 0a0a 2020 2020 2020  r = self..      
-0000b6f0: 2020 6966 2061 6c69 6173 2069 7320 4e6f    if alias is No
-0000b700: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000b710: 6966 2072 6566 6572 656e 6365 2e6e 616d  if reference.nam
-0000b720: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0000b730: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000b740: 6c69 6173 203d 2072 6566 6572 656e 6365  lias = reference
-0000b750: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
-0000b760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b770: 2020 2020 2020 2020 7072 6566 6978 203d          prefix =
-0000b780: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000b790: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-0000b7a0: 2e73 6574 7469 6e67 732e 6675 6e63 7469  .settings.functi
-0000b7b0: 6f6e 5f6e 616d 650a 2020 2020 2020 2020  on_name.        
-0000b7c0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0000b7d0: 6173 6174 7472 2863 6f6d 706f 6e65 6e74  asattr(component
-0000b7e0: 2c20 2273 6574 7469 6e67 7322 290a 2020  , "settings").  
-0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b800: 2020 616e 6420 6861 7361 7474 7228 636f    and hasattr(co
-0000b810: 6d70 6f6e 656e 742e 7365 7474 696e 6773  mponent.settings
-0000b820: 2c20 2266 756e 6374 696f 6e5f 6e61 6d65  , "function_name
-0000b830: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000b840: 2020 2020 2020 2065 6c73 6520 636f 6d70         else comp
-0000b850: 6f6e 656e 742e 6e61 6d65 0a20 2020 2020  onent.name.     
-0000b860: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000b870: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b880: 662e 5f72 6566 6572 656e 6365 5f6e 616d  f._reference_nam
-0000b890: 6573 5f63 6f75 6e74 6572 2e75 7064 6174  es_counter.updat
-0000b8a0: 6528 7b70 7265 6669 783a 2031 7d29 0a20  e({prefix: 1}). 
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000b8c0: 6c69 6173 203d 2066 227b 7072 6566 6978  lias = f"{prefix
-0000b8d0: 7d5f 7b73 656c 662e 5f72 6566 6572 656e  }_{self._referen
-0000b8e0: 6365 5f6e 616d 6573 5f63 6f75 6e74 6572  ce_names_counter
-0000b8f0: 5b70 7265 6669 785d 7d22 0a0a 2020 2020  [prefix]}"..    
-0000b900: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-0000b910: 6520 616c 6961 7320 696e 2073 656c 662e  e alias in self.
-0000b920: 5f6e 616d 6564 5f72 6566 6572 656e 6365  _named_reference
-0000b930: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000b940: 2020 2020 2020 2073 656c 662e 5f72 6566         self._ref
-0000b950: 6572 656e 6365 5f6e 616d 6573 5f63 6f75  erence_names_cou
-0000b960: 6e74 6572 2e75 7064 6174 6528 7b70 7265  nter.update({pre
-0000b970: 6669 783a 2031 7d29 0a20 2020 2020 2020  fix: 1}).       
-0000b980: 2020 2020 2020 2020 2020 2020 2061 6c69               ali
-0000b990: 6173 203d 2066 227b 7072 6566 6978 7d5f  as = f"{prefix}_
-0000b9a0: 7b73 656c 662e 5f72 6566 6572 656e 6365  {self._reference
-0000b9b0: 5f6e 616d 6573 5f63 6f75 6e74 6572 5b70  _names_counter[p
-0000b9c0: 7265 6669 785d 7d22 0a0a 2020 2020 2020  refix]}"..      
-0000b9d0: 2020 7265 6665 7265 6e63 652e 6e61 6d65    reference.name
-0000b9e0: 203d 2061 6c69 6173 0a20 2020 2020 2020   = alias.       
-0000b9f0: 2073 656c 662e 5f6e 616d 6564 5f72 6566   self._named_ref
-0000ba00: 6572 656e 6365 735b 616c 6961 735d 203d  erences[alias] =
-0000ba10: 2072 6566 6572 656e 6365 0a0a 2020 2020   reference..    
-0000ba20: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-0000ba30: 6620 6c61 7965 7273 2873 656c 6629 202d  f layers(self) -
-0000ba40: 3e20 7365 745b 7475 706c 655b 696e 742c  > set[tuple[int,
-0000ba50: 2069 6e74 5d5d 3a0a 2020 2020 2020 2020   int]]:.        
-0000ba60: 2222 2252 6574 7572 6e73 2061 2073 6574  """Returns a set
-0000ba70: 206f 6620 7468 6520 4c61 7965 7273 2069   of the Layers i
-0000ba80: 6e20 7468 6520 436f 6d70 6f6e 656e 742e  n the Component.
-0000ba90: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000baa0: 726e 2073 656c 662e 6765 745f 6c61 7965  rn self.get_laye
-0000bab0: 7273 2829 0a0a 2020 2020 6465 6620 6765  rs()..    def ge
-0000bac0: 745f 6c61 7965 7273 2873 656c 6629 202d  t_layers(self) -
-0000bad0: 3e20 7365 745b 7475 706c 655b 696e 742c  > set[tuple[int,
-0000bae0: 2069 6e74 5d5d 3a0a 2020 2020 2020 2020   int]]:.        
-0000baf0: 2222 2252 6574 7572 6e20 6120 7365 7420  """Return a set 
-0000bb00: 6f66 2028 6c61 7965 722c 2064 6174 6174  of (layer, datat
-0000bb10: 7970 6529 2e0a 0a20 2020 2020 2020 202e  ype)...        .
-0000bb20: 2e20 636f 6465 203a 3a0a 0a20 2020 2020  . code ::..     
-0000bb30: 2020 2020 2020 2069 6d70 6f72 7420 6764         import gd
-0000bb40: 7366 6163 746f 7279 2061 7320 6766 0a20  sfactory as gf. 
-0000bb50: 2020 2020 2020 2020 2020 2067 662e 636f             gf.co
-0000bb60: 6d70 6f6e 656e 7473 2e73 7472 6169 6768  mponents.straigh
-0000bb70: 7428 292e 6765 745f 6c61 7965 7273 2829  t().get_layers()
-0000bb80: 203d 3d20 7b28 312c 2030 292c 2028 3131   == {(1, 0), (11
-0000bb90: 312c 2030 297d 0a20 2020 2020 2020 2022  1, 0)}.        "
-0000bba0: 2222 0a20 2020 2020 2020 2070 6f6c 7967  "".        polyg
-0000bbb0: 6f6e 7320 3d20 7365 6c66 2e5f 6365 6c6c  ons = self._cell
-0000bbc0: 2e67 6574 5f70 6f6c 7967 6f6e 7328 6465  .get_polygons(de
-0000bbd0: 7074 683d 4e6f 6e65 290a 2020 2020 2020  pth=None).      
-0000bbe0: 2020 7265 7475 726e 207b 2870 6f6c 7967    return {(polyg
-0000bbf0: 6f6e 2e6c 6179 6572 2c20 706f 6c79 676f  on.layer, polygo
-0000bc00: 6e2e 6461 7461 7479 7065 2920 666f 7220  n.datatype) for 
-0000bc10: 706f 6c79 676f 6e20 696e 2070 6f6c 7967  polygon in polyg
-0000bc20: 6f6e 737d 0a0a 2020 2020 6465 6620 6765  ons}..    def ge
-0000bc30: 745f 6c61 7965 725f 6e61 6d65 7328 7365  t_layer_names(se
-0000bc40: 6c66 2920 2d3e 206c 6973 745b 7475 706c  lf) -> list[tupl
-0000bc50: 655b 696e 742c 2069 6e74 5d5d 3a0a 2020  e[int, int]]:.  
-0000bc60: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-0000bc70: 6c61 7965 7220 6e61 6d65 7320 7573 6564  layer names used
-0000bc80: 2069 6e20 7468 6520 6465 7369 676e 2e0a   in the design..
-0000bc90: 0a20 2020 2020 2020 202e 2e20 636f 6465  .        .. code
-0000bca0: 203a 3a0a 0a20 2020 2020 2020 2020 2020   ::..           
-0000bcb0: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-0000bcc0: 7279 2061 7320 6766 0a20 2020 2020 2020  ry as gf.       
-0000bcd0: 2020 2020 2067 662e 636f 6d70 6f6e 656e       gf.componen
-0000bce0: 7473 2e73 7472 6169 6768 7428 292e 6765  ts.straight().ge
-0000bcf0: 745f 6e61 6d65 7328 2920 3d3d 205b 2757  t_names() == ['W
-0000bd00: 4727 5d0a 2020 2020 2020 2020 2222 220a  G'].        """.
-0000bd10: 2020 2020 2020 2020 696d 706f 7274 2067          import g
-0000bd20: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-0000bd30: 0a20 2020 2020 2020 2050 444b 203d 2067  .        PDK = g
-0000bd40: 662e 6765 745f 6163 7469 7665 5f70 646b  f.get_active_pdk
-0000bd50: 2829 0a20 2020 2020 2020 204c 4159 4552  ().        LAYER
-0000bd60: 5320 3d20 5044 4b2e 6c61 7965 7273 0a20  S = PDK.layers. 
-0000bd70: 2020 2020 2020 206e 616d 655f 746f 5f6c         name_to_l
-0000bd80: 6179 6572 203d 2064 6963 7428 4c41 5945  ayer = dict(LAYE
-0000bd90: 5253 290a 2020 2020 2020 2020 6c61 7965  RS).        laye
-0000bda0: 725f 746f 5f6e 616d 6520 3d20 7b76 3a20  r_to_name = {v: 
-0000bdb0: 6b20 666f 7220 6b2c 2076 2069 6e20 6e61  k for k, v in na
-0000bdc0: 6d65 5f74 6f5f 6c61 7965 722e 6974 656d  me_to_layer.item
-0000bdd0: 7328 297d 0a20 2020 2020 2020 206c 6179  s()}.        lay
-0000bde0: 6572 5f6e 616d 6573 203d 205b 5d0a 0a20  er_names = [].. 
-0000bdf0: 2020 2020 2020 2066 6f72 206c 6179 6572         for layer
-0000be00: 2069 6e20 7365 6c66 2e6c 6179 6572 733a   in self.layers:
-0000be10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000be20: 6c61 7965 7220 6e6f 7420 696e 206c 6179  layer not in lay
-0000be30: 6572 5f74 6f5f 6e61 6d65 3a0a 2020 2020  er_to_name:.    
-0000be40: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0000be50: 696e 6773 2e77 6172 6e28 6622 7b6c 6179  ings.warn(f"{lay
-0000be60: 6572 7d20 6e6f 7420 696e 204c 6179 6572  er} not in Layer
-0000be70: 4d61 702e 222c 2073 7461 636b 6c65 7665  Map.", stackleve
-0000be80: 6c3d 3329 0a20 2020 2020 2020 2020 2020  l=3).           
-0000be90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000bea0: 2020 2020 2020 206c 6179 6572 5f6e 616d         layer_nam
-0000beb0: 6573 2e61 7070 656e 6428 6c61 7965 725f  es.append(layer_
-0000bec0: 746f 5f6e 616d 655b 6c61 7965 725d 290a  to_name[layer]).
-0000bed0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-0000bee0: 6179 6572 5f6e 616d 6573 0a0a 2020 2020  ayer_names..    
-0000bef0: 6465 6620 5f69 7079 7468 6f6e 5f64 6973  def _ipython_dis
-0000bf00: 706c 6179 5f28 7365 6c66 2920 2d3e 204e  play_(self) -> N
-0000bf10: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000bf20: 5368 6f77 2067 656f 6d65 7472 7920 696e  Show geometry in
-0000bf30: 204b 4c61 796f 7574 2061 6e64 2069 6e20   KLayout and in 
-0000bf40: 6d61 7470 6c6f 746c 6962 2066 6f72 204a  matplotlib for J
-0000bf50: 7570 7974 6572 204e 6f74 6562 6f6f 6b73  upyter Notebooks
-0000bf60: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
-0000bf70: 662e 7368 6f77 2873 686f 775f 706f 7274  f.show(show_port
-0000bf80: 733d 5472 7565 2920 2023 2073 686f 7720  s=True)  # show 
-0000bf90: 696e 206b 6c61 796f 7574 0a20 2020 2020  in klayout.     
-0000bfa0: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
-0000bfb0: 6c6f 7428 290a 0a20 2020 2064 6566 2061  lot()..    def a
-0000bfc0: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
-0000bfd0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000bfe0: 2020 2020 2020 2020 706f 7274 5f6d 6172          port_mar
-0000bff0: 6b65 725f 6c61 7965 723a 204c 6179 6572  ker_layer: Layer
-0000c000: 203d 2028 312c 2031 3029 2c0a 2020 2020   = (1, 10),.    
-0000c010: 2020 2020 6c61 7965 725f 6c61 6265 6c3a      layer_label:
-0000c020: 204c 6179 6572 203d 2028 312c 2031 3029   Layer = (1, 10)
-0000c030: 2c0a 2020 2020 2920 2d3e 2043 6f6d 706f  ,.    ) -> Compo
-0000c040: 6e65 6e74 3a0a 2020 2020 2020 2020 2222  nent:.        ""
-0000c050: 2252 6574 7572 6e73 2063 6f6d 706f 6e65  "Returns compone
-0000c060: 6e74 2077 6974 6820 7472 6961 6e67 756c  nt with triangul
-0000c070: 6172 2070 696e 732e 2222 220a 2020 2020  ar pins.""".    
-0000c080: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-0000c090: 6f72 792e 6164 645f 7069 6e73 2069 6d70  ory.add_pins imp
-0000c0a0: 6f72 7420 6164 645f 7069 6e73 5f74 7269  ort add_pins_tri
-0000c0b0: 616e 676c 650a 0a20 2020 2020 2020 2063  angle..        c
-0000c0c0: 6f6d 706f 6e65 6e74 203d 2073 656c 662e  omponent = self.
-0000c0d0: 636f 7079 2829 0a20 2020 2020 2020 2063  copy().        c
-0000c0e0: 6f6d 706f 6e65 6e74 2e6e 616d 6520 3d20  omponent.name = 
-0000c0f0: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
-0000c100: 2020 6164 645f 7069 6e73 5f74 7269 616e    add_pins_trian
-0000c110: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
-0000c120: 2063 6f6d 706f 6e65 6e74 3d63 6f6d 706f   component=compo
-0000c130: 6e65 6e74 2c20 6c61 7965 723d 706f 7274  nent, layer=port
-0000c140: 5f6d 6172 6b65 725f 6c61 7965 722c 206c  _marker_layer, l
-0000c150: 6179 6572 5f6c 6162 656c 3d6c 6179 6572  ayer_label=layer
-0000c160: 5f6c 6162 656c 0a20 2020 2020 2020 2029  _label.        )
-0000c170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c180: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
-0000c190: 6566 2070 6c6f 745f 7769 6467 6574 280a  ef plot_widget(.
-0000c1a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000c1b0: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
-0000c1c0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-0000c1d0: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
-0000c1e0: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
-0000c1f0: 3d20 2831 2c20 3130 292c 0a20 2020 2029  = (1, 10),.    )
-0000c200: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000c210: 2020 2222 2252 6574 7572 6e73 2069 7079    """Returns ipy
-0000c220: 7468 6f6e 2077 6964 6765 7420 666f 7220  thon widget for 
-0000c230: 6b6c 6179 6f75 7420 7669 7375 616c 697a  klayout visualiz
-0000c240: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-0000c250: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-0000c260: 2020 7368 6f77 5f70 6f72 7473 3a20 7368    show_ports: sh
-0000c270: 6f77 7320 636f 6d70 6f6e 656e 7420 7769  ows component wi
-0000c280: 7468 2070 6f72 7420 6d61 726b 6572 7320  th port markers 
-0000c290: 616e 6420 6c61 6265 6c73 2e0a 2020 2020  and labels..    
-0000c2a0: 2020 2020 2020 2020 706f 7274 5f6d 6172          port_mar
-0000c2b0: 6b65 725f 6c61 7965 723a 2066 6f72 2074  ker_layer: for t
-0000c2c0: 6865 2070 6f72 7473 2e0a 2020 2020 2020  he ports..      
-0000c2d0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-0000c2e0: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
-0000c2f0: 6179 2069 6d70 6f72 7420 6469 7370 6c61  ay import displa
-0000c300: 790a 0a20 2020 2020 2020 2066 726f 6d20  y..        from 
-0000c310: 6764 7366 6163 746f 7279 2e70 646b 2069  gdsfactory.pdk i
-0000c320: 6d70 6f72 7420 6765 745f 6c61 7965 725f  mport get_layer_
-0000c330: 7669 6577 730a 0a20 2020 2020 2020 2074  views..        t
-0000c340: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000c350: 696d 706f 7274 206b 6661 6374 6f72 7920  import kfactory 
-0000c360: 6173 206b 660a 2020 2020 2020 2020 2020  as kf.          
-0000c370: 2020 6672 6f6d 2067 706c 7567 696e 732e    from gplugins.
-0000c380: 7769 6467 6574 2e69 6e74 6572 6163 7469  widget.interacti
-0000c390: 7665 2069 6d70 6f72 7420 4c61 796f 7574  ve import Layout
-0000c3a0: 5769 6467 6574 0a20 2020 2020 2020 2065  Widget.        e
-0000c3b0: 7863 6570 7420 496d 706f 7274 4572 726f  xcept ImportErro
-0000c3c0: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
-0000c3d0: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-0000c3e0: 2020 2020 2020 2259 6f75 206e 6565 6420        "You need 
-0000c3f0: 696e 7374 616c 6c20 6b66 6163 746f 7279  install kfactory
-0000c400: 2070 6c75 6769 6e20 7769 7468 2060 7069   plugin with `pi
-0000c410: 7020 696e 7374 616c 6c20 6764 7366 6163  p install gdsfac
-0000c420: 746f 7279 5b6b 6661 6374 6f72 795d 6022  tory[kfactory]`"
-0000c430: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000c440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000c450: 706c 6f74 5f6b 6c61 796f 7574 2829 0a20  plot_klayout(). 
-0000c460: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000c470: 6e0a 0a20 2020 2020 2020 2063 6f6d 706f  n..        compo
-0000c480: 6e65 6e74 203d 2028 0a20 2020 2020 2020  nent = (.       
-0000c490: 2020 2020 2073 656c 662e 6164 645f 7069       self.add_pi
-0000c4a0: 6e73 5f74 7269 616e 676c 6528 706f 7274  ns_triangle(port
-0000c4b0: 5f6d 6172 6b65 725f 6c61 7965 723d 706f  _marker_layer=po
-0000c4c0: 7274 5f6d 6172 6b65 725f 6c61 7965 7229  rt_marker_layer)
-0000c4d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c4e0: 7368 6f77 5f70 6f72 7473 0a20 2020 2020  show_ports.     
-0000c4f0: 2020 2020 2020 2065 6c73 6520 7365 6c66         else self
-0000c500: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000c510: 2020 2020 6764 7370 6174 6820 3d20 636f      gdspath = co
-0000c520: 6d70 6f6e 656e 742e 7772 6974 655f 6764  mponent.write_gd
-0000c530: 7328 6c6f 6767 696e 673d 4661 6c73 6529  s(logging=False)
-0000c540: 0a20 2020 2020 2020 206c 7970 5f70 6174  .        lyp_pat
-0000c550: 6820 3d20 6764 7370 6174 682e 7769 7468  h = gdspath.with
-0000c560: 5f73 7566 6669 7828 222e 6c79 7022 290a  _suffix(".lyp").
-0000c570: 0a20 2020 2020 2020 206b 636c 203d 206b  .        kcl = k
-0000c580: 662e 4b43 4c61 796f 7574 2829 0a20 2020  f.KCLayout().   
-0000c590: 2020 2020 206b 636c 2e72 6561 6428 6764       kcl.read(gd
-0000c5a0: 7370 6174 6829 0a20 2020 2020 2020 2074  spath).        t
-0000c5b0: 6f70 5f63 656c 6c20 3d20 6b63 6c2e 746f  op_cell = kcl.to
-0000c5c0: 705f 6365 6c6c 2829 0a20 2020 2020 2020  p_cell().       
-0000c5d0: 2063 203d 206b 636c 2e64 7570 2829 5b74   c = kcl.dup()[t
-0000c5e0: 6f70 5f63 656c 6c2e 6e61 6d65 5d0a 2020  op_cell.name].  
-0000c5f0: 2020 2020 2020 2320 6320 3d20 6b66 2e4b        # c = kf.K
-0000c600: 4365 6c6c 2874 6f70 5f63 656c 6c2e 6e61  Cell(top_cell.na
-0000c610: 6d65 2c20 616c 6c29 0a20 2020 2020 2020  me, all).       
-0000c620: 2023 2063 2e63 6f70 795f 7472 6565 2874   # c.copy_tree(t
-0000c630: 6f70 5f63 656c 6c29 0a0a 2020 2020 2020  op_cell)..      
-0000c640: 2020 6c61 7965 725f 7669 6577 7320 3d20    layer_views = 
-0000c650: 6765 745f 6c61 7965 725f 7669 6577 7328  get_layer_views(
-0000c660: 290a 2020 2020 2020 2020 6c61 7965 725f  ).        layer_
-0000c670: 7669 6577 732e 746f 5f6c 7970 2866 696c  views.to_lyp(fil
-0000c680: 6570 6174 683d 6c79 705f 7061 7468 290a  epath=lyp_path).
-0000c690: 0a20 2020 2020 2020 206c 7720 3d20 4c61  .        lw = La
-0000c6a0: 796f 7574 5769 6467 6574 2863 656c 6c3d  youtWidget(cell=
-0000c6b0: 632c 206c 6179 6572 5f70 726f 7065 7274  c, layer_propert
-0000c6c0: 6965 733d 6c79 705f 7061 7468 290a 2020  ies=lyp_path).  
-0000c6d0: 2020 2020 2020 6469 7370 6c61 7928 6c77        display(lw
-0000c6e0: 2e77 6964 6765 7429 0a0a 2020 2020 6465  .widget)..    de
-0000c6f0: 6620 706c 6f74 5f6b 6c61 796f 7574 280a  f plot_klayout(.
-0000c700: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000c710: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
-0000c720: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-0000c730: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
-0000c740: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
-0000c750: 3d20 2831 2c20 3130 292c 0a20 2020 2020  = (1, 10),.     
-0000c760: 2020 2073 686f 775f 6c61 6265 6c73 3a20     show_labels: 
-0000c770: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0000c780: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
-0000c790: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-0000c7a0: 6b6c 6179 6f75 7420 696d 6167 652e 0a0a  klayout image...
-0000c7b0: 2020 2020 2020 2020 4966 2069 7420 6661          If it fa
-0000c7c0: 696c 7320 746f 2069 6d70 6f72 7420 6b6c  ils to import kl
-0000c7d0: 6179 6f75 7420 6465 6661 756c 7473 2074  ayout defaults t
-0000c7e0: 6f20 6d61 7470 6c6f 746c 6962 2e0a 0a20  o matplotlib... 
-0000c7f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-0000c800: 2020 2020 2020 2020 2073 686f 775f 706f           show_po
-0000c810: 7274 733a 2073 686f 7773 2063 6f6d 706f  rts: shows compo
-0000c820: 6e65 6e74 2077 6974 6820 706f 7274 206d  nent with port m
-0000c830: 6172 6b65 7273 2061 6e64 206c 6162 656c  arkers and label
-0000c840: 732e 0a20 2020 2020 2020 2020 2020 2070  s..            p
-0000c850: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
-0000c860: 3a20 666f 7220 7468 6520 706f 7274 732e  : for the ports.
-0000c870: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000c880: 775f 6c61 6265 6c73 3a20 7368 6f77 7320  w_labels: shows 
-0000c890: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
-0000c8a0: 2222 220a 0a20 2020 2020 2020 2063 6f6d  """..        com
-0000c8b0: 706f 6e65 6e74 203d 2028 0a20 2020 2020  ponent = (.     
-0000c8c0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000c8d0: 7069 6e73 5f74 7269 616e 676c 6528 706f  pins_triangle(po
-0000c8e0: 7274 5f6d 6172 6b65 725f 6c61 7965 723d  rt_marker_layer=
-0000c8f0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000c900: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
-0000c910: 6620 7368 6f77 5f70 6f72 7473 0a20 2020  f show_ports.   
-0000c920: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
-0000c930: 6c66 0a20 2020 2020 2020 2029 0a0a 2020  lf.        )..  
-0000c940: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000c950: 2020 2020 2020 2066 726f 6d20 696f 2069         from io i
-0000c960: 6d70 6f72 7420 4279 7465 7349 4f0a 0a20  mport BytesIO.. 
-0000c970: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
-0000c980: 7420 6b6c 6179 6f75 742e 6462 2061 7320  t klayout.db as 
-0000c990: 6462 2020 2320 6e6f 7161 3a20 4634 3031  db  # noqa: F401
-0000c9a0: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-0000c9b0: 6f72 7420 6b6c 6179 6f75 742e 6c61 7920  ort klayout.lay 
-0000c9c0: 6173 206c 6179 0a20 2020 2020 2020 2020  as lay.         
-0000c9d0: 2020 2069 6d70 6f72 7420 6d61 7470 6c6f     import matplo
-0000c9e0: 746c 6962 2e70 7970 6c6f 7420 6173 2070  tlib.pyplot as p
-0000c9f0: 6c74 0a0a 2020 2020 2020 2020 2020 2020  lt..            
-0000ca00: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000ca10: 7064 6b20 696d 706f 7274 2067 6574 5f6c  pdk import get_l
-0000ca20: 6179 6572 5f76 6965 7773 0a0a 2020 2020  ayer_views..    
-0000ca30: 2020 2020 2020 2020 6764 7370 6174 6820          gdspath 
-0000ca40: 3d20 636f 6d70 6f6e 656e 742e 7772 6974  = component.writ
-0000ca50: 655f 6764 7328 6c6f 6767 696e 673d 4661  e_gds(logging=Fa
-0000ca60: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-0000ca70: 206c 7970 5f70 6174 6820 3d20 6764 7370   lyp_path = gdsp
-0000ca80: 6174 682e 7769 7468 5f73 7566 6669 7828  ath.with_suffix(
-0000ca90: 222e 6c79 7022 290a 0a20 2020 2020 2020  ".lyp")..       
-0000caa0: 2020 2020 206c 6179 6572 5f76 6965 7773       layer_views
-0000cab0: 203d 2067 6574 5f6c 6179 6572 5f76 6965   = get_layer_vie
-0000cac0: 7773 2829 0a20 2020 2020 2020 2020 2020  ws().           
-0000cad0: 206c 6179 6572 5f76 6965 7773 2e74 6f5f   layer_views.to_
-0000cae0: 6c79 7028 6669 6c65 7061 7468 3d6c 7970  lyp(filepath=lyp
-0000caf0: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
-0000cb00: 2020 2020 6c61 796f 7574 5f76 6965 7720      layout_view 
-0000cb10: 3d20 6c61 792e 4c61 796f 7574 5669 6577  = lay.LayoutView
-0000cb20: 2829 0a20 2020 2020 2020 2020 2020 206c  ().            l
-0000cb30: 6179 6f75 745f 7669 6577 2e6c 6f61 645f  ayout_view.load_
-0000cb40: 6c61 796f 7574 2873 7472 2867 6473 7061  layout(str(gdspa
-0000cb50: 7468 2e61 6273 6f6c 7574 6528 2929 290a  th.absolute())).
-0000cb60: 2020 2020 2020 2020 2020 2020 6c61 796f              layo
-0000cb70: 7574 5f76 6965 772e 6d61 785f 6869 6572  ut_view.max_hier
-0000cb80: 2829 0a20 2020 2020 2020 2020 2020 206c  ().            l
-0000cb90: 6179 6f75 745f 7669 6577 2e6c 6f61 645f  ayout_view.load_
-0000cba0: 6c61 7965 725f 7072 6f70 7328 7374 7228  layer_props(str(
-0000cbb0: 6c79 705f 7061 7468 2929 0a0a 2020 2020  lyp_path))..    
-0000cbc0: 2020 2020 2020 2020 6c61 796f 7574 5f76          layout_v
-0000cbd0: 6965 772e 7365 745f 636f 6e66 6967 2822  iew.set_config("
-0000cbe0: 7465 7874 2d76 6973 6962 6c65 222c 2022  text-visible", "
-0000cbf0: 7472 7565 2220 6966 2073 686f 775f 6c61  true" if show_la
-0000cc00: 6265 6c73 2065 6c73 6520 2266 616c 7365  bels else "false
-0000cc10: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0000cc20: 7069 7865 6c5f 6275 6666 6572 203d 206c  pixel_buffer = l
-0000cc30: 6179 6f75 745f 7669 6577 2e67 6574 5f70  ayout_view.get_p
-0000cc40: 6978 656c 735f 7769 7468 5f6f 7074 696f  ixels_with_optio
-0000cc50: 6e73 2838 3030 2c20 3630 3029 0a20 2020  ns(800, 600).   
-0000cc60: 2020 2020 2020 2020 2070 6e67 5f64 6174           png_dat
-0000cc70: 6120 3d20 7069 7865 6c5f 6275 6666 6572  a = pixel_buffer
-0000cc80: 2e74 6f5f 706e 675f 6461 7461 2829 0a0a  .to_png_data()..
-0000cc90: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-0000cca0: 6e76 6572 7420 504e 4720 6461 7461 2074  nvert PNG data t
-0000ccb0: 6f20 4e75 6d50 7920 6172 7261 7920 616e  o NumPy array an
-0000ccc0: 6420 6469 7370 6c61 7920 7769 7468 206d  d display with m
-0000ccd0: 6174 706c 6f74 6c69 620a 2020 2020 2020  atplotlib.      
-0000cce0: 2020 2020 2020 7769 7468 2042 7974 6573        with Bytes
-0000ccf0: 494f 2870 6e67 5f64 6174 6129 2061 7320  IO(png_data) as 
-0000cd00: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0000cd10: 2020 2069 6d67 5f61 7272 6179 203d 2070     img_array = p
-0000cd20: 6c74 2e69 6d72 6561 6428 6629 0a0a 2020  lt.imread(f)..  
-0000cd30: 2020 2020 2020 2020 2020 2320 436f 6d70            # Comp
-0000cd40: 7574 6520 7468 6520 6669 6775 7265 2064  ute the figure d
-0000cd50: 696d 656e 7369 6f6e 7320 6261 7365 6420  imensions based 
-0000cd60: 6f6e 2074 6865 2069 6d61 6765 2073 697a  on the image siz
-0000cd70: 6520 616e 6420 6465 7369 7265 6420 4450  e and desired DP
-0000cd80: 490a 2020 2020 2020 2020 2020 2020 6470  I.            dp
-0000cd90: 6920 3d20 3830 0a20 2020 2020 2020 2020  i = 80.         
-0000cda0: 2020 2066 6967 5f77 6964 7468 203d 2069     fig_width = i
-0000cdb0: 6d67 5f61 7272 6179 2e73 6861 7065 5b31  mg_array.shape[1
-0000cdc0: 5d20 2f20 6470 690a 2020 2020 2020 2020  ] / dpi.        
-0000cdd0: 2020 2020 6669 675f 6865 6967 6874 203d      fig_height =
-0000cde0: 2069 6d67 5f61 7272 6179 2e73 6861 7065   img_array.shape
-0000cdf0: 5b30 5d20 2f20 6470 690a 0a20 2020 2020  [0] / dpi..     
-0000ce00: 2020 2020 2020 2066 6967 2c20 6178 203d         fig, ax =
-0000ce10: 2070 6c74 2e73 7562 706c 6f74 7328 6669   plt.subplots(fi
-0000ce20: 6773 697a 653d 2866 6967 5f77 6964 7468  gsize=(fig_width
-0000ce30: 2c20 6669 675f 6865 6967 6874 292c 2064  , fig_height), d
-0000ce40: 7069 3d64 7069 290a 0a20 2020 2020 2020  pi=dpi)..       
-0000ce50: 2020 2020 2023 2052 656d 6f76 6520 6d61       # Remove ma
-0000ce60: 7267 696e 7320 616e 6420 6469 7370 6c61  rgins and displa
-0000ce70: 7920 7468 6520 696d 6167 650a 2020 2020  y the image.    
-0000ce80: 2020 2020 2020 2020 6178 2e69 6d73 686f          ax.imsho
-0000ce90: 7728 696d 675f 6172 7261 7929 0a20 2020  w(img_array).   
-0000cea0: 2020 2020 2020 2020 2061 782e 6178 6973           ax.axis
-0000ceb0: 2822 6f66 6622 2920 2023 2048 6964 6520  ("off")  # Hide 
-0000cec0: 6178 6573 0a20 2020 2020 2020 2020 2020  axes.           
-0000ced0: 2061 782e 7365 745f 706f 7369 7469 6f6e   ax.set_position
-0000cee0: 285b 302c 2030 2c20 312c 2031 5d29 2020  ([0, 0, 1, 1])  
-0000cef0: 2320 5365 7420 6178 6573 2074 6f20 6f63  # Set axes to oc
-0000cf00: 6375 7079 2074 6865 2066 756c 6c20 6669  cupy the full fi
-0000cf10: 6775 7265 2073 7061 6365 0a0a 2020 2020  gure space..    
-0000cf20: 2020 2020 2020 2020 706c 742e 7375 6270          plt.subp
-0000cf30: 6c6f 7473 5f61 646a 7573 7428 0a20 2020  lots_adjust(.   
-0000cf40: 2020 2020 2020 2020 2020 2020 206c 6566               lef
-0000cf50: 743d 302c 2072 6967 6874 3d31 2c20 746f  t=0, right=1, to
-0000cf60: 703d 312c 2062 6f74 746f 6d3d 302c 2077  p=1, bottom=0, w
-0000cf70: 7370 6163 653d 302c 2068 7370 6163 653d  space=0, hspace=
-0000cf80: 300a 2020 2020 2020 2020 2020 2020 2920  0.            ) 
-0000cf90: 2023 2052 656d 6f76 6520 616e 7920 7061   # Remove any pa
-0000cfa0: 6464 696e 670a 2020 2020 2020 2020 2020  dding.          
-0000cfb0: 2020 706c 742e 7469 6768 745f 6c61 796f    plt.tight_layo
-0000cfc0: 7574 2870 6164 3d30 2920 2023 2045 6e73  ut(pad=0)  # Ens
-0000cfd0: 7572 6520 6e6f 2073 7061 6365 2069 7320  ure no space is 
-0000cfe0: 7761 7374 6564 0a20 2020 2020 2020 2020  wasted.         
-0000cff0: 2020 2072 6574 7572 6e20 6669 670a 0a20     return fig.. 
-0000d000: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-0000d010: 706f 7274 4572 726f 723a 0a20 2020 2020  portError:.     
-0000d020: 2020 2020 2020 2070 7269 6e74 2822 596f         print("Yo
-0000d030: 7520 6361 6e20 696e 7374 616c 6c20 6070  u can install `p
-0000d040: 6970 2069 6e73 7461 6c6c 2067 6473 6661  ip install gdsfa
-0000d050: 6374 6f72 7960 2066 6f72 2062 6574 7465  ctory` for bette
-0000d060: 7220 7669 7375 616c 697a 6174 696f 6e22  r visualization"
-0000d070: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-0000d080: 6d70 6f6e 656e 742e 706c 6f74 2870 6c6f  mponent.plot(plo
-0000d090: 7474 6572 3d22 6d61 7470 6c6f 746c 6962  tter="matplotlib
-0000d0a0: 2229 0a0a 2020 2020 6465 6620 706c 6f74  ")..    def plot
-0000d0b0: 5f6b 7765 6228 7365 6c66 293a 0a20 2020  _kweb(self):.   
-0000d0c0: 2020 2020 2022 2222 5368 6f77 7320 6375       """Shows cu
-0000d0d0: 7272 656e 7420 6764 7320 696e 206b 7765  rrent gds in kwe
-0000d0e0: 622e 2222 220a 2020 2020 2020 2020 696d  b.""".        im
-0000d0f0: 706f 7274 206f 730a 2020 2020 2020 2020  port os.        
-0000d100: 6672 6f6d 2068 746d 6c20 696d 706f 7274  from html import
-0000d110: 2065 7363 6170 650a 0a20 2020 2020 2020   escape..       
-0000d120: 2069 6d70 6f72 7420 6b77 6562 2e73 6572   import kweb.ser
-0000d130: 7665 725f 6a75 7079 7465 7220 6173 206b  ver_jupyter as k
-0000d140: 6a0a 2020 2020 2020 2020 6672 6f6d 2049  j.        from I
-0000d150: 5079 7468 6f6e 2e64 6973 706c 6179 2069  Python.display i
-0000d160: 6d70 6f72 7420 4946 7261 6d65 0a0a 2020  mport IFrame..  
-0000d170: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-0000d180: 6374 6f72 792e 636f 6e66 6967 2069 6d70  ctory.config imp
-0000d190: 6f72 7420 5041 5448 0a20 2020 2020 2020  ort PATH.       
-0000d1a0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-0000d1b0: 2e70 646b 2069 6d70 6f72 7420 6765 745f  .pdk import get_
-0000d1c0: 6c61 7965 725f 7669 6577 730a 0a20 2020  layer_views..   
-0000d1d0: 2020 2020 2067 6473 7061 7468 203d 2073       gdspath = s
-0000d1e0: 656c 662e 7772 6974 655f 6764 7328 6764  elf.write_gds(gd
-0000d1f0: 7364 6972 3d50 4154 482e 6764 736c 6962  sdir=PATH.gdslib
-0000d200: 202f 2022 6578 7472 6122 2c20 6c6f 6767   / "extra", logg
-0000d210: 696e 673d 4661 6c73 6529 0a0a 2020 2020  ing=False)..    
-0000d220: 2020 2020 6469 7270 6174 6820 3d20 4744      dirpath = GD
-0000d230: 5344 4952 5f54 454d 500a 2020 2020 2020  SDIR_TEMP.      
-0000d240: 2020 6469 7270 6174 682e 6d6b 6469 7228    dirpath.mkdir(
-0000d250: 6578 6973 745f 6f6b 3d54 7275 652c 2070  exist_ok=True, p
-0000d260: 6172 656e 7473 3d54 7275 6529 0a20 2020  arents=True).   
-0000d270: 2020 2020 206c 7970 5f70 6174 6820 3d20       lyp_path = 
-0000d280: 6469 7270 6174 6820 2f20 226c 6179 6572  dirpath / "layer
-0000d290: 732e 6c79 7022 0a0a 2020 2020 2020 2020  s.lyp"..        
-0000d2a0: 6c61 7965 725f 7072 6f70 7320 3d20 6765  layer_props = ge
-0000d2b0: 745f 6c61 7965 725f 7669 6577 7328 290a  t_layer_views().
-0000d2c0: 2020 2020 2020 2020 6c61 7965 725f 7072          layer_pr
-0000d2d0: 6f70 732e 746f 5f6c 7970 2866 696c 6570  ops.to_lyp(filep
-0000d2e0: 6174 683d 6c79 705f 7061 7468 290a 0a20  ath=lyp_path).. 
-0000d2f0: 2020 2020 2020 2070 6f72 7420 3d20 6b6a         port = kj
-0000d300: 2e70 6f72 7420 6966 2068 6173 6174 7472  .port if hasattr
-0000d310: 286b 6a2c 2022 706f 7274 2229 2061 6e64  (kj, "port") and
-0000d320: 206b 6a2e 706f 7274 2065 6c73 6520 3830   kj.port else 80
-0000d330: 3030 0a20 2020 2020 2020 2073 7263 203d  00.        src =
-0000d340: 2066 2268 7474 703a 2f2f 3132 372e 302e   f"http://127.0.
-0000d350: 302e 313a 7b70 6f72 747d 2f67 6473 3f67  0.1:{port}/gds?g
-0000d360: 6473 5f66 696c 653d 7b65 7363 6170 6528  ds_file={escape(
-0000d370: 7374 7228 6764 7370 6174 6829 297d 266c  str(gdspath))}&l
-0000d380: 6179 6572 5f70 726f 7073 3d7b 6573 6361  ayer_props={esca
-0000d390: 7065 2873 7472 286c 7970 5f70 6174 6829  pe(str(lyp_path)
-0000d3a0: 297d 220a 0a20 2020 2020 2020 206f 732e  )}"..        os.
-0000d3b0: 656e 7669 726f 6e5b 224b 5745 425f 504f  environ["KWEB_PO
-0000d3c0: 5254 225d 203d 2073 7472 286f 732e 6765  RT"] = str(os.ge
-0000d3d0: 7465 6e76 2822 4b57 4542 5f50 4f52 5422  tenv("KWEB_PORT"
-0000d3e0: 2c20 706f 7274 2929 0a0a 2020 2020 2020  , port))..      
-0000d3f0: 2020 6966 206e 6f74 206b 6a2e 6a75 7079    if not kj.jupy
-0000d400: 7465 725f 7365 7276 6572 3a0a 2020 2020  ter_server:.    
-0000d410: 2020 2020 2020 2020 706f 7274 203d 2069          port = i
-0000d420: 6e74 286f 732e 6765 7465 6e76 2822 4b57  nt(os.getenv("KW
-0000d430: 4542 5f50 4f52 5422 2929 0a20 2020 2020  EB_PORT")).     
-0000d440: 2020 2020 2020 2077 6869 6c65 206b 6a2e         while kj.
-0000d450: 6973 5f70 6f72 745f 696e 5f75 7365 2870  is_port_in_use(p
-0000d460: 6f72 7429 3a0a 2020 2020 2020 2020 2020  ort):.          
-0000d470: 2020 2020 2020 706f 7274 202b 3d20 310a        port += 1.
-0000d480: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-0000d490: 656e 7669 726f 6e5b 224b 5745 425f 504f  environ["KWEB_PO
-0000d4a0: 5254 225d 203d 2073 7472 2870 6f72 7429  RT"] = str(port)
-0000d4b0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000d4c0: 6765 722e 6465 6275 6728 7372 6329 0a20  ger.debug(src). 
-0000d4d0: 2020 2020 2020 2020 2020 206b 6a2e 7374             kj.st
-0000d4e0: 6172 7428 290a 0a20 2020 2020 2020 2069  art()..        i
-0000d4f0: 6620 6b6a 2e6a 7570 7974 6572 5f73 6572  f kj.jupyter_ser
-0000d500: 7665 723a 0a20 2020 2020 2020 2020 2020  ver:.           
-0000d510: 2072 6574 7572 6e20 4946 7261 6d65 280a   return IFrame(.
-0000d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d530: 7372 633d 7372 632c 0a20 2020 2020 2020  src=src,.       
-0000d540: 2020 2020 2020 2020 2077 6964 7468 3d31           width=1
-0000d550: 3430 302c 0a20 2020 2020 2020 2020 2020  400,.           
-0000d560: 2020 2020 2068 6569 6768 743d 3630 302c       height=600,
-0000d570: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000d580: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000d590: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000d5a0: 7365 6c66 2e70 6c6f 745f 6b6c 6179 6f75  self.plot_klayou
-0000d5b0: 7428 290a 0a20 2020 2064 6566 2070 6c6f  t()..    def plo
-0000d5c0: 745f 6d61 7470 6c6f 746c 6962 2873 656c  t_matplotlib(sel
-0000d5d0: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
-0000d5e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000d5f0: 2250 6c6f 7420 636f 6d70 6f6e 656e 7420  "Plot component 
-0000d600: 7573 696e 6720 6d61 7470 6c6f 746c 6962  using matplotlib
-0000d610: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-0000d620: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-0000d630: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
-0000d640: 2053 6574 7320 7768 6574 6865 7220 706f   Sets whether po
-0000d650: 7274 7320 6172 6520 6472 6177 6e2e 0a20  rts are drawn.. 
-0000d660: 2020 2020 2020 2020 2020 2073 686f 775f             show_
-0000d670: 7375 6270 6f72 7473 3a20 5365 7473 2077  subports: Sets w
-0000d680: 6865 7468 6572 2073 7562 706f 7274 7320  hether subports 
-0000d690: 2870 6f72 7473 2074 6861 7420 6265 6c6f  (ports that belo
-0000d6a0: 6e67 2074 6f20 7265 6665 7265 6e63 6573  ng to references
-0000d6b0: 2920 6172 6520 6472 6177 6e2e 0a20 2020  ) are drawn..   
-0000d6c0: 2020 2020 2020 2020 206c 6162 656c 5f61           label_a
-0000d6d0: 6c69 6173 6573 3a20 5365 7473 2077 6865  liases: Sets whe
-0000d6e0: 7468 6572 2061 6c69 6173 6573 2061 7265  ther aliases are
-0000d6f0: 206c 6162 656c 6564 2077 6974 6820 6120   labeled with a 
-0000d700: 7465 7874 206e 616d 652e 0a20 2020 2020  text name..     
-0000d710: 2020 2020 2020 206e 6577 5f77 696e 646f         new_windo
-0000d720: 773a 2049 6620 5472 7565 2c20 6561 6368  w: If True, each
-0000d730: 2063 616c 6c20 746f 2071 7569 636b 706c   call to quickpl
-0000d740: 6f74 2829 2077 696c 6c20 6765 6e65 7261  ot() will genera
-0000d750: 7465 2061 2073 6570 6172 6174 6520 7769  te a separate wi
-0000d760: 6e64 6f77 2e0a 2020 2020 2020 2020 2020  ndow..          
-0000d770: 2020 626c 6f63 6b69 6e67 3a20 4966 2054    blocking: If T
-0000d780: 7275 652c 2063 616c 6c69 6e67 2071 7569  rue, calling qui
-0000d790: 636b 706c 6f74 2829 2077 696c 6c20 7061  ckplot() will pa
-0000d7a0: 7573 6520 6578 6563 7574 696f 6e20 6f66  use execution of
-0000d7b0: 2028 2262 6c6f 636b 2229 2074 6865 0a20   ("block") the. 
-0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d7d0: 656d 6169 6e64 6572 206f 6620 7468 6520  emainder of the 
-0000d7e0: 7079 7468 6f6e 2063 6f64 6520 756e 7469  python code unti
-0000d7f0: 6c20 7468 6520 7175 6963 6b70 6c6f 7428  l the quickplot(
-0000d800: 2920 7769 6e64 6f77 2069 7320 636c 6f73  ) window is clos
-0000d810: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000d820: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
-0000d830: 6520 7769 6e64 6f77 2077 696c 6c20 6265  e window will be
-0000d840: 206f 7065 6e65 6420 616e 6420 636f 6465   opened and code
-0000d850: 2077 696c 6c20 636f 6e74 696e 7565 2074   will continue t
-0000d860: 6f20 7275 6e2e 0a20 2020 2020 2020 2020  o run..         
-0000d870: 2020 207a 6f6f 6d5f 6661 6374 6f72 3a20     zoom_factor: 
-0000d880: 5365 7473 2074 6865 2073 6361 6c69 6e67  Sets the scaling
-0000d890: 2066 6163 746f 7220 7768 656e 207a 6f6f   factor when zoo
-0000d8a0: 6d69 6e67 2074 6865 2071 7569 636b 706c  ming the quickpl
-0000d8b0: 6f74 2077 696e 646f 7720 7769 7468 2074  ot window with t
-0000d8c0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-0000d8d0: 2020 206d 6f75 7365 7768 6565 6c2f 7472     mousewheel/tr
-0000d8e0: 6163 6b70 6164 2e0a 2020 2020 2020 2020  ackpad..        
-0000d8f0: 2020 2020 696e 7465 7261 6374 6976 655f      interactive_
-0000d900: 7a6f 6f6d 3a20 456e 6162 6c65 7320 7573  zoom: Enables us
-0000d910: 696e 6720 6d6f 7573 6577 6865 656c 2f74  ing mousewheel/t
-0000d920: 7261 636b 7061 6420 746f 207a 6f6f 6d2e  rackpad to zoom.
-0000d930: 0a20 2020 2020 2020 2020 2020 2066 6f6e  .            fon
-0000d940: 7473 697a 653a 2066 6f72 206c 6162 656c  tsize: for label
-0000d950: 732e 0a20 2020 2020 2020 2020 2020 206c  s..            l
-0000d960: 6179 6572 735f 6578 636c 7564 6564 3a20  ayers_excluded: 
-0000d970: 6c69 7374 206f 6620 6c61 7965 7273 2074  list of layers t
-0000d980: 6f20 6578 636c 7564 652e 0a20 2020 2020  o exclude..     
-0000d990: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-0000d9a0: 7773 3a20 6c61 7965 725f 7669 6577 7320  ws: layer_views 
-0000d9b0: 636f 6c6f 7273 206c 6f61 6465 6420 6672  colors loaded fr
-0000d9c0: 6f6d 204b 6c61 796f 7574 2e0a 2020 2020  om Klayout..    
-0000d9d0: 2020 2020 2020 2020 6d69 6e5f 6173 7065          min_aspe
-0000d9e0: 6374 3a20 6d69 6e69 6d75 6d20 6173 7065  ct: minimum aspe
-0000d9f0: 6374 2072 6174 696f 2e0a 2020 2020 2020  ct ratio..      
-0000da00: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-0000da10: 6f6d 2067 6473 6661 6374 6f72 792e 7175  om gdsfactory.qu
-0000da20: 6963 6b70 6c6f 7474 6572 2069 6d70 6f72  ickplotter impor
-0000da30: 7420 7175 6963 6b70 6c6f 740a 0a20 2020  t quickplot..   
-0000da40: 2020 2020 2071 7569 636b 706c 6f74 2873       quickplot(s
-0000da50: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
-0000da60: 2020 2020 6465 6620 706c 6f74 2873 656c      def plot(sel
-0000da70: 662c 2070 6c6f 7474 6572 3a20 7374 7220  f, plotter: str 
-0000da80: 7c20 4e6f 6e65 203d 204e 6f6e 652c 202a  | None = None, *
-0000da90: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-0000daa0: 2020 2222 2252 6574 7572 6e73 2063 6f6d    """Returns com
-0000dab0: 706f 6e65 6e74 2070 6c6f 7420 7573 696e  ponent plot usin
-0000dac0: 6720 6b6c 6179 6f75 742c 206d 6174 706c  g klayout, matpl
-0000dad0: 6f74 6c69 622c 2068 6f6c 6f76 6965 7773  otlib, holoviews
-0000dae0: 206f 7220 7174 2e0a 0a20 2020 2020 2020   or qt...       
-0000daf0: 2057 6520 7265 636f 6d6d 656e 6420 7573   We recommend us
-0000db00: 696e 6720 6b6c 6179 6f75 742e 0a0a 2020  ing klayout...  
-0000db10: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-0000db20: 2020 2020 2020 2020 706c 6f74 7465 723a          plotter:
-0000db30: 2070 6c6f 7420 6261 636b 656e 6420 2827   plot backend ('
-0000db40: 6d61 7470 6c6f 746c 6962 272c 2027 7769  matplotlib', 'wi
-0000db50: 6467 6574 272c 2027 6b6c 6179 6f75 7427  dget', 'klayout'
-0000db60: 2c20 276b 7765 6227 292e 0a20 2020 2020  , 'kweb')..     
-0000db70: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-0000db80: 6c6f 7474 6572 203d 2070 6c6f 7474 6572  lotter = plotter
-0000db90: 206f 7220 434f 4e46 2e64 6973 706c 6179   or CONF.display
-0000dba0: 5f74 7970 650a 0a20 2020 2020 2020 2069  _type..        i
-0000dbb0: 6620 706c 6f74 7465 7220 6e6f 7420 696e  f plotter not in
-0000dbc0: 2076 616c 6964 5f70 6c6f 7474 6572 733a   valid_plotters:
-0000dbd0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000dbe0: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0000dbf0: 7b70 6c6f 7474 6572 2172 7d20 6e6f 7420  {plotter!r} not 
-0000dc00: 696e 207b 7661 6c69 645f 706c 6f74 7465  in {valid_plotte
-0000dc10: 7273 7d22 290a 0a20 2020 2020 2020 2069  rs}")..        i
-0000dc20: 6620 706c 6f74 7465 7220 3d3d 2022 6b6c  f plotter == "kl
-0000dc30: 6179 6f75 7422 3a0a 2020 2020 2020 2020  ayout":.        
-0000dc40: 2020 2020 7365 6c66 2e70 6c6f 745f 6b6c      self.plot_kl
-0000dc50: 6179 6f75 7428 290a 2020 2020 2020 2020  ayout().        
-0000dc60: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0000dc70: 2020 2065 6c69 6620 706c 6f74 7465 7220     elif plotter 
-0000dc80: 3d3d 2022 6b77 6562 223a 0a20 2020 2020  == "kweb":.     
-0000dc90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000dca0: 6c66 2e70 6c6f 745f 6b77 6562 2829 0a20  lf.plot_kweb(). 
-0000dcb0: 2020 2020 2020 2065 6c69 6620 706c 6f74         elif plot
-0000dcc0: 7465 7220 3d3d 2022 7769 6467 6574 223a  ter == "widget":
-0000dcd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000dce0: 662e 706c 6f74 5f77 6964 6765 7428 290a  f.plot_widget().
-0000dcf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000dd00: 726e 0a0a 2020 2020 2020 2020 656c 6966  rn..        elif
-0000dd10: 2070 6c6f 7474 6572 203d 3d20 226d 6174   plotter == "mat
-0000dd20: 706c 6f74 6c69 6222 3a0a 2020 2020 2020  plotlib":.      
-0000dd30: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-0000dd40: 6374 6f72 792e 7175 6963 6b70 6c6f 7474  ctory.quickplott
-0000dd50: 6572 2069 6d70 6f72 7420 7175 6963 6b70  er import quickp
-0000dd60: 6c6f 740a 0a20 2020 2020 2020 2020 2020  lot..           
-0000dd70: 2071 7569 636b 706c 6f74 2873 656c 662c   quickplot(self,
-0000dd80: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-0000dd90: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-0000dda0: 2020 2020 2020 2065 6c69 6620 706c 6f74         elif plot
-0000ddb0: 7465 7220 3d3d 2022 686f 6c6f 7669 6577  ter == "holoview
-0000ddc0: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-0000ddd0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000dde0: 2020 2020 2069 6d70 6f72 7420 686f 6c6f       import holo
-0000ddf0: 7669 6577 7320 6173 2068 760a 0a20 2020  views as hv..   
-0000de00: 2020 2020 2020 2020 2020 2020 2068 762e               hv.
-0000de10: 6578 7465 6e73 696f 6e28 2262 6f6b 6568  extension("bokeh
-0000de20: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-0000de30: 7863 6570 7420 496d 706f 7274 4572 726f  xcept ImportErro
-0000de40: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0000de50: 2020 2020 2020 2020 7072 696e 7428 2279          print("y
-0000de60: 6f75 206e 6565 6420 746f 2060 7069 7020  ou need to `pip 
-0000de70: 696e 7374 616c 6c20 686f 6c6f 7669 6577  install holoview
-0000de80: 7360 2229 0a20 2020 2020 2020 2020 2020  s`").           
-0000de90: 2020 2020 2072 6169 7365 2065 0a20 2020       raise e.   
-0000dea0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000deb0: 7365 6c66 2e70 6c6f 745f 686f 6c6f 7669  self.plot_holovi
-0000dec0: 6577 7328 2a2a 6b77 6172 6773 290a 0a20  ews(**kwargs).. 
-0000ded0: 2020 2020 2020 2065 6c69 6620 706c 6f74         elif plot
-0000dee0: 7465 7220 3d3d 2022 7174 223a 0a20 2020  ter == "qt":.   
-0000def0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000df00: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-0000df10: 2020 2020 2020 2020 2271 7420 706c 6f74          "qt plot
-0000df20: 7465 7220 6973 2064 6570 7265 6361 7465  ter is deprecate
-0000df30: 642e 2022 0a20 2020 2020 2020 2020 2020  d. ".           
-0000df40: 2020 2020 2022 5573 6520 7468 6520 6465       "Use the de
-0000df50: 6661 756c 7420 436f 6d70 6f6e 656e 742e  fault Component.
-0000df60: 706c 6f74 2829 2c20 436f 6d70 6f6e 656e  plot(), Componen
-0000df70: 742e 706c 6f74 5f6b 6c61 796f 7574 2829  t.plot_klayout()
-0000df80: 206f 7220 436f 6d70 6f6e 656e 742e 706c   or Component.pl
-0000df90: 6f74 5f77 6964 6765 7428 2922 2c0a 2020  ot_widget()",.  
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0000dfb0: 6163 6b6c 6576 656c 3d33 2c0a 2020 2020  acklevel=3,.    
-0000dfc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000dfd0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-0000dfe0: 6374 6f72 792e 7175 6963 6b70 6c6f 7474  ctory.quickplott
-0000dff0: 6572 2069 6d70 6f72 7420 7175 6963 6b70  er import quickp
-0000e000: 6c6f 7432 0a0a 2020 2020 2020 2020 2020  lot2..          
-0000e010: 2020 7175 6963 6b70 6c6f 7432 2873 656c    quickplot2(sel
-0000e020: 6629 0a20 2020 2020 2020 2020 2020 2072  f).            r
-0000e030: 6574 7572 6e0a 0a20 2020 2064 6566 2070  eturn..    def p
-0000e040: 6c6f 745f 686f 6c6f 7669 6577 7328 0a20  lot_holoviews(. 
-0000e050: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000e060: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
-0000e070: 7564 6564 3a20 4c61 7965 7273 207c 204e  uded: Layers | N
-0000e080: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-0000e090: 2020 2020 6c61 7965 725f 7669 6577 733a      layer_views:
-0000e0a0: 204c 6179 6572 5669 6577 7320 7c20 4e6f   LayerViews | No
-0000e0b0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-0000e0c0: 2020 206d 696e 5f61 7370 6563 743a 2066     min_aspect: f
-0000e0d0: 6c6f 6174 203d 2030 2e32 352c 0a20 2020  loat = 0.25,.   
-0000e0e0: 2020 2020 2070 6164 6469 6e67 3a20 666c       padding: fl
-0000e0f0: 6f61 7420 3d20 302e 352c 0a20 2020 2029  oat = 0.5,.    )
-0000e100: 3a0a 2020 2020 2020 2020 2222 2250 6c6f  :.        """Plo
-0000e110: 7420 636f 6d70 6f6e 656e 7420 696e 2068  t component in h
-0000e120: 6f6c 6f76 6965 7773 2e0a 0a20 2020 2020  oloviews...     
-0000e130: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000e140: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
-0000e150: 7564 6564 3a20 6c69 7374 206f 6620 6c61  uded: list of la
-0000e160: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
-0000e170: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-0000e180: 6572 5f76 6965 7773 3a20 6c61 7965 725f  er_views: layer_
-0000e190: 7669 6577 7320 636f 6c6f 7273 206c 6f61  views colors loa
-0000e1a0: 6465 6420 6672 6f6d 204b 6c61 796f 7574  ded from Klayout
-0000e1b0: 2e0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
-0000e1c0: 6e5f 6173 7065 6374 3a20 6d69 6e69 6d75  n_aspect: minimu
-0000e1d0: 6d20 6173 7065 6374 2072 6174 696f 2e0a  m aspect ratio..
-0000e1e0: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-0000e1f0: 696e 673a 2061 726f 756e 6420 626f 756e  ing: around boun
-0000e200: 6469 6e67 2062 6f78 2e0a 0a20 2020 2020  ding box...     
-0000e210: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
-0000e220: 2020 2020 2020 2020 486f 6c6f 7669 6577          Holoview
-0000e230: 7320 4f76 6572 6c61 7920 746f 2064 6973  s Overlay to dis
-0000e240: 706c 6179 2061 6c6c 2070 6f6c 7967 6f6e  play all polygon
-0000e250: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-0000e260: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000e270: 6163 746f 7279 2e61 6464 5f70 696e 7320  actory.add_pins 
-0000e280: 696d 706f 7274 2067 6574 5f70 696e 5f74  import get_pin_t
-0000e290: 7269 616e 676c 655f 706f 6c79 676f 6e5f  riangle_polygon_
-0000e2a0: 7469 700a 2020 2020 2020 2020 6672 6f6d  tip.        from
-0000e2b0: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
-0000e2c0: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
-0000e2d0: 5f76 6965 7773 0a0a 2020 2020 2020 2020  _views..        
-0000e2e0: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-0000e2f0: 2020 2020 2020 2020 2020 2022 686f 6c6f             "holo
-0000e300: 7669 6577 7320 706c 6f74 7465 7220 6973  views plotter is
-0000e310: 2064 6570 7265 6361 7465 642e 2022 0a20   deprecated. ". 
-0000e320: 2020 2020 2020 2020 2020 2022 5573 6520             "Use 
-0000e330: 7468 6520 6465 6661 756c 7420 436f 6d70  the default Comp
-0000e340: 6f6e 656e 742e 706c 6f74 2829 2c20 436f  onent.plot(), Co
-0000e350: 6d70 6f6e 656e 742e 706c 6f74 5f6b 6c61  mponent.plot_kla
-0000e360: 796f 7574 2829 206f 7220 436f 6d70 6f6e  yout() or Compon
-0000e370: 656e 742e 706c 6f74 5f77 6964 6765 7428  ent.plot_widget(
-0000e380: 2922 2c0a 2020 2020 2020 2020 2020 2020  )",.            
-0000e390: 7374 6163 6b6c 6576 656c 3d33 2c0a 2020  stacklevel=3,.  
-0000e3a0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000e3b0: 2069 6620 6c61 7965 725f 7669 6577 7320   if layer_views 
-0000e3c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000e3d0: 2020 2020 206c 6179 6572 5f76 6965 7773       layer_views
-0000e3e0: 203d 2067 6574 5f6c 6179 6572 5f76 6965   = get_layer_vie
-0000e3f0: 7773 2829 0a0a 2020 2020 2020 2020 7472  ws()..        tr
-0000e400: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-0000e410: 6d70 6f72 7420 686f 6c6f 7669 6577 7320  mport holoviews 
-0000e420: 6173 2068 760a 0a20 2020 2020 2020 2020  as hv..         
-0000e430: 2020 2068 762e 6578 7465 6e73 696f 6e28     hv.extension(
-0000e440: 2262 6f6b 6568 2229 0a20 2020 2020 2020  "bokeh").       
-0000e450: 2065 7863 6570 7420 496d 706f 7274 4572   except ImportEr
-0000e460: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-0000e470: 2020 2020 2020 7072 696e 7428 2279 6f75        print("you
-0000e480: 206e 6565 6420 746f 2060 7069 7020 696e   need to `pip in
-0000e490: 7374 616c 6c20 686f 6c6f 7669 6577 7360  stall holoviews`
-0000e4a0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0000e4b0: 6169 7365 2065 0a0a 2020 2020 2020 2020  aise e..        
-0000e4c0: 7365 6c66 2e5f 6262 5f76 616c 6964 203d  self._bb_valid =
-0000e4d0: 2046 616c 7365 2020 2320 7265 636f 6d70   False  # recomp
-0000e4e0: 7574 6520 7468 6520 626f 756e 6469 6e67  ute the bounding
-0000e4f0: 2062 6f78 0a20 2020 2020 2020 2062 203d   box.        b =
-0000e500: 2073 656c 662e 6262 6f78 202b 2028 282d   self.bbox + ((-
-0000e510: 7061 6464 696e 672c 202d 7061 6464 696e  padding, -paddin
-0000e520: 6729 2c20 2870 6164 6469 6e67 2c20 7061  g), (padding, pa
-0000e530: 6464 696e 6729 290a 2020 2020 2020 2020  dding)).        
-0000e540: 6220 3d20 6e70 2e61 7272 6179 2862 2e66  b = np.array(b.f
-0000e550: 6c61 7429 0a20 2020 2020 2020 2063 656e  lat).        cen
-0000e560: 7465 7220 3d20 6e70 2e61 7272 6179 2828  ter = np.array((
-0000e570: 6e70 2e73 756d 2862 5b3a 3a32 5d29 202f  np.sum(b[::2]) /
-0000e580: 2032 2c20 6e70 2e73 756d 2862 5b31 3a3a   2, np.sum(b[1::
-0000e590: 325d 2920 2f20 3229 290a 2020 2020 2020  2]) / 2)).      
-0000e5a0: 2020 7369 7a65 203d 206e 702e 6172 7261    size = np.arra
-0000e5b0: 7928 286e 702e 6162 7328 625b 325d 202d  y((np.abs(b[2] -
-0000e5c0: 2062 5b30 5d29 2c20 6e70 2e61 6273 2862   b[0]), np.abs(b
-0000e5d0: 5b33 5d20 2d20 625b 315d 2929 290a 2020  [3] - b[1]))).  
-0000e5e0: 2020 2020 2020 6478 203d 206e 702e 6172        dx = np.ar
-0000e5f0: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
-0000e600: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000e610: 2020 206e 702e 6d61 7869 6d75 6d28 6d69     np.maximum(mi
-0000e620: 6e5f 6173 7065 6374 202a 2073 697a 655b  n_aspect * size[
-0000e630: 315d 2c20 7369 7a65 5b30 5d29 202f 2032  1], size[0]) / 2
-0000e640: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e650: 2020 6e70 2e6d 6178 696d 756d 2873 697a    np.maximum(siz
-0000e660: 655b 315d 2c20 6d69 6e5f 6173 7065 6374  e[1], min_aspect
-0000e670: 202a 2073 697a 655b 305d 2920 2f20 322c   * size[0]) / 2,
-0000e680: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000e690: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000e6a0: 2062 203d 206e 702e 6873 7461 636b 2828   b = np.hstack((
-0000e6b0: 6365 6e74 6572 202d 2064 782c 2063 656e  center - dx, cen
-0000e6c0: 7465 7220 2b20 6478 2929 0a0a 2020 2020  ter + dx))..    
-0000e6d0: 2020 2020 706c 6f74 735f 746f 5f6f 7665      plots_to_ove
-0000e6e0: 726c 6179 203d 205b 5d0a 2020 2020 2020  rlay = [].      
-0000e6f0: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
-0000e700: 6420 3d20 5b5d 2069 6620 6c61 7965 7273  d = [] if layers
-0000e710: 5f65 7863 6c75 6465 6420 6973 204e 6f6e  _excluded is Non
-0000e720: 6520 656c 7365 206c 6179 6572 735f 6578  e else layers_ex
-0000e730: 636c 7564 6564 0a0a 2020 2020 2020 2020  cluded..        
-0000e740: 666f 7220 6c61 7965 722c 2070 6f6c 7967  for layer, polyg
-0000e750: 6f6e 2069 6e20 7365 6c66 2e67 6574 5f70  on in self.get_p
-0000e760: 6f6c 7967 6f6e 7328 6279 5f73 7065 633d  olygons(by_spec=
-0000e770: 5472 7565 292e 6974 656d 7328 293a 0a20  True).items():. 
-0000e780: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
-0000e790: 7965 7220 696e 206c 6179 6572 735f 6578  yer in layers_ex
-0000e7a0: 636c 7564 6564 3a0a 2020 2020 2020 2020  cluded:.        
-0000e7b0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0000e7c0: 0a0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-0000e7d0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000e7e0: 2020 206c 6179 6572 5f76 6965 7720 3d20     layer_view = 
-0000e7f0: 6c61 7965 725f 7669 6577 732e 6765 745f  layer_views.get_
-0000e800: 6672 6f6d 5f74 7570 6c65 286c 6179 6572  from_tuple(layer
-0000e810: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0000e820: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-0000e830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e840: 206c 6179 6572 7320 3d20 6c69 7374 286c   layers = list(l
-0000e850: 6179 6572 5f76 6965 7773 2e67 6574 5f6c  ayer_views.get_l
-0000e860: 6179 6572 5f76 6965 7773 2829 2e6b 6579  ayer_views().key
-0000e870: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-0000e880: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-0000e890: 726e 2866 227b 6c61 7965 7221 727d 206e  rn(f"{layer!r} n
-0000e8a0: 6f74 2064 6566 696e 6564 2069 6e20 7b6c  ot defined in {l
-0000e8b0: 6179 6572 737d 222c 2073 7461 636b 6c65  ayers}", stackle
-0000e8c0: 7665 6c3d 3329 0a20 2020 2020 2020 2020  vel=3).         
-0000e8d0: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-0000e8e0: 7720 3d20 4c61 7965 7256 6965 7728 6c61  w = LayerView(la
-0000e8f0: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
-0000e900: 2020 2020 2020 2023 2054 4f44 4f3a 204d         # TODO: M
-0000e910: 6174 6368 2075 7020 6f70 7469 6f6e 7320  atch up options 
-0000e920: 7769 7468 204c 6179 6572 5669 6577 730a  with LayerViews.
-0000e930: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
-0000e940: 735f 746f 5f6f 7665 726c 6179 2e61 7070  s_to_overlay.app
-0000e950: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-0000e960: 2020 2020 2068 762e 506f 6c79 676f 6e73       hv.Polygons
-0000e970: 2870 6f6c 7967 6f6e 2c20 6c61 6265 6c3d  (polygon, label=
-0000e980: 7374 7228 6c61 7965 725f 7669 6577 2e6e  str(layer_view.n
-0000e990: 616d 6529 292e 6f70 7473 280a 2020 2020  ame)).opts(.    
-0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9b0: 6461 7461 5f61 7370 6563 743d 312c 0a20  data_aspect=1,. 
-0000e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9d0: 2020 2066 7261 6d65 5f77 6964 7468 3d35     frame_width=5
-0000e9e0: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
-0000e9f0: 2020 2020 2020 2020 796c 696d 3d28 625b          ylim=(b[
-0000ea00: 315d 2c20 625b 335d 292c 0a20 2020 2020  1], b[3]),.     
-0000ea10: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0000ea20: 6c69 6d3d 2862 5b30 5d2c 2062 5b32 5d29  lim=(b[0], b[2])
-0000ea30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ea40: 2020 2020 2020 6669 6c6c 5f63 6f6c 6f72        fill_color
-0000ea50: 3d6c 6179 6572 5f76 6965 772e 6669 6c6c  =layer_view.fill
-0000ea60: 5f63 6f6c 6f72 2e61 735f 7267 6228 2920  _color.as_rgb() 
-0000ea70: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
-0000ea80: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-0000ea90: 636f 6c6f 723d 6c61 7965 725f 7669 6577  color=layer_view
-0000eaa0: 2e66 7261 6d65 5f63 6f6c 6f72 2e61 735f  .frame_color.as_
-0000eab0: 7267 6228 2920 6f72 2022 222c 0a20 2020  rgb() or "",.   
-0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 2066 696c 6c5f 616c 7068 613d 6c61 7965   fill_alpha=laye
-0000eae0: 725f 7669 6577 2e67 6574 5f61 6c70 6861  r_view.get_alpha
-0000eaf0: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0000eb10: 6e65 5f61 6c70 6861 3d6c 6179 6572 5f76  ne_alpha=layer_v
-0000eb20: 6965 772e 6765 745f 616c 7068 6128 2920  iew.get_alpha() 
-0000eb30: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
-0000eb40: 2020 2020 2020 2020 2020 2074 6f6f 6c73             tools
-0000eb50: 3d5b 2268 6f76 6572 225d 2c0a 2020 2020  =["hover"],.    
-0000eb60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000eb70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000eb80: 2020 2020 666f 7220 6e61 6d65 2c20 706f      for name, po
-0000eb90: 7274 2069 6e20 7365 6c66 2e70 6f72 7473  rt in self.ports
-0000eba0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0000ebb0: 2020 2020 2020 6e61 6d65 203d 2073 7472        name = str
-0000ebc0: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
-0000ebd0: 2020 2070 6f6c 7967 6f6e 2c20 7074 6970     polygon, ptip
-0000ebe0: 203d 2067 6574 5f70 696e 5f74 7269 616e   = get_pin_trian
-0000ebf0: 676c 655f 706f 6c79 676f 6e5f 7469 7028  gle_polygon_tip(
-0000ec00: 706f 7274 3d70 6f72 7429 0a0a 2020 2020  port=port)..    
-0000ec10: 2020 2020 2020 2020 706c 6f74 735f 746f          plots_to
-0000ec20: 5f6f 7665 726c 6179 2e61 7070 656e 6428  _overlay.append(
-0000ec30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ec40: 2068 762e 506f 6c79 676f 6e73 2870 6f6c   hv.Polygons(pol
-0000ec50: 7967 6f6e 2c20 6c61 6265 6c3d 6e61 6d65  ygon, label=name
-0000ec60: 292e 6f70 7473 280a 2020 2020 2020 2020  ).opts(.        
-0000ec70: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000ec80: 5f61 7370 6563 743d 312c 0a20 2020 2020  _aspect=1,.     
-0000ec90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000eca0: 7261 6d65 5f77 6964 7468 3d35 3030 2c0a  rame_width=500,.
-0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecc0: 2020 2020 6669 6c6c 5f61 6c70 6861 3d30      fill_alpha=0
-0000ecd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ece0: 2020 2020 2020 796c 696d 3d28 625b 315d        ylim=(b[1]
-0000ecf0: 2c20 625b 335d 292c 0a20 2020 2020 2020  , b[3]),.       
-0000ed00: 2020 2020 2020 2020 2020 2020 2078 6c69               xli
-0000ed10: 6d3d 2862 5b30 5d2c 2062 5b32 5d29 2c0a  m=(b[0], b[2]),.
-0000ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed30: 2020 2020 636f 6c6f 723d 2272 6564 222c      color="red",
-0000ed40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed50: 2020 2020 206c 696e 655f 616c 7068 613d       line_alpha=
-0000ed60: 6c61 7965 725f 7669 6577 2e67 6574 5f61  layer_view.get_a
-0000ed70: 6c70 6861 2829 206f 7220 2222 2c0a 2020  lpha() or "",.  
-0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed90: 2020 746f 6f6c 733d 5b22 686f 7665 7222    tools=["hover"
-0000eda0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0000edb0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000edc0: 2020 2020 202a 2068 762e 5465 7874 2870       * hv.Text(p
-0000edd0: 7469 705b 305d 2c20 7074 6970 5b31 5d2c  tip[0], ptip[1],
-0000ede0: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
-0000edf0: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-0000ee00: 7475 726e 2068 762e 4f76 6572 6c61 7928  turn hv.Overlay(
-0000ee10: 706c 6f74 735f 746f 5f6f 7665 726c 6179  plots_to_overlay
-0000ee20: 292e 6f70 7473 280a 2020 2020 2020 2020  ).opts(.        
-0000ee30: 2020 2020 7368 6f77 5f6c 6567 656e 643d      show_legend=
-0000ee40: 5472 7565 2c20 7368 6172 6564 5f61 7865  True, shared_axe
-0000ee50: 733d 4661 6c73 652c 2079 6c69 6d3d 2862  s=False, ylim=(b
-0000ee60: 5b31 5d2c 2062 5b33 5d29 2c20 786c 696d  [1], b[3]), xlim
-0000ee70: 3d28 625b 305d 2c20 625b 325d 290a 2020  =(b[0], b[2]).  
-0000ee80: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0000ee90: 2073 686f 7728 0a20 2020 2020 2020 2073   show(.        s
-0000eea0: 656c 662c 0a20 2020 2020 2020 2073 686f  elf,.        sho
-0000eeb0: 775f 706f 7274 733a 2062 6f6f 6c20 3d20  w_ports: bool = 
-0000eec0: 4661 6c73 652c 0a20 2020 2020 2020 2073  False,.        s
-0000eed0: 686f 775f 7375 6270 6f72 7473 3a20 626f  how_subports: bo
-0000eee0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000eef0: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
-0000ef00: 6c61 7965 723a 204c 6179 6572 203d 2028  layer: Layer = (
-0000ef10: 312c 2031 3029 2c0a 2020 2020 2020 2020  1, 10),.        
-0000ef20: 2a2a 6b77 6172 6773 2c0a 2020 2020 2920  **kwargs,.    ) 
-0000ef30: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000ef40: 2022 2222 5368 6f77 2063 6f6d 706f 6e65   """Show compone
-0000ef50: 6e74 2069 6e20 4b4c 6179 6f75 742e 0a0a  nt in KLayout...
-0000ef60: 2020 2020 2020 2020 7265 7475 726e 7320          returns 
-0000ef70: 6120 636f 7079 206f 6620 7468 6520 436f  a copy of the Co
-0000ef80: 6d70 6f6e 656e 742c 2073 6f20 7468 6520  mponent, so the 
-0000ef90: 6f72 6967 696e 616c 2063 6f6d 706f 6e65  original compone
-0000efa0: 6e74 2072 656d 6169 6e73 2069 6e74 6163  nt remains intac
-0000efb0: 742e 0a20 2020 2020 2020 2077 6974 6820  t..        with 
-0000efc0: 7069 6e73 206d 6172 6b65 7273 206f 6e20  pins markers on 
-0000efd0: 6561 6368 2070 6f72 7420 7368 6f77 5f70  each port show_p
-0000efe0: 6f72 7473 203d 2054 7275 652c 2061 6e64  orts = True, and
-0000eff0: 206f 7074 696f 6e61 6c6c 7920 616c 736f   optionally also
-0000f000: 0a20 2020 2020 2020 2074 6865 2070 6f72  .        the por
-0000f010: 7473 2066 726f 6d20 7468 6520 7265 6665  ts from the refe
-0000f020: 7265 6e63 6573 2028 7368 6f77 5f73 7562  rences (show_sub
-0000f030: 706f 7274 733d 5472 7565 290a 0a20 2020  ports=True)..   
-0000f040: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-0000f050: 2020 2020 2020 2073 686f 775f 706f 7274         show_port
-0000f060: 733a 2073 686f 7773 2063 6f6d 706f 6e65  s: shows compone
-0000f070: 6e74 2077 6974 6820 706f 7274 206d 6172  nt with port mar
-0000f080: 6b65 7273 2061 6e64 206c 6162 656c 732e  kers and labels.
-0000f090: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000f0a0: 775f 7375 6270 6f72 7473 3a20 6164 6420  w_subports: add 
-0000f0b0: 706f 7274 7320 6d61 726b 6572 7320 616e  ports markers an
-0000f0c0: 6420 6c61 6265 6c73 2074 6f20 7265 6665  d labels to refe
-0000f0d0: 7265 6e63 6573 2e0a 2020 2020 2020 2020  rences..        
-0000f0e0: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
-0000f0f0: 6c61 7965 723a 2066 6f72 2074 6865 2070  layer: for the p
-0000f100: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
-0000f110: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-0000f120: 2020 2020 2020 2020 2067 6473 7061 7468           gdspath
-0000f130: 3a20 4744 5320 6669 6c65 2070 6174 6820  : GDS file path 
-0000f140: 746f 2077 7269 7465 2074 6f2e 0a20 2020  to write to..   
-0000f150: 2020 2020 2020 2020 2067 6473 6469 723a           gdsdir:
-0000f160: 2064 6972 6563 746f 7279 2066 6f72 2074   directory for t
-0000f170: 6865 2047 4453 2066 696c 652e 2044 6566  he GDS file. Def
-0000f180: 6175 6c74 7320 746f 202f 746d 702f 2e0a  aults to /tmp/..
-0000f190: 2020 2020 2020 2020 2020 2020 756e 6974              unit
-0000f1a0: 3a20 756e 6974 2073 697a 6520 666f 7220  : unit size for 
-0000f1b0: 6f62 6a65 6374 7320 696e 206c 6962 7261  objects in libra
-0000f1c0: 7279 2e20 3175 6d20 6279 2064 6566 6175  ry. 1um by defau
-0000f1d0: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
-0000f1e0: 7072 6563 6973 696f 6e3a 2066 6f72 206f  precision: for o
-0000f1f0: 626a 6563 7420 6469 6d65 6e73 696f 6e73  bject dimensions
-0000f200: 2069 6e20 7468 6520 6c69 6272 6172 7920   in the library 
-0000f210: 286d 292e 2031 6e6d 2062 7920 6465 6661  (m). 1nm by defa
-0000f220: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
-0000f230: 2074 696d 6573 7461 6d70 3a20 4465 6661   timestamp: Defa
-0000f240: 756c 7473 2074 6f20 3230 3139 2d31 302d  ults to 2019-10-
-0000f250: 3235 2e20 4966 204e 6f6e 6520 7573 6573  25. If None uses
-0000f260: 2063 7572 7265 6e74 2074 696d 652e 0a20   current time.. 
-0000f270: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000f280: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000f290: 7279 2e61 6464 5f70 696e 7320 696d 706f  ry.add_pins impo
-0000f2a0: 7274 2061 6464 5f70 696e 735f 7472 6961  rt add_pins_tria
-0000f2b0: 6e67 6c65 0a20 2020 2020 2020 2066 726f  ngle.        fro
-0000f2c0: 6d20 6764 7366 6163 746f 7279 2e73 686f  m gdsfactory.sho
-0000f2d0: 7720 696d 706f 7274 2073 686f 770a 0a20  w import show.. 
-0000f2e0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-0000f2f0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0000f300: 2073 656c 662e 6164 645f 7069 6e73 5f74   self.add_pins_t
-0000f310: 7269 616e 676c 6528 0a20 2020 2020 2020  riangle(.       
-0000f320: 2020 2020 2020 2020 2070 6f72 745f 6d61           port_ma
-0000f330: 726b 6572 5f6c 6179 6572 3d70 6f72 745f  rker_layer=port_
-0000f340: 6d61 726b 6572 5f6c 6179 6572 2c20 6c61  marker_layer, la
-0000f350: 7965 725f 6c61 6265 6c3d 706f 7274 5f6d  yer_label=port_m
-0000f360: 6172 6b65 725f 6c61 7965 720a 2020 2020  arker_layer.    
-0000f370: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000f380: 2020 2020 2020 6966 2073 686f 775f 706f        if show_po
-0000f390: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
-0000f3a0: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
-0000f3b0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000f3c0: 7368 6f77 5f73 7562 706f 7274 733a 0a20  show_subports:. 
-0000f3d0: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-0000f3e0: 6e65 6e74 203d 2073 656c 662e 636f 7079  nent = self.copy
-0000f3f0: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-0000f400: 6f6d 706f 6e65 6e74 2e6e 616d 6520 3d20  omponent.name = 
-0000f410: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
-0000f420: 2020 2020 2020 666f 7220 7265 6665 7265        for refere
-0000f430: 6e63 6520 696e 2063 6f6d 706f 6e65 6e74  nce in component
-0000f440: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
-0000f450: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000f460: 6973 696e 7374 616e 6365 2863 6f6d 706f  isinstance(compo
-0000f470: 6e65 6e74 2c20 436f 6d70 6f6e 656e 7452  nent, ComponentR
-0000f480: 6566 6572 656e 6365 293a 0a20 2020 2020  eference):.     
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000f4a0: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
-0000f4b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000f4c0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000f4d0: 656e 743d 636f 6d70 6f6e 656e 742c 0a20  ent=component,. 
-0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4f0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-0000f500: 3d72 6566 6572 656e 6365 2c0a 2020 2020  =reference,.    
-0000f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f520: 2020 2020 6c61 7965 723d 706f 7274 5f6d      layer=port_m
-0000f530: 6172 6b65 725f 6c61 7965 722c 0a20 2020  arker_layer,.   
-0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f550: 2020 2020 206c 6179 6572 5f6c 6162 656c       layer_label
-0000f560: 3d70 6f72 745f 6d61 726b 6572 5f6c 6179  =port_marker_lay
-0000f570: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-0000f580: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000f590: 2020 2073 686f 7728 636f 6d70 6f6e 656e     show(componen
-0000f5a0: 742c 202a 2a6b 7761 7267 7329 0a0a 2020  t, **kwargs)..  
-0000f5b0: 2020 6465 6620 5f77 7269 7465 5f6c 6962    def _write_lib
-0000f5c0: 7261 7279 280a 2020 2020 2020 2020 7365  rary(.        se
-0000f5d0: 6c66 2c0a 2020 2020 2020 2020 6764 7370  lf,.        gdsp
-0000f5e0: 6174 683a 2050 6174 6854 7970 6520 7c20  ath: PathType | 
-0000f5f0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0000f600: 2020 2020 2067 6473 6469 723a 2050 6174       gdsdir: Pat
-0000f610: 6854 7970 6520 7c20 4e6f 6e65 203d 204e  hType | None = N
-0000f620: 6f6e 652c 0a20 2020 2020 2020 2074 696d  one,.        tim
-0000f630: 6573 7461 6d70 3a20 6461 7465 7469 6d65  estamp: datetime
-0000f640: 2e64 6174 6574 696d 6520 7c20 4e6f 6e65  .datetime | None
-0000f650: 203d 205f 7469 6d65 7374 616d 7032 3031   = _timestamp201
-0000f660: 392c 0a20 2020 2020 2020 206c 6f67 6769  9,.        loggi
-0000f670: 6e67 3a20 626f 6f6c 203d 2054 7275 652c  ng: bool = True,
-0000f680: 0a20 2020 2020 2020 2077 6974 685f 6f61  .        with_oa
-0000f690: 7369 733a 2062 6f6f 6c20 3d20 4661 6c73  sis: bool = Fals
-0000f6a0: 652c 0a20 2020 2020 2020 2077 6974 685f  e,.        with_
-0000f6b0: 6d65 7461 6461 7461 3a20 626f 6f6c 203d  metadata: bool =
-0000f6c0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0000f6d0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2920  **kwargs,.    ) 
-0000f6e0: 2d3e 2050 6174 683a 0a20 2020 2020 2020  -> Path:.       
-0000f6f0: 2022 2222 5772 6974 6520 636f 6d70 6f6e   """Write compon
-0000f700: 656e 7420 746f 2047 4453 206f 7220 4f41  ent to GDS or OA
-0000f710: 5349 5320 616e 6420 7265 7475 726e 7320  SIS and returns 
-0000f720: 6764 7370 6174 682e 0a0a 2020 2020 2020  gdspath...      
-0000f730: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000f740: 2020 2020 6764 7370 6174 683a 2047 4453      gdspath: GDS
-0000f750: 2066 696c 6520 7061 7468 2074 6f20 7772   file path to wr
-0000f760: 6974 6520 746f 2e0a 2020 2020 2020 2020  ite to..        
-0000f770: 2020 2020 6764 7364 6972 3a20 6469 7265      gdsdir: dire
-0000f780: 6374 6f72 7920 666f 7220 7468 6520 4744  ctory for the GD
-0000f790: 5320 6669 6c65 2e20 4465 6661 756c 7473  S file. Defaults
-0000f7a0: 2074 6f20 2f74 6d70 2f72 616e 646f 6d46   to /tmp/randomF
-0000f7b0: 696c 652f 6764 7366 6163 746f 7279 2e0a  ile/gdsfactory..
-0000f7c0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-0000f7d0: 7374 616d 703a 2044 6566 6175 6c74 7320  stamp: Defaults 
-0000f7e0: 746f 2032 3031 392d 3130 2d32 3520 666f  to 2019-10-25 fo
-0000f7f0: 7220 636f 6e73 6973 7465 6e74 2068 6173  r consistent has
-0000f800: 682e 0a20 2020 2020 2020 2020 2020 2020  h..             
-0000f810: 2020 2049 6620 4e6f 6e65 2075 7365 7320     If None uses 
-0000f820: 6375 7272 656e 7420 7469 6d65 2e0a 2020  current time..  
-0000f830: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-0000f840: 673a 2064 6973 6162 6c65 2047 4453 2070  g: disable GDS p
-0000f850: 6174 6820 6c6f 6767 696e 672c 2066 6f72  ath logging, for
-0000f860: 2065 7861 6d70 6c65 2066 6f72 2073 686f   example for sho
-0000f870: 7769 6e67 2069 7420 696e 204b 4c61 796f  wing it in KLayo
-0000f880: 7574 2e0a 2020 2020 2020 2020 2020 2020  ut..            
-0000f890: 7769 7468 5f6f 6173 6973 3a20 4966 2054  with_oasis: If T
-0000f8a0: 7275 652c 2066 696c 6520 7769 6c6c 2062  rue, file will b
-0000f8b0: 6520 7772 6974 7465 6e20 746f 204f 4153  e written to OAS
-0000f8c0: 4953 2e20 4f74 6865 7277 6973 652c 2066  IS. Otherwise, f
-0000f8d0: 696c 6520 7769 6c6c 2062 6520 7772 6974  ile will be writ
-0000f8e0: 7465 6e20 746f 2047 4453 2e0a 2020 2020  ten to GDS..    
-0000f8f0: 2020 2020 2020 2020 7769 7468 5f6d 6574          with_met
-0000f900: 6164 6174 613a 2077 7269 7465 7320 6d65  adata: writes me
-0000f910: 7461 6461 7461 2069 6e20 5941 4d4c 2066  tadata in YAML f
-0000f920: 6f72 6d61 742e 0a0a 2020 2020 2020 2020  ormat...        
-0000f930: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
-0000f940: 2020 2020 2020 2020 2020 4b65 7977 6f72            Keywor
-0000f950: 6420 6172 6775 6d65 6e74 7320 7769 6c6c  d arguments will
-0000f960: 206f 7665 7272 6964 6520 7468 6520 6163   override the ac
-0000f970: 7469 7665 2050 444b 2773 2064 6566 6175  tive PDK's defau
-0000f980: 6c74 2047 6473 5772 6974 6553 6574 7469  lt GdsWriteSetti
-0000f990: 6e67 7320 616e 6420 4f61 7369 7357 7269  ngs and OasisWri
-0000f9a0: 7465 5365 7474 696e 6773 2e0a 0a20 2020  teSettings...   
-0000f9b0: 2020 2020 2020 2020 2047 6473 2073 6574           Gds set
-0000f9c0: 7469 6e67 733a 0a20 2020 2020 2020 2020  tings:.         
-0000f9d0: 2020 2020 2020 2075 6e69 743a 2075 6e69         unit: uni
-0000f9e0: 7420 7369 7a65 2066 6f72 206f 626a 6563  t size for objec
-0000f9f0: 7473 2069 6e20 6c69 6272 6172 792e 2031  ts in library. 1
-0000fa00: 756d 2062 7920 6465 6661 756c 742e 0a20  um by default.. 
-0000fa10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000fa20: 7265 6369 7369 6f6e 3a20 666f 7220 6469  recision: for di
-0000fa30: 6d65 6e73 696f 6e73 2069 6e20 7468 6520  mensions in the 
-0000fa40: 6c69 6272 6172 7920 286d 292e 2031 6e6d  library (m). 1nm
-0000fa50: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
-0000fa60: 2020 2020 2020 2020 2020 2020 206f 6e5f               on_
-0000fa70: 6475 706c 6963 6174 655f 6365 6c6c 3a20  duplicate_cell: 
-0000fa80: 7370 6563 6966 7920 686f 7720 746f 2072  specify how to r
-0000fa90: 6573 6f6c 7665 2064 7570 6c69 6361 7465  esolve duplicate
-0000faa0: 2d6e 616d 6564 2063 656c 6c73 2e20 4368  -named cells. Ch
-0000fab0: 6f6f 7365 206f 6e65 206f 6620 7468 6520  oose one of the 
-0000fac0: 666f 6c6c 6f77 696e 673a 0a20 2020 2020  following:.     
-0000fad0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fae0: 7761 726e 2220 2864 6566 6175 6c74 293a  warn" (default):
-0000faf0: 206f 7665 7277 7269 7465 2061 6c6c 2064   overwrite all d
-0000fb00: 7570 6c69 6361 7465 2063 656c 6c73 2077  uplicate cells w
-0000fb10: 6974 6820 6f6e 6520 6f66 2074 6865 2064  ith one of the d
-0000fb20: 7570 6c69 6361 7465 7320 2861 7262 6974  uplicates (arbit
-0000fb30: 7261 7269 6c79 292e 0a20 2020 2020 2020  rarily)..       
-0000fb40: 2020 2020 2020 2020 2020 2020 2022 6572               "er
-0000fb50: 726f 7222 3a20 7468 726f 7720 6120 5661  ror": throw a Va
-0000fb60: 6c75 6545 7272 6f72 2077 6865 6e20 6174  lueError when at
-0000fb70: 7465 6d70 7469 6e67 2074 6f20 7772 6974  tempting to writ
-0000fb80: 6520 6120 6764 7320 7769 7468 2064 7570  e a gds with dup
-0000fb90: 6c69 6361 7465 2063 656c 6c73 2e0a 2020  licate cells..  
-0000fba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbb0: 2020 226f 7665 7277 7269 7465 223a 206f    "overwrite": o
-0000fbc0: 7665 7277 7269 7465 2061 6c6c 2064 7570  verwrite all dup
-0000fbd0: 6c69 6361 7465 2063 656c 6c73 2077 6974  licate cells wit
-0000fbe0: 6820 6f6e 6520 6f66 2074 6865 2064 7570  h one of the dup
-0000fbf0: 6c69 6361 7465 732c 2077 6974 686f 7574  licates, without
-0000fc00: 2077 6172 6e69 6e67 2e0a 2020 2020 2020   warning..      
-0000fc10: 2020 2020 2020 2020 2020 2020 2020 4e6f                No
-0000fc20: 6e65 3a20 646f 206e 6f74 2074 7279 2074  ne: do not try t
-0000fc30: 6f20 7265 736f 6c76 6520 2861 7420 796f  o resolve (at yo
-0000fc40: 7572 206f 776e 2072 6973 6b21 290a 2020  ur own risk!).  
-0000fc50: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-0000fc60: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
-0000fc70: 6673 3a20 666c 6174 7465 6e73 2063 6f6d  fs: flattens com
-0000fc80: 706f 6e65 6e74 2072 6566 6572 656e 6365  ponent reference
-0000fc90: 7320 7768 6963 6820 6861 7665 2069 6e76  s which have inv
-0000fca0: 616c 6964 2074 7261 6e73 666f 726d 6174  alid transformat
-0000fcb0: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
-0000fcc0: 2020 2020 2020 6d61 785f 706f 696e 7473        max_points
-0000fcd0: 3a20 4d61 7869 6d61 6c20 6e75 6d62 6572  : Maximal number
-0000fce0: 206f 6620 7665 7274 6963 6573 2070 6572   of vertices per
-0000fcf0: 2070 6f6c 7967 6f6e 2e20 506f 6c79 676f   polygon. Polygo
-0000fd00: 6e73 2077 6974 6820 6d6f 7265 2076 6572  ns with more ver
-0000fd10: 7469 6365 7320 7468 6174 2074 6869 7320  tices that this 
-0000fd20: 6172 6520 6175 746f 6d61 7469 6361 6c6c  are automaticall
-0000fd30: 7920 6672 6163 7475 7265 642e 0a0a 2020  y fractured...  
-0000fd40: 2020 2020 2020 2020 2020 4f61 7369 7320            Oasis 
-0000fd50: 7365 7474 696e 6773 3a0a 2020 2020 2020  settings:.      
-0000fd60: 2020 2020 2020 2020 2020 636f 6d70 7265            compre
-0000fd70: 7373 696f 6e5f 6c65 7665 6c3a 204c 6576  ssion_level: Lev
-0000fd80: 656c 206f 6620 636f 6d70 7265 7373 696f  el of compressio
-0000fd90: 6e20 666f 7220 6365 6c6c 7320 2862 6574  n for cells (bet
-0000fda0: 7765 656e 2030 2061 6e64 2039 292e 0a20  ween 0 and 9).. 
-0000fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdc0: 2020 2053 6574 7469 6e67 2074 6f20 3020     Setting to 0 
-0000fdd0: 7769 6c6c 2064 6973 6162 6c65 2063 656c  will disable cel
-0000fde0: 6c20 636f 6d70 7265 7373 696f 6e2c 2031  l compression, 1
-0000fdf0: 2067 6976 6573 2074 6865 2062 6573 7420   gives the best 
-0000fe00: 7370 6565 6420 616e 6420 392c 2074 6865  speed and 9, the
-0000fe10: 2062 6573 7420 636f 6d70 7265 7373 696f   best compressio
-0000fe20: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000fe30: 2020 2064 6574 6563 745f 7265 6374 616e     detect_rectan
-0000fe40: 676c 6573 3a20 5374 6f72 6520 7265 6374  gles: Store rect
-0000fe50: 616e 676c 6573 2069 6e20 636f 6d70 7265  angles in compre
-0000fe60: 7373 6564 2066 6f72 6d61 742e 0a20 2020  ssed format..   
-0000fe70: 2020 2020 2020 2020 2020 2020 2064 6574               det
-0000fe80: 6563 745f 7472 6170 657a 6f69 6473 3a20  ect_trapezoids: 
-0000fe90: 5374 6f72 6520 7472 6170 657a 6f69 6473  Store trapezoids
-0000fea0: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-0000feb0: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-0000fec0: 2020 2020 2020 2063 6972 636c 655f 746f         circle_to
-0000fed0: 6c65 7261 6e63 653a 2054 6f6c 6572 616e  lerance: Toleran
-0000fee0: 6365 2066 6f72 2064 6574 6563 7469 6e67  ce for detecting
-0000fef0: 2063 6972 636c 6573 2e20 4966 206c 6573   circles. If les
-0000ff00: 7320 6f72 2065 7175 616c 2074 6f20 302c  s or equal to 0,
-0000ff10: 206e 6f20 6465 7465 6374 696f 6e20 6973   no detection is
-0000ff20: 2070 6572 666f 726d 6564 2e20 4369 7263   performed. Circ
-0000ff30: 6c65 7320 6172 6520 7374 6f72 6564 2069  les are stored i
-0000ff40: 6e20 636f 6d70 7265 7373 6564 2066 6f72  n compressed for
-0000ff50: 6d61 742e 0a20 2020 2020 2020 2020 2020  mat..           
-0000ff60: 2020 2020 2076 616c 6964 6174 696f 6e20       validation 
-0000ff70: 2822 6372 6333 3222 2c20 2263 6865 636b  ("crc32", "check
-0000ff80: 7375 6d33 3222 2c20 4e6f 6e65 293a 2074  sum32", None): t
-0000ff90: 7970 6520 6f66 2076 616c 6964 6174 696f  ype of validatio
-0000ffa0: 6e20 746f 2069 6e63 6c75 6465 2069 6e20  n to include in 
-0000ffb0: 7468 6520 7361 7665 6420 6669 6c65 2e0a  the saved file..
-0000ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffd0: 7374 616e 6461 7264 5f70 726f 7065 7274  standard_propert
-0000ffe0: 6965 733a 2053 746f 7265 2073 7461 6e64  ies: Store stand
-0000fff0: 6172 6420 4f41 5349 5320 7072 6f70 6572  ard OASIS proper
-00010000: 7469 6573 2069 6e20 7468 6520 6669 6c65  ties in the file
-00010010: 2e0a 0a20 2020 2020 2020 2022 2222 0a0a  ...        """..
-00010020: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00010030: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
-00010040: 7274 2067 6574 5f61 6374 6976 655f 7064  rt get_active_pd
-00010050: 6b0a 0a20 2020 2020 2020 2069 6620 6764  k..        if gd
-00010060: 7370 6174 6820 616e 6420 6764 7364 6972  spath and gdsdir
-00010070: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
-00010080: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
-00010090: 2020 2020 2020 2020 2020 2020 2022 6764               "gd
-000100a0: 7370 6174 6820 616e 6420 6764 7364 6972  spath and gdsdir
-000100b0: 2068 6176 6520 626f 7468 2062 6565 6e20   have both been 
-000100c0: 7370 6563 6966 6965 642e 2067 6473 7061  specified. gdspa
-000100d0: 7468 2077 696c 6c20 7461 6b65 2070 7265  th will take pre
-000100e0: 6365 6465 6e63 6520 616e 6420 6764 7364  cedence and gdsd
-000100f0: 6972 2077 696c 6c20 6265 2069 676e 6f72  ir will be ignor
-00010100: 6564 2e22 2c0a 2020 2020 2020 2020 2020  ed.",.          
-00010110: 2020 2020 2020 7374 6163 6b6c 6576 656c        stacklevel
-00010120: 3d33 2c0a 2020 2020 2020 2020 2020 2020  =3,.            
-00010130: 290a 0a20 2020 2020 2020 2064 6566 6175  )..        defau
-00010140: 6c74 5f73 6574 7469 6e67 7320 3d20 6765  lt_settings = ge
-00010150: 745f 6163 7469 7665 5f70 646b 2829 2e67  t_active_pdk().g
-00010160: 6473 5f77 7269 7465 5f73 6574 7469 6e67  ds_write_setting
-00010170: 730a 2020 2020 2020 2020 6465 6661 756c  s.        defaul
-00010180: 745f 6f61 7369 735f 7365 7474 696e 6773  t_oasis_settings
-00010190: 203d 2067 6574 5f61 6374 6976 655f 7064   = get_active_pd
-000101a0: 6b28 292e 6f61 7369 735f 7365 7474 696e  k().oasis_settin
-000101b0: 6773 0a0a 2020 2020 2020 2020 6578 706c  gs..        expl
-000101c0: 6963 6974 5f67 6473 5f73 6574 7469 6e67  icit_gds_setting
-000101d0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-000101e0: 2020 6b3a 2076 0a20 2020 2020 2020 2020    k: v.         
-000101f0: 2020 2066 6f72 206b 2c20 7620 696e 206b     for k, v in k
-00010200: 7761 7267 732e 6974 656d 7328 290a 2020  wargs.items().  
-00010210: 2020 2020 2020 2020 2020 6966 2076 2069            if v i
-00010220: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206b  s not None and k
-00010230: 2069 6e20 6465 6661 756c 745f 7365 7474   in default_sett
-00010240: 696e 6773 2e64 6963 7428 290a 2020 2020  ings.dict().    
-00010250: 2020 2020 7d0a 2020 2020 2020 2020 6578      }.        ex
-00010260: 706c 6963 6974 5f6f 6173 5f73 6574 7469  plicit_oas_setti
-00010270: 6e67 7320 3d20 7b0a 2020 2020 2020 2020  ngs = {.        
-00010280: 2020 2020 6b3a 2076 0a20 2020 2020 2020      k: v.       
-00010290: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-000102a0: 206b 7761 7267 732e 6974 656d 7328 290a   kwargs.items().
-000102b0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-000102c0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000102d0: 206b 2069 6e20 6465 6661 756c 745f 6f61   k in default_oa
-000102e0: 7369 735f 7365 7474 696e 6773 2e64 6963  sis_settings.dic
-000102f0: 7428 290a 2020 2020 2020 2020 7d0a 2020  t().        }.  
-00010300: 2020 2020 2020 2320 7570 6461 7465 2074        # update t
-00010310: 6865 2077 7269 7465 2073 6574 7469 6e67  he write setting
-00010320: 7320 7769 7468 2061 6e79 2073 6574 7469  s with any setti
-00010330: 6e67 7320 6578 706c 6963 6974 6c79 2070  ngs explicitly p
-00010340: 6173 7365 640a 2020 2020 2020 2020 7772  assed.        wr
-00010350: 6974 655f 7365 7474 696e 6773 203d 2064  ite_settings = d
-00010360: 6566 6175 6c74 5f73 6574 7469 6e67 732e  efault_settings.
-00010370: 636f 7079 2875 7064 6174 653d 6578 706c  copy(update=expl
-00010380: 6963 6974 5f67 6473 5f73 6574 7469 6e67  icit_gds_setting
-00010390: 7329 0a20 2020 2020 2020 206f 6173 6973  s).        oasis
-000103a0: 5f73 6574 7469 6e67 7320 3d20 6465 6661  _settings = defa
-000103b0: 756c 745f 6f61 7369 735f 7365 7474 696e  ult_oasis_settin
-000103c0: 6773 2e63 6f70 7928 7570 6461 7465 3d65  gs.copy(update=e
-000103d0: 7870 6c69 6369 745f 6f61 735f 7365 7474  xplicit_oas_sett
-000103e0: 696e 6773 290a 0a20 2020 2020 2020 205f  ings)..        _
-000103f0: 6368 6563 6b5f 756e 6361 6368 6564 5f63  check_uncached_c
-00010400: 6f6d 706f 6e65 6e74 7328 0a20 2020 2020  omponents(.     
-00010410: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00010420: 3d73 656c 662c 206d 6f64 653d 7772 6974  =self, mode=writ
-00010430: 655f 7365 7474 696e 6773 2e6f 6e5f 756e  e_settings.on_un
-00010440: 6361 6368 6564 5f63 6f6d 706f 6e65 6e74  cached_component
-00010450: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00010460: 2020 2020 6966 2077 7269 7465 5f73 6574      if write_set
-00010470: 7469 6e67 732e 666c 6174 7465 6e5f 696e  tings.flatten_in
-00010480: 7661 6c69 645f 7265 6673 3a0a 2020 2020  valid_refs:.    
-00010490: 2020 2020 2020 2020 746f 705f 6365 6c6c          top_cell
-000104a0: 203d 2066 6c61 7474 656e 5f69 6e76 616c   = flatten_inval
-000104b0: 6964 5f72 6566 735f 7265 6375 7273 6976  id_refs_recursiv
-000104c0: 6528 7365 6c66 290a 2020 2020 2020 2020  e(self).        
-000104d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000104e0: 2020 746f 705f 6365 6c6c 203d 2073 656c    top_cell = sel
-000104f0: 660a 0a20 2020 2020 2020 2067 6473 6469  f..        gdsdi
-00010500: 7220 3d20 6764 7364 6972 206f 7220 4744  r = gdsdir or GD
-00010510: 5344 4952 5f54 454d 500a 2020 2020 2020  SDIR_TEMP.      
-00010520: 2020 6764 7364 6972 203d 2070 6174 686c    gdsdir = pathl
-00010530: 6962 2e50 6174 6828 6764 7364 6972 290a  ib.Path(gdsdir).
-00010540: 2020 2020 2020 2020 6966 2077 6974 685f          if with_
-00010550: 6f61 7369 733a 0a20 2020 2020 2020 2020  oasis:.         
-00010560: 2020 2067 6473 7061 7468 203d 2067 6473     gdspath = gds
-00010570: 7061 7468 206f 7220 6764 7364 6972 202f  path or gdsdir /
-00010580: 2066 227b 746f 705f 6365 6c6c 2e6e 616d   f"{top_cell.nam
-00010590: 657d 2e6f 6173 220a 2020 2020 2020 2020  e}.oas".        
-000105a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000105b0: 2020 6764 7370 6174 6820 3d20 6764 7370    gdspath = gdsp
-000105c0: 6174 6820 6f72 2067 6473 6469 7220 2f20  ath or gdsdir / 
-000105d0: 6622 7b74 6f70 5f63 656c 6c2e 6e61 6d65  f"{top_cell.name
-000105e0: 7d2e 6764 7322 0a20 2020 2020 2020 2067  }.gds".        g
-000105f0: 6473 7061 7468 203d 2070 6174 686c 6962  dspath = pathlib
-00010600: 2e50 6174 6828 6764 7370 6174 6829 0a20  .Path(gdspath). 
-00010610: 2020 2020 2020 2067 6473 6469 7220 3d20         gdsdir = 
-00010620: 6764 7370 6174 682e 7061 7265 6e74 0a20  gdspath.parent. 
-00010630: 2020 2020 2020 2067 6473 6469 722e 6d6b         gdsdir.mk
-00010640: 6469 7228 6578 6973 745f 6f6b 3d54 7275  dir(exist_ok=Tru
-00010650: 652c 2070 6172 656e 7473 3d54 7275 6529  e, parents=True)
-00010660: 0a0a 2020 2020 2020 2020 6365 6c6c 7320  ..        cells 
-00010670: 3d20 746f 705f 6365 6c6c 2e67 6574 5f64  = top_cell.get_d
-00010680: 6570 656e 6465 6e63 6965 7328 7265 6375  ependencies(recu
-00010690: 7273 6976 653d 5472 7565 290a 2020 2020  rsive=True).    
-000106a0: 2020 2020 6365 6c6c 5f6e 616d 6573 203d      cell_names =
-000106b0: 205b 6365 6c6c 2e6e 616d 6520 666f 7220   [cell.name for 
-000106c0: 6365 6c6c 2069 6e20 6c69 7374 2863 656c  cell in list(cel
-000106d0: 6c73 295d 0a20 2020 2020 2020 2063 656c  ls)].        cel
-000106e0: 6c5f 6e61 6d65 735f 756e 6971 7565 203d  l_names_unique =
-000106f0: 2073 6574 2863 656c 6c5f 6e61 6d65 7329   set(cell_names)
-00010700: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00010710: 2863 656c 6c5f 6e61 6d65 7329 2021 3d20  (cell_names) != 
-00010720: 6c65 6e28 7365 7428 6365 6c6c 5f6e 616d  len(set(cell_nam
-00010730: 6573 2929 3a0a 2020 2020 2020 2020 2020  es)):.          
-00010740: 2020 666f 7220 6365 6c6c 5f6e 616d 6520    for cell_name 
-00010750: 696e 2063 656c 6c5f 6e61 6d65 735f 756e  in cell_names_un
-00010760: 6971 7565 3a0a 2020 2020 2020 2020 2020  ique:.          
-00010770: 2020 2020 2020 6365 6c6c 5f6e 616d 6573        cell_names
-00010780: 2e72 656d 6f76 6528 6365 6c6c 5f6e 616d  .remove(cell_nam
-00010790: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-000107a0: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
-000107b0: 732e 6f6e 5f64 7570 6c69 6361 7465 5f63  s.on_duplicate_c
-000107c0: 656c 6c20 3d3d 2022 6572 726f 7222 3a0a  ell == "error":.
-000107d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107e0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000107f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00010800: 2020 2020 2020 6622 4475 706c 6963 6174        f"Duplicat
-00010810: 6564 2063 656c 6c20 6e61 6d65 7320 696e  ed cell names in
-00010820: 207b 746f 705f 6365 6c6c 2e6e 616d 6521   {top_cell.name!
-00010830: 727d 3a20 7b63 656c 6c5f 6e61 6d65 7321  r}: {cell_names!
-00010840: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
-00010850: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00010860: 2020 656c 6966 2077 7269 7465 5f73 6574    elif write_set
-00010870: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
-00010880: 7465 5f63 656c 6c20 696e 207b 2277 6172  te_cell in {"war
-00010890: 6e22 2c20 226f 7665 7277 7269 7465 227d  n", "overwrite"}
-000108a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000108b0: 2020 6966 2077 7269 7465 5f73 6574 7469    if write_setti
-000108c0: 6e67 732e 6f6e 5f64 7570 6c69 6361 7465  ngs.on_duplicate
-000108d0: 5f63 656c 6c20 3d3d 2022 7761 726e 223a  _cell == "warn":
-000108e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000108f0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00010900: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-00010910: 2020 2020 2020 2020 2020 2020 6622 4475              f"Du
-00010920: 706c 6963 6174 6564 2063 656c 6c20 6e61  plicated cell na
-00010930: 6d65 7320 696e 207b 746f 705f 6365 6c6c  mes in {top_cell
-00010940: 2e6e 616d 6521 727d 3a20 207b 6365 6c6c  .name!r}:  {cell
-00010950: 5f6e 616d 6573 7d22 2c0a 2020 2020 2020  _names}",.      
+00005b00: 722e 6f72 6967 696e 2c0a 2020 2020 2020  r.origin,.      
+00005b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b20: 2020 722e 726f 7461 7469 6f6e 2c0a 2020    r.rotation,.  
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 2020 2020 2020 722e 785f 7265 666c 6563        r.x_reflec
+00005b50: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+00005b60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b80: 6e65 775f 706f 7274 2e63 656e 7465 7220  new_port.center 
+00005b90: 3d20 6e65 775f 6365 6e74 6572 0a20 2020  = new_center.   
+00005ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bb0: 206e 6577 5f70 6f72 742e 6e65 775f 6f72   new_port.new_or
+00005bc0: 6965 6e74 6174 696f 6e20 3d20 6e65 775f  ientation = new_
+00005bd0: 6f72 6965 6e74 6174 696f 6e0a 2020 2020  orientation.    
+00005be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bf0: 7265 665f 706f 7274 735f 7472 616e 7366  ref_ports_transf
+00005c00: 6f72 6d65 642e 6170 7065 6e64 286e 6577  ormed.append(new
+00005c10: 5f70 6f72 7429 0a20 2020 2020 2020 2020  _port).         
+00005c20: 2020 2020 2020 2070 6f72 745f 6c69 7374         port_list
+00005c30: 202b 3d20 7265 665f 706f 7274 735f 7472   += ref_ports_tr
+00005c40: 616e 7366 6f72 6d65 640a 0a20 2020 2020  ansformed..     
+00005c50: 2020 2072 6574 7572 6e20 706f 7274 5f6c     return port_l
+00005c60: 6973 740a 0a20 2020 2064 6566 2067 6574  ist..    def get
+00005c70: 5f70 6f72 7473 5f64 6963 7428 7365 6c66  _ports_dict(self
+00005c80: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2064  , **kwargs) -> d
+00005c90: 6963 745b 7374 722c 2050 6f72 745d 3a0a  ict[str, Port]:.
+00005ca0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00005cb0: 6e73 2061 2064 6963 7420 6f66 2070 6f72  ns a dict of por
+00005cc0: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+00005cd0: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00005ce0: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+00005cf0: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00005d00: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00005d10: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00005d20: 6974 6820 7072 6566 6978 2069 6e20 706f  ith prefix in po
+00005d30: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
+00005d40: 2020 2020 2073 7566 6669 783a 2073 656c       suffix: sel
+00005d50: 6563 7420 706f 7274 7320 7769 7468 2070  ect ports with p
+00005d60: 6f72 7420 6e61 6d65 2073 7566 6669 782e  ort name suffix.
+00005d70: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00005d80: 656e 7461 7469 6f6e 3a20 7365 6c65 6374  entation: select
+00005d90: 2070 6f72 7473 2077 6974 6820 6f72 6965   ports with orie
+00005da0: 6e74 6174 696f 6e20 696e 2064 6567 7265  ntation in degre
+00005db0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+00005dc0: 7769 6474 683a 2073 656c 6563 7420 706f  width: select po
+00005dd0: 7274 7320 7769 7468 2070 6f72 7420 7769  rts with port wi
+00005de0: 6474 682e 0a20 2020 2020 2020 2020 2020  dth..           
+00005df0: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+00005e00: 3a20 4c69 7374 206f 6620 6c61 7965 7273  : List of layers
+00005e10: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+00005e20: 2020 2020 2020 2020 2070 6f72 745f 7479           port_ty
+00005e30: 7065 3a20 7365 6c65 6374 2070 6f72 7473  pe: select ports
+00005e40: 2077 6974 6820 706f 7274 5f74 7970 6520   with port_type 
+00005e50: 286f 7074 6963 616c 2c20 656c 6563 7472  (optical, electr
+00005e60: 6963 616c 2c20 7665 7274 6963 616c 5f74  ical, vertical_t
+00005e70: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
+00005e80: 636c 6f63 6b77 6973 653a 2069 6620 5472  clockwise: if Tr
+00005e90: 7565 2c20 736f 7274 2070 6f72 7473 2063  ue, sort ports c
+00005ea0: 6c6f 636b 7769 7365 2c20 4661 6c73 653a  lockwise, False:
+00005eb0: 2063 6f75 6e74 6572 2d63 6c6f 636b 7769   counter-clockwi
+00005ec0: 7365 2e0a 2020 2020 2020 2020 2222 220a  se..        """.
+00005ed0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00005ee0: 656c 6563 745f 706f 7274 7328 7365 6c66  elect_ports(self
+00005ef0: 2e70 6f72 7473 2c20 2a2a 6b77 6172 6773  .ports, **kwargs
+00005f00: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
+00005f10: 6f72 7473 5f6c 6973 7428 7365 6c66 2c20  orts_list(self, 
+00005f20: 2a2a 6b77 6172 6773 2920 2d3e 206c 6973  **kwargs) -> lis
+00005f30: 745b 506f 7274 5d3a 0a20 2020 2020 2020  t[Port]:.       
+00005f40: 2022 2222 5265 7475 726e 7320 6c69 7374   """Returns list
+00005f50: 206f 6620 706f 7274 732e 0a0a 2020 2020   of ports...    
+00005f60: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
+00005f70: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+00005f80: 7965 723a 2073 656c 6563 7420 706f 7274  yer: select port
+00005f90: 7320 7769 7468 2047 4453 206c 6179 6572  s with GDS layer
+00005fa0: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00005fb0: 6566 6978 3a20 7365 6c65 6374 2070 6f72  efix: select por
+00005fc0: 7473 2077 6974 6820 7072 6566 6978 2069  ts with prefix i
+00005fd0: 6e20 706f 7274 206e 616d 652e 0a20 2020  n port name..   
+00005fe0: 2020 2020 2020 2020 2073 7566 6669 783a           suffix:
+00005ff0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+00006000: 7468 2070 6f72 7420 6e61 6d65 2073 7566  th port name suf
+00006010: 6669 782e 0a20 2020 2020 2020 2020 2020  fix..           
+00006020: 206f 7269 656e 7461 7469 6f6e 3a20 7365   orientation: se
+00006030: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00006040: 6f72 6965 6e74 6174 696f 6e20 696e 2064  orientation in d
+00006050: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+00006060: 2020 2020 6f72 6965 6e74 6174 696f 6e3a      orientation:
+00006070: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+00006080: 7468 206f 7269 656e 7461 7469 6f6e 2069  th orientation i
+00006090: 6e20 6465 6772 6565 732e 0a20 2020 2020  n degrees..     
+000060a0: 2020 2020 2020 2077 6964 7468 3a20 7365         width: se
+000060b0: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+000060c0: 706f 7274 2077 6964 7468 2e0a 2020 2020  port width..    
+000060d0: 2020 2020 2020 2020 6c61 7965 7273 5f65          layers_e
+000060e0: 7863 6c75 6465 643a 204c 6973 7420 6f66  xcluded: List of
+000060f0: 206c 6179 6572 7320 746f 2065 7863 6c75   layers to exclu
+00006100: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
+00006110: 706f 7274 5f74 7970 653a 2073 656c 6563  port_type: selec
+00006120: 7420 706f 7274 7320 7769 7468 2070 6f72  t ports with por
+00006130: 745f 7479 7065 2028 6f70 7469 6361 6c2c  t_type (optical,
+00006140: 2065 6c65 6374 7269 6361 6c2c 2076 6572   electrical, ver
+00006150: 7469 6361 6c5f 7465 292e 0a20 2020 2020  tical_te)..     
+00006160: 2020 2020 2020 2063 6c6f 636b 7769 7365         clockwise
+00006170: 3a20 6966 2054 7275 652c 2073 6f72 7420  : if True, sort 
+00006180: 706f 7274 7320 636c 6f63 6b77 6973 652c  ports clockwise,
+00006190: 2046 616c 7365 3a20 636f 756e 7465 722d   False: counter-
+000061a0: 636c 6f63 6b77 6973 652e 0a20 2020 2020  clockwise..     
+000061b0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+000061c0: 6574 7572 6e20 6c69 7374 2873 656c 6563  eturn list(selec
+000061d0: 745f 706f 7274 7328 7365 6c66 2e70 6f72  t_ports(self.por
+000061e0: 7473 2c20 2a2a 6b77 6172 6773 292e 7661  ts, **kwargs).va
+000061f0: 6c75 6573 2829 290a 0a20 2020 2064 6566  lues())..    def
+00006200: 2067 6574 5f70 6f72 7473 5f70 616e 6461   get_ports_panda
+00006210: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00006220: 2069 6d70 6f72 7420 7061 6e64 6173 2061   import pandas a
+00006230: 7320 7064 0a0a 2020 2020 2020 2020 636f  s pd..        co
+00006240: 6c5f 7370 6563 203d 205b 0a20 2020 2020  l_spec = [.     
+00006250: 2020 2020 2020 2022 6e61 6d65 222c 0a20         "name",. 
+00006260: 2020 2020 2020 2020 2020 2022 7769 6474             "widt
+00006270: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+00006280: 2263 656e 7465 7222 2c0a 2020 2020 2020  "center",.      
+00006290: 2020 2020 2020 226f 7269 656e 7461 7469        "orientati
+000062a0: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
+000062b0: 2022 6c61 7965 7222 2c0a 2020 2020 2020   "layer",.      
+000062c0: 2020 2020 2020 2270 6f72 745f 7479 7065        "port_type
+000062d0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+000062e0: 7368 6561 725f 616e 676c 6522 2c0a 2020  shear_angle",.  
+000062f0: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+00006300: 2072 6574 7572 6e20 7064 2e44 6174 6146   return pd.DataF
+00006310: 7261 6d65 280a 2020 2020 2020 2020 2020  rame(.          
+00006320: 2020 5b70 6f72 742e 746f 5f64 6963 7428    [port.to_dict(
+00006330: 2920 666f 7220 706f 7274 2069 6e20 7365  ) for port in se
+00006340: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
+00006350: 7428 295d 2c20 636f 6c75 6d6e 733d 636f  t()], columns=co
+00006360: 6c5f 7370 6563 0a20 2020 2020 2020 2029  l_spec.        )
+00006370: 0a0a 2020 2020 6465 6620 6765 745f 706f  ..    def get_po
+00006380: 7274 735f 706f 6c61 7273 2873 656c 6629  rts_polars(self)
+00006390: 3a0a 2020 2020 2020 2020 696d 706f 7274  :.        import
+000063a0: 2070 6f6c 6172 7320 6173 2070 6c0a 0a20   polars as pl.. 
+000063b0: 2020 2020 2020 2063 6f6c 5f73 7065 6320         col_spec 
+000063c0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+000063d0: 226e 616d 6522 3a20 706c 2e55 7466 382c  "name": pl.Utf8,
+000063e0: 0a20 2020 2020 2020 2020 2020 2022 7769  .            "wi
+000063f0: 6474 6822 3a20 706c 2e46 6c6f 6174 3634  dth": pl.Float64
+00006400: 2c0a 2020 2020 2020 2020 2020 2020 2263  ,.            "c
+00006410: 656e 7465 7222 3a20 706c 2e4c 6973 7428  enter": pl.List(
+00006420: 706c 2e46 6c6f 6174 3634 292c 0a20 2020  pl.Float64),.   
+00006430: 2020 2020 2020 2020 2022 6f72 6965 6e74           "orient
+00006440: 6174 696f 6e22 3a20 706c 2e46 6c6f 6174  ation": pl.Float
+00006450: 3634 2c0a 2020 2020 2020 2020 2020 2020  64,.            
+00006460: 226c 6179 6572 223a 2070 6c2e 4c69 7374  "layer": pl.List
+00006470: 2870 6c2e 5549 6e74 3136 292c 0a20 2020  (pl.UInt16),.   
+00006480: 2020 2020 2020 2020 2022 706f 7274 5f74           "port_t
+00006490: 7970 6522 3a20 706c 2e55 7466 382c 0a20  ype": pl.Utf8,. 
+000064a0: 2020 2020 2020 2020 2020 2022 7368 6561             "shea
+000064b0: 725f 616e 676c 6522 3a20 706c 2e46 6c6f  r_angle": pl.Flo
+000064c0: 6174 3634 2c0a 2020 2020 2020 2020 7d0a  at64,.        }.
+000064d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000064e0: 706c 2e44 6174 6146 7261 6d65 280a 2020  pl.DataFrame(.  
+000064f0: 2020 2020 2020 2020 2020 5b70 6f72 742e            [port.
+00006500: 746f 5f64 6963 7428 2920 666f 7220 706f  to_dict() for po
+00006510: 7274 2069 6e20 7365 6c66 2e67 6574 5f70  rt in self.get_p
+00006520: 6f72 7473 5f6c 6973 7428 295d 2c20 7363  orts_list()], sc
+00006530: 6865 6d61 3d63 6f6c 5f73 7065 630a 2020  hema=col_spec.  
+00006540: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00006550: 2072 6566 280a 2020 2020 2020 2020 7365   ref(.        se
+00006560: 6c66 2c0a 2020 2020 2020 2020 706f 7369  lf,.        posi
+00006570: 7469 6f6e 3a20 436f 6f72 6469 6e61 7465  tion: Coordinate
+00006580: 203d 2028 302c 2030 292c 0a20 2020 2020   = (0, 0),.     
+00006590: 2020 2070 6f72 745f 6964 3a20 7374 7220     port_id: str 
+000065a0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+000065b0: 2020 2020 2020 2072 6f74 6174 696f 6e3a         rotation:
+000065c0: 2066 6c6f 6174 203d 2030 2c0a 2020 2020   float = 0,.    
+000065d0: 2020 2020 685f 6d69 7272 6f72 3a20 626f      h_mirror: bo
+000065e0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+000065f0: 2020 2020 765f 6d69 7272 6f72 3a20 626f      v_mirror: bo
+00006600: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00006610: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
+00006620: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
+00006630: 2022 2222 5265 7475 726e 7320 436f 6d70   """Returns Comp
+00006640: 6f6e 656e 7420 7265 6665 7265 6e63 652e  onent reference.
+00006650: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00006660: 2020 2020 2020 2020 2020 2020 706f 7369              posi
+00006670: 7469 6f6e 3a20 782c 2079 2070 6f73 6974  tion: x, y posit
+00006680: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+00006690: 2070 6f72 745f 6964 3a20 6e61 6d65 206f   port_id: name o
+000066a0: 6620 7468 6520 706f 7274 2e0a 2020 2020  f the port..    
+000066b0: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
+000066c0: 3a20 696e 2064 6567 7265 6573 2e0a 2020  : in degrees..  
+000066d0: 2020 2020 2020 2020 2020 685f 6d69 7272            h_mirr
+000066e0: 6f72 3a20 686f 7269 7a6f 6e74 616c 206d  or: horizontal m
+000066f0: 6972 726f 7220 7573 696e 6720 7920 6178  irror using y ax
+00006700: 6973 2028 782c 2031 2920 2831 2c20 3029  is (x, 1) (1, 0)
+00006710: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006720: 2020 5468 6973 2069 7320 7468 6520 6d6f    This is the mo
+00006730: 7374 2063 6f6d 6d6f 6e20 6d69 7272 6f72  st common mirror
+00006740: 2e0a 2020 2020 2020 2020 2020 2020 765f  ..            v_
+00006750: 6d69 7272 6f72 3a20 7665 7274 6963 616c  mirror: vertical
+00006760: 206d 6972 726f 7220 7573 696e 6720 7820   mirror using x 
+00006770: 6178 6973 2028 312c 2079 2920 2830 2c20  axis (1, y) (0, 
+00006780: 7929 2e0a 2020 2020 2020 2020 2222 220a  y)..        """.
+00006790: 2020 2020 2020 2020 5f72 6566 203d 2043          _ref = C
+000067a0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000067b0: 6528 7365 6c66 290a 0a20 2020 2020 2020  e(self)..       
+000067c0: 2069 6620 706f 7274 5f69 6420 616e 6420   if port_id and 
+000067d0: 706f 7274 5f69 6420 6e6f 7420 696e 2073  port_id not in s
+000067e0: 656c 662e 706f 7274 733a 0a20 2020 2020  elf.ports:.     
+000067f0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00006800: 7565 4572 726f 7228 6622 706f 7274 207b  ueError(f"port {
+00006810: 706f 7274 5f69 647d 206e 6f74 2069 6e20  port_id} not in 
+00006820: 7b73 656c 662e 706f 7274 732e 6b65 7973  {self.ports.keys
+00006830: 2829 7d22 290a 0a20 2020 2020 2020 206f  ()}")..        o
+00006840: 7269 6769 6e20 3d20 7365 6c66 2e70 6f72  rigin = self.por
+00006850: 7473 5b70 6f72 745f 6964 5d2e 6365 6e74  ts[port_id].cent
+00006860: 6572 2069 6620 706f 7274 5f69 6420 656c  er if port_id el
+00006870: 7365 2028 302c 2030 290a 2020 2020 2020  se (0, 0).      
+00006880: 2020 6966 2068 5f6d 6972 726f 723a 0a20    if h_mirror:. 
+00006890: 2020 2020 2020 2020 2020 205f 7265 662e             _ref.
+000068a0: 6d69 7272 6f72 5f78 2870 6f72 745f 6964  mirror_x(port_id
+000068b0: 290a 0a20 2020 2020 2020 2069 6620 765f  )..        if v_
+000068c0: 6d69 7272 6f72 3a0a 2020 2020 2020 2020  mirror:.        
+000068d0: 2020 2020 5f72 6566 2e6d 6972 726f 725f      _ref.mirror_
+000068e0: 7928 706f 7274 5f69 6429 0a0a 2020 2020  y(port_id)..    
+000068f0: 2020 2020 6966 2072 6f74 6174 696f 6e20      if rotation 
+00006900: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
+00006910: 2020 5f72 6566 2e72 6f74 6174 6528 726f    _ref.rotate(ro
+00006920: 7461 7469 6f6e 2c20 6f72 6967 696e 290a  tation, origin).
+00006930: 2020 2020 2020 2020 5f72 6566 2e6d 6f76          _ref.mov
+00006940: 6528 6f72 6967 696e 2c20 706f 7369 7469  e(origin, positi
+00006950: 6f6e 290a 0a20 2020 2020 2020 2072 6574  on)..        ret
+00006960: 7572 6e20 5f72 6566 0a0a 2020 2020 6465  urn _ref..    de
+00006970: 6620 7265 665f 6365 6e74 6572 2873 656c  f ref_center(sel
+00006980: 662c 2070 6f73 6974 696f 6e3d 2830 2c20  f, position=(0, 
+00006990: 3029 293a 0a20 2020 2020 2020 2022 2222  0)):.        """
+000069a0: 5265 7475 726e 7320 6120 7265 6665 7265  Returns a refere
+000069b0: 6e63 6520 6f66 2074 6865 2063 6f6d 706f  nce of the compo
+000069c0: 6e65 6e74 2063 656e 7465 7265 6420 6174  nent centered at
+000069d0: 2028 783d 302c 2079 3d30 292e 2222 220a   (x=0, y=0).""".
+000069e0: 2020 2020 2020 2020 7369 203d 2073 656c          si = sel
+000069f0: 662e 7369 7a65 5f69 6e66 6f0a 2020 2020  f.size_info.    
+00006a00: 2020 2020 7963 203d 2073 692e 736f 7574      yc = si.sout
+00006a10: 6820 2b20 7369 2e68 6569 6768 7420 2f20  h + si.height / 
+00006a20: 320a 2020 2020 2020 2020 7863 203d 2073  2.        xc = s
+00006a30: 692e 7765 7374 202b 2073 692e 7769 6474  i.west + si.widt
+00006a40: 6820 2f20 320a 2020 2020 2020 2020 6365  h / 2.        ce
+00006a50: 6e74 6572 203d 2028 7863 2c20 7963 290a  nter = (xc, yc).
+00006a60: 2020 2020 2020 2020 5f72 6566 203d 2043          _ref = C
+00006a70: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00006a80: 6528 7365 6c66 290a 2020 2020 2020 2020  e(self).        
+00006a90: 5f72 6566 2e6d 6f76 6528 6365 6e74 6572  _ref.move(center
+00006aa0: 2c20 706f 7369 7469 6f6e 290a 2020 2020  , position).    
+00006ab0: 2020 2020 7265 7475 726e 205f 7265 660a      return _ref.
+00006ac0: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
+00006ad0: 5f28 7365 6c66 2920 2d3e 2073 7472 3a0a  _(self) -> str:.
+00006ae0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00006af0: 6e20 6120 7374 7269 6e67 2072 6570 7265  n a string repre
+00006b00: 7365 6e74 6174 696f 6e20 6f66 2074 6865  sentation of the
+00006b10: 206f 626a 6563 742e 2222 220a 2020 2020   object.""".    
+00006b20: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+00006b30: 2020 2020 2020 2020 2066 227b 7365 6c66           f"{self
+00006b40: 2e6e 616d 657d 3a20 7569 6420 7b73 656c  .name}: uid {sel
+00006b50: 662e 7569 647d 2c20 220a 2020 2020 2020  f.uid}, ".      
+00006b60: 2020 2020 2020 6622 706f 7274 7320 7b6c        f"ports {l
+00006b70: 6973 7428 7365 6c66 2e70 6f72 7473 2e6b  ist(self.ports.k
+00006b80: 6579 7328 2929 7d2c 2022 0a20 2020 2020  eys())}, ".     
+00006b90: 2020 2020 2020 2066 2272 6566 6572 656e         f"referen
+00006ba0: 6365 7320 7b6c 6973 7428 7365 6c66 2e6e  ces {list(self.n
+00006bb0: 616d 6564 5f72 6566 6572 656e 6365 732e  amed_references.
+00006bc0: 6b65 7973 2829 297d 2c20 220a 2020 2020  keys())}, ".    
+00006bd0: 2020 2020 2020 2020 6622 7b6c 656e 2873          f"{len(s
+00006be0: 656c 662e 706f 6c79 676f 6e73 297d 2070  elf.polygons)} p
+00006bf0: 6f6c 7967 6f6e 7322 0a20 2020 2020 2020  olygons".       
+00006c00: 2029 0a0a 2020 2020 6465 6620 7070 7269   )..    def ppri
+00006c10: 6e74 2873 656c 6629 202d 3e20 4e6f 6e65  nt(self) -> None
+00006c20: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
+00006c30: 6e74 7320 636f 6d70 6f6e 656e 7420 696e  nts component in
+00006c40: 666f 2e22 2222 0a20 2020 2020 2020 2074  fo.""".        t
+00006c50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00006c60: 6672 6f6d 2072 6963 6820 696d 706f 7274  from rich import
+00006c70: 2070 7265 7474 790a 0a20 2020 2020 2020   pretty..       
+00006c80: 2020 2020 2070 7265 7474 792e 696e 7374       pretty.inst
+00006c90: 616c 6c28 290a 2020 2020 2020 2020 2020  all().          
+00006ca0: 2020 7072 6574 7479 2e70 7072 696e 7428    pretty.pprint(
+00006cb0: 7365 6c66 2e74 6f5f 6469 6374 2829 290a  self.to_dict()).
+00006cc0: 2020 2020 2020 2020 6578 6365 7074 2049          except I
+00006cd0: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
+00006ce0: 2020 2020 2020 2020 7072 696e 7428 7961          print(ya
+00006cf0: 6d6c 2e64 756d 7028 7365 6c66 2e74 6f5f  ml.dump(self.to_
+00006d00: 6469 6374 2829 2929 0a0a 2020 2020 6465  dict()))..    de
+00006d10: 6620 7070 7269 6e74 5f70 6f72 7473 2873  f pprint_ports(s
+00006d20: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00006d30: 2020 2020 2020 2222 2250 7269 6e74 7320        """Prints 
+00006d40: 706f 7274 7320 696e 2061 2072 6963 6820  ports in a rich 
+00006d50: 7461 626c 652e 2222 220a 2020 2020 2020  table.""".      
+00006d60: 2020 6672 6f6d 2072 6963 682e 636f 6e73    from rich.cons
+00006d70: 6f6c 6520 696d 706f 7274 2043 6f6e 736f  ole import Conso
+00006d80: 6c65 0a20 2020 2020 2020 2066 726f 6d20  le.        from 
+00006d90: 7269 6368 2e74 6162 6c65 2069 6d70 6f72  rich.table impor
+00006da0: 7420 5461 626c 650a 0a20 2020 2020 2020  t Table..       
+00006db0: 2063 6f6e 736f 6c65 203d 2043 6f6e 736f   console = Conso
+00006dc0: 6c65 2829 0a0a 2020 2020 2020 2020 7461  le()..        ta
+00006dd0: 626c 6520 3d20 5461 626c 6528 7368 6f77  ble = Table(show
+00006de0: 5f68 6561 6465 723d 5472 7565 2c20 6865  _header=True, he
+00006df0: 6164 6572 5f73 7479 6c65 3d22 626f 6c64  ader_style="bold
+00006e00: 2229 0a20 2020 2020 2020 2070 6f72 7473  ").        ports
+00006e10: 5f6c 6973 7420 3d20 7365 6c66 2e67 6574  _list = self.get
+00006e20: 5f70 6f72 7473 5f6c 6973 7428 290a 2020  _ports_list().  
+00006e30: 2020 2020 2020 6966 206e 6f74 2070 6f72        if not por
+00006e40: 7473 5f6c 6973 743a 0a20 2020 2020 2020  ts_list:.       
+00006e50: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00006e60: 2020 2020 7030 203d 2070 6f72 7473 5f6c      p0 = ports_l
+00006e70: 6973 745b 305d 0a20 2020 2020 2020 2066  ist[0].        f
+00006e80: 696c 7465 7265 645f 6469 6374 203d 207b  iltered_dict = {
+00006e90: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
+00006ea0: 3a20 7661 6c75 6520 666f 7220 6b65 792c  : value for key,
+00006eb0: 2076 616c 7565 2069 6e20 7030 2e74 6f5f   value in p0.to_
+00006ec0: 6469 6374 2829 2e69 7465 6d73 2829 2069  dict().items() i
+00006ed0: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
+00006ee0: 6f6e 650a 2020 2020 2020 2020 7d0a 2020  one.        }.  
+00006ef0: 2020 2020 2020 6b65 7973 203d 2066 696c        keys = fil
+00006f00: 7465 7265 645f 6469 6374 2e6b 6579 7328  tered_dict.keys(
+00006f10: 290a 0a20 2020 2020 2020 2066 6f72 206b  )..        for k
+00006f20: 6579 2069 6e20 6b65 7973 3a0a 2020 2020  ey in keys:.    
+00006f30: 2020 2020 2020 2020 7461 626c 652e 6164          table.ad
+00006f40: 645f 636f 6c75 6d6e 286b 6579 290a 0a20  d_column(key).. 
+00006f50: 2020 2020 2020 2066 6f72 2070 6f72 7420         for port 
+00006f60: 696e 2070 6f72 7473 5f6c 6973 743a 0a20  in ports_list:. 
+00006f70: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00006f80: 6469 6374 203d 2070 6f72 742e 746f 5f64  dict = port.to_d
+00006f90: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
+00006fa0: 2020 726f 7720 3d20 5b73 7472 2870 6f72    row = [str(por
+00006fb0: 745f 6469 6374 2e67 6574 286b 6579 2c20  t_dict.get(key, 
+00006fc0: 2222 2929 2066 6f72 206b 6579 2069 6e20  "")) for key in 
+00006fd0: 6b65 7973 5d0a 2020 2020 2020 2020 2020  keys].          
+00006fe0: 2020 7461 626c 652e 6164 645f 726f 7728    table.add_row(
+00006ff0: 2a72 6f77 290a 0a20 2020 2020 2020 2063  *row)..        c
+00007000: 6f6e 736f 6c65 2e70 7269 6e74 2874 6162  onsole.print(tab
+00007010: 6c65 290a 0a20 2020 2040 7072 6f70 6572  le)..    @proper
+00007020: 7479 0a20 2020 2064 6566 206d 6574 6164  ty.    def metad
+00007030: 6174 615f 6368 696c 6428 7365 6c66 2920  ata_child(self) 
+00007040: 2d3e 2064 6963 743a 0a20 2020 2020 2020  -> dict:.       
+00007050: 2022 2222 5265 7475 726e 7320 6d65 7461   """Returns meta
+00007060: 6461 7461 2066 726f 6d20 6368 696c 6420  data from child 
+00007070: 6966 2061 6e79 2c20 4f74 6865 7277 6973  if any, Otherwis
+00007080: 6520 7265 7475 726e 7320 636f 6d70 6f6e  e returns compon
+00007090: 656e 7420 6f77 6e2e 0a0a 2020 2020 2020  ent own...      
+000070a0: 2020 6d65 7461 6461 7461 2047 7265 6174    metadata Great
+000070b0: 2074 6f20 6163 6365 7373 2074 6865 2063   to access the c
+000070c0: 6869 6c64 7265 6e20 6d65 7461 6461 7461  hildren metadata
+000070d0: 2061 7420 7468 6520 626f 7474 6f6d 206f   at the bottom o
+000070e0: 6620 7468 650a 2020 2020 2020 2020 6869  f the.        hi
+000070f0: 6572 6172 6368 792e 0a20 2020 2020 2020  erarchy..       
+00007100: 2022 2222 0a20 2020 2020 2020 2073 6574   """.        set
+00007110: 7469 6e67 7320 3d20 6469 6374 2873 656c  tings = dict(sel
+00007120: 662e 7365 7474 696e 6773 290a 0a20 2020  f.settings)..   
+00007130: 2020 2020 2077 6869 6c65 2073 6574 7469       while setti
+00007140: 6e67 732e 6765 7428 2263 6869 6c64 2229  ngs.get("child")
+00007150: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007160: 7474 696e 6773 203d 2073 6574 7469 6e67  ttings = setting
+00007170: 732e 6765 7428 2263 6869 6c64 2229 0a0a  s.get("child")..
+00007180: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00007190: 6963 7428 7365 7474 696e 6773 290a 0a20  ict(settings).. 
+000071a0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000071b0: 2064 6566 206d 6574 6164 6174 6128 7365   def metadata(se
+000071c0: 6c66 2920 2d3e 2064 6963 743a 0a20 2020  lf) -> dict:.   
+000071d0: 2020 2020 2072 6574 7572 6e20 6469 6374       return dict
+000071e0: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
+000071f0: 0a20 2020 2064 6566 2061 6464 5f70 6f72  .    def add_por
+00007200: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
+00007210: 0a20 2020 2020 2020 206e 616d 653a 2073  .        name: s
+00007220: 7472 207c 206f 626a 6563 7420 7c20 4e6f  tr | object | No
+00007230: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00007240: 2020 2063 656e 7465 723a 2074 7570 6c65     center: tuple
+00007250: 5b66 6c6f 6174 2c20 666c 6f61 745d 207c  [float, float] |
+00007260: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00007270: 2020 2020 2020 7769 6474 683a 2066 6c6f        width: flo
+00007280: 6174 207c 204e 6f6e 6520 3d20 4e6f 6e65  at | None = None
+00007290: 2c0a 2020 2020 2020 2020 6f72 6965 6e74  ,.        orient
+000072a0: 6174 696f 6e3a 2066 6c6f 6174 207c 204e  ation: float | N
+000072b0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+000072c0: 2020 2020 706f 7274 3a20 506f 7274 207c      port: Port |
+000072d0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000072e0: 2020 2020 2020 6c61 7965 723a 204c 6179        layer: Lay
+000072f0: 6572 5370 6563 207c 204e 6f6e 6520 3d20  erSpec | None = 
+00007300: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
+00007310: 7274 5f74 7970 653a 2073 7472 207c 204e  rt_type: str | N
+00007320: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00007330: 2020 2020 6372 6f73 735f 7365 6374 696f      cross_sectio
+00007340: 6e3a 2043 726f 7373 5365 6374 696f 6e53  n: CrossSectionS
+00007350: 7065 6320 7c20 4e6f 6e65 203d 204e 6f6e  pec | None = Non
+00007360: 652c 0a20 2020 2020 2020 2073 6865 6172  e,.        shear
+00007370: 5f61 6e67 6c65 3a20 666c 6f61 7420 7c20  _angle: float | 
+00007380: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00007390: 2029 202d 3e20 506f 7274 3a0a 2020 2020   ) -> Port:.    
+000073a0: 2020 2020 2222 2241 6464 2070 6f72 7420      """Add port 
+000073b0: 746f 2063 6f6d 706f 6e65 6e74 2e0a 0a20  to component... 
+000073c0: 2020 2020 2020 2059 6f75 2063 616e 2063         You can c
+000073d0: 6f70 7920 616e 2065 7869 7374 696e 6720  opy an existing 
+000073e0: 706f 7274 206c 696b 6520 6164 645f 706f  port like add_po
+000073f0: 7274 2870 6f72 7420 3d20 6578 6973 7469  rt(port = existi
+00007400: 6e67 5f70 6f72 7429 206f 720a 2020 2020  ng_port) or.    
+00007410: 2020 2020 6372 6561 7465 2061 206e 6577      create a new
+00007420: 2070 6f72 7420 6164 645f 706f 7274 286d   port add_port(m
+00007430: 796e 616d 652c 206d 7963 656e 7465 722c  yname, mycenter,
+00007440: 206d 7977 6964 7468 2c20 6d79 6f72 6965   mywidth, myorie
+00007450: 6e74 6174 696f 6e29 2e0a 2020 2020 2020  ntation)..      
+00007460: 2020 596f 7520 6361 6e20 616c 736f 2063    You can also c
+00007470: 6f70 7920 616e 2065 7869 7374 696e 6720  opy an existing 
+00007480: 706f 7274 0a20 2020 2020 2020 2077 6974  port.        wit
+00007490: 6820 6120 6e65 7720 6e61 6d65 2061 6464  h a new name add
+000074a0: 5f70 6f72 7428 706f 7274 203d 2065 7869  _port(port = exi
+000074b0: 7374 696e 675f 706f 7274 2c20 6e61 6d65  sting_port, name
+000074c0: 203d 206e 6577 5f6e 616d 6529 0a0a 2020   = new_name)..  
+000074d0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+000074e0: 2020 2020 2020 2020 6e61 6d65 3a20 706f          name: po
+000074f0: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
+00007500: 2020 2020 2063 656e 7465 723a 2078 2c20       center: x, 
+00007510: 792e 0a20 2020 2020 2020 2020 2020 2077  y..            w
+00007520: 6964 7468 3a20 696e 2075 6d2e 0a20 2020  idth: in um..   
+00007530: 2020 2020 2020 2020 206f 7269 656e 7461           orienta
+00007540: 7469 6f6e 3a20 696e 2064 6567 2e0a 2020  tion: in deg..  
+00007550: 2020 2020 2020 2020 2020 706f 7274 3a20            port: 
+00007560: 6f70 7469 6f6e 616c 2070 6f72 742e 0a20  optional port.. 
+00007570: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00007580: 3a20 706f 7274 206c 6179 6572 2e0a 2020  : port layer..  
+00007590: 2020 2020 2020 2020 2020 706f 7274 5f74            port_t
+000075a0: 7970 653a 206f 7074 6963 616c 2c20 656c  ype: optical, el
+000075b0: 6563 7472 6963 616c 2c20 7665 7274 6963  ectrical, vertic
+000075c0: 616c 5f64 632c 2076 6572 7469 6361 6c5f  al_dc, vertical_
+000075d0: 7465 2c20 7665 7274 6963 616c 5f74 6d2e  te, vertical_tm.
+000075e0: 2044 6566 6175 6c74 7320 746f 206f 7074   Defaults to opt
+000075f0: 6963 616c 2e0a 2020 2020 2020 2020 2020  ical..          
+00007600: 2020 6372 6f73 735f 7365 6374 696f 6e3a    cross_section:
+00007610: 2070 6f72 7420 6372 6f73 735f 7365 6374   port cross_sect
+00007620: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+00007630: 2073 6865 6172 5f61 6e67 6c65 3a20 616e   shear_angle: an
+00007640: 206f 7074 696f 6e61 6c20 616e 676c 6520   optional angle 
+00007650: 746f 2073 6865 6172 2070 6f72 7420 6661  to shear port fa
+00007660: 6365 2069 6e20 6465 6772 6565 732e 0a20  ce in degrees.. 
+00007670: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007680: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+00007690: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+000076a0: 745f 6372 6f73 735f 7365 6374 696f 6e2c  t_cross_section,
+000076b0: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
+000076c0: 2020 2020 6c61 7965 7220 3d20 6765 745f      layer = get_
+000076d0: 6c61 7965 7228 6c61 7965 7229 0a0a 2020  layer(layer)..  
+000076e0: 2020 2020 2020 6966 2070 6f72 743a 0a20        if port:. 
+000076f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00007700: 7420 6973 696e 7374 616e 6365 2870 6f72  t isinstance(por
+00007710: 742c 2050 6f72 7429 3a0a 2020 2020 2020  t, Port):.      
+00007720: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00007730: 5661 6c75 6545 7272 6f72 2866 2261 6464  ValueError(f"add
+00007740: 5f70 6f72 7428 2920 6e65 6564 7320 6120  _port() needs a 
+00007750: 506f 7274 2c20 676f 7420 7b74 7970 6528  Port, got {type(
+00007760: 706f 7274 297d 2229 0a20 2020 2020 2020  port)}").       
+00007770: 2020 2020 2070 203d 2070 6f72 742e 636f       p = port.co
+00007780: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+00007790: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
+000077a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000077b0: 2020 2020 2020 702e 6e61 6d65 203d 206e        p.name = n
+000077c0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+000077d0: 6966 2063 656e 7465 7220 6973 206e 6f74  if center is not
+000077e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000077f0: 2020 2020 2020 2070 2e63 656e 7465 7220         p.center 
+00007800: 3d20 6365 6e74 6572 0a20 2020 2020 2020  = center.       
+00007810: 2020 2020 2069 6620 7769 6474 6820 6973       if width is
+00007820: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00007830: 2020 2020 2020 2020 2020 2070 2e77 6964             p.wid
+00007840: 7468 203d 2077 6964 7468 0a20 2020 2020  th = width.     
+00007850: 2020 2020 2020 2069 6620 6f72 6965 6e74         if orient
+00007860: 6174 696f 6e20 6973 206e 6f74 204e 6f6e  ation is not Non
+00007870: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00007880: 2020 2070 2e6f 7269 656e 7461 7469 6f6e     p.orientation
+00007890: 203d 206f 7269 656e 7461 7469 6f6e 0a20   = orientation. 
+000078a0: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+000078b0: 7274 5f74 7970 6520 6973 206e 6f74 204e  rt_type is not N
+000078c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000078d0: 2020 2020 2070 2e70 6f72 745f 7479 7065       p.port_type
+000078e0: 203d 2070 6f72 745f 7479 7065 0a20 2020   = port_type.   
+000078f0: 2020 2020 2020 2020 2069 6620 6c61 7965           if laye
+00007900: 7220 6973 206e 6f74 204e 6f6e 653a 0a20  r is not None:. 
+00007910: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00007920: 2e6c 6179 6572 203d 206c 6179 6572 0a20  .layer = layer. 
+00007930: 2020 2020 2020 2020 2020 2070 2e70 6172             p.par
+00007940: 656e 7420 3d20 7365 6c66 0a0a 2020 2020  ent = self..    
+00007950: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00007960: 6e63 6528 6e61 6d65 2c20 506f 7274 293a  nce(name, Port):
+00007970: 0a20 2020 2020 2020 2020 2020 2070 203d  .            p =
+00007980: 206e 616d 652e 636f 7079 2829 0a20 2020   name.copy().   
+00007990: 2020 2020 2020 2020 2070 2e70 6172 656e           p.paren
+000079a0: 7420 3d20 7365 6c66 0a20 2020 2020 2020  t = self.       
+000079b0: 2020 2020 206e 616d 6520 3d20 702e 6e61       name = p.na
+000079c0: 6d65 0a20 2020 2020 2020 2065 6c69 6620  me.        elif 
+000079d0: 6365 6e74 6572 2069 7320 4e6f 6e65 3a0a  center is None:.
+000079e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000079f0: 6520 5661 6c75 6545 7272 6f72 2822 506f  e ValueError("Po
+00007a00: 7274 206e 6565 6473 2063 656e 7465 7220  rt needs center 
+00007a10: 7061 7261 6d65 7465 7220 2878 2c20 7929  parameter (x, y)
+00007a20: 2075 6d2e 2229 0a0a 2020 2020 2020 2020   um.")..        
+00007a30: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00007a40: 2020 7020 3d20 506f 7274 280a 2020 2020    p = Port(.    
+00007a50: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00007a60: 3d6e 616d 652c 0a20 2020 2020 2020 2020  =name,.         
+00007a70: 2020 2020 2020 2063 656e 7465 723d 6365         center=ce
+00007a80: 6e74 6572 2c0a 2020 2020 2020 2020 2020  nter,.          
+00007a90: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
+00007aa0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+00007ab0: 2020 206f 7269 656e 7461 7469 6f6e 3d6f     orientation=o
+00007ac0: 7269 656e 7461 7469 6f6e 2c0a 2020 2020  rientation,.    
+00007ad0: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+00007ae0: 6e74 3d73 656c 662c 0a20 2020 2020 2020  nt=self,.       
+00007af0: 2020 2020 2020 2020 206c 6179 6572 3d6c           layer=l
+00007b00: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
+00007b10: 2020 2020 2020 706f 7274 5f74 7970 653d        port_type=
+00007b20: 706f 7274 5f74 7970 6520 6f72 2022 6f70  port_type or "op
+00007b30: 7469 6361 6c22 2c0a 2020 2020 2020 2020  tical",.        
+00007b40: 2020 2020 2020 2020 6372 6f73 735f 7365          cross_se
+00007b50: 6374 696f 6e3d 6765 745f 6372 6f73 735f  ction=get_cross_
+00007b60: 7365 6374 696f 6e28 6372 6f73 735f 7365  section(cross_se
+00007b70: 6374 696f 6e29 0a20 2020 2020 2020 2020  ction).         
+00007b80: 2020 2020 2020 2069 6620 6372 6f73 735f         if cross_
+00007b90: 7365 6374 696f 6e0a 2020 2020 2020 2020  section.        
+00007ba0: 2020 2020 2020 2020 656c 7365 204e 6f6e          else Non
+00007bb0: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+00007bc0: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
+00007bd0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00007be0: 2020 2020 2020 2020 2020 702e 6e61 6d65            p.name
+00007bf0: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
+00007c00: 6966 2070 2e6e 616d 6520 696e 2073 656c  if p.name in sel
+00007c10: 662e 706f 7274 733a 0a20 2020 2020 2020  f.ports:.       
+00007c20: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00007c30: 4572 726f 7228 6622 6164 645f 706f 7274  Error(f"add_port
+00007c40: 2829 2050 6f72 7420 6e61 6d65 207b 702e  () Port name {p.
+00007c50: 6e61 6d65 2172 7d20 6578 6973 7473 2069  name!r} exists i
+00007c60: 6e20 7b73 656c 662e 6e61 6d65 2172 7d22  n {self.name!r}"
+00007c70: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00007c80: 706f 7274 735b 702e 6e61 6d65 5d20 3d20  ports[p.name] = 
+00007c90: 700a 2020 2020 2020 2020 7265 7475 726e  p.        return
+00007ca0: 2070 0a0a 2020 2020 6465 6620 6164 645f   p..    def add_
+00007cb0: 706f 7274 7328 0a20 2020 2020 2020 2073  ports(.        s
+00007cc0: 656c 662c 0a20 2020 2020 2020 2070 6f72  elf,.        por
+00007cd0: 7473 3a20 4974 6572 6162 6c65 5b50 6f72  ts: Iterable[Por
+00007ce0: 745d 207c 2064 6963 745b 7374 722c 2050  t] | dict[str, P
+00007cf0: 6f72 745d 2c0a 2020 2020 2020 2020 7072  ort],.        pr
+00007d00: 6566 6978 3a20 7374 7220 3d20 2222 2c0a  efix: str = "",.
+00007d10: 2020 2020 2020 2020 7375 6666 6978 3a20          suffix: 
+00007d20: 7374 7220 3d20 2222 2c0a 2020 2020 2020  str = "",.      
+00007d30: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00007d40: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00007d50: 2020 2022 2222 4164 6420 6120 6c69 7374     """Add a list
+00007d60: 206f 7220 6469 6374 206f 6620 706f 7274   or dict of port
+00007d70: 732e 0a0a 2020 2020 2020 2020 796f 7520  s...        you 
+00007d80: 6361 6e20 696e 636c 7564 6520 6120 7072  can include a pr
+00007d90: 6566 6978 2074 6f20 6164 6420 746f 2074  efix to add to t
+00007da0: 6865 206e 6577 2070 6f72 7420 6e61 6d65  he new port name
+00007db0: 7320 746f 2061 766f 6964 206e 616d 6520  s to avoid name 
+00007dc0: 636f 6e66 6c69 6374 732e 0a0a 2020 2020  conflicts...    
+00007dd0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00007de0: 2020 2020 2020 706f 7274 733a 206c 6973        ports: lis
+00007df0: 7420 6f72 2064 6963 7420 6f66 2070 6f72  t or dict of por
+00007e00: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+00007e10: 7072 6566 6978 3a20 746f 2070 7265 7065  prefix: to prepe
+00007e20: 6e64 2074 6f20 6561 6368 2070 6f72 7420  nd to each port 
+00007e30: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
+00007e40: 2020 7375 6666 6978 3a20 746f 2061 7070    suffix: to app
+00007e50: 656e 6420 746f 2065 6163 6820 706f 7274  end to each port
+00007e60: 206e 616d 652e 0a20 2020 2020 2020 2022   name..        "
+00007e70: 2222 0a20 2020 2020 2020 2070 6f72 7473  "".        ports
+00007e80: 203d 2070 6f72 7473 2e76 616c 7565 7328   = ports.values(
+00007e90: 2920 6966 2069 7369 6e73 7461 6e63 6528  ) if isinstance(
+00007ea0: 706f 7274 732c 204d 6170 7069 6e67 2920  ports, Mapping) 
+00007eb0: 656c 7365 2070 6f72 7473 0a20 2020 2020  else ports.     
+00007ec0: 2020 2066 6f72 2070 6f72 7420 696e 2070     for port in p
+00007ed0: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
+00007ee0: 2020 6e61 6d65 203d 2066 227b 7072 6566    name = f"{pref
+00007ef0: 6978 7d7b 706f 7274 2e6e 616d 657d 7b73  ix}{port.name}{s
+00007f00: 7566 6669 787d 220a 2020 2020 2020 2020  uffix}".        
+00007f10: 2020 2020 7365 6c66 2e61 6464 5f70 6f72      self.add_por
+00007f20: 7428 6e61 6d65 3d6e 616d 652c 2070 6f72  t(name=name, por
+00007f30: 743d 706f 7274 2c20 2a2a 6b77 6172 6773  t=port, **kwargs
+00007f40: 290a 0a20 2020 2064 6566 2073 6e61 705f  )..    def snap_
+00007f50: 706f 7274 735f 746f 5f67 7269 6428 7365  ports_to_grid(se
+00007f60: 6c66 2c20 6e6d 3a20 696e 7420 3d20 3129  lf, nm: int = 1)
+00007f70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00007f80: 2020 666f 7220 706f 7274 2069 6e20 7365    for port in se
+00007f90: 6c66 2e70 6f72 7473 2e76 616c 7565 7328  lf.ports.values(
+00007fa0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+00007fb0: 6f72 742e 736e 6170 5f74 6f5f 6772 6964  ort.snap_to_grid
+00007fc0: 286e 6d3d 6e6d 290a 0a20 2020 2064 6566  (nm=nm)..    def
+00007fd0: 2072 656d 6f76 655f 6c61 7965 7273 280a   remove_layers(.
+00007fe0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00007ff0: 2020 2020 2020 6c61 7965 7273 3a20 6c69        layers: li
+00008000: 7374 5b4c 6179 6572 5370 6563 5d2c 0a20  st[LayerSpec],. 
+00008010: 2020 2020 2020 2069 6e63 6c75 6465 5f6c         include_l
+00008020: 6162 656c 733a 2062 6f6f 6c20 3d20 5472  abels: bool = Tr
+00008030: 7565 2c0a 2020 2020 2020 2020 696e 7665  ue,.        inve
+00008040: 7274 5f73 656c 6563 7469 6f6e 3a20 626f  rt_selection: bo
+00008050: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00008060: 2020 2020 7265 6375 7273 6976 653a 2062      recursive: b
+00008070: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+00008080: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
+00008090: 2020 2020 2020 2020 2222 2252 656d 6f76          """Remov
+000080a0: 6520 6120 6c69 7374 206f 6620 6c61 7965  e a list of laye
+000080b0: 7273 2061 6e64 2072 6574 7572 6e73 2074  rs and returns t
+000080c0: 6865 2073 616d 6520 436f 6d70 6f6e 656e  he same Componen
+000080d0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+000080e0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+000080f0: 7965 7273 3a20 6c69 7374 206f 6620 6c61  yers: list of la
+00008100: 7965 7273 2074 6f20 7265 6d6f 7665 2e0a  yers to remove..
+00008110: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+00008120: 7564 655f 6c61 6265 6c73 3a20 7265 6d6f  ude_labels: remo
+00008130: 7665 206c 6162 656c 7320 6f6e 2074 686f  ve labels on tho
+00008140: 7365 206c 6179 6572 732e 0a20 2020 2020  se layers..     
+00008150: 2020 2020 2020 2069 6e76 6572 745f 7365         invert_se
+00008160: 6c65 6374 696f 6e3a 2072 656d 6f76 6573  lection: removes
+00008170: 2061 6c6c 206c 6179 6572 7320 6578 6365   all layers exce
+00008180: 7074 206c 6179 6572 7320 7370 6563 6966  pt layers specif
+00008190: 6965 642e 0a20 2020 2020 2020 2020 2020  ied..           
+000081a0: 2072 6563 7572 7369 7665 3a20 6f70 6572   recursive: oper
+000081b0: 6174 6520 6f6e 2074 6865 2063 656c 6c73  ate on the cells
+000081c0: 2069 6e63 6c75 6465 6420 696e 2074 6869   included in thi
+000081d0: 7320 6365 6c6c 2e0a 2020 2020 2020 2020  s cell..        
+000081e0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+000081f0: 2067 6473 6661 6374 6f72 7920 696d 706f   gdsfactory impo
+00008200: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
+00008210: 2020 2020 2020 636f 6d70 6f6e 656e 7420        component 
+00008220: 3d20 7365 6c66 2e66 6c61 7474 656e 2829  = self.flatten()
+00008230: 2069 6620 7265 6375 7273 6976 6520 616e   if recursive an
+00008240: 6420 7365 6c66 2e72 6566 6572 656e 6365  d self.reference
+00008250: 7320 656c 7365 2073 656c 660a 2020 2020  s else self.    
+00008260: 2020 2020 6c61 7965 7273 203d 205b 6765      layers = [ge
+00008270: 745f 6c61 7965 7228 6c61 7965 7229 2066  t_layer(layer) f
+00008280: 6f72 206c 6179 6572 2069 6e20 6c61 7965  or layer in laye
+00008290: 7273 5d0a 0a20 2020 2020 2020 2073 686f  rs]..        sho
+000082a0: 756c 645f 7265 6d6f 7665 203d 206e 6f74  uld_remove = not
+000082b0: 2069 6e76 6572 745f 7365 6c65 6374 696f   invert_selectio
+000082c0: 6e0a 2020 2020 2020 2020 636f 6d70 6f6e  n.        compon
+000082d0: 656e 742e 5f63 656c 6c2e 6669 6c74 6572  ent._cell.filter
+000082e0: 280a 2020 2020 2020 2020 2020 2020 7370  (.            sp
+000082f0: 6563 3d6c 6179 6572 732c 0a20 2020 2020  ec=layers,.     
+00008300: 2020 2020 2020 2072 656d 6f76 653d 7368         remove=sh
+00008310: 6f75 6c64 5f72 656d 6f76 652c 0a20 2020  ould_remove,.   
+00008320: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00008330: 733d 5472 7565 2c0a 2020 2020 2020 2020  s=True,.        
+00008340: 2020 2020 7061 7468 733d 5472 7565 2c0a      paths=True,.
+00008350: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+00008360: 6c73 3d69 6e63 6c75 6465 5f6c 6162 656c  ls=include_label
+00008370: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
+00008380: 2020 2020 2072 6574 7572 6e20 636f 6d70       return comp
+00008390: 6f6e 656e 740a 0a20 2020 2064 6566 2065  onent..    def e
+000083a0: 7874 7261 6374 280a 2020 2020 2020 2020  xtract(.        
+000083b0: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
+000083c0: 7965 7273 3a20 6c69 7374 5b74 7570 6c65  yers: list[tuple
+000083d0: 5b69 6e74 2c20 696e 745d 207c 2073 7472  [int, int] | str
+000083e0: 5d2c 0a20 2020 2029 202d 3e20 436f 6d70  ],.    ) -> Comp
+000083f0: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
+00008400: 2222 4578 7472 6163 7420 706f 6c79 676f  ""Extract polygo
+00008410: 6e73 2066 726f 6d20 6120 436f 6d70 6f6e  ns from a Compon
+00008420: 656e 7420 616e 6420 7265 7475 726e 7320  ent and returns 
+00008430: 6120 6e65 7720 436f 6d70 6f6e 656e 742e  a new Component.
+00008440: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00008450: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
+00008460: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+00008470: 0a0a 2020 2020 2020 2020 6966 2074 7970  ..        if typ
+00008480: 6528 6c61 7965 7273 2920 6e6f 7420 696e  e(layers) not in
+00008490: 2028 6c69 7374 2c20 7475 706c 6529 3a0a   (list, tuple):.
+000084a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000084b0: 6520 5661 6c75 6545 7272 6f72 2866 226c  e ValueError(f"l
+000084c0: 6179 6572 7320 7b6c 6179 6572 7321 727d  ayers {layers!r}
+000084d0: 206e 6565 6473 2074 6f20 6265 2061 206c   needs to be a l
+000084e0: 6973 7420 6f72 2074 7570 6c65 2229 0a0a  ist or tuple")..
+000084f0: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
+00008500: 205b 6765 745f 6c61 7965 7228 6c61 7965   [get_layer(laye
+00008510: 7229 2066 6f72 206c 6179 6572 2069 6e20  r) for layer in 
+00008520: 6c61 7965 7273 5d0a 2020 2020 2020 2020  layers].        
+00008530: 2320 636f 6d70 6f6e 656e 7420 3d20 7365  # component = se
+00008540: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
+00008550: 2020 2320 636f 6d70 6f6e 656e 742e 5f63    # component._c
+00008560: 656c 6c2e 6669 6c74 6572 2873 7065 633d  ell.filter(spec=
+00008570: 6c61 7965 7273 2c20 7265 6d6f 7665 3d46  layers, remove=F
+00008580: 616c 7365 290a 0a20 2020 2020 2020 2063  alse)..        c
+00008590: 6f6d 706f 6e65 6e74 203d 2043 6f6d 706f  omponent = Compo
+000085a0: 6e65 6e74 2829 0a20 2020 2020 2020 2070  nent().        p
+000085b0: 6f6c 795f 6469 6374 203d 2073 656c 662e  oly_dict = self.
+000085c0: 6765 745f 706f 6c79 676f 6e73 2862 795f  get_polygons(by_
+000085d0: 7370 6563 3d54 7275 652c 2069 6e63 6c75  spec=True, inclu
+000085e0: 6465 5f70 6174 6873 3d46 616c 7365 290a  de_paths=False).
+000085f0: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
+00008600: 6572 2069 6e20 6c61 7965 7273 3a0a 2020  er in layers:.  
+00008610: 2020 2020 2020 2020 2020 6966 206c 6179            if lay
+00008620: 6572 2069 6e20 706f 6c79 5f64 6963 743a  er in poly_dict:
+00008630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008640: 2070 6f6c 7967 6f6e 7320 3d20 706f 6c79   polygons = poly
+00008650: 5f64 6963 745b 6c61 7965 725d 0a20 2020  _dict[layer].   
+00008660: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00008670: 2070 6f6c 7967 6f6e 2069 6e20 706f 6c79   polygon in poly
+00008680: 676f 6e73 3a0a 2020 2020 2020 2020 2020  gons:.          
+00008690: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+000086a0: 656e 742e 6164 645f 706f 6c79 676f 6e28  ent.add_polygon(
+000086b0: 706f 6c79 676f 6e2c 206c 6179 6572 290a  polygon, layer).
+000086c0: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
+000086d0: 6572 2069 6e20 6c61 7965 7273 3a0a 2020  er in layers:.  
+000086e0: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+000086f0: 7468 2069 6e20 7365 6c66 2e5f 6365 6c6c  th in self._cell
+00008700: 2e67 6574 5f70 6174 6873 286c 6179 6572  .get_paths(layer
+00008710: 3d6c 6179 6572 293a 0a20 2020 2020 2020  =layer):.       
+00008720: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
+00008730: 6e74 2e61 6464 2870 6174 6829 0a0a 2020  nt.add(path)..  
+00008740: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
+00008750: 706f 6e65 6e74 0a0a 2020 2020 6465 6620  ponent..    def 
+00008760: 6164 645f 706f 6c79 676f 6e28 0a20 2020  add_polygon(.   
+00008770: 2020 2020 2073 656c 662c 2070 6f69 6e74       self, point
+00008780: 732c 206c 6179 6572 3a20 7374 7220 7c20  s, layer: str | 
+00008790: 696e 7420 7c20 7475 706c 655b 696e 742c  int | tuple[int,
+000087a0: 2069 6e74 5d20 7c20 6e70 2e6e 616e 203d   int] | np.nan =
+000087b0: 206e 702e 6e61 6e0a 2020 2020 2920 2d3e   np.nan.    ) ->
+000087c0: 2050 6f6c 7967 6f6e 3a0a 2020 2020 2020   Polygon:.      
+000087d0: 2020 2222 2241 6464 7320 6120 506f 6c79    """Adds a Poly
+000087e0: 676f 6e20 746f 2074 6865 2043 6f6d 706f  gon to the Compo
+000087f0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+00008800: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00008810: 2070 6f69 6e74 733a 2043 6f6f 7264 696e   points: Coordin
+00008820: 6174 6573 206f 6620 7468 6520 7665 7274  ates of the vert
+00008830: 6963 6573 206f 6620 7468 6520 506f 6c79  ices of the Poly
+00008840: 676f 6e2e 0a20 2020 2020 2020 2020 2020  gon..           
+00008850: 206c 6179 6572 3a20 6c61 7965 7220 7370   layer: layer sp
+00008860: 6563 2074 6f20 6164 6420 706f 6c79 676f  ec to add polygo
+00008870: 6e20 6f6e 2e0a 2020 2020 2020 2020 2222  n on..        ""
+00008880: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00008890: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
+000088a0: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
+000088b0: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+000088c0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000088d0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+000088e0: 650a 2020 2020 2020 2020 656c 6966 2069  e.        elif i
+000088f0: 7369 6e73 7461 6e63 6528 6c61 7965 722c  sinstance(layer,
+00008900: 2073 6574 293a 0a20 2020 2020 2020 2020   set):.         
+00008910: 2020 2070 6f6c 7967 6f6e 7320 3d20 5b73     polygons = [s
+00008920: 656c 662e 6164 645f 706f 6c79 676f 6e28  elf.add_polygon(
+00008930: 706f 696e 7473 2c20 6c79 2920 666f 7220  points, ly) for 
+00008940: 6c79 2069 6e20 6c61 7965 725d 0a20 2020  ly in layer].   
+00008950: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008960: 706f 6c79 676f 6e73 5b30 5d0a 0a20 2020  polygons[0]..   
+00008970: 2020 2020 206c 6179 6572 203d 2067 6574       layer = get
+00008980: 5f6c 6179 6572 286c 6179 6572 290a 2020  _layer(layer).  
+00008990: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000089a0: 6e63 6528 706f 696e 7473 2c20 6764 7374  nce(points, gdst
+000089b0: 6b2e 506f 6c79 676f 6e29 3a0a 2020 2020  k.Polygon):.    
+000089c0: 2020 2020 2020 2020 2320 6966 206c 6179          # if lay
+000089d0: 6572 2069 7320 756e 7370 6563 6966 6965  er is unspecifie
+000089e0: 6420 6f72 206d 6174 6368 6573 206f 7269  d or matches ori
+000089f0: 6769 6e61 6c20 706f 6c79 676f 6e2c 206a  ginal polygon, j
+00008a00: 7573 7420 6164 6420 6974 2061 732d 6973  ust add it as-is
+00008a10: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+00008a20: 7967 6f6e 203d 2070 6f69 6e74 730a 2020  ygon = points.  
+00008a30: 2020 2020 2020 2020 2020 6966 206c 6179            if lay
+00008a40: 6572 2069 7320 6e70 2e6e 616e 206f 7220  er is np.nan or 
+00008a50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008a60: 2020 6973 696e 7374 616e 6365 286c 6179    isinstance(lay
+00008a70: 6572 2c20 7475 706c 6529 2061 6e64 2028  er, tuple) and (
+00008a80: 706f 6c79 676f 6e2e 6c61 7965 722c 2070  polygon.layer, p
+00008a90: 6f6c 7967 6f6e 2e64 6174 6174 7970 6529  olygon.datatype)
+00008aa0: 203d 3d20 6c61 7965 720a 2020 2020 2020   == layer.      
+00008ab0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00008ac0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00008ad0: 203d 2050 6f6c 7967 6f6e 2870 6f6c 7967   = Polygon(polyg
+00008ae0: 6f6e 2e70 6f69 6e74 732c 2028 706f 6c79  on.points, (poly
+00008af0: 676f 6e2e 6c61 7965 722c 2070 6f6c 7967  gon.layer, polyg
+00008b00: 6f6e 2e64 6174 6174 7970 6529 290a 2020  on.datatype)).  
+00008b10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00008b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b30: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
+00008b40: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
+00008b50: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+00008b60: 2020 2020 2020 706f 6c79 676f 6e20 3d20        polygon = 
+00008b70: 506f 6c79 676f 6e28 706f 6c79 676f 6e2e  Polygon(polygon.
+00008b80: 706f 696e 7473 2c20 286c 6179 6572 2c20  points, (layer, 
+00008b90: 6461 7461 7479 7065 2929 0a0a 2020 2020  datatype))..    
+00008ba0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00008bb0: 7472 2870 6f69 6e74 732c 2022 7072 6f70  tr(points, "prop
+00008bc0: 6572 7469 6573 2229 3a0a 2020 2020 2020  erties"):.      
+00008bd0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+00008be0: 6e2e 7072 6f70 6572 7469 6573 203d 2064  n.properties = d
+00008bf0: 6565 7063 6f70 7928 706f 696e 7473 2e70  eepcopy(points.p
+00008c00: 726f 7065 7274 6965 7329 0a0a 2020 2020  roperties)..    
+00008c10: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+00008c20: 645f 706f 6c79 676f 6e73 2870 6f6c 7967  d_polygons(polyg
+00008c30: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+00008c40: 7265 7475 726e 2070 6f6c 7967 6f6e 0a0a  return polygon..
+00008c50: 2020 2020 2020 2020 656c 6966 2068 6173          elif has
+00008c60: 6174 7472 2870 6f69 6e74 732c 2022 6765  attr(points, "ge
+00008c70: 6f6d 7322 293a 0a20 2020 2020 2020 2020  oms"):.         
+00008c80: 2020 2066 6f72 2067 656f 6d20 696e 2070     for geom in p
+00008c90: 6f69 6e74 732e 6765 6f6d 733a 0a20 2020  oints.geoms:.   
+00008ca0: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00008cb0: 7967 6f6e 203d 2073 656c 662e 6164 645f  ygon = self.add_
+00008cc0: 706f 6c79 676f 6e28 6765 6f6d 2c20 6c61  polygon(geom, la
+00008cd0: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
+00008ce0: 2020 2020 2020 2072 6574 7572 6e20 706f         return po
+00008cf0: 6c79 676f 6e0a 2020 2020 2020 2020 656c  lygon.        el
+00008d00: 6966 2068 6173 6174 7472 2870 6f69 6e74  if hasattr(point
+00008d10: 732c 2022 6578 7465 7269 6f72 2229 3a20  s, "exterior"): 
+00008d20: 2023 2070 6f69 6e74 7320 6973 2061 2073   # points is a s
+00008d30: 6861 7065 6c79 2050 6f6c 7967 6f6e 0a20  hapely Polygon. 
+00008d40: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00008d50: 2c20 6461 7461 7479 7065 203d 205f 7061  , datatype = _pa
+00008d60: 7273 655f 6c61 7965 7228 6c61 7965 7229  rse_layer(layer)
+00008d70: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+00008d80: 6e74 735f 6f6e 5f67 7269 6420 3d20 6e70  nts_on_grid = np
+00008d90: 2e72 6f75 6e64 2870 6f69 6e74 732e 6578  .round(points.ex
+00008da0: 7465 7269 6f72 2e63 6f6f 7264 732c 2033  terior.coords, 3
+00008db0: 290a 2020 2020 2020 2020 2020 2020 706f  ).            po
+00008dc0: 6c79 676f 6e20 3d20 506f 6c79 676f 6e28  lygon = Polygon(
+00008dd0: 706f 696e 7473 5f6f 6e5f 6772 6964 2c20  points_on_grid, 
+00008de0: 286c 6179 6572 2c20 6461 7461 7479 7065  (layer, datatype
+00008df0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00008e00: 6966 2070 6f69 6e74 732e 696e 7465 7269  if points.interi
+00008e10: 6f72 733a 0a20 2020 2020 2020 2020 2020  ors:.           
+00008e20: 2020 2020 2066 726f 6d20 7368 6170 656c       from shapel
+00008e30: 7920 696d 706f 7274 2067 6574 5f63 6f6f  y import get_coo
+00008e40: 7264 696e 6174 6573 0a0a 2020 2020 2020  rdinates..      
+00008e50: 2020 2020 2020 2020 2020 706f 696e 7473            points
+00008e60: 5f6f 6e5f 6772 6964 5f69 6e74 6572 696f  _on_grid_interio
+00008e70: 7220 3d20 6e70 2e72 6f75 6e64 2867 6574  r = np.round(get
+00008e80: 5f63 6f6f 7264 696e 6174 6573 2870 6f69  _coordinates(poi
+00008e90: 6e74 732e 696e 7465 7269 6f72 7329 2c20  nts.interiors), 
+00008ea0: 3329 0a20 2020 2020 2020 2020 2020 2020  3).             
+00008eb0: 2020 2070 6f6c 7967 6f6e 5f69 6e74 6572     polygon_inter
+00008ec0: 696f 7220 3d20 506f 6c79 676f 6e28 706f  ior = Polygon(po
+00008ed0: 696e 7473 5f6f 6e5f 6772 6964 5f69 6e74  ints_on_grid_int
+00008ee0: 6572 696f 722c 2028 6c61 7965 722c 2064  erior, (layer, d
+00008ef0: 6174 6174 7970 6529 290a 2020 2020 2020  atatype)).      
+00008f00: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+00008f10: 6e73 203d 2067 6473 746b 2e62 6f6f 6c65  ns = gdstk.boole
+00008f20: 616e 280a 2020 2020 2020 2020 2020 2020  an(.            
+00008f30: 2020 2020 2020 2020 706f 6c79 676f 6e2c          polygon,
+00008f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008f50: 2020 2020 2070 6f6c 7967 6f6e 5f69 6e74       polygon_int
+00008f60: 6572 696f 722c 0a20 2020 2020 2020 2020  erior,.         
+00008f70: 2020 2020 2020 2020 2020 206f 7065 7261             opera
+00008f80: 7469 6f6e 3d22 6e6f 7422 2c0a 2020 2020  tion="not",.    
+00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fa0: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
+00008fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fc0: 2064 6174 6174 7970 653d 6461 7461 7479   datatype=dataty
+00008fd0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00008fe0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00008ff0: 2020 2020 2020 666f 7220 706f 6c79 676f        for polygo
+00009000: 6e20 696e 2070 6f6c 7967 6f6e 733a 0a20  n in polygons:. 
+00009010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009020: 2020 2073 656c 662e 5f61 6464 5f70 6f6c     self._add_pol
+00009030: 7967 6f6e 7328 706f 6c79 676f 6e29 0a20  ygons(polygon). 
+00009040: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009050: 6574 7572 6e20 706f 6c79 676f 6e0a 0a20  eturn polygon.. 
+00009060: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009070: 5f61 6464 5f70 6f6c 7967 6f6e 7328 706f  _add_polygons(po
+00009080: 6c79 676f 6e29 0a20 2020 2020 2020 2020  lygon).         
+00009090: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
+000090a0: 6e0a 0a20 2020 2020 2020 2070 6f69 6e74  n..        point
+000090b0: 7320 3d20 6e70 2e61 7361 7272 6179 2870  s = np.asarray(p
+000090c0: 6f69 6e74 7329 0a20 2020 2020 2020 2069  oints).        i
+000090d0: 6620 706f 696e 7473 2e6e 6469 6d20 3d3d  f points.ndim ==
+000090e0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+000090f0: 7265 7475 726e 205b 7365 6c66 2e61 6464  return [self.add
+00009100: 5f70 6f6c 7967 6f6e 2870 6f6c 792c 206c  _polygon(poly, l
+00009110: 6179 6572 3d6c 6179 6572 2920 666f 7220  ayer=layer) for 
+00009120: 706f 6c79 2069 6e20 706f 696e 7473 5d0a  poly in points].
+00009130: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+00009140: 2069 7320 6e70 2e6e 616e 3a0a 2020 2020   is np.nan:.    
+00009150: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+00009160: 300a 0a20 2020 2020 2020 2069 6620 706f  0..        if po
+00009170: 696e 7473 2e6e 6469 6d20 3d3d 2032 3a0a  ints.ndim == 2:.
+00009180: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
+00009190: 6420 7369 6e67 6c65 2070 6f6c 7967 6f6e  d single polygon
+000091a0: 2066 726f 6d20 706f 696e 7473 0a20 2020   from points.   
+000091b0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+000091c0: 706f 696e 7473 5b30 5d29 203e 2032 3a0a  points[0]) > 2:.
+000091d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091e0: 2320 436f 6e76 6572 7420 746f 2066 6f72  # Convert to for
+000091f0: 6d20 5b5b 312c 325d 2c5b 332c 345d 2c5b  m [[1,2],[3,4],[
+00009200: 352c 365d 5d0a 2020 2020 2020 2020 2020  5,6]].          
+00009210: 2020 2020 2020 706f 696e 7473 203d 206e        points = n
+00009220: 702e 636f 6c75 6d6e 5f73 7461 636b 2870  p.column_stack(p
+00009230: 6f69 6e74 7329 0a20 2020 2020 2020 2020  oints).         
+00009240: 2020 206c 6179 6572 2c20 6461 7461 7479     layer, dataty
+00009250: 7065 203d 205f 7061 7273 655f 6c61 7965  pe = _parse_laye
+00009260: 7228 6c61 7965 7229 0a20 2020 2020 2020  r(layer).       
+00009270: 2020 2020 2070 6f6c 7967 6f6e 203d 2050       polygon = P
+00009280: 6f6c 7967 6f6e 2870 6f69 6e74 732c 2028  olygon(points, (
+00009290: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+000092a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000092b0: 6c66 2e5f 6164 645f 706f 6c79 676f 6e73  lf._add_polygons
+000092c0: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
+000092d0: 2020 2020 2020 7265 7475 726e 2070 6f6c        return pol
+000092e0: 7967 6f6e 0a20 2020 2020 2020 2065 6c69  ygon.        eli
+000092f0: 6620 706f 696e 7473 2e6e 6469 6d20 3d3d  f points.ndim ==
+00009300: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+00009310: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
+00009320: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
+00009330: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+00009340: 2020 706f 6c79 676f 6e73 203d 205b 506f    polygons = [Po
+00009350: 6c79 676f 6e28 7070 6f69 6e74 732c 2028  lygon(ppoints, (
+00009360: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+00009370: 2920 666f 7220 7070 6f69 6e74 7320 696e  ) for ppoints in
+00009380: 2070 6f69 6e74 735d 0a20 2020 2020 2020   points].       
+00009390: 2020 2020 2073 656c 662e 5f61 6464 5f70       self._add_p
+000093a0: 6f6c 7967 6f6e 7328 2a70 6f6c 7967 6f6e  olygons(*polygon
+000093b0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+000093c0: 6574 7572 6e20 706f 6c79 676f 6e73 0a20  eturn polygons. 
+000093d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000093e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000093f0: 616c 7565 4572 726f 7228 6622 556e 6162  alueError(f"Unab
+00009400: 6c65 2074 6f20 6164 6420 7b70 6f69 6e74  le to add {point
+00009410: 732e 6e64 696d 7d2d 6469 6d65 6e73 696f  s.ndim}-dimensio
+00009420: 6e61 6c20 706f 696e 7473 206f 626a 6563  nal points objec
+00009430: 7422 290a 0a20 2020 2064 6566 205f 6164  t")..    def _ad
+00009440: 645f 706f 6c79 676f 6e73 2873 656c 662c  d_polygons(self,
+00009450: 202a 706f 6c79 676f 6e73 3a20 6c69 7374   *polygons: list
+00009460: 5b50 6f6c 7967 6f6e 5d29 202d 3e20 4e6f  [Polygon]) -> No
+00009470: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
+00009480: 2e69 735f 756e 6c6f 636b 6564 2829 0a20  .is_unlocked(). 
+00009490: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
+000094a0: 6c2e 6164 6428 2a70 6f6c 7967 6f6e 7329  l.add(*polygons)
+000094b0: 0a0a 2020 2020 6465 6620 636f 7079 2873  ..    def copy(s
+000094c0: 656c 6629 202d 3e20 436f 6d70 6f6e 656e  elf) -> Componen
+000094d0: 743a 0a20 2020 2020 2020 2072 6574 7572  t:.        retur
+000094e0: 6e20 636f 7079 2873 656c 6629 0a0a 2020  n copy(self)..  
+000094f0: 2020 6465 6620 6164 645f 7265 665f 636f    def add_ref_co
+00009500: 6e74 6169 6e65 7228 7365 6c66 2c20 636f  ntainer(self, co
+00009510: 6d70 6f6e 656e 743a 2043 6f6d 706f 6e65  mponent: Compone
+00009520: 6e74 2920 2d3e 2043 6f6d 706f 6e65 6e74  nt) -> Component
+00009530: 5265 6665 7265 6e63 653a 0a20 2020 2020  Reference:.     
+00009540: 2020 2022 2222 4164 6420 7265 6665 7265     """Add refere
+00009550: 6e63 652c 2070 6f72 7473 2061 6e64 2063  nce, ports and c
+00009560: 6f70 795f 6368 696c 645f 696e 666f 2e22  opy_child_info."
+00009570: 2222 0a20 2020 2020 2020 2072 6566 203d  "".        ref =
+00009580: 2073 656c 6620 3c3c 2063 6f6d 706f 6e65   self << compone
+00009590: 6e74 0a20 2020 2020 2020 2073 656c 662e  nt.        self.
+000095a0: 6164 645f 706f 7274 7328 7265 662e 706f  add_ports(ref.po
+000095b0: 7274 7329 0a20 2020 2020 2020 2073 656c  rts).        sel
+000095c0: 662e 636f 7079 5f63 6869 6c64 5f69 6e66  f.copy_child_inf
+000095d0: 6f28 636f 6d70 6f6e 656e 7429 0a20 2020  o(component).   
+000095e0: 2020 2020 2072 6574 7572 6e20 7265 660a       return ref.
+000095f0: 0a20 2020 2064 6566 2063 6f70 795f 6368  .    def copy_ch
+00009600: 696c 645f 696e 666f 2873 656c 662c 2063  ild_info(self, c
+00009610: 6f6d 706f 6e65 6e74 3a20 436f 6d70 6f6e  omponent: Compon
+00009620: 656e 7429 202d 3e20 4e6f 6e65 3a0a 2020  ent) -> None:.  
+00009630: 2020 2020 2020 2222 2243 6f70 7920 616e        """Copy an
+00009640: 6420 7365 7474 696e 6773 2069 6e66 6f20  d settings info 
+00009650: 6672 6f6d 2063 6869 6c64 2063 6f6d 706f  from child compo
+00009660: 6e65 6e74 2069 6e74 6f20 7061 7265 6e74  nent into parent
+00009670: 2e0a 0a20 2020 2020 2020 2050 6172 656e  ...        Paren
+00009680: 7420 636f 6d70 6f6e 656e 7473 2063 616e  t components can
+00009690: 2061 6363 6573 7320 6368 696c 6420 6365   access child ce
+000096a0: 6c6c 7320 7365 7474 696e 6773 2e0a 2020  lls settings..  
+000096b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000096c0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000096d0: 6e63 6528 636f 6d70 6f6e 656e 742c 2043  nce(component, C
+000096e0: 6f6d 706f 6e65 6e74 207c 2043 6f6d 706f  omponent | Compo
+000096f0: 6e65 6e74 5265 6665 7265 6e63 6529 3a0a  nentReference):.
+00009700: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00009710: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00009720: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00009730: 7b74 7970 6528 636f 6d70 6f6e 656e 7429  {type(component)
+00009740: 7d22 2022 6973 206e 6f74 2061 2043 6f6d  }" "is not a Com
+00009750: 706f 6e65 6e74 206f 7220 436f 6d70 6f6e  ponent or Compon
+00009760: 656e 7452 6566 6572 656e 6365 220a 2020  entReference".  
+00009770: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00009780: 2020 2020 2073 656c 662e 5f67 6574 5f63       self._get_c
+00009790: 6869 6c64 5f6e 616d 6520 3d20 5472 7565  hild_name = True
+000097a0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+000097b0: 696c 6420 3d20 636f 6d70 6f6e 656e 740a  ild = component.
+000097c0: 2020 2020 2020 2020 7365 6c66 2e69 6e66          self.inf
+000097d0: 6f2e 7570 6461 7465 2863 6f6d 706f 6e65  o.update(compone
+000097e0: 6e74 2e69 6e66 6f29 0a20 2020 2020 2020  nt.info).       
+000097f0: 2073 656c 662e 7365 7474 696e 6773 2e75   self.settings.u
+00009800: 7064 6174 6528 636f 6d70 6f6e 656e 742e  pdate(component.
+00009810: 7365 7474 696e 6773 290a 0a20 2020 2040  settings)..    @
+00009820: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00009830: 2073 697a 655f 696e 666f 2873 656c 6629   size_info(self)
+00009840: 202d 3e20 5369 7a65 496e 666f 3a0a 2020   -> SizeInfo:.  
+00009850: 2020 2020 2020 2222 2253 697a 6520 696e        """Size in
+00009860: 666f 206f 6620 7468 6520 636f 6d70 6f6e  fo of the compon
+00009870: 656e 742e 2222 220a 2020 2020 2020 2020  ent.""".        
+00009880: 7265 7475 726e 2053 697a 6549 6e66 6f28  return SizeInfo(
+00009890: 7365 6c66 2e62 626f 7829 0a0a 2020 2020  self.bbox)..    
+000098a0: 6465 6620 6765 745f 7365 7474 696e 6728  def get_setting(
+000098b0: 7365 6c66 2c20 7365 7474 696e 673a 2073  self, setting: s
+000098c0: 7472 2920 2d3e 2073 7472 207c 2069 6e74  tr) -> str | int
+000098d0: 207c 2066 6c6f 6174 3a0a 2020 2020 2020   | float:.      
+000098e0: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+000098f0: 2020 2020 2020 2073 656c 662e 696e 666f         self.info
+00009900: 2e67 6574 2873 6574 7469 6e67 290a 2020  .get(setting).  
+00009910: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
+00009920: 662e 7365 7474 696e 6773 2e66 756c 6c2e  f.settings.full.
+00009930: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
+00009940: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+00009950: 2e6d 6574 6164 6174 615f 6368 696c 642e  .metadata_child.
+00009960: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
+00009970: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00009980: 6973 5f75 6e6c 6f63 6b65 6428 7365 6c66  is_unlocked(self
+00009990: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000099a0: 2020 2022 2222 5261 6973 6573 2065 7272     """Raises err
+000099b0: 6f72 2069 6620 436f 6d70 6f6e 656e 7420  or if Component 
+000099c0: 6973 206c 6f63 6b65 642e 2222 220a 2020  is locked.""".  
+000099d0: 2020 2020 2020 6966 2073 656c 662e 5f6c        if self._l
+000099e0: 6f63 6b65 643a 0a20 2020 2020 2020 2020  ocked:.         
+000099f0: 2020 2072 6169 7365 204d 7574 6162 696c     raise Mutabil
+00009a00: 6974 7945 7272 6f72 280a 2020 2020 2020  ityError(.      
+00009a10: 2020 2020 2020 2020 2020 6622 436f 6d70            f"Comp
+00009a20: 6f6e 656e 7420 7b73 656c 662e 6e61 6d65  onent {self.name
+00009a30: 2172 7d20 6361 6e6e 6f74 2062 6520 6d6f  !r} cannot be mo
+00009a40: 6469 6669 6564 2061 7320 6974 2773 2061  dified as it's a
+00009a50: 6c72 6561 6479 206f 6e20 6361 6368 652e  lready on cache.
+00009a60: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00009a70: 2020 202b 206d 7574 6162 696c 6974 795f     + mutability_
+00009a80: 6572 726f 725f 6d65 7373 6167 650a 2020  error_message.  
+00009a90: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00009aa0: 2064 6566 205f 6164 6428 7365 6c66 2c20   def _add(self, 
+00009ab0: 656c 656d 656e 7429 202d 3e20 4e6f 6e65  element) -> None
+00009ac0: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
+00009ad0: 2061 206e 6577 2065 6c65 6d65 6e74 206f   a new element o
+00009ae0: 7220 6c69 7374 206f 6620 656c 656d 656e  r list of elemen
+00009af0: 7473 2074 6f20 7468 6973 2043 6f6d 706f  ts to this Compo
+00009b00: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+00009b10: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00009b20: 2065 6c65 6d65 6e74 3a20 506f 6c79 676f   element: Polygo
+00009b30: 6e2c 2043 6f6d 706f 6e65 6e74 5265 6665  n, ComponentRefe
+00009b40: 7265 6e63 6520 6f72 2069 7465 7261 626c  rence or iterabl
+00009b50: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00009b60: 2020 5468 6520 656c 656d 656e 7420 6f72    The element or
+00009b70: 2069 7465 7261 626c 6520 6f66 2065 6c65   iterable of ele
+00009b80: 6d65 6e74 7320 746f 2062 6520 696e 7365  ments to be inse
+00009b90: 7274 6564 2069 6e20 7468 6973 2063 656c  rted in this cel
+00009ba0: 6c2e 0a0a 2020 2020 2020 2020 5261 6973  l...        Rais
+00009bb0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00009bc0: 4d75 7461 6269 6c69 7479 4572 726f 723a  MutabilityError:
+00009bd0: 2069 6620 636f 6d70 6f6e 656e 7420 6973   if component is
+00009be0: 206c 6f63 6b65 642e 0a20 2020 2020 2020   locked..       
+00009bf0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+00009c00: 662e 6973 5f75 6e6c 6f63 6b65 6428 290a  f.is_unlocked().
+00009c10: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00009c20: 7461 6e63 6528 656c 656d 656e 742c 2043  tance(element, C
+00009c30: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00009c40: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00009c50: 7365 6c66 2e5f 6365 6c6c 2e61 6464 2865  self._cell.add(e
+00009c60: 6c65 6d65 6e74 2e5f 7265 6665 7265 6e63  lement._referenc
+00009c70: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+00009c80: 656c 662e 5f72 6566 6572 656e 6365 732e  elf._references.
+00009c90: 6170 7065 6e64 2865 6c65 6d65 6e74 290a  append(element).
+00009ca0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00009cb0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009cc0: 6365 6c6c 2e61 6464 2865 6c65 6d65 6e74  cell.add(element
+00009cd0: 290a 0a20 2020 2064 6566 2061 6464 2873  )..    def add(s
+00009ce0: 656c 662c 2065 6c65 6d65 6e74 2920 2d3e  elf, element) ->
+00009cf0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00009d00: 2222 4164 6420 6120 6e65 7720 656c 656d  ""Add a new elem
+00009d10: 656e 7420 6f72 206c 6973 7420 6f66 2065  ent or list of e
+00009d20: 6c65 6d65 6e74 7320 746f 2074 6869 7320  lements to this 
+00009d30: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+00009d40: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00009d50: 2020 2020 2020 656c 656d 656e 743a 2050        element: P
+00009d60: 6f6c 7967 6f6e 2c20 436f 6d70 6f6e 656e  olygon, Componen
+00009d70: 7452 6566 6572 656e 6365 206f 7220 6974  tReference or it
+00009d80: 6572 6162 6c65 0a20 2020 2020 2020 2020  erable.         
+00009d90: 2020 2020 2020 2054 6865 2065 6c65 6d65         The eleme
+00009da0: 6e74 206f 7220 6974 6572 6162 6c65 206f  nt or iterable o
+00009db0: 6620 656c 656d 656e 7473 2074 6f20 6265  f elements to be
+00009dc0: 2069 6e73 6572 7465 6420 696e 2074 6869   inserted in thi
+00009dd0: 7320 6365 6c6c 2e0a 0a20 2020 2020 2020  s cell...       
+00009de0: 2052 6169 7365 733a 0a20 2020 2020 2020   Raises:.       
+00009df0: 2020 2020 204d 7574 6162 696c 6974 7945       MutabilityE
+00009e00: 7272 6f72 3a20 6966 2063 6f6d 706f 6e65  rror: if compone
+00009e10: 6e74 2069 7320 6c6f 636b 6564 2e0a 2020  nt is locked..  
+00009e20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00009e30: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00009e40: 656c 656d 656e 742c 2043 6f6d 706f 6e65  element, Compone
+00009e50: 6e74 5265 6665 7265 6e63 6529 3a0a 2020  ntReference):.  
+00009e60: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009e70: 7265 6769 7374 6572 5f72 6566 6572 656e  register_referen
+00009e80: 6365 2865 6c65 6d65 6e74 290a 2020 2020  ce(element).    
+00009e90: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+00009ea0: 6428 656c 656d 656e 7429 0a20 2020 2020  d(element).     
+00009eb0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00009ec0: 6365 2865 6c65 6d65 6e74 2c20 4974 6572  ce(element, Iter
+00009ed0: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
+00009ee0: 2020 2066 6f72 2073 7562 656c 656d 656e     for subelemen
+00009ef0: 7420 696e 2065 6c65 6d65 6e74 3a0a 2020  t in element:.  
+00009f00: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00009f10: 6c66 2e61 6464 2873 7562 656c 656d 656e  lf.add(subelemen
+00009f20: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
+00009f30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009f40: 662e 5f61 6464 2865 6c65 6d65 6e74 290a  f._add(element).
+00009f50: 0a20 2020 2064 6566 2061 6464 5f61 7272  .    def add_arr
+00009f60: 6179 280a 2020 2020 2020 2020 7365 6c66  ay(.        self
+00009f70: 2c0a 2020 2020 2020 2020 636f 6d70 6f6e  ,.        compon
+00009f80: 656e 743a 2043 6f6d 706f 6e65 6e74 2c0a  ent: Component,.
+00009f90: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
+00009fa0: 2069 6e74 203d 2032 2c0a 2020 2020 2020   int = 2,.      
+00009fb0: 2020 726f 7773 3a20 696e 7420 3d20 322c    rows: int = 2,
+00009fc0: 0a20 2020 2020 2020 2073 7061 6369 6e67  .        spacing
+00009fd0: 3a20 7475 706c 655b 666c 6f61 742c 2066  : tuple[float, f
+00009fe0: 6c6f 6174 5d20 3d20 2831 3030 2c20 3130  loat] = (100, 10
+00009ff0: 3029 2c0a 2020 2020 2020 2020 616c 6961  0),.        alia
+0000a000: 733a 2073 7472 207c 204e 6f6e 6520 3d20  s: str | None = 
+0000a010: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2043  None,.    ) -> C
+0000a020: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+0000a030: 653a 0a20 2020 2020 2020 2022 2222 4372  e:.        """Cr
+0000a040: 6561 7465 7320 6120 436f 6d70 6f6e 656e  eates a Componen
+0000a050: 7452 6566 6572 656e 6365 2072 6566 6572  tReference refer
+0000a060: 656e 6365 2074 6f20 6120 436f 6d70 6f6e  ence to a Compon
+0000a070: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
+0000a080: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000a090: 636f 6d70 6f6e 656e 743a 2054 6865 2072  component: The r
+0000a0a0: 6566 6572 656e 6365 6420 636f 6d70 6f6e  eferenced compon
+0000a0b0: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+0000a0c0: 2063 6f6c 756d 6e73 3a20 4e75 6d62 6572   columns: Number
+0000a0d0: 206f 6620 636f 6c75 6d6e 7320 696e 2074   of columns in t
+0000a0e0: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
+0000a0f0: 2020 2020 2020 726f 7773 3a20 4e75 6d62        rows: Numb
+0000a100: 6572 206f 6620 726f 7773 2069 6e20 7468  er of rows in th
+0000a110: 6520 6172 7261 792e 0a20 2020 2020 2020  e array..       
+0000a120: 2020 2020 2073 7061 6369 6e67 3a20 6172       spacing: ar
+0000a130: 7261 792d 6c69 6b65 5b32 5d20 6f66 2069  ray-like[2] of i
+0000a140: 6e74 206f 7220 666c 6f61 742e 0a20 2020  nt or float..   
+0000a150: 2020 2020 2020 2020 2020 2020 2044 6973               Dis
+0000a160: 7461 6e63 6520 6265 7477 6565 6e20 6164  tance between ad
+0000a170: 6a61 6365 6e74 2063 6f6c 756d 6e73 2061  jacent columns a
+0000a180: 6e64 2061 646a 6163 656e 7420 726f 7773  nd adjacent rows
+0000a190: 2e0a 2020 2020 2020 2020 2020 2020 616c  ..            al
+0000a1a0: 6961 733a 2073 7472 206f 7220 4e6f 6e65  ias: str or None
+0000a1b0: 2e20 416c 6961 7320 6f66 2074 6865 2072  . Alias of the r
+0000a1c0: 6566 6572 656e 6365 6420 436f 6d70 6f6e  eferenced Compon
+0000a1d0: 656e 742e 0a0a 2020 2020 2020 2020 5265  ent...        Re
+0000a1e0: 7475 726e 730a 2020 2020 2020 2020 2020  turns.          
+0000a1f0: 2020 613a 2043 6f6d 706f 6e65 6e74 5265    a: ComponentRe
+0000a200: 6665 7265 6e63 6520 636f 6e74 6169 6e69  ference containi
+0000a210: 6e67 2072 6566 6572 656e 6365 7320 746f  ng references to
+0000a220: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
+0000a230: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a240: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+0000a250: 7461 6e63 6528 636f 6d70 6f6e 656e 742c  tance(component,
+0000a260: 2043 6f6d 706f 6e65 6e74 293a 0a20 2020   Component):.   
+0000a270: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000a280: 7970 6545 7272 6f72 2822 6164 645f 6172  ypeError("add_ar
+0000a290: 7261 7928 2920 6e65 6564 7320 6120 436f  ray() needs a Co
+0000a2a0: 6d70 6f6e 656e 7420 6f62 6a65 6374 2e22  mponent object."
+0000a2b0: 290a 2020 2020 2020 2020 7265 6620 3d20  ).        ref = 
+0000a2c0: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+0000a2d0: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0000a2e0: 636f 6d70 6f6e 656e 743d 636f 6d70 6f6e  component=compon
+0000a2f0: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+0000a300: 2063 6f6c 756d 6e73 3d69 6e74 2872 6f75   columns=int(rou
+0000a310: 6e64 2863 6f6c 756d 6e73 2929 2c0a 2020  nd(columns)),.  
+0000a320: 2020 2020 2020 2020 2020 726f 7773 3d69            rows=i
+0000a330: 6e74 2872 6f75 6e64 2872 6f77 7329 292c  nt(round(rows)),
+0000a340: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
+0000a350: 6369 6e67 3d73 7061 6369 6e67 2c0a 2020  cing=spacing,.  
+0000a360: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000a370: 7265 662e 6e61 6d65 203d 204e 6f6e 650a  ref.name = None.
+0000a380: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+0000a390: 6428 7265 6629 0a20 2020 2020 2020 2073  d(ref).        s
+0000a3a0: 656c 662e 5f72 6567 6973 7465 725f 7265  elf._register_re
+0000a3b0: 6665 7265 6e63 6528 7265 6665 7265 6e63  ference(referenc
+0000a3c0: 653d 7265 662c 2061 6c69 6173 3d61 6c69  e=ref, alias=ali
+0000a3d0: 6173 290a 2020 2020 2020 2020 7265 7475  as).        retu
+0000a3e0: 726e 2072 6566 0a0a 2020 2020 6465 6620  rn ref..    def 
+0000a3f0: 6469 7374 7269 6275 7465 280a 2020 2020  distribute(.    
+0000a400: 2020 2020 7365 6c66 2c20 656c 656d 656e      self, elemen
+0000a410: 7473 3d22 616c 6c22 2c20 6469 7265 6374  ts="all", direct
+0000a420: 696f 6e3d 2278 222c 2073 7061 6369 6e67  ion="x", spacing
+0000a430: 3d31 3030 2c20 7365 7061 7261 7469 6f6e  =100, separation
+0000a440: 3d54 7275 652c 2065 6467 653d 2263 656e  =True, edge="cen
+0000a450: 7465 7222 0a20 2020 2029 3a0a 2020 2020  ter".    ):.    
+0000a460: 2020 2020 2222 2244 6973 7472 6962 7574      """Distribut
+0000a470: 6573 2074 6865 2073 7065 6369 6669 6564  es the specified
+0000a480: 2065 6c65 6d65 6e74 7320 696e 2074 6865   elements in the
+0000a490: 2043 6f6d 706f 6e65 6e74 2e0a 0a20 2020   Component...   
+0000a4a0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000a4b0: 2020 2020 2020 2065 6c65 6d65 6e74 7320         elements 
+0000a4c0: 3a20 6172 7261 792d 6c69 6b65 206f 6620  : array-like of 
+0000a4d0: 6f62 6a65 6374 7320 6f72 2027 616c 6c27  objects or 'all'
+0000a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a4f0: 2045 6c65 6d65 6e74 7320 746f 2064 6973   Elements to dis
+0000a500: 7472 6962 7574 652e 0a20 2020 2020 2020  tribute..       
+0000a510: 2020 2020 2064 6972 6563 7469 6f6e 203a       direction :
+0000a520: 207b 2778 272c 2027 7927 7d0a 2020 2020   {'x', 'y'}.    
+0000a530: 2020 2020 2020 2020 2020 2020 4469 7265              Dire
+0000a540: 6374 696f 6e20 6f66 2064 6973 7472 6962  ction of distrib
+0000a550: 7574 696f 6e3b 2065 6974 6865 7220 6120  ution; either a 
+0000a560: 6c69 6e65 2069 6e20 7468 6520 782d 6469  line in the x-di
+0000a570: 7265 6374 696f 6e20 6f72 0a20 2020 2020  rection or.     
+0000a580: 2020 2020 2020 2020 2020 2079 2d64 6972             y-dir
+0000a590: 6563 7469 6f6e 2e0a 2020 2020 2020 2020  ection..        
+0000a5a0: 2020 2020 7370 6163 696e 6720 3a20 696e      spacing : in
+0000a5b0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0000a5c0: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+0000a5d0: 6e63 6520 6265 7477 6565 6e20 656c 656d  nce between elem
+0000a5e0: 656e 7473 2e0a 2020 2020 2020 2020 2020  ents..          
+0000a5f0: 2020 7365 7061 7261 7469 6f6e 203a 2062    separation : b
+0000a600: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+0000a610: 2020 2020 4966 2054 7275 652c 2067 7561      If True, gua
+0000a620: 7261 6e74 6565 7320 656c 656d 656e 7473  rantees elements
+0000a630: 2061 7265 2073 6570 6172 6174 6564 2077   are separated w
+0000a640: 6974 6820 6120 6669 7865 6420 7370 6163  ith a fixed spac
+0000a650: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0000a660: 2020 2020 6265 7477 6565 6e3b 2069 6620      between; if 
+0000a670: 2046 616c 7365 2c20 656c 656d 656e 7473   False, elements
+0000a680: 2061 7265 2073 7061 6365 6420 6576 656e   are spaced even
+0000a690: 6c79 2061 6c6f 6e67 2061 2067 7269 642e  ly along a grid.
+0000a6a0: 0a20 2020 2020 2020 2020 2020 2065 6467  .            edg
+0000a6b0: 6520 3a20 7b27 7827 2c20 2778 6d69 6e27  e : {'x', 'xmin'
+0000a6c0: 2c20 2778 6d61 7827 2c20 2779 272c 2027  , 'xmax', 'y', '
+0000a6d0: 796d 696e 272c 2027 796d 6178 277d 0a20  ymin', 'ymax'}. 
+0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2057                 W
+0000a6f0: 6869 6368 2065 6467 6520 746f 2070 6572  hich edge to per
+0000a700: 666f 726d 2074 6865 2064 6973 7472 6962  form the distrib
+0000a710: 7574 696f 6e20 616c 6f6e 6720 2875 6e75  ution along (unu
+0000a720: 7365 6420 6966 0a20 2020 2020 2020 2020  sed if.         
+0000a730: 2020 2020 2020 2073 6570 6172 6174 696f         separatio
+0000a740: 6e20 3d3d 2054 7275 6529 0a0a 2020 2020  n == True)..    
+0000a750: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000a760: 6966 2065 6c65 6d65 6e74 7320 3d3d 2022  if elements == "
+0000a770: 616c 6c22 3a0a 2020 2020 2020 2020 2020  all":.          
+0000a780: 2020 656c 656d 656e 7473 203d 2073 656c    elements = sel
+0000a790: 662e 706f 6c79 676f 6e73 202b 2073 656c  f.polygons + sel
+0000a7a0: 662e 7265 6665 7265 6e63 6573 0a20 2020  f.references.   
+0000a7b0: 2020 2020 205f 6469 7374 7269 6275 7465       _distribute
+0000a7c0: 280a 2020 2020 2020 2020 2020 2020 656c  (.            el
+0000a7d0: 656d 656e 7473 3d65 6c65 6d65 6e74 732c  ements=elements,
+0000a7e0: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
+0000a7f0: 6563 7469 6f6e 3d64 6972 6563 7469 6f6e  ection=direction
+0000a800: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
+0000a810: 6163 696e 673d 7370 6163 696e 672c 0a20  acing=spacing,. 
+0000a820: 2020 2020 2020 2020 2020 2073 6570 6172             separ
+0000a830: 6174 696f 6e3d 7365 7061 7261 7469 6f6e  ation=separation
+0000a840: 2c0a 2020 2020 2020 2020 2020 2020 6564  ,.            ed
+0000a850: 6765 3d65 6467 652c 0a20 2020 2020 2020  ge=edge,.       
+0000a860: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+0000a870: 6e20 7365 6c66 0a0a 2020 2020 6465 6620  n self..    def 
+0000a880: 616c 6967 6e28 7365 6c66 2c20 656c 656d  align(self, elem
+0000a890: 656e 7473 3d22 616c 6c22 2c20 616c 6967  ents="all", alig
+0000a8a0: 6e6d 656e 743d 2279 6d61 7822 293a 0a20  nment="ymax"):. 
+0000a8b0: 2020 2020 2020 2022 2222 416c 6967 6e20         """Align 
+0000a8c0: 656c 656d 656e 7473 2069 6e20 7468 6520  elements in the 
+0000a8d0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+0000a8e0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+0000a8f0: 2020 2020 2020 656c 656d 656e 7473 203a        elements :
+0000a900: 2061 7272 6179 2d6c 696b 6520 6f66 206f   array-like of o
+0000a910: 626a 6563 7473 2c20 6f72 2027 616c 6c27  bjects, or 'all'
+0000a920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a930: 2045 6c65 6d65 6e74 7320 696e 2074 6865   Elements in the
+0000a940: 2043 6f6d 706f 6e65 6e74 2074 6f20 616c   Component to al
+0000a950: 6967 6e2e 0a20 2020 2020 2020 2020 2020  ign..           
+0000a960: 2061 6c69 676e 6d65 6e74 203a 207b 2778   alignment : {'x
+0000a970: 272c 2027 7927 2c20 2778 6d69 6e27 2c20  ', 'y', 'xmin', 
+0000a980: 2778 6d61 7827 2c20 2779 6d69 6e27 2c20  'xmax', 'ymin', 
+0000a990: 2779 6d61 7827 7d0a 2020 2020 2020 2020  'ymax'}.        
+0000a9a0: 2020 2020 2020 2020 5768 6963 6820 6564          Which ed
+0000a9b0: 6765 2074 6f20 616c 6967 6e20 616c 6f6e  ge to align alon
+0000a9c0: 6720 2865 2e67 2e20 2779 6d61 7827 2077  g (e.g. 'ymax' w
+0000a9d0: 696c 6c20 6d6f 7665 2074 6865 2065 6c65  ill move the ele
+0000a9e0: 6d65 6e74 7320 7375 6368 0a20 2020 2020  ments such.     
+0000a9f0: 2020 2020 2020 2020 2020 2074 6861 7420             that 
+0000aa00: 616c 6c20 6f66 2074 6865 6972 2074 6f70  all of their top
+0000aa10: 6d6f 7374 2070 6f69 6e74 7320 6172 6520  most points are 
+0000aa20: 616c 6967 6e65 6429 2e0a 2020 2020 2020  aligned)..      
+0000aa30: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000aa40: 2065 6c65 6d65 6e74 7320 3d3d 2022 616c   elements == "al
+0000aa50: 6c22 3a0a 2020 2020 2020 2020 2020 2020  l":.            
+0000aa60: 656c 656d 656e 7473 203d 2073 656c 662e  elements = self.
+0000aa70: 706f 6c79 676f 6e73 202b 2073 656c 662e  polygons + self.
+0000aa80: 7265 6665 7265 6e63 6573 0a20 2020 2020  references.     
+0000aa90: 2020 205f 616c 6967 6e28 656c 656d 656e     _align(elemen
+0000aaa0: 7473 2c20 616c 6967 6e6d 656e 743d 616c  ts, alignment=al
+0000aab0: 6967 6e6d 656e 7429 0a20 2020 2020 2020  ignment).       
+0000aac0: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+0000aad0: 2020 6465 6620 666c 6174 7465 6e28 7365    def flatten(se
+0000aae0: 6c66 2c20 7369 6e67 6c65 5f6c 6179 6572  lf, single_layer
+0000aaf0: 3a20 4c61 7965 7253 7065 6320 7c20 4e6f  : LayerSpec | No
+0000ab00: 6e65 203d 204e 6f6e 6529 3a0a 2020 2020  ne = None):.    
+0000ab10: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
+0000ab20: 2066 6c61 7474 656e 6564 2063 6f70 7920   flattened copy 
+0000ab30: 6f66 2074 6865 2063 6f6d 706f 6e65 6e74  of the component
+0000ab40: 2e0a 0a20 2020 2020 2020 2046 6c61 7474  ...        Flatt
+0000ab50: 656e 7320 7468 6520 6869 6572 6172 6368  ens the hierarch
+0000ab60: 7920 6f66 2074 6865 2043 6f6d 706f 6e65  y of the Compone
+0000ab70: 6e74 2073 7563 6820 7468 6174 2074 6865  nt such that the
+0000ab80: 7265 2061 7265 206e 6f20 6c6f 6e67 6572  re are no longer
+0000ab90: 0a20 2020 2020 2020 2061 6e79 2072 6566  .        any ref
+0000aba0: 6572 656e 6365 7320 746f 206f 7468 6572  erences to other
+0000abb0: 2043 6f6d 706f 6e65 6e74 732e 2041 6c6c   Components. All
+0000abc0: 2070 6f6c 7967 6f6e 7320 616e 6420 6c61   polygons and la
+0000abd0: 6265 6c73 2066 726f 6d0a 2020 2020 2020  bels from.      
+0000abe0: 2020 756e 6465 726c 7969 6e67 2072 6566    underlying ref
+0000abf0: 6572 656e 6365 7320 6172 6520 636f 7069  erences are copi
+0000ac00: 6564 2061 6e64 2070 6c61 6365 6420 696e  ed and placed in
+0000ac10: 2074 6865 2074 6f70 2d6c 6576 656c 2043   the top-level C
+0000ac20: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
+0000ac30: 2020 4966 2073 696e 676c 655f 6c61 7965    If single_laye
+0000ac40: 7220 6973 2073 7065 6369 6669 6564 2c20  r is specified, 
+0000ac50: 616c 6c20 706f 6c79 676f 6e73 2061 7265  all polygons are
+0000ac60: 206d 6f76 6564 2074 6f20 7468 6174 206c   moved to that l
+0000ac70: 6179 6572 2e0a 0a20 2020 2020 2020 2041  ayer...        A
+0000ac80: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000ac90: 2073 696e 676c 655f 6c61 7965 723a 206d   single_layer: m
+0000aca0: 6f76 6520 616c 6c20 706f 6c79 676f 6e73  ove all polygons
+0000acb0: 2061 7265 206d 6f76 6564 2074 6f20 7468   are moved to th
+0000acc0: 6520 7370 6563 6966 6965 6420 286f 7074  e specified (opt
+0000acd0: 696f 6e61 6c29 2e0a 2020 2020 2020 2020  ional)..        
+0000ace0: 2222 220a 2020 2020 2020 2020 636f 6d70  """.        comp
+0000acf0: 6f6e 656e 745f 666c 6174 203d 2043 6f6d  onent_flat = Com
+0000ad00: 706f 6e65 6e74 2829 0a0a 2020 2020 2020  ponent()..      
+0000ad10: 2020 5f63 656c 6c20 3d20 7365 6c66 2e5f    _cell = self._
+0000ad20: 6365 6c6c 2e63 6f70 7928 6e61 6d65 3d63  cell.copy(name=c
+0000ad30: 6f6d 706f 6e65 6e74 5f66 6c61 742e 6e61  omponent_flat.na
+0000ad40: 6d65 290a 2020 2020 2020 2020 5f63 656c  me).        _cel
+0000ad50: 6c20 3d20 5f63 656c 6c2e 666c 6174 7465  l = _cell.flatte
+0000ad60: 6e28 290a 2020 2020 2020 2020 636f 6d70  n().        comp
+0000ad70: 6f6e 656e 745f 666c 6174 2e5f 6365 6c6c  onent_flat._cell
+0000ad80: 203d 205f 6365 6c6c 0a20 2020 2020 2020   = _cell.       
+0000ad90: 2069 6620 7369 6e67 6c65 5f6c 6179 6572   if single_layer
+0000ada0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000adb0: 2020 2020 2020 2020 2020 6672 6f6d 2067            from g
+0000adc0: 6473 6661 6374 6f72 7920 696d 706f 7274  dsfactory import
+0000add0: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
+0000ade0: 2020 2020 2020 2020 6c61 7965 722c 2064          layer, d
+0000adf0: 6174 6174 7970 6520 3d20 6765 745f 6c61  atatype = get_la
+0000ae00: 7965 7228 7369 6e67 6c65 5f6c 6179 6572  yer(single_layer
+0000ae10: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0000ae20: 7220 706f 6c79 676f 6e20 696e 205f 6365  r polygon in _ce
+0000ae30: 6c6c 2e70 6f6c 7967 6f6e 733a 0a20 2020  ll.polygons:.   
+0000ae40: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+0000ae50: 7967 6f6e 2e6c 6179 6572 203d 206c 6179  ygon.layer = lay
+0000ae60: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0000ae70: 2020 2070 6f6c 7967 6f6e 2e64 6174 6174     polygon.datat
+0000ae80: 7970 6520 3d20 6461 7461 7479 7065 0a20  ype = datatype. 
+0000ae90: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+0000aea0: 6174 6820 696e 205f 6365 6c6c 2e70 6174  ath in _cell.pat
+0000aeb0: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
+0000aec0: 2020 2020 7061 7468 2e73 6574 5f6c 6179      path.set_lay
+0000aed0: 6572 7328 6c61 7965 7229 0a20 2020 2020  ers(layer).     
+0000aee0: 2020 2020 2020 2020 2020 2070 6174 682e             path.
+0000aef0: 7365 745f 6461 7461 7479 7065 7328 6461  set_datatypes(da
+0000af00: 7461 7479 7065 290a 0a20 2020 2020 2020  tatype)..       
+0000af10: 2063 6f6d 706f 6e65 6e74 5f66 6c61 742e   component_flat.
+0000af20: 696e 666f 203d 2073 656c 662e 696e 666f  info = self.info
+0000af30: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000af40: 636f 6d70 6f6e 656e 745f 666c 6174 2e61  component_flat.a
+0000af50: 6464 5f70 6f72 7473 2873 656c 662e 706f  dd_ports(self.po
+0000af60: 7274 7329 0a20 2020 2020 2020 2072 6574  rts).        ret
+0000af70: 7572 6e20 636f 6d70 6f6e 656e 745f 666c  urn component_fl
+0000af80: 6174 0a0a 2020 2020 6465 6620 666c 6174  at..    def flat
+0000af90: 7465 6e5f 7265 6665 7265 6e63 6528 7365  ten_reference(se
+0000afa0: 6c66 2c20 7265 663a 2043 6f6d 706f 6e65  lf, ref: Compone
+0000afb0: 6e74 5265 6665 7265 6e63 6529 202d 3e20  ntReference) -> 
+0000afc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000afd0: 2246 726f 6d20 6578 6973 7469 6e67 2063  "From existing c
+0000afe0: 656c 6c20 7265 706c 6163 6573 2072 6566  ell replaces ref
+0000aff0: 6572 656e 6365 2077 6974 6820 6120 666c  erence with a fl
+0000b000: 6174 7465 6e20 7265 6665 7265 6e63 6520  atten reference 
+0000b010: 5c0a 2020 2020 2020 2020 7768 6963 6820  \.        which 
+0000b020: 6861 7320 7468 6520 7472 616e 7366 6f72  has the transfor
+0000b030: 6d61 7469 6f6e 7320 616c 7265 6164 7920  mations already 
+0000b040: 6170 706c 6965 642e 0a0a 2020 2020 2020  applied...      
+0000b050: 2020 5472 616e 7366 6f72 6d65 6420 7265    Transformed re
+0000b060: 6665 7265 6e63 6520 6b65 6570 7320 7468  ference keeps th
+0000b070: 6520 6f72 6967 696e 616c 206e 616d 652e  e original name.
+0000b080: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+0000b090: 2020 2020 2020 2020 2020 2020 7265 663a              ref:
+0000b0a0: 2074 6865 2072 6566 6572 656e 6365 2074   the reference t
+0000b0b0: 6f20 666c 6174 7465 6e20 696e 746f 2061  o flatten into a
+0000b0c0: 206e 6577 2063 656c 6c2e 0a0a 2020 2020   new cell...    
+0000b0d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000b0e0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000b0f0: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
+0000b100: 2074 7261 6e73 666f 726d 6564 0a0a 2020   transformed..  
+0000b110: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+0000b120: 6528 7265 6629 0a20 2020 2020 2020 206e  e(ref).        n
+0000b130: 6577 5f63 6f6d 706f 6e65 6e74 203d 2074  ew_component = t
+0000b140: 7261 6e73 666f 726d 6564 2872 6566 2c20  ransformed(ref, 
+0000b150: 6465 636f 7261 746f 723d 4e6f 6e65 290a  decorator=None).
+0000b160: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+0000b170: 5f72 6566 286e 6577 5f63 6f6d 706f 6e65  _ref(new_compone
+0000b180: 6e74 2c20 616c 6961 733d 7265 662e 6e61  nt, alias=ref.na
+0000b190: 6d65 290a 0a20 2020 2064 6566 2061 6464  me)..    def add
+0000b1a0: 5f72 6566 280a 2020 2020 2020 2020 7365  _ref(.        se
+0000b1b0: 6c66 2c20 636f 6d70 6f6e 656e 743a 2043  lf, component: C
+0000b1c0: 6f6d 706f 6e65 6e74 2c20 616c 6961 733a  omponent, alias:
+0000b1d0: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
+0000b1e0: 6e65 2c20 2a2a 6b77 6172 6773 0a20 2020  ne, **kwargs.   
+0000b1f0: 2029 202d 3e20 436f 6d70 6f6e 656e 7452   ) -> ComponentR
+0000b200: 6566 6572 656e 6365 3a0a 2020 2020 2020  eference:.      
+0000b210: 2020 2222 2241 6464 2043 6f6d 706f 6e65    """Add Compone
+0000b220: 6e74 5265 6665 7265 6e63 6520 746f 2074  ntReference to t
+0000b230: 6865 2063 7572 7265 6e74 2043 6f6d 706f  he current Compo
+0000b240: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+0000b250: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000b260: 2063 6f6d 706f 6e65 6e74 3a20 436f 6d70   component: Comp
+0000b270: 6f6e 656e 742e 0a20 2020 2020 2020 2020  onent..         
+0000b280: 2020 2061 6c69 6173 3a20 6e61 6d65 645f     alias: named_
+0000b290: 7265 6665 7265 6e63 6573 2e0a 0a20 2020  references...   
+0000b2a0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+0000b2b0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+0000b2c0: 6f6c 756d 6e73 3a20 4e75 6d62 6572 206f  olumns: Number o
+0000b2d0: 6620 636f 6c75 6d6e 7320 696e 2074 6865  f columns in the
+0000b2e0: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
+0000b2f0: 2020 2020 726f 7773 3a20 4e75 6d62 6572      rows: Number
+0000b300: 206f 6620 726f 7773 2069 6e20 7468 6520   of rows in the 
+0000b310: 6172 7261 792e 0a20 2020 2020 2020 2020  array..         
+0000b320: 2020 2073 7061 6369 6e67 3a20 4469 7374     spacing: Dist
+0000b330: 616e 6365 7320 6265 7477 6565 6e20 6164  ances between ad
+0000b340: 6a61 6365 6e74 2063 6f6c 756d 6e73 2061  jacent columns a
+0000b350: 6e64 2061 646a 6163 656e 7420 726f 7773  nd adjacent rows
+0000b360: 2e0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+0000b370: 6967 696e 3a20 6172 7261 792d 6c69 6b65  igin: array-like
+0000b380: 5b32 5d20 6f66 2069 6e74 206f 7220 666c  [2] of int or fl
+0000b390: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+0000b3a0: 2020 2020 506f 7369 7469 6f6e 2077 6865      Position whe
+0000b3b0: 7265 2074 6865 2063 656c 6c20 6973 2069  re the cell is i
+0000b3c0: 6e73 6572 7465 642e 0a20 2020 2020 2020  nserted..       
+0000b3d0: 2020 2020 2072 6f74 6174 696f 6e20 3a20       rotation : 
+0000b3e0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+0000b3f0: 2020 2020 2020 2020 2020 2020 2041 6e67               Ang
+0000b400: 6c65 206f 6620 726f 7461 7469 6f6e 206f  le of rotation o
+0000b410: 6620 7468 6520 7265 6665 7265 6e63 6520  f the reference 
+0000b420: 2869 6e20 6064 6567 7265 6573 6029 2e0a  (in `degrees`)..
+0000b430: 2020 2020 2020 2020 2020 2020 6d61 676e              magn
+0000b440: 6966 6963 6174 696f 6e20 3a20 696e 7420  ification : int 
+0000b450: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+0000b460: 2020 2020 2020 2020 204d 6167 6e69 6669           Magnifi
+0000b470: 6361 7469 6f6e 2066 6163 746f 7220 666f  cation factor fo
+0000b480: 7220 7468 6520 7265 6665 7265 6e63 652e  r the reference.
+0000b490: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
+0000b4a0: 6566 6c65 6374 696f 6e20 3a20 626f 6f6c  eflection : bool
+0000b4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b4c0: 2049 6620 5472 7565 2c20 7468 6520 7265   If True, the re
+0000b4d0: 6665 7265 6e63 6520 6973 2072 6566 6c65  ference is refle
+0000b4e0: 6374 6564 2070 6172 616c 6c65 6c20 746f  cted parallel to
+0000b4f0: 2074 6865 2078 2064 6972 6563 7469 6f6e   the x direction
+0000b500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b510: 2062 6566 6f72 6520 6265 696e 6720 726f   before being ro
+0000b520: 7461 7465 642e 0a20 2020 2020 2020 2020  tated..         
+0000b530: 2020 206e 616d 6520 3a20 7374 7220 286f     name : str (o
+0000b540: 7074 696f 6e61 6c29 0a20 2020 2020 2020  ptional).       
+0000b550: 2020 2020 2020 2020 2041 206e 616d 6520           A name 
+0000b560: 666f 7220 7468 6520 7265 6665 7265 6e63  for the referenc
+0000b570: 6520 2869 6620 7072 6f76 6964 6564 292e  e (if provided).
+0000b580: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000b590: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0000b5a0: 6e73 7461 6e63 6528 636f 6d70 6f6e 656e  nstance(componen
+0000b5b0: 742c 2043 6f6d 706f 6e65 6e74 293a 0a20  t, Component):. 
+0000b5c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000b5d0: 2054 7970 6545 7272 6f72 2866 2274 7970   TypeError(f"typ
+0000b5e0: 6520 3d20 7b74 7970 6528 436f 6d70 6f6e  e = {type(Compon
+0000b5f0: 656e 7429 7d20 6e65 6564 7320 746f 2062  ent)} needs to b
+0000b600: 6520 6120 436f 6d70 6f6e 656e 742e 2229  e a Component.")
+0000b610: 0a20 2020 2020 2020 2072 6566 203d 2043  .        ref = C
+0000b620: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+0000b630: 6528 636f 6d70 6f6e 656e 742c 202a 2a6b  e(component, **k
+0000b640: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+0000b650: 656c 662e 5f61 6464 2872 6566 290a 2020  elf._add(ref).  
+0000b660: 2020 2020 2020 7365 6c66 2e5f 7265 6769        self._regi
+0000b670: 7374 6572 5f72 6566 6572 656e 6365 2872  ster_reference(r
+0000b680: 6566 6572 656e 6365 3d72 6566 2c20 616c  eference=ref, al
+0000b690: 6961 733d 616c 6961 7329 0a20 2020 2020  ias=alias).     
+0000b6a0: 2020 2072 6574 7572 6e20 7265 660a 0a20     return ref.. 
+0000b6b0: 2020 2064 6566 205f 7265 6769 7374 6572     def _register
+0000b6c0: 5f72 6566 6572 656e 6365 280a 2020 2020  _reference(.    
+0000b6d0: 2020 2020 7365 6c66 2c20 7265 6665 7265      self, refere
+0000b6e0: 6e63 653a 2043 6f6d 706f 6e65 6e74 5265  nce: ComponentRe
+0000b6f0: 6665 7265 6e63 652c 2061 6c69 6173 3a20  ference, alias: 
+0000b700: 7374 7220 7c20 4e6f 6e65 203d 204e 6f6e  str | None = Non
+0000b710: 650a 2020 2020 2920 2d3e 204e 6f6e 653a  e.    ) -> None:
+0000b720: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+0000b730: 6e74 203d 2072 6566 6572 656e 6365 2e70  nt = reference.p
+0000b740: 6172 656e 740a 2020 2020 2020 2020 7265  arent.        re
+0000b750: 6665 7265 6e63 652e 6f77 6e65 7220 3d20  ference.owner = 
+0000b760: 7365 6c66 0a0a 2020 2020 2020 2020 6966  self..        if
+0000b770: 2061 6c69 6173 2069 7320 4e6f 6e65 3a0a   alias is None:.
+0000b780: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0000b790: 6566 6572 656e 6365 2e6e 616d 6520 6973  eference.name is
+0000b7a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000b7b0: 2020 2020 2020 2020 2020 2061 6c69 6173             alias
+0000b7c0: 203d 2072 6566 6572 656e 6365 2e6e 616d   = reference.nam
+0000b7d0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+0000b7e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000b7f0: 2020 2020 7072 6566 6978 203d 2028 0a20      prefix = (. 
+0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b810: 2020 2063 6f6d 706f 6e65 6e74 2e73 6574     component.set
+0000b820: 7469 6e67 732e 6675 6e63 7469 6f6e 5f6e  tings.function_n
+0000b830: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0000b840: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+0000b850: 7472 2863 6f6d 706f 6e65 6e74 2c20 2273  tr(component, "s
+0000b860: 6574 7469 6e67 7322 290a 2020 2020 2020  ettings").      
+0000b870: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0000b880: 6420 6861 7361 7474 7228 636f 6d70 6f6e  d hasattr(compon
+0000b890: 656e 742e 7365 7474 696e 6773 2c20 2266  ent.settings, "f
+0000b8a0: 756e 6374 696f 6e5f 6e61 6d65 2229 0a20  unction_name"). 
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2020 2065 6c73 6520 636f 6d70 6f6e 656e     else componen
+0000b8d0: 742e 6e61 6d65 0a20 2020 2020 2020 2020  t.name.         
+0000b8e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000b8f0: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
+0000b900: 6566 6572 656e 6365 5f6e 616d 6573 5f63  eference_names_c
+0000b910: 6f75 6e74 6572 2e75 7064 6174 6528 7b70  ounter.update({p
+0000b920: 7265 6669 783a 2031 7d29 0a20 2020 2020  refix: 1}).     
+0000b930: 2020 2020 2020 2020 2020 2061 6c69 6173             alias
+0000b940: 203d 2066 227b 7072 6566 6978 7d5f 7b73   = f"{prefix}_{s
+0000b950: 656c 662e 5f72 6566 6572 656e 6365 5f6e  elf._reference_n
+0000b960: 616d 6573 5f63 6f75 6e74 6572 5b70 7265  ames_counter[pre
+0000b970: 6669 785d 7d22 0a0a 2020 2020 2020 2020  fix]}"..        
+0000b980: 2020 2020 2020 2020 7768 696c 6520 616c          while al
+0000b990: 6961 7320 696e 2073 656c 662e 5f6e 616d  ias in self._nam
+0000b9a0: 6564 5f72 6566 6572 656e 6365 733a 0a20  ed_references:. 
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9c0: 2020 2073 656c 662e 5f72 6566 6572 656e     self._referen
+0000b9d0: 6365 5f6e 616d 6573 5f63 6f75 6e74 6572  ce_names_counter
+0000b9e0: 2e75 7064 6174 6528 7b70 7265 6669 783a  .update({prefix:
+0000b9f0: 2031 7d29 0a20 2020 2020 2020 2020 2020   1}).           
+0000ba00: 2020 2020 2020 2020 2061 6c69 6173 203d           alias =
+0000ba10: 2066 227b 7072 6566 6978 7d5f 7b73 656c   f"{prefix}_{sel
+0000ba20: 662e 5f72 6566 6572 656e 6365 5f6e 616d  f._reference_nam
+0000ba30: 6573 5f63 6f75 6e74 6572 5b70 7265 6669  es_counter[prefi
+0000ba40: 785d 7d22 0a0a 2020 2020 2020 2020 7265  x]}"..        re
+0000ba50: 6665 7265 6e63 652e 6e61 6d65 203d 2061  ference.name = a
+0000ba60: 6c69 6173 0a20 2020 2020 2020 2073 656c  lias.        sel
+0000ba70: 662e 5f6e 616d 6564 5f72 6566 6572 656e  f._named_referen
+0000ba80: 6365 735b 616c 6961 735d 203d 2072 6566  ces[alias] = ref
+0000ba90: 6572 656e 6365 0a0a 2020 2020 4070 726f  erence..    @pro
+0000baa0: 7065 7274 790a 2020 2020 6465 6620 6c61  perty.    def la
+0000bab0: 7965 7273 2873 656c 6629 202d 3e20 7365  yers(self) -> se
+0000bac0: 745b 7475 706c 655b 696e 742c 2069 6e74  t[tuple[int, int
+0000bad0: 5d5d 3a0a 2020 2020 2020 2020 2222 2252  ]]:.        """R
+0000bae0: 6574 7572 6e73 2061 2073 6574 206f 6620  eturns a set of 
+0000baf0: 7468 6520 4c61 7965 7273 2069 6e20 7468  the Layers in th
+0000bb00: 6520 436f 6d70 6f6e 656e 742e 2222 220a  e Component.""".
+0000bb10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000bb20: 656c 662e 6765 745f 6c61 7965 7273 2829  elf.get_layers()
+0000bb30: 0a0a 2020 2020 6465 6620 6765 745f 6c61  ..    def get_la
+0000bb40: 7965 7273 2873 656c 6629 202d 3e20 7365  yers(self) -> se
+0000bb50: 745b 7475 706c 655b 696e 742c 2069 6e74  t[tuple[int, int
+0000bb60: 5d5d 3a0a 2020 2020 2020 2020 2222 2252  ]]:.        """R
+0000bb70: 6574 7572 6e20 6120 7365 7420 6f66 2028  eturn a set of (
+0000bb80: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+0000bb90: 2e0a 0a20 2020 2020 2020 202e 2e20 636f  ...        .. co
+0000bba0: 6465 203a 3a0a 0a20 2020 2020 2020 2020  de ::..         
+0000bbb0: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+0000bbc0: 746f 7279 2061 7320 6766 0a20 2020 2020  tory as gf.     
+0000bbd0: 2020 2020 2020 2067 662e 636f 6d70 6f6e         gf.compon
+0000bbe0: 656e 7473 2e73 7472 6169 6768 7428 292e  ents.straight().
+0000bbf0: 6765 745f 6c61 7965 7273 2829 203d 3d20  get_layers() == 
+0000bc00: 7b28 312c 2030 292c 2028 3131 312c 2030  {(1, 0), (111, 0
+0000bc10: 297d 0a20 2020 2020 2020 2022 2222 0a20  )}.        """. 
+0000bc20: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
+0000bc30: 3d20 7365 6c66 2e5f 6365 6c6c 2e67 6574  = self._cell.get
+0000bc40: 5f70 6f6c 7967 6f6e 7328 6465 7074 683d  _polygons(depth=
+0000bc50: 4e6f 6e65 290a 2020 2020 2020 2020 7265  None).        re
+0000bc60: 7475 726e 207b 2870 6f6c 7967 6f6e 2e6c  turn {(polygon.l
+0000bc70: 6179 6572 2c20 706f 6c79 676f 6e2e 6461  ayer, polygon.da
+0000bc80: 7461 7479 7065 2920 666f 7220 706f 6c79  tatype) for poly
+0000bc90: 676f 6e20 696e 2070 6f6c 7967 6f6e 737d  gon in polygons}
+0000bca0: 0a0a 2020 2020 6465 6620 6765 745f 6c61  ..    def get_la
+0000bcb0: 7965 725f 6e61 6d65 7328 7365 6c66 2920  yer_names(self) 
+0000bcc0: 2d3e 206c 6973 745b 7475 706c 655b 696e  -> list[tuple[in
+0000bcd0: 742c 2069 6e74 5d5d 3a0a 2020 2020 2020  t, int]]:.      
+0000bce0: 2020 2222 2252 6574 7572 6e20 6c61 7965    """Return laye
+0000bcf0: 7220 6e61 6d65 7320 7573 6564 2069 6e20  r names used in 
+0000bd00: 7468 6520 6465 7369 676e 2e0a 0a20 2020  the design...   
+0000bd10: 2020 2020 202e 2e20 636f 6465 203a 3a0a       .. code ::.
+0000bd20: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
+0000bd30: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
+0000bd40: 7320 6766 0a20 2020 2020 2020 2020 2020  s gf.           
+0000bd50: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+0000bd60: 7472 6169 6768 7428 292e 6765 745f 6e61  traight().get_na
+0000bd70: 6d65 7328 2920 3d3d 205b 2757 4727 5d0a  mes() == ['WG'].
+0000bd80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000bd90: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+0000bda0: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
+0000bdb0: 2020 2020 2050 444b 203d 2067 662e 6765       PDK = gf.ge
+0000bdc0: 745f 6163 7469 7665 5f70 646b 2829 0a20  t_active_pdk(). 
+0000bdd0: 2020 2020 2020 204c 4159 4552 5320 3d20         LAYERS = 
+0000bde0: 5044 4b2e 6c61 7965 7273 0a20 2020 2020  PDK.layers.     
+0000bdf0: 2020 206e 616d 655f 746f 5f6c 6179 6572     name_to_layer
+0000be00: 203d 2064 6963 7428 4c41 5945 5253 290a   = dict(LAYERS).
+0000be10: 2020 2020 2020 2020 6c61 7965 725f 746f          layer_to
+0000be20: 5f6e 616d 6520 3d20 7b76 3a20 6b20 666f  _name = {v: k fo
+0000be30: 7220 6b2c 2076 2069 6e20 6e61 6d65 5f74  r k, v in name_t
+0000be40: 6f5f 6c61 7965 722e 6974 656d 7328 297d  o_layer.items()}
+0000be50: 0a20 2020 2020 2020 206c 6179 6572 5f6e  .        layer_n
+0000be60: 616d 6573 203d 205b 5d0a 0a20 2020 2020  ames = []..     
+0000be70: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
+0000be80: 7365 6c66 2e6c 6179 6572 733a 0a20 2020  self.layers:.   
+0000be90: 2020 2020 2020 2020 2069 6620 6c61 7965           if laye
+0000bea0: 7220 6e6f 7420 696e 206c 6179 6572 5f74  r not in layer_t
+0000beb0: 6f5f 6e61 6d65 3a0a 2020 2020 2020 2020  o_name:.        
+0000bec0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+0000bed0: 2e77 6172 6e28 6622 7b6c 6179 6572 7d20  .warn(f"{layer} 
+0000bee0: 6e6f 7420 696e 204c 6179 6572 4d61 702e  not in LayerMap.
+0000bef0: 222c 2073 7461 636b 6c65 7665 6c3d 3329  ", stacklevel=3)
+0000bf00: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000bf10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000bf20: 2020 206c 6179 6572 5f6e 616d 6573 2e61     layer_names.a
+0000bf30: 7070 656e 6428 6c61 7965 725f 746f 5f6e  ppend(layer_to_n
+0000bf40: 616d 655b 6c61 7965 725d 290a 2020 2020  ame[layer]).    
+0000bf50: 2020 2020 7265 7475 726e 206c 6179 6572      return layer
+0000bf60: 5f6e 616d 6573 0a0a 2020 2020 6465 6620  _names..    def 
+0000bf70: 5f69 7079 7468 6f6e 5f64 6973 706c 6179  _ipython_display
+0000bf80: 5f28 7365 6c66 2920 2d3e 204e 6f6e 653a  _(self) -> None:
+0000bf90: 0a20 2020 2020 2020 2022 2222 5368 6f77  .        """Show
+0000bfa0: 2067 656f 6d65 7472 7920 696e 204b 4c61   geometry in KLa
+0000bfb0: 796f 7574 2061 6e64 2069 6e20 6d61 7470  yout and in matp
+0000bfc0: 6c6f 746c 6962 2066 6f72 204a 7570 7974  lotlib for Jupyt
+0000bfd0: 6572 204e 6f74 6562 6f6f 6b73 2e22 2222  er Notebooks."""
+0000bfe0: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+0000bff0: 6f77 2873 686f 775f 706f 7274 733d 5472  ow(show_ports=Tr
+0000c000: 7565 2920 2023 2073 686f 7720 696e 206b  ue)  # show in k
+0000c010: 6c61 796f 7574 0a20 2020 2020 2020 2072  layout.        r
+0000c020: 6574 7572 6e20 7365 6c66 2e70 6c6f 7428  eturn self.plot(
+0000c030: 290a 0a20 2020 2064 6566 2061 6464 5f70  )..    def add_p
+0000c040: 696e 735f 7472 6961 6e67 6c65 280a 2020  ins_triangle(.  
+0000c050: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000c060: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
+0000c070: 6c61 7965 723a 204c 6179 6572 203d 2028  layer: Layer = (
+0000c080: 312c 2031 3029 2c0a 2020 2020 2020 2020  1, 10),.        
+0000c090: 6c61 7965 725f 6c61 6265 6c3a 204c 6179  layer_label: Lay
+0000c0a0: 6572 203d 2028 312c 2031 3029 2c0a 2020  er = (1, 10),.  
+0000c0b0: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
+0000c0c0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000c0d0: 7572 6e73 2063 6f6d 706f 6e65 6e74 2077  urns component w
+0000c0e0: 6974 6820 7472 6961 6e67 756c 6172 2070  ith triangular p
+0000c0f0: 696e 732e 2222 220a 2020 2020 2020 2020  ins.""".        
+0000c100: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000c110: 6164 645f 7069 6e73 2069 6d70 6f72 7420  add_pins import 
+0000c120: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
+0000c130: 650a 0a20 2020 2020 2020 2063 6f6d 706f  e..        compo
+0000c140: 6e65 6e74 203d 2073 656c 662e 636f 7079  nent = self.copy
+0000c150: 2829 0a20 2020 2020 2020 2063 6f6d 706f  ().        compo
+0000c160: 6e65 6e74 2e6e 616d 6520 3d20 7365 6c66  nent.name = self
+0000c170: 2e6e 616d 650a 2020 2020 2020 2020 6164  .name.        ad
+0000c180: 645f 7069 6e73 5f74 7269 616e 676c 6528  d_pins_triangle(
+0000c190: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+0000c1a0: 706f 6e65 6e74 3d63 6f6d 706f 6e65 6e74  ponent=component
+0000c1b0: 2c20 6c61 7965 723d 706f 7274 5f6d 6172  , layer=port_mar
+0000c1c0: 6b65 725f 6c61 7965 722c 206c 6179 6572  ker_layer, layer
+0000c1d0: 5f6c 6162 656c 3d6c 6179 6572 5f6c 6162  _label=layer_lab
+0000c1e0: 656c 0a20 2020 2020 2020 2029 0a20 2020  el.        ).   
+0000c1f0: 2020 2020 2072 6574 7572 6e20 636f 6d70       return comp
+0000c200: 6f6e 656e 740a 0a20 2020 2064 6566 2070  onent..    def p
+0000c210: 6c6f 745f 7769 6467 6574 280a 2020 2020  lot_widget(.    
+0000c220: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000c230: 2020 7368 6f77 5f70 6f72 7473 3a20 626f    show_ports: bo
+0000c240: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+0000c250: 2020 2070 6f72 745f 6d61 726b 6572 5f6c     port_marker_l
+0000c260: 6179 6572 3a20 4c61 7965 7220 3d20 2831  ayer: Layer = (1
+0000c270: 2c20 3130 292c 0a20 2020 2029 202d 3e20  , 10),.    ) -> 
+0000c280: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000c290: 2252 6574 7572 6e73 2069 7079 7468 6f6e  "Returns ipython
+0000c2a0: 2077 6964 6765 7420 666f 7220 6b6c 6179   widget for klay
+0000c2b0: 6f75 7420 7669 7375 616c 697a 6174 696f  out visualizatio
+0000c2c0: 6e2e 0a0a 2020 2020 2020 2020 4172 6773  n...        Args
+0000c2d0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
+0000c2e0: 6f77 5f70 6f72 7473 3a20 7368 6f77 7320  ow_ports: shows 
+0000c2f0: 636f 6d70 6f6e 656e 7420 7769 7468 2070  component with p
+0000c300: 6f72 7420 6d61 726b 6572 7320 616e 6420  ort markers and 
+0000c310: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
+0000c320: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
+0000c330: 6c61 7965 723a 2066 6f72 2074 6865 2070  layer: for the p
+0000c340: 6f72 7473 2e0a 2020 2020 2020 2020 2222  orts..        ""
+0000c350: 220a 2020 2020 2020 2020 6672 6f6d 2049  ".        from I
+0000c360: 5079 7468 6f6e 2e64 6973 706c 6179 2069  Python.display i
+0000c370: 6d70 6f72 7420 6469 7370 6c61 790a 0a20  mport display.. 
+0000c380: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+0000c390: 6163 746f 7279 2e70 646b 2069 6d70 6f72  actory.pdk impor
+0000c3a0: 7420 6765 745f 6c61 7965 725f 7669 6577  t get_layer_view
+0000c3b0: 730a 0a20 2020 2020 2020 2074 7279 3a0a  s..        try:.
+0000c3c0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0000c3d0: 7274 206b 6661 6374 6f72 7920 6173 206b  rt kfactory as k
+0000c3e0: 660a 2020 2020 2020 2020 2020 2020 6672  f.            fr
+0000c3f0: 6f6d 2067 706c 7567 696e 732e 7769 6467  om gplugins.widg
+0000c400: 6574 2e69 6e74 6572 6163 7469 7665 2069  et.interactive i
+0000c410: 6d70 6f72 7420 4c61 796f 7574 5769 6467  mport LayoutWidg
+0000c420: 6574 0a20 2020 2020 2020 2065 7863 6570  et.        excep
+0000c430: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
+0000c440: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000c450: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000c460: 2020 2259 6f75 206e 6565 6420 696e 7374    "You need inst
+0000c470: 616c 6c20 6b66 6163 746f 7279 2070 6c75  all kfactory plu
+0000c480: 6769 6e20 7769 7468 2060 7069 7020 696e  gin with `pip in
+0000c490: 7374 616c 6c20 6764 7366 6163 746f 7279  stall gdsfactory
+0000c4a0: 5b6b 6661 6374 6f72 795d 6022 0a20 2020  [kfactory]`".   
+0000c4b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c4c0: 2020 2020 2020 2073 656c 662e 706c 6f74         self.plot
+0000c4d0: 5f6b 6c61 796f 7574 2829 0a20 2020 2020  _klayout().     
+0000c4e0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+0000c4f0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000c500: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0000c510: 2073 656c 662e 6164 645f 7069 6e73 5f74   self.add_pins_t
+0000c520: 7269 616e 676c 6528 706f 7274 5f6d 6172  riangle(port_mar
+0000c530: 6b65 725f 6c61 7965 723d 706f 7274 5f6d  ker_layer=port_m
+0000c540: 6172 6b65 725f 6c61 7965 7229 0a20 2020  arker_layer).   
+0000c550: 2020 2020 2020 2020 2069 6620 7368 6f77           if show
+0000c560: 5f70 6f72 7473 0a20 2020 2020 2020 2020  _ports.         
+0000c570: 2020 2065 6c73 6520 7365 6c66 0a20 2020     else self.   
+0000c580: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000c590: 6764 7370 6174 6820 3d20 636f 6d70 6f6e  gdspath = compon
+0000c5a0: 656e 742e 7772 6974 655f 6764 7328 6c6f  ent.write_gds(lo
+0000c5b0: 6767 696e 673d 4661 6c73 6529 0a20 2020  gging=False).   
+0000c5c0: 2020 2020 206c 7970 5f70 6174 6820 3d20       lyp_path = 
+0000c5d0: 6764 7370 6174 682e 7769 7468 5f73 7566  gdspath.with_suf
+0000c5e0: 6669 7828 222e 6c79 7022 290a 0a20 2020  fix(".lyp")..   
+0000c5f0: 2020 2020 206b 636c 203d 206b 662e 4b43       kcl = kf.KC
+0000c600: 4c61 796f 7574 2829 0a20 2020 2020 2020  Layout().       
+0000c610: 206b 636c 2e72 6561 6428 6764 7370 6174   kcl.read(gdspat
+0000c620: 6829 0a20 2020 2020 2020 2074 6f70 5f63  h).        top_c
+0000c630: 656c 6c20 3d20 6b63 6c2e 746f 705f 6365  ell = kcl.top_ce
+0000c640: 6c6c 2829 0a20 2020 2020 2020 2063 203d  ll().        c =
+0000c650: 206b 636c 2e64 7570 2829 5b74 6f70 5f63   kcl.dup()[top_c
+0000c660: 656c 6c2e 6e61 6d65 5d0a 2020 2020 2020  ell.name].      
+0000c670: 2020 2320 6320 3d20 6b66 2e4b 4365 6c6c    # c = kf.KCell
+0000c680: 2874 6f70 5f63 656c 6c2e 6e61 6d65 2c20  (top_cell.name, 
+0000c690: 616c 6c29 0a20 2020 2020 2020 2023 2063  all).        # c
+0000c6a0: 2e63 6f70 795f 7472 6565 2874 6f70 5f63  .copy_tree(top_c
+0000c6b0: 656c 6c29 0a0a 2020 2020 2020 2020 6c61  ell)..        la
+0000c6c0: 7965 725f 7669 6577 7320 3d20 6765 745f  yer_views = get_
+0000c6d0: 6c61 7965 725f 7669 6577 7328 290a 2020  layer_views().  
+0000c6e0: 2020 2020 2020 6c61 7965 725f 7669 6577        layer_view
+0000c6f0: 732e 746f 5f6c 7970 2866 696c 6570 6174  s.to_lyp(filepat
+0000c700: 683d 6c79 705f 7061 7468 290a 0a20 2020  h=lyp_path)..   
+0000c710: 2020 2020 206c 7720 3d20 4c61 796f 7574       lw = Layout
+0000c720: 5769 6467 6574 2863 656c 6c3d 632c 206c  Widget(cell=c, l
+0000c730: 6179 6572 5f70 726f 7065 7274 6965 733d  ayer_properties=
+0000c740: 6c79 705f 7061 7468 290a 2020 2020 2020  lyp_path).      
+0000c750: 2020 6469 7370 6c61 7928 6c77 2e77 6964    display(lw.wid
+0000c760: 6765 7429 0a0a 2020 2020 6465 6620 706c  get)..    def pl
+0000c770: 6f74 5f6b 6c61 796f 7574 280a 2020 2020  ot_klayout(.    
+0000c780: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000c790: 2020 7368 6f77 5f70 6f72 7473 3a20 626f    show_ports: bo
+0000c7a0: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+0000c7b0: 2020 2070 6f72 745f 6d61 726b 6572 5f6c     port_marker_l
+0000c7c0: 6179 6572 3a20 4c61 7965 7220 3d20 2831  ayer: Layer = (1
+0000c7d0: 2c20 3130 292c 0a20 2020 2020 2020 2073  , 10),.        s
+0000c7e0: 686f 775f 6c61 6265 6c73 3a20 626f 6f6c  how_labels: bool
+0000c7f0: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+0000c800: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000c810: 2022 2222 5265 7475 726e 7320 6b6c 6179   """Returns klay
+0000c820: 6f75 7420 696d 6167 652e 0a0a 2020 2020  out image...    
+0000c830: 2020 2020 4966 2069 7420 6661 696c 7320      If it fails 
+0000c840: 746f 2069 6d70 6f72 7420 6b6c 6179 6f75  to import klayou
+0000c850: 7420 6465 6661 756c 7473 2074 6f20 6d61  t defaults to ma
+0000c860: 7470 6c6f 746c 6962 2e0a 0a20 2020 2020  tplotlib...     
+0000c870: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000c880: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
+0000c890: 2073 686f 7773 2063 6f6d 706f 6e65 6e74   shows component
+0000c8a0: 2077 6974 6820 706f 7274 206d 6172 6b65   with port marke
+0000c8b0: 7273 2061 6e64 206c 6162 656c 732e 0a20  rs and labels.. 
+0000c8c0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+0000c8d0: 6d61 726b 6572 5f6c 6179 6572 3a20 666f  marker_layer: fo
+0000c8e0: 7220 7468 6520 706f 7274 732e 0a20 2020  r the ports..   
+0000c8f0: 2020 2020 2020 2020 2073 686f 775f 6c61           show_la
+0000c900: 6265 6c73 3a20 7368 6f77 7320 6c61 6265  bels: shows labe
+0000c910: 6c73 2e0a 2020 2020 2020 2020 2222 220a  ls..        """.
+0000c920: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+0000c930: 6e74 203d 2028 0a20 2020 2020 2020 2020  nt = (.         
+0000c940: 2020 2073 656c 662e 6164 645f 7069 6e73     self.add_pins
+0000c950: 5f74 7269 616e 676c 6528 706f 7274 5f6d  _triangle(port_m
+0000c960: 6172 6b65 725f 6c61 7965 723d 706f 7274  arker_layer=port
+0000c970: 5f6d 6172 6b65 725f 6c61 7965 7229 0a20  _marker_layer). 
+0000c980: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
+0000c990: 6f77 5f70 6f72 7473 0a20 2020 2020 2020  ow_ports.       
+0000c9a0: 2020 2020 2065 6c73 6520 7365 6c66 0a20       else self. 
+0000c9b0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000c9c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000c9d0: 2020 2066 726f 6d20 696f 2069 6d70 6f72     from io impor
+0000c9e0: 7420 4279 7465 7349 4f0a 0a20 2020 2020  t BytesIO..     
+0000c9f0: 2020 2020 2020 2069 6d70 6f72 7420 6b6c         import kl
+0000ca00: 6179 6f75 742e 6462 2061 7320 6462 2020  ayout.db as db  
+0000ca10: 2320 6e6f 7161 3a20 4634 3031 0a20 2020  # noqa: F401.   
+0000ca20: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0000ca30: 6b6c 6179 6f75 742e 6c61 7920 6173 206c  klayout.lay as l
+0000ca40: 6179 0a20 2020 2020 2020 2020 2020 2069  ay.            i
+0000ca50: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
+0000ca60: 2e70 7970 6c6f 7420 6173 2070 6c74 0a0a  .pyplot as plt..
+0000ca70: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+0000ca80: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
+0000ca90: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+0000caa0: 5f76 6965 7773 0a0a 2020 2020 2020 2020  _views..        
+0000cab0: 2020 2020 6764 7370 6174 6820 3d20 636f      gdspath = co
+0000cac0: 6d70 6f6e 656e 742e 7772 6974 655f 6764  mponent.write_gd
+0000cad0: 7328 6c6f 6767 696e 673d 4661 6c73 6529  s(logging=False)
+0000cae0: 0a20 2020 2020 2020 2020 2020 206c 7970  .            lyp
+0000caf0: 5f70 6174 6820 3d20 6764 7370 6174 682e  _path = gdspath.
+0000cb00: 7769 7468 5f73 7566 6669 7828 222e 6c79  with_suffix(".ly
+0000cb10: 7022 290a 0a20 2020 2020 2020 2020 2020  p")..           
+0000cb20: 206c 6179 6572 5f76 6965 7773 203d 2067   layer_views = g
+0000cb30: 6574 5f6c 6179 6572 5f76 6965 7773 2829  et_layer_views()
+0000cb40: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0000cb50: 6572 5f76 6965 7773 2e74 6f5f 6c79 7028  er_views.to_lyp(
+0000cb60: 6669 6c65 7061 7468 3d6c 7970 5f70 6174  filepath=lyp_pat
+0000cb70: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
+0000cb80: 6c61 796f 7574 5f76 6965 7720 3d20 6c61  layout_view = la
+0000cb90: 792e 4c61 796f 7574 5669 6577 2829 0a20  y.LayoutView(). 
+0000cba0: 2020 2020 2020 2020 2020 206c 6179 6f75             layou
+0000cbb0: 745f 7669 6577 2e6c 6f61 645f 6c61 796f  t_view.load_layo
+0000cbc0: 7574 2873 7472 2867 6473 7061 7468 2e61  ut(str(gdspath.a
+0000cbd0: 6273 6f6c 7574 6528 2929 290a 2020 2020  bsolute())).    
+0000cbe0: 2020 2020 2020 2020 6c61 796f 7574 5f76          layout_v
+0000cbf0: 6965 772e 6d61 785f 6869 6572 2829 0a20  iew.max_hier(). 
+0000cc00: 2020 2020 2020 2020 2020 206c 6179 6f75             layou
+0000cc10: 745f 7669 6577 2e6c 6f61 645f 6c61 7965  t_view.load_laye
+0000cc20: 725f 7072 6f70 7328 7374 7228 6c79 705f  r_props(str(lyp_
+0000cc30: 7061 7468 2929 0a0a 2020 2020 2020 2020  path))..        
+0000cc40: 2020 2020 6c61 796f 7574 5f76 6965 772e      layout_view.
+0000cc50: 7365 745f 636f 6e66 6967 2822 7465 7874  set_config("text
+0000cc60: 2d76 6973 6962 6c65 222c 2022 7472 7565  -visible", "true
+0000cc70: 2220 6966 2073 686f 775f 6c61 6265 6c73  " if show_labels
+0000cc80: 2065 6c73 6520 2266 616c 7365 2229 0a0a   else "false")..
+0000cc90: 2020 2020 2020 2020 2020 2020 7069 7865              pixe
+0000cca0: 6c5f 6275 6666 6572 203d 206c 6179 6f75  l_buffer = layou
+0000ccb0: 745f 7669 6577 2e67 6574 5f70 6978 656c  t_view.get_pixel
+0000ccc0: 735f 7769 7468 5f6f 7074 696f 6e73 2838  s_with_options(8
+0000ccd0: 3030 2c20 3630 3029 0a20 2020 2020 2020  00, 600).       
+0000cce0: 2020 2020 2070 6e67 5f64 6174 6120 3d20       png_data = 
+0000ccf0: 7069 7865 6c5f 6275 6666 6572 2e74 6f5f  pixel_buffer.to_
+0000cd00: 706e 675f 6461 7461 2829 0a0a 2020 2020  png_data()..    
+0000cd10: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
+0000cd20: 7420 504e 4720 6461 7461 2074 6f20 4e75  t PNG data to Nu
+0000cd30: 6d50 7920 6172 7261 7920 616e 6420 6469  mPy array and di
+0000cd40: 7370 6c61 7920 7769 7468 206d 6174 706c  splay with matpl
+0000cd50: 6f74 6c69 620a 2020 2020 2020 2020 2020  otlib.          
+0000cd60: 2020 7769 7468 2042 7974 6573 494f 2870    with BytesIO(p
+0000cd70: 6e67 5f64 6174 6129 2061 7320 663a 0a20  ng_data) as f:. 
+0000cd80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cd90: 6d67 5f61 7272 6179 203d 2070 6c74 2e69  mg_array = plt.i
+0000cda0: 6d72 6561 6428 6629 0a0a 2020 2020 2020  mread(f)..      
+0000cdb0: 2020 2020 2020 2320 436f 6d70 7574 6520        # Compute 
+0000cdc0: 7468 6520 6669 6775 7265 2064 696d 656e  the figure dimen
+0000cdd0: 7369 6f6e 7320 6261 7365 6420 6f6e 2074  sions based on t
+0000cde0: 6865 2069 6d61 6765 2073 697a 6520 616e  he image size an
+0000cdf0: 6420 6465 7369 7265 6420 4450 490a 2020  d desired DPI.  
+0000ce00: 2020 2020 2020 2020 2020 6470 6920 3d20            dpi = 
+0000ce10: 3830 0a20 2020 2020 2020 2020 2020 2066  80.            f
+0000ce20: 6967 5f77 6964 7468 203d 2069 6d67 5f61  ig_width = img_a
+0000ce30: 7272 6179 2e73 6861 7065 5b31 5d20 2f20  rray.shape[1] / 
+0000ce40: 6470 690a 2020 2020 2020 2020 2020 2020  dpi.            
+0000ce50: 6669 675f 6865 6967 6874 203d 2069 6d67  fig_height = img
+0000ce60: 5f61 7272 6179 2e73 6861 7065 5b30 5d20  _array.shape[0] 
+0000ce70: 2f20 6470 690a 0a20 2020 2020 2020 2020  / dpi..         
+0000ce80: 2020 2066 6967 2c20 6178 203d 2070 6c74     fig, ax = plt
+0000ce90: 2e73 7562 706c 6f74 7328 6669 6773 697a  .subplots(figsiz
+0000cea0: 653d 2866 6967 5f77 6964 7468 2c20 6669  e=(fig_width, fi
+0000ceb0: 675f 6865 6967 6874 292c 2064 7069 3d64  g_height), dpi=d
+0000cec0: 7069 290a 0a20 2020 2020 2020 2020 2020  pi)..           
+0000ced0: 2023 2052 656d 6f76 6520 6d61 7267 696e   # Remove margin
+0000cee0: 7320 616e 6420 6469 7370 6c61 7920 7468  s and display th
+0000cef0: 6520 696d 6167 650a 2020 2020 2020 2020  e image.        
+0000cf00: 2020 2020 6178 2e69 6d73 686f 7728 696d      ax.imshow(im
+0000cf10: 675f 6172 7261 7929 0a20 2020 2020 2020  g_array).       
+0000cf20: 2020 2020 2061 782e 6178 6973 2822 6f66       ax.axis("of
+0000cf30: 6622 2920 2023 2048 6964 6520 6178 6573  f")  # Hide axes
+0000cf40: 0a20 2020 2020 2020 2020 2020 2061 782e  .            ax.
+0000cf50: 7365 745f 706f 7369 7469 6f6e 285b 302c  set_position([0,
+0000cf60: 2030 2c20 312c 2031 5d29 2020 2320 5365   0, 1, 1])  # Se
+0000cf70: 7420 6178 6573 2074 6f20 6f63 6375 7079  t axes to occupy
+0000cf80: 2074 6865 2066 756c 6c20 6669 6775 7265   the full figure
+0000cf90: 2073 7061 6365 0a0a 2020 2020 2020 2020   space..        
+0000cfa0: 2020 2020 706c 742e 7375 6270 6c6f 7473      plt.subplots
+0000cfb0: 5f61 646a 7573 7428 0a20 2020 2020 2020  _adjust(.       
+0000cfc0: 2020 2020 2020 2020 206c 6566 743d 302c           left=0,
+0000cfd0: 2072 6967 6874 3d31 2c20 746f 703d 312c   right=1, top=1,
+0000cfe0: 2062 6f74 746f 6d3d 302c 2077 7370 6163   bottom=0, wspac
+0000cff0: 653d 302c 2068 7370 6163 653d 300a 2020  e=0, hspace=0.  
+0000d000: 2020 2020 2020 2020 2020 2920 2023 2052            )  # R
+0000d010: 656d 6f76 6520 616e 7920 7061 6464 696e  emove any paddin
+0000d020: 670a 2020 2020 2020 2020 2020 2020 706c  g.            pl
+0000d030: 742e 7469 6768 745f 6c61 796f 7574 2870  t.tight_layout(p
+0000d040: 6164 3d30 2920 2023 2045 6e73 7572 6520  ad=0)  # Ensure 
+0000d050: 6e6f 2073 7061 6365 2069 7320 7761 7374  no space is wast
+0000d060: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
+0000d070: 6574 7572 6e20 6669 670a 0a20 2020 2020  eturn fig..     
+0000d080: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
+0000d090: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+0000d0a0: 2020 2070 7269 6e74 2822 596f 7520 6361     print("You ca
+0000d0b0: 6e20 696e 7374 616c 6c20 6070 6970 2069  n install `pip i
+0000d0c0: 6e73 7461 6c6c 2067 6473 6661 6374 6f72  nstall gdsfactor
+0000d0d0: 7960 2066 6f72 2062 6574 7465 7220 7669  y` for better vi
+0000d0e0: 7375 616c 697a 6174 696f 6e22 290a 2020  sualization").  
+0000d0f0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+0000d100: 656e 742e 706c 6f74 2870 6c6f 7474 6572  ent.plot(plotter
+0000d110: 3d22 6d61 7470 6c6f 746c 6962 2229 0a0a  ="matplotlib")..
+0000d120: 2020 2020 6465 6620 706c 6f74 5f6b 7765      def plot_kwe
+0000d130: 6228 7365 6c66 293a 0a20 2020 2020 2020  b(self):.       
+0000d140: 2022 2222 5368 6f77 7320 6375 7272 656e   """Shows curren
+0000d150: 7420 6764 7320 696e 206b 7765 622e 2222  t gds in kweb.""
+0000d160: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
+0000d170: 206f 730a 2020 2020 2020 2020 6672 6f6d   os.        from
+0000d180: 2068 746d 6c20 696d 706f 7274 2065 7363   html import esc
+0000d190: 6170 650a 0a20 2020 2020 2020 2069 6d70  ape..        imp
+0000d1a0: 6f72 7420 6b77 6562 2e73 6572 7665 725f  ort kweb.server_
+0000d1b0: 6a75 7079 7465 7220 6173 206b 6a0a 2020  jupyter as kj.  
+0000d1c0: 2020 2020 2020 6672 6f6d 2049 5079 7468        from IPyth
+0000d1d0: 6f6e 2e64 6973 706c 6179 2069 6d70 6f72  on.display impor
+0000d1e0: 7420 4946 7261 6d65 0a0a 2020 2020 2020  t IFrame..      
+0000d1f0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+0000d200: 792e 636f 6e66 6967 2069 6d70 6f72 7420  y.config import 
+0000d210: 5041 5448 0a20 2020 2020 2020 2066 726f  PATH.        fro
+0000d220: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
+0000d230: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
+0000d240: 725f 7669 6577 730a 0a20 2020 2020 2020  r_views..       
+0000d250: 2067 6473 7061 7468 203d 2073 656c 662e   gdspath = self.
+0000d260: 7772 6974 655f 6764 7328 6764 7364 6972  write_gds(gdsdir
+0000d270: 3d50 4154 482e 6764 736c 6962 202f 2022  =PATH.gdslib / "
+0000d280: 6578 7472 6122 2c20 6c6f 6767 696e 673d  extra", logging=
+0000d290: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+0000d2a0: 6469 7270 6174 6820 3d20 4744 5344 4952  dirpath = GDSDIR
+0000d2b0: 5f54 454d 500a 2020 2020 2020 2020 6469  _TEMP.        di
+0000d2c0: 7270 6174 682e 6d6b 6469 7228 6578 6973  rpath.mkdir(exis
+0000d2d0: 745f 6f6b 3d54 7275 652c 2070 6172 656e  t_ok=True, paren
+0000d2e0: 7473 3d54 7275 6529 0a20 2020 2020 2020  ts=True).       
+0000d2f0: 206c 7970 5f70 6174 6820 3d20 6469 7270   lyp_path = dirp
+0000d300: 6174 6820 2f20 226c 6179 6572 732e 6c79  ath / "layers.ly
+0000d310: 7022 0a0a 2020 2020 2020 2020 6c61 7965  p"..        laye
+0000d320: 725f 7072 6f70 7320 3d20 6765 745f 6c61  r_props = get_la
+0000d330: 7965 725f 7669 6577 7328 290a 2020 2020  yer_views().    
+0000d340: 2020 2020 6c61 7965 725f 7072 6f70 732e      layer_props.
+0000d350: 746f 5f6c 7970 2866 696c 6570 6174 683d  to_lyp(filepath=
+0000d360: 6c79 705f 7061 7468 290a 0a20 2020 2020  lyp_path)..     
+0000d370: 2020 2070 6f72 7420 3d20 6b6a 2e70 6f72     port = kj.por
+0000d380: 7420 6966 2068 6173 6174 7472 286b 6a2c  t if hasattr(kj,
+0000d390: 2022 706f 7274 2229 2061 6e64 206b 6a2e   "port") and kj.
+0000d3a0: 706f 7274 2065 6c73 6520 3830 3030 0a20  port else 8000. 
+0000d3b0: 2020 2020 2020 2073 7263 203d 2066 2268         src = f"h
+0000d3c0: 7474 703a 2f2f 3132 372e 302e 302e 313a  ttp://127.0.0.1:
+0000d3d0: 7b70 6f72 747d 2f67 6473 3f67 6473 5f66  {port}/gds?gds_f
+0000d3e0: 696c 653d 7b65 7363 6170 6528 7374 7228  ile={escape(str(
+0000d3f0: 6764 7370 6174 6829 297d 266c 6179 6572  gdspath))}&layer
+0000d400: 5f70 726f 7073 3d7b 6573 6361 7065 2873  _props={escape(s
+0000d410: 7472 286c 7970 5f70 6174 6829 297d 220a  tr(lyp_path))}".
+0000d420: 0a20 2020 2020 2020 206f 732e 656e 7669  .        os.envi
+0000d430: 726f 6e5b 224b 5745 425f 504f 5254 225d  ron["KWEB_PORT"]
+0000d440: 203d 2073 7472 286f 732e 6765 7465 6e76   = str(os.getenv
+0000d450: 2822 4b57 4542 5f50 4f52 5422 2c20 706f  ("KWEB_PORT", po
+0000d460: 7274 2929 0a0a 2020 2020 2020 2020 6966  rt))..        if
+0000d470: 206e 6f74 206b 6a2e 6a75 7079 7465 725f   not kj.jupyter_
+0000d480: 7365 7276 6572 3a0a 2020 2020 2020 2020  server:.        
+0000d490: 2020 2020 706f 7274 203d 2069 6e74 286f      port = int(o
+0000d4a0: 732e 6765 7465 6e76 2822 4b57 4542 5f50  s.getenv("KWEB_P
+0000d4b0: 4f52 5422 2929 0a20 2020 2020 2020 2020  ORT")).         
+0000d4c0: 2020 2077 6869 6c65 206b 6a2e 6973 5f70     while kj.is_p
+0000d4d0: 6f72 745f 696e 5f75 7365 2870 6f72 7429  ort_in_use(port)
+0000d4e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d4f0: 2020 706f 7274 202b 3d20 310a 0a20 2020    port += 1..   
+0000d500: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+0000d510: 726f 6e5b 224b 5745 425f 504f 5254 225d  ron["KWEB_PORT"]
+0000d520: 203d 2073 7472 2870 6f72 7429 0a20 2020   = str(port).   
+0000d530: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+0000d540: 6465 6275 6728 7372 6329 0a20 2020 2020  debug(src).     
+0000d550: 2020 2020 2020 206b 6a2e 7374 6172 7428         kj.start(
+0000d560: 290a 0a20 2020 2020 2020 2069 6620 6b6a  )..        if kj
+0000d570: 2e6a 7570 7974 6572 5f73 6572 7665 723a  .jupyter_server:
+0000d580: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000d590: 7572 6e20 4946 7261 6d65 280a 2020 2020  urn IFrame(.    
+0000d5a0: 2020 2020 2020 2020 2020 2020 7372 633d              src=
+0000d5b0: 7372 632c 0a20 2020 2020 2020 2020 2020  src,.           
+0000d5c0: 2020 2020 2077 6964 7468 3d31 3430 302c       width=1400,
+0000d5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d5e0: 2068 6569 6768 743d 3630 302c 0a20 2020   height=600,.   
+0000d5f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000d600: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000d610: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000d620: 2e70 6c6f 745f 6b6c 6179 6f75 7428 290a  .plot_klayout().
+0000d630: 0a20 2020 2064 6566 2070 6c6f 745f 6d61  .    def plot_ma
+0000d640: 7470 6c6f 746c 6962 2873 656c 662c 202a  tplotlib(self, *
+0000d650: 2a6b 7761 7267 7329 202d 3e20 4e6f 6e65  *kwargs) -> None
+0000d660: 3a0a 2020 2020 2020 2020 2222 2250 6c6f  :.        """Plo
+0000d670: 7420 636f 6d70 6f6e 656e 7420 7573 696e  t component usin
+0000d680: 6720 6d61 7470 6c6f 746c 6962 2e0a 0a20  g matplotlib... 
+0000d690: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
+0000d6a0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000d6b0: 2073 686f 775f 706f 7274 733a 2053 6574   show_ports: Set
+0000d6c0: 7320 7768 6574 6865 7220 706f 7274 7320  s whether ports 
+0000d6d0: 6172 6520 6472 6177 6e2e 0a20 2020 2020  are drawn..     
+0000d6e0: 2020 2020 2020 2073 686f 775f 7375 6270         show_subp
+0000d6f0: 6f72 7473 3a20 5365 7473 2077 6865 7468  orts: Sets wheth
+0000d700: 6572 2073 7562 706f 7274 7320 2870 6f72  er subports (por
+0000d710: 7473 2074 6861 7420 6265 6c6f 6e67 2074  ts that belong t
+0000d720: 6f20 7265 6665 7265 6e63 6573 2920 6172  o references) ar
+0000d730: 6520 6472 6177 6e2e 0a20 2020 2020 2020  e drawn..       
+0000d740: 2020 2020 206c 6162 656c 5f61 6c69 6173       label_alias
+0000d750: 6573 3a20 5365 7473 2077 6865 7468 6572  es: Sets whether
+0000d760: 2061 6c69 6173 6573 2061 7265 206c 6162   aliases are lab
+0000d770: 656c 6564 2077 6974 6820 6120 7465 7874  eled with a text
+0000d780: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+0000d790: 2020 206e 6577 5f77 696e 646f 773a 2049     new_window: I
+0000d7a0: 6620 5472 7565 2c20 6561 6368 2063 616c  f True, each cal
+0000d7b0: 6c20 746f 2071 7569 636b 706c 6f74 2829  l to quickplot()
+0000d7c0: 2077 696c 6c20 6765 6e65 7261 7465 2061   will generate a
+0000d7d0: 2073 6570 6172 6174 6520 7769 6e64 6f77   separate window
+0000d7e0: 2e0a 2020 2020 2020 2020 2020 2020 626c  ..            bl
+0000d7f0: 6f63 6b69 6e67 3a20 4966 2054 7275 652c  ocking: If True,
+0000d800: 2063 616c 6c69 6e67 2071 7569 636b 706c   calling quickpl
+0000d810: 6f74 2829 2077 696c 6c20 7061 7573 6520  ot() will pause 
+0000d820: 6578 6563 7574 696f 6e20 6f66 2028 2262  execution of ("b
+0000d830: 6c6f 636b 2229 2074 6865 0a20 2020 2020  lock") the.     
+0000d840: 2020 2020 2020 2020 2020 2072 656d 6169             remai
+0000d850: 6e64 6572 206f 6620 7468 6520 7079 7468  nder of the pyth
+0000d860: 6f6e 2063 6f64 6520 756e 7469 6c20 7468  on code until th
+0000d870: 6520 7175 6963 6b70 6c6f 7428 2920 7769  e quickplot() wi
+0000d880: 6e64 6f77 2069 7320 636c 6f73 6564 2e0a  ndow is closed..
+0000d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8a0: 4966 2046 616c 7365 2c20 7468 6520 7769  If False, the wi
+0000d8b0: 6e64 6f77 2077 696c 6c20 6265 206f 7065  ndow will be ope
+0000d8c0: 6e65 6420 616e 6420 636f 6465 2077 696c  ned and code wil
+0000d8d0: 6c20 636f 6e74 696e 7565 2074 6f20 7275  l continue to ru
+0000d8e0: 6e2e 0a20 2020 2020 2020 2020 2020 207a  n..            z
+0000d8f0: 6f6f 6d5f 6661 6374 6f72 3a20 5365 7473  oom_factor: Sets
+0000d900: 2074 6865 2073 6361 6c69 6e67 2066 6163   the scaling fac
+0000d910: 746f 7220 7768 656e 207a 6f6f 6d69 6e67  tor when zooming
+0000d920: 2074 6865 2071 7569 636b 706c 6f74 2077   the quickplot w
+0000d930: 696e 646f 7720 7769 7468 2074 6865 0a20  indow with the. 
+0000d940: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000d950: 6f75 7365 7768 6565 6c2f 7472 6163 6b70  ousewheel/trackp
+0000d960: 6164 2e0a 2020 2020 2020 2020 2020 2020  ad..            
+0000d970: 696e 7465 7261 6374 6976 655f 7a6f 6f6d  interactive_zoom
+0000d980: 3a20 456e 6162 6c65 7320 7573 696e 6720  : Enables using 
+0000d990: 6d6f 7573 6577 6865 656c 2f74 7261 636b  mousewheel/track
+0000d9a0: 7061 6420 746f 207a 6f6f 6d2e 0a20 2020  pad to zoom..   
+0000d9b0: 2020 2020 2020 2020 2066 6f6e 7473 697a           fontsiz
+0000d9c0: 653a 2066 6f72 206c 6162 656c 732e 0a20  e: for labels.. 
+0000d9d0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+0000d9e0: 735f 6578 636c 7564 6564 3a20 6c69 7374  s_excluded: list
+0000d9f0: 206f 6620 6c61 7965 7273 2074 6f20 6578   of layers to ex
+0000da00: 636c 7564 652e 0a20 2020 2020 2020 2020  clude..         
+0000da10: 2020 206c 6179 6572 5f76 6965 7773 3a20     layer_views: 
+0000da20: 6c61 7965 725f 7669 6577 7320 636f 6c6f  layer_views colo
+0000da30: 7273 206c 6f61 6465 6420 6672 6f6d 204b  rs loaded from K
+0000da40: 6c61 796f 7574 2e0a 2020 2020 2020 2020  layout..        
+0000da50: 2020 2020 6d69 6e5f 6173 7065 6374 3a20      min_aspect: 
+0000da60: 6d69 6e69 6d75 6d20 6173 7065 6374 2072  minimum aspect r
+0000da70: 6174 696f 2e0a 2020 2020 2020 2020 2222  atio..        ""
+0000da80: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+0000da90: 6473 6661 6374 6f72 792e 7175 6963 6b70  dsfactory.quickp
+0000daa0: 6c6f 7474 6572 2069 6d70 6f72 7420 7175  lotter import qu
+0000dab0: 6963 6b70 6c6f 740a 0a20 2020 2020 2020  ickplot..       
+0000dac0: 2071 7569 636b 706c 6f74 2873 656c 662c   quickplot(self,
+0000dad0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+0000dae0: 6465 6620 706c 6f74 2873 656c 662c 2070  def plot(self, p
+0000daf0: 6c6f 7474 6572 3a20 7374 7220 7c20 4e6f  lotter: str | No
+0000db00: 6e65 203d 204e 6f6e 652c 202a 2a6b 7761  ne = None, **kwa
+0000db10: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+0000db20: 2252 6574 7572 6e73 2063 6f6d 706f 6e65  "Returns compone
+0000db30: 6e74 2070 6c6f 7420 7573 696e 6720 6b6c  nt plot using kl
+0000db40: 6179 6f75 742c 206d 6174 706c 6f74 6c69  ayout, matplotli
+0000db50: 622c 2068 6f6c 6f76 6965 7773 206f 7220  b, holoviews or 
+0000db60: 7174 2e0a 0a20 2020 2020 2020 2057 6520  qt...        We 
+0000db70: 7265 636f 6d6d 656e 6420 7573 696e 6720  recommend using 
+0000db80: 6b6c 6179 6f75 742e 0a0a 2020 2020 2020  klayout...      
+0000db90: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000dba0: 2020 2020 706c 6f74 7465 723a 2070 6c6f      plotter: plo
+0000dbb0: 7420 6261 636b 656e 6420 2827 6d61 7470  t backend ('matp
+0000dbc0: 6c6f 746c 6962 272c 2027 7769 6467 6574  lotlib', 'widget
+0000dbd0: 272c 2027 6b6c 6179 6f75 7427 2c20 276b  ', 'klayout', 'k
+0000dbe0: 7765 6227 292e 0a20 2020 2020 2020 2022  web')..        "
+0000dbf0: 2222 0a20 2020 2020 2020 2070 6c6f 7474  "".        plott
+0000dc00: 6572 203d 2070 6c6f 7474 6572 206f 7220  er = plotter or 
+0000dc10: 434f 4e46 2e64 6973 706c 6179 5f74 7970  CONF.display_typ
+0000dc20: 650a 0a20 2020 2020 2020 2069 6620 706c  e..        if pl
+0000dc30: 6f74 7465 7220 6e6f 7420 696e 2076 616c  otter not in val
+0000dc40: 6964 5f70 6c6f 7474 6572 733a 0a20 2020  id_plotters:.   
+0000dc50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000dc60: 616c 7565 4572 726f 7228 6622 7b70 6c6f  alueError(f"{plo
+0000dc70: 7474 6572 2172 7d20 6e6f 7420 696e 207b  tter!r} not in {
+0000dc80: 7661 6c69 645f 706c 6f74 7465 7273 7d22  valid_plotters}"
+0000dc90: 290a 0a20 2020 2020 2020 2069 6620 706c  )..        if pl
+0000dca0: 6f74 7465 7220 3d3d 2022 6b6c 6179 6f75  otter == "klayou
+0000dcb0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+0000dcc0: 7365 6c66 2e70 6c6f 745f 6b6c 6179 6f75  self.plot_klayou
+0000dcd0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0000dce0: 7265 7475 726e 0a20 2020 2020 2020 2065  return.        e
+0000dcf0: 6c69 6620 706c 6f74 7465 7220 3d3d 2022  lif plotter == "
+0000dd00: 6b77 6562 223a 0a20 2020 2020 2020 2020  kweb":.         
+0000dd10: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+0000dd20: 6c6f 745f 6b77 6562 2829 0a20 2020 2020  lot_kweb().     
+0000dd30: 2020 2065 6c69 6620 706c 6f74 7465 7220     elif plotter 
+0000dd40: 3d3d 2022 7769 6467 6574 223a 0a20 2020  == "widget":.   
+0000dd50: 2020 2020 2020 2020 2073 656c 662e 706c           self.pl
+0000dd60: 6f74 5f77 6964 6765 7428 290a 2020 2020  ot_widget().    
+0000dd70: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0000dd80: 2020 2020 2020 2020 656c 6966 2070 6c6f          elif plo
+0000dd90: 7474 6572 203d 3d20 226d 6174 706c 6f74  tter == "matplot
+0000dda0: 6c69 6222 3a0a 2020 2020 2020 2020 2020  lib":.          
+0000ddb0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+0000ddc0: 792e 7175 6963 6b70 6c6f 7474 6572 2069  y.quickplotter i
+0000ddd0: 6d70 6f72 7420 7175 6963 6b70 6c6f 740a  mport quickplot.
+0000dde0: 0a20 2020 2020 2020 2020 2020 2071 7569  .            qui
+0000ddf0: 636b 706c 6f74 2873 656c 662c 202a 2a6b  ckplot(self, **k
+0000de00: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
+0000de10: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0000de20: 2020 2065 6c69 6620 706c 6f74 7465 7220     elif plotter 
+0000de30: 3d3d 2022 686f 6c6f 7669 6577 7322 3a0a  == "holoviews":.
+0000de40: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000de50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de60: 2069 6d70 6f72 7420 686f 6c6f 7669 6577   import holoview
+0000de70: 7320 6173 2068 760a 0a20 2020 2020 2020  s as hv..       
+0000de80: 2020 2020 2020 2020 2068 762e 6578 7465           hv.exte
+0000de90: 6e73 696f 6e28 2262 6f6b 6568 2229 0a20  nsion("bokeh"). 
+0000dea0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000deb0: 7420 496d 706f 7274 4572 726f 7220 6173  t ImportError as
+0000dec0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000ded0: 2020 2020 7072 696e 7428 2279 6f75 206e      print("you n
+0000dee0: 6565 6420 746f 2060 7069 7020 696e 7374  eed to `pip inst
+0000def0: 616c 6c20 686f 6c6f 7669 6577 7360 2229  all holoviews`")
+0000df00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000df10: 2072 6169 7365 2065 0a20 2020 2020 2020   raise e.       
+0000df20: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000df30: 2e70 6c6f 745f 686f 6c6f 7669 6577 7328  .plot_holoviews(
+0000df40: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+0000df50: 2020 2065 6c69 6620 706c 6f74 7465 7220     elif plotter 
+0000df60: 3d3d 2022 7174 223a 0a20 2020 2020 2020  == "qt":.       
+0000df70: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+0000df80: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
+0000df90: 2020 2020 2271 7420 706c 6f74 7465 7220      "qt plotter 
+0000dfa0: 6973 2064 6570 7265 6361 7465 642e 2022  is deprecated. "
+0000dfb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dfc0: 2022 5573 6520 7468 6520 6465 6661 756c   "Use the defaul
+0000dfd0: 7420 436f 6d70 6f6e 656e 742e 706c 6f74  t Component.plot
+0000dfe0: 2829 2c20 436f 6d70 6f6e 656e 742e 706c  (), Component.pl
+0000dff0: 6f74 5f6b 6c61 796f 7574 2829 206f 7220  ot_klayout() or 
+0000e000: 436f 6d70 6f6e 656e 742e 706c 6f74 5f77  Component.plot_w
+0000e010: 6964 6765 7428 2922 2c0a 2020 2020 2020  idget()",.      
+0000e020: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
+0000e030: 6576 656c 3d33 2c0a 2020 2020 2020 2020  evel=3,.        
+0000e040: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000e050: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+0000e060: 792e 7175 6963 6b70 6c6f 7474 6572 2069  y.quickplotter i
+0000e070: 6d70 6f72 7420 7175 6963 6b70 6c6f 7432  mport quickplot2
+0000e080: 0a0a 2020 2020 2020 2020 2020 2020 7175  ..            qu
+0000e090: 6963 6b70 6c6f 7432 2873 656c 6629 0a20  ickplot2(self). 
+0000e0a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e0b0: 6e0a 0a20 2020 2064 6566 2070 6c6f 745f  n..    def plot_
+0000e0c0: 686f 6c6f 7669 6577 7328 0a20 2020 2020  holoviews(.     
+0000e0d0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000e0e0: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+0000e0f0: 3a20 4c61 7965 7273 207c 204e 6f6e 6520  : Layers | None 
+0000e100: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000e110: 6c61 7965 725f 7669 6577 733a 204c 6179  layer_views: Lay
+0000e120: 6572 5669 6577 7320 7c20 4e6f 6e65 203d  erViews | None =
+0000e130: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
+0000e140: 696e 5f61 7370 6563 743a 2066 6c6f 6174  in_aspect: float
+0000e150: 203d 2030 2e32 352c 0a20 2020 2020 2020   = 0.25,.       
+0000e160: 2070 6164 6469 6e67 3a20 666c 6f61 7420   padding: float 
+0000e170: 3d20 302e 352c 0a20 2020 2029 3a0a 2020  = 0.5,.    ):.  
+0000e180: 2020 2020 2020 2222 2250 6c6f 7420 636f        """Plot co
+0000e190: 6d70 6f6e 656e 7420 696e 2068 6f6c 6f76  mponent in holov
+0000e1a0: 6965 7773 2e0a 0a20 2020 2020 2020 2041  iews...        A
+0000e1b0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000e1c0: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+0000e1d0: 3a20 6c69 7374 206f 6620 6c61 7965 7273  : list of layers
+0000e1e0: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+0000e1f0: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
+0000e200: 6965 7773 3a20 6c61 7965 725f 7669 6577  iews: layer_view
+0000e210: 7320 636f 6c6f 7273 206c 6f61 6465 6420  s colors loaded 
+0000e220: 6672 6f6d 204b 6c61 796f 7574 2e0a 2020  from Klayout..  
+0000e230: 2020 2020 2020 2020 2020 6d69 6e5f 6173            min_as
+0000e240: 7065 6374 3a20 6d69 6e69 6d75 6d20 6173  pect: minimum as
+0000e250: 7065 6374 2072 6174 696f 2e0a 2020 2020  pect ratio..    
+0000e260: 2020 2020 2020 2020 7061 6464 696e 673a          padding:
+0000e270: 2061 726f 756e 6420 626f 756e 6469 6e67   around bounding
+0000e280: 2062 6f78 2e0a 0a20 2020 2020 2020 2052   box...        R
+0000e290: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+0000e2a0: 2020 2020 486f 6c6f 7669 6577 7320 4f76      Holoviews Ov
+0000e2b0: 6572 6c61 7920 746f 2064 6973 706c 6179  erlay to display
+0000e2c0: 2061 6c6c 2070 6f6c 7967 6f6e 732e 0a20   all polygons.. 
+0000e2d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000e2e0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000e2f0: 7279 2e61 6464 5f70 696e 7320 696d 706f  ry.add_pins impo
+0000e300: 7274 2067 6574 5f70 696e 5f74 7269 616e  rt get_pin_trian
+0000e310: 676c 655f 706f 6c79 676f 6e5f 7469 700a  gle_polygon_tip.
+0000e320: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+0000e330: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
+0000e340: 7274 2067 6574 5f6c 6179 6572 5f76 6965  rt get_layer_vie
+0000e350: 7773 0a0a 2020 2020 2020 2020 7761 726e  ws..        warn
+0000e360: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
+0000e370: 2020 2020 2020 2022 686f 6c6f 7669 6577         "holoview
+0000e380: 7320 706c 6f74 7465 7220 6973 2064 6570  s plotter is dep
+0000e390: 7265 6361 7465 642e 2022 0a20 2020 2020  recated. ".     
+0000e3a0: 2020 2020 2020 2022 5573 6520 7468 6520         "Use the 
+0000e3b0: 6465 6661 756c 7420 436f 6d70 6f6e 656e  default Componen
+0000e3c0: 742e 706c 6f74 2829 2c20 436f 6d70 6f6e  t.plot(), Compon
+0000e3d0: 656e 742e 706c 6f74 5f6b 6c61 796f 7574  ent.plot_klayout
+0000e3e0: 2829 206f 7220 436f 6d70 6f6e 656e 742e  () or Component.
+0000e3f0: 706c 6f74 5f77 6964 6765 7428 2922 2c0a  plot_widget()",.
+0000e400: 2020 2020 2020 2020 2020 2020 7374 6163              stac
+0000e410: 6b6c 6576 656c 3d33 2c0a 2020 2020 2020  klevel=3,.      
+0000e420: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0000e430: 6c61 7965 725f 7669 6577 7320 6973 204e  layer_views is N
+0000e440: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000e450: 206c 6179 6572 5f76 6965 7773 203d 2067   layer_views = g
+0000e460: 6574 5f6c 6179 6572 5f76 6965 7773 2829  et_layer_views()
+0000e470: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000e480: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+0000e490: 7420 686f 6c6f 7669 6577 7320 6173 2068  t holoviews as h
+0000e4a0: 760a 0a20 2020 2020 2020 2020 2020 2068  v..            h
+0000e4b0: 762e 6578 7465 6e73 696f 6e28 2262 6f6b  v.extension("bok
+0000e4c0: 6568 2229 0a20 2020 2020 2020 2065 7863  eh").        exc
+0000e4d0: 6570 7420 496d 706f 7274 4572 726f 7220  ept ImportError 
+0000e4e0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000e4f0: 2020 7072 696e 7428 2279 6f75 206e 6565    print("you nee
+0000e500: 6420 746f 2060 7069 7020 696e 7374 616c  d to `pip instal
+0000e510: 6c20 686f 6c6f 7669 6577 7360 2229 0a20  l holoviews`"). 
+0000e520: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e530: 2065 0a0a 2020 2020 2020 2020 7365 6c66   e..        self
+0000e540: 2e5f 6262 5f76 616c 6964 203d 2046 616c  ._bb_valid = Fal
+0000e550: 7365 2020 2320 7265 636f 6d70 7574 6520  se  # recompute 
+0000e560: 7468 6520 626f 756e 6469 6e67 2062 6f78  the bounding box
+0000e570: 0a20 2020 2020 2020 2062 203d 2073 656c  .        b = sel
+0000e580: 662e 6262 6f78 202b 2028 282d 7061 6464  f.bbox + ((-padd
+0000e590: 696e 672c 202d 7061 6464 696e 6729 2c20  ing, -padding), 
+0000e5a0: 2870 6164 6469 6e67 2c20 7061 6464 696e  (padding, paddin
+0000e5b0: 6729 290a 2020 2020 2020 2020 6220 3d20  g)).        b = 
+0000e5c0: 6e70 2e61 7272 6179 2862 2e66 6c61 7429  np.array(b.flat)
+0000e5d0: 0a20 2020 2020 2020 2063 656e 7465 7220  .        center 
+0000e5e0: 3d20 6e70 2e61 7272 6179 2828 6e70 2e73  = np.array((np.s
+0000e5f0: 756d 2862 5b3a 3a32 5d29 202f 2032 2c20  um(b[::2]) / 2, 
+0000e600: 6e70 2e73 756d 2862 5b31 3a3a 325d 2920  np.sum(b[1::2]) 
+0000e610: 2f20 3229 290a 2020 2020 2020 2020 7369  / 2)).        si
+0000e620: 7a65 203d 206e 702e 6172 7261 7928 286e  ze = np.array((n
+0000e630: 702e 6162 7328 625b 325d 202d 2062 5b30  p.abs(b[2] - b[0
+0000e640: 5d29 2c20 6e70 2e61 6273 2862 5b33 5d20  ]), np.abs(b[3] 
+0000e650: 2d20 625b 315d 2929 290a 2020 2020 2020  - b[1]))).      
+0000e660: 2020 6478 203d 206e 702e 6172 7261 7928    dx = np.array(
+0000e670: 0a20 2020 2020 2020 2020 2020 2028 0a20  .            (. 
+0000e680: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000e690: 702e 6d61 7869 6d75 6d28 6d69 6e5f 6173  p.maximum(min_as
+0000e6a0: 7065 6374 202a 2073 697a 655b 315d 2c20  pect * size[1], 
+0000e6b0: 7369 7a65 5b30 5d29 202f 2032 2c0a 2020  size[0]) / 2,.  
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+0000e6d0: 2e6d 6178 696d 756d 2873 697a 655b 315d  .maximum(size[1]
+0000e6e0: 2c20 6d69 6e5f 6173 7065 6374 202a 2073  , min_aspect * s
+0000e6f0: 697a 655b 305d 2920 2f20 322c 0a20 2020  ize[0]) / 2,.   
+0000e700: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e710: 2020 2029 0a20 2020 2020 2020 2062 203d     ).        b =
+0000e720: 206e 702e 6873 7461 636b 2828 6365 6e74   np.hstack((cent
+0000e730: 6572 202d 2064 782c 2063 656e 7465 7220  er - dx, center 
+0000e740: 2b20 6478 2929 0a0a 2020 2020 2020 2020  + dx))..        
+0000e750: 706c 6f74 735f 746f 5f6f 7665 726c 6179  plots_to_overlay
+0000e760: 203d 205b 5d0a 2020 2020 2020 2020 6c61   = [].        la
+0000e770: 7965 7273 5f65 7863 6c75 6465 6420 3d20  yers_excluded = 
+0000e780: 5b5d 2069 6620 6c61 7965 7273 5f65 7863  [] if layers_exc
+0000e790: 6c75 6465 6420 6973 204e 6f6e 6520 656c  luded is None el
+0000e7a0: 7365 206c 6179 6572 735f 6578 636c 7564  se layers_exclud
+0000e7b0: 6564 0a0a 2020 2020 2020 2020 666f 7220  ed..        for 
+0000e7c0: 6c61 7965 722c 2070 6f6c 7967 6f6e 2069  layer, polygon i
+0000e7d0: 6e20 7365 6c66 2e67 6574 5f70 6f6c 7967  n self.get_polyg
+0000e7e0: 6f6e 7328 6279 5f73 7065 633d 5472 7565  ons(by_spec=True
+0000e7f0: 292e 6974 656d 7328 293a 0a20 2020 2020  ).items():.     
+0000e800: 2020 2020 2020 2069 6620 6c61 7965 7220         if layer 
+0000e810: 696e 206c 6179 6572 735f 6578 636c 7564  in layers_exclud
+0000e820: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0000e830: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0000e840: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000e850: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000e860: 6179 6572 5f76 6965 7720 3d20 6c61 7965  ayer_view = laye
+0000e870: 725f 7669 6577 732e 6765 745f 6672 6f6d  r_views.get_from
+0000e880: 5f74 7570 6c65 286c 6179 6572 290a 2020  _tuple(layer).  
+0000e890: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000e8a0: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
+0000e8b0: 2020 2020 2020 2020 2020 2020 206c 6179               lay
+0000e8c0: 6572 7320 3d20 6c69 7374 286c 6179 6572  ers = list(layer
+0000e8d0: 5f76 6965 7773 2e67 6574 5f6c 6179 6572  _views.get_layer
+0000e8e0: 5f76 6965 7773 2829 2e6b 6579 7328 2929  _views().keys())
+0000e8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e900: 2077 6172 6e69 6e67 732e 7761 726e 2866   warnings.warn(f
+0000e910: 227b 6c61 7965 7221 727d 206e 6f74 2064  "{layer!r} not d
+0000e920: 6566 696e 6564 2069 6e20 7b6c 6179 6572  efined in {layer
+0000e930: 737d 222c 2073 7461 636b 6c65 7665 6c3d  s}", stacklevel=
+0000e940: 3329 0a20 2020 2020 2020 2020 2020 2020  3).             
+0000e950: 2020 206c 6179 6572 5f76 6965 7720 3d20     layer_view = 
+0000e960: 4c61 7965 7256 6965 7728 6c61 7965 723d  LayerView(layer=
+0000e970: 6c61 7965 7229 0a20 2020 2020 2020 2020  layer).         
+0000e980: 2020 2023 2054 4f44 4f3a 204d 6174 6368     # TODO: Match
+0000e990: 2075 7020 6f70 7469 6f6e 7320 7769 7468   up options with
+0000e9a0: 204c 6179 6572 5669 6577 730a 2020 2020   LayerViews.    
+0000e9b0: 2020 2020 2020 2020 706c 6f74 735f 746f          plots_to
+0000e9c0: 5f6f 7665 726c 6179 2e61 7070 656e 6428  _overlay.append(
+0000e9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e9e0: 2068 762e 506f 6c79 676f 6e73 2870 6f6c   hv.Polygons(pol
+0000e9f0: 7967 6f6e 2c20 6c61 6265 6c3d 7374 7228  ygon, label=str(
+0000ea00: 6c61 7965 725f 7669 6577 2e6e 616d 6529  layer_view.name)
+0000ea10: 292e 6f70 7473 280a 2020 2020 2020 2020  ).opts(.        
+0000ea20: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0000ea30: 5f61 7370 6563 743d 312c 0a20 2020 2020  _aspect=1,.     
+0000ea40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ea50: 7261 6d65 5f77 6964 7468 3d35 3030 2c0a  rame_width=500,.
+0000ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea70: 2020 2020 796c 696d 3d28 625b 315d 2c20      ylim=(b[1], 
+0000ea80: 625b 335d 292c 0a20 2020 2020 2020 2020  b[3]),.         
+0000ea90: 2020 2020 2020 2020 2020 2078 6c69 6d3d             xlim=
+0000eaa0: 2862 5b30 5d2c 2062 5b32 5d29 2c0a 2020  (b[0], b[2]),.  
+0000eab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eac0: 2020 6669 6c6c 5f63 6f6c 6f72 3d6c 6179    fill_color=lay
+0000ead0: 6572 5f76 6965 772e 6669 6c6c 5f63 6f6c  er_view.fill_col
+0000eae0: 6f72 2e61 735f 7267 6228 2920 6f72 2022  or.as_rgb() or "
+0000eaf0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000eb00: 2020 2020 2020 206c 696e 655f 636f 6c6f         line_colo
+0000eb10: 723d 6c61 7965 725f 7669 6577 2e66 7261  r=layer_view.fra
+0000eb20: 6d65 5f63 6f6c 6f72 2e61 735f 7267 6228  me_color.as_rgb(
+0000eb30: 2920 6f72 2022 222c 0a20 2020 2020 2020  ) or "",.       
+0000eb40: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000eb50: 6c5f 616c 7068 613d 6c61 7965 725f 7669  l_alpha=layer_vi
+0000eb60: 6577 2e67 6574 5f61 6c70 6861 2829 206f  ew.get_alpha() o
+0000eb70: 7220 2222 2c0a 2020 2020 2020 2020 2020  r "",.          
+0000eb80: 2020 2020 2020 2020 2020 6c69 6e65 5f61            line_a
+0000eb90: 6c70 6861 3d6c 6179 6572 5f76 6965 772e  lpha=layer_view.
+0000eba0: 6765 745f 616c 7068 6128 2920 6f72 2022  get_alpha() or "
+0000ebb0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000ebc0: 2020 2020 2020 2074 6f6f 6c73 3d5b 2268         tools=["h
+0000ebd0: 6f76 6572 225d 2c0a 2020 2020 2020 2020  over"],.        
+0000ebe0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ebf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000ec00: 666f 7220 6e61 6d65 2c20 706f 7274 2069  for name, port i
+0000ec10: 6e20 7365 6c66 2e70 6f72 7473 2e69 7465  n self.ports.ite
+0000ec20: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000ec30: 2020 6e61 6d65 203d 2073 7472 286e 616d    name = str(nam
+0000ec40: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
+0000ec50: 6f6c 7967 6f6e 2c20 7074 6970 203d 2067  olygon, ptip = g
+0000ec60: 6574 5f70 696e 5f74 7269 616e 676c 655f  et_pin_triangle_
+0000ec70: 706f 6c79 676f 6e5f 7469 7028 706f 7274  polygon_tip(port
+0000ec80: 3d70 6f72 7429 0a0a 2020 2020 2020 2020  =port)..        
+0000ec90: 2020 2020 706c 6f74 735f 746f 5f6f 7665      plots_to_ove
+0000eca0: 726c 6179 2e61 7070 656e 6428 0a20 2020  rlay.append(.   
+0000ecb0: 2020 2020 2020 2020 2020 2020 2068 762e               hv.
+0000ecc0: 506f 6c79 676f 6e73 2870 6f6c 7967 6f6e  Polygons(polygon
+0000ecd0: 2c20 6c61 6265 6c3d 6e61 6d65 292e 6f70  , label=name).op
+0000ece0: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
+0000ecf0: 2020 2020 2020 2020 6461 7461 5f61 7370          data_asp
+0000ed00: 6563 743d 312c 0a20 2020 2020 2020 2020  ect=1,.         
+0000ed10: 2020 2020 2020 2020 2020 2066 7261 6d65             frame
+0000ed20: 5f77 6964 7468 3d35 3030 2c0a 2020 2020  _width=500,.    
+0000ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed40: 6669 6c6c 5f61 6c70 6861 3d30 2c0a 2020  fill_alpha=0,.  
+0000ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed60: 2020 796c 696d 3d28 625b 315d 2c20 625b    ylim=(b[1], b[
+0000ed70: 335d 292c 0a20 2020 2020 2020 2020 2020  3]),.           
+0000ed80: 2020 2020 2020 2020 2078 6c69 6d3d 2862           xlim=(b
+0000ed90: 5b30 5d2c 2062 5b32 5d29 2c0a 2020 2020  [0], b[2]),.    
+0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edb0: 636f 6c6f 723d 2272 6564 222c 0a20 2020  color="red",.   
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 206c 696e 655f 616c 7068 613d 6c61 7965   line_alpha=laye
+0000ede0: 725f 7669 6577 2e67 6574 5f61 6c70 6861  r_view.get_alpha
+0000edf0: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
+0000ee00: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0000ee10: 6f6c 733d 5b22 686f 7665 7222 5d2c 0a20  ols=["hover"],. 
+0000ee20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ee30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee40: 202a 2068 762e 5465 7874 2870 7469 705b   * hv.Text(ptip[
+0000ee50: 305d 2c20 7074 6970 5b31 5d2c 206e 616d  0], ptip[1], nam
+0000ee60: 6529 0a20 2020 2020 2020 2020 2020 2029  e).            )
+0000ee70: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000ee80: 2068 762e 4f76 6572 6c61 7928 706c 6f74   hv.Overlay(plot
+0000ee90: 735f 746f 5f6f 7665 726c 6179 292e 6f70  s_to_overlay).op
+0000eea0: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
+0000eeb0: 7368 6f77 5f6c 6567 656e 643d 5472 7565  show_legend=True
+0000eec0: 2c20 7368 6172 6564 5f61 7865 733d 4661  , shared_axes=Fa
+0000eed0: 6c73 652c 2079 6c69 6d3d 2862 5b31 5d2c  lse, ylim=(b[1],
+0000eee0: 2062 5b33 5d29 2c20 786c 696d 3d28 625b   b[3]), xlim=(b[
+0000eef0: 305d 2c20 625b 325d 290a 2020 2020 2020  0], b[2]).      
+0000ef00: 2020 290a 0a20 2020 2064 6566 2073 686f    )..    def sho
+0000ef10: 7728 0a20 2020 2020 2020 2073 656c 662c  w(.        self,
+0000ef20: 0a20 2020 2020 2020 2073 686f 775f 706f  .        show_po
+0000ef30: 7274 733a 2062 6f6f 6c20 3d20 4661 6c73  rts: bool = Fals
+0000ef40: 652c 0a20 2020 2020 2020 2073 686f 775f  e,.        show_
+0000ef50: 7375 6270 6f72 7473 3a20 626f 6f6c 203d  subports: bool =
+0000ef60: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+0000ef70: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000ef80: 723a 204c 6179 6572 203d 2028 312c 2031  r: Layer = (1, 1
+0000ef90: 3029 2c0a 2020 2020 2020 2020 2a2a 6b77  0),.        **kw
+0000efa0: 6172 6773 2c0a 2020 2020 2920 2d3e 204e  args,.    ) -> N
+0000efb0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000efc0: 5368 6f77 2063 6f6d 706f 6e65 6e74 2069  Show component i
+0000efd0: 6e20 4b4c 6179 6f75 742e 0a0a 2020 2020  n KLayout...    
+0000efe0: 2020 2020 7265 7475 726e 7320 6120 636f      returns a co
+0000eff0: 7079 206f 6620 7468 6520 436f 6d70 6f6e  py of the Compon
+0000f000: 656e 742c 2073 6f20 7468 6520 6f72 6967  ent, so the orig
+0000f010: 696e 616c 2063 6f6d 706f 6e65 6e74 2072  inal component r
+0000f020: 656d 6169 6e73 2069 6e74 6163 742e 0a20  emains intact.. 
+0000f030: 2020 2020 2020 2077 6974 6820 7069 6e73         with pins
+0000f040: 206d 6172 6b65 7273 206f 6e20 6561 6368   markers on each
+0000f050: 2070 6f72 7420 7368 6f77 5f70 6f72 7473   port show_ports
+0000f060: 203d 2054 7275 652c 2061 6e64 206f 7074   = True, and opt
+0000f070: 696f 6e61 6c6c 7920 616c 736f 0a20 2020  ionally also.   
+0000f080: 2020 2020 2074 6865 2070 6f72 7473 2066       the ports f
+0000f090: 726f 6d20 7468 6520 7265 6665 7265 6e63  rom the referenc
+0000f0a0: 6573 2028 7368 6f77 5f73 7562 706f 7274  es (show_subport
+0000f0b0: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
+0000f0c0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+0000f0d0: 2020 2073 686f 775f 706f 7274 733a 2073     show_ports: s
+0000f0e0: 686f 7773 2063 6f6d 706f 6e65 6e74 2077  hows component w
+0000f0f0: 6974 6820 706f 7274 206d 6172 6b65 7273  ith port markers
+0000f100: 2061 6e64 206c 6162 656c 732e 0a20 2020   and labels..   
+0000f110: 2020 2020 2020 2020 2073 686f 775f 7375           show_su
+0000f120: 6270 6f72 7473 3a20 6164 6420 706f 7274  bports: add port
+0000f130: 7320 6d61 726b 6572 7320 616e 6420 6c61  s markers and la
+0000f140: 6265 6c73 2074 6f20 7265 6665 7265 6e63  bels to referenc
+0000f150: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+0000f160: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000f170: 723a 2066 6f72 2074 6865 2070 6f72 7473  r: for the ports
+0000f180: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+0000f190: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+0000f1a0: 2020 2020 2067 6473 7061 7468 3a20 4744       gdspath: GD
+0000f1b0: 5320 6669 6c65 2070 6174 6820 746f 2077  S file path to w
+0000f1c0: 7269 7465 2074 6f2e 0a20 2020 2020 2020  rite to..       
+0000f1d0: 2020 2020 2067 6473 6469 723a 2064 6972       gdsdir: dir
+0000f1e0: 6563 746f 7279 2066 6f72 2074 6865 2047  ectory for the G
+0000f1f0: 4453 2066 696c 652e 2044 6566 6175 6c74  DS file. Default
+0000f200: 7320 746f 202f 746d 702f 2e0a 2020 2020  s to /tmp/..    
+0000f210: 2020 2020 2020 2020 756e 6974 3a20 756e          unit: un
+0000f220: 6974 2073 697a 6520 666f 7220 6f62 6a65  it size for obje
+0000f230: 6374 7320 696e 206c 6962 7261 7279 2e20  cts in library. 
+0000f240: 3175 6d20 6279 2064 6566 6175 6c74 2e0a  1um by default..
+0000f250: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+0000f260: 6973 696f 6e3a 2066 6f72 206f 626a 6563  ision: for objec
+0000f270: 7420 6469 6d65 6e73 696f 6e73 2069 6e20  t dimensions in 
+0000f280: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
+0000f290: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
+0000f2a0: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
+0000f2b0: 6573 7461 6d70 3a20 4465 6661 756c 7473  estamp: Defaults
+0000f2c0: 2074 6f20 3230 3139 2d31 302d 3235 2e20   to 2019-10-25. 
+0000f2d0: 4966 204e 6f6e 6520 7573 6573 2063 7572  If None uses cur
+0000f2e0: 7265 6e74 2074 696d 652e 0a20 2020 2020  rent time..     
+0000f2f0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+0000f300: 726f 6d20 6764 7366 6163 746f 7279 2e61  rom gdsfactory.a
+0000f310: 6464 5f70 696e 7320 696d 706f 7274 2061  dd_pins import a
+0000f320: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
+0000f330: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000f340: 7366 6163 746f 7279 2e73 686f 7720 696d  sfactory.show im
+0000f350: 706f 7274 2073 686f 770a 0a20 2020 2020  port show..     
+0000f360: 2020 2063 6f6d 706f 6e65 6e74 203d 2028     component = (
+0000f370: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f380: 662e 6164 645f 7069 6e73 5f74 7269 616e  f.add_pins_trian
+0000f390: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
+0000f3a0: 2020 2020 2070 6f72 745f 6d61 726b 6572       port_marker
+0000f3b0: 5f6c 6179 6572 3d70 6f72 745f 6d61 726b  _layer=port_mark
+0000f3c0: 6572 5f6c 6179 6572 2c20 6c61 7965 725f  er_layer, layer_
+0000f3d0: 6c61 6265 6c3d 706f 7274 5f6d 6172 6b65  label=port_marke
+0000f3e0: 725f 6c61 7965 720a 2020 2020 2020 2020  r_layer.        
+0000f3f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000f400: 2020 6966 2073 686f 775f 706f 7274 730a    if show_ports.
+0000f410: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000f420: 2073 656c 660a 2020 2020 2020 2020 290a   self.        ).
+0000f430: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
+0000f440: 5f73 7562 706f 7274 733a 0a20 2020 2020  _subports:.     
+0000f450: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000f460: 203d 2073 656c 662e 636f 7079 2829 0a20   = self.copy(). 
+0000f470: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+0000f480: 6e65 6e74 2e6e 616d 6520 3d20 7365 6c66  nent.name = self
+0000f490: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
+0000f4a0: 2020 666f 7220 7265 6665 7265 6e63 6520    for reference 
+0000f4b0: 696e 2063 6f6d 706f 6e65 6e74 2e72 6566  in component.ref
+0000f4c0: 6572 656e 6365 733a 0a20 2020 2020 2020  erences:.       
+0000f4d0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000f4e0: 7374 616e 6365 2863 6f6d 706f 6e65 6e74  stance(component
+0000f4f0: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
+0000f500: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
+0000f510: 2020 2020 2020 2020 2020 2061 6464 5f70             add_p
+0000f520: 696e 735f 7472 6961 6e67 6c65 280a 2020  ins_triangle(.  
+0000f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f540: 2020 2020 2020 636f 6d70 6f6e 656e 743d        component=
+0000f550: 636f 6d70 6f6e 656e 742c 0a20 2020 2020  component,.     
+0000f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f570: 2020 2072 6566 6572 656e 6365 3d72 6566     reference=ref
+0000f580: 6572 656e 6365 2c0a 2020 2020 2020 2020  erence,.        
+0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5a0: 6c61 7965 723d 706f 7274 5f6d 6172 6b65  layer=port_marke
+0000f5b0: 725f 6c61 7965 722c 0a20 2020 2020 2020  r_layer,.       
+0000f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5d0: 206c 6179 6572 5f6c 6162 656c 3d70 6f72   layer_label=por
+0000f5e0: 745f 6d61 726b 6572 5f6c 6179 6572 2c0a  t_marker_layer,.
+0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f600: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+0000f610: 686f 7728 636f 6d70 6f6e 656e 742c 202a  how(component, *
+0000f620: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
+0000f630: 6620 5f77 7269 7465 5f6c 6962 7261 7279  f _write_library
+0000f640: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000f650: 2020 2020 2020 2020 6764 7370 6174 683a          gdspath:
+0000f660: 2050 6174 6854 7970 6520 7c20 4e6f 6e65   PathType | None
+0000f670: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000f680: 2067 6473 6469 723a 2050 6174 6854 7970   gdsdir: PathTyp
+0000f690: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+0000f6a0: 0a20 2020 2020 2020 2074 696d 6573 7461  .        timesta
+0000f6b0: 6d70 3a20 6461 7465 7469 6d65 2e64 6174  mp: datetime.dat
+0000f6c0: 6574 696d 6520 7c20 4e6f 6e65 203d 205f  etime | None = _
+0000f6d0: 7469 6d65 7374 616d 7032 3031 392c 0a20  timestamp2019,. 
+0000f6e0: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
+0000f6f0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+0000f700: 2020 2020 2077 6974 685f 6f61 7369 733a       with_oasis:
+0000f710: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000f720: 2020 2020 2020 2077 6974 685f 6d65 7461         with_meta
+0000f730: 6461 7461 3a20 626f 6f6c 203d 2046 616c  data: bool = Fal
+0000f740: 7365 2c0a 2020 2020 2020 2020 2a2a 6b77  se,.        **kw
+0000f750: 6172 6773 2c0a 2020 2020 2920 2d3e 2050  args,.    ) -> P
+0000f760: 6174 683a 0a20 2020 2020 2020 2022 2222  ath:.        """
+0000f770: 5772 6974 6520 636f 6d70 6f6e 656e 7420  Write component 
+0000f780: 746f 2047 4453 206f 7220 4f41 5349 5320  to GDS or OASIS 
+0000f790: 616e 6420 7265 7475 726e 7320 6764 7370  and returns gdsp
+0000f7a0: 6174 682e 0a0a 2020 2020 2020 2020 4172  ath...        Ar
+0000f7b0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000f7c0: 6764 7370 6174 683a 2047 4453 2066 696c  gdspath: GDS fil
+0000f7d0: 6520 7061 7468 2074 6f20 7772 6974 6520  e path to write 
+0000f7e0: 746f 2e0a 2020 2020 2020 2020 2020 2020  to..            
+0000f7f0: 6764 7364 6972 3a20 6469 7265 6374 6f72  gdsdir: director
+0000f800: 7920 666f 7220 7468 6520 4744 5320 6669  y for the GDS fi
+0000f810: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
+0000f820: 2f74 6d70 2f72 616e 646f 6d46 696c 652f  /tmp/randomFile/
+0000f830: 6764 7366 6163 746f 7279 2e0a 2020 2020  gdsfactory..    
+0000f840: 2020 2020 2020 2020 7469 6d65 7374 616d          timestam
+0000f850: 703a 2044 6566 6175 6c74 7320 746f 2032  p: Defaults to 2
+0000f860: 3031 392d 3130 2d32 3520 666f 7220 636f  019-10-25 for co
+0000f870: 6e73 6973 7465 6e74 2068 6173 682e 0a20  nsistent hash.. 
+0000f880: 2020 2020 2020 2020 2020 2020 2020 2049                 I
+0000f890: 6620 4e6f 6e65 2075 7365 7320 6375 7272  f None uses curr
+0000f8a0: 656e 7420 7469 6d65 2e0a 2020 2020 2020  ent time..      
+0000f8b0: 2020 2020 2020 6c6f 6767 696e 673a 2064        logging: d
+0000f8c0: 6973 6162 6c65 2047 4453 2070 6174 6820  isable GDS path 
+0000f8d0: 6c6f 6767 696e 672c 2066 6f72 2065 7861  logging, for exa
+0000f8e0: 6d70 6c65 2066 6f72 2073 686f 7769 6e67  mple for showing
+0000f8f0: 2069 7420 696e 204b 4c61 796f 7574 2e0a   it in KLayout..
+0000f900: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000f910: 5f6f 6173 6973 3a20 4966 2054 7275 652c  _oasis: If True,
+0000f920: 2066 696c 6520 7769 6c6c 2062 6520 7772   file will be wr
+0000f930: 6974 7465 6e20 746f 204f 4153 4953 2e20  itten to OASIS. 
+0000f940: 4f74 6865 7277 6973 652c 2066 696c 6520  Otherwise, file 
+0000f950: 7769 6c6c 2062 6520 7772 6974 7465 6e20  will be written 
+0000f960: 746f 2047 4453 2e0a 2020 2020 2020 2020  to GDS..        
+0000f970: 2020 2020 7769 7468 5f6d 6574 6164 6174      with_metadat
+0000f980: 613a 2077 7269 7465 7320 6d65 7461 6461  a: writes metada
+0000f990: 7461 2069 6e20 5941 4d4c 2066 6f72 6d61  ta in YAML forma
+0000f9a0: 742e 0a0a 2020 2020 2020 2020 4b65 7977  t...        Keyw
+0000f9b0: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
+0000f9c0: 2020 2020 2020 4b65 7977 6f72 6420 6172        Keyword ar
+0000f9d0: 6775 6d65 6e74 7320 7769 6c6c 206f 7665  guments will ove
+0000f9e0: 7272 6964 6520 7468 6520 6163 7469 7665  rride the active
+0000f9f0: 2050 444b 2773 2064 6566 6175 6c74 2047   PDK's default G
+0000fa00: 6473 5772 6974 6553 6574 7469 6e67 7320  dsWriteSettings 
+0000fa10: 616e 6420 4f61 7369 7357 7269 7465 5365  and OasisWriteSe
+0000fa20: 7474 696e 6773 2e0a 0a20 2020 2020 2020  ttings...       
+0000fa30: 2020 2020 2047 6473 2073 6574 7469 6e67       Gds setting
+0000fa40: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000fa50: 2020 2075 6e69 743a 2075 6e69 7420 7369     unit: unit si
+0000fa60: 7a65 2066 6f72 206f 626a 6563 7473 2069  ze for objects i
+0000fa70: 6e20 6c69 6272 6172 792e 2031 756d 2062  n library. 1um b
+0000fa80: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
+0000fa90: 2020 2020 2020 2020 2020 2070 7265 6369             preci
+0000faa0: 7369 6f6e 3a20 666f 7220 6469 6d65 6e73  sion: for dimens
+0000fab0: 696f 6e73 2069 6e20 7468 6520 6c69 6272  ions in the libr
+0000fac0: 6172 7920 286d 292e 2031 6e6d 2062 7920  ary (m). 1nm by 
+0000fad0: 6465 6661 756c 742e 0a20 2020 2020 2020  default..       
+0000fae0: 2020 2020 2020 2020 206f 6e5f 6475 706c           on_dupl
+0000faf0: 6963 6174 655f 6365 6c6c 3a20 7370 6563  icate_cell: spec
+0000fb00: 6966 7920 686f 7720 746f 2072 6573 6f6c  ify how to resol
+0000fb10: 7665 2064 7570 6c69 6361 7465 2d6e 616d  ve duplicate-nam
+0000fb20: 6564 2063 656c 6c73 2e20 4368 6f6f 7365  ed cells. Choose
+0000fb30: 206f 6e65 206f 6620 7468 6520 666f 6c6c   one of the foll
+0000fb40: 6f77 696e 673a 0a20 2020 2020 2020 2020  owing:.         
+0000fb50: 2020 2020 2020 2020 2020 2022 7761 726e             "warn
+0000fb60: 2220 2864 6566 6175 6c74 293a 206f 7665  " (default): ove
+0000fb70: 7277 7269 7465 2061 6c6c 2064 7570 6c69  rwrite all dupli
+0000fb80: 6361 7465 2063 656c 6c73 2077 6974 6820  cate cells with 
+0000fb90: 6f6e 6520 6f66 2074 6865 2064 7570 6c69  one of the dupli
+0000fba0: 6361 7465 7320 2861 7262 6974 7261 7269  cates (arbitrari
+0000fbb0: 6c79 292e 0a20 2020 2020 2020 2020 2020  ly)..           
+0000fbc0: 2020 2020 2020 2020 2022 6572 726f 7222           "error"
+0000fbd0: 3a20 7468 726f 7720 6120 5661 6c75 6545  : throw a ValueE
+0000fbe0: 7272 6f72 2077 6865 6e20 6174 7465 6d70  rror when attemp
+0000fbf0: 7469 6e67 2074 6f20 7772 6974 6520 6120  ting to write a 
+0000fc00: 6764 7320 7769 7468 2064 7570 6c69 6361  gds with duplica
+0000fc10: 7465 2063 656c 6c73 2e0a 2020 2020 2020  te cells..      
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+0000fc30: 7665 7277 7269 7465 223a 206f 7665 7277  verwrite": overw
+0000fc40: 7269 7465 2061 6c6c 2064 7570 6c69 6361  rite all duplica
+0000fc50: 7465 2063 656c 6c73 2077 6974 6820 6f6e  te cells with on
+0000fc60: 6520 6f66 2074 6865 2064 7570 6c69 6361  e of the duplica
+0000fc70: 7465 732c 2077 6974 686f 7574 2077 6172  tes, without war
+0000fc80: 6e69 6e67 2e0a 2020 2020 2020 2020 2020  ning..          
+0000fc90: 2020 2020 2020 2020 2020 4e6f 6e65 3a20            None: 
+0000fca0: 646f 206e 6f74 2074 7279 2074 6f20 7265  do not try to re
+0000fcb0: 736f 6c76 6520 2861 7420 796f 7572 206f  solve (at your o
+0000fcc0: 776e 2072 6973 6b21 290a 2020 2020 2020  wn risk!).      
+0000fcd0: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+0000fce0: 6e5f 696e 7661 6c69 645f 7265 6673 3a20  n_invalid_refs: 
+0000fcf0: 666c 6174 7465 6e73 2063 6f6d 706f 6e65  flattens compone
+0000fd00: 6e74 2072 6566 6572 656e 6365 7320 7768  nt references wh
+0000fd10: 6963 6820 6861 7665 2069 6e76 616c 6964  ich have invalid
+0000fd20: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
+0000fd30: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fd40: 2020 6d61 785f 706f 696e 7473 3a20 4d61    max_points: Ma
+0000fd50: 7869 6d61 6c20 6e75 6d62 6572 206f 6620  ximal number of 
+0000fd60: 7665 7274 6963 6573 2070 6572 2070 6f6c  vertices per pol
+0000fd70: 7967 6f6e 2e20 506f 6c79 676f 6e73 2077  ygon. Polygons w
+0000fd80: 6974 6820 6d6f 7265 2076 6572 7469 6365  ith more vertice
+0000fd90: 7320 7468 6174 2074 6869 7320 6172 6520  s that this are 
+0000fda0: 6175 746f 6d61 7469 6361 6c6c 7920 6672  automatically fr
+0000fdb0: 6163 7475 7265 642e 0a0a 2020 2020 2020  actured...      
+0000fdc0: 2020 2020 2020 4f61 7369 7320 7365 7474        Oasis sett
+0000fdd0: 696e 6773 3a0a 2020 2020 2020 2020 2020  ings:.          
+0000fde0: 2020 2020 2020 636f 6d70 7265 7373 696f        compressio
+0000fdf0: 6e5f 6c65 7665 6c3a 204c 6576 656c 206f  n_level: Level o
+0000fe00: 6620 636f 6d70 7265 7373 696f 6e20 666f  f compression fo
+0000fe10: 7220 6365 6c6c 7320 2862 6574 7765 656e  r cells (between
+0000fe20: 2030 2061 6e64 2039 292e 0a20 2020 2020   0 and 9)..     
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0000fe40: 6574 7469 6e67 2074 6f20 3020 7769 6c6c  etting to 0 will
+0000fe50: 2064 6973 6162 6c65 2063 656c 6c20 636f   disable cell co
+0000fe60: 6d70 7265 7373 696f 6e2c 2031 2067 6976  mpression, 1 giv
+0000fe70: 6573 2074 6865 2062 6573 7420 7370 6565  es the best spee
+0000fe80: 6420 616e 6420 392c 2074 6865 2062 6573  d and 9, the bes
+0000fe90: 7420 636f 6d70 7265 7373 696f 6e2e 0a20  t compression.. 
+0000fea0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000feb0: 6574 6563 745f 7265 6374 616e 676c 6573  etect_rectangles
+0000fec0: 3a20 5374 6f72 6520 7265 6374 616e 676c  : Store rectangl
+0000fed0: 6573 2069 6e20 636f 6d70 7265 7373 6564  es in compressed
+0000fee0: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
+0000fef0: 2020 2020 2020 2020 2064 6574 6563 745f           detect_
+0000ff00: 7472 6170 657a 6f69 6473 3a20 5374 6f72  trapezoids: Stor
+0000ff10: 6520 7472 6170 657a 6f69 6473 2069 6e20  e trapezoids in 
+0000ff20: 636f 6d70 7265 7373 6564 2066 6f72 6d61  compressed forma
+0000ff30: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
+0000ff40: 2020 2063 6972 636c 655f 746f 6c65 7261     circle_tolera
+0000ff50: 6e63 653a 2054 6f6c 6572 616e 6365 2066  nce: Tolerance f
+0000ff60: 6f72 2064 6574 6563 7469 6e67 2063 6972  or detecting cir
+0000ff70: 636c 6573 2e20 4966 206c 6573 7320 6f72  cles. If less or
+0000ff80: 2065 7175 616c 2074 6f20 302c 206e 6f20   equal to 0, no 
+0000ff90: 6465 7465 6374 696f 6e20 6973 2070 6572  detection is per
+0000ffa0: 666f 726d 6564 2e20 4369 7263 6c65 7320  formed. Circles 
+0000ffb0: 6172 6520 7374 6f72 6564 2069 6e20 636f  are stored in co
+0000ffc0: 6d70 7265 7373 6564 2066 6f72 6d61 742e  mpressed format.
+0000ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ffe0: 2076 616c 6964 6174 696f 6e20 2822 6372   validation ("cr
+0000fff0: 6333 3222 2c20 2263 6865 636b 7375 6d33  c32", "checksum3
+00010000: 3222 2c20 4e6f 6e65 293a 2074 7970 6520  2", None): type 
+00010010: 6f66 2076 616c 6964 6174 696f 6e20 746f  of validation to
+00010020: 2069 6e63 6c75 6465 2069 6e20 7468 6520   include in the 
+00010030: 7361 7665 6420 6669 6c65 2e0a 2020 2020  saved file..    
+00010040: 2020 2020 2020 2020 2020 2020 7374 616e              stan
+00010050: 6461 7264 5f70 726f 7065 7274 6965 733a  dard_properties:
+00010060: 2053 746f 7265 2073 7461 6e64 6172 6420   Store standard 
+00010070: 4f41 5349 5320 7072 6f70 6572 7469 6573  OASIS properties
+00010080: 2069 6e20 7468 6520 6669 6c65 2e0a 0a20   in the file... 
+00010090: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000100a0: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+000100b0: 6f72 792e 7064 6b20 696d 706f 7274 2067  ory.pdk import g
+000100c0: 6574 5f61 6374 6976 655f 7064 6b0a 0a20  et_active_pdk.. 
+000100d0: 2020 2020 2020 2069 6620 6764 7370 6174         if gdspat
+000100e0: 6820 616e 6420 6764 7364 6972 3a0a 2020  h and gdsdir:.  
+000100f0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00010100: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+00010110: 2020 2020 2020 2020 2022 6764 7370 6174           "gdspat
+00010120: 6820 616e 6420 6764 7364 6972 2068 6176  h and gdsdir hav
+00010130: 6520 626f 7468 2062 6565 6e20 7370 6563  e both been spec
+00010140: 6966 6965 642e 2067 6473 7061 7468 2077  ified. gdspath w
+00010150: 696c 6c20 7461 6b65 2070 7265 6365 6465  ill take precede
+00010160: 6e63 6520 616e 6420 6764 7364 6972 2077  nce and gdsdir w
+00010170: 696c 6c20 6265 2069 676e 6f72 6564 2e22  ill be ignored."
+00010180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010190: 2020 7374 6163 6b6c 6576 656c 3d33 2c0a    stacklevel=3,.
+000101a0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000101b0: 2020 2020 2020 2064 6566 6175 6c74 5f73         default_s
+000101c0: 6574 7469 6e67 7320 3d20 6765 745f 6163  ettings = get_ac
+000101d0: 7469 7665 5f70 646b 2829 2e67 6473 5f77  tive_pdk().gds_w
+000101e0: 7269 7465 5f73 6574 7469 6e67 730a 2020  rite_settings.  
+000101f0: 2020 2020 2020 6465 6661 756c 745f 6f61        default_oa
+00010200: 7369 735f 7365 7474 696e 6773 203d 2067  sis_settings = g
+00010210: 6574 5f61 6374 6976 655f 7064 6b28 292e  et_active_pdk().
+00010220: 6f61 7369 735f 7365 7474 696e 6773 0a0a  oasis_settings..
+00010230: 2020 2020 2020 2020 6578 706c 6963 6974          explicit
+00010240: 5f67 6473 5f73 6574 7469 6e67 7320 3d20  _gds_settings = 
+00010250: 7b0a 2020 2020 2020 2020 2020 2020 6b3a  {.            k:
+00010260: 2076 0a20 2020 2020 2020 2020 2020 2066   v.            f
+00010270: 6f72 206b 2c20 7620 696e 206b 7761 7267  or k, v in kwarg
+00010280: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
+00010290: 2020 2020 2020 6966 2076 2069 7320 6e6f        if v is no
+000102a0: 7420 4e6f 6e65 2061 6e64 206b 2069 6e20  t None and k in 
+000102b0: 6465 6661 756c 745f 7365 7474 696e 6773  default_settings
+000102c0: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
+000102d0: 7d0a 2020 2020 2020 2020 6578 706c 6963  }.        explic
+000102e0: 6974 5f6f 6173 5f73 6574 7469 6e67 7320  it_oas_settings 
+000102f0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00010300: 6b3a 2076 0a20 2020 2020 2020 2020 2020  k: v.           
+00010310: 2066 6f72 206b 2c20 7620 696e 206b 7761   for k, v in kwa
+00010320: 7267 732e 6974 656d 7328 290a 2020 2020  rgs.items().    
+00010330: 2020 2020 2020 2020 6966 2076 2069 7320          if v is 
+00010340: 6e6f 7420 4e6f 6e65 2061 6e64 206b 2069  not None and k i
+00010350: 6e20 6465 6661 756c 745f 6f61 7369 735f  n default_oasis_
+00010360: 7365 7474 696e 6773 2e64 6963 7428 290a  settings.dict().
+00010370: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00010380: 2020 2320 7570 6461 7465 2074 6865 2077    # update the w
+00010390: 7269 7465 2073 6574 7469 6e67 7320 7769  rite settings wi
+000103a0: 7468 2061 6e79 2073 6574 7469 6e67 7320  th any settings 
+000103b0: 6578 706c 6963 6974 6c79 2070 6173 7365  explicitly passe
+000103c0: 640a 2020 2020 2020 2020 7772 6974 655f  d.        write_
+000103d0: 7365 7474 696e 6773 203d 2064 6566 6175  settings = defau
+000103e0: 6c74 5f73 6574 7469 6e67 732e 636f 7079  lt_settings.copy
+000103f0: 2875 7064 6174 653d 6578 706c 6963 6974  (update=explicit
+00010400: 5f67 6473 5f73 6574 7469 6e67 7329 0a20  _gds_settings). 
+00010410: 2020 2020 2020 206f 6173 6973 5f73 6574         oasis_set
+00010420: 7469 6e67 7320 3d20 6465 6661 756c 745f  tings = default_
+00010430: 6f61 7369 735f 7365 7474 696e 6773 2e63  oasis_settings.c
+00010440: 6f70 7928 7570 6461 7465 3d65 7870 6c69  opy(update=expli
+00010450: 6369 745f 6f61 735f 7365 7474 696e 6773  cit_oas_settings
+00010460: 290a 0a20 2020 2020 2020 205f 6368 6563  )..        _chec
+00010470: 6b5f 756e 6361 6368 6564 5f63 6f6d 706f  k_uncached_compo
+00010480: 6e65 6e74 7328 0a20 2020 2020 2020 2020  nents(.         
+00010490: 2020 2063 6f6d 706f 6e65 6e74 3d73 656c     component=sel
+000104a0: 662c 206d 6f64 653d 7772 6974 655f 7365  f, mode=write_se
+000104b0: 7474 696e 6773 2e6f 6e5f 756e 6361 6368  ttings.on_uncach
+000104c0: 6564 5f63 6f6d 706f 6e65 6e74 0a20 2020  ed_component.   
+000104d0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000104e0: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
+000104f0: 732e 666c 6174 7465 6e5f 696e 7661 6c69  s.flatten_invali
+00010500: 645f 7265 6673 3a0a 2020 2020 2020 2020  d_refs:.        
+00010510: 2020 2020 746f 705f 6365 6c6c 203d 2066      top_cell = f
+00010520: 6c61 7474 656e 5f69 6e76 616c 6964 5f72  latten_invalid_r
+00010530: 6566 735f 7265 6375 7273 6976 6528 7365  efs_recursive(se
+00010540: 6c66 290a 2020 2020 2020 2020 656c 7365  lf).        else
+00010550: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
+00010560: 705f 6365 6c6c 203d 2073 656c 660a 0a20  p_cell = self.. 
+00010570: 2020 2020 2020 2067 6473 6469 7220 3d20         gdsdir = 
+00010580: 6764 7364 6972 206f 7220 4744 5344 4952  gdsdir or GDSDIR
+00010590: 5f54 454d 500a 2020 2020 2020 2020 6764  _TEMP.        gd
+000105a0: 7364 6972 203d 2070 6174 686c 6962 2e50  sdir = pathlib.P
+000105b0: 6174 6828 6764 7364 6972 290a 2020 2020  ath(gdsdir).    
+000105c0: 2020 2020 6966 2077 6974 685f 6f61 7369      if with_oasi
+000105d0: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
+000105e0: 6473 7061 7468 203d 2067 6473 7061 7468  dspath = gdspath
+000105f0: 206f 7220 6764 7364 6972 202f 2066 227b   or gdsdir / f"{
+00010600: 746f 705f 6365 6c6c 2e6e 616d 657d 2e6f  top_cell.name}.o
+00010610: 6173 220a 2020 2020 2020 2020 656c 7365  as".        else
+00010620: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
+00010630: 7370 6174 6820 3d20 6764 7370 6174 6820  spath = gdspath 
+00010640: 6f72 2067 6473 6469 7220 2f20 6622 7b74  or gdsdir / f"{t
+00010650: 6f70 5f63 656c 6c2e 6e61 6d65 7d2e 6764  op_cell.name}.gd
+00010660: 7322 0a20 2020 2020 2020 2067 6473 7061  s".        gdspa
+00010670: 7468 203d 2070 6174 686c 6962 2e50 6174  th = pathlib.Pat
+00010680: 6828 6764 7370 6174 6829 0a20 2020 2020  h(gdspath).     
+00010690: 2020 2067 6473 6469 7220 3d20 6764 7370     gdsdir = gdsp
+000106a0: 6174 682e 7061 7265 6e74 0a20 2020 2020  ath.parent.     
+000106b0: 2020 2067 6473 6469 722e 6d6b 6469 7228     gdsdir.mkdir(
+000106c0: 6578 6973 745f 6f6b 3d54 7275 652c 2070  exist_ok=True, p
+000106d0: 6172 656e 7473 3d54 7275 6529 0a0a 2020  arents=True)..  
+000106e0: 2020 2020 2020 6365 6c6c 7320 3d20 746f        cells = to
+000106f0: 705f 6365 6c6c 2e67 6574 5f64 6570 656e  p_cell.get_depen
+00010700: 6465 6e63 6965 7328 7265 6375 7273 6976  dencies(recursiv
+00010710: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00010720: 6365 6c6c 5f6e 616d 6573 203d 205b 6365  cell_names = [ce
+00010730: 6c6c 2e6e 616d 6520 666f 7220 6365 6c6c  ll.name for cell
+00010740: 2069 6e20 6c69 7374 2863 656c 6c73 295d   in list(cells)]
+00010750: 0a20 2020 2020 2020 2063 656c 6c5f 6e61  .        cell_na
+00010760: 6d65 735f 756e 6971 7565 203d 2073 6574  mes_unique = set
+00010770: 2863 656c 6c5f 6e61 6d65 7329 0a0a 2020  (cell_names)..  
+00010780: 2020 2020 2020 6966 206c 656e 2863 656c        if len(cel
+00010790: 6c5f 6e61 6d65 7329 2021 3d20 6c65 6e28  l_names) != len(
+000107a0: 7365 7428 6365 6c6c 5f6e 616d 6573 2929  set(cell_names))
+000107b0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+000107c0: 7220 6365 6c6c 5f6e 616d 6520 696e 2063  r cell_name in c
+000107d0: 656c 6c5f 6e61 6d65 735f 756e 6971 7565  ell_names_unique
+000107e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000107f0: 2020 6365 6c6c 5f6e 616d 6573 2e72 656d    cell_names.rem
+00010800: 6f76 6528 6365 6c6c 5f6e 616d 6529 0a0a  ove(cell_name)..
+00010810: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00010820: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
+00010830: 5f64 7570 6c69 6361 7465 5f63 656c 6c20  _duplicate_cell 
+00010840: 3d3d 2022 6572 726f 7222 3a0a 2020 2020  == "error":.    
+00010850: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00010860: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010880: 2020 6622 4475 706c 6963 6174 6564 2063    f"Duplicated c
+00010890: 656c 6c20 6e61 6d65 7320 696e 207b 746f  ell names in {to
+000108a0: 705f 6365 6c6c 2e6e 616d 6521 727d 3a20  p_cell.name!r}: 
+000108b0: 7b63 656c 6c5f 6e61 6d65 7321 727d 220a  {cell_names!r}".
+000108c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000108d0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000108e0: 6966 2077 7269 7465 5f73 6574 7469 6e67  if write_setting
+000108f0: 732e 6f6e 5f64 7570 6c69 6361 7465 5f63  s.on_duplicate_c
+00010900: 656c 6c20 696e 207b 2277 6172 6e22 2c20  ell in {"warn", 
+00010910: 226f 7665 7277 7269 7465 227d 3a0a 2020  "overwrite"}:.  
+00010920: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010930: 2077 7269 7465 5f73 6574 7469 6e67 732e   write_settings.
+00010940: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
+00010950: 6c20 3d3d 2022 7761 726e 223a 0a20 2020  l == "warn":.   
 00010960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010970: 2020 7374 6163 6b6c 6576 656c 3d33 2c0a    stacklevel=3,.
+00010970: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
 00010980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010990: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000109a0: 2020 2020 2020 6365 6c6c 735f 6469 6374        cells_dict
-000109b0: 203d 207b 6365 6c6c 2e6e 616d 653a 2063   = {cell.name: c
-000109c0: 656c 6c2e 5f63 656c 6c20 666f 7220 6365  ell._cell for ce
-000109d0: 6c6c 2069 6e20 6365 6c6c 737d 0a20 2020  ll in cells}.   
-000109e0: 2020 2020 2020 2020 2020 2020 2063 656c               cel
-000109f0: 6c73 203d 2063 656c 6c73 5f64 6963 742e  ls = cells_dict.
-00010a00: 7661 6c75 6573 2829 0a20 2020 2020 2020  values().       
-00010a10: 2020 2020 2065 6c69 6620 7772 6974 655f       elif write_
-00010a20: 7365 7474 696e 6773 2e6f 6e5f 6475 706c  settings.on_dupl
-00010a30: 6963 6174 655f 6365 6c6c 2069 7320 6e6f  icate_cell is no
-00010a40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00010a50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00010a60: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00010a70: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00010a80: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
-00010a90: 6c3a 207b 7772 6974 655f 7365 7474 696e  l: {write_settin
-00010aa0: 6773 2e6f 6e5f 6475 706c 6963 6174 655f  gs.on_duplicate_
-00010ab0: 6365 6c6c 2172 7d20 6e6f 7420 696e 2028  cell!r} not in (
-00010ac0: 4e6f 6e65 2c20 7761 726e 2c20 6572 726f  None, warn, erro
-00010ad0: 722c 206f 7665 7277 7269 7465 2922 0a20  r, overwrite)". 
-00010ae0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00010af0: 0a0a 2020 2020 2020 2020 616c 6c5f 6365  ..        all_ce
-00010b00: 6c6c 7320 3d20 5b74 6f70 5f63 656c 6c2e  lls = [top_cell.
-00010b10: 5f63 656c 6c5d 202b 2073 6f72 7465 6428  _cell] + sorted(
-00010b20: 6365 6c6c 732c 206b 6579 3d6c 616d 6264  cells, key=lambd
-00010b30: 6120 6363 3a20 6363 2e6e 616d 6529 0a0a  a cc: cc.name)..
-00010b40: 2020 2020 2020 2020 6e6f 5f6e 616d 655f          no_name_
-00010b50: 6365 6c6c 7320 3d20 5b0a 2020 2020 2020  cells = [.      
-00010b60: 2020 2020 2020 6365 6c6c 2e6e 616d 6520        cell.name 
-00010b70: 666f 7220 6365 6c6c 2069 6e20 616c 6c5f  for cell in all_
-00010b80: 6365 6c6c 7320 6966 2063 656c 6c2e 6e61  cells if cell.na
-00010b90: 6d65 2e73 7461 7274 7377 6974 6828 2255  me.startswith("U
-00010ba0: 6e6e 616d 6564 2229 0a20 2020 2020 2020  nnamed").       
-00010bb0: 205d 0a0a 2020 2020 2020 2020 6966 206e   ]..        if n
-00010bc0: 6f5f 6e61 6d65 5f63 656c 6c73 3a0a 2020  o_name_cells:.  
-00010bd0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00010be0: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-00010bf0: 2020 2020 2020 2020 2066 2243 6f6d 706f           f"Compo
-00010c00: 6e65 6e74 207b 746f 705f 6365 6c6c 2e6e  nent {top_cell.n
-00010c10: 616d 6521 727d 2063 6f6e 7461 696e 7320  ame!r} contains 
-00010c20: 7b6c 656e 286e 6f5f 6e61 6d65 5f63 656c  {len(no_name_cel
-00010c30: 6c73 297d 2055 6e6e 616d 6564 2063 656c  ls)} Unnamed cel
-00010c40: 6c73 222c 0a20 2020 2020 2020 2020 2020  ls",.           
-00010c50: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
-00010c60: 332c 0a20 2020 2020 2020 2020 2020 2029  3,.            )
-00010c70: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
-00010c80: 6365 6c6c 2069 6e20 616c 6c5f 6365 6c6c  cell in all_cell
-00010c90: 733a 0a20 2020 2020 2020 2023 2020 2020  s:.        #    
-00010ca0: 2070 7269 6e74 2863 656c 6c2e 6e61 6d65   print(cell.name
-00010cb0: 2c20 7479 7065 2863 656c 6c29 290a 0a20  , type(cell)).. 
-00010cc0: 2020 2020 2020 206c 6962 203d 2067 6473         lib = gds
-00010cd0: 746b 2e4c 6962 7261 7279 280a 2020 2020  tk.Library(.    
-00010ce0: 2020 2020 2020 2020 6e61 6d65 3d77 7269          name=wri
-00010cf0: 7465 5f73 6574 7469 6e67 732e 6c69 625f  te_settings.lib_
-00010d00: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00010d10: 2020 756e 6974 3d77 7269 7465 5f73 6574    unit=write_set
-00010d20: 7469 6e67 732e 756e 6974 2c0a 2020 2020  tings.unit,.    
-00010d30: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-00010d40: 6e3d 7772 6974 655f 7365 7474 696e 6773  n=write_settings
-00010d50: 2e70 7265 6369 7369 6f6e 2c0a 2020 2020  .precision,.    
-00010d60: 2020 2020 290a 2020 2020 2020 2020 6c69      ).        li
-00010d70: 622e 6164 6428 746f 705f 6365 6c6c 2e5f  b.add(top_cell._
-00010d80: 6365 6c6c 290a 2020 2020 2020 2020 6c69  cell).        li
-00010d90: 622e 6164 6428 2a74 6f70 5f63 656c 6c2e  b.add(*top_cell.
-00010da0: 5f63 656c 6c2e 6465 7065 6e64 656e 6369  _cell.dependenci
-00010db0: 6573 2854 7275 6529 290a 0a20 2020 2020  es(True))..     
-00010dc0: 2020 2069 6620 7769 7468 5f6f 6173 6973     if with_oasis
-00010dd0: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-00010de0: 622e 7772 6974 655f 6f61 7328 6764 7370  b.write_oas(gdsp
-00010df0: 6174 682c 202a 2a6f 6173 6973 5f73 6574  ath, **oasis_set
-00010e00: 7469 6e67 732e 6469 6374 2829 290a 2020  tings.dict()).  
-00010e10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010e20: 2020 2020 2020 2020 6c69 622e 7772 6974          lib.writ
-00010e30: 655f 6764 7328 0a20 2020 2020 2020 2020  e_gds(.         
-00010e40: 2020 2020 2020 2067 6473 7061 7468 2c20         gdspath, 
-00010e50: 7469 6d65 7374 616d 703d 7469 6d65 7374  timestamp=timest
-00010e60: 616d 702c 206d 6178 5f70 6f69 6e74 733d  amp, max_points=
-00010e70: 7772 6974 655f 7365 7474 696e 6773 2e6d  write_settings.m
-00010e80: 6178 5f70 6f69 6e74 730a 2020 2020 2020  ax_points.      
-00010e90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00010ea0: 6966 206c 6f67 6769 6e67 3a0a 2020 2020  if logging:.    
-00010eb0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-00010ec0: 6e66 6f28 6622 5772 6f74 6520 746f 207b  nfo(f"Wrote to {
-00010ed0: 7374 7228 6764 7370 6174 6829 2172 7d22  str(gdspath)!r}"
-00010ee0: 290a 2020 2020 2020 2020 6966 2077 6974  ).        if wit
-00010ef0: 685f 6d65 7461 6461 7461 3a0a 2020 2020  h_metadata:.    
-00010f00: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
-00010f10: 203d 2067 6473 7061 7468 2e77 6974 685f   = gdspath.with_
-00010f20: 7375 6666 6978 2822 2e79 6d6c 2229 0a20  suffix(".yml"). 
-00010f30: 2020 2020 2020 2020 2020 206d 6574 6164             metad
-00010f40: 6174 612e 7772 6974 655f 7465 7874 2873  ata.write_text(s
-00010f50: 656c 662e 746f 5f79 616d 6c28 7769 7468  elf.to_yaml(with
-00010f60: 5f63 656c 6c73 3d54 7275 652c 2077 6974  _cells=True, wit
-00010f70: 685f 706f 7274 733d 5472 7565 2929 0a20  h_ports=True)). 
-00010f80: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00010f90: 722e 696e 666f 2866 2257 7269 7465 2059  r.info(f"Write Y
-00010fa0: 414d 4c20 6d65 7461 6461 7461 2074 6f20  AML metadata to 
-00010fb0: 7b73 7472 286d 6574 6164 6174 6129 2172  {str(metadata)!r
-00010fc0: 7d22 290a 0a20 2020 2020 2020 2043 4f4e  }")..        CON
-00010fd0: 462e 6c61 7374 5f73 6176 6564 5f66 696c  F.last_saved_fil
-00010fe0: 6573 2e61 7070 656e 6428 6764 7370 6174  es.append(gdspat
-00010ff0: 6829 0a20 2020 2020 2020 2072 6574 7572  h).        retur
-00011000: 6e20 6764 7370 6174 680a 0a20 2020 2064  n gdspath..    d
-00011010: 6566 2077 7269 7465 5f67 6473 280a 2020  ef write_gds(.  
-00011020: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00011030: 2020 2020 6764 7370 6174 683a 2050 6174      gdspath: Pat
-00011040: 6854 7970 6520 7c20 4e6f 6e65 203d 204e  hType | None = N
-00011050: 6f6e 652c 0a20 2020 2020 2020 2067 6473  one,.        gds
-00011060: 6469 723a 2050 6174 6854 7970 6520 7c20  dir: PathType | 
-00011070: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00011080: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-00011090: 2020 2029 202d 3e20 5061 7468 3a0a 2020     ) -> Path:.  
-000110a0: 2020 2020 2020 2222 2257 7269 7465 2063        """Write c
-000110b0: 6f6d 706f 6e65 6e74 2074 6f20 4744 5320  omponent to GDS 
-000110c0: 616e 6420 7265 7475 726e 7320 6764 7370  and returns gdsp
-000110d0: 6174 682e 0a0a 2020 2020 2020 2020 4172  ath...        Ar
-000110e0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-000110f0: 6764 7370 6174 683a 2047 4453 2066 696c  gdspath: GDS fil
-00011100: 6520 7061 7468 2074 6f20 7772 6974 6520  e path to write 
-00011110: 746f 2e0a 2020 2020 2020 2020 2020 2020  to..            
-00011120: 6764 7364 6972 3a20 6469 7265 6374 6f72  gdsdir: director
-00011130: 7920 666f 7220 7468 6520 4744 5320 6669  y for the GDS fi
-00011140: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
-00011150: 2f74 6d70 2f72 616e 646f 6d46 696c 652f  /tmp/randomFile/
-00011160: 6764 7366 6163 746f 7279 2e0a 0a20 2020  gdsfactory...   
-00011170: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-00011180: 733a 0a20 2020 2020 2020 2020 2020 2075  s:.            u
-00011190: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
-000111a0: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
-000111b0: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
-000111c0: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
-000111d0: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
-000111e0: 7220 6469 6d65 6e73 696f 6e73 2069 6e20  r dimensions in 
-000111f0: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
-00011200: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
-00011210: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00011220: 6769 6e67 3a20 6469 7361 626c 6520 4744  ging: disable GD
-00011230: 5320 7061 7468 206c 6f67 6769 6e67 2c20  S path logging, 
-00011240: 666f 7220 6578 616d 706c 6520 666f 7220  for example for 
-00011250: 7368 6f77 696e 6720 6974 2069 6e20 4b4c  showing it in KL
-00011260: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
-00011270: 2020 206f 6e5f 6475 706c 6963 6174 655f     on_duplicate_
-00011280: 6365 6c6c 3a20 7370 6563 6966 7920 686f  cell: specify ho
-00011290: 7720 746f 2072 6573 6f6c 7665 2064 7570  w to resolve dup
-000112a0: 6c69 6361 7465 2d6e 616d 6564 2063 656c  licate-named cel
-000112b0: 6c73 2e20 4368 6f6f 7365 206f 6e65 206f  ls. Choose one o
-000112c0: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
-000112d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000112e0: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
-000112f0: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
-00011300: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-00011310: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
-00011320: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
-00011330: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
-00011340: 2020 2020 2020 2020 2020 2022 6572 726f             "erro
-00011350: 7222 3a20 7468 726f 7720 6120 5661 6c75  r": throw a Valu
-00011360: 6545 7272 6f72 2077 6865 6e20 6174 7465  eError when atte
-00011370: 6d70 7469 6e67 2074 6f20 7772 6974 6520  mpting to write 
-00011380: 6120 6764 7320 7769 7468 2064 7570 6c69  a gds with dupli
-00011390: 6361 7465 2063 656c 6c73 2e0a 2020 2020  cate cells..    
-000113a0: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
-000113b0: 7277 7269 7465 223a 206f 7665 7277 7269  rwrite": overwri
-000113c0: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
-000113d0: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
-000113e0: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
-000113f0: 732c 2077 6974 686f 7574 2077 6172 6e69  s, without warni
-00011400: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
-00011410: 6f6e 5f75 6e63 6163 6865 645f 636f 6d70  on_uncached_comp
-00011420: 6f6e 656e 743a 204c 6974 6572 616c 5b22  onent: Literal["
-00011430: 7761 726e 222c 2022 6572 726f 7222 5d20  warn", "error"] 
-00011440: 3d20 2277 6172 6e22 0a20 2020 2020 2020  = "warn".       
-00011450: 2020 2020 2066 6c61 7474 656e 5f69 6e76       flatten_inv
-00011460: 616c 6964 5f72 6566 733a 2066 6c61 7474  alid_refs: flatt
-00011470: 656e 7320 636f 6d70 6f6e 656e 7420 7265  ens component re
-00011480: 6665 7265 6e63 6573 2077 6869 6368 2068  ferences which h
-00011490: 6176 6520 696e 7661 6c69 6420 7472 616e  ave invalid tran
-000114a0: 7366 6f72 6d61 7469 6f6e 732e 0a20 2020  sformations..   
-000114b0: 2020 2020 2020 2020 206d 6178 5f70 6f69           max_poi
-000114c0: 6e74 733a 204d 6178 696d 616c 206e 756d  nts: Maximal num
-000114d0: 6265 7220 6f66 2076 6572 7469 6365 7320  ber of vertices 
-000114e0: 7065 7220 706f 6c79 676f 6e2e 0a20 2020  per polygon..   
-000114f0: 2020 2020 2020 2020 2020 2020 2050 6f6c               Pol
-00011500: 7967 6f6e 7320 7769 7468 206d 6f72 6520  ygons with more 
-00011510: 7665 7274 6963 6573 2074 6861 7420 7468  vertices that th
-00011520: 6973 2061 7265 2061 7574 6f6d 6174 6963  is are automatic
-00011530: 616c 6c79 2066 7261 6374 7572 6564 2e0a  ally fractured..
-00011540: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00011550: 5f6d 6574 6164 6174 613a 2077 7269 7465  _metadata: write
-00011560: 7320 6d65 7461 6461 7461 2069 6e20 5941  s metadata in YA
-00011570: 4d4c 2066 6f72 6d61 742e 0a20 2020 2020  ML format..     
-00011580: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00011590: 7265 7475 726e 2073 656c 662e 5f77 7269  return self._wri
-000115a0: 7465 5f6c 6962 7261 7279 280a 2020 2020  te_library(.    
-000115b0: 2020 2020 2020 2020 6764 7370 6174 683d          gdspath=
-000115c0: 6764 7370 6174 682c 2067 6473 6469 723d  gdspath, gdsdir=
-000115d0: 6764 7364 6972 2c20 7769 7468 5f6f 6173  gdsdir, with_oas
-000115e0: 6973 3d46 616c 7365 2c20 2a2a 6b77 6172  is=False, **kwar
-000115f0: 6773 0a20 2020 2020 2020 2029 0a0a 2020  gs.        )..  
-00011600: 2020 6465 6620 7772 6974 655f 6f61 7328    def write_oas(
-00011610: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00011620: 2020 2020 2020 2067 6473 7061 7468 3a20         gdspath: 
-00011630: 5061 7468 5479 7065 207c 204e 6f6e 6520  PathType | None 
-00011640: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00011650: 6764 7364 6972 3a20 5061 7468 5479 7065  gdsdir: PathType
-00011660: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00011670: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00011680: 2c0a 2020 2020 2920 2d3e 2050 6174 683a  ,.    ) -> Path:
-00011690: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
-000116a0: 6520 636f 6d70 6f6e 656e 7420 746f 2047  e component to G
-000116b0: 4453 2061 6e64 2072 6574 7572 6e73 2067  DS and returns g
-000116c0: 6473 7061 7468 2e0a 0a20 2020 2020 2020  dspath...       
-000116d0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-000116e0: 2020 2067 6473 7061 7468 3a20 4744 5320     gdspath: GDS 
-000116f0: 6669 6c65 2070 6174 6820 746f 2077 7269  file path to wri
-00011700: 7465 2074 6f2e 0a20 2020 2020 2020 2020  te to..         
-00011710: 2020 2067 6473 6469 723a 2064 6972 6563     gdsdir: direc
-00011720: 746f 7279 2066 6f72 2074 6865 2047 4453  tory for the GDS
-00011730: 2066 696c 652e 2044 6566 6175 6c74 7320   file. Defaults 
-00011740: 746f 202f 746d 702f 7261 6e64 6f6d 4669  to /tmp/randomFi
-00011750: 6c65 2f67 6473 6661 6374 6f72 792e 0a0a  le/gdsfactory...
-00011760: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00011770: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00011780: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
-00011790: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
-000117a0: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
-000117b0: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-000117c0: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
-000117d0: 2066 6f72 2064 696d 656e 7369 6f6e 7320   for dimensions 
-000117e0: 696e 2074 6865 206c 6962 7261 7279 2028  in the library (
-000117f0: 6d29 2e20 316e 6d20 6279 2064 6566 6175  m). 1nm by defau
-00011800: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
-00011810: 6c6f 6767 696e 673a 2064 6973 6162 6c65  logging: disable
-00011820: 2047 4453 2070 6174 6820 6c6f 6767 696e   GDS path loggin
-00011830: 672c 2066 6f72 2065 7861 6d70 6c65 2066  g, for example f
-00011840: 6f72 2073 686f 7769 6e67 2069 7420 696e  or showing it in
-00011850: 204b 4c61 796f 7574 2e0a 2020 2020 2020   KLayout..      
-00011860: 2020 2020 2020 6f6e 5f64 7570 6c69 6361        on_duplica
-00011870: 7465 5f63 656c 6c3a 2073 7065 6369 6679  te_cell: specify
-00011880: 2068 6f77 2074 6f20 7265 736f 6c76 6520   how to resolve 
-00011890: 6475 706c 6963 6174 652d 6e61 6d65 6420  duplicate-named 
-000118a0: 6365 6c6c 732e 2043 686f 6f73 6520 6f6e  cells. Choose on
-000118b0: 6520 6f66 2074 6865 2066 6f6c 6c6f 7769  e of the followi
-000118c0: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-000118d0: 2020 2020 2277 6172 6e22 2028 6465 6661      "warn" (defa
-000118e0: 756c 7429 3a20 6f76 6572 7772 6974 6520  ult): overwrite 
-000118f0: 616c 6c20 6475 706c 6963 6174 6520 6365  all duplicate ce
-00011900: 6c6c 7320 7769 7468 206f 6e65 206f 6620  lls with one of 
-00011910: 7468 6520 6475 706c 6963 6174 6573 2028  the duplicates (
-00011920: 6172 6269 7472 6172 696c 7929 2e0a 2020  arbitrarily)..  
-00011930: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-00011940: 7272 6f72 223a 2074 6872 6f77 2061 2056  rror": throw a V
-00011950: 616c 7565 4572 726f 7220 7768 656e 2061  alueError when a
-00011960: 7474 656d 7074 696e 6720 746f 2077 7269  ttempting to wri
-00011970: 7465 2061 2067 6473 2077 6974 6820 6475  te a gds with du
-00011980: 706c 6963 6174 6520 6365 6c6c 732e 0a20  plicate cells.. 
-00011990: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000119a0: 6f76 6572 7772 6974 6522 3a20 6f76 6572  overwrite": over
-000119b0: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
-000119c0: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
-000119d0: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
-000119e0: 6174 6573 2c20 7769 7468 6f75 7420 7761  ates, without wa
-000119f0: 726e 696e 672e 0a20 2020 2020 2020 2020  rning..         
-00011a00: 2020 2020 2020 204e 6f6e 653a 2064 6f20         None: do 
-00011a10: 6e6f 7420 7472 7920 746f 2072 6573 6f6c  not try to resol
-00011a20: 7665 2028 6174 2079 6f75 7220 6f77 6e20  ve (at your own 
-00011a30: 7269 736b 2129 0a20 2020 2020 2020 2020  risk!).         
-00011a40: 2020 206f 6e5f 756e 6361 6368 6564 5f63     on_uncached_c
-00011a50: 6f6d 706f 6e65 6e74 3a20 4c69 7465 7261  omponent: Litera
-00011a60: 6c5b 2277 6172 6e22 2c20 2265 7272 6f72  l["warn", "error
-00011a70: 225d 203d 2022 7761 726e 220a 2020 2020  "] = "warn".    
-00011a80: 2020 2020 2020 2020 666c 6174 7465 6e5f          flatten_
-00011a90: 696e 7661 6c69 645f 7265 6673 3a20 666c  invalid_refs: fl
-00011aa0: 6174 7465 6e73 2063 6f6d 706f 6e65 6e74  attens component
-00011ab0: 2072 6566 6572 656e 6365 7320 7768 6963   references whic
-00011ac0: 6820 6861 7665 2069 6e76 616c 6964 2074  h have invalid t
-00011ad0: 7261 6e73 666f 726d 6174 696f 6e73 2e0a  ransformations..
-00011ae0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00011af0: 7265 7373 696f 6e5f 6c65 7665 6c3a 204c  ression_level: L
-00011b00: 6576 656c 206f 6620 636f 6d70 7265 7373  evel of compress
-00011b10: 696f 6e20 666f 7220 6365 6c6c 7320 2862  ion for cells (b
-00011b20: 6574 7765 656e 2030 2061 6e64 2039 292e  etween 0 and 9).
-00011b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b40: 2053 6574 7469 6e67 2074 6f20 3020 7769   Setting to 0 wi
-00011b50: 6c6c 2064 6973 6162 6c65 2063 656c 6c20  ll disable cell 
-00011b60: 636f 6d70 7265 7373 696f 6e2c 2031 2067  compression, 1 g
-00011b70: 6976 6573 2074 6865 2062 6573 7420 7370  ives the best sp
-00011b80: 6565 6420 616e 6420 392c 2074 6865 2062  eed and 9, the b
-00011b90: 6573 7420 636f 6d70 7265 7373 696f 6e2e  est compression.
-00011ba0: 0a20 2020 2020 2020 2020 2020 2064 6574  .            det
-00011bb0: 6563 745f 7265 6374 616e 676c 6573 3a20  ect_rectangles: 
-00011bc0: 5374 6f72 6520 7265 6374 616e 676c 6573  Store rectangles
-00011bd0: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-00011be0: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-00011bf0: 2020 2064 6574 6563 745f 7472 6170 657a     detect_trapez
-00011c00: 6f69 6473 3a20 5374 6f72 6520 7472 6170  oids: Store trap
-00011c10: 657a 6f69 6473 2069 6e20 636f 6d70 7265  ezoids in compre
-00011c20: 7373 6564 2066 6f72 6d61 742e 0a20 2020  ssed format..   
-00011c30: 2020 2020 2020 2020 2063 6972 636c 655f           circle_
-00011c40: 746f 6c65 7261 6e63 653a 2054 6f6c 6572  tolerance: Toler
-00011c50: 616e 6365 2066 6f72 2064 6574 6563 7469  ance for detecti
-00011c60: 6e67 2063 6972 636c 6573 2e20 4966 206c  ng circles. If l
-00011c70: 6573 7320 6f72 2065 7175 616c 2074 6f20  ess or equal to 
-00011c80: 302c 206e 6f20 6465 7465 6374 696f 6e20  0, no detection 
-00011c90: 6973 2070 6572 666f 726d 6564 2e0a 2020  is performed..  
-00011ca0: 2020 2020 2020 2020 2020 2020 2020 4369                Ci
-00011cb0: 7263 6c65 7320 6172 6520 7374 6f72 6564  rcles are stored
-00011cc0: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-00011cd0: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-00011ce0: 2020 2076 616c 6964 6174 696f 6e20 2822     validation ("
-00011cf0: 6372 6333 3222 2c20 2263 6865 636b 7375  crc32", "checksu
-00011d00: 6d33 3222 2c20 4e6f 6e65 2920 e280 9320  m32", None) ... 
-00011d10: 7479 7065 206f 6620 7661 6c69 6461 7469  type of validati
-00011d20: 6f6e 2074 6f20 696e 636c 7564 6520 696e  on to include in
-00011d30: 2074 6865 2073 6176 6564 2066 696c 652e   the saved file.
-00011d40: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00011d50: 6e64 6172 645f 7072 6f70 6572 7469 6573  ndard_properties
-00011d60: 3a20 5374 6f72 6520 7374 616e 6461 7264  : Store standard
-00011d70: 204f 4153 4953 2070 726f 7065 7274 6965   OASIS propertie
-00011d80: 7320 696e 2074 6865 2066 696c 652e 0a20  s in the file.. 
-00011d90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011da0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00011db0: 7772 6974 655f 6c69 6272 6172 7928 0a20  write_library(. 
-00011dc0: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
-00011dd0: 7468 3d67 6473 7061 7468 2c0a 2020 2020  th=gdspath,.    
-00011de0: 2020 2020 2020 2020 6764 7364 6972 3d67          gdsdir=g
-00011df0: 6473 6469 722c 0a20 2020 2020 2020 2020  dsdir,.         
-00011e00: 2020 2077 6974 685f 6f61 7369 733d 5472     with_oasis=Tr
-00011e10: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00011e20: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-00011e30: 2020 290a 0a20 2020 2064 6566 2077 7269    )..    def wri
-00011e40: 7465 5f67 6473 5f77 6974 685f 6d65 7461  te_gds_with_meta
-00011e50: 6461 7461 2873 656c 662c 202a 6172 6773  data(self, *args
-00011e60: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2050  , **kwargs) -> P
-00011e70: 6174 683a 0a20 2020 2020 2020 2022 2222  ath:.        """
-00011e80: 5772 6974 6520 636f 6d70 6f6e 656e 7420  Write component 
-00011e90: 696e 2047 4453 2061 6e64 206d 6574 6164  in GDS and metad
-00011ea0: 6174 6120 2863 6f6d 706f 6e65 6e74 2073  ata (component s
-00011eb0: 6574 7469 6e67 7329 2069 6e20 5941 4d4c  ettings) in YAML
-00011ec0: 2e22 2222 0a20 2020 2020 2020 2077 6172  .""".        war
-00011ed0: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
-00011ee0: 2020 2020 2020 2020 2243 6f6d 706f 6e65          "Compone
-00011ef0: 6e74 2e77 7269 7465 5f67 6473 5f77 6974  nt.write_gds_wit
-00011f00: 685f 6d65 7461 6461 7461 2829 2069 7320  h_metadata() is 
-00011f10: 6465 7072 6563 6174 6564 2e20 220a 2020  deprecated. ".  
-00011f20: 2020 2020 2020 2020 2020 2255 7365 2043            "Use C
-00011f30: 6f6d 706f 6e65 6e74 2e77 7269 7465 5f67  omponent.write_g
-00011f40: 6473 2877 6974 685f 6d65 7461 6461 7461  ds(with_metadata
-00011f50: 3d54 7275 6529 206f 7220 436f 6d70 6f6e  =True) or Compon
-00011f60: 656e 742e 7772 6974 655f 6f61 7328 7769  ent.write_oas(wi
-00011f70: 7468 5f6d 6574 6164 6174 613d 5472 7565  th_metadata=True
-00011f80: 292e 222c 0a20 2020 2020 2020 2020 2020  ).",.           
-00011f90: 2073 7461 636b 6c65 7665 6c3d 332c 0a20   stacklevel=3,. 
-00011fa0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00011fb0: 2067 6473 7061 7468 203d 2073 656c 662e   gdspath = self.
-00011fc0: 7772 6974 655f 6764 7328 2a61 7267 732c  write_gds(*args,
-00011fd0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00011fe0: 2020 206d 6574 6164 6174 6120 3d20 6764     metadata = gd
-00011ff0: 7370 6174 682e 7769 7468 5f73 7566 6669  spath.with_suffi
-00012000: 7828 222e 796d 6c22 290a 2020 2020 2020  x(".yml").      
-00012010: 2020 6d65 7461 6461 7461 2e77 7269 7465    metadata.write
-00012020: 5f74 6578 7428 7365 6c66 2e74 6f5f 7961  _text(self.to_ya
-00012030: 6d6c 2877 6974 685f 6365 6c6c 733d 5472  ml(with_cells=Tr
-00012040: 7565 2c20 7769 7468 5f70 6f72 7473 3d54  ue, with_ports=T
-00012050: 7275 6529 290a 2020 2020 2020 2020 6c6f  rue)).        lo
-00012060: 6767 6572 2e69 6e66 6f28 6622 5772 6974  gger.info(f"Writ
-00012070: 6520 5941 4d4c 206d 6574 6164 6174 6120  e YAML metadata 
-00012080: 746f 207b 7374 7228 6d65 7461 6461 7461  to {str(metadata
-00012090: 2921 727d 2229 0a20 2020 2020 2020 2072  )!r}").        r
-000120a0: 6574 7572 6e20 6764 7370 6174 680a 0a20  eturn gdspath.. 
-000120b0: 2020 2064 6566 2074 6f5f 6469 6374 280a     def to_dict(.
-000120c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000120d0: 2020 2020 2020 6967 6e6f 7265 5f63 6f6d        ignore_com
-000120e0: 706f 6e65 6e74 735f 7072 6566 6978 3a20  ponents_prefix: 
-000120f0: 6c69 7374 5b73 7472 5d20 7c20 4e6f 6e65  list[str] | None
-00012100: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00012110: 2069 676e 6f72 655f 6675 6e63 7469 6f6e   ignore_function
-00012120: 735f 7072 6566 6978 3a20 6c69 7374 5b73  s_prefix: list[s
-00012130: 7472 5d20 7c20 4e6f 6e65 203d 204e 6f6e  tr] | None = Non
-00012140: 652c 0a20 2020 2020 2020 2077 6974 685f  e,.        with_
-00012150: 6365 6c6c 733a 2062 6f6f 6c20 3d20 4661  cells: bool = Fa
-00012160: 6c73 652c 0a20 2020 2020 2020 2077 6974  lse,.        wit
-00012170: 685f 706f 7274 733a 2062 6f6f 6c20 3d20  h_ports: bool = 
-00012180: 5472 7565 2c0a 2020 2020 2920 2d3e 2064  True,.    ) -> d
-00012190: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-000121a0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-000121b0: 7320 4469 6374 2072 6570 7265 7365 6e74  s Dict represent
-000121c0: 6174 696f 6e20 6f66 2061 2063 6f6d 706f  ation of a compo
-000121d0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-000121e0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000121f0: 2069 676e 6f72 655f 636f 6d70 6f6e 656e   ignore_componen
-00012200: 7473 5f70 7265 6669 783a 2066 6f72 2063  ts_prefix: for c
-00012210: 6f6d 706f 6e65 6e74 7320 746f 2069 676e  omponents to ign
-00012220: 6f72 6520 7768 656e 2065 7870 6f72 7469  ore when exporti
-00012230: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
-00012240: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-00012250: 5f70 7265 6669 783a 2066 6f72 2066 756e  _prefix: for fun
-00012260: 6374 696f 6e73 2074 6f20 6967 6e6f 7265  ctions to ignore
-00012270: 2077 6865 6e20 6578 706f 7274 696e 672e   when exporting.
-00012280: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00012290: 685f 6365 6c6c 733a 2077 7269 7465 2063  h_cells: write c
-000122a0: 656c 6c73 2072 6563 7572 7369 7665 6c79  ells recursively
-000122b0: 2e0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
-000122c0: 7468 5f70 6f72 7473 3a20 7772 6974 6520  th_ports: write 
-000122d0: 706f 7274 2069 6e66 6f72 6d61 7469 6f6e  port information
-000122e0: 2064 6963 742e 0a20 2020 2020 2020 2022   dict..        "
-000122f0: 2222 0a20 2020 2020 2020 2064 203d 207b  "".        d = {
-00012300: 7d0a 2020 2020 2020 2020 6966 2077 6974  }.        if wit
-00012310: 685f 706f 7274 733a 0a20 2020 2020 2020  h_ports:.       
-00012320: 2020 2020 2070 6f72 7473 203d 207b 706f       ports = {po
-00012330: 7274 2e6e 616d 653a 2070 6f72 742e 746f  rt.name: port.to
-00012340: 5f64 6963 7428 2920 666f 7220 706f 7274  _dict() for port
-00012350: 2069 6e20 7365 6c66 2e67 6574 5f70 6f72   in self.get_por
-00012360: 7473 5f6c 6973 7428 297d 0a20 2020 2020  ts_list()}.     
-00012370: 2020 2020 2020 2064 5b22 706f 7274 7322         d["ports"
-00012380: 5d20 3d20 706f 7274 730a 0a20 2020 2020  ] = ports..     
-00012390: 2020 2069 6620 7769 7468 5f63 656c 6c73     if with_cells
-000123a0: 3a0a 2020 2020 2020 2020 2020 2020 6365  :.            ce
-000123b0: 6c6c 7320 3d20 7265 6375 7273 655f 7374  lls = recurse_st
-000123c0: 7275 6374 7572 6573 280a 2020 2020 2020  ructures(.      
-000123d0: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-000123e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123f0: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-00012400: 5f70 7265 6669 783d 6967 6e6f 7265 5f66  _prefix=ignore_f
-00012410: 756e 6374 696f 6e73 5f70 7265 6669 782c  unctions_prefix,
-00012420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012430: 2069 676e 6f72 655f 636f 6d70 6f6e 656e   ignore_componen
-00012440: 7473 5f70 7265 6669 783d 6967 6e6f 7265  ts_prefix=ignore
-00012450: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
-00012460: 6978 2c0a 2020 2020 2020 2020 2020 2020  ix,.            
-00012470: 290a 2020 2020 2020 2020 2020 2020 645b  ).            d[
-00012480: 2263 656c 6c73 225d 203d 2063 6c65 616e  "cells"] = clean
-00012490: 5f64 6963 7428 6365 6c6c 7329 0a0a 2020  _dict(cells)..  
-000124a0: 2020 2020 2020 645b 226e 616d 6522 5d20        d["name"] 
-000124b0: 3d20 7365 6c66 2e6e 616d 650a 2020 2020  = self.name.    
-000124c0: 2020 2020 645b 2273 6574 7469 6e67 7322      d["settings"
-000124d0: 5d20 3d20 636c 6561 6e5f 6469 6374 2864  ] = clean_dict(d
-000124e0: 6963 7428 7365 6c66 2e73 6574 7469 6e67  ict(self.setting
-000124f0: 7329 290a 2020 2020 2020 2020 7265 7475  s)).        retu
-00012500: 726e 2064 0a0a 2020 2020 6465 6620 746f  rn d..    def to
-00012510: 5f79 616d 6c28 7365 6c66 2c20 2a2a 6b77  _yaml(self, **kw
-00012520: 6172 6773 2920 2d3e 2073 7472 3a0a 2020  args) -> str:.  
-00012530: 2020 2020 2020 2222 2257 7269 7465 2044        """Write D
-00012540: 6963 7420 7265 7072 6573 656e 7461 7469  ict representati
-00012550: 6f6e 206f 6620 6120 636f 6d70 6f6e 656e  on of a componen
-00012560: 7420 696e 2059 414d 4c20 666f 726d 6174  t in YAML format
-00012570: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00012580: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
-00012590: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
-000125a0: 7265 6669 783a 2066 6f72 2063 6f6d 706f  refix: for compo
-000125b0: 6e65 6e74 7320 746f 2069 676e 6f72 6520  nents to ignore 
-000125c0: 7768 656e 2065 7870 6f72 7469 6e67 2e0a  when exporting..
-000125d0: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
-000125e0: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
-000125f0: 6669 783a 2066 6f72 2066 756e 6374 696f  fix: for functio
-00012600: 6e73 2074 6f20 6967 6e6f 7265 2077 6865  ns to ignore whe
-00012610: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
-00012620: 2020 2020 2020 2020 2077 6974 685f 6365           with_ce
-00012630: 6c6c 733a 2077 7269 7465 2063 656c 6c73  lls: write cells
-00012640: 2072 6563 7572 7369 7665 6c79 2e0a 2020   recursively..  
-00012650: 2020 2020 2020 2020 2020 7769 7468 5f70            with_p
-00012660: 6f72 7473 3a20 7772 6974 6520 706f 7274  orts: write port
-00012670: 2069 6e66 6f72 6d61 7469 6f6e 2e0a 2020   information..  
-00012680: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00012690: 2020 7265 7475 726e 2079 616d 6c2e 6475    return yaml.du
-000126a0: 6d70 2863 6c65 616e 5f64 6963 7428 7365  mp(clean_dict(se
-000126b0: 6c66 2e74 6f5f 6469 6374 282a 2a6b 7761  lf.to_dict(**kwa
-000126c0: 7267 7329 2929 0a0a 2020 2020 6465 6620  rgs)))..    def 
-000126d0: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
-000126e0: 7328 7365 6c66 2c20 2a2a 6b77 6172 6773  s(self, **kwargs
-000126f0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00012700: 2020 2022 2222 5265 6e61 6d65 2070 6f72     """Rename por
-00012710: 7473 2062 7920 6f72 6965 6e74 6174 696f  ts by orientatio
-00012720: 6e20 4e53 4557 2028 6e6f 7274 682c 2073  n NSEW (north, s
-00012730: 6f75 7468 2c20 6561 7374 2c20 7765 7374  outh, east, west
-00012740: 292e 0a0a 2020 2020 2020 2020 4b65 7977  )...        Keyw
-00012750: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
-00012760: 2020 2020 2020 6675 6e63 7469 6f6e 3a20        function: 
-00012770: 746f 2072 656e 616d 6520 706f 7274 732e  to rename ports.
-00012780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00012790: 6563 745f 706f 7274 735f 6f70 7469 6361  ect_ports_optica
-000127a0: 6c3a 2074 6f20 7365 6c65 6374 206f 7074  l: to select opt
-000127b0: 6963 616c 2070 6f72 7473 2e0a 2020 2020  ical ports..    
-000127c0: 2020 2020 2020 2020 7365 6c65 6374 5f70          select_p
-000127d0: 6f72 7473 5f65 6c65 6374 7269 6361 6c3a  orts_electrical:
-000127e0: 2074 6f20 7365 6c65 6374 2065 6c65 6374   to select elect
-000127f0: 7269 6361 6c20 706f 7274 732e 0a20 2020  rical ports..   
-00012800: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-00012810: 6f70 7469 6361 6c3a 2070 7265 6669 782e  optical: prefix.
-00012820: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00012830: 6669 785f 656c 6563 7472 6963 616c 3a20  fix_electrical: 
-00012840: 7072 6566 6978 2e0a 0a20 2020 2020 2020  prefix...       
-00012850: 202e 2e20 636f 6465 3a3a 0a0a 2020 2020   .. code::..    
-00012860: 2020 2020 2020 2020 2020 2020 2020 3320                3 
-00012870: 2034 0a20 2020 2020 2020 2020 2020 2020   4.             
-00012880: 2020 2020 5f7c 5f5f 7c5f 0a20 2020 2020      _|__|_.     
-00012890: 2020 2020 2020 2020 3220 2d7c 2020 2020          2 -|    
-000128a0: 2020 7c2d 2035 0a20 2020 2020 2020 2020    |- 5.         
-000128b0: 2020 2020 2020 207c 2020 2020 2020 7c0a         |      |.
-000128c0: 2020 2020 2020 2020 2020 2020 2031 202d               1 -
-000128d0: 7c5f 5f5f 5f5f 5f7c 2d20 360a 2020 2020  |______|- 6.    
-000128e0: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
-000128f0: 207c 0a20 2020 2020 2020 2020 2020 2020   |.             
-00012900: 2020 2020 2038 2020 370a 2020 2020 2020       8  7.      
-00012910: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-00012920: 6c66 2e69 735f 756e 6c6f 636b 6564 2829  lf.is_unlocked()
-00012930: 0a20 2020 2020 2020 2061 7574 6f5f 7265  .        auto_re
-00012940: 6e61 6d65 5f70 6f72 7473 2873 656c 662c  name_ports(self,
-00012950: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00012960: 6465 6620 6175 746f 5f72 656e 616d 655f  def auto_rename_
-00012970: 706f 7274 735f 636f 756e 7465 725f 636c  ports_counter_cl
-00012980: 6f63 6b77 6973 6528 7365 6c66 2c20 2a2a  ockwise(self, **
-00012990: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
-000129a0: 0a20 2020 2020 2020 2073 656c 662e 6973  .        self.is
-000129b0: 5f75 6e6c 6f63 6b65 6428 290a 2020 2020  _unlocked().    
-000129c0: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
-000129d0: 706f 7274 735f 636f 756e 7465 725f 636c  ports_counter_cl
-000129e0: 6f63 6b77 6973 6528 7365 6c66 2c20 2a2a  ockwise(self, **
-000129f0: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-00012a00: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
-00012a10: 7473 5f6c 6179 6572 5f6f 7269 656e 7461  ts_layer_orienta
-00012a20: 7469 6f6e 2873 656c 662c 202a 2a6b 7761  tion(self, **kwa
-00012a30: 7267 7329 202d 3e20 4e6f 6e65 3a0a 2020  rgs) -> None:.  
-00012a40: 2020 2020 2020 7365 6c66 2e69 735f 756e        self.is_un
-00012a50: 6c6f 636b 6564 2829 0a20 2020 2020 2020  locked().       
-00012a60: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
-00012a70: 7473 5f6c 6179 6572 5f6f 7269 656e 7461  ts_layer_orienta
-00012a80: 7469 6f6e 2873 656c 662c 202a 2a6b 7761  tion(self, **kwa
-00012a90: 7267 7329 0a0a 2020 2020 6465 6620 6175  rgs)..    def au
-00012aa0: 746f 5f72 656e 616d 655f 706f 7274 735f  to_rename_ports_
-00012ab0: 6f72 6965 6e74 6174 696f 6e28 7365 6c66  orientation(self
-00012ac0: 2c20 2a2a 6b77 6172 6773 2920 2d3e 204e  , **kwargs) -> N
-00012ad0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00012ae0: 5265 6e61 6d65 2070 6f72 7473 2062 7920  Rename ports by 
-00012af0: 6f72 6965 6e74 6174 696f 6e20 4e53 4557  orientation NSEW
-00012b00: 2028 6e6f 7274 682c 2073 6f75 7468 2c20   (north, south, 
-00012b10: 6561 7374 2c20 7765 7374 292e 0a0a 2020  east, west)...  
-00012b20: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
-00012b30: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00012b40: 6675 6e63 7469 6f6e 3a20 746f 2072 656e  function: to ren
-00012b50: 616d 6520 706f 7274 732e 0a20 2020 2020  ame ports..     
-00012b60: 2020 2020 2020 2073 656c 6563 745f 706f         select_po
-00012b70: 7274 735f 6f70 7469 6361 6c3a 2074 6f20  rts_optical: to 
-00012b80: 7365 6c65 6374 2070 6f72 7473 2e0a 2020  select ports..  
-00012b90: 2020 2020 2020 2020 2020 7365 6c65 6374            select
-00012ba0: 5f70 6f72 7473 5f65 6c65 6374 7269 6361  _ports_electrica
-00012bb0: 6c3a 0a20 2020 2020 2020 2020 2020 2070  l:.            p
-00012bc0: 7265 6669 785f 6f70 7469 6361 6c3a 0a20  refix_optical:. 
-00012bd0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00012be0: 785f 656c 6563 7472 6963 616c 3a0a 0a20  x_electrical:.. 
-00012bf0: 2020 2020 2020 202e 2e20 636f 6465 3a3a         .. code::
-00012c00: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012c10: 2020 204e 3020 204e 310a 2020 2020 2020     N0  N1.      
-00012c20: 2020 2020 2020 2020 2020 207c 5f5f 5f7c             |___|
-00012c30: 5f0a 2020 2020 2020 2020 2020 2020 5731  _.            W1
-00012c40: 202d 7c20 2020 2020 207c 2d20 4531 0a20   -|      |- E1. 
-00012c50: 2020 2020 2020 2020 2020 2020 2020 207c                 |
-00012c60: 2020 2020 2020 7c0a 2020 2020 2020 2020        |.        
-00012c70: 2020 2020 5730 202d 7c5f 5f5f 5f5f 5f7c      W0 -|______|
-00012c80: 2d20 4530 0a20 2020 2020 2020 2020 2020  - E0.           
-00012c90: 2020 2020 2020 7c20 2020 7c0a 2020 2020        |   |.    
-00012ca0: 2020 2020 2020 2020 2020 2020 5330 2020              S0  
-00012cb0: 2053 310a 2020 2020 2020 2020 2222 220a   S1.        """.
-00012cc0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
-00012cd0: 756e 6c6f 636b 6564 2829 0a20 2020 2020  unlocked().     
-00012ce0: 2020 2061 7574 6f5f 7265 6e61 6d65 5f70     auto_rename_p
-00012cf0: 6f72 7473 5f6f 7269 656e 7461 7469 6f6e  orts_orientation
-00012d00: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00012d10: 0a0a 2020 2020 6465 6620 6d6f 7665 280a  ..    def move(.
-00012d20: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00012d30: 2020 2020 2020 6f72 6967 696e 3a20 466c        origin: Fl
-00012d40: 6f61 7432 203d 2028 302c 2030 292c 0a20  oat2 = (0, 0),. 
-00012d50: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
-00012d60: 6f6e 3a20 466c 6f61 7432 207c 204e 6f6e  on: Float2 | Non
-00012d70: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00012d80: 2020 6178 6973 3a20 4178 6973 207c 204e    axis: Axis | N
-00012d90: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00012da0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
-00012db0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00012dc0: 6e73 206e 6577 2043 6f6d 706f 6e65 6e74  ns new Component
-00012dd0: 2077 6974 6820 6120 6d6f 7665 6420 7265   with a moved re
-00012de0: 6665 7265 6e63 6520 746f 2074 6865 206f  ference to the o
-00012df0: 7269 6769 6e61 6c2e 0a0a 2020 2020 2020  riginal...      
-00012e00: 2020 636f 6d70 6f6e 656e 742e 0a0a 2020    component...  
-00012e10: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00012e20: 2020 2020 2020 2020 6f72 6967 696e 3a20          origin: 
-00012e30: 6f66 2063 6f6d 706f 6e65 6e74 2e0a 2020  of component..  
-00012e40: 2020 2020 2020 2020 2020 6465 7374 696e            destin
-00012e50: 6174 696f 6e3a 2078 2c20 792e 0a20 2020  ation: x, y..   
-00012e60: 2020 2020 2020 2020 2061 7869 733a 2078           axis: x
-00012e70: 206f 7220 792e 0a20 2020 2020 2020 2022   or y..        "
-00012e80: 2222 0a20 2020 2020 2020 2072 6169 7365  "".        raise
-00012e90: 2056 616c 7565 4572 726f 7228 6d6f 7665   ValueError(move
-00012ea0: 5f65 7272 6f72 5f6d 6573 7361 6765 290a  _error_message).
-00012eb0: 0a20 2020 2064 6566 206d 6972 726f 7228  .    def mirror(
-00012ec0: 7365 6c66 2c20 7031 3a20 466c 6f61 7432  self, p1: Float2
-00012ed0: 203d 2028 302c 2031 292c 2070 323a 2046   = (0, 1), p2: F
-00012ee0: 6c6f 6174 3220 3d20 2830 2c20 3029 2c20  loat2 = (0, 0), 
-00012ef0: 2a2a 6b77 6172 6773 2920 2d3e 2043 6f6d  **kwargs) -> Com
-00012f00: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
-00012f10: 2222 2252 6574 7572 6e73 206e 6577 2043  """Returns new C
-00012f20: 6f6d 706f 6e65 6e74 2077 6974 6820 6120  omponent with a 
-00012f30: 6d69 7272 6f72 6564 2072 6566 6572 656e  mirrored referen
-00012f40: 6365 2e0a 0a20 2020 2020 2020 2041 7267  ce...        Arg
-00012f50: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00012f60: 313a 2066 6972 7374 2070 6f69 6e74 2074  1: first point t
-00012f70: 6f20 6465 6669 6e65 206d 6972 726f 7220  o define mirror 
-00012f80: 6178 6973 2e0a 2020 2020 2020 2020 2020  axis..          
-00012f90: 2020 7032 3a20 7365 636f 6e64 2070 6f69    p2: second poi
-00012fa0: 6e74 2074 6f20 6465 6669 6e65 206d 6972  nt to define mir
-00012fb0: 726f 7220 6178 6973 2e0a 2020 2020 2020  ror axis..      
-00012fc0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00012fd0: 6f6d 2067 6473 6661 6374 6f72 792e 6675  om gdsfactory.fu
-00012fe0: 6e63 7469 6f6e 7320 696d 706f 7274 206d  nctions import m
-00012ff0: 6972 726f 720a 0a20 2020 2020 2020 2072  irror..        r
-00013000: 6574 7572 6e20 6d69 7272 6f72 2863 6f6d  eturn mirror(com
-00013010: 706f 6e65 6e74 3d73 656c 662c 2070 313d  ponent=self, p1=
-00013020: 7031 2c20 7032 3d70 322c 202a 2a6b 7761  p1, p2=p2, **kwa
-00013030: 7267 7329 0a0a 2020 2020 6465 6620 726f  rgs)..    def ro
-00013040: 7461 7465 2873 656c 662c 2061 6e67 6c65  tate(self, angle
-00013050: 3a20 666c 6f61 7420 3d20 3930 2c20 2a2a  : float = 90, **
-00013060: 6b77 6172 6773 2920 2d3e 2043 6f6d 706f  kwargs) -> Compo
-00013070: 6e65 6e74 3a0a 2020 2020 2020 2020 2222  nent:.        ""
-00013080: 2252 6574 7572 6e73 206e 6577 2063 6f6d  "Returns new com
-00013090: 706f 6e65 6e74 2077 6974 6820 6120 726f  ponent with a ro
-000130a0: 7461 7465 6420 7265 6665 7265 6e63 6520  tated reference 
-000130b0: 746f 2074 6865 206f 7269 6769 6e61 6c2e  to the original.
-000130c0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-000130d0: 2020 2020 2020 2020 2020 2020 616e 676c              angl
-000130e0: 653a 2069 6e20 6465 6772 6565 732e 0a20  e: in degrees.. 
-000130f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013100: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00013110: 7279 2e66 756e 6374 696f 6e73 2069 6d70  ry.functions imp
-00013120: 6f72 7420 726f 7461 7465 0a0a 2020 2020  ort rotate..    
-00013130: 2020 2020 7265 7475 726e 2072 6f74 6174      return rotat
-00013140: 6528 636f 6d70 6f6e 656e 743d 7365 6c66  e(component=self
-00013150: 2c20 616e 676c 653d 616e 676c 652c 202a  , angle=angle, *
-00013160: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-00013170: 6620 6164 645f 7061 6464 696e 6728 7365  f add_padding(se
-00013180: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
-00013190: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-000131a0: 2020 2020 2222 2252 6574 7572 6e73 2073      """Returns s
-000131b0: 616d 6520 636f 6d70 6f6e 656e 7420 7769  ame component wi
-000131c0: 7468 2070 6164 6469 6e67 2e0a 0a20 2020  th padding...   
-000131d0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-000131e0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-000131f0: 6f6d 706f 6e65 6e74 3a20 666f 7220 7061  omponent: for pa
-00013200: 6464 696e 672e 0a20 2020 2020 2020 2020  dding..         
-00013210: 2020 206c 6179 6572 733a 206c 6973 7420     layers: list 
-00013220: 6f66 206c 6179 6572 732e 0a20 2020 2020  of layers..     
-00013230: 2020 2020 2020 2073 7566 6669 7820 666f         suffix fo
-00013240: 7220 6e61 6d65 2e0a 2020 2020 2020 2020  r name..        
-00013250: 2020 2020 6465 6661 756c 743a 2064 6566      default: def
-00013260: 6175 6c74 2070 6164 6469 6e67 2028 3530  ault padding (50
-00013270: 756d 292e 0a20 2020 2020 2020 2020 2020  um)..           
-00013280: 2074 6f70 3a20 6e6f 7274 6820 7061 6464   top: north padd
-00013290: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-000132a0: 2062 6f74 746f 6d3a 2073 6f75 7468 2070   bottom: south p
-000132b0: 6164 6469 6e67 2e0a 2020 2020 2020 2020  adding..        
-000132c0: 2020 2020 7269 6768 743a 2065 6173 7420      right: east 
-000132d0: 7061 6464 696e 672e 0a20 2020 2020 2020  padding..       
-000132e0: 2020 2020 206c 6566 743a 2077 6573 7420       left: west 
-000132f0: 7061 6464 696e 672e 0a20 2020 2020 2020  padding..       
-00013300: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00013310: 6d20 6764 7366 6163 746f 7279 2e61 6464  m gdsfactory.add
-00013320: 5f70 6164 6469 6e67 2069 6d70 6f72 7420  _padding import 
-00013330: 6164 645f 7061 6464 696e 670a 0a20 2020  add_padding..   
-00013340: 2020 2020 2072 6574 7572 6e20 6164 645f       return add_
-00013350: 7061 6464 696e 6728 636f 6d70 6f6e 656e  padding(componen
-00013360: 743d 7365 6c66 2c20 2a2a 6b77 6172 6773  t=self, **kwargs
-00013370: 290a 0a20 2020 2064 6566 2061 6273 6f72  )..    def absor
-00013380: 6228 7365 6c66 2c20 7265 6665 7265 6e63  b(self, referenc
-00013390: 6529 202d 3e20 436f 6d70 6f6e 656e 743a  e) -> Component:
-000133a0: 0a20 2020 2020 2020 2022 2222 4162 736f  .        """Abso
-000133b0: 7262 7320 706f 6c79 676f 6e73 2066 726f  rbs polygons fro
-000133c0: 6d20 436f 6d70 6f6e 656e 7452 6566 6572  m ComponentRefer
-000133d0: 656e 6365 2069 6e74 6f20 436f 6d70 6f6e  ence into Compon
-000133e0: 656e 742e 0a0a 2020 2020 2020 2020 4465  ent...        De
-000133f0: 7374 726f 7973 2074 6865 2072 6566 6572  stroys the refer
-00013400: 656e 6365 2069 6e20 7468 6520 7072 6f63  ence in the proc
-00013410: 6573 7320 6275 7420 6b65 6570 696e 6720  ess but keeping 
-00013420: 7468 6520 706f 6c79 676f 6e20 6765 6f6d  the polygon geom
-00013430: 6574 7279 2e0a 0a20 2020 2020 2020 2041  etry...        A
-00013440: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00013450: 2072 6566 6572 656e 6365 3a20 436f 6d70   reference: Comp
-00013460: 6f6e 656e 7452 6566 6572 656e 6365 2074  onentReference t
-00013470: 6f20 6265 2061 6273 6f72 6265 6420 696e  o be absorbed in
-00013480: 746f 2074 6865 2043 6f6d 706f 6e65 6e74  to the Component
-00013490: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000134a0: 2020 2020 2020 6966 2072 6566 6572 656e        if referen
-000134b0: 6365 206e 6f74 2069 6e20 7365 6c66 2e72  ce not in self.r
-000134c0: 6566 6572 656e 6365 733a 0a20 2020 2020  eferences:.     
-000134d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000134e0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-000134f0: 2020 2020 2020 2020 2022 5468 6520 7265           "The re
-00013500: 6665 7265 6e63 6520 796f 7520 6173 6b65  ference you aske
-00013510: 6420 746f 2061 6273 6f72 6220 646f 6573  d to absorb does
-00013520: 206e 6f74 2065 7869 7374 2069 6e20 7468   not exist in th
-00013530: 6973 2043 6f6d 706f 6e65 6e74 2e22 0a20  is Component.". 
-00013540: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00013550: 2020 2020 2072 6566 5f70 6f6c 7967 6f6e       ref_polygon
-00013560: 7320 3d20 7265 6665 7265 6e63 652e 6765  s = reference.ge
-00013570: 745f 706f 6c79 676f 6e73 280a 2020 2020  t_polygons(.    
-00013580: 2020 2020 2020 2020 6279 5f73 7065 633d          by_spec=
-00013590: 4661 6c73 652c 2069 6e63 6c75 6465 5f70  False, include_p
-000135a0: 6174 6873 3d46 616c 7365 2c20 6173 5f61  aths=False, as_a
-000135b0: 7272 6179 3d46 616c 7365 0a20 2020 2020  rray=False.     
-000135c0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-000135d0: 662e 5f61 6464 5f70 6f6c 7967 6f6e 7328  f._add_polygons(
-000135e0: 2a72 6566 5f70 6f6c 7967 6f6e 7329 0a0a  *ref_polygons)..
-000135f0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00013600: 2872 6566 6572 656e 6365 2e67 6574 5f6c  (reference.get_l
-00013610: 6162 656c 7328 2929 0a20 2020 2020 2020  abels()).       
-00013620: 2073 656c 662e 6164 6428 7265 6665 7265   self.add(refere
-00013630: 6e63 652e 6765 745f 7061 7468 7328 2929  nce.get_paths())
-00013640: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
-00013650: 6d6f 7665 2872 6566 6572 656e 6365 290a  move(reference).
-00013660: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013670: 656c 660a 0a20 2020 2064 6566 2072 656d  elf..    def rem
-00013680: 6f76 6528 7365 6c66 2c20 6974 656d 7329  ove(self, items)
-00013690: 3a0a 2020 2020 2020 2020 2222 2252 656d  :.        """Rem
-000136a0: 6f76 6573 2069 7465 6d73 2066 726f 6d20  oves items from 
-000136b0: 6120 436f 6d70 6f6e 656e 742c 2077 6869  a Component, whi
-000136c0: 6368 2063 616e 2069 6e63 6c75 6465 2050  ch can include P
-000136d0: 6f72 7473 2c20 506f 6c79 676f 6e53 6574  orts, PolygonSet
-000136e0: 7320 5c0a 2020 2020 2020 2020 4365 6c6c  s \.        Cell
-000136f0: 5265 6665 7265 6e63 6573 2c20 436f 6d70  References, Comp
-00013700: 6f6e 656e 7452 6566 6572 656e 6365 7320  onentReferences 
-00013710: 616e 6420 4c61 6265 6c73 2e0a 0a20 2020  and Labels...   
-00013720: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00013730: 2020 2020 2020 2069 7465 6d73 3a20 6c69         items: li
-00013740: 7374 206f 6620 4974 656d 7320 746f 2062  st of Items to b
-00013750: 6520 7265 6d6f 7665 6420 6672 6f6d 2074  e removed from t
-00013760: 6865 2043 6f6d 706f 6e65 6e74 2e0a 2020  he Component..  
-00013770: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013780: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
-00013790: 2869 7465 6d73 2c20 225f 5f69 7465 725f  (items, "__iter_
-000137a0: 5f22 293a 0a20 2020 2020 2020 2020 2020  _"):.           
-000137b0: 2069 7465 6d73 203d 205b 6974 656d 735d   items = [items]
-000137c0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-000137d0: 6d20 696e 2069 7465 6d73 3a0a 2020 2020  m in items:.    
-000137e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000137f0: 7461 6e63 6528 6974 656d 2c20 506f 7274  tance(item, Port
-00013800: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00013810: 2020 2073 656c 662e 706f 7274 7320 3d20     self.ports = 
-00013820: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-00013830: 6e20 7365 6c66 2e70 6f72 7473 2e69 7465  n self.ports.ite
-00013840: 6d73 2829 2069 6620 7620 213d 2069 7465  ms() if v != ite
-00013850: 6d7d 0a20 2020 2020 2020 2020 2020 2065  m}.            e
-00013860: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
-00013870: 7465 6d2c 2067 6473 746b 2e52 6566 6572  tem, gdstk.Refer
-00013880: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
-00013890: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
-000138a0: 6c2e 7265 6d6f 7665 2869 7465 6d29 0a20  l.remove(item). 
-000138b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000138c0: 7465 6d2e 6f77 6e65 7220 3d20 4e6f 6e65  tem.owner = None
-000138d0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000138e0: 6620 6973 696e 7374 616e 6365 2869 7465  f isinstance(ite
-000138f0: 6d2c 2043 6f6d 706f 6e65 6e74 5265 6665  m, ComponentRefe
-00013900: 7265 6e63 6529 3a0a 2020 2020 2020 2020  rence):.        
-00013910: 2020 2020 2020 2020 7365 6c66 2e72 6566          self.ref
-00013920: 6572 656e 6365 732e 7265 6d6f 7665 2869  erences.remove(i
-00013930: 7465 6d29 0a20 2020 2020 2020 2020 2020  tem).           
-00013940: 2020 2020 2073 656c 662e 5f63 656c 6c2e       self._cell.
-00013950: 7265 6d6f 7665 2869 7465 6d2e 5f72 6566  remove(item._ref
-00013960: 6572 656e 6365 290a 2020 2020 2020 2020  erence).        
-00013970: 2020 2020 2020 2020 6974 656d 2e6f 776e          item.own
-00013980: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
-00013990: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000139a0: 6e61 6d65 645f 7265 6665 7265 6e63 6573  named_references
-000139b0: 2e70 6f70 2869 7465 6d2e 6e61 6d65 290a  .pop(item.name).
-000139c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000139d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000139e0: 2020 7365 6c66 2e5f 6365 6c6c 2e72 656d    self._cell.rem
-000139f0: 6f76 6528 6974 656d 290a 0a20 2020 2020  ove(item)..     
-00013a00: 2020 2073 656c 662e 5f62 625f 7661 6c69     self._bb_vali
-00013a10: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-00013a20: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
-00013a30: 2020 2064 6566 2068 6173 685f 6765 6f6d     def hash_geom
-00013a40: 6574 7279 2873 656c 662c 2070 7265 6369  etry(self, preci
-00013a50: 7369 6f6e 3a20 666c 6f61 7420 3d20 3165  sion: float = 1e
-00013a60: 2d34 2920 2d3e 2073 7472 3a0a 2020 2020  -4) -> str:.    
-00013a70: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
-00013a80: 6e20 5348 4131 2068 6173 6820 6f66 2074  n SHA1 hash of t
-00013a90: 6865 2067 656f 6d65 7472 7920 696e 2074  he geometry in t
-00013aa0: 6865 2043 6f6d 706f 6e65 6e74 2e0a 0a20  he Component... 
-00013ab0: 2020 2020 2020 2046 6f72 2065 6163 6820         For each 
-00013ac0: 6c61 7965 722c 2065 6163 6820 706f 6c79  layer, each poly
-00013ad0: 676f 6e20 6973 2069 6e64 6976 6964 7561  gon is individua
-00013ae0: 6c6c 7920 6861 7368 6564 2061 6e64 2074  lly hashed and t
-00013af0: 6865 6e20 7468 6520 706f 6c79 676f 6e20  hen the polygon 
-00013b00: 6861 7368 6573 0a20 2020 2020 2020 2061  hashes.        a
-00013b10: 7265 2073 6f72 7465 642c 2074 6f20 656e  re sorted, to en
-00013b20: 7375 7265 2074 6865 2068 6173 6820 7374  sure the hash st
-00013b30: 6179 7320 636f 6e73 7461 6e74 2072 6567  ays constant reg
-00013b40: 6172 646c 6573 7320 6f66 2074 6865 206f  ardless of the o
-00013b50: 7264 6572 696e 670a 2020 2020 2020 2020  rdering.        
-00013b60: 7468 6520 706f 6c79 676f 6e73 2e20 2053  the polygons.  S
-00013b70: 696d 696c 6172 6c79 2c20 7468 6520 6c61  imilarly, the la
-00013b80: 7965 7273 2061 7265 2073 6f72 7465 6420  yers are sorted 
-00013b90: 6279 2028 6c61 7965 722c 2064 6174 6174  by (layer, datat
-00013ba0: 7970 6529 2e0a 0a20 2020 2020 2020 2041  ype)...        A
-00013bb0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00013bc0: 2070 7265 6369 7369 6f6e 3a20 526f 756e   precision: Roun
-00013bd0: 6469 6e67 2070 7265 6369 7369 6f6e 2066  ding precision f
-00013be0: 6f72 2074 6865 2074 6865 206f 626a 6563  or the the objec
-00013bf0: 7473 2069 6e20 7468 6520 436f 6d70 6f6e  ts in the Compon
-00013c00: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
-00013c10: 2020 2020 2046 6f72 2069 6e73 7461 6e63       For instanc
-00013c20: 652c 2061 2070 7265 6369 7369 6f6e 206f  e, a precision o
-00013c30: 6620 3165 2d32 2077 696c 6c20 726f 756e  f 1e-2 will roun
-00013c40: 6420 6120 706f 696e 7420 6174 0a20 2020  d a point at.   
-00013c50: 2020 2020 2020 2020 2020 2020 2028 302e               (0.
-00013c60: 3132 342c 2031 2e37 3438 2920 746f 2028  124, 1.748) to (
-00013c70: 302e 3132 2c20 312e 3735 292e 0a0a 2020  0.12, 1.75)...  
-00013c80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013c90: 2020 706f 6c79 676f 6e73 5f62 795f 7370    polygons_by_sp
-00013ca0: 6563 203d 2073 656c 662e 6765 745f 706f  ec = self.get_po
-00013cb0: 6c79 676f 6e73 2862 795f 7370 6563 3d54  lygons(by_spec=T
-00013cc0: 7275 652c 2061 735f 6172 7261 793d 4661  rue, as_array=Fa
-00013cd0: 6c73 6529 0a20 2020 2020 2020 206c 6179  lse).        lay
-00013ce0: 6572 7320 3d20 6e70 2e61 7272 6179 286c  ers = np.array(l
-00013cf0: 6973 7428 706f 6c79 676f 6e73 5f62 795f  ist(polygons_by_
-00013d00: 7370 6563 2e6b 6579 7328 2929 290a 2020  spec.keys())).  
-00013d10: 2020 2020 2020 736f 7274 6564 5f6c 6179        sorted_lay
-00013d20: 6572 7320 3d20 6c61 7965 7273 5b6e 702e  ers = layers[np.
-00013d30: 6c65 7873 6f72 7428 286c 6179 6572 735b  lexsort((layers[
-00013d40: 3a2c 2030 5d2c 206c 6179 6572 735b 3a2c  :, 0], layers[:,
-00013d50: 2031 5d29 295d 0a0a 2020 2020 2020 2020   1]))]..        
-00013d60: 6669 6e61 6c5f 6861 7368 203d 2068 6173  final_hash = has
-00013d70: 686c 6962 2e73 6861 3128 290a 2020 2020  hlib.sha1().    
-00013d80: 2020 2020 666f 7220 6c61 7965 7220 696e      for layer in
-00013d90: 2073 6f72 7465 645f 6c61 7965 7273 3a0a   sorted_layers:.
-00013da0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00013db0: 725f 6861 7368 203d 2068 6173 686c 6962  r_hash = hashlib
-00013dc0: 2e73 6861 3128 6c61 7965 722e 6173 7479  .sha1(layer.asty
-00013dd0: 7065 286e 702e 696e 7436 3429 292e 6469  pe(np.int64)).di
-00013de0: 6765 7374 2829 0a20 2020 2020 2020 2020  gest().         
-00013df0: 2020 2070 6f6c 7967 6f6e 7320 3d20 706f     polygons = po
-00013e00: 6c79 676f 6e73 5f62 795f 7370 6563 5b74  lygons_by_spec[t
-00013e10: 7570 6c65 286c 6179 6572 295d 0a20 2020  uple(layer)].   
-00013e20: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00013e30: 7320 3d20 5b5f 726e 6428 702e 706f 696e  s = [_rnd(p.poin
-00013e40: 7473 2c20 7072 6563 6973 696f 6e29 2066  ts, precision) f
-00013e50: 6f72 2070 2069 6e20 706f 6c79 676f 6e73  or p in polygons
-00013e60: 5d0a 2020 2020 2020 2020 2020 2020 706f  ].            po
-00013e70: 6c79 676f 6e5f 6861 7368 6573 203d 206e  lygon_hashes = n
-00013e80: 702e 736f 7274 285b 6861 7368 6c69 622e  p.sort([hashlib.
-00013e90: 7368 6131 2870 292e 6469 6765 7374 2829  sha1(p).digest()
-00013ea0: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
-00013eb0: 6e73 5d29 0a20 2020 2020 2020 2020 2020  ns]).           
-00013ec0: 2066 696e 616c 5f68 6173 682e 7570 6461   final_hash.upda
-00013ed0: 7465 286c 6179 6572 5f68 6173 6829 0a20  te(layer_hash). 
-00013ee0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00013ef0: 6820 696e 2070 6f6c 7967 6f6e 5f68 6173  h in polygon_has
-00013f00: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
-00013f10: 2020 2020 2066 696e 616c 5f68 6173 682e       final_hash.
-00013f20: 7570 6461 7465 2870 6829 0a0a 2020 2020  update(ph)..    
-00013f30: 2020 2020 7265 7475 726e 2066 696e 616c      return final
-00013f40: 5f68 6173 682e 6865 7864 6967 6573 7428  _hash.hexdigest(
-00013f50: 290a 0a20 2020 2064 6566 2067 6574 5f6c  )..    def get_l
-00013f60: 6162 656c 7328 0a20 2020 2020 2020 2073  abels(.        s
-00013f70: 656c 662c 2061 7070 6c79 5f72 6570 6574  elf, apply_repet
-00013f80: 6974 696f 6e73 3d54 7275 652c 2064 6570  itions=True, dep
-00013f90: 7468 3a20 696e 7420 7c20 4e6f 6e65 203d  th: int | None =
-00013fa0: 204e 6f6e 652c 206c 6179 6572 3d4e 6f6e   None, layer=Non
-00013fb0: 650a 2020 2020 2920 2d3e 206c 6973 745b  e.    ) -> list[
-00013fc0: 4c61 6265 6c5d 3a0a 2020 2020 2020 2020  Label]:.        
-00013fd0: 2222 2252 6574 7572 6e20 6c61 6265 6c73  """Return labels
-00013fe0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00013ff0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-00014000: 6c79 5f72 6570 6574 6974 696f 6e73 3a2e  ly_repetitions:.
-00014010: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-00014020: 7468 3a20 4e6f 6e65 2072 6574 7572 6e73  th: None returns
-00014030: 2061 6c6c 206c 6162 656c 7320 616e 6420   all labels and 
-00014040: 3020 746f 7020 6c65 7665 6c2e 0a20 2020  0 top level..   
-00014050: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
-00014060: 6c61 7965 7273 7065 632e 0a20 2020 2020  layerspec..     
-00014070: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00014080: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
-00014090: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
-000140a0: 7965 720a 0a20 2020 2020 2020 2069 6620  yer..        if 
-000140b0: 6c61 7965 723a 0a20 2020 2020 2020 2020  layer:.         
-000140c0: 2020 206c 6179 6572 2c20 7465 7874 7479     layer, textty
-000140d0: 7065 203d 2067 6574 5f6c 6179 6572 286c  pe = get_layer(l
-000140e0: 6179 6572 290a 2020 2020 2020 2020 656c  ayer).        el
-000140f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00014100: 7465 7874 7479 7065 203d 204e 6f6e 650a  texttype = None.
-00014110: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00014120: 656c 662e 5f63 656c 6c2e 6765 745f 6c61  elf._cell.get_la
-00014130: 6265 6c73 280a 2020 2020 2020 2020 2020  bels(.          
-00014140: 2020 6170 706c 795f 7265 7065 7469 7469    apply_repetiti
-00014150: 6f6e 733d 6170 706c 795f 7265 7065 7469  ons=apply_repeti
-00014160: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
-00014170: 2020 2064 6570 7468 3d64 6570 7468 2c0a     depth=depth,.
-00014180: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00014190: 723d 6c61 7965 722c 0a20 2020 2020 2020  r=layer,.       
-000141a0: 2020 2020 2074 6578 7474 7970 653d 7465       texttype=te
-000141b0: 7874 7479 7065 2c0a 2020 2020 2020 2020  xttype,.        
-000141c0: 290a 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
-000141d0: 655f 6c61 6265 6c73 2873 656c 6629 202d  e_labels(self) -
-000141e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000141f0: 2222 2252 656d 6f76 6520 6c61 6265 6c73  """Remove labels
-00014200: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
-00014210: 662e 5f63 656c 6c2e 7265 6d6f 7665 282a  f._cell.remove(*
-00014220: 7365 6c66 2e6c 6162 656c 7329 0a0a 2020  self.labels)..  
-00014230: 2020 2320 4465 7072 6563 6174 6564 0a20    # Deprecated. 
-00014240: 2020 2064 6566 2067 6574 5f69 6e66 6f28     def get_info(
-00014250: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00014260: 2222 4761 7468 6572 7320 7468 6520 2e69  ""Gathers the .i
-00014270: 6e66 6f20 6469 6374 696f 6e61 7269 6573  nfo dictionaries
-00014280: 2066 726f 6d20 6576 6572 7920 7375 622d   from every sub-
-00014290: 436f 6d70 6f6e 656e 7420 616e 6420 7265  Component and re
-000142a0: 7475 726e 7320 7468 656d 2069 6e20 6120  turns them in a 
-000142b0: 6c69 7374 2e0a 0a20 2020 2020 2020 2041  list...        A
-000142c0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000142d0: 2064 6570 7468 3a20 696e 7420 6f72 204e   depth: int or N
-000142e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000142f0: 2020 2020 4966 206e 6f74 204e 6f6e 652c      If not None,
-00014300: 2064 6566 696e 6573 2066 726f 6d20 686f   defines from ho
-00014310: 7720 6d61 6e79 2072 6566 6572 656e 6365  w many reference
-00014320: 206c 6576 656c 7320 746f 0a20 2020 2020   levels to.     
-00014330: 2020 2020 2020 2020 2020 2072 6574 7269             retri
-00014340: 6576 6520 506f 7274 7320 6672 6f6d 2e0a  eve Ports from..
-00014350: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00014360: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-00014370: 7374 206f 6620 6469 6374 696f 6e61 7269  st of dictionari
-00014380: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00014390: 2020 204c 6973 7420 6f66 2074 6865 2022     List of the "
-000143a0: 2e69 6e66 6f22 2070 726f 7065 7274 7920  .info" property 
-000143b0: 6469 6374 696f 6e61 7269 6573 2066 726f  dictionaries fro
-000143c0: 6d20 616c 6c20 7375 622d 436f 6d70 6f6e  m all sub-Compon
-000143d0: 656e 7473 0a20 2020 2020 2020 2022 2222  ents.        """
-000143e0: 0a20 2020 2020 2020 2044 5f6c 6973 7420  .        D_list 
-000143f0: 3d20 7365 6c66 2e67 6574 5f64 6570 656e  = self.get_depen
-00014400: 6465 6e63 6965 7328 7265 6375 7273 6976  dencies(recursiv
-00014410: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00014420: 7265 7475 726e 205b 442e 696e 666f 2e63  return [D.info.c
-00014430: 6f70 7928 2920 666f 7220 4420 696e 2044  opy() for D in D
-00014440: 5f6c 6973 745d 0a0a 2020 2020 6465 6620  _list]..    def 
-00014450: 7265 6d61 705f 6c61 7965 7273 280a 2020  remap_layers(.  
-00014460: 2020 2020 2020 7365 6c66 2c20 6c61 7965        self, laye
-00014470: 726d 6170 2c20 696e 636c 7564 655f 6c61  rmap, include_la
-00014480: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
-00014490: 652c 2069 6e63 6c75 6465 5f70 6174 6873  e, include_paths
-000144a0: 3a20 626f 6f6c 203d 2054 7275 650a 2020  : bool = True.  
-000144b0: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
-000144c0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000144d0: 7572 6e73 2061 2063 6f70 7920 6f66 2074  urns a copy of t
-000144e0: 6865 2063 6f6d 706f 6e65 6e74 2077 6974  he component wit
-000144f0: 6820 7265 6d61 7070 6564 206c 6179 6572  h remapped layer
-00014500: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
-00014510: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-00014520: 7965 726d 6170 3a20 4469 6374 696f 6e61  yermap: Dictiona
-00014530: 7279 206f 6620 7661 6c75 6573 2069 6e20  ry of values in 
-00014540: 666f 726d 6174 207b 6c61 7965 725f 6672  format {layer_fr
-00014550: 6f6d 203a 206c 6179 6572 5f74 6f7d 2e0a  om : layer_to}..
-00014560: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00014570: 7564 655f 6c61 6265 6c73 3a20 5365 6c65  ude_labels: Sele
-00014580: 6374 7320 7768 6574 6865 7220 746f 206d  cts whether to m
-00014590: 6f76 6520 4c61 6265 6c73 2061 6c6f 6e67  ove Labels along
-000145a0: 2077 6974 6820 706f 6c79 676f 6e73 2e0a   with polygons..
-000145b0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-000145c0: 7564 655f 7061 7468 733a 2053 656c 6563  ude_paths: Selec
-000145d0: 7473 2077 6865 7468 6572 2074 6f20 6d6f  ts whether to mo
-000145e0: 7665 2050 6174 6873 2061 6c6f 6e67 2077  ve Paths along w
-000145f0: 6974 6820 706f 6c79 676f 6e73 2e0a 2020  ith polygons..  
-00014600: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014610: 2020 636f 6d70 6f6e 656e 7420 3d20 7365    component = se
-00014620: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-00014630: 2020 6c61 7965 726d 6170 203d 207b 5f70    layermap = {_p
-00014640: 6172 7365 5f6c 6179 6572 286b 293a 205f  arse_layer(k): _
-00014650: 7061 7273 655f 6c61 7965 7228 7629 2066  parse_layer(v) f
-00014660: 6f72 206b 2c20 7620 696e 206c 6179 6572  or k, v in layer
-00014670: 6d61 702e 6974 656d 7328 297d 0a0a 2020  map.items()}..  
-00014680: 2020 2020 2020 616c 6c5f 4420 3d20 6c69        all_D = li
-00014690: 7374 2863 6f6d 706f 6e65 6e74 2e67 6574  st(component.get
-000146a0: 5f64 6570 656e 6465 6e63 6965 7328 5472  _dependencies(Tr
-000146b0: 7565 2929 0a20 2020 2020 2020 2061 6c6c  ue)).        all
-000146c0: 5f44 2e61 7070 656e 6428 636f 6d70 6f6e  _D.append(compon
-000146d0: 656e 7429 0a20 2020 2020 2020 2066 6f72  ent).        for
-000146e0: 2044 2069 6e20 616c 6c5f 443a 0a20 2020   D in all_D:.   
-000146f0: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
-00014700: 6e20 442e 706f 6c79 676f 6e73 3a0a 2020  n D.polygons:.  
-00014710: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00014720: 7965 7220 3d20 2870 2e6c 6179 6572 2c20  yer = (p.layer, 
-00014730: 702e 6461 7461 7479 7065 290a 2020 2020  p.datatype).    
-00014740: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00014750: 6179 6572 2069 6e20 6c61 7965 726d 6170  ayer in layermap
-00014760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014770: 2020 2020 2020 6e65 775f 6c61 7965 7220        new_layer 
-00014780: 3d20 6c61 7965 726d 6170 5b6c 6179 6572  = layermap[layer
-00014790: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000147a0: 2020 2020 2020 702e 6c61 7965 7220 3d20        p.layer = 
-000147b0: 6e65 775f 6c61 7965 725b 305d 0a20 2020  new_layer[0].   
-000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147d0: 2070 2e64 6174 6174 7970 6520 3d20 6e65   p.datatype = ne
-000147e0: 775f 6c61 7965 725b 315d 0a20 2020 2020  w_layer[1].     
-000147f0: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
-00014800: 655f 6c61 6265 6c73 3a0a 2020 2020 2020  e_labels:.      
-00014810: 2020 2020 2020 2020 2020 666f 7220 6c61            for la
-00014820: 6265 6c20 696e 2044 2e6c 6162 656c 733a  bel in D.labels:
-00014830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014840: 2020 2020 206f 7269 6769 6e61 6c5f 6c61       original_la
-00014850: 7965 7220 3d20 286c 6162 656c 2e6c 6179  yer = (label.lay
-00014860: 6572 2c20 6c61 6265 6c2e 7465 7874 7479  er, label.textty
-00014870: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-00014880: 2020 2020 2020 2020 6f72 6967 696e 616c          original
-00014890: 5f6c 6179 6572 203d 205f 7061 7273 655f  _layer = _parse_
-000148a0: 6c61 7965 7228 6f72 6967 696e 616c 5f6c  layer(original_l
-000148b0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-000148c0: 2020 2020 2020 2020 2020 6966 206f 7269            if ori
-000148d0: 6769 6e61 6c5f 6c61 7965 7220 696e 206c  ginal_layer in l
-000148e0: 6179 6572 6d61 703a 0a20 2020 2020 2020  ayermap:.       
+00010990: 2020 2020 2020 2020 6622 4475 706c 6963          f"Duplic
+000109a0: 6174 6564 2063 656c 6c20 6e61 6d65 7320  ated cell names 
+000109b0: 696e 207b 746f 705f 6365 6c6c 2e6e 616d  in {top_cell.nam
+000109c0: 6521 727d 3a20 207b 6365 6c6c 5f6e 616d  e!r}:  {cell_nam
+000109d0: 6573 7d22 2c0a 2020 2020 2020 2020 2020  es}",.          
+000109e0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000109f0: 6163 6b6c 6576 656c 3d33 2c0a 2020 2020  acklevel=3,.    
+00010a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010a20: 2020 6365 6c6c 735f 6469 6374 203d 207b    cells_dict = {
+00010a30: 6365 6c6c 2e6e 616d 653a 2063 656c 6c2e  cell.name: cell.
+00010a40: 5f63 656c 6c20 666f 7220 6365 6c6c 2069  _cell for cell i
+00010a50: 6e20 6365 6c6c 737d 0a20 2020 2020 2020  n cells}.       
+00010a60: 2020 2020 2020 2020 2063 656c 6c73 203d           cells =
+00010a70: 2063 656c 6c73 5f64 6963 742e 7661 6c75   cells_dict.valu
+00010a80: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
+00010a90: 2065 6c69 6620 7772 6974 655f 7365 7474   elif write_sett
+00010aa0: 696e 6773 2e6f 6e5f 6475 706c 6963 6174  ings.on_duplicat
+00010ab0: 655f 6365 6c6c 2069 7320 6e6f 7420 4e6f  e_cell is not No
+00010ac0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00010ad0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00010ae0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00010af0: 2020 2020 2020 2020 2020 6622 6f6e 5f64            f"on_d
+00010b00: 7570 6c69 6361 7465 5f63 656c 6c3a 207b  uplicate_cell: {
+00010b10: 7772 6974 655f 7365 7474 696e 6773 2e6f  write_settings.o
+00010b20: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
+00010b30: 2172 7d20 6e6f 7420 696e 2028 4e6f 6e65  !r} not in (None
+00010b40: 2c20 7761 726e 2c20 6572 726f 722c 206f  , warn, error, o
+00010b50: 7665 7277 7269 7465 2922 0a20 2020 2020  verwrite)".     
+00010b60: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00010b70: 2020 2020 2020 616c 6c5f 6365 6c6c 7320        all_cells 
+00010b80: 3d20 5b74 6f70 5f63 656c 6c2e 5f63 656c  = [top_cell._cel
+00010b90: 6c5d 202b 2073 6f72 7465 6428 6365 6c6c  l] + sorted(cell
+00010ba0: 732c 206b 6579 3d6c 616d 6264 6120 6363  s, key=lambda cc
+00010bb0: 3a20 6363 2e6e 616d 6529 0a0a 2020 2020  : cc.name)..    
+00010bc0: 2020 2020 6e6f 5f6e 616d 655f 6365 6c6c      no_name_cell
+00010bd0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+00010be0: 2020 6365 6c6c 2e6e 616d 6520 666f 7220    cell.name for 
+00010bf0: 6365 6c6c 2069 6e20 616c 6c5f 6365 6c6c  cell in all_cell
+00010c00: 7320 6966 2063 656c 6c2e 6e61 6d65 2e73  s if cell.name.s
+00010c10: 7461 7274 7377 6974 6828 2255 6e6e 616d  tartswith("Unnam
+00010c20: 6564 2229 0a20 2020 2020 2020 205d 0a0a  ed").        ]..
+00010c30: 2020 2020 2020 2020 6966 206e 6f5f 6e61          if no_na
+00010c40: 6d65 5f63 656c 6c73 3a0a 2020 2020 2020  me_cells:.      
+00010c50: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+00010c60: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+00010c70: 2020 2020 2066 2243 6f6d 706f 6e65 6e74       f"Component
+00010c80: 207b 746f 705f 6365 6c6c 2e6e 616d 6521   {top_cell.name!
+00010c90: 727d 2063 6f6e 7461 696e 7320 7b6c 656e  r} contains {len
+00010ca0: 286e 6f5f 6e61 6d65 5f63 656c 6c73 297d  (no_name_cells)}
+00010cb0: 2055 6e6e 616d 6564 2063 656c 6c73 222c   Unnamed cells",
+00010cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010cd0: 2073 7461 636b 6c65 7665 6c3d 332c 0a20   stacklevel=3,. 
+00010ce0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00010cf0: 2020 2020 2020 2320 666f 7220 6365 6c6c        # for cell
+00010d00: 2069 6e20 616c 6c5f 6365 6c6c 733a 0a20   in all_cells:. 
+00010d10: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
+00010d20: 6e74 2863 656c 6c2e 6e61 6d65 2c20 7479  nt(cell.name, ty
+00010d30: 7065 2863 656c 6c29 290a 0a20 2020 2020  pe(cell))..     
+00010d40: 2020 206c 6962 203d 2067 6473 746b 2e4c     lib = gdstk.L
+00010d50: 6962 7261 7279 280a 2020 2020 2020 2020  ibrary(.        
+00010d60: 2020 2020 6e61 6d65 3d77 7269 7465 5f73      name=write_s
+00010d70: 6574 7469 6e67 732e 6c69 625f 6e61 6d65  ettings.lib_name
+00010d80: 2c0a 2020 2020 2020 2020 2020 2020 756e  ,.            un
+00010d90: 6974 3d77 7269 7465 5f73 6574 7469 6e67  it=write_setting
+00010da0: 732e 756e 6974 2c0a 2020 2020 2020 2020  s.unit,.        
+00010db0: 2020 2020 7072 6563 6973 696f 6e3d 7772      precision=wr
+00010dc0: 6974 655f 7365 7474 696e 6773 2e70 7265  ite_settings.pre
+00010dd0: 6369 7369 6f6e 2c0a 2020 2020 2020 2020  cision,.        
+00010de0: 290a 2020 2020 2020 2020 6c69 622e 6164  ).        lib.ad
+00010df0: 6428 746f 705f 6365 6c6c 2e5f 6365 6c6c  d(top_cell._cell
+00010e00: 290a 2020 2020 2020 2020 6c69 622e 6164  ).        lib.ad
+00010e10: 6428 2a74 6f70 5f63 656c 6c2e 5f63 656c  d(*top_cell._cel
+00010e20: 6c2e 6465 7065 6e64 656e 6369 6573 2854  l.dependencies(T
+00010e30: 7275 6529 290a 0a20 2020 2020 2020 2069  rue))..        i
+00010e40: 6620 7769 7468 5f6f 6173 6973 3a0a 2020  f with_oasis:.  
+00010e50: 2020 2020 2020 2020 2020 6c69 622e 7772            lib.wr
+00010e60: 6974 655f 6f61 7328 6764 7370 6174 682c  ite_oas(gdspath,
+00010e70: 202a 2a6f 6173 6973 5f73 6574 7469 6e67   **oasis_setting
+00010e80: 732e 6469 6374 2829 290a 2020 2020 2020  s.dict()).      
+00010e90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00010ea0: 2020 2020 6c69 622e 7772 6974 655f 6764      lib.write_gd
+00010eb0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+00010ec0: 2020 2067 6473 7061 7468 2c20 7469 6d65     gdspath, time
+00010ed0: 7374 616d 703d 7469 6d65 7374 616d 702c  stamp=timestamp,
+00010ee0: 206d 6178 5f70 6f69 6e74 733d 7772 6974   max_points=writ
+00010ef0: 655f 7365 7474 696e 6773 2e6d 6178 5f70  e_settings.max_p
+00010f00: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
+00010f10: 2020 290a 2020 2020 2020 2020 6966 206c    ).        if l
+00010f20: 6f67 6769 6e67 3a0a 2020 2020 2020 2020  ogging:.        
+00010f30: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+00010f40: 6622 5772 6f74 6520 746f 207b 7374 7228  f"Wrote to {str(
+00010f50: 6764 7370 6174 6829 2172 7d22 290a 2020  gdspath)!r}").  
+00010f60: 2020 2020 2020 6966 2077 6974 685f 6d65        if with_me
+00010f70: 7461 6461 7461 3a0a 2020 2020 2020 2020  tadata:.        
+00010f80: 2020 2020 6d65 7461 6461 7461 203d 2067      metadata = g
+00010f90: 6473 7061 7468 2e77 6974 685f 7375 6666  dspath.with_suff
+00010fa0: 6978 2822 2e79 6d6c 2229 0a20 2020 2020  ix(".yml").     
+00010fb0: 2020 2020 2020 206d 6574 6164 6174 612e         metadata.
+00010fc0: 7772 6974 655f 7465 7874 2873 656c 662e  write_text(self.
+00010fd0: 746f 5f79 616d 6c28 7769 7468 5f63 656c  to_yaml(with_cel
+00010fe0: 6c73 3d54 7275 652c 2077 6974 685f 706f  ls=True, with_po
+00010ff0: 7274 733d 5472 7565 2929 0a20 2020 2020  rts=True)).     
+00011000: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+00011010: 666f 2866 2257 7269 7465 2059 414d 4c20  fo(f"Write YAML 
+00011020: 6d65 7461 6461 7461 2074 6f20 7b73 7472  metadata to {str
+00011030: 286d 6574 6164 6174 6129 2172 7d22 290a  (metadata)!r}").
+00011040: 0a20 2020 2020 2020 2043 4f4e 462e 6c61  .        CONF.la
+00011050: 7374 5f73 6176 6564 5f66 696c 6573 2e61  st_saved_files.a
+00011060: 7070 656e 6428 6764 7370 6174 6829 0a20  ppend(gdspath). 
+00011070: 2020 2020 2020 2072 6574 7572 6e20 6764         return gd
+00011080: 7370 6174 680a 0a20 2020 2064 6566 2077  spath..    def w
+00011090: 7269 7465 5f67 6473 280a 2020 2020 2020  rite_gds(.      
+000110a0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000110b0: 6764 7370 6174 683a 2050 6174 6854 7970  gdspath: PathTyp
+000110c0: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+000110d0: 0a20 2020 2020 2020 2067 6473 6469 723a  .        gdsdir:
+000110e0: 2050 6174 6854 7970 6520 7c20 4e6f 6e65   PathType | None
+000110f0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00011100: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
+00011110: 202d 3e20 5061 7468 3a0a 2020 2020 2020   -> Path:.      
+00011120: 2020 2222 2257 7269 7465 2063 6f6d 706f    """Write compo
+00011130: 6e65 6e74 2074 6f20 4744 5320 616e 6420  nent to GDS and 
+00011140: 7265 7475 726e 7320 6764 7370 6174 682e  returns gdspath.
+00011150: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00011160: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
+00011170: 6174 683a 2047 4453 2066 696c 6520 7061  ath: GDS file pa
+00011180: 7468 2074 6f20 7772 6974 6520 746f 2e0a  th to write to..
+00011190: 2020 2020 2020 2020 2020 2020 6764 7364              gdsd
+000111a0: 6972 3a20 6469 7265 6374 6f72 7920 666f  ir: directory fo
+000111b0: 7220 7468 6520 4744 5320 6669 6c65 2e20  r the GDS file. 
+000111c0: 4465 6661 756c 7473 2074 6f20 2f74 6d70  Defaults to /tmp
+000111d0: 2f72 616e 646f 6d46 696c 652f 6764 7366  /randomFile/gdsf
+000111e0: 6163 746f 7279 2e0a 0a20 2020 2020 2020  actory...       
+000111f0: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+00011200: 2020 2020 2020 2020 2020 2075 6e69 743a             unit:
+00011210: 2075 6e69 7420 7369 7a65 2066 6f72 206f   unit size for o
+00011220: 626a 6563 7473 2069 6e20 6c69 6272 6172  bjects in librar
+00011230: 792e 2031 756d 2062 7920 6465 6661 756c  y. 1um by defaul
+00011240: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
+00011250: 7265 6369 7369 6f6e 3a20 666f 7220 6469  recision: for di
+00011260: 6d65 6e73 696f 6e73 2069 6e20 7468 6520  mensions in the 
+00011270: 6c69 6272 6172 7920 286d 292e 2031 6e6d  library (m). 1nm
+00011280: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
+00011290: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+000112a0: 3a20 6469 7361 626c 6520 4744 5320 7061  : disable GDS pa
+000112b0: 7468 206c 6f67 6769 6e67 2c20 666f 7220  th logging, for 
+000112c0: 6578 616d 706c 6520 666f 7220 7368 6f77  example for show
+000112d0: 696e 6720 6974 2069 6e20 4b4c 6179 6f75  ing it in KLayou
+000112e0: 742e 0a20 2020 2020 2020 2020 2020 206f  t..            o
+000112f0: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
+00011300: 3a20 7370 6563 6966 7920 686f 7720 746f  : specify how to
+00011310: 2072 6573 6f6c 7665 2064 7570 6c69 6361   resolve duplica
+00011320: 7465 2d6e 616d 6564 2063 656c 6c73 2e20  te-named cells. 
+00011330: 4368 6f6f 7365 206f 6e65 206f 6620 7468  Choose one of th
+00011340: 6520 666f 6c6c 6f77 696e 673a 0a20 2020  e following:.   
+00011350: 2020 2020 2020 2020 2020 2020 2022 7761               "wa
+00011360: 726e 2220 2864 6566 6175 6c74 293a 206f  rn" (default): o
+00011370: 7665 7277 7269 7465 2061 6c6c 2064 7570  verwrite all dup
+00011380: 6c69 6361 7465 2063 656c 6c73 2077 6974  licate cells wit
+00011390: 6820 6f6e 6520 6f66 2074 6865 2064 7570  h one of the dup
+000113a0: 6c69 6361 7465 7320 2861 7262 6974 7261  licates (arbitra
+000113b0: 7269 6c79 292e 0a20 2020 2020 2020 2020  rily)..         
+000113c0: 2020 2020 2020 2022 6572 726f 7222 3a20         "error": 
+000113d0: 7468 726f 7720 6120 5661 6c75 6545 7272  throw a ValueErr
+000113e0: 6f72 2077 6865 6e20 6174 7465 6d70 7469  or when attempti
+000113f0: 6e67 2074 6f20 7772 6974 6520 6120 6764  ng to write a gd
+00011400: 7320 7769 7468 2064 7570 6c69 6361 7465  s with duplicate
+00011410: 2063 656c 6c73 2e0a 2020 2020 2020 2020   cells..        
+00011420: 2020 2020 2020 2020 226f 7665 7277 7269          "overwri
+00011430: 7465 223a 206f 7665 7277 7269 7465 2061  te": overwrite a
+00011440: 6c6c 2064 7570 6c69 6361 7465 2063 656c  ll duplicate cel
+00011450: 6c73 2077 6974 6820 6f6e 6520 6f66 2074  ls with one of t
+00011460: 6865 2064 7570 6c69 6361 7465 732c 2077  he duplicates, w
+00011470: 6974 686f 7574 2077 6172 6e69 6e67 2e0a  ithout warning..
+00011480: 2020 2020 2020 2020 2020 2020 6f6e 5f75              on_u
+00011490: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
+000114a0: 743a 204c 6974 6572 616c 5b22 7761 726e  t: Literal["warn
+000114b0: 222c 2022 6572 726f 7222 5d20 3d20 2277  ", "error"] = "w
+000114c0: 6172 6e22 0a20 2020 2020 2020 2020 2020  arn".           
+000114d0: 2066 6c61 7474 656e 5f69 6e76 616c 6964   flatten_invalid
+000114e0: 5f72 6566 733a 2066 6c61 7474 656e 7320  _refs: flattens 
+000114f0: 636f 6d70 6f6e 656e 7420 7265 6665 7265  component refere
+00011500: 6e63 6573 2077 6869 6368 2068 6176 6520  nces which have 
+00011510: 696e 7661 6c69 6420 7472 616e 7366 6f72  invalid transfor
+00011520: 6d61 7469 6f6e 732e 0a20 2020 2020 2020  mations..       
+00011530: 2020 2020 206d 6178 5f70 6f69 6e74 733a       max_points:
+00011540: 204d 6178 696d 616c 206e 756d 6265 7220   Maximal number 
+00011550: 6f66 2076 6572 7469 6365 7320 7065 7220  of vertices per 
+00011560: 706f 6c79 676f 6e2e 0a20 2020 2020 2020  polygon..       
+00011570: 2020 2020 2020 2020 2050 6f6c 7967 6f6e           Polygon
+00011580: 7320 7769 7468 206d 6f72 6520 7665 7274  s with more vert
+00011590: 6963 6573 2074 6861 7420 7468 6973 2061  ices that this a
+000115a0: 7265 2061 7574 6f6d 6174 6963 616c 6c79  re automatically
+000115b0: 2066 7261 6374 7572 6564 2e0a 2020 2020   fractured..    
+000115c0: 2020 2020 2020 2020 7769 7468 5f6d 6574          with_met
+000115d0: 6164 6174 613a 2077 7269 7465 7320 6d65  adata: writes me
+000115e0: 7461 6461 7461 2069 6e20 5941 4d4c 2066  tadata in YAML f
+000115f0: 6f72 6d61 742e 0a20 2020 2020 2020 2022  ormat..        "
+00011600: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+00011610: 726e 2073 656c 662e 5f77 7269 7465 5f6c  rn self._write_l
+00011620: 6962 7261 7279 280a 2020 2020 2020 2020  ibrary(.        
+00011630: 2020 2020 6764 7370 6174 683d 6764 7370      gdspath=gdsp
+00011640: 6174 682c 2067 6473 6469 723d 6764 7364  ath, gdsdir=gdsd
+00011650: 6972 2c20 7769 7468 5f6f 6173 6973 3d46  ir, with_oasis=F
+00011660: 616c 7365 2c20 2a2a 6b77 6172 6773 0a20  alse, **kwargs. 
+00011670: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00011680: 6620 7772 6974 655f 6f61 7328 0a20 2020  f write_oas(.   
+00011690: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000116a0: 2020 2067 6473 7061 7468 3a20 5061 7468     gdspath: Path
+000116b0: 5479 7065 207c 204e 6f6e 6520 3d20 4e6f  Type | None = No
+000116c0: 6e65 2c0a 2020 2020 2020 2020 6764 7364  ne,.        gdsd
+000116d0: 6972 3a20 5061 7468 5479 7065 207c 204e  ir: PathType | N
+000116e0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+000116f0: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+00011700: 2020 2920 2d3e 2050 6174 683a 0a20 2020    ) -> Path:.   
+00011710: 2020 2020 2022 2222 5772 6974 6520 636f       """Write co
+00011720: 6d70 6f6e 656e 7420 746f 2047 4453 2061  mponent to GDS a
+00011730: 6e64 2072 6574 7572 6e73 2067 6473 7061  nd returns gdspa
+00011740: 7468 2e0a 0a20 2020 2020 2020 2041 7267  th...        Arg
+00011750: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
+00011760: 6473 7061 7468 3a20 4744 5320 6669 6c65  dspath: GDS file
+00011770: 2070 6174 6820 746f 2077 7269 7465 2074   path to write t
+00011780: 6f2e 0a20 2020 2020 2020 2020 2020 2067  o..            g
+00011790: 6473 6469 723a 2064 6972 6563 746f 7279  dsdir: directory
+000117a0: 2066 6f72 2074 6865 2047 4453 2066 696c   for the GDS fil
+000117b0: 652e 2044 6566 6175 6c74 7320 746f 202f  e. Defaults to /
+000117c0: 746d 702f 7261 6e64 6f6d 4669 6c65 2f67  tmp/randomFile/g
+000117d0: 6473 6661 6374 6f72 792e 0a0a 2020 2020  dsfactory...    
+000117e0: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
+000117f0: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
+00011800: 6974 3a20 756e 6974 2073 697a 6520 666f  it: unit size fo
+00011810: 7220 6f62 6a65 6374 7320 696e 206c 6962  r objects in lib
+00011820: 7261 7279 2e20 3175 6d20 6279 2064 6566  rary. 1um by def
+00011830: 6175 6c74 2e0a 2020 2020 2020 2020 2020  ault..          
+00011840: 2020 7072 6563 6973 696f 6e3a 2066 6f72    precision: for
+00011850: 2064 696d 656e 7369 6f6e 7320 696e 2074   dimensions in t
+00011860: 6865 206c 6962 7261 7279 2028 6d29 2e20  he library (m). 
+00011870: 316e 6d20 6279 2064 6566 6175 6c74 2e0a  1nm by default..
+00011880: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00011890: 696e 673a 2064 6973 6162 6c65 2047 4453  ing: disable GDS
+000118a0: 2070 6174 6820 6c6f 6767 696e 672c 2066   path logging, f
+000118b0: 6f72 2065 7861 6d70 6c65 2066 6f72 2073  or example for s
+000118c0: 686f 7769 6e67 2069 7420 696e 204b 4c61  howing it in KLa
+000118d0: 796f 7574 2e0a 2020 2020 2020 2020 2020  yout..          
+000118e0: 2020 6f6e 5f64 7570 6c69 6361 7465 5f63    on_duplicate_c
+000118f0: 656c 6c3a 2073 7065 6369 6679 2068 6f77  ell: specify how
+00011900: 2074 6f20 7265 736f 6c76 6520 6475 706c   to resolve dupl
+00011910: 6963 6174 652d 6e61 6d65 6420 6365 6c6c  icate-named cell
+00011920: 732e 2043 686f 6f73 6520 6f6e 6520 6f66  s. Choose one of
+00011930: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
+00011940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011950: 2277 6172 6e22 2028 6465 6661 756c 7429  "warn" (default)
+00011960: 3a20 6f76 6572 7772 6974 6520 616c 6c20  : overwrite all 
+00011970: 6475 706c 6963 6174 6520 6365 6c6c 7320  duplicate cells 
+00011980: 7769 7468 206f 6e65 206f 6620 7468 6520  with one of the 
+00011990: 6475 706c 6963 6174 6573 2028 6172 6269  duplicates (arbi
+000119a0: 7472 6172 696c 7929 2e0a 2020 2020 2020  trarily)..      
+000119b0: 2020 2020 2020 2020 2020 2265 7272 6f72            "error
+000119c0: 223a 2074 6872 6f77 2061 2056 616c 7565  ": throw a Value
+000119d0: 4572 726f 7220 7768 656e 2061 7474 656d  Error when attem
+000119e0: 7074 696e 6720 746f 2077 7269 7465 2061  pting to write a
+000119f0: 2067 6473 2077 6974 6820 6475 706c 6963   gds with duplic
+00011a00: 6174 6520 6365 6c6c 732e 0a20 2020 2020  ate cells..     
+00011a10: 2020 2020 2020 2020 2020 2022 6f76 6572             "over
+00011a20: 7772 6974 6522 3a20 6f76 6572 7772 6974  write": overwrit
+00011a30: 6520 616c 6c20 6475 706c 6963 6174 6520  e all duplicate 
+00011a40: 6365 6c6c 7320 7769 7468 206f 6e65 206f  cells with one o
+00011a50: 6620 7468 6520 6475 706c 6963 6174 6573  f the duplicates
+00011a60: 2c20 7769 7468 6f75 7420 7761 726e 696e  , without warnin
+00011a70: 672e 0a20 2020 2020 2020 2020 2020 2020  g..             
+00011a80: 2020 204e 6f6e 653a 2064 6f20 6e6f 7420     None: do not 
+00011a90: 7472 7920 746f 2072 6573 6f6c 7665 2028  try to resolve (
+00011aa0: 6174 2079 6f75 7220 6f77 6e20 7269 736b  at your own risk
+00011ab0: 2129 0a20 2020 2020 2020 2020 2020 206f  !).            o
+00011ac0: 6e5f 756e 6361 6368 6564 5f63 6f6d 706f  n_uncached_compo
+00011ad0: 6e65 6e74 3a20 4c69 7465 7261 6c5b 2277  nent: Literal["w
+00011ae0: 6172 6e22 2c20 2265 7272 6f72 225d 203d  arn", "error"] =
+00011af0: 2022 7761 726e 220a 2020 2020 2020 2020   "warn".        
+00011b00: 2020 2020 666c 6174 7465 6e5f 696e 7661      flatten_inva
+00011b10: 6c69 645f 7265 6673 3a20 666c 6174 7465  lid_refs: flatte
+00011b20: 6e73 2063 6f6d 706f 6e65 6e74 2072 6566  ns component ref
+00011b30: 6572 656e 6365 7320 7768 6963 6820 6861  erences which ha
+00011b40: 7665 2069 6e76 616c 6964 2074 7261 6e73  ve invalid trans
+00011b50: 666f 726d 6174 696f 6e73 2e0a 2020 2020  formations..    
+00011b60: 2020 2020 2020 2020 636f 6d70 7265 7373          compress
+00011b70: 696f 6e5f 6c65 7665 6c3a 204c 6576 656c  ion_level: Level
+00011b80: 206f 6620 636f 6d70 7265 7373 696f 6e20   of compression 
+00011b90: 666f 7220 6365 6c6c 7320 2862 6574 7765  for cells (betwe
+00011ba0: 656e 2030 2061 6e64 2039 292e 0a20 2020  en 0 and 9)..   
+00011bb0: 2020 2020 2020 2020 2020 2020 2053 6574               Set
+00011bc0: 7469 6e67 2074 6f20 3020 7769 6c6c 2064  ting to 0 will d
+00011bd0: 6973 6162 6c65 2063 656c 6c20 636f 6d70  isable cell comp
+00011be0: 7265 7373 696f 6e2c 2031 2067 6976 6573  ression, 1 gives
+00011bf0: 2074 6865 2062 6573 7420 7370 6565 6420   the best speed 
+00011c00: 616e 6420 392c 2074 6865 2062 6573 7420  and 9, the best 
+00011c10: 636f 6d70 7265 7373 696f 6e2e 0a20 2020  compression..   
+00011c20: 2020 2020 2020 2020 2064 6574 6563 745f           detect_
+00011c30: 7265 6374 616e 676c 6573 3a20 5374 6f72  rectangles: Stor
+00011c40: 6520 7265 6374 616e 676c 6573 2069 6e20  e rectangles in 
+00011c50: 636f 6d70 7265 7373 6564 2066 6f72 6d61  compressed forma
+00011c60: 742e 0a20 2020 2020 2020 2020 2020 2064  t..            d
+00011c70: 6574 6563 745f 7472 6170 657a 6f69 6473  etect_trapezoids
+00011c80: 3a20 5374 6f72 6520 7472 6170 657a 6f69  : Store trapezoi
+00011c90: 6473 2069 6e20 636f 6d70 7265 7373 6564  ds in compressed
+00011ca0: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
+00011cb0: 2020 2020 2063 6972 636c 655f 746f 6c65       circle_tole
+00011cc0: 7261 6e63 653a 2054 6f6c 6572 616e 6365  rance: Tolerance
+00011cd0: 2066 6f72 2064 6574 6563 7469 6e67 2063   for detecting c
+00011ce0: 6972 636c 6573 2e20 4966 206c 6573 7320  ircles. If less 
+00011cf0: 6f72 2065 7175 616c 2074 6f20 302c 206e  or equal to 0, n
+00011d00: 6f20 6465 7465 6374 696f 6e20 6973 2070  o detection is p
+00011d10: 6572 666f 726d 6564 2e0a 2020 2020 2020  erformed..      
+00011d20: 2020 2020 2020 2020 2020 4369 7263 6c65            Circle
+00011d30: 7320 6172 6520 7374 6f72 6564 2069 6e20  s are stored in 
+00011d40: 636f 6d70 7265 7373 6564 2066 6f72 6d61  compressed forma
+00011d50: 742e 0a20 2020 2020 2020 2020 2020 2076  t..            v
+00011d60: 616c 6964 6174 696f 6e20 2822 6372 6333  alidation ("crc3
+00011d70: 3222 2c20 2263 6865 636b 7375 6d33 3222  2", "checksum32"
+00011d80: 2c20 4e6f 6e65 2920 e280 9320 7479 7065  , None) ... type
+00011d90: 206f 6620 7661 6c69 6461 7469 6f6e 2074   of validation t
+00011da0: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
+00011db0: 2073 6176 6564 2066 696c 652e 0a20 2020   saved file..   
+00011dc0: 2020 2020 2020 2020 2073 7461 6e64 6172           standar
+00011dd0: 645f 7072 6f70 6572 7469 6573 3a20 5374  d_properties: St
+00011de0: 6f72 6520 7374 616e 6461 7264 204f 4153  ore standard OAS
+00011df0: 4953 2070 726f 7065 7274 6965 7320 696e  IS properties in
+00011e00: 2074 6865 2066 696c 652e 0a20 2020 2020   the file..     
+00011e10: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00011e20: 6574 7572 6e20 7365 6c66 2e5f 7772 6974  eturn self._writ
+00011e30: 655f 6c69 6272 6172 7928 0a20 2020 2020  e_library(.     
+00011e40: 2020 2020 2020 2067 6473 7061 7468 3d67         gdspath=g
+00011e50: 6473 7061 7468 2c0a 2020 2020 2020 2020  dspath,.        
+00011e60: 2020 2020 6764 7364 6972 3d67 6473 6469      gdsdir=gdsdi
+00011e70: 722c 0a20 2020 2020 2020 2020 2020 2077  r,.            w
+00011e80: 6974 685f 6f61 7369 733d 5472 7565 2c0a  ith_oasis=True,.
+00011e90: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+00011ea0: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
+00011eb0: 0a20 2020 2064 6566 2077 7269 7465 5f67  .    def write_g
+00011ec0: 6473 5f77 6974 685f 6d65 7461 6461 7461  ds_with_metadata
+00011ed0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+00011ee0: 6b77 6172 6773 2920 2d3e 2050 6174 683a  kwargs) -> Path:
+00011ef0: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+00011f00: 6520 636f 6d70 6f6e 656e 7420 696e 2047  e component in G
+00011f10: 4453 2061 6e64 206d 6574 6164 6174 6120  DS and metadata 
+00011f20: 2863 6f6d 706f 6e65 6e74 2073 6574 7469  (component setti
+00011f30: 6e67 7329 2069 6e20 5941 4d4c 2e22 2222  ngs) in YAML."""
+00011f40: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+00011f50: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+00011f60: 2020 2020 2243 6f6d 706f 6e65 6e74 2e77      "Component.w
+00011f70: 7269 7465 5f67 6473 5f77 6974 685f 6d65  rite_gds_with_me
+00011f80: 7461 6461 7461 2829 2069 7320 6465 7072  tadata() is depr
+00011f90: 6563 6174 6564 2e20 220a 2020 2020 2020  ecated. ".      
+00011fa0: 2020 2020 2020 2255 7365 2043 6f6d 706f        "Use Compo
+00011fb0: 6e65 6e74 2e77 7269 7465 5f67 6473 2877  nent.write_gds(w
+00011fc0: 6974 685f 6d65 7461 6461 7461 3d54 7275  ith_metadata=Tru
+00011fd0: 6529 206f 7220 436f 6d70 6f6e 656e 742e  e) or Component.
+00011fe0: 7772 6974 655f 6f61 7328 7769 7468 5f6d  write_oas(with_m
+00011ff0: 6574 6164 6174 613d 5472 7565 292e 222c  etadata=True).",
+00012000: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00012010: 636b 6c65 7665 6c3d 332c 0a20 2020 2020  cklevel=3,.     
+00012020: 2020 2029 0a20 2020 2020 2020 2067 6473     ).        gds
+00012030: 7061 7468 203d 2073 656c 662e 7772 6974  path = self.writ
+00012040: 655f 6764 7328 2a61 7267 732c 202a 2a6b  e_gds(*args, **k
+00012050: 7761 7267 7329 0a20 2020 2020 2020 206d  wargs).        m
+00012060: 6574 6164 6174 6120 3d20 6764 7370 6174  etadata = gdspat
+00012070: 682e 7769 7468 5f73 7566 6669 7828 222e  h.with_suffix(".
+00012080: 796d 6c22 290a 2020 2020 2020 2020 6d65  yml").        me
+00012090: 7461 6461 7461 2e77 7269 7465 5f74 6578  tadata.write_tex
+000120a0: 7428 7365 6c66 2e74 6f5f 7961 6d6c 2877  t(self.to_yaml(w
+000120b0: 6974 685f 6365 6c6c 733d 5472 7565 2c20  ith_cells=True, 
+000120c0: 7769 7468 5f70 6f72 7473 3d54 7275 6529  with_ports=True)
+000120d0: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
+000120e0: 2e69 6e66 6f28 6622 5772 6974 6520 5941  .info(f"Write YA
+000120f0: 4d4c 206d 6574 6164 6174 6120 746f 207b  ML metadata to {
+00012100: 7374 7228 6d65 7461 6461 7461 2921 727d  str(metadata)!r}
+00012110: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00012120: 6e20 6764 7370 6174 680a 0a20 2020 2064  n gdspath..    d
+00012130: 6566 2074 6f5f 6469 6374 280a 2020 2020  ef to_dict(.    
+00012140: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00012150: 2020 6967 6e6f 7265 5f63 6f6d 706f 6e65    ignore_compone
+00012160: 6e74 735f 7072 6566 6978 3a20 6c69 7374  nts_prefix: list
+00012170: 5b73 7472 5d20 7c20 4e6f 6e65 203d 204e  [str] | None = N
+00012180: 6f6e 652c 0a20 2020 2020 2020 2069 676e  one,.        ign
+00012190: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+000121a0: 6566 6978 3a20 6c69 7374 5b73 7472 5d20  efix: list[str] 
+000121b0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+000121c0: 2020 2020 2020 2077 6974 685f 6365 6c6c         with_cell
+000121d0: 733a 2062 6f6f 6c20 3d20 4661 6c73 652c  s: bool = False,
+000121e0: 0a20 2020 2020 2020 2077 6974 685f 706f  .        with_po
+000121f0: 7274 733a 2062 6f6f 6c20 3d20 5472 7565  rts: bool = True
+00012200: 2c0a 2020 2020 2920 2d3e 2064 6963 745b  ,.    ) -> dict[
+00012210: 7374 722c 2041 6e79 5d3a 0a20 2020 2020  str, Any]:.     
+00012220: 2020 2022 2222 5265 7475 726e 7320 4469     """Returns Di
+00012230: 6374 2072 6570 7265 7365 6e74 6174 696f  ct representatio
+00012240: 6e20 6f66 2061 2063 6f6d 706f 6e65 6e74  n of a component
+00012250: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00012260: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
+00012270: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
+00012280: 7265 6669 783a 2066 6f72 2063 6f6d 706f  refix: for compo
+00012290: 6e65 6e74 7320 746f 2069 676e 6f72 6520  nents to ignore 
+000122a0: 7768 656e 2065 7870 6f72 7469 6e67 2e0a  when exporting..
+000122b0: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
+000122c0: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
+000122d0: 6669 783a 2066 6f72 2066 756e 6374 696f  fix: for functio
+000122e0: 6e73 2074 6f20 6967 6e6f 7265 2077 6865  ns to ignore whe
+000122f0: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
+00012300: 2020 2020 2020 2020 2077 6974 685f 6365           with_ce
+00012310: 6c6c 733a 2077 7269 7465 2063 656c 6c73  lls: write cells
+00012320: 2072 6563 7572 7369 7665 6c79 2e0a 2020   recursively..  
+00012330: 2020 2020 2020 2020 2020 7769 7468 5f70            with_p
+00012340: 6f72 7473 3a20 7772 6974 6520 706f 7274  orts: write port
+00012350: 2069 6e66 6f72 6d61 7469 6f6e 2064 6963   information dic
+00012360: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00012370: 2020 2020 2020 2064 203d 207b 7d0a 2020         d = {}.  
+00012380: 2020 2020 2020 6966 2077 6974 685f 706f        if with_po
+00012390: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
+000123a0: 2070 6f72 7473 203d 207b 706f 7274 2e6e   ports = {port.n
+000123b0: 616d 653a 2070 6f72 742e 746f 5f64 6963  ame: port.to_dic
+000123c0: 7428 2920 666f 7220 706f 7274 2069 6e20  t() for port in 
+000123d0: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+000123e0: 6973 7428 297d 0a20 2020 2020 2020 2020  ist()}.         
+000123f0: 2020 2064 5b22 706f 7274 7322 5d20 3d20     d["ports"] = 
+00012400: 706f 7274 730a 0a20 2020 2020 2020 2069  ports..        i
+00012410: 6620 7769 7468 5f63 656c 6c73 3a0a 2020  f with_cells:.  
+00012420: 2020 2020 2020 2020 2020 6365 6c6c 7320            cells 
+00012430: 3d20 7265 6375 7273 655f 7374 7275 6374  = recurse_struct
+00012440: 7572 6573 280a 2020 2020 2020 2020 2020  ures(.          
+00012450: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00012460: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
+00012470: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
+00012480: 6669 783d 6967 6e6f 7265 5f66 756e 6374  fix=ignore_funct
+00012490: 696f 6e73 5f70 7265 6669 782c 0a20 2020  ions_prefix,.   
+000124a0: 2020 2020 2020 2020 2020 2020 2069 676e               ign
+000124b0: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
+000124c0: 7265 6669 783d 6967 6e6f 7265 5f63 6f6d  refix=ignore_com
+000124d0: 706f 6e65 6e74 735f 7072 6566 6978 2c0a  ponents_prefix,.
+000124e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000124f0: 2020 2020 2020 2020 2020 645b 2263 656c            d["cel
+00012500: 6c73 225d 203d 2063 6c65 616e 5f64 6963  ls"] = clean_dic
+00012510: 7428 6365 6c6c 7329 0a0a 2020 2020 2020  t(cells)..      
+00012520: 2020 645b 226e 616d 6522 5d20 3d20 7365    d["name"] = se
+00012530: 6c66 2e6e 616d 650a 2020 2020 2020 2020  lf.name.        
+00012540: 645b 2273 6574 7469 6e67 7322 5d20 3d20  d["settings"] = 
+00012550: 636c 6561 6e5f 6469 6374 2864 6963 7428  clean_dict(dict(
+00012560: 7365 6c66 2e73 6574 7469 6e67 7329 290a  self.settings)).
+00012570: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00012580: 0a0a 2020 2020 6465 6620 746f 5f79 616d  ..    def to_yam
+00012590: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
+000125a0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+000125b0: 2020 2222 2257 7269 7465 2044 6963 7420    """Write Dict 
+000125c0: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
+000125d0: 6620 6120 636f 6d70 6f6e 656e 7420 696e  f a component in
+000125e0: 2059 414d 4c20 666f 726d 6174 2e0a 0a20   YAML format... 
+000125f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00012600: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+00012610: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
+00012620: 783a 2066 6f72 2063 6f6d 706f 6e65 6e74  x: for component
+00012630: 7320 746f 2069 676e 6f72 6520 7768 656e  s to ignore when
+00012640: 2065 7870 6f72 7469 6e67 2e0a 2020 2020   exporting..    
+00012650: 2020 2020 2020 2020 6967 6e6f 7265 5f66          ignore_f
+00012660: 756e 6374 696f 6e73 5f70 7265 6669 783a  unctions_prefix:
+00012670: 2066 6f72 2066 756e 6374 696f 6e73 2074   for functions t
+00012680: 6f20 6967 6e6f 7265 2077 6865 6e20 6578  o ignore when ex
+00012690: 706f 7274 696e 672e 0a20 2020 2020 2020  porting..       
+000126a0: 2020 2020 2077 6974 685f 6365 6c6c 733a       with_cells:
+000126b0: 2077 7269 7465 2063 656c 6c73 2072 6563   write cells rec
+000126c0: 7572 7369 7665 6c79 2e0a 2020 2020 2020  ursively..      
+000126d0: 2020 2020 2020 7769 7468 5f70 6f72 7473        with_ports
+000126e0: 3a20 7772 6974 6520 706f 7274 2069 6e66  : write port inf
+000126f0: 6f72 6d61 7469 6f6e 2e0a 2020 2020 2020  ormation..      
+00012700: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00012710: 7475 726e 2079 616d 6c2e 6475 6d70 2863  turn yaml.dump(c
+00012720: 6c65 616e 5f64 6963 7428 7365 6c66 2e74  lean_dict(self.t
+00012730: 6f5f 6469 6374 282a 2a6b 7761 7267 7329  o_dict(**kwargs)
+00012740: 2929 0a0a 2020 2020 6465 6620 6175 746f  ))..    def auto
+00012750: 5f72 656e 616d 655f 706f 7274 7328 7365  _rename_ports(se
+00012760: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
+00012770: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00012780: 2222 5265 6e61 6d65 2070 6f72 7473 2062  ""Rename ports b
+00012790: 7920 6f72 6965 6e74 6174 696f 6e20 4e53  y orientation NS
+000127a0: 4557 2028 6e6f 7274 682c 2073 6f75 7468  EW (north, south
+000127b0: 2c20 6561 7374 2c20 7765 7374 292e 0a0a  , east, west)...
+000127c0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+000127d0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+000127e0: 2020 6675 6e63 7469 6f6e 3a20 746f 2072    function: to r
+000127f0: 656e 616d 6520 706f 7274 732e 0a20 2020  ename ports..   
+00012800: 2020 2020 2020 2020 2073 656c 6563 745f           select_
+00012810: 706f 7274 735f 6f70 7469 6361 6c3a 2074  ports_optical: t
+00012820: 6f20 7365 6c65 6374 206f 7074 6963 616c  o select optical
+00012830: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+00012840: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
+00012850: 5f65 6c65 6374 7269 6361 6c3a 2074 6f20  _electrical: to 
+00012860: 7365 6c65 6374 2065 6c65 6374 7269 6361  select electrica
+00012870: 6c20 706f 7274 732e 0a20 2020 2020 2020  l ports..       
+00012880: 2020 2020 2070 7265 6669 785f 6f70 7469       prefix_opti
+00012890: 6361 6c3a 2070 7265 6669 782e 0a20 2020  cal: prefix..   
+000128a0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+000128b0: 656c 6563 7472 6963 616c 3a20 7072 6566  electrical: pref
+000128c0: 6978 2e0a 0a20 2020 2020 2020 202e 2e20  ix...        .. 
+000128d0: 636f 6465 3a3a 0a0a 2020 2020 2020 2020  code::..        
+000128e0: 2020 2020 2020 2020 2020 3320 2034 0a20            3  4. 
+000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012900: 5f7c 5f5f 7c5f 0a20 2020 2020 2020 2020  _|__|_.         
+00012910: 2020 2020 3220 2d7c 2020 2020 2020 7c2d      2 -|      |-
+00012920: 2035 0a20 2020 2020 2020 2020 2020 2020   5.             
+00012930: 2020 207c 2020 2020 2020 7c0a 2020 2020     |      |.    
+00012940: 2020 2020 2020 2020 2031 202d 7c5f 5f5f           1 -|___
+00012950: 5f5f 5f7c 2d20 360a 2020 2020 2020 2020  ___|- 6.        
+00012960: 2020 2020 2020 2020 2020 7c20 207c 0a20            |  |. 
+00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012980: 2038 2020 370a 2020 2020 2020 2020 2222   8  7.        ""
+00012990: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
+000129a0: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
+000129b0: 2020 2020 2061 7574 6f5f 7265 6e61 6d65       auto_rename
+000129c0: 5f70 6f72 7473 2873 656c 662c 202a 2a6b  _ports(self, **k
+000129d0: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+000129e0: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
+000129f0: 735f 636f 756e 7465 725f 636c 6f63 6b77  s_counter_clockw
+00012a00: 6973 6528 7365 6c66 2c20 2a2a 6b77 6172  ise(self, **kwar
+00012a10: 6773 2920 2d3e 204e 6f6e 653a 0a20 2020  gs) -> None:.   
+00012a20: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
+00012a30: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
+00012a40: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
+00012a50: 735f 636f 756e 7465 725f 636c 6f63 6b77  s_counter_clockw
+00012a60: 6973 6528 7365 6c66 2c20 2a2a 6b77 6172  ise(self, **kwar
+00012a70: 6773 290a 0a20 2020 2064 6566 2061 7574  gs)..    def aut
+00012a80: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
+00012a90: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
+00012aa0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00012ab0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00012ac0: 2020 7365 6c66 2e69 735f 756e 6c6f 636b    self.is_unlock
+00012ad0: 6564 2829 0a20 2020 2020 2020 2061 7574  ed().        aut
+00012ae0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
+00012af0: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
+00012b00: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00012b10: 0a0a 2020 2020 6465 6620 6175 746f 5f72  ..    def auto_r
+00012b20: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
+00012b30: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
+00012b40: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
+00012b50: 0a20 2020 2020 2020 2022 2222 5265 6e61  .        """Rena
+00012b60: 6d65 2070 6f72 7473 2062 7920 6f72 6965  me ports by orie
+00012b70: 6e74 6174 696f 6e20 4e53 4557 2028 6e6f  ntation NSEW (no
+00012b80: 7274 682c 2073 6f75 7468 2c20 6561 7374  rth, south, east
+00012b90: 2c20 7765 7374 292e 0a0a 2020 2020 2020  , west)...      
+00012ba0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+00012bb0: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+00012bc0: 7469 6f6e 3a20 746f 2072 656e 616d 6520  tion: to rename 
+00012bd0: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
+00012be0: 2020 2073 656c 6563 745f 706f 7274 735f     select_ports_
+00012bf0: 6f70 7469 6361 6c3a 2074 6f20 7365 6c65  optical: to sele
+00012c00: 6374 2070 6f72 7473 2e0a 2020 2020 2020  ct ports..      
+00012c10: 2020 2020 2020 7365 6c65 6374 5f70 6f72        select_por
+00012c20: 7473 5f65 6c65 6374 7269 6361 6c3a 0a20  ts_electrical:. 
+00012c30: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00012c40: 785f 6f70 7469 6361 6c3a 0a20 2020 2020  x_optical:.     
+00012c50: 2020 2020 2020 2070 7265 6669 785f 656c         prefix_el
+00012c60: 6563 7472 6963 616c 3a0a 0a20 2020 2020  ectrical:..     
+00012c70: 2020 202e 2e20 636f 6465 3a3a 0a0a 2020     .. code::..  
+00012c80: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+00012c90: 3020 204e 310a 2020 2020 2020 2020 2020  0  N1.          
+00012ca0: 2020 2020 2020 207c 5f5f 5f7c 5f0a 2020         |___|_.  
+00012cb0: 2020 2020 2020 2020 2020 5731 202d 7c20            W1 -| 
+00012cc0: 2020 2020 207c 2d20 4531 0a20 2020 2020       |- E1.     
+00012cd0: 2020 2020 2020 2020 2020 207c 2020 2020             |    
+00012ce0: 2020 7c0a 2020 2020 2020 2020 2020 2020    |.            
+00012cf0: 5730 202d 7c5f 5f5f 5f5f 5f7c 2d20 4530  W0 -|______|- E0
+00012d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d10: 2020 7c20 2020 7c0a 2020 2020 2020 2020    |   |.        
+00012d20: 2020 2020 2020 2020 5330 2020 2053 310a          S0   S1.
+00012d30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012d40: 2020 2020 7365 6c66 2e69 735f 756e 6c6f      self.is_unlo
+00012d50: 636b 6564 2829 0a20 2020 2020 2020 2061  cked().        a
+00012d60: 7574 6f5f 7265 6e61 6d65 5f70 6f72 7473  uto_rename_ports
+00012d70: 5f6f 7269 656e 7461 7469 6f6e 2873 656c  _orientation(sel
+00012d80: 662c 202a 2a6b 7761 7267 7329 0a0a 2020  f, **kwargs)..  
+00012d90: 2020 6465 6620 6d6f 7665 280a 2020 2020    def move(.    
+00012da0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00012db0: 2020 6f72 6967 696e 3a20 466c 6f61 7432    origin: Float2
+00012dc0: 203d 2028 302c 2030 292c 0a20 2020 2020   = (0, 0),.     
+00012dd0: 2020 2064 6573 7469 6e61 7469 6f6e 3a20     destination: 
+00012de0: 466c 6f61 7432 207c 204e 6f6e 6520 3d20  Float2 | None = 
+00012df0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6178  None,.        ax
+00012e00: 6973 3a20 4178 6973 207c 204e 6f6e 6520  is: Axis | None 
+00012e10: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+00012e20: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
+00012e30: 2020 2020 2222 2252 6574 7572 6e73 206e      """Returns n
+00012e40: 6577 2043 6f6d 706f 6e65 6e74 2077 6974  ew Component wit
+00012e50: 6820 6120 6d6f 7665 6420 7265 6665 7265  h a moved refere
+00012e60: 6e63 6520 746f 2074 6865 206f 7269 6769  nce to the origi
+00012e70: 6e61 6c2e 0a0a 2020 2020 2020 2020 636f  nal...        co
+00012e80: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+00012e90: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00012ea0: 2020 2020 6f72 6967 696e 3a20 6f66 2063      origin: of c
+00012eb0: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
+00012ec0: 2020 2020 2020 6465 7374 696e 6174 696f        destinatio
+00012ed0: 6e3a 2078 2c20 792e 0a20 2020 2020 2020  n: x, y..       
+00012ee0: 2020 2020 2061 7869 733a 2078 206f 7220       axis: x or 
+00012ef0: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
+00012f00: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00012f10: 7565 4572 726f 7228 6d6f 7665 5f65 7272  ueError(move_err
+00012f20: 6f72 5f6d 6573 7361 6765 290a 0a20 2020  or_message)..   
+00012f30: 2064 6566 206d 6972 726f 7228 7365 6c66   def mirror(self
+00012f40: 2c20 7031 3a20 466c 6f61 7432 203d 2028  , p1: Float2 = (
+00012f50: 302c 2031 292c 2070 323a 2046 6c6f 6174  0, 1), p2: Float
+00012f60: 3220 3d20 2830 2c20 3029 2c20 2a2a 6b77  2 = (0, 0), **kw
+00012f70: 6172 6773 2920 2d3e 2043 6f6d 706f 6e65  args) -> Compone
+00012f80: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
+00012f90: 6574 7572 6e73 206e 6577 2043 6f6d 706f  eturns new Compo
+00012fa0: 6e65 6e74 2077 6974 6820 6120 6d69 7272  nent with a mirr
+00012fb0: 6f72 6564 2072 6566 6572 656e 6365 2e0a  ored reference..
+00012fc0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00012fd0: 2020 2020 2020 2020 2020 2070 313a 2066             p1: f
+00012fe0: 6972 7374 2070 6f69 6e74 2074 6f20 6465  irst point to de
+00012ff0: 6669 6e65 206d 6972 726f 7220 6178 6973  fine mirror axis
+00013000: 2e0a 2020 2020 2020 2020 2020 2020 7032  ..            p2
+00013010: 3a20 7365 636f 6e64 2070 6f69 6e74 2074  : second point t
+00013020: 6f20 6465 6669 6e65 206d 6972 726f 7220  o define mirror 
+00013030: 6178 6973 2e0a 2020 2020 2020 2020 2222  axis..        ""
+00013040: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00013050: 6473 6661 6374 6f72 792e 6675 6e63 7469  dsfactory.functi
+00013060: 6f6e 7320 696d 706f 7274 206d 6972 726f  ons import mirro
+00013070: 720a 0a20 2020 2020 2020 2072 6574 7572  r..        retur
+00013080: 6e20 6d69 7272 6f72 2863 6f6d 706f 6e65  n mirror(compone
+00013090: 6e74 3d73 656c 662c 2070 313d 7031 2c20  nt=self, p1=p1, 
+000130a0: 7032 3d70 322c 202a 2a6b 7761 7267 7329  p2=p2, **kwargs)
+000130b0: 0a0a 2020 2020 6465 6620 726f 7461 7465  ..    def rotate
+000130c0: 2873 656c 662c 2061 6e67 6c65 3a20 666c  (self, angle: fl
+000130d0: 6f61 7420 3d20 3930 2c20 2a2a 6b77 6172  oat = 90, **kwar
+000130e0: 6773 2920 2d3e 2043 6f6d 706f 6e65 6e74  gs) -> Component
+000130f0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00013100: 7572 6e73 206e 6577 2063 6f6d 706f 6e65  urns new compone
+00013110: 6e74 2077 6974 6820 6120 726f 7461 7465  nt with a rotate
+00013120: 6420 7265 6665 7265 6e63 6520 746f 2074  d reference to t
+00013130: 6865 206f 7269 6769 6e61 6c2e 0a0a 2020  he original...  
+00013140: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00013150: 2020 2020 2020 2020 616e 676c 653a 2069          angle: i
+00013160: 6e20 6465 6772 6565 732e 0a20 2020 2020  n degrees..     
+00013170: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00013180: 726f 6d20 6764 7366 6163 746f 7279 2e66  rom gdsfactory.f
+00013190: 756e 6374 696f 6e73 2069 6d70 6f72 7420  unctions import 
+000131a0: 726f 7461 7465 0a0a 2020 2020 2020 2020  rotate..        
+000131b0: 7265 7475 726e 2072 6f74 6174 6528 636f  return rotate(co
+000131c0: 6d70 6f6e 656e 743d 7365 6c66 2c20 616e  mponent=self, an
+000131d0: 676c 653d 616e 676c 652c 202a 2a6b 7761  gle=angle, **kwa
+000131e0: 7267 7329 0a0a 2020 2020 6465 6620 6164  rgs)..    def ad
+000131f0: 645f 7061 6464 696e 6728 7365 6c66 2c20  d_padding(self, 
+00013200: 2a2a 6b77 6172 6773 2920 2d3e 2043 6f6d  **kwargs) -> Com
+00013210: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
+00013220: 2222 2252 6574 7572 6e73 2073 616d 6520  """Returns same 
+00013230: 636f 6d70 6f6e 656e 7420 7769 7468 2070  component with p
+00013240: 6164 6469 6e67 2e0a 0a20 2020 2020 2020  adding...       
+00013250: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+00013260: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+00013270: 6e65 6e74 3a20 666f 7220 7061 6464 696e  nent: for paddin
+00013280: 672e 0a20 2020 2020 2020 2020 2020 206c  g..            l
+00013290: 6179 6572 733a 206c 6973 7420 6f66 206c  ayers: list of l
+000132a0: 6179 6572 732e 0a20 2020 2020 2020 2020  ayers..         
+000132b0: 2020 2073 7566 6669 7820 666f 7220 6e61     suffix for na
+000132c0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+000132d0: 6465 6661 756c 743a 2064 6566 6175 6c74  default: default
+000132e0: 2070 6164 6469 6e67 2028 3530 756d 292e   padding (50um).
+000132f0: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+00013300: 3a20 6e6f 7274 6820 7061 6464 696e 672e  : north padding.
+00013310: 0a20 2020 2020 2020 2020 2020 2062 6f74  .            bot
+00013320: 746f 6d3a 2073 6f75 7468 2070 6164 6469  tom: south paddi
+00013330: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+00013340: 7269 6768 743a 2065 6173 7420 7061 6464  right: east padd
+00013350: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+00013360: 206c 6566 743a 2077 6573 7420 7061 6464   left: west padd
+00013370: 696e 672e 0a20 2020 2020 2020 2022 2222  ing..        """
+00013380: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+00013390: 7366 6163 746f 7279 2e61 6464 5f70 6164  sfactory.add_pad
+000133a0: 6469 6e67 2069 6d70 6f72 7420 6164 645f  ding import add_
+000133b0: 7061 6464 696e 670a 0a20 2020 2020 2020  padding..       
+000133c0: 2072 6574 7572 6e20 6164 645f 7061 6464   return add_padd
+000133d0: 696e 6728 636f 6d70 6f6e 656e 743d 7365  ing(component=se
+000133e0: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
+000133f0: 2020 2064 6566 2061 6273 6f72 6228 7365     def absorb(se
+00013400: 6c66 2c20 7265 6665 7265 6e63 6529 202d  lf, reference) -
+00013410: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+00013420: 2020 2020 2022 2222 4162 736f 7262 7320       """Absorbs 
+00013430: 706f 6c79 676f 6e73 2066 726f 6d20 436f  polygons from Co
+00013440: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+00013450: 2069 6e74 6f20 436f 6d70 6f6e 656e 742e   into Component.
+00013460: 0a0a 2020 2020 2020 2020 4465 7374 726f  ..        Destro
+00013470: 7973 2074 6865 2072 6566 6572 656e 6365  ys the reference
+00013480: 2069 6e20 7468 6520 7072 6f63 6573 7320   in the process 
+00013490: 6275 7420 6b65 6570 696e 6720 7468 6520  but keeping the 
+000134a0: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
+000134b0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+000134c0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+000134d0: 6572 656e 6365 3a20 436f 6d70 6f6e 656e  erence: Componen
+000134e0: 7452 6566 6572 656e 6365 2074 6f20 6265  tReference to be
+000134f0: 2061 6273 6f72 6265 6420 696e 746f 2074   absorbed into t
+00013500: 6865 2043 6f6d 706f 6e65 6e74 2e0a 2020  he Component..  
+00013510: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013520: 2020 6966 2072 6566 6572 656e 6365 206e    if reference n
+00013530: 6f74 2069 6e20 7365 6c66 2e72 6566 6572  ot in self.refer
+00013540: 656e 6365 733a 0a20 2020 2020 2020 2020  ences:.         
+00013550: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00013560: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00013570: 2020 2020 2022 5468 6520 7265 6665 7265       "The refere
+00013580: 6e63 6520 796f 7520 6173 6b65 6420 746f  nce you asked to
+00013590: 2061 6273 6f72 6220 646f 6573 206e 6f74   absorb does not
+000135a0: 2065 7869 7374 2069 6e20 7468 6973 2043   exist in this C
+000135b0: 6f6d 706f 6e65 6e74 2e22 0a20 2020 2020  omponent.".     
+000135c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000135d0: 2072 6566 5f70 6f6c 7967 6f6e 7320 3d20   ref_polygons = 
+000135e0: 7265 6665 7265 6e63 652e 6765 745f 706f  reference.get_po
+000135f0: 6c79 676f 6e73 280a 2020 2020 2020 2020  lygons(.        
+00013600: 2020 2020 6279 5f73 7065 633d 4661 6c73      by_spec=Fals
+00013610: 652c 2069 6e63 6c75 6465 5f70 6174 6873  e, include_paths
+00013620: 3d46 616c 7365 2c20 6173 5f61 7272 6179  =False, as_array
+00013630: 3d46 616c 7365 0a20 2020 2020 2020 2029  =False.        )
+00013640: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+00013650: 6464 5f70 6f6c 7967 6f6e 7328 2a72 6566  dd_polygons(*ref
+00013660: 5f70 6f6c 7967 6f6e 7329 0a0a 2020 2020  _polygons)..    
+00013670: 2020 2020 7365 6c66 2e61 6464 2872 6566      self.add(ref
+00013680: 6572 656e 6365 2e67 6574 5f6c 6162 656c  erence.get_label
+00013690: 7328 2929 0a20 2020 2020 2020 2073 656c  s()).        sel
+000136a0: 662e 6164 6428 7265 6665 7265 6e63 652e  f.add(reference.
+000136b0: 6765 745f 7061 7468 7328 2929 0a20 2020  get_paths()).   
+000136c0: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+000136d0: 2872 6566 6572 656e 6365 290a 2020 2020  (reference).    
+000136e0: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
+000136f0: 0a20 2020 2064 6566 2072 656d 6f76 6528  .    def remove(
+00013700: 7365 6c66 2c20 6974 656d 7329 3a0a 2020  self, items):.  
+00013710: 2020 2020 2020 2222 2252 656d 6f76 6573        """Removes
+00013720: 2069 7465 6d73 2066 726f 6d20 6120 436f   items from a Co
+00013730: 6d70 6f6e 656e 742c 2077 6869 6368 2063  mponent, which c
+00013740: 616e 2069 6e63 6c75 6465 2050 6f72 7473  an include Ports
+00013750: 2c20 506f 6c79 676f 6e53 6574 7320 5c0a  , PolygonSets \.
+00013760: 2020 2020 2020 2020 4365 6c6c 5265 6665          CellRefe
+00013770: 7265 6e63 6573 2c20 436f 6d70 6f6e 656e  rences, Componen
+00013780: 7452 6566 6572 656e 6365 7320 616e 6420  tReferences and 
+00013790: 4c61 6265 6c73 2e0a 0a20 2020 2020 2020  Labels...       
+000137a0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000137b0: 2020 2069 7465 6d73 3a20 6c69 7374 206f     items: list o
+000137c0: 6620 4974 656d 7320 746f 2062 6520 7265  f Items to be re
+000137d0: 6d6f 7665 6420 6672 6f6d 2074 6865 2043  moved from the C
+000137e0: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
+000137f0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00013800: 206e 6f74 2068 6173 6174 7472 2869 7465   not hasattr(ite
+00013810: 6d73 2c20 225f 5f69 7465 725f 5f22 293a  ms, "__iter__"):
+00013820: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+00013830: 6d73 203d 205b 6974 656d 735d 0a20 2020  ms = [items].   
+00013840: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+00013850: 2069 7465 6d73 3a0a 2020 2020 2020 2020   items:.        
+00013860: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00013870: 6528 6974 656d 2c20 506f 7274 293a 0a20  e(item, Port):. 
+00013880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013890: 656c 662e 706f 7274 7320 3d20 7b6b 3a20  elf.ports = {k: 
+000138a0: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
+000138b0: 6c66 2e70 6f72 7473 2e69 7465 6d73 2829  lf.ports.items()
+000138c0: 2069 6620 7620 213d 2069 7465 6d7d 0a20   if v != item}. 
+000138d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000138e0: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
+000138f0: 2067 6473 746b 2e52 6566 6572 656e 6365   gdstk.Reference
+00013900: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00013910: 2020 2073 656c 662e 5f63 656c 6c2e 7265     self._cell.re
+00013920: 6d6f 7665 2869 7465 6d29 0a20 2020 2020  move(item).     
+00013930: 2020 2020 2020 2020 2020 2069 7465 6d2e             item.
+00013940: 6f77 6e65 7220 3d20 4e6f 6e65 0a20 2020  owner = None.   
+00013950: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00013960: 696e 7374 616e 6365 2869 7465 6d2c 2043  instance(item, C
+00013970: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00013980: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00013990: 2020 2020 7365 6c66 2e72 6566 6572 656e      self.referen
+000139a0: 6365 732e 7265 6d6f 7665 2869 7465 6d29  ces.remove(item)
+000139b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000139c0: 2073 656c 662e 5f63 656c 6c2e 7265 6d6f   self._cell.remo
+000139d0: 7665 2869 7465 6d2e 5f72 6566 6572 656e  ve(item._referen
+000139e0: 6365 290a 2020 2020 2020 2020 2020 2020  ce).            
+000139f0: 2020 2020 6974 656d 2e6f 776e 6572 203d      item.owner =
+00013a00: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00013a10: 2020 2020 2020 7365 6c66 2e5f 6e61 6d65        self._name
+00013a20: 645f 7265 6665 7265 6e63 6573 2e70 6f70  d_references.pop
+00013a30: 2869 7465 6d2e 6e61 6d65 290a 2020 2020  (item.name).    
+00013a40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00013a50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00013a60: 6c66 2e5f 6365 6c6c 2e72 656d 6f76 6528  lf._cell.remove(
+00013a70: 6974 656d 290a 0a20 2020 2020 2020 2073  item)..        s
+00013a80: 656c 662e 5f62 625f 7661 6c69 6420 3d20  elf._bb_valid = 
+00013a90: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+00013aa0: 7475 726e 2073 656c 660a 0a20 2020 2064  turn self..    d
+00013ab0: 6566 2068 6173 685f 6765 6f6d 6574 7279  ef hash_geometry
+00013ac0: 2873 656c 662c 2070 7265 6369 7369 6f6e  (self, precision
+00013ad0: 3a20 666c 6f61 7420 3d20 3165 2d34 2920  : float = 1e-4) 
+00013ae0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+00013af0: 2222 2252 6574 7572 6e73 2061 6e20 5348  """Returns an SH
+00013b00: 4131 2068 6173 6820 6f66 2074 6865 2067  A1 hash of the g
+00013b10: 656f 6d65 7472 7920 696e 2074 6865 2043  eometry in the C
+00013b20: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
+00013b30: 2020 2046 6f72 2065 6163 6820 6c61 7965     For each laye
+00013b40: 722c 2065 6163 6820 706f 6c79 676f 6e20  r, each polygon 
+00013b50: 6973 2069 6e64 6976 6964 7561 6c6c 7920  is individually 
+00013b60: 6861 7368 6564 2061 6e64 2074 6865 6e20  hashed and then 
+00013b70: 7468 6520 706f 6c79 676f 6e20 6861 7368  the polygon hash
+00013b80: 6573 0a20 2020 2020 2020 2061 7265 2073  es.        are s
+00013b90: 6f72 7465 642c 2074 6f20 656e 7375 7265  orted, to ensure
+00013ba0: 2074 6865 2068 6173 6820 7374 6179 7320   the hash stays 
+00013bb0: 636f 6e73 7461 6e74 2072 6567 6172 646c  constant regardl
+00013bc0: 6573 7320 6f66 2074 6865 206f 7264 6572  ess of the order
+00013bd0: 696e 670a 2020 2020 2020 2020 7468 6520  ing.        the 
+00013be0: 706f 6c79 676f 6e73 2e20 2053 696d 696c  polygons.  Simil
+00013bf0: 6172 6c79 2c20 7468 6520 6c61 7965 7273  arly, the layers
+00013c00: 2061 7265 2073 6f72 7465 6420 6279 2028   are sorted by (
+00013c10: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+00013c20: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00013c30: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00013c40: 6369 7369 6f6e 3a20 526f 756e 6469 6e67  cision: Rounding
+00013c50: 2070 7265 6369 7369 6f6e 2066 6f72 2074   precision for t
+00013c60: 6865 2074 6865 206f 626a 6563 7473 2069  he the objects i
+00013c70: 6e20 7468 6520 436f 6d70 6f6e 656e 742e  n the Component.
+00013c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013c90: 2046 6f72 2069 6e73 7461 6e63 652c 2061   For instance, a
+00013ca0: 2070 7265 6369 7369 6f6e 206f 6620 3165   precision of 1e
+00013cb0: 2d32 2077 696c 6c20 726f 756e 6420 6120  -2 will round a 
+00013cc0: 706f 696e 7420 6174 0a20 2020 2020 2020  point at.       
+00013cd0: 2020 2020 2020 2020 2028 302e 3132 342c           (0.124,
+00013ce0: 2031 2e37 3438 2920 746f 2028 302e 3132   1.748) to (0.12
+00013cf0: 2c20 312e 3735 292e 0a0a 2020 2020 2020  , 1.75)...      
+00013d00: 2020 2222 220a 2020 2020 2020 2020 706f    """.        po
+00013d10: 6c79 676f 6e73 5f62 795f 7370 6563 203d  lygons_by_spec =
+00013d20: 2073 656c 662e 6765 745f 706f 6c79 676f   self.get_polygo
+00013d30: 6e73 2862 795f 7370 6563 3d54 7275 652c  ns(by_spec=True,
+00013d40: 2061 735f 6172 7261 793d 4661 6c73 6529   as_array=False)
+00013d50: 0a20 2020 2020 2020 206c 6179 6572 7320  .        layers 
+00013d60: 3d20 6e70 2e61 7272 6179 286c 6973 7428  = np.array(list(
+00013d70: 706f 6c79 676f 6e73 5f62 795f 7370 6563  polygons_by_spec
+00013d80: 2e6b 6579 7328 2929 290a 2020 2020 2020  .keys())).      
+00013d90: 2020 736f 7274 6564 5f6c 6179 6572 7320    sorted_layers 
+00013da0: 3d20 6c61 7965 7273 5b6e 702e 6c65 7873  = layers[np.lexs
+00013db0: 6f72 7428 286c 6179 6572 735b 3a2c 2030  ort((layers[:, 0
+00013dc0: 5d2c 206c 6179 6572 735b 3a2c 2031 5d29  ], layers[:, 1])
+00013dd0: 295d 0a0a 2020 2020 2020 2020 6669 6e61  )]..        fina
+00013de0: 6c5f 6861 7368 203d 2068 6173 686c 6962  l_hash = hashlib
+00013df0: 2e73 6861 3128 290a 2020 2020 2020 2020  .sha1().        
+00013e00: 666f 7220 6c61 7965 7220 696e 2073 6f72  for layer in sor
+00013e10: 7465 645f 6c61 7965 7273 3a0a 2020 2020  ted_layers:.    
+00013e20: 2020 2020 2020 2020 6c61 7965 725f 6861          layer_ha
+00013e30: 7368 203d 2068 6173 686c 6962 2e73 6861  sh = hashlib.sha
+00013e40: 3128 6c61 7965 722e 6173 7479 7065 286e  1(layer.astype(n
+00013e50: 702e 696e 7436 3429 292e 6469 6765 7374  p.int64)).digest
+00013e60: 2829 0a20 2020 2020 2020 2020 2020 2070  ().            p
+00013e70: 6f6c 7967 6f6e 7320 3d20 706f 6c79 676f  olygons = polygo
+00013e80: 6e73 5f62 795f 7370 6563 5b74 7570 6c65  ns_by_spec[tuple
+00013e90: 286c 6179 6572 295d 0a20 2020 2020 2020  (layer)].       
+00013ea0: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
+00013eb0: 5b5f 726e 6428 702e 706f 696e 7473 2c20  [_rnd(p.points, 
+00013ec0: 7072 6563 6973 696f 6e29 2066 6f72 2070  precision) for p
+00013ed0: 2069 6e20 706f 6c79 676f 6e73 5d0a 2020   in polygons].  
+00013ee0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+00013ef0: 6e5f 6861 7368 6573 203d 206e 702e 736f  n_hashes = np.so
+00013f00: 7274 285b 6861 7368 6c69 622e 7368 6131  rt([hashlib.sha1
+00013f10: 2870 292e 6469 6765 7374 2829 2066 6f72  (p).digest() for
+00013f20: 2070 2069 6e20 706f 6c79 676f 6e73 5d29   p in polygons])
+00013f30: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
+00013f40: 616c 5f68 6173 682e 7570 6461 7465 286c  al_hash.update(l
+00013f50: 6179 6572 5f68 6173 6829 0a20 2020 2020  ayer_hash).     
+00013f60: 2020 2020 2020 2066 6f72 2070 6820 696e         for ph in
+00013f70: 2070 6f6c 7967 6f6e 5f68 6173 6865 733a   polygon_hashes:
+00013f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013f90: 2066 696e 616c 5f68 6173 682e 7570 6461   final_hash.upda
+00013fa0: 7465 2870 6829 0a0a 2020 2020 2020 2020  te(ph)..        
+00013fb0: 7265 7475 726e 2066 696e 616c 5f68 6173  return final_has
+00013fc0: 682e 6865 7864 6967 6573 7428 290a 0a20  h.hexdigest().. 
+00013fd0: 2020 2064 6566 2067 6574 5f6c 6162 656c     def get_label
+00013fe0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00013ff0: 2061 7070 6c79 5f72 6570 6574 6974 696f   apply_repetitio
+00014000: 6e73 3d54 7275 652c 2064 6570 7468 3a20  ns=True, depth: 
+00014010: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
+00014020: 652c 206c 6179 6572 3d4e 6f6e 650a 2020  e, layer=None.  
+00014030: 2020 2920 2d3e 206c 6973 745b 4c61 6265    ) -> list[Labe
+00014040: 6c5d 3a0a 2020 2020 2020 2020 2222 2252  l]:.        """R
+00014050: 6574 7572 6e20 6c61 6265 6c73 2e0a 0a20  eturn labels... 
+00014060: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00014070: 2020 2020 2020 2020 2061 7070 6c79 5f72           apply_r
+00014080: 6570 6574 6974 696f 6e73 3a2e 0a20 2020  epetitions:..   
+00014090: 2020 2020 2020 2020 2064 6570 7468 3a20           depth: 
+000140a0: 4e6f 6e65 2072 6574 7572 6e73 2061 6c6c  None returns all
+000140b0: 206c 6162 656c 7320 616e 6420 3020 746f   labels and 0 to
+000140c0: 7020 6c65 7665 6c2e 0a20 2020 2020 2020  p level..       
+000140d0: 2020 2020 206c 6179 6572 3a20 6c61 7965       layer: laye
+000140e0: 7273 7065 632e 0a20 2020 2020 2020 2022  rspec..        "
+000140f0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00014100: 6764 7366 6163 746f 7279 2e70 646b 2069  gdsfactory.pdk i
+00014110: 6d70 6f72 7420 6765 745f 6c61 7965 720a  mport get_layer.
+00014120: 0a20 2020 2020 2020 2069 6620 6c61 7965  .        if laye
+00014130: 723a 0a20 2020 2020 2020 2020 2020 206c  r:.            l
+00014140: 6179 6572 2c20 7465 7874 7479 7065 203d  ayer, texttype =
+00014150: 2067 6574 5f6c 6179 6572 286c 6179 6572   get_layer(layer
+00014160: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00014170: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00014180: 7479 7065 203d 204e 6f6e 650a 2020 2020  type = None.    
+00014190: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000141a0: 5f63 656c 6c2e 6765 745f 6c61 6265 6c73  _cell.get_labels
+000141b0: 280a 2020 2020 2020 2020 2020 2020 6170  (.            ap
+000141c0: 706c 795f 7265 7065 7469 7469 6f6e 733d  ply_repetitions=
+000141d0: 6170 706c 795f 7265 7065 7469 7469 6f6e  apply_repetition
+000141e0: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
+000141f0: 6570 7468 3d64 6570 7468 2c0a 2020 2020  epth=depth,.    
+00014200: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
+00014210: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
+00014220: 2074 6578 7474 7970 653d 7465 7874 7479   texttype=textty
+00014230: 7065 2c0a 2020 2020 2020 2020 290a 0a20  pe,.        ).. 
+00014240: 2020 2064 6566 2072 656d 6f76 655f 6c61     def remove_la
+00014250: 6265 6c73 2873 656c 6629 202d 3e20 4e6f  bels(self) -> No
+00014260: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
+00014270: 656d 6f76 6520 6c61 6265 6c73 2e22 2222  emove labels."""
+00014280: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00014290: 656c 6c2e 7265 6d6f 7665 282a 7365 6c66  ell.remove(*self
+000142a0: 2e6c 6162 656c 7329 0a0a 2020 2020 2320  .labels)..    # 
+000142b0: 4465 7072 6563 6174 6564 0a20 2020 2064  Deprecated.    d
+000142c0: 6566 2067 6574 5f69 6e66 6f28 7365 6c66  ef get_info(self
+000142d0: 293a 0a20 2020 2020 2020 2022 2222 4761  ):.        """Ga
+000142e0: 7468 6572 7320 7468 6520 2e69 6e66 6f20  thers the .info 
+000142f0: 6469 6374 696f 6e61 7269 6573 2066 726f  dictionaries fro
+00014300: 6d20 6576 6572 7920 7375 622d 436f 6d70  m every sub-Comp
+00014310: 6f6e 656e 7420 616e 6420 7265 7475 726e  onent and return
+00014320: 7320 7468 656d 2069 6e20 6120 6c69 7374  s them in a list
+00014330: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00014340: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+00014350: 7468 3a20 696e 7420 6f72 204e 6f6e 650a  th: int or None.
+00014360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014370: 4966 206e 6f74 204e 6f6e 652c 2064 6566  If not None, def
+00014380: 696e 6573 2066 726f 6d20 686f 7720 6d61  ines from how ma
+00014390: 6e79 2072 6566 6572 656e 6365 206c 6576  ny reference lev
+000143a0: 656c 7320 746f 0a20 2020 2020 2020 2020  els to.         
+000143b0: 2020 2020 2020 2072 6574 7269 6576 6520         retrieve 
+000143c0: 506f 7274 7320 6672 6f6d 2e0a 0a20 2020  Ports from...   
+000143d0: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+000143e0: 2020 2020 2020 2020 2020 6c69 7374 206f            list o
+000143f0: 6620 6469 6374 696f 6e61 7269 6573 0a20  f dictionaries. 
+00014400: 2020 2020 2020 2020 2020 2020 2020 204c                 L
+00014410: 6973 7420 6f66 2074 6865 2022 2e69 6e66  ist of the ".inf
+00014420: 6f22 2070 726f 7065 7274 7920 6469 6374  o" property dict
+00014430: 696f 6e61 7269 6573 2066 726f 6d20 616c  ionaries from al
+00014440: 6c20 7375 622d 436f 6d70 6f6e 656e 7473  l sub-Components
+00014450: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014460: 2020 2020 2044 5f6c 6973 7420 3d20 7365       D_list = se
+00014470: 6c66 2e67 6574 5f64 6570 656e 6465 6e63  lf.get_dependenc
+00014480: 6965 7328 7265 6375 7273 6976 653d 5472  ies(recursive=Tr
+00014490: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
+000144a0: 726e 205b 442e 696e 666f 2e63 6f70 7928  rn [D.info.copy(
+000144b0: 2920 666f 7220 4420 696e 2044 5f6c 6973  ) for D in D_lis
+000144c0: 745d 0a0a 2020 2020 6465 6620 7265 6d61  t]..    def rema
+000144d0: 705f 6c61 7965 7273 280a 2020 2020 2020  p_layers(.      
+000144e0: 2020 7365 6c66 2c20 6c61 7965 726d 6170    self, layermap
+000144f0: 2c20 696e 636c 7564 655f 6c61 6265 6c73  , include_labels
+00014500: 3a20 626f 6f6c 203d 2054 7275 652c 2069  : bool = True, i
+00014510: 6e63 6c75 6465 5f70 6174 6873 3a20 626f  nclude_paths: bo
+00014520: 6f6c 203d 2054 7275 650a 2020 2020 2920  ol = True.    ) 
+00014530: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+00014540: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00014550: 2061 2063 6f70 7920 6f66 2074 6865 2063   a copy of the c
+00014560: 6f6d 706f 6e65 6e74 2077 6974 6820 7265  omponent with re
+00014570: 6d61 7070 6564 206c 6179 6572 732e 0a0a  mapped layers...
+00014580: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00014590: 2020 2020 2020 2020 2020 6c61 7965 726d            layerm
+000145a0: 6170 3a20 4469 6374 696f 6e61 7279 206f  ap: Dictionary o
+000145b0: 6620 7661 6c75 6573 2069 6e20 666f 726d  f values in form
+000145c0: 6174 207b 6c61 7965 725f 6672 6f6d 203a  at {layer_from :
+000145d0: 206c 6179 6572 5f74 6f7d 2e0a 2020 2020   layer_to}..    
+000145e0: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+000145f0: 6c61 6265 6c73 3a20 5365 6c65 6374 7320  labels: Selects 
+00014600: 7768 6574 6865 7220 746f 206d 6f76 6520  whether to move 
+00014610: 4c61 6265 6c73 2061 6c6f 6e67 2077 6974  Labels along wit
+00014620: 6820 706f 6c79 676f 6e73 2e0a 2020 2020  h polygons..    
+00014630: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+00014640: 7061 7468 733a 2053 656c 6563 7473 2077  paths: Selects w
+00014650: 6865 7468 6572 2074 6f20 6d6f 7665 2050  hether to move P
+00014660: 6174 6873 2061 6c6f 6e67 2077 6974 6820  aths along with 
+00014670: 706f 6c79 676f 6e73 2e0a 2020 2020 2020  polygons..      
+00014680: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
+00014690: 6d70 6f6e 656e 7420 3d20 7365 6c66 2e63  mponent = self.c
+000146a0: 6f70 7928 290a 2020 2020 2020 2020 6c61  opy().        la
+000146b0: 7965 726d 6170 203d 207b 5f70 6172 7365  yermap = {_parse
+000146c0: 5f6c 6179 6572 286b 293a 205f 7061 7273  _layer(k): _pars
+000146d0: 655f 6c61 7965 7228 7629 2066 6f72 206b  e_layer(v) for k
+000146e0: 2c20 7620 696e 206c 6179 6572 6d61 702e  , v in layermap.
+000146f0: 6974 656d 7328 297d 0a0a 2020 2020 2020  items()}..      
+00014700: 2020 616c 6c5f 4420 3d20 6c69 7374 2863    all_D = list(c
+00014710: 6f6d 706f 6e65 6e74 2e67 6574 5f64 6570  omponent.get_dep
+00014720: 656e 6465 6e63 6965 7328 5472 7565 2929  endencies(True))
+00014730: 0a20 2020 2020 2020 2061 6c6c 5f44 2e61  .        all_D.a
+00014740: 7070 656e 6428 636f 6d70 6f6e 656e 7429  ppend(component)
+00014750: 0a20 2020 2020 2020 2066 6f72 2044 2069  .        for D i
+00014760: 6e20 616c 6c5f 443a 0a20 2020 2020 2020  n all_D:.       
+00014770: 2020 2020 2066 6f72 2070 2069 6e20 442e       for p in D.
+00014780: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
+00014790: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
+000147a0: 3d20 2870 2e6c 6179 6572 2c20 702e 6461  = (p.layer, p.da
+000147b0: 7461 7479 7065 290a 2020 2020 2020 2020  tatype).        
+000147c0: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+000147d0: 2069 6e20 6c61 7965 726d 6170 3a0a 2020   in layermap:.  
+000147e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147f0: 2020 6e65 775f 6c61 7965 7220 3d20 6c61    new_layer = la
+00014800: 7965 726d 6170 5b6c 6179 6572 5d0a 2020  yermap[layer].  
+00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014820: 2020 702e 6c61 7965 7220 3d20 6e65 775f    p.layer = new_
+00014830: 6c61 7965 725b 305d 0a20 2020 2020 2020  layer[0].       
+00014840: 2020 2020 2020 2020 2020 2020 2070 2e64               p.d
+00014850: 6174 6174 7970 6520 3d20 6e65 775f 6c61  atatype = new_la
+00014860: 7965 725b 315d 0a20 2020 2020 2020 2020  yer[1].         
+00014870: 2020 2069 6620 696e 636c 7564 655f 6c61     if include_la
+00014880: 6265 6c73 3a0a 2020 2020 2020 2020 2020  bels:.          
+00014890: 2020 2020 2020 666f 7220 6c61 6265 6c20        for label 
+000148a0: 696e 2044 2e6c 6162 656c 733a 0a20 2020  in D.labels:.   
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 206f 7269 6769 6e61 6c5f 6c61 7965 7220   original_layer 
+000148d0: 3d20 286c 6162 656c 2e6c 6179 6572 2c20  = (label.layer, 
+000148e0: 6c61 6265 6c2e 7465 7874 7479 7065 290a  label.texttype).
 000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 206e 6577 5f6c 6179 6572 203d 206c 6179   new_layer = lay
-00014910: 6572 6d61 705b 6f72 6967 696e 616c 5f6c  ermap[original_l
-00014920: 6179 6572 5d0a 2020 2020 2020 2020 2020  ayer].          
-00014930: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00014940: 6265 6c2e 6c61 7965 7220 3d20 6e65 775f  bel.layer = new_
-00014950: 6c61 7965 725b 305d 0a20 2020 2020 2020  layer[0].       
-00014960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014970: 206c 6162 656c 2e74 6578 7474 7970 6520   label.texttype 
-00014980: 3d20 6e65 775f 6c61 7965 725b 315d 0a0a  = new_layer[1]..
-00014990: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000149a0: 6e63 6c75 6465 5f70 6174 6873 3a0a 2020  nclude_paths:.  
-000149b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000149c0: 7220 7061 7468 2069 6e20 442e 7061 7468  r path in D.path
-000149d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000149e0: 2020 2020 2020 206e 6577 5f6c 6179 6572         new_layer
-000149f0: 7320 3d20 6c69 7374 2870 6174 682e 6c61  s = list(path.la
-00014a00: 7965 7273 290a 2020 2020 2020 2020 2020  yers).          
-00014a10: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00014a20: 7461 7479 7065 7320 3d20 6c69 7374 2870  tatypes = list(p
-00014a30: 6174 682e 6461 7461 7479 7065 7329 0a20  ath.datatypes). 
-00014a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a50: 2020 2066 6f72 206c 6179 6572 5f6e 756d     for layer_num
-00014a60: 6265 7220 696e 2072 616e 6765 286c 656e  ber in range(len
-00014a70: 286e 6577 5f6c 6179 6572 7329 293a 0a20  (new_layers)):. 
-00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a90: 2020 2020 2020 206f 7269 6769 6e61 6c5f         original_
-00014aa0: 6c61 7965 7220 3d20 5f70 6172 7365 5f6c  layer = _parse_l
-00014ab0: 6179 6572 280a 2020 2020 2020 2020 2020  ayer(.          
-00014ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ad0: 2020 286e 6577 5f6c 6179 6572 735b 6c61    (new_layers[la
-00014ae0: 7965 725f 6e75 6d62 6572 5d2c 206e 6577  yer_number], new
-00014af0: 5f64 6174 6174 7970 6573 5b6c 6179 6572  _datatypes[layer
-00014b00: 5f6e 756d 6265 725d 290a 2020 2020 2020  _number]).      
-00014b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00014b30: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00014b40: 7269 6769 6e61 6c5f 6c61 7965 7220 696e  riginal_layer in
-00014b50: 206c 6179 6572 6d61 703a 0a20 2020 2020   layermap:.     
-00014b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b70: 2020 2020 2020 206e 6577 5f6c 6179 6572         new_layer
-00014b80: 203d 206c 6179 6572 6d61 705b 6f72 6967   = layermap[orig
-00014b90: 696e 616c 5f6c 6179 6572 5d0a 2020 2020  inal_layer].    
+00014900: 2020 2020 6f72 6967 696e 616c 5f6c 6179      original_lay
+00014910: 6572 203d 205f 7061 7273 655f 6c61 7965  er = _parse_laye
+00014920: 7228 6f72 6967 696e 616c 5f6c 6179 6572  r(original_layer
+00014930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014940: 2020 2020 2020 6966 206f 7269 6769 6e61        if origina
+00014950: 6c5f 6c61 7965 7220 696e 206c 6179 6572  l_layer in layer
+00014960: 6d61 703a 0a20 2020 2020 2020 2020 2020  map:.           
+00014970: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00014980: 5f6c 6179 6572 203d 206c 6179 6572 6d61  _layer = layerma
+00014990: 705b 6f72 6967 696e 616c 5f6c 6179 6572  p[original_layer
+000149a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000149b0: 2020 2020 2020 2020 2020 6c61 6265 6c2e            label.
+000149c0: 6c61 7965 7220 3d20 6e65 775f 6c61 7965  layer = new_laye
+000149d0: 725b 305d 0a20 2020 2020 2020 2020 2020  r[0].           
+000149e0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+000149f0: 656c 2e74 6578 7474 7970 6520 3d20 6e65  el.texttype = ne
+00014a00: 775f 6c61 7965 725b 315d 0a0a 2020 2020  w_layer[1]..    
+00014a10: 2020 2020 2020 2020 6966 2069 6e63 6c75          if inclu
+00014a20: 6465 5f70 6174 6873 3a0a 2020 2020 2020  de_paths:.      
+00014a30: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+00014a40: 7468 2069 6e20 442e 7061 7468 733a 0a20  th in D.paths:. 
+00014a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a60: 2020 206e 6577 5f6c 6179 6572 7320 3d20     new_layers = 
+00014a70: 6c69 7374 2870 6174 682e 6c61 7965 7273  list(path.layers
+00014a80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014a90: 2020 2020 2020 6e65 775f 6461 7461 7479        new_dataty
+00014aa0: 7065 7320 3d20 6c69 7374 2870 6174 682e  pes = list(path.
+00014ab0: 6461 7461 7479 7065 7329 0a20 2020 2020  datatypes).     
+00014ac0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014ad0: 6f72 206c 6179 6572 5f6e 756d 6265 7220  or layer_number 
+00014ae0: 696e 2072 616e 6765 286c 656e 286e 6577  in range(len(new
+00014af0: 5f6c 6179 6572 7329 293a 0a20 2020 2020  _layers)):.     
+00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b10: 2020 206f 7269 6769 6e61 6c5f 6c61 7965     original_laye
+00014b20: 7220 3d20 5f70 6172 7365 5f6c 6179 6572  r = _parse_layer
+00014b30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00014b40: 2020 2020 2020 2020 2020 2020 2020 286e                (n
+00014b50: 6577 5f6c 6179 6572 735b 6c61 7965 725f  ew_layers[layer_
+00014b60: 6e75 6d62 6572 5d2c 206e 6577 5f64 6174  number], new_dat
+00014b70: 6174 7970 6573 5b6c 6179 6572 5f6e 756d  atypes[layer_num
+00014b80: 6265 725d 290a 2020 2020 2020 2020 2020  ber]).          
+00014b90: 2020 2020 2020 2020 2020 2020 2020 290a                ).
 00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bb0: 2020 2020 2020 2020 6e65 775f 6c61 7965          new_laye
-00014bc0: 7273 5b6c 6179 6572 5f6e 756d 6265 725d  rs[layer_number]
-00014bd0: 203d 206e 6577 5f6c 6179 6572 5b30 5d0a   = new_layer[0].
+00014bb0: 2020 2020 2020 2020 6966 206f 7269 6769          if origi
+00014bc0: 6e61 6c5f 6c61 7965 7220 696e 206c 6179  nal_layer in lay
+00014bd0: 6572 6d61 703a 0a20 2020 2020 2020 2020  ermap:.         
 00014be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bf0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00014c00: 6461 7461 7479 7065 735b 6c61 7965 725f  datatypes[layer_
-00014c10: 6e75 6d62 6572 5d20 3d20 6e65 775f 6c61  number] = new_la
-00014c20: 7965 725b 315d 0a20 2020 2020 2020 2020  yer[1].         
-00014c30: 2020 2020 2020 2020 2020 2070 6174 682e             path.
-00014c40: 7365 745f 6c61 7965 7273 282a 6e65 775f  set_layers(*new_
-00014c50: 6c61 7965 7273 290a 2020 2020 2020 2020  layers).        
-00014c60: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00014c70: 2e73 6574 5f64 6174 6174 7970 6573 282a  .set_datatypes(*
-00014c80: 6e65 775f 6461 7461 7479 7065 7329 0a20  new_datatypes). 
-00014c90: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00014ca0: 6d70 6f6e 656e 740a 0a20 2020 2064 6566  mponent..    def
-00014cb0: 2074 6f5f 3364 280a 2020 2020 2020 2020   to_3d(.        
-00014cc0: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
-00014cd0: 7965 725f 7669 6577 733a 204c 6179 6572  yer_views: Layer
-00014ce0: 5669 6577 7320 7c20 4e6f 6e65 203d 204e  Views | None = N
-00014cf0: 6f6e 652c 0a20 2020 2020 2020 206c 6179  one,.        lay
-00014d00: 6572 5f73 7461 636b 3a20 4c61 7965 7253  er_stack: LayerS
-00014d10: 7461 636b 207c 204e 6f6e 6520 3d20 4e6f  tack | None = No
-00014d20: 6e65 2c0a 2020 2020 2020 2020 6578 636c  ne,.        excl
-00014d30: 7564 655f 6c61 7965 7273 3a20 7475 706c  ude_layers: tupl
-00014d40: 655b 4c61 7965 722c 202e 2e2e 5d20 7c20  e[Layer, ...] | 
-00014d50: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00014d60: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
-00014d70: 6574 7572 6e20 436f 6d70 6f6e 656e 7420  eturn Component 
-00014d80: 3344 2074 7269 6d65 7368 2053 6365 6e65  3D trimesh Scene
-00014d90: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00014da0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-00014db0: 706f 6e65 6e74 3a20 746f 2065 7874 7275  ponent: to extru
-00014dc0: 6465 2069 6e20 3344 2e0a 2020 2020 2020  de in 3D..      
-00014dd0: 2020 2020 2020 6c61 7965 725f 7669 6577        layer_view
-00014de0: 733a 206c 6179 6572 2063 6f6c 6f72 7320  s: layer colors 
-00014df0: 6672 6f6d 204b 6c61 796f 7574 204c 6179  from Klayout Lay
-00014e00: 6572 2050 726f 7065 7274 6965 7320 6669  er Properties fi
-00014e10: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
-00014e20: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-00014e30: 6163 7469 7665 2050 444b 2e6c 6179 6572  active PDK.layer
-00014e40: 5f76 6965 7773 2e0a 2020 2020 2020 2020  _views..        
-00014e50: 2020 2020 6c61 7965 725f 7374 6163 6b3a      layer_stack:
-00014e60: 2063 6f6e 7461 696e 7320 7468 6963 6b6e   contains thickn
-00014e70: 6573 7320 616e 6420 7a6d 696e 2066 6f72  ess and zmin for
-00014e80: 2065 6163 6820 6c61 7965 722e 0a20 2020   each layer..   
-00014e90: 2020 2020 2020 2020 2020 2020 2044 6566               Def
-00014ea0: 6175 6c74 7320 746f 2061 6374 6976 6520  aults to active 
-00014eb0: 5044 4b2e 6c61 7965 725f 7374 6163 6b2e  PDK.layer_stack.
-00014ec0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00014ed0: 6c75 6465 5f6c 6179 6572 733a 206c 6179  lude_layers: lay
-00014ee0: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
-00014ef0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014f00: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00014f10: 746f 7279 2e65 7870 6f72 742e 746f 5f33  tory.export.to_3
-00014f20: 6420 696d 706f 7274 2074 6f5f 3364 0a0a  d import to_3d..
-00014f30: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00014f40: 6f5f 3364 280a 2020 2020 2020 2020 2020  o_3d(.          
-00014f50: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00014f60: 2020 2020 6c61 7965 725f 7669 6577 733d      layer_views=
-00014f70: 6c61 7965 725f 7669 6577 732c 0a20 2020  layer_views,.   
-00014f80: 2020 2020 2020 2020 206c 6179 6572 5f73           layer_s
-00014f90: 7461 636b 3d6c 6179 6572 5f73 7461 636b  tack=layer_stack
-00014fa0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
-00014fb0: 636c 7564 655f 6c61 7965 7273 3d65 7863  clude_layers=exc
-00014fc0: 6c75 6465 5f6c 6179 6572 732c 0a20 2020  lude_layers,.   
-00014fd0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00014fe0: 746f 5f6e 7028 0a20 2020 2020 2020 2073  to_np(.        s
-00014ff0: 656c 662c 0a20 2020 2020 2020 206e 6d5f  elf,.        nm_
-00015000: 7065 725f 7069 7865 6c3a 2069 6e74 203d  per_pixel: int =
-00015010: 2032 302c 0a20 2020 2020 2020 206c 6179   20,.        lay
-00015020: 6572 733a 204c 6179 6572 7320 3d20 2828  ers: Layers = ((
-00015030: 312c 2030 292c 292c 0a20 2020 2020 2020  1, 0),),.       
-00015040: 2076 616c 7565 733a 2074 7570 6c65 5b66   values: tuple[f
-00015050: 6c6f 6174 2c20 2e2e 2e5d 207c 204e 6f6e  loat, ...] | Non
-00015060: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00015070: 2020 7061 645f 7769 6474 683a 2069 6e74    pad_width: int
-00015080: 203d 2031 2c0a 2020 2020 2920 2d3e 206e   = 1,.    ) -> n
-00015090: 702e 6e64 6172 7261 793a 0a20 2020 2020  p.ndarray:.     
-000150a0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-000150b0: 7069 7865 6c61 7465 6420 6e75 6d70 7920  pixelated numpy 
-000150c0: 6172 7261 7920 6672 6f6d 2043 6f6d 706f  array from Compo
-000150d0: 6e65 6e74 2070 6f6c 7967 6f6e 732e 0a0a  nent polygons...
-000150e0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-000150f0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-00015100: 656e 743a 2043 6f6d 706f 6e65 6e74 2e0a  ent: Component..
-00015110: 2020 2020 2020 2020 2020 2020 6e6d 5f70              nm_p
-00015120: 6572 5f70 6978 656c 3a20 796f 7520 6361  er_pixel: you ca
-00015130: 6e20 676f 2066 726f 6d20 3230 2028 636f  n go from 20 (co
-00015140: 6172 7365 2920 746f 2034 2028 6669 6e65  arse) to 4 (fine
-00015150: 292e 0a20 2020 2020 2020 2020 2020 206c  )..            l
-00015160: 6179 6572 733a 2074 6f20 636f 6e76 6572  ayers: to conver
-00015170: 742e 204f 7264 6572 206d 6174 7465 7273  t. Order matters
-00015180: 2028 6c61 7474 6572 206f 7665 7277 7269   (latter overwri
-00015190: 7465 2066 6f72 6d65 7229 2e0a 2020 2020  te former)..    
-000151a0: 2020 2020 2020 2020 7661 6c75 6573 3a20          values: 
-000151b0: 6173 736f 6369 6174 6564 2074 6f20 6561  associated to ea
-000151c0: 6368 206c 6179 6572 2028 6465 6661 756c  ch layer (defaul
-000151d0: 7473 2074 6f20 3129 2e0a 2020 2020 2020  ts to 1)..      
-000151e0: 2020 2020 2020 7061 645f 7769 6474 683a        pad_width:
-000151f0: 2070 6164 6469 6e67 2070 6978 656c 7320   padding pixels 
-00015200: 6172 6f75 6e64 2074 6865 2069 6d61 6765  around the image
-00015210: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-00015220: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-00015230: 6163 746f 7279 2e65 7870 6f72 742e 746f  actory.export.to
-00015240: 5f6e 7020 696d 706f 7274 2074 6f5f 6e70  _np import to_np
-00015250: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00015260: 2074 6f5f 6e70 280a 2020 2020 2020 2020   to_np(.        
-00015270: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00015280: 2020 2020 2020 6e6d 5f70 6572 5f70 6978        nm_per_pix
-00015290: 656c 3d6e 6d5f 7065 725f 7069 7865 6c2c  el=nm_per_pixel,
-000152a0: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-000152b0: 6572 733d 6c61 7965 7273 2c0a 2020 2020  ers=layers,.    
-000152c0: 2020 2020 2020 2020 7661 6c75 6573 3d76          values=v
-000152d0: 616c 7565 732c 0a20 2020 2020 2020 2020  alues,.         
-000152e0: 2020 2070 6164 5f77 6964 7468 3d70 6164     pad_width=pad
-000152f0: 5f77 6964 7468 2c0a 2020 2020 2020 2020  _width,.        
-00015300: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-00015310: 5f73 746c 280a 2020 2020 2020 2020 7365  _stl(.        se
-00015320: 6c66 2c0a 2020 2020 2020 2020 6669 6c65  lf,.        file
-00015330: 7061 7468 3a20 7374 722c 0a20 2020 2020  path: str,.     
-00015340: 2020 206c 6179 6572 5f73 7461 636b 3a20     layer_stack: 
-00015350: 4c61 7965 7253 7461 636b 207c 204e 6f6e  LayerStack | Non
-00015360: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00015370: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
-00015380: 3a20 7475 706c 655b 4c61 7965 722c 202e  : tuple[Layer, .
-00015390: 2e2e 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ..] | None = Non
-000153a0: 652c 0a20 2020 2029 202d 3e20 4e6f 6e65  e,.    ) -> None
-000153b0: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
-000153c0: 7465 2061 2043 6f6d 706f 6e65 6e74 2074  te a Component t
-000153d0: 6f20 5354 4c20 666f 7220 3344 2070 7269  o STL for 3D pri
-000153e0: 6e74 696e 672e 0a0a 2020 2020 2020 2020  nting...        
-000153f0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00015400: 2020 6669 6c65 7061 7468 3a20 746f 2077    filepath: to w
-00015410: 7269 7465 2053 544c 2074 6f2e 0a20 2020  rite STL to..   
-00015420: 2020 2020 2020 2020 206c 6179 6572 5f73           layer_s
-00015430: 7461 636b 3a20 636f 6e74 6169 6e73 2074  tack: contains t
-00015440: 6869 636b 6e65 7373 2061 6e64 207a 6d69  hickness and zmi
-00015450: 6e20 666f 7220 6561 6368 206c 6179 6572  n for each layer
-00015460: 2e0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00015470: 636c 7564 655f 6c61 7965 7273 3a20 6c61  clude_layers: la
-00015480: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
-00015490: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-000154a0: 5f6c 6179 6572 5f6e 616d 653a 2049 6620  _layer_name: If 
-000154b0: 5472 7565 2c20 7573 6573 204c 6179 6572  True, uses Layer
-000154c0: 4c65 7665 6c20 6e61 6d65 7320 696e 206f  Level names in o
-000154d0: 7574 7075 7420 6669 6c65 6e61 6d65 7320  utput filenames 
-000154e0: 7261 7468 6572 2074 6861 6e20 6764 735f  rather than gds_
-000154f0: 6c61 7965 7220 616e 6420 6764 735f 6461  layer and gds_da
-00015500: 7461 7479 7065 2e0a 2020 2020 2020 2020  tatype..        
-00015510: 2020 2020 6875 6c6c 5f69 6e76 616c 6964      hull_invalid
-00015520: 5f70 6f6c 7967 6f6e 733a 2049 6620 5472  _polygons: If Tr
-00015530: 7565 2c20 7265 706c 6163 6573 2069 6e76  ue, replaces inv
-00015540: 616c 6964 2070 6f6c 7967 6f6e 7320 2864  alid polygons (d
-00015550: 6574 6572 6d69 6e65 6420 6279 2073 6861  etermined by sha
-00015560: 7065 6c79 2e50 6f6c 7967 6f6e 2e69 735f  pely.Polygon.is_
-00015570: 7661 6c69 6429 2077 6974 6820 6974 7320  valid) with its 
-00015580: 636f 6e76 6578 2068 756c 6c2e 0a20 2020  convex hull..   
-00015590: 2020 2020 2020 2020 2073 6361 6c65 3a20           scale: 
-000155a0: 4f70 7469 6f6e 616c 2066 6163 746f 7220  Optional factor 
-000155b0: 6279 2077 6869 6368 2074 6f20 7363 616c  by which to scal
-000155c0: 6520 6d65 7368 6573 2062 6566 6f72 6520  e meshes before 
-000155d0: 7772 6974 696e 672e 0a0a 2020 2020 2020  writing...      
-000155e0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-000155f0: 6f6d 2067 6473 6661 6374 6f72 792e 6578  om gdsfactory.ex
-00015600: 706f 7274 2e74 6f5f 7374 6c20 696d 706f  port.to_stl impo
-00015610: 7274 2074 6f5f 7374 6c0a 0a20 2020 2020  rt to_stl..     
-00015620: 2020 2074 6f5f 7374 6c28 0a20 2020 2020     to_stl(.     
-00015630: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00015640: 2020 2020 2020 2020 2066 696c 6570 6174           filepat
-00015650: 683d 6669 6c65 7061 7468 2c0a 2020 2020  h=filepath,.    
-00015660: 2020 2020 2020 2020 6c61 7965 725f 7374          layer_st
-00015670: 6163 6b3d 6c61 7965 725f 7374 6163 6b2c  ack=layer_stack,
-00015680: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00015690: 6c75 6465 5f6c 6179 6572 733d 6578 636c  lude_layers=excl
-000156a0: 7564 655f 6c61 7965 7273 2c0a 2020 2020  ude_layers,.    
-000156b0: 2020 2020 290a 0a20 2020 2064 6566 2077      )..    def w
-000156c0: 7269 7465 5f67 6572 6265 7228 7365 6c66  rite_gerber(self
-000156d0: 2c20 6469 7270 6174 682c 206c 6179 6572  , dirpath, layer
-000156e0: 6d61 705f 746f 5f67 6572 6265 725f 6c61  map_to_gerber_la
-000156f0: 7965 722c 206f 7074 696f 6e73 2920 2d3e  yer, options) ->
-00015700: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
-00015710: 726f 6d20 6764 7366 6163 746f 7279 2e65  rom gdsfactory.e
-00015720: 7870 6f72 742e 746f 5f67 6572 6265 7220  xport.to_gerber 
-00015730: 696d 706f 7274 2074 6f5f 6765 7262 6572  import to_gerber
-00015740: 0a0a 2020 2020 2020 2020 746f 5f67 6572  ..        to_ger
-00015750: 6265 7228 0a20 2020 2020 2020 2020 2020  ber(.           
-00015760: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-00015770: 2020 2064 6972 7061 7468 3d64 6972 7061     dirpath=dirpa
-00015780: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00015790: 6c61 7965 726d 6170 5f74 6f5f 6765 7262  layermap_to_gerb
-000157a0: 6572 5f6c 6179 6572 3d6c 6179 6572 6d61  er_layer=layerma
-000157b0: 705f 746f 5f67 6572 6265 725f 6c61 7965  p_to_gerber_laye
-000157c0: 722c 0a20 2020 2020 2020 2020 2020 206f  r,.            o
-000157d0: 7074 696f 6e73 3d6f 7074 696f 6e73 2c0a  ptions=options,.
-000157e0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000157f0: 6566 2074 6f5f 676d 7368 280a 2020 2020  ef to_gmsh(.    
-00015800: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00015810: 2020 7479 7065 2c0a 2020 2020 2020 2020    type,.        
-00015820: 7a3d 4e6f 6e65 2c0a 2020 2020 2020 2020  z=None,.        
-00015830: 7873 6563 7469 6f6e 5f62 6f75 6e64 733d  xsection_bounds=
-00015840: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
-00015850: 7965 725f 7374 6163 6b3d 4e6f 6e65 2c0a  yer_stack=None,.
-00015860: 2020 2020 2020 2020 7761 6665 725f 7061          wafer_pa
-00015870: 6464 696e 673d 302e 302c 0a20 2020 2020  dding=0.0,.     
-00015880: 2020 2077 6166 6572 5f6c 6179 6572 3d4c     wafer_layer=L
-00015890: 4159 4552 2e57 4146 4552 2c0a 2020 2020  AYER.WAFER,.    
-000158a0: 2020 2020 2a61 7267 732c 0a20 2020 2020      *args,.     
-000158b0: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-000158c0: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
-000158d0: 6574 7572 6e73 2061 2067 6d73 6820 6d73  eturns a gmsh ms
-000158e0: 6820 6f66 2074 6865 2063 6f6d 706f 6e65  h of the compone
-000158f0: 6e74 2066 6f72 2066 696e 6974 6520 656c  nt for finite el
-00015900: 656d 656e 7420 7369 6d75 6c61 7469 6f6e  ement simulation
-00015910: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
-00015920: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00015930: 2020 7479 7065 3a20 6f6e 6520 6f66 2022    type: one of "
-00015940: 7879 222c 2022 757a 222c 206f 7220 2233  xy", "uz", or "3
-00015950: 4422 2e20 4465 7465 726d 696e 6573 2074  D". Determines t
-00015960: 6865 2074 7970 6520 6f66 206d 6573 6820  he type of mesh 
-00015970: 746f 2072 6574 7572 6e2e 0a20 2020 2020  to return..     
-00015980: 2020 2020 2020 207a 3a20 7573 6564 2074         z: used t
-00015990: 6f20 6465 6669 6e65 207a 2d73 6c69 6365  o define z-slice
-000159a0: 2066 6f72 2078 7920 6d65 7368 696e 670a   for xy meshing.
-000159b0: 2020 2020 2020 2020 2020 2020 7873 6563              xsec
-000159c0: 7469 6f6e 5f62 6f75 6e64 733a 2075 7365  tion_bounds: use
-000159d0: 6420 746f 2064 6566 696e 6520 696e 2d70  d to define in-p
-000159e0: 6c61 6e65 206c 696e 6520 666f 7220 757a  lane line for uz
-000159f0: 206d 6573 6869 6e67 0a20 2020 2020 2020   meshing.       
-00015a00: 2020 2020 2077 6166 6572 5f70 6164 6469       wafer_paddi
-00015a10: 6e67 3a20 7061 6464 696e 6720 6265 796f  ng: padding beyo
-00015a20: 6e64 2062 626f 7820 746f 2061 6464 2074  nd bbox to add t
-00015a30: 6f20 5741 4645 5220 6c61 7965 7273 2e0a  o WAFER layers..
-00015a40: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
-00015a50: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00015a60: 2020 2041 7267 756d 656e 7473 2066 6f72     Arguments for
-00015a70: 2074 6865 2074 6172 6765 7420 6d65 7368   the target mesh
-00015a80: 696e 6720 6675 6e63 7469 6f6e 2069 6e20  ing function in 
-00015a90: 6770 6c75 6769 6e73 2e67 6d73 680a 2020  gplugins.gmsh.  
-00015aa0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015ab0: 2020 2320 4164 6420 5741 4645 5220 6c61    # Add WAFER la
-00015ac0: 7965 723a 0a20 2020 2020 2020 2070 6164  yer:.        pad
-00015ad0: 6465 645f 636f 6d70 6f6e 656e 7420 3d20  ded_component = 
-00015ae0: 436f 6d70 6f6e 656e 7428 290a 2020 2020  Component().    
-00015af0: 2020 2020 7061 6464 6564 5f63 6f6d 706f      padded_compo
-00015b00: 6e65 6e74 203c 3c20 7365 6c66 0a20 2020  nent << self.   
-00015b10: 2020 2020 2028 786d 696e 2c20 796d 696e       (xmin, ymin
-00015b20: 292c 2028 786d 6178 2c20 796d 6178 2920  ), (xmax, ymax) 
-00015b30: 3d20 7365 6c66 2e62 626f 780a 2020 2020  = self.bbox.    
-00015b40: 2020 2020 706f 696e 7473 203d 205b 0a20      points = [. 
-00015b50: 2020 2020 2020 2020 2020 205b 786d 696e             [xmin
-00015b60: 202d 2077 6166 6572 5f70 6164 6469 6e67   - wafer_padding
-00015b70: 2c20 796d 696e 202d 2077 6166 6572 5f70  , ymin - wafer_p
-00015b80: 6164 6469 6e67 5d2c 0a20 2020 2020 2020  adding],.       
-00015b90: 2020 2020 205b 786d 6178 202b 2077 6166       [xmax + waf
-00015ba0: 6572 5f70 6164 6469 6e67 2c20 796d 696e  er_padding, ymin
-00015bb0: 202d 2077 6166 6572 5f70 6164 6469 6e67   - wafer_padding
-00015bc0: 5d2c 0a20 2020 2020 2020 2020 2020 205b  ],.            [
-00015bd0: 786d 6178 202b 2077 6166 6572 5f70 6164  xmax + wafer_pad
-00015be0: 6469 6e67 2c20 796d 6178 202b 2077 6166  ding, ymax + waf
-00015bf0: 6572 5f70 6164 6469 6e67 5d2c 0a20 2020  er_padding],.   
-00015c00: 2020 2020 2020 2020 205b 786d 696e 202d           [xmin -
-00015c10: 2077 6166 6572 5f70 6164 6469 6e67 2c20   wafer_padding, 
-00015c20: 796d 6178 202b 2077 6166 6572 5f70 6164  ymax + wafer_pad
-00015c30: 6469 6e67 5d2c 0a20 2020 2020 2020 205d  ding],.        ]
-00015c40: 0a20 2020 2020 2020 2070 6164 6465 645f  .        padded_
-00015c50: 636f 6d70 6f6e 656e 742e 6164 645f 706f  component.add_po
-00015c60: 6c79 676f 6e28 706f 696e 7473 2c20 6c61  lygon(points, la
-00015c70: 7965 723d 7761 6665 725f 6c61 7965 7229  yer=wafer_layer)
-00015c80: 0a20 2020 2020 2020 2070 6164 6465 645f  .        padded_
-00015c90: 636f 6d70 6f6e 656e 742e 6164 645f 706f  component.add_po
-00015ca0: 7274 7328 7365 6c66 2e67 6574 5f70 6f72  rts(self.get_por
-00015cb0: 7473 5f6c 6973 7428 2929 0a0a 2020 2020  ts_list())..    
-00015cc0: 2020 2020 6966 206c 6179 6572 5f73 7461      if layer_sta
-00015cd0: 636b 2069 7320 4e6f 6e65 3a0a 2020 2020  ck is None:.    
-00015ce0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00015cf0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00015d00: 2020 2020 2020 2020 2020 2741 204c 6179            'A Lay
-00015d10: 6572 5374 6163 6b20 6d75 7374 2062 6520  erStack must be 
-00015d20: 7072 6f76 6964 6564 2074 6872 6f75 6768  provided through
-00015d30: 2061 7267 756d 656e 7420 226c 6179 6572   argument "layer
-00015d40: 5f73 7461 636b 222e 270a 2020 2020 2020  _stack".'.      
-00015d50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00015d60: 6966 2074 7970 6520 3d3d 2022 7879 223a  if type == "xy":
-00015d70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015d80: 7a20 6973 204e 6f6e 653a 0a20 2020 2020  z is None:.     
-00015d90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00015da0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00015db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015dc0: 2027 466f 7220 7879 2d6d 6573 6869 6e67   'For xy-meshing
-00015dd0: 2c20 6120 7a2d 7661 6c75 6520 6d75 7374  , a z-value must
-00015de0: 2062 6520 7072 6f76 6964 6564 2076 6961   be provided via
-00015df0: 2074 6865 2066 6c6f 6174 2061 7267 756d   the float argum
-00015e00: 656e 7420 227a 222e 270a 2020 2020 2020  ent "z".'.      
-00015e10: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00015e20: 2020 2020 2020 2020 6672 6f6d 2067 706c          from gpl
-00015e30: 7567 696e 732e 676d 7368 2e78 795f 7873  ugins.gmsh.xy_xs
-00015e40: 6563 7469 6f6e 5f6d 6573 6820 696d 706f  ection_mesh impo
-00015e50: 7274 2078 795f 7873 6563 7469 6f6e 5f6d  rt xy_xsection_m
-00015e60: 6573 680a 0a20 2020 2020 2020 2020 2020  esh..           
-00015e70: 2072 6574 7572 6e20 7879 5f78 7365 6374   return xy_xsect
-00015e80: 696f 6e5f 6d65 7368 2870 6164 6465 645f  ion_mesh(padded_
-00015e90: 636f 6d70 6f6e 656e 742c 207a 2c20 6c61  component, z, la
-00015ea0: 7965 725f 7374 6163 6b2c 202a 2a6b 7761  yer_stack, **kwa
-00015eb0: 7267 7329 0a20 2020 2020 2020 2065 6c69  rgs).        eli
-00015ec0: 6620 7479 7065 203d 3d20 2275 7a22 3a0a  f type == "uz":.
-00015ed0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
-00015ee0: 7365 6374 696f 6e5f 626f 756e 6473 2069  section_bounds i
-00015ef0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00015f00: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00015f10: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00015f20: 2020 2020 2020 2020 2020 2020 2020 2246                "F
-00015f30: 6f72 2075 7a2d 6d65 7368 696e 672c 2079  or uz-meshing, y
-00015f40: 6f75 206d 7573 7420 7072 6f76 6964 6520  ou must provide 
-00015f50: 6120 6c69 6e65 2069 6e20 7468 6520 7879  a line in the xy
-00015f60: 2d70 6c61 6e65 2022 0a20 2020 2020 2020  -plane ".       
-00015f70: 2020 2020 2020 2020 2020 2020 2022 7669               "vi
-00015f80: 6120 7468 6520 5475 706c 6520 6172 6775  a the Tuple argu
-00015f90: 6d65 6e74 205b 5b78 312c 7931 5d2c 205b  ment [[x1,y1], [
-00015fa0: 7832 2c79 325d 5d20 7873 6563 7469 6f6e  x2,y2]] xsection
-00015fb0: 5f62 6f75 6e64 732e 220a 2020 2020 2020  _bounds.".      
-00015fc0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00015fd0: 2020 2020 2020 2020 6672 6f6d 2067 706c          from gpl
-00015fe0: 7567 696e 732e 676d 7368 2e75 7a5f 7873  ugins.gmsh.uz_xs
-00015ff0: 6563 7469 6f6e 5f6d 6573 6820 696d 706f  ection_mesh impo
-00016000: 7274 2075 7a5f 7873 6563 7469 6f6e 5f6d  rt uz_xsection_m
-00016010: 6573 680a 0a20 2020 2020 2020 2020 2020  esh..           
-00016020: 2072 6574 7572 6e20 757a 5f78 7365 6374   return uz_xsect
-00016030: 696f 6e5f 6d65 7368 280a 2020 2020 2020  ion_mesh(.      
-00016040: 2020 2020 2020 2020 2020 7061 6464 6564            padded
-00016050: 5f63 6f6d 706f 6e65 6e74 2c20 7873 6563  _component, xsec
-00016060: 7469 6f6e 5f62 6f75 6e64 732c 206c 6179  tion_bounds, lay
-00016070: 6572 5f73 7461 636b 2c20 2a2a 6b77 6172  er_stack, **kwar
-00016080: 6773 0a20 2020 2020 2020 2020 2020 2029  gs.            )
-00016090: 0a20 2020 2020 2020 2065 6c69 6620 7479  .        elif ty
-000160a0: 7065 203d 3d20 2233 4422 3a0a 2020 2020  pe == "3D":.    
-000160b0: 2020 2020 2020 2020 7370 6563 203d 2069          spec = i
-000160c0: 6d70 6f72 746c 6962 2e75 7469 6c2e 6669  mportlib.util.fi
-000160d0: 6e64 5f73 7065 6328 226d 6573 6877 656c  nd_spec("meshwel
-000160e0: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-000160f0: 6966 2073 7065 6320 6973 204e 6f6e 653a  if spec is None:
-00016100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016110: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-00016120: 2020 2020 2020 2020 2020 2020 2233 4420              "3D 
-00016130: 6d65 7368 696e 6720 7265 7175 6972 6573  meshing requires
-00016140: 206d 6573 6877 656c 6c2c 2073 6565 2068   meshwell, see h
-00016150: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00016160: 6d2f 7369 6d62 696c 6f64 2f6d 6573 6877  m/simbilod/meshw
-00016170: 656c 6c20 6f72 2072 756e 2070 6970 2069  ell or run pip i
-00016180: 6e73 7461 6c6c 206d 6573 6877 656c 6c2e  nstall meshwell.
-00016190: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000161a0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-000161b0: 2066 726f 6d20 6770 6c75 6769 6e73 2e67   from gplugins.g
-000161c0: 6d73 682e 7879 7a5f 6d65 7368 2069 6d70  msh.xyz_mesh imp
-000161d0: 6f72 7420 7879 7a5f 6d65 7368 0a0a 2020  ort xyz_mesh..  
-000161e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000161f0: 2078 797a 5f6d 6573 6828 7061 6464 6564   xyz_mesh(padded
-00016200: 5f63 6f6d 706f 6e65 6e74 2c20 6c61 7965  _component, laye
-00016210: 725f 7374 6163 6b2c 202a 2a6b 7761 7267  r_stack, **kwarg
-00016220: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-00016230: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00016240: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00016250: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00016260: 5265 7175 6972 6564 2061 7267 756d 656e  Required argumen
-00016270: 7420 2274 7970 6522 206d 7573 7420 6265  t "type" must be
-00016280: 206f 6e65 206f 6620 2278 7922 2c20 2275   one of "xy", "u
-00016290: 7a22 2c20 6f72 2022 3344 222e 270a 2020  z", or "3D".'.  
-000162a0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000162b0: 2064 6566 206f 6666 7365 7428 0a20 2020   def offset(.   
-000162c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000162d0: 2020 2064 6973 7461 6e63 653a 2066 6c6f     distance: flo
-000162e0: 6174 203d 2030 2e31 2c0a 2020 2020 2020  at = 0.1,.      
-000162f0: 2020 706f 6c79 676f 6e73 3d4e 6f6e 652c    polygons=None,
-00016300: 0a20 2020 2020 2020 2075 7365 5f75 6e69  .        use_uni
-00016310: 6f6e 3a20 626f 6f6c 203d 2054 7275 652c  on: bool = True,
-00016320: 0a20 2020 2020 2020 2070 7265 6369 7369  .        precisi
-00016330: 6f6e 3a20 666c 6f61 7420 3d20 3165 2d34  on: float = 1e-4
-00016340: 2c0a 2020 2020 2020 2020 6a6f 696e 3a20  ,.        join: 
-00016350: 7374 7220 3d20 226d 6974 6572 222c 0a20  str = "miter",. 
-00016360: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
-00016370: 3a20 696e 7420 3d20 322c 0a20 2020 2020  : int = 2,.     
-00016380: 2020 206c 6179 6572 3a20 4c61 7965 7253     layer: LayerS
-00016390: 7065 6320 3d20 2257 4722 2c0a 2020 2020  pec = "WG",.    
-000163a0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
-000163b0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-000163c0: 6e73 206e 6577 2043 6f6d 706f 6e65 6e74  ns new Component
-000163d0: 2077 6974 6820 706f 6c79 676f 6e73 2065   with polygons e
-000163e0: 726f 6465 6420 6f72 2064 696c 6174 6564  roded or dilated
-000163f0: 2062 7920 616e 206f 6666 7365 742e 0a0a   by an offset...
-00016400: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00016410: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-00016420: 6365 3a20 4469 7374 616e 6365 2074 6f20  ce: Distance to 
-00016430: 6f66 6673 6574 2070 6f6c 7967 6f6e 732e  offset polygons.
-00016440: 2050 6f73 6974 6976 6520 7661 6c75 6573   Positive values
-00016450: 2065 7870 616e 642c 206e 6567 6174 6976   expand, negativ
-00016460: 6520 7368 7269 6e6b 2e0a 2020 2020 2020  e shrink..      
-00016470: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
-00016480: 2044 6573 6972 6564 2070 7265 6369 7369   Desired precisi
-00016490: 6f6e 2066 6f72 2072 6f75 6e64 696e 6720  on for rounding 
-000164a0: 7665 7274 6578 2063 6f6f 7264 696e 6174  vertex coordinat
-000164b0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-000164c0: 6a6f 696e 3a20 7b27 6d69 7465 7227 2c20  join: {'miter', 
-000164d0: 2762 6576 656c 272c 2027 726f 756e 6427  'bevel', 'round'
-000164e0: 7d20 5479 7065 206f 6620 6a6f 696e 2075  } Type of join u
-000164f0: 7365 6420 746f 2063 7265 6174 6520 706f  sed to create po
-00016500: 6c79 676f 6e20 6f66 6673 6574 0a20 2020  lygon offset.   
-00016510: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
-00016520: 6365 3a20 466f 7220 6d69 7465 7220 6a6f  ce: For miter jo
-00016530: 696e 7473 2c20 7468 6973 206e 756d 6265  ints, this numbe
-00016540: 7220 6d75 7374 2062 6520 6174 206c 6561  r must be at lea
-00016550: 7374 2032 2072 6570 7265 7365 6e74 7320  st 2 represents 
-00016560: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00016570: 2020 6d61 7869 6d61 6c20 6469 7374 616e    maximal distan
-00016580: 6365 2069 6e20 6d75 6c74 6970 6c65 7320  ce in multiples 
-00016590: 6f66 206f 6666 7365 7420 6265 7477 6565  of offset betwee
-000165a0: 6e20 6e65 7720 7665 7274 6963 6573 2061  n new vertices a
-000165b0: 6e64 2074 6865 6972 0a20 2020 2020 2020  nd their.       
-000165c0: 2020 2020 2020 206f 7269 6769 6e61 6c20         original 
-000165d0: 706f 7369 7469 6f6e 2062 6566 6f72 6520  position before 
-000165e0: 6265 7665 6c69 6e67 2074 6f20 6176 6f69  beveling to avoi
-000165f0: 6420 7370 696b 6573 2061 7420 6163 7574  d spikes at acut
-00016600: 6520 6a6f 696e 7473 2e20 466f 720a 2020  e joints. For.  
-00016610: 2020 2020 2020 2020 2020 2020 726f 756e              roun
-00016620: 6420 6a6f 696e 7473 2c20 6974 2069 6e64  d joints, it ind
-00016630: 6963 6174 6573 2074 6865 2063 7572 7661  icates the curva
-00016640: 7475 7265 2072 6573 6f6c 7574 696f 6e20  ture resolution 
-00016650: 696e 206e 756d 6265 7220 6f66 0a20 2020  in number of.   
-00016660: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00016670: 7320 7065 7220 6675 6c6c 2063 6972 636c  s per full circl
-00016680: 652e 0a20 2020 2020 2020 2020 2020 206c  e..            l
-00016690: 6179 6572 3a20 5370 6563 6966 6963 206c  ayer: Specific l
-000166a0: 6179 6572 2066 6f72 206e 6577 2070 6f6c  ayer for new pol
-000166b0: 7967 6f6e 732e 0a0a 2020 2020 2020 2020  ygons...        
-000166c0: 2222 220a 2020 2020 2020 2020 696d 706f  """.        impo
-000166d0: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-000166e0: 2067 660a 0a20 2020 2020 2020 2067 6473   gf..        gds
-000166f0: 5f6c 6179 6572 2c20 6764 735f 6461 7461  _layer, gds_data
-00016700: 7479 7065 203d 2067 662e 6765 745f 6c61  type = gf.get_la
-00016710: 7965 7228 6c61 7965 7229 0a20 2020 2020  yer(layer).     
-00016720: 2020 2070 203d 2067 6473 746b 2e6f 6666     p = gdstk.off
-00016730: 7365 7428 0a20 2020 2020 2020 2020 2020  set(.           
-00016740: 2070 6f6c 7967 6f6e 7320 6f72 2073 656c   polygons or sel
-00016750: 662e 6765 745f 706f 6c79 676f 6e73 2829  f.get_polygons()
-00016760: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
-00016770: 7374 616e 6365 3d64 6973 7461 6e63 652c  stance=distance,
-00016780: 0a20 2020 2020 2020 2020 2020 206a 6f69  .            joi
-00016790: 6e3d 6a6f 696e 2c0a 2020 2020 2020 2020  n=join,.        
-000167a0: 2020 2020 746f 6c65 7261 6e63 653d 746f      tolerance=to
-000167b0: 6c65 7261 6e63 652c 0a20 2020 2020 2020  lerance,.       
-000167c0: 2020 2020 2070 7265 6369 7369 6f6e 3d70       precision=p
-000167d0: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
-000167e0: 2020 2020 2020 7573 655f 756e 696f 6e3d        use_union=
-000167f0: 7573 655f 756e 696f 6e2c 0a20 2020 2020  use_union,.     
-00016800: 2020 2020 2020 206c 6179 6572 3d67 6473         layer=gds
-00016810: 5f6c 6179 6572 2c0a 2020 2020 2020 2020  _layer,.        
-00016820: 2020 2020 6461 7461 7479 7065 3d67 6473      datatype=gds
-00016830: 5f64 6174 6174 7970 652c 0a20 2020 2020  _datatype,.     
-00016840: 2020 2029 0a0a 2020 2020 2020 2020 636f     )..        co
-00016850: 6d70 6f6e 656e 7420 3d20 6766 2e43 6f6d  mponent = gf.Com
-00016860: 706f 6e65 6e74 2829 0a20 2020 2020 2020  ponent().       
-00016870: 2063 6f6d 706f 6e65 6e74 2e61 6464 5f70   component.add_p
-00016880: 6f6c 7967 6f6e 2870 2c20 6c61 7965 723d  olygon(p, layer=
-00016890: 6c61 7965 7229 0a20 2020 2020 2020 2072  layer).        r
-000168a0: 6574 7572 6e20 636f 6d70 6f6e 656e 740a  eturn component.
-000168b0: 0a0a 6465 6620 636f 7079 280a 2020 2020  ..def copy(.    
-000168c0: 443a 2043 6f6d 706f 6e65 6e74 2c0a 2020  D: Component,.  
-000168d0: 2020 7265 6665 7265 6e63 6573 3d4e 6f6e    references=Non
-000168e0: 652c 0a20 2020 2070 6f72 7473 3d4e 6f6e  e,.    ports=Non
-000168f0: 652c 0a20 2020 2070 6f6c 7967 6f6e 733d  e,.    polygons=
-00016900: 4e6f 6e65 2c0a 2020 2020 7061 7468 733d  None,.    paths=
-00016910: 4e6f 6e65 2c0a 2020 2020 6e61 6d65 3d4e  None,.    name=N
-00016920: 6f6e 652c 0a20 2020 206c 6162 656c 733d  one,.    labels=
-00016930: 4e6f 6e65 2c0a 2920 2d3e 2043 6f6d 706f  None,.) -> Compo
-00016940: 6e65 6e74 3a0a 2020 2020 2222 2252 6574  nent:.    """Ret
-00016950: 7572 6e73 2061 2043 6f6d 706f 6e65 6e74  urns a Component
-00016960: 2063 6f70 792e 0a0a 2020 2020 4172 6773   copy...    Args
-00016970: 3a0a 2020 2020 2020 2020 443a 2063 6f6d  :.        D: com
-00016980: 706f 6e65 6e74 2074 6f20 636f 7079 2e0a  ponent to copy..
-00016990: 2020 2020 2222 220a 2020 2020 445f 636f      """.    D_co
-000169a0: 7079 203d 2043 6f6d 706f 6e65 6e74 2829  py = Component()
-000169b0: 0a20 2020 2044 5f63 6f70 792e 696e 666f  .    D_copy.info
-000169c0: 203d 2044 2e69 6e66 6f0a 2020 2020 2320   = D.info.    # 
-000169d0: 445f 636f 7079 2e5f 6365 6c6c 203d 2044  D_copy._cell = D
-000169e0: 2e5f 6365 6c6c 2e63 6f70 7928 6e61 6d65  ._cell.copy(name
-000169f0: 3d44 5f63 6f70 792e 6e61 6d65 290a 0a20  =D_copy.name).. 
-00016a00: 2020 2066 6f72 2072 6566 2069 6e20 7265     for ref in re
-00016a10: 6665 7265 6e63 6573 2069 6620 7265 6665  ferences if refe
-00016a20: 7265 6e63 6573 2069 7320 6e6f 7420 4e6f  rences is not No
-00016a30: 6e65 2065 6c73 6520 442e 7265 6665 7265  ne else D.refere
-00016a40: 6e63 6573 3a0a 2020 2020 2020 2020 445f  nces:.        D_
-00016a50: 636f 7079 2e61 6464 2863 6f70 795f 7265  copy.add(copy_re
-00016a60: 6665 7265 6e63 6528 7265 6629 290a 2020  ference(ref)).  
-00016a70: 2020 666f 7220 706f 7274 2069 6e20 2870    for port in (p
-00016a80: 6f72 7473 2069 6620 706f 7274 7320 6973  orts if ports is
-00016a90: 206e 6f74 204e 6f6e 6520 656c 7365 2044   not None else D
-00016aa0: 2e70 6f72 7473 292e 7661 6c75 6573 2829  .ports).values()
-00016ab0: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
-00016ac0: 2e61 6464 5f70 6f72 7428 706f 7274 3d70  .add_port(port=p
-00016ad0: 6f72 7429 0a20 2020 2066 6f72 2070 6f6c  ort).    for pol
-00016ae0: 7920 696e 2070 6f6c 7967 6f6e 7320 6966  y in polygons if
-00016af0: 2070 6f6c 7967 6f6e 7320 6973 206e 6f74   polygons is not
-00016b00: 204e 6f6e 6520 656c 7365 2044 2e70 6f6c   None else D.pol
-00016b10: 7967 6f6e 733a 0a20 2020 2020 2020 2044  ygons:.        D
-00016b20: 5f63 6f70 792e 6164 645f 706f 6c79 676f  _copy.add_polygo
-00016b30: 6e28 706f 6c79 290a 2020 2020 666f 7220  n(poly).    for 
-00016b40: 7061 7468 2069 6e20 7061 7468 7320 6966  path in paths if
-00016b50: 2070 6174 6873 2069 7320 6e6f 7420 4e6f   paths is not No
-00016b60: 6e65 2065 6c73 6520 442e 7061 7468 733a  ne else D.paths:
-00016b70: 0a20 2020 2020 2020 2044 5f63 6f70 792e  .        D_copy.
-00016b80: 6164 6428 7061 7468 290a 2020 2020 666f  add(path).    fo
-00016b90: 7220 6c61 6265 6c20 696e 206c 6162 656c  r label in label
-00016ba0: 7320 6966 206c 6162 656c 7320 6973 206e  s if labels is n
-00016bb0: 6f74 204e 6f6e 6520 656c 7365 2044 2e6c  ot None else D.l
-00016bc0: 6162 656c 733a 0a20 2020 2020 2020 2044  abels:.        D
-00016bd0: 5f63 6f70 792e 6164 645f 6c61 6265 6c28  _copy.add_label(
-00016be0: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
-00016bf0: 743d 6c61 6265 6c2e 7465 7874 2c0a 2020  t=label.text,.  
-00016c00: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-00016c10: 6f6e 3d6c 6162 656c 2e6f 7269 6769 6e2c  on=label.origin,
-00016c20: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00016c30: 6572 3d28 6c61 6265 6c2e 6c61 7965 722c  er=(label.layer,
-00016c40: 206c 6162 656c 2e74 6578 7474 7970 6529   label.texttype)
-00016c50: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00016c60: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
-00016c70: 4e6f 6e65 3a0a 2020 2020 2020 2020 445f  None:.        D_
-00016c80: 636f 7079 2e6e 616d 6520 3d20 6e61 6d65  copy.name = name
-00016c90: 0a0a 2020 2020 7265 7475 726e 2044 5f63  ..    return D_c
-00016ca0: 6f70 790a 0a0a 6465 6620 636f 7079 5f72  opy...def copy_r
-00016cb0: 6566 6572 656e 6365 280a 2020 2020 7265  eference(.    re
-00016cc0: 662c 0a20 2020 2070 6172 656e 743d 4e6f  f,.    parent=No
-00016cd0: 6e65 2c0a 2020 2020 636f 6c75 6d6e 733d  ne,.    columns=
-00016ce0: 4e6f 6e65 2c0a 2020 2020 726f 7773 3d4e  None,.    rows=N
-00016cf0: 6f6e 652c 0a20 2020 2073 7061 6369 6e67  one,.    spacing
-00016d00: 3d4e 6f6e 652c 0a20 2020 206f 7269 6769  =None,.    origi
-00016d10: 6e3d 4e6f 6e65 2c0a 2020 2020 726f 7461  n=None,.    rota
-00016d20: 7469 6f6e 3d4e 6f6e 652c 0a20 2020 206d  tion=None,.    m
-00016d30: 6167 6e69 6669 6361 7469 6f6e 3d4e 6f6e  agnification=Non
-00016d40: 652c 0a20 2020 2078 5f72 6566 6c65 6374  e,.    x_reflect
-00016d50: 696f 6e3d 4e6f 6e65 2c0a 2020 2020 6e61  ion=None,.    na
-00016d60: 6d65 3d4e 6f6e 652c 0a20 2020 2076 313d  me=None,.    v1=
-00016d70: 4e6f 6e65 2c0a 2020 2020 7632 3d4e 6f6e  None,.    v2=Non
-00016d80: 652c 0a29 202d 3e20 436f 6d70 6f6e 656e  e,.) -> Componen
-00016d90: 7452 6566 6572 656e 6365 3a0a 2020 2020  tReference:.    
-00016da0: 7265 7475 726e 2043 6f6d 706f 6e65 6e74  return Component
-00016db0: 5265 6665 7265 6e63 6528 0a20 2020 2020  Reference(.     
-00016dc0: 2020 2063 6f6d 706f 6e65 6e74 3d70 6172     component=par
-00016dd0: 656e 7420 6f72 2072 6566 2e70 6172 656e  ent or ref.paren
-00016de0: 742c 0a20 2020 2020 2020 2063 6f6c 756d  t,.        colum
-00016df0: 6e73 3d63 6f6c 756d 6e73 206f 7220 7265  ns=columns or re
-00016e00: 662e 636f 6c75 6d6e 732c 0a20 2020 2020  f.columns,.     
-00016e10: 2020 2072 6f77 733d 726f 7773 206f 7220     rows=rows or 
-00016e20: 7265 662e 726f 7773 2c0a 2020 2020 2020  ref.rows,.      
-00016e30: 2020 7370 6163 696e 673d 7370 6163 696e    spacing=spacin
-00016e40: 6720 6f72 2072 6566 2e73 7061 6369 6e67  g or ref.spacing
-00016e50: 2c0a 2020 2020 2020 2020 6f72 6967 696e  ,.        origin
-00016e60: 3d6f 7269 6769 6e20 6f72 2072 6566 2e6f  =origin or ref.o
-00016e70: 7269 6769 6e2c 0a20 2020 2020 2020 2072  rigin,.        r
-00016e80: 6f74 6174 696f 6e3d 726f 7461 7469 6f6e  otation=rotation
-00016e90: 206f 7220 7265 662e 726f 7461 7469 6f6e   or ref.rotation
-00016ea0: 2c0a 2020 2020 2020 2020 6d61 676e 6966  ,.        magnif
-00016eb0: 6963 6174 696f 6e3d 6d61 676e 6966 6963  ication=magnific
-00016ec0: 6174 696f 6e20 6f72 2072 6566 2e6d 6167  ation or ref.mag
-00016ed0: 6e69 6669 6361 7469 6f6e 2c0a 2020 2020  nification,.    
-00016ee0: 2020 2020 785f 7265 666c 6563 7469 6f6e      x_reflection
-00016ef0: 3d78 5f72 6566 6c65 6374 696f 6e20 6f72  =x_reflection or
-00016f00: 2072 6566 2e78 5f72 6566 6c65 6374 696f   ref.x_reflectio
-00016f10: 6e2c 0a20 2020 2020 2020 206e 616d 653d  n,.        name=
-00016f20: 6e61 6d65 206f 7220 7265 662e 6e61 6d65  name or ref.name
-00016f30: 2c0a 2020 2020 2020 2020 7631 3d76 3120  ,.        v1=v1 
-00016f40: 6f72 2072 6566 2e76 312c 0a20 2020 2020  or ref.v1,.     
-00016f50: 2020 2076 323d 7632 206f 7220 7265 662e     v2=v2 or ref.
-00016f60: 7632 2c0a 2020 2020 290a 0a0a 6465 6620  v2,.    )...def 
-00016f70: 7465 7374 5f67 6574 5f6c 6179 6572 7328  test_get_layers(
-00016f80: 2920 2d3e 204e 6f6e 653a 0a20 2020 2069  ) -> None:.    i
-00016f90: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
-00016fa0: 2061 7320 6766 0a0a 2020 2020 6331 203d   as gf..    c1 =
-00016fb0: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
-00016fc0: 7472 6169 6768 7428 0a20 2020 2020 2020  traight(.       
-00016fd0: 206c 656e 6774 683d 3130 2c0a 2020 2020   length=10,.    
-00016fe0: 2020 2020 7769 6474 683d 302e 352c 0a20      width=0.5,. 
-00016ff0: 2020 2020 2020 206c 6179 6572 3d28 322c         layer=(2,
-00017000: 2030 292c 0a20 2020 2020 2020 2062 626f   0),.        bbo
-00017010: 785f 6c61 7965 7273 3d5b 2831 3131 2c20  x_layers=[(111, 
-00017020: 3029 5d2c 0a20 2020 2020 2020 2062 626f  0)],.        bbo
-00017030: 785f 6f66 6673 6574 733d 5b33 5d2c 0a20  x_offsets=[3],. 
-00017040: 2020 2020 2020 2077 6974 685f 6262 6f78         with_bbox
-00017050: 3d54 7275 652c 0a20 2020 2020 2020 2063  =True,.        c
-00017060: 6c61 6464 696e 675f 6c61 7965 7273 3d4e  ladding_layers=N
-00017070: 6f6e 652c 0a20 2020 2020 2020 2061 6464  one,.        add
-00017080: 5f70 696e 733d 4e6f 6e65 2c0a 2020 2020  _pins=None,.    
-00017090: 2020 2020 6164 645f 6262 6f78 3d4e 6f6e      add_bbox=Non
-000170a0: 652c 0a20 2020 2029 0a20 2020 2061 7373  e,.    ).    ass
-000170b0: 6572 7420 6331 2e67 6574 5f6c 6179 6572  ert c1.get_layer
-000170c0: 7328 2920 3d3d 207b 2832 2c20 3029 2c20  s() == {(2, 0), 
-000170d0: 2831 3131 2c20 3029 7d2c 2063 312e 6765  (111, 0)}, c1.ge
-000170e0: 745f 6c61 7965 7273 2829 0a20 2020 2023  t_layers().    #
-000170f0: 2072 6574 7572 6e20 6331 0a20 2020 2063   return c1.    c
-00017100: 3220 3d20 6331 2e72 656d 6f76 655f 6c61  2 = c1.remove_la
-00017110: 7965 7273 285b 2831 3131 2c20 3029 5d29  yers([(111, 0)])
-00017120: 0a20 2020 2061 7373 6572 7420 6332 2e67  .    assert c2.g
-00017130: 6574 5f6c 6179 6572 7328 2920 3d3d 207b  et_layers() == {
-00017140: 2832 2c20 3029 7d2c 2063 322e 6765 745f  (2, 0)}, c2.get_
-00017150: 6c61 7965 7273 2829 0a0a 0a64 6566 205f  layers()...def _
-00017160: 6669 6c74 6572 5f70 6f6c 7973 2870 6f6c  filter_polys(pol
-00017170: 7967 6f6e 732c 206c 6179 6572 735f 6578  ygons, layers_ex
-00017180: 636c 293a 0a20 2020 2072 6574 7572 6e20  cl):.    return 
-00017190: 5b0a 2020 2020 2020 2020 706f 6c79 676f  [.        polygo
-000171a0: 6e0a 2020 2020 2020 2020 666f 7220 706f  n.        for po
-000171b0: 6c79 676f 6e2c 206c 6179 6572 2c20 6461  lygon, layer, da
-000171c0: 7461 7479 7065 2069 6e20 7a69 7028 0a20  tatype in zip(. 
-000171d0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-000171e0: 6f6e 732e 706f 6c79 676f 6e73 2c20 706f  ons.polygons, po
-000171f0: 6c79 676f 6e73 2e6c 6179 6572 732c 2070  lygons.layers, p
-00017200: 6f6c 7967 6f6e 732e 6461 7461 7479 7065  olygons.datatype
-00017210: 730a 2020 2020 2020 2020 290a 2020 2020  s.        ).    
-00017220: 2020 2020 6966 2028 6c61 7965 722c 2064      if (layer, d
-00017230: 6174 6174 7970 6529 206e 6f74 2069 6e20  atatype) not in 
-00017240: 6c61 7965 7273 5f65 7863 6c0a 2020 2020  layers_excl.    
-00017250: 5d0a 0a0a 6465 6620 7265 6375 7273 655f  ]...def recurse_
-00017260: 7374 7275 6374 7572 6573 280a 2020 2020  structures(.    
-00017270: 636f 6d70 6f6e 656e 743a 2043 6f6d 706f  component: Compo
-00017280: 6e65 6e74 2c0a 2020 2020 6967 6e6f 7265  nent,.    ignore
-00017290: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
-000172a0: 6978 3a20 6c69 7374 5b73 7472 5d20 7c20  ix: list[str] | 
-000172b0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-000172c0: 2069 676e 6f72 655f 6675 6e63 7469 6f6e   ignore_function
-000172d0: 735f 7072 6566 6978 3a20 6c69 7374 5b73  s_prefix: list[s
-000172e0: 7472 5d20 7c20 4e6f 6e65 203d 204e 6f6e  tr] | None = Non
-000172f0: 652c 0a29 202d 3e20 6469 6374 5b73 7472  e,.) -> dict[str
-00017300: 2c20 416e 795d 3a0a 2020 2020 2222 2252  , Any]:.    """R
-00017310: 6563 7572 7365 2063 6f6d 706f 6e65 6e74  ecurse component
-00017320: 2061 6e64 2063 6f6d 706f 6e65 6e74 7320   and components 
-00017330: 7265 6665 7265 6e63 6573 2072 6563 7572  references recur
-00017340: 7369 7665 6c79 2e0a 0a20 2020 2041 7267  sively...    Arg
-00017350: 733a 0a20 2020 2020 2020 2063 6f6d 706f  s:.        compo
-00017360: 6e65 6e74 3a20 636f 6d70 6f6e 656e 7420  nent: component 
-00017370: 746f 2072 6563 7572 7365 2e0a 2020 2020  to recurse..    
-00017380: 2020 2020 6967 6e6f 7265 5f63 6f6d 706f      ignore_compo
-00017390: 6e65 6e74 735f 7072 6566 6978 3a20 6c69  nents_prefix: li
-000173a0: 7374 206f 6620 7072 6566 6978 2074 6f20  st of prefix to 
-000173b0: 6967 6e6f 7265 2e0a 2020 2020 2020 2020  ignore..        
-000173c0: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-000173d0: 5f70 7265 6669 783a 206c 6973 7420 6f66  _prefix: list of
-000173e0: 2070 7265 6669 7820 746f 2069 676e 6f72   prefix to ignor
-000173f0: 652e 0a20 2020 2022 2222 0a20 2020 2069  e..    """.    i
-00017400: 676e 6f72 655f 6675 6e63 7469 6f6e 735f  gnore_functions_
-00017410: 7072 6566 6978 203d 2069 676e 6f72 655f  prefix = ignore_
-00017420: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
-00017430: 206f 7220 5b5d 0a20 2020 2069 676e 6f72   or [].    ignor
-00017440: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
-00017450: 6669 7820 3d20 6967 6e6f 7265 5f63 6f6d  fix = ignore_com
-00017460: 706f 6e65 6e74 735f 7072 6566 6978 206f  ponents_prefix o
-00017470: 7220 5b5d 0a0a 2020 2020 6966 2028 0a20  r []..    if (. 
-00017480: 2020 2020 2020 2068 6173 6174 7472 2863         hasattr(c
-00017490: 6f6d 706f 6e65 6e74 2c20 2266 756e 6374  omponent, "funct
-000174a0: 696f 6e5f 6e61 6d65 2229 0a20 2020 2020  ion_name").     
-000174b0: 2020 2061 6e64 2063 6f6d 706f 6e65 6e74     and component
-000174c0: 2e66 756e 6374 696f 6e5f 6e61 6d65 2069  .function_name i
-000174d0: 6e20 6967 6e6f 7265 5f66 756e 6374 696f  n ignore_functio
-000174e0: 6e73 5f70 7265 6669 780a 2020 2020 293a  ns_prefix.    ):
-000174f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00017500: 7b7d 0a0a 2020 2020 6966 2068 6173 6174  {}..    if hasat
-00017510: 7472 2863 6f6d 706f 6e65 6e74 2c20 226e  tr(component, "n
-00017520: 616d 6522 2920 616e 6420 616e 7928 0a20  ame") and any(. 
-00017530: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00017540: 2e6e 616d 652e 7374 6172 7473 7769 7468  .name.startswith
-00017550: 2869 2920 666f 7220 6920 696e 2069 676e  (i) for i in ign
-00017560: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
-00017570: 7265 6669 780a 2020 2020 293a 0a20 2020  refix.    ):.   
-00017580: 2020 2020 2072 6574 7572 6e20 7b7d 0a0a       return {}..
-00017590: 2020 2020 6f75 7470 7574 203d 207b 636f      output = {co
-000175a0: 6d70 6f6e 656e 742e 6e61 6d65 3a20 6469  mponent.name: di
-000175b0: 6374 2863 6f6d 706f 6e65 6e74 2e73 6574  ct(component.set
-000175c0: 7469 6e67 7329 7d0a 2020 2020 666f 7220  tings)}.    for 
-000175d0: 7265 6665 7265 6e63 6520 696e 2063 6f6d  reference in com
-000175e0: 706f 6e65 6e74 2e72 6566 6572 656e 6365  ponent.reference
-000175f0: 733a 0a20 2020 2020 2020 2069 6620 280a  s:.        if (.
-00017600: 2020 2020 2020 2020 2020 2020 6973 696e              isin
-00017610: 7374 616e 6365 2872 6566 6572 656e 6365  stance(reference
-00017620: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
-00017630: 656e 6365 290a 2020 2020 2020 2020 2020  ence).          
-00017640: 2020 616e 6420 7265 6665 7265 6e63 652e    and reference.
-00017650: 7265 665f 6365 6c6c 2e6e 616d 6520 6e6f  ref_cell.name no
-00017660: 7420 696e 206f 7574 7075 740a 2020 2020  t in output.    
-00017670: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00017680: 2020 206f 7574 7075 742e 7570 6461 7465     output.update
-00017690: 2872 6563 7572 7365 5f73 7472 7563 7475  (recurse_structu
-000176a0: 7265 7328 7265 6665 7265 6e63 652e 7265  res(reference.re
-000176b0: 665f 6365 6c6c 2929 0a0a 2020 2020 7265  f_cell))..    re
-000176c0: 7475 726e 206f 7574 7075 740a 0a0a 6465  turn output...de
-000176d0: 6620 666c 6174 7465 6e5f 696e 7661 6c69  f flatten_invali
-000176e0: 645f 7265 6673 5f72 6563 7572 7369 7665  d_refs_recursive
-000176f0: 280a 2020 2020 636f 6d70 6f6e 656e 743a  (.    component:
-00017700: 2043 6f6d 706f 6e65 6e74 2c0a 2020 2020   Component,.    
-00017710: 6772 6964 5f73 697a 653a 2066 6c6f 6174  grid_size: float
-00017720: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00017730: 2020 2020 7570 6461 7465 645f 636f 6d70      updated_comp
-00017740: 6f6e 656e 7473 3d4e 6f6e 652c 0a20 2020  onents=None,.   
-00017750: 2074 7261 7665 7273 6564 5f63 6f6d 706f   traversed_compo
-00017760: 6e65 6e74 733d 4e6f 6e65 2c0a 293a 0a20  nents=None,.):. 
-00017770: 2020 2022 2222 5265 6375 7273 6976 656c     """Recursivel
-00017780: 7920 666c 6174 7465 6e73 2063 6f6d 706f  y flattens compo
-00017790: 6e65 6e74 2072 6566 6572 656e 6365 7320  nent references 
-000177a0: 7768 6963 6820 6861 7665 2069 6e76 616c  which have inval
-000177b0: 6964 2074 7261 6e73 666f 726d 6174 696f  id transformatio
-000177c0: 6e73 2028 692e 652e 206e 6f6e 2d39 3020  ns (i.e. non-90 
-000177d0: 6465 6720 726f 7461 7469 6f6e 7320 6f72  deg rotations or
-000177e0: 2073 7562 2d67 7269 6420 7472 616e 736c   sub-grid transl
-000177f0: 6174 696f 6e73 2920 616e 6420 7265 7475  ations) and retu
-00017800: 726e 7320 6120 636f 7079 2069 6620 616e  rns a copy if an
-00017810: 7920 7375 6263 656c 6c73 2068 6176 6520  y subcells have 
-00017820: 6265 656e 206d 6f64 6966 6965 642e 0a0a  been modified...
-00017830: 2020 2020 5741 524e 494e 473a 2074 6869      WARNING: thi
-00017840: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
-00017850: 7072 6f64 7563 6520 7361 6d65 2d6e 616d  produce same-nam
-00017860: 6520 636f 7069 6573 206f 6620 6365 6c6c  e copies of cell
-00017870: 732e 2049 7420 6973 2073 7472 6963 746c  s. It is strictl
-00017880: 7920 6d65 616e 7420 746f 2062 6520 7573  y meant to be us
-00017890: 6564 206f 6e20 7772 6974 6520 6f66 2074  ed on write of t
-000178a0: 6865 2047 4453 2066 696c 6520 616e 640a  he GDS file and.
-000178b0: 2020 2020 7368 6f75 6c64 206e 6f74 2062      should not b
-000178c0: 6520 6d69 7865 6420 7769 7468 206f 7468  e mixed with oth
-000178d0: 6572 2063 656c 6c73 2c20 6f72 2079 6f75  er cells, or you
-000178e0: 2077 696c 6c20 6c69 6b65 6c79 2065 7870   will likely exp
-000178f0: 6572 6965 6e63 6520 6973 7375 6573 2077  erience issues w
-00017900: 6974 6820 6475 706c 6963 6174 6520 6365  ith duplicate ce
-00017910: 6c6c 730a 0a20 2020 2041 7267 733a 0a20  lls..    Args:. 
-00017920: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00017930: 3a20 7468 6520 636f 6d70 6f6e 656e 7420  : the component 
-00017940: 746f 2066 6978 2028 696e 2070 6c61 6365  to fix (in place
-00017950: 292e 0a20 2020 2020 2020 2067 7269 645f  )..        grid_
-00017960: 7369 7a65 3a20 7468 6520 4744 5320 6772  size: the GDS gr
-00017970: 6964 2073 697a 652c 2069 6e20 756d 2c20  id size, in um, 
-00017980: 6465 6661 756c 7473 2074 6f20 6163 7469  defaults to acti
-00017990: 7665 2050 444b 2e67 6574 5f67 7269 645f  ve PDK.get_grid_
-000179a0: 7369 7a65 2829 0a20 2020 2020 2020 2020  size().         
-000179b0: 2020 2061 6e79 2074 7261 6e73 6c61 7469     any translati
-000179c0: 6f6e 7320 7769 7468 2068 6967 6865 7220  ons with higher 
-000179d0: 7265 736f 6c75 7469 6f6e 2074 6861 6e20  resolution than 
-000179e0: 7468 6973 2061 7265 2063 6f6e 7369 6465  this are conside
-000179f0: 7265 6420 696e 7661 6c69 642e 0a20 2020  red invalid..   
-00017a00: 2020 2020 2075 7064 6174 6564 5f63 6f6d       updated_com
-00017a10: 706f 6e65 6e74 733a 2074 6865 2072 756e  ponents: the run
-00017a20: 6e69 6e67 2064 6963 7469 6f6e 6172 7920  ning dictionary 
-00017a30: 6f66 2063 6f6d 706f 6e65 6e74 7320 7768  of components wh
-00017a40: 6963 6820 6861 7665 2062 6565 6e20 6d6f  ich have been mo
-00017a50: 6469 6669 6564 2062 7920 7468 6973 2074  dified by this t
-00017a60: 7261 6e73 666f 726d 6174 696f 6e2e 2053  ransformation. S
-00017a70: 686f 756c 6420 616c 7761 7973 2062 6520  hould always be 
-00017a80: 4e6f 6e65 2c20 6578 6365 7074 2066 6f72  None, except for
-00017a90: 2072 6563 7572 7369 7665 2069 6e76 6f63   recursive invoc
-00017aa0: 6174 696f 6e73 2e0a 2020 2020 2020 2020  ations..        
-00017ab0: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
-00017ac0: 656e 7473 3a20 7468 6520 7365 7420 6f66  ents: the set of
-00017ad0: 2063 6f6d 706f 6e65 6e74 206e 616d 6573   component names
-00017ae0: 2077 6869 6368 2068 6176 6520 6265 656e   which have been
-00017af0: 2074 7261 7665 7273 6564 2e20 5368 6f75   traversed. Shou
-00017b00: 6c64 2061 6c77 6179 7320 6265 204e 6f6e  ld always be Non
-00017b10: 652c 2065 7863 6570 7420 666f 7220 7265  e, except for re
-00017b20: 6375 7273 6976 6520 696e 766f 6361 7469  cursive invocati
-00017b30: 6f6e 732e 0a20 2020 2022 2222 0a20 2020  ons..    """.   
-00017b40: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-00017b50: 2e64 6563 6f72 6174 6f72 7320 696d 706f  .decorators impo
-00017b60: 7274 2069 735f 696e 7661 6c69 645f 7265  rt is_invalid_re
-00017b70: 660a 0a20 2020 2069 6e76 616c 6964 5f72  f..    invalid_r
-00017b80: 6566 7320 3d20 5b5d 0a20 2020 2072 6566  efs = [].    ref
-00017b90: 7320 3d20 636f 6d70 6f6e 656e 742e 7265  s = component.re
-00017ba0: 6665 7265 6e63 6573 0a20 2020 2073 7562  ferences.    sub
-00017bb0: 6365 6c6c 5f6d 6f64 6966 6965 6420 3d20  cell_modified = 
-00017bc0: 4661 6c73 650a 2020 2020 6966 2075 7064  False.    if upd
-00017bd0: 6174 6564 5f63 6f6d 706f 6e65 6e74 7320  ated_components 
-00017be0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00017bf0: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
-00017c00: 6e74 7320 3d20 7b7d 0a20 2020 2069 6620  nts = {}.    if 
-00017c10: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
-00017c20: 656e 7473 2069 7320 4e6f 6e65 3a0a 2020  ents is None:.  
-00017c30: 2020 2020 2020 7472 6176 6572 7365 645f        traversed_
-00017c40: 636f 6d70 6f6e 656e 7473 203d 2073 6574  components = set
-00017c50: 2829 0a20 2020 2066 6f72 2072 6566 2069  ().    for ref i
-00017c60: 6e20 7265 6673 3a0a 2020 2020 2020 2020  n refs:.        
-00017c70: 2320 6d61 726b 2061 6e79 2069 6e76 616c  # mark any inval
-00017c80: 6964 2072 6566 7320 666f 7220 666c 6174  id refs for flat
-00017c90: 7465 6e69 6e67 0a20 2020 2020 2020 2023  tening.        #
-00017ca0: 206f 7468 6572 7769 7365 2c20 6368 6563   otherwise, chec
-00017cb0: 6b20 6966 2074 6865 7265 2061 7265 2061  k if there are a
-00017cc0: 6e79 206d 6f64 6966 6965 6420 6365 6c6c  ny modified cell
-00017cd0: 7320 6265 6e65 6174 6820 2877 6520 6e65  s beneath (we ne
-00017ce0: 6564 206e 6f74 2064 6f20 7468 6973 2069  ed not do this i
-00017cf0: 6620 7468 6520 7265 6620 7769 6c6c 2062  f the ref will b
-00017d00: 6520 666c 6174 7465 6e65 6420 616e 7977  e flattened anyw
-00017d10: 6179 7329 0a20 2020 2020 2020 2069 6620  ays).        if 
-00017d20: 6973 5f69 6e76 616c 6964 5f72 6566 2872  is_invalid_ref(r
-00017d30: 6566 2c20 6772 6964 5f73 697a 6529 3a0a  ef, grid_size):.
-00017d40: 2020 2020 2020 2020 2020 2020 696e 7661              inva
-00017d50: 6c69 645f 7265 6673 2e61 7070 656e 6428  lid_refs.append(
-00017d60: 7265 662e 6e61 6d65 290a 2020 2020 2020  ref.name).      
-00017d70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017d80: 2020 2020 2320 6f74 6865 7277 6973 652c      # otherwise,
-00017d90: 2072 6563 7572 7369 7665 6c79 2066 6c61   recursively fla
-00017da0: 7474 656e 2072 6566 7320 6966 2074 6865  tten refs if the
-00017db0: 2073 7562 6365 6c6c 2068 6173 206e 6f74   subcell has not
-00017dc0: 2061 6c72 6561 6479 2062 6565 6e20 7472   already been tr
-00017dd0: 6176 6572 7365 640a 2020 2020 2020 2020  aversed.        
-00017de0: 2020 2020 6966 2072 6566 2e70 6172 656e      if ref.paren
-00017df0: 742e 6e61 6d65 206e 6f74 2069 6e20 7472  t.name not in tr
-00017e00: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
-00017e10: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00017e20: 2020 2020 666c 6174 7465 6e5f 696e 7661      flatten_inva
-00017e30: 6c69 645f 7265 6673 5f72 6563 7572 7369  lid_refs_recursi
-00017e40: 7665 280a 2020 2020 2020 2020 2020 2020  ve(.            
-00017e50: 2020 2020 2020 2020 7265 662e 7061 7265          ref.pare
-00017e60: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00017e70: 2020 2020 2020 2020 6772 6964 5f73 697a          grid_siz
-00017e80: 653d 6772 6964 5f73 697a 652c 0a20 2020  e=grid_size,.   
+00014bf0: 2020 206e 6577 5f6c 6179 6572 203d 206c     new_layer = l
+00014c00: 6179 6572 6d61 705b 6f72 6967 696e 616c  ayermap[original
+00014c10: 5f6c 6179 6572 5d0a 2020 2020 2020 2020  _layer].        
+00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c30: 2020 2020 6e65 775f 6c61 7965 7273 5b6c      new_layers[l
+00014c40: 6179 6572 5f6e 756d 6265 725d 203d 206e  ayer_number] = n
+00014c50: 6577 5f6c 6179 6572 5b30 5d0a 2020 2020  ew_layer[0].    
+00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c70: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00014c80: 7479 7065 735b 6c61 7965 725f 6e75 6d62  types[layer_numb
+00014c90: 6572 5d20 3d20 6e65 775f 6c61 7965 725b  er] = new_layer[
+00014ca0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+00014cb0: 2020 2020 2020 2070 6174 682e 7365 745f         path.set_
+00014cc0: 6c61 7965 7273 282a 6e65 775f 6c61 7965  layers(*new_laye
+00014cd0: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+00014ce0: 2020 2020 2020 2020 7061 7468 2e73 6574          path.set
+00014cf0: 5f64 6174 6174 7970 6573 282a 6e65 775f  _datatypes(*new_
+00014d00: 6461 7461 7479 7065 7329 0a20 2020 2020  datatypes).     
+00014d10: 2020 2072 6574 7572 6e20 636f 6d70 6f6e     return compon
+00014d20: 656e 740a 0a20 2020 2064 6566 2074 6f5f  ent..    def to_
+00014d30: 3364 280a 2020 2020 2020 2020 7365 6c66  3d(.        self
+00014d40: 2c0a 2020 2020 2020 2020 6c61 7965 725f  ,.        layer_
+00014d50: 7669 6577 733a 204c 6179 6572 5669 6577  views: LayerView
+00014d60: 7320 7c20 4e6f 6e65 203d 204e 6f6e 652c  s | None = None,
+00014d70: 0a20 2020 2020 2020 206c 6179 6572 5f73  .        layer_s
+00014d80: 7461 636b 3a20 4c61 7965 7253 7461 636b  tack: LayerStack
+00014d90: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00014da0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
+00014db0: 6c61 7965 7273 3a20 7475 706c 655b 4c61  layers: tuple[La
+00014dc0: 7965 722c 202e 2e2e 5d20 7c20 4e6f 6e65  yer, ...] | None
+00014dd0: 203d 204e 6f6e 652c 0a20 2020 2029 3a0a   = None,.    ):.
+00014de0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00014df0: 6e20 436f 6d70 6f6e 656e 7420 3344 2074  n Component 3D t
+00014e00: 7269 6d65 7368 2053 6365 6e65 2e0a 0a20  rimesh Scene... 
+00014e10: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00014e20: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
+00014e30: 6e74 3a20 746f 2065 7874 7275 6465 2069  nt: to extrude i
+00014e40: 6e20 3344 2e0a 2020 2020 2020 2020 2020  n 3D..          
+00014e50: 2020 6c61 7965 725f 7669 6577 733a 206c    layer_views: l
+00014e60: 6179 6572 2063 6f6c 6f72 7320 6672 6f6d  ayer colors from
+00014e70: 204b 6c61 796f 7574 204c 6179 6572 2050   Klayout Layer P
+00014e80: 726f 7065 7274 6965 7320 6669 6c65 2e0a  roperties file..
+00014e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ea0: 4465 6661 756c 7473 2074 6f20 6163 7469  Defaults to acti
+00014eb0: 7665 2050 444b 2e6c 6179 6572 5f76 6965  ve PDK.layer_vie
+00014ec0: 7773 2e0a 2020 2020 2020 2020 2020 2020  ws..            
+00014ed0: 6c61 7965 725f 7374 6163 6b3a 2063 6f6e  layer_stack: con
+00014ee0: 7461 696e 7320 7468 6963 6b6e 6573 7320  tains thickness 
+00014ef0: 616e 6420 7a6d 696e 2066 6f72 2065 6163  and zmin for eac
+00014f00: 6820 6c61 7965 722e 0a20 2020 2020 2020  h layer..       
+00014f10: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00014f20: 7320 746f 2061 6374 6976 6520 5044 4b2e  s to active PDK.
+00014f30: 6c61 7965 725f 7374 6163 6b2e 0a20 2020  layer_stack..   
+00014f40: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00014f50: 5f6c 6179 6572 733a 206c 6179 6572 7320  _layers: layers 
+00014f60: 746f 2065 7863 6c75 6465 2e0a 0a20 2020  to exclude...   
+00014f70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00014f80: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+00014f90: 2e65 7870 6f72 742e 746f 5f33 6420 696d  .export.to_3d im
+00014fa0: 706f 7274 2074 6f5f 3364 0a0a 2020 2020  port to_3d..    
+00014fb0: 2020 2020 7265 7475 726e 2074 6f5f 3364      return to_3d
+00014fc0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00014fd0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00014fe0: 6c61 7965 725f 7669 6577 733d 6c61 7965  layer_views=laye
+00014ff0: 725f 7669 6577 732c 0a20 2020 2020 2020  r_views,.       
+00015000: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
+00015010: 3d6c 6179 6572 5f73 7461 636b 2c0a 2020  =layer_stack,.  
+00015020: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00015030: 655f 6c61 7965 7273 3d65 7863 6c75 6465  e_layers=exclude
+00015040: 5f6c 6179 6572 732c 0a20 2020 2020 2020  _layers,.       
+00015050: 2029 0a0a 2020 2020 6465 6620 746f 5f6e   )..    def to_n
+00015060: 7028 0a20 2020 2020 2020 2073 656c 662c  p(.        self,
+00015070: 0a20 2020 2020 2020 206e 6d5f 7065 725f  .        nm_per_
+00015080: 7069 7865 6c3a 2069 6e74 203d 2032 302c  pixel: int = 20,
+00015090: 0a20 2020 2020 2020 206c 6179 6572 733a  .        layers:
+000150a0: 204c 6179 6572 7320 3d20 2828 312c 2030   Layers = ((1, 0
+000150b0: 292c 292c 0a20 2020 2020 2020 2076 616c  ),),.        val
+000150c0: 7565 733a 2074 7570 6c65 5b66 6c6f 6174  ues: tuple[float
+000150d0: 2c20 2e2e 2e5d 207c 204e 6f6e 6520 3d20  , ...] | None = 
+000150e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7061  None,.        pa
+000150f0: 645f 7769 6474 683a 2069 6e74 203d 2031  d_width: int = 1
+00015100: 2c0a 2020 2020 2920 2d3e 206e 702e 6e64  ,.    ) -> np.nd
+00015110: 6172 7261 793a 0a20 2020 2020 2020 2022  array:.        "
+00015120: 2222 5265 7475 726e 7320 6120 7069 7865  ""Returns a pixe
+00015130: 6c61 7465 6420 6e75 6d70 7920 6172 7261  lated numpy arra
+00015140: 7920 6672 6f6d 2043 6f6d 706f 6e65 6e74  y from Component
+00015150: 2070 6f6c 7967 6f6e 732e 0a0a 2020 2020   polygons...    
+00015160: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00015170: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
+00015180: 2043 6f6d 706f 6e65 6e74 2e0a 2020 2020   Component..    
+00015190: 2020 2020 2020 2020 6e6d 5f70 6572 5f70          nm_per_p
+000151a0: 6978 656c 3a20 796f 7520 6361 6e20 676f  ixel: you can go
+000151b0: 2066 726f 6d20 3230 2028 636f 6172 7365   from 20 (coarse
+000151c0: 2920 746f 2034 2028 6669 6e65 292e 0a20  ) to 4 (fine).. 
+000151d0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+000151e0: 733a 2074 6f20 636f 6e76 6572 742e 204f  s: to convert. O
+000151f0: 7264 6572 206d 6174 7465 7273 2028 6c61  rder matters (la
+00015200: 7474 6572 206f 7665 7277 7269 7465 2066  tter overwrite f
+00015210: 6f72 6d65 7229 2e0a 2020 2020 2020 2020  ormer)..        
+00015220: 2020 2020 7661 6c75 6573 3a20 6173 736f      values: asso
+00015230: 6369 6174 6564 2074 6f20 6561 6368 206c  ciated to each l
+00015240: 6179 6572 2028 6465 6661 756c 7473 2074  ayer (defaults t
+00015250: 6f20 3129 2e0a 2020 2020 2020 2020 2020  o 1)..          
+00015260: 2020 7061 645f 7769 6474 683a 2070 6164    pad_width: pad
+00015270: 6469 6e67 2070 6978 656c 7320 6172 6f75  ding pixels arou
+00015280: 6e64 2074 6865 2069 6d61 6765 2e0a 0a20  nd the image... 
+00015290: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000152a0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+000152b0: 7279 2e65 7870 6f72 742e 746f 5f6e 7020  ry.export.to_np 
+000152c0: 696d 706f 7274 2074 6f5f 6e70 0a0a 2020  import to_np..  
+000152d0: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
+000152e0: 6e70 280a 2020 2020 2020 2020 2020 2020  np(.            
+000152f0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00015300: 2020 6e6d 5f70 6572 5f70 6978 656c 3d6e    nm_per_pixel=n
+00015310: 6d5f 7065 725f 7069 7865 6c2c 0a20 2020  m_per_pixel,.   
+00015320: 2020 2020 2020 2020 206c 6179 6572 733d           layers=
+00015330: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+00015340: 2020 2020 7661 6c75 6573 3d76 616c 7565      values=value
+00015350: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
+00015360: 6164 5f77 6964 7468 3d70 6164 5f77 6964  ad_width=pad_wid
+00015370: 7468 2c0a 2020 2020 2020 2020 290a 0a20  th,.        ).. 
+00015380: 2020 2064 6566 2077 7269 7465 5f73 746c     def write_stl
+00015390: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+000153a0: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+000153b0: 3a20 7374 722c 0a20 2020 2020 2020 206c  : str,.        l
+000153c0: 6179 6572 5f73 7461 636b 3a20 4c61 7965  ayer_stack: Laye
+000153d0: 7253 7461 636b 207c 204e 6f6e 6520 3d20  rStack | None = 
+000153e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6578  None,.        ex
+000153f0: 636c 7564 655f 6c61 7965 7273 3a20 7475  clude_layers: tu
+00015400: 706c 655b 4c61 7965 722c 202e 2e2e 5d20  ple[Layer, ...] 
+00015410: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00015420: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+00015430: 2020 2020 2020 2222 2257 7269 7465 2061        """Write a
+00015440: 2043 6f6d 706f 6e65 6e74 2074 6f20 5354   Component to ST
+00015450: 4c20 666f 7220 3344 2070 7269 6e74 696e  L for 3D printin
+00015460: 672e 0a0a 2020 2020 2020 2020 4172 6773  g...        Args
+00015470: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
+00015480: 6c65 7061 7468 3a20 746f 2077 7269 7465  lepath: to write
+00015490: 2053 544c 2074 6f2e 0a20 2020 2020 2020   STL to..       
+000154a0: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
+000154b0: 3a20 636f 6e74 6169 6e73 2074 6869 636b  : contains thick
+000154c0: 6e65 7373 2061 6e64 207a 6d69 6e20 666f  ness and zmin fo
+000154d0: 7220 6561 6368 206c 6179 6572 2e0a 2020  r each layer..  
+000154e0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+000154f0: 655f 6c61 7965 7273 3a20 6c61 7965 7273  e_layers: layers
+00015500: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
+00015510: 2020 2020 2020 2020 2075 7365 5f6c 6179           use_lay
+00015520: 6572 5f6e 616d 653a 2049 6620 5472 7565  er_name: If True
+00015530: 2c20 7573 6573 204c 6179 6572 4c65 7665  , uses LayerLeve
+00015540: 6c20 6e61 6d65 7320 696e 206f 7574 7075  l names in outpu
+00015550: 7420 6669 6c65 6e61 6d65 7320 7261 7468  t filenames rath
+00015560: 6572 2074 6861 6e20 6764 735f 6c61 7965  er than gds_laye
+00015570: 7220 616e 6420 6764 735f 6461 7461 7479  r and gds_dataty
+00015580: 7065 2e0a 2020 2020 2020 2020 2020 2020  pe..            
+00015590: 6875 6c6c 5f69 6e76 616c 6964 5f70 6f6c  hull_invalid_pol
+000155a0: 7967 6f6e 733a 2049 6620 5472 7565 2c20  ygons: If True, 
+000155b0: 7265 706c 6163 6573 2069 6e76 616c 6964  replaces invalid
+000155c0: 2070 6f6c 7967 6f6e 7320 2864 6574 6572   polygons (deter
+000155d0: 6d69 6e65 6420 6279 2073 6861 7065 6c79  mined by shapely
+000155e0: 2e50 6f6c 7967 6f6e 2e69 735f 7661 6c69  .Polygon.is_vali
+000155f0: 6429 2077 6974 6820 6974 7320 636f 6e76  d) with its conv
+00015600: 6578 2068 756c 6c2e 0a20 2020 2020 2020  ex hull..       
+00015610: 2020 2020 2073 6361 6c65 3a20 4f70 7469       scale: Opti
+00015620: 6f6e 616c 2066 6163 746f 7220 6279 2077  onal factor by w
+00015630: 6869 6368 2074 6f20 7363 616c 6520 6d65  hich to scale me
+00015640: 7368 6573 2062 6566 6f72 6520 7772 6974  shes before writ
+00015650: 696e 672e 0a0a 2020 2020 2020 2020 2222  ing...        ""
+00015660: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00015670: 6473 6661 6374 6f72 792e 6578 706f 7274  dsfactory.export
+00015680: 2e74 6f5f 7374 6c20 696d 706f 7274 2074  .to_stl import t
+00015690: 6f5f 7374 6c0a 0a20 2020 2020 2020 2074  o_stl..        t
+000156a0: 6f5f 7374 6c28 0a20 2020 2020 2020 2020  o_stl(.         
+000156b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+000156c0: 2020 2020 2066 696c 6570 6174 683d 6669       filepath=fi
+000156d0: 6c65 7061 7468 2c0a 2020 2020 2020 2020  lepath,.        
+000156e0: 2020 2020 6c61 7965 725f 7374 6163 6b3d      layer_stack=
+000156f0: 6c61 7965 725f 7374 6163 6b2c 0a20 2020  layer_stack,.   
+00015700: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00015710: 5f6c 6179 6572 733d 6578 636c 7564 655f  _layers=exclude_
+00015720: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+00015730: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
+00015740: 5f67 6572 6265 7228 7365 6c66 2c20 6469  _gerber(self, di
+00015750: 7270 6174 682c 206c 6179 6572 6d61 705f  rpath, layermap_
+00015760: 746f 5f67 6572 6265 725f 6c61 7965 722c  to_gerber_layer,
+00015770: 206f 7074 696f 6e73 2920 2d3e 204e 6f6e   options) -> Non
+00015780: 653a 0a20 2020 2020 2020 2066 726f 6d20  e:.        from 
+00015790: 6764 7366 6163 746f 7279 2e65 7870 6f72  gdsfactory.expor
+000157a0: 742e 746f 5f67 6572 6265 7220 696d 706f  t.to_gerber impo
+000157b0: 7274 2074 6f5f 6765 7262 6572 0a0a 2020  rt to_gerber..  
+000157c0: 2020 2020 2020 746f 5f67 6572 6265 7228        to_gerber(
+000157d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000157e0: 662c 0a20 2020 2020 2020 2020 2020 2064  f,.            d
+000157f0: 6972 7061 7468 3d64 6972 7061 7468 2c0a  irpath=dirpath,.
+00015800: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00015810: 726d 6170 5f74 6f5f 6765 7262 6572 5f6c  rmap_to_gerber_l
+00015820: 6179 6572 3d6c 6179 6572 6d61 705f 746f  ayer=layermap_to
+00015830: 5f67 6572 6265 725f 6c61 7965 722c 0a20  _gerber_layer,. 
+00015840: 2020 2020 2020 2020 2020 206f 7074 696f             optio
+00015850: 6e73 3d6f 7074 696f 6e73 2c0a 2020 2020  ns=options,.    
+00015860: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+00015870: 6f5f 676d 7368 280a 2020 2020 2020 2020  o_gmsh(.        
+00015880: 7365 6c66 2c0a 2020 2020 2020 2020 7479  self,.        ty
+00015890: 7065 2c0a 2020 2020 2020 2020 7a3d 4e6f  pe,.        z=No
+000158a0: 6e65 2c0a 2020 2020 2020 2020 7873 6563  ne,.        xsec
+000158b0: 7469 6f6e 5f62 6f75 6e64 733d 4e6f 6e65  tion_bounds=None
+000158c0: 2c0a 2020 2020 2020 2020 6c61 7965 725f  ,.        layer_
+000158d0: 7374 6163 6b3d 4e6f 6e65 2c0a 2020 2020  stack=None,.    
+000158e0: 2020 2020 7761 6665 725f 7061 6464 696e      wafer_paddin
+000158f0: 673d 302e 302c 0a20 2020 2020 2020 2077  g=0.0,.        w
+00015900: 6166 6572 5f6c 6179 6572 3d4c 4159 4552  afer_layer=LAYER
+00015910: 2e57 4146 4552 2c0a 2020 2020 2020 2020  .WAFER,.        
+00015920: 2a61 7267 732c 0a20 2020 2020 2020 202a  *args,.        *
+00015930: 2a6b 7761 7267 732c 0a20 2020 2029 3a0a  *kwargs,.    ):.
+00015940: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00015950: 6e73 2061 2067 6d73 6820 6d73 6820 6f66  ns a gmsh msh of
+00015960: 2074 6865 2063 6f6d 706f 6e65 6e74 2066   the component f
+00015970: 6f72 2066 696e 6974 6520 656c 656d 656e  or finite elemen
+00015980: 7420 7369 6d75 6c61 7469 6f6e 2e0a 0a20  t simulation... 
+00015990: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
+000159a0: 3a0a 2020 2020 2020 2020 2020 2020 7479  :.            ty
+000159b0: 7065 3a20 6f6e 6520 6f66 2022 7879 222c  pe: one of "xy",
+000159c0: 2022 757a 222c 206f 7220 2233 4422 2e20   "uz", or "3D". 
+000159d0: 4465 7465 726d 696e 6573 2074 6865 2074  Determines the t
+000159e0: 7970 6520 6f66 206d 6573 6820 746f 2072  ype of mesh to r
+000159f0: 6574 7572 6e2e 0a20 2020 2020 2020 2020  eturn..         
+00015a00: 2020 207a 3a20 7573 6564 2074 6f20 6465     z: used to de
+00015a10: 6669 6e65 207a 2d73 6c69 6365 2066 6f72  fine z-slice for
+00015a20: 2078 7920 6d65 7368 696e 670a 2020 2020   xy meshing.    
+00015a30: 2020 2020 2020 2020 7873 6563 7469 6f6e          xsection
+00015a40: 5f62 6f75 6e64 733a 2075 7365 6420 746f  _bounds: used to
+00015a50: 2064 6566 696e 6520 696e 2d70 6c61 6e65   define in-plane
+00015a60: 206c 696e 6520 666f 7220 757a 206d 6573   line for uz mes
+00015a70: 6869 6e67 0a20 2020 2020 2020 2020 2020  hing.           
+00015a80: 2077 6166 6572 5f70 6164 6469 6e67 3a20   wafer_padding: 
+00015a90: 7061 6464 696e 6720 6265 796f 6e64 2062  padding beyond b
+00015aa0: 626f 7820 746f 2061 6464 2074 6f20 5741  box to add to WA
+00015ab0: 4645 5220 6c61 7965 7273 2e0a 0a20 2020  FER layers...   
+00015ac0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+00015ad0: 733a 0a20 2020 2020 2020 2020 2020 2041  s:.            A
+00015ae0: 7267 756d 656e 7473 2066 6f72 2074 6865  rguments for the
+00015af0: 2074 6172 6765 7420 6d65 7368 696e 6720   target meshing 
+00015b00: 6675 6e63 7469 6f6e 2069 6e20 6770 6c75  function in gplu
+00015b10: 6769 6e73 2e67 6d73 680a 2020 2020 2020  gins.gmsh.      
+00015b20: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+00015b30: 4164 6420 5741 4645 5220 6c61 7965 723a  Add WAFER layer:
+00015b40: 0a20 2020 2020 2020 2070 6164 6465 645f  .        padded_
+00015b50: 636f 6d70 6f6e 656e 7420 3d20 436f 6d70  component = Comp
+00015b60: 6f6e 656e 7428 290a 2020 2020 2020 2020  onent().        
+00015b70: 7061 6464 6564 5f63 6f6d 706f 6e65 6e74  padded_component
+00015b80: 203c 3c20 7365 6c66 0a20 2020 2020 2020   << self.       
+00015b90: 2028 786d 696e 2c20 796d 696e 292c 2028   (xmin, ymin), (
+00015ba0: 786d 6178 2c20 796d 6178 2920 3d20 7365  xmax, ymax) = se
+00015bb0: 6c66 2e62 626f 780a 2020 2020 2020 2020  lf.bbox.        
+00015bc0: 706f 696e 7473 203d 205b 0a20 2020 2020  points = [.     
+00015bd0: 2020 2020 2020 205b 786d 696e 202d 2077         [xmin - w
+00015be0: 6166 6572 5f70 6164 6469 6e67 2c20 796d  afer_padding, ym
+00015bf0: 696e 202d 2077 6166 6572 5f70 6164 6469  in - wafer_paddi
+00015c00: 6e67 5d2c 0a20 2020 2020 2020 2020 2020  ng],.           
+00015c10: 205b 786d 6178 202b 2077 6166 6572 5f70   [xmax + wafer_p
+00015c20: 6164 6469 6e67 2c20 796d 696e 202d 2077  adding, ymin - w
+00015c30: 6166 6572 5f70 6164 6469 6e67 5d2c 0a20  afer_padding],. 
+00015c40: 2020 2020 2020 2020 2020 205b 786d 6178             [xmax
+00015c50: 202b 2077 6166 6572 5f70 6164 6469 6e67   + wafer_padding
+00015c60: 2c20 796d 6178 202b 2077 6166 6572 5f70  , ymax + wafer_p
+00015c70: 6164 6469 6e67 5d2c 0a20 2020 2020 2020  adding],.       
+00015c80: 2020 2020 205b 786d 696e 202d 2077 6166       [xmin - waf
+00015c90: 6572 5f70 6164 6469 6e67 2c20 796d 6178  er_padding, ymax
+00015ca0: 202b 2077 6166 6572 5f70 6164 6469 6e67   + wafer_padding
+00015cb0: 5d2c 0a20 2020 2020 2020 205d 0a20 2020  ],.        ].   
+00015cc0: 2020 2020 2070 6164 6465 645f 636f 6d70       padded_comp
+00015cd0: 6f6e 656e 742e 6164 645f 706f 6c79 676f  onent.add_polygo
+00015ce0: 6e28 706f 696e 7473 2c20 6c61 7965 723d  n(points, layer=
+00015cf0: 7761 6665 725f 6c61 7965 7229 0a20 2020  wafer_layer).   
+00015d00: 2020 2020 2070 6164 6465 645f 636f 6d70       padded_comp
+00015d10: 6f6e 656e 742e 6164 645f 706f 7274 7328  onent.add_ports(
+00015d20: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+00015d30: 6973 7428 2929 0a0a 2020 2020 2020 2020  ist())..        
+00015d40: 6966 206c 6179 6572 5f73 7461 636b 2069  if layer_stack i
+00015d50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00015d60: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00015d70: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00015d80: 2020 2020 2020 2741 204c 6179 6572 5374        'A LayerSt
+00015d90: 6163 6b20 6d75 7374 2062 6520 7072 6f76  ack must be prov
+00015da0: 6964 6564 2074 6872 6f75 6768 2061 7267  ided through arg
+00015db0: 756d 656e 7420 226c 6179 6572 5f73 7461  ument "layer_sta
+00015dc0: 636b 222e 270a 2020 2020 2020 2020 2020  ck".'.          
+00015dd0: 2020 290a 2020 2020 2020 2020 6966 2074    ).        if t
+00015de0: 7970 6520 3d3d 2022 7879 223a 0a20 2020  ype == "xy":.   
+00015df0: 2020 2020 2020 2020 2069 6620 7a20 6973           if z is
+00015e00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00015e10: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00015e20: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00015e30: 2020 2020 2020 2020 2020 2020 2027 466f               'Fo
+00015e40: 7220 7879 2d6d 6573 6869 6e67 2c20 6120  r xy-meshing, a 
+00015e50: 7a2d 7661 6c75 6520 6d75 7374 2062 6520  z-value must be 
+00015e60: 7072 6f76 6964 6564 2076 6961 2074 6865  provided via the
+00015e70: 2066 6c6f 6174 2061 7267 756d 656e 7420   float argument 
+00015e80: 227a 222e 270a 2020 2020 2020 2020 2020  "z".'.          
+00015e90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00015ea0: 2020 2020 6672 6f6d 2067 706c 7567 696e      from gplugin
+00015eb0: 732e 676d 7368 2e78 795f 7873 6563 7469  s.gmsh.xy_xsecti
+00015ec0: 6f6e 5f6d 6573 6820 696d 706f 7274 2078  on_mesh import x
+00015ed0: 795f 7873 6563 7469 6f6e 5f6d 6573 680a  y_xsection_mesh.
+00015ee0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00015ef0: 7572 6e20 7879 5f78 7365 6374 696f 6e5f  urn xy_xsection_
+00015f00: 6d65 7368 2870 6164 6465 645f 636f 6d70  mesh(padded_comp
+00015f10: 6f6e 656e 742c 207a 2c20 6c61 7965 725f  onent, z, layer_
+00015f20: 7374 6163 6b2c 202a 2a6b 7761 7267 7329  stack, **kwargs)
+00015f30: 0a20 2020 2020 2020 2065 6c69 6620 7479  .        elif ty
+00015f40: 7065 203d 3d20 2275 7a22 3a0a 2020 2020  pe == "uz":.    
+00015f50: 2020 2020 2020 2020 6966 2078 7365 6374          if xsect
+00015f60: 696f 6e5f 626f 756e 6473 2069 7320 4e6f  ion_bounds is No
+00015f70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00015f80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00015f90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00015fa0: 2020 2020 2020 2020 2020 2246 6f72 2075            "For u
+00015fb0: 7a2d 6d65 7368 696e 672c 2079 6f75 206d  z-meshing, you m
+00015fc0: 7573 7420 7072 6f76 6964 6520 6120 6c69  ust provide a li
+00015fd0: 6e65 2069 6e20 7468 6520 7879 2d70 6c61  ne in the xy-pla
+00015fe0: 6e65 2022 0a20 2020 2020 2020 2020 2020  ne ".           
+00015ff0: 2020 2020 2020 2020 2022 7669 6120 7468           "via th
+00016000: 6520 5475 706c 6520 6172 6775 6d65 6e74  e Tuple argument
+00016010: 205b 5b78 312c 7931 5d2c 205b 7832 2c79   [[x1,y1], [x2,y
+00016020: 325d 5d20 7873 6563 7469 6f6e 5f62 6f75  2]] xsection_bou
+00016030: 6e64 732e 220a 2020 2020 2020 2020 2020  nds.".          
+00016040: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00016050: 2020 2020 6672 6f6d 2067 706c 7567 696e      from gplugin
+00016060: 732e 676d 7368 2e75 7a5f 7873 6563 7469  s.gmsh.uz_xsecti
+00016070: 6f6e 5f6d 6573 6820 696d 706f 7274 2075  on_mesh import u
+00016080: 7a5f 7873 6563 7469 6f6e 5f6d 6573 680a  z_xsection_mesh.
+00016090: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000160a0: 7572 6e20 757a 5f78 7365 6374 696f 6e5f  urn uz_xsection_
+000160b0: 6d65 7368 280a 2020 2020 2020 2020 2020  mesh(.          
+000160c0: 2020 2020 2020 7061 6464 6564 5f63 6f6d        padded_com
+000160d0: 706f 6e65 6e74 2c20 7873 6563 7469 6f6e  ponent, xsection
+000160e0: 5f62 6f75 6e64 732c 206c 6179 6572 5f73  _bounds, layer_s
+000160f0: 7461 636b 2c20 2a2a 6b77 6172 6773 0a20  tack, **kwargs. 
+00016100: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00016110: 2020 2020 2065 6c69 6620 7479 7065 203d       elif type =
+00016120: 3d20 2233 4422 3a0a 2020 2020 2020 2020  = "3D":.        
+00016130: 2020 2020 7370 6563 203d 2069 6d70 6f72      spec = impor
+00016140: 746c 6962 2e75 7469 6c2e 6669 6e64 5f73  tlib.util.find_s
+00016150: 7065 6328 226d 6573 6877 656c 6c22 290a  pec("meshwell").
+00016160: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00016170: 7065 6320 6973 204e 6f6e 653a 0a20 2020  pec is None:.   
+00016180: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00016190: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+000161a0: 2020 2020 2020 2020 2233 4420 6d65 7368          "3D mesh
+000161b0: 696e 6720 7265 7175 6972 6573 206d 6573  ing requires mes
+000161c0: 6877 656c 6c2c 2073 6565 2068 7474 7073  hwell, see https
+000161d0: 3a2f 2f67 6974 6875 622e 636f 6d2f 7369  ://github.com/si
+000161e0: 6d62 696c 6f64 2f6d 6573 6877 656c 6c20  mbilod/meshwell 
+000161f0: 6f72 2072 756e 2070 6970 2069 6e73 7461  or run pip insta
+00016200: 6c6c 206d 6573 6877 656c 6c2e 220a 2020  ll meshwell.".  
+00016210: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00016220: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+00016230: 6d20 6770 6c75 6769 6e73 2e67 6d73 682e  m gplugins.gmsh.
+00016240: 7879 7a5f 6d65 7368 2069 6d70 6f72 7420  xyz_mesh import 
+00016250: 7879 7a5f 6d65 7368 0a0a 2020 2020 2020  xyz_mesh..      
+00016260: 2020 2020 2020 7265 7475 726e 2078 797a        return xyz
+00016270: 5f6d 6573 6828 7061 6464 6564 5f63 6f6d  _mesh(padded_com
+00016280: 706f 6e65 6e74 2c20 6c61 7965 725f 7374  ponent, layer_st
+00016290: 6163 6b2c 202a 2a6b 7761 7267 7329 0a20  ack, **kwargs). 
+000162a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000162b0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000162c0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+000162d0: 2020 2020 2020 2020 2020 2027 5265 7175             'Requ
+000162e0: 6972 6564 2061 7267 756d 656e 7420 2274  ired argument "t
+000162f0: 7970 6522 206d 7573 7420 6265 206f 6e65  ype" must be one
+00016300: 206f 6620 2278 7922 2c20 2275 7a22 2c20   of "xy", "uz", 
+00016310: 6f72 2022 3344 222e 270a 2020 2020 2020  or "3D".'.      
+00016320: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00016330: 206f 6666 7365 7428 0a20 2020 2020 2020   offset(.       
+00016340: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
+00016350: 6973 7461 6e63 653a 2066 6c6f 6174 203d  istance: float =
+00016360: 2030 2e31 2c0a 2020 2020 2020 2020 706f   0.1,.        po
+00016370: 6c79 676f 6e73 3d4e 6f6e 652c 0a20 2020  lygons=None,.   
+00016380: 2020 2020 2075 7365 5f75 6e69 6f6e 3a20       use_union: 
+00016390: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+000163a0: 2020 2020 2070 7265 6369 7369 6f6e 3a20       precision: 
+000163b0: 666c 6f61 7420 3d20 3165 2d34 2c0a 2020  float = 1e-4,.  
+000163c0: 2020 2020 2020 6a6f 696e 3a20 7374 7220        join: str 
+000163d0: 3d20 226d 6974 6572 222c 0a20 2020 2020  = "miter",.     
+000163e0: 2020 2074 6f6c 6572 616e 6365 3a20 696e     tolerance: in
+000163f0: 7420 3d20 322c 0a20 2020 2020 2020 206c  t = 2,.        l
+00016400: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
+00016410: 3d20 2257 4722 2c0a 2020 2020 2920 2d3e  = "WG",.    ) ->
+00016420: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
+00016430: 2020 2020 2222 2252 6574 7572 6e73 206e      """Returns n
+00016440: 6577 2043 6f6d 706f 6e65 6e74 2077 6974  ew Component wit
+00016450: 6820 706f 6c79 676f 6e73 2065 726f 6465  h polygons erode
+00016460: 6420 6f72 2064 696c 6174 6564 2062 7920  d or dilated by 
+00016470: 616e 206f 6666 7365 742e 0a0a 2020 2020  an offset...    
+00016480: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00016490: 2020 2020 2020 6469 7374 616e 6365 3a20        distance: 
+000164a0: 4469 7374 616e 6365 2074 6f20 6f66 6673  Distance to offs
+000164b0: 6574 2070 6f6c 7967 6f6e 732e 2050 6f73  et polygons. Pos
+000164c0: 6974 6976 6520 7661 6c75 6573 2065 7870  itive values exp
+000164d0: 616e 642c 206e 6567 6174 6976 6520 7368  and, negative sh
+000164e0: 7269 6e6b 2e0a 2020 2020 2020 2020 2020  rink..          
+000164f0: 2020 7072 6563 6973 696f 6e3a 2044 6573    precision: Des
+00016500: 6972 6564 2070 7265 6369 7369 6f6e 2066  ired precision f
+00016510: 6f72 2072 6f75 6e64 696e 6720 7665 7274  or rounding vert
+00016520: 6578 2063 6f6f 7264 696e 6174 6573 2e0a  ex coordinates..
+00016530: 2020 2020 2020 2020 2020 2020 6a6f 696e              join
+00016540: 3a20 7b27 6d69 7465 7227 2c20 2762 6576  : {'miter', 'bev
+00016550: 656c 272c 2027 726f 756e 6427 7d20 5479  el', 'round'} Ty
+00016560: 7065 206f 6620 6a6f 696e 2075 7365 6420  pe of join used 
+00016570: 746f 2063 7265 6174 6520 706f 6c79 676f  to create polygo
+00016580: 6e20 6f66 6673 6574 0a20 2020 2020 2020  n offset.       
+00016590: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+000165a0: 466f 7220 6d69 7465 7220 6a6f 696e 7473  For miter joints
+000165b0: 2c20 7468 6973 206e 756d 6265 7220 6d75  , this number mu
+000165c0: 7374 2062 6520 6174 206c 6561 7374 2032  st be at least 2
+000165d0: 2072 6570 7265 7365 6e74 7320 7468 650a   represents the.
+000165e0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+000165f0: 7869 6d61 6c20 6469 7374 616e 6365 2069  ximal distance i
+00016600: 6e20 6d75 6c74 6970 6c65 7320 6f66 206f  n multiples of o
+00016610: 6666 7365 7420 6265 7477 6565 6e20 6e65  ffset between ne
+00016620: 7720 7665 7274 6963 6573 2061 6e64 2074  w vertices and t
+00016630: 6865 6972 0a20 2020 2020 2020 2020 2020  heir.           
+00016640: 2020 206f 7269 6769 6e61 6c20 706f 7369     original posi
+00016650: 7469 6f6e 2062 6566 6f72 6520 6265 7665  tion before beve
+00016660: 6c69 6e67 2074 6f20 6176 6f69 6420 7370  ling to avoid sp
+00016670: 696b 6573 2061 7420 6163 7574 6520 6a6f  ikes at acute jo
+00016680: 696e 7473 2e20 466f 720a 2020 2020 2020  ints. For.      
+00016690: 2020 2020 2020 2020 726f 756e 6420 6a6f          round jo
+000166a0: 696e 7473 2c20 6974 2069 6e64 6963 6174  ints, it indicat
+000166b0: 6573 2074 6865 2063 7572 7661 7475 7265  es the curvature
+000166c0: 2072 6573 6f6c 7574 696f 6e20 696e 206e   resolution in n
+000166d0: 756d 6265 7220 6f66 0a20 2020 2020 2020  umber of.       
+000166e0: 2020 2020 2020 2070 6f69 6e74 7320 7065         points pe
+000166f0: 7220 6675 6c6c 2063 6972 636c 652e 0a20  r full circle.. 
+00016700: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00016710: 3a20 5370 6563 6966 6963 206c 6179 6572  : Specific layer
+00016720: 2066 6f72 206e 6577 2070 6f6c 7967 6f6e   for new polygon
+00016730: 732e 0a0a 2020 2020 2020 2020 2222 220a  s...        """.
+00016740: 2020 2020 2020 2020 696d 706f 7274 2067          import g
+00016750: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
+00016760: 0a20 2020 2020 2020 2067 6473 5f6c 6179  .        gds_lay
+00016770: 6572 2c20 6764 735f 6461 7461 7479 7065  er, gds_datatype
+00016780: 203d 2067 662e 6765 745f 6c61 7965 7228   = gf.get_layer(
+00016790: 6c61 7965 7229 0a20 2020 2020 2020 2070  layer).        p
+000167a0: 203d 2067 6473 746b 2e6f 6666 7365 7428   = gdstk.offset(
+000167b0: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+000167c0: 7967 6f6e 7320 6f72 2073 656c 662e 6765  ygons or self.ge
+000167d0: 745f 706f 6c79 676f 6e73 2829 2c0a 2020  t_polygons(),.  
+000167e0: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+000167f0: 6365 3d64 6973 7461 6e63 652c 0a20 2020  ce=distance,.   
+00016800: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
+00016810: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+00016820: 746f 6c65 7261 6e63 653d 746f 6c65 7261  tolerance=tolera
+00016830: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+00016840: 2070 7265 6369 7369 6f6e 3d70 7265 6369   precision=preci
+00016850: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+00016860: 2020 7573 655f 756e 696f 6e3d 7573 655f    use_union=use_
+00016870: 756e 696f 6e2c 0a20 2020 2020 2020 2020  union,.         
+00016880: 2020 206c 6179 6572 3d67 6473 5f6c 6179     layer=gds_lay
+00016890: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+000168a0: 6461 7461 7479 7065 3d67 6473 5f64 6174  datatype=gds_dat
+000168b0: 6174 7970 652c 0a20 2020 2020 2020 2029  atype,.        )
+000168c0: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
+000168d0: 656e 7420 3d20 6766 2e43 6f6d 706f 6e65  ent = gf.Compone
+000168e0: 6e74 2829 0a20 2020 2020 2020 2063 6f6d  nt().        com
+000168f0: 706f 6e65 6e74 2e61 6464 5f70 6f6c 7967  ponent.add_polyg
+00016900: 6f6e 2870 2c20 6c61 7965 723d 6c61 7965  on(p, layer=laye
+00016910: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
+00016920: 6e20 636f 6d70 6f6e 656e 740a 0a0a 6465  n component...de
+00016930: 6620 636f 7079 280a 2020 2020 443a 2043  f copy(.    D: C
+00016940: 6f6d 706f 6e65 6e74 2c0a 2020 2020 7265  omponent,.    re
+00016950: 6665 7265 6e63 6573 3d4e 6f6e 652c 0a20  ferences=None,. 
+00016960: 2020 2070 6f72 7473 3d4e 6f6e 652c 0a20     ports=None,. 
+00016970: 2020 2070 6f6c 7967 6f6e 733d 4e6f 6e65     polygons=None
+00016980: 2c0a 2020 2020 7061 7468 733d 4e6f 6e65  ,.    paths=None
+00016990: 2c0a 2020 2020 6e61 6d65 3d4e 6f6e 652c  ,.    name=None,
+000169a0: 0a20 2020 206c 6162 656c 733d 4e6f 6e65  .    labels=None
+000169b0: 2c0a 2920 2d3e 2043 6f6d 706f 6e65 6e74  ,.) -> Component
+000169c0: 3a0a 2020 2020 2222 2252 6574 7572 6e73  :.    """Returns
+000169d0: 2061 2043 6f6d 706f 6e65 6e74 2063 6f70   a Component cop
+000169e0: 792e 0a0a 2020 2020 4172 6773 3a0a 2020  y...    Args:.  
+000169f0: 2020 2020 2020 443a 2063 6f6d 706f 6e65        D: compone
+00016a00: 6e74 2074 6f20 636f 7079 2e0a 2020 2020  nt to copy..    
+00016a10: 2222 220a 2020 2020 445f 636f 7079 203d  """.    D_copy =
+00016a20: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
+00016a30: 2044 5f63 6f70 792e 696e 666f 203d 2044   D_copy.info = D
+00016a40: 2e69 6e66 6f0a 2020 2020 2320 445f 636f  .info.    # D_co
+00016a50: 7079 2e5f 6365 6c6c 203d 2044 2e5f 6365  py._cell = D._ce
+00016a60: 6c6c 2e63 6f70 7928 6e61 6d65 3d44 5f63  ll.copy(name=D_c
+00016a70: 6f70 792e 6e61 6d65 290a 0a20 2020 2066  opy.name)..    f
+00016a80: 6f72 2072 6566 2069 6e20 7265 6665 7265  or ref in refere
+00016a90: 6e63 6573 2069 6620 7265 6665 7265 6e63  nces if referenc
+00016aa0: 6573 2069 7320 6e6f 7420 4e6f 6e65 2065  es is not None e
+00016ab0: 6c73 6520 442e 7265 6665 7265 6e63 6573  lse D.references
+00016ac0: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
+00016ad0: 2e61 6464 2863 6f70 795f 7265 6665 7265  .add(copy_refere
+00016ae0: 6e63 6528 7265 6629 290a 2020 2020 666f  nce(ref)).    fo
+00016af0: 7220 706f 7274 2069 6e20 2870 6f72 7473  r port in (ports
+00016b00: 2069 6620 706f 7274 7320 6973 206e 6f74   if ports is not
+00016b10: 204e 6f6e 6520 656c 7365 2044 2e70 6f72   None else D.por
+00016b20: 7473 292e 7661 6c75 6573 2829 3a0a 2020  ts).values():.  
+00016b30: 2020 2020 2020 445f 636f 7079 2e61 6464        D_copy.add
+00016b40: 5f70 6f72 7428 706f 7274 3d70 6f72 7429  _port(port=port)
+00016b50: 0a20 2020 2066 6f72 2070 6f6c 7920 696e  .    for poly in
+00016b60: 2070 6f6c 7967 6f6e 7320 6966 2070 6f6c   polygons if pol
+00016b70: 7967 6f6e 7320 6973 206e 6f74 204e 6f6e  ygons is not Non
+00016b80: 6520 656c 7365 2044 2e70 6f6c 7967 6f6e  e else D.polygon
+00016b90: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
+00016ba0: 792e 6164 645f 706f 6c79 676f 6e28 706f  y.add_polygon(po
+00016bb0: 6c79 290a 2020 2020 666f 7220 7061 7468  ly).    for path
+00016bc0: 2069 6e20 7061 7468 7320 6966 2070 6174   in paths if pat
+00016bd0: 6873 2069 7320 6e6f 7420 4e6f 6e65 2065  hs is not None e
+00016be0: 6c73 6520 442e 7061 7468 733a 0a20 2020  lse D.paths:.   
+00016bf0: 2020 2020 2044 5f63 6f70 792e 6164 6428       D_copy.add(
+00016c00: 7061 7468 290a 2020 2020 666f 7220 6c61  path).    for la
+00016c10: 6265 6c20 696e 206c 6162 656c 7320 6966  bel in labels if
+00016c20: 206c 6162 656c 7320 6973 206e 6f74 204e   labels is not N
+00016c30: 6f6e 6520 656c 7365 2044 2e6c 6162 656c  one else D.label
+00016c40: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
+00016c50: 792e 6164 645f 6c61 6265 6c28 0a20 2020  y.add_label(.   
+00016c60: 2020 2020 2020 2020 2074 6578 743d 6c61           text=la
+00016c70: 6265 6c2e 7465 7874 2c0a 2020 2020 2020  bel.text,.      
+00016c80: 2020 2020 2020 706f 7369 7469 6f6e 3d6c        position=l
+00016c90: 6162 656c 2e6f 7269 6769 6e2c 0a20 2020  abel.origin,.   
+00016ca0: 2020 2020 2020 2020 206c 6179 6572 3d28           layer=(
+00016cb0: 6c61 6265 6c2e 6c61 7965 722c 206c 6162  label.layer, lab
+00016cc0: 656c 2e74 6578 7474 7970 6529 2c0a 2020  el.texttype),.  
+00016cd0: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
+00016ce0: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
+00016cf0: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
+00016d00: 2e6e 616d 6520 3d20 6e61 6d65 0a0a 2020  .name = name..  
+00016d10: 2020 7265 7475 726e 2044 5f63 6f70 790a    return D_copy.
+00016d20: 0a0a 6465 6620 636f 7079 5f72 6566 6572  ..def copy_refer
+00016d30: 656e 6365 280a 2020 2020 7265 662c 0a20  ence(.    ref,. 
+00016d40: 2020 2070 6172 656e 743d 4e6f 6e65 2c0a     parent=None,.
+00016d50: 2020 2020 636f 6c75 6d6e 733d 4e6f 6e65      columns=None
+00016d60: 2c0a 2020 2020 726f 7773 3d4e 6f6e 652c  ,.    rows=None,
+00016d70: 0a20 2020 2073 7061 6369 6e67 3d4e 6f6e  .    spacing=Non
+00016d80: 652c 0a20 2020 206f 7269 6769 6e3d 4e6f  e,.    origin=No
+00016d90: 6e65 2c0a 2020 2020 726f 7461 7469 6f6e  ne,.    rotation
+00016da0: 3d4e 6f6e 652c 0a20 2020 206d 6167 6e69  =None,.    magni
+00016db0: 6669 6361 7469 6f6e 3d4e 6f6e 652c 0a20  fication=None,. 
+00016dc0: 2020 2078 5f72 6566 6c65 6374 696f 6e3d     x_reflection=
+00016dd0: 4e6f 6e65 2c0a 2020 2020 6e61 6d65 3d4e  None,.    name=N
+00016de0: 6f6e 652c 0a20 2020 2076 313d 4e6f 6e65  one,.    v1=None
+00016df0: 2c0a 2020 2020 7632 3d4e 6f6e 652c 0a29  ,.    v2=None,.)
+00016e00: 202d 3e20 436f 6d70 6f6e 656e 7452 6566   -> ComponentRef
+00016e10: 6572 656e 6365 3a0a 2020 2020 7265 7475  erence:.    retu
+00016e20: 726e 2043 6f6d 706f 6e65 6e74 5265 6665  rn ComponentRefe
+00016e30: 7265 6e63 6528 0a20 2020 2020 2020 2063  rence(.        c
+00016e40: 6f6d 706f 6e65 6e74 3d70 6172 656e 7420  omponent=parent 
+00016e50: 6f72 2072 6566 2e70 6172 656e 742c 0a20  or ref.parent,. 
+00016e60: 2020 2020 2020 2063 6f6c 756d 6e73 3d63         columns=c
+00016e70: 6f6c 756d 6e73 206f 7220 7265 662e 636f  olumns or ref.co
+00016e80: 6c75 6d6e 732c 0a20 2020 2020 2020 2072  lumns,.        r
+00016e90: 6f77 733d 726f 7773 206f 7220 7265 662e  ows=rows or ref.
+00016ea0: 726f 7773 2c0a 2020 2020 2020 2020 7370  rows,.        sp
+00016eb0: 6163 696e 673d 7370 6163 696e 6720 6f72  acing=spacing or
+00016ec0: 2072 6566 2e73 7061 6369 6e67 2c0a 2020   ref.spacing,.  
+00016ed0: 2020 2020 2020 6f72 6967 696e 3d6f 7269        origin=ori
+00016ee0: 6769 6e20 6f72 2072 6566 2e6f 7269 6769  gin or ref.origi
+00016ef0: 6e2c 0a20 2020 2020 2020 2072 6f74 6174  n,.        rotat
+00016f00: 696f 6e3d 726f 7461 7469 6f6e 206f 7220  ion=rotation or 
+00016f10: 7265 662e 726f 7461 7469 6f6e 2c0a 2020  ref.rotation,.  
+00016f20: 2020 2020 2020 6d61 676e 6966 6963 6174        magnificat
+00016f30: 696f 6e3d 6d61 676e 6966 6963 6174 696f  ion=magnificatio
+00016f40: 6e20 6f72 2072 6566 2e6d 6167 6e69 6669  n or ref.magnifi
+00016f50: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
+00016f60: 785f 7265 666c 6563 7469 6f6e 3d78 5f72  x_reflection=x_r
+00016f70: 6566 6c65 6374 696f 6e20 6f72 2072 6566  eflection or ref
+00016f80: 2e78 5f72 6566 6c65 6374 696f 6e2c 0a20  .x_reflection,. 
+00016f90: 2020 2020 2020 206e 616d 653d 6e61 6d65         name=name
+00016fa0: 206f 7220 7265 662e 6e61 6d65 2c0a 2020   or ref.name,.  
+00016fb0: 2020 2020 2020 7631 3d76 3120 6f72 2072        v1=v1 or r
+00016fc0: 6566 2e76 312c 0a20 2020 2020 2020 2076  ef.v1,.        v
+00016fd0: 323d 7632 206f 7220 7265 662e 7632 2c0a  2=v2 or ref.v2,.
+00016fe0: 2020 2020 290a 0a0a 6465 6620 7465 7374      )...def test
+00016ff0: 5f67 6574 5f6c 6179 6572 7328 2920 2d3e  _get_layers() ->
+00017000: 204e 6f6e 653a 0a20 2020 2069 6d70 6f72   None:.    impor
+00017010: 7420 6764 7366 6163 746f 7279 2061 7320  t gdsfactory as 
+00017020: 6766 0a0a 2020 2020 6331 203d 2067 662e  gf..    c1 = gf.
+00017030: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
+00017040: 6768 7428 0a20 2020 2020 2020 206c 656e  ght(.        len
+00017050: 6774 683d 3130 2c0a 2020 2020 2020 2020  gth=10,.        
+00017060: 7769 6474 683d 302e 352c 0a20 2020 2020  width=0.5,.     
+00017070: 2020 206c 6179 6572 3d28 322c 2030 292c     layer=(2, 0),
+00017080: 0a20 2020 2020 2020 2062 626f 785f 6c61  .        bbox_la
+00017090: 7965 7273 3d5b 2831 3131 2c20 3029 5d2c  yers=[(111, 0)],
+000170a0: 0a20 2020 2020 2020 2062 626f 785f 6f66  .        bbox_of
+000170b0: 6673 6574 733d 5b33 5d2c 0a20 2020 2020  fsets=[3],.     
+000170c0: 2020 2077 6974 685f 6262 6f78 3d54 7275     with_bbox=Tru
+000170d0: 652c 0a20 2020 2020 2020 2063 6c61 6464  e,.        cladd
+000170e0: 696e 675f 6c61 7965 7273 3d4e 6f6e 652c  ing_layers=None,
+000170f0: 0a20 2020 2020 2020 2061 6464 5f70 696e  .        add_pin
+00017100: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00017110: 6164 645f 6262 6f78 3d4e 6f6e 652c 0a20  add_bbox=None,. 
+00017120: 2020 2029 0a20 2020 2061 7373 6572 7420     ).    assert 
+00017130: 6331 2e67 6574 5f6c 6179 6572 7328 2920  c1.get_layers() 
+00017140: 3d3d 207b 2832 2c20 3029 2c20 2831 3131  == {(2, 0), (111
+00017150: 2c20 3029 7d2c 2063 312e 6765 745f 6c61  , 0)}, c1.get_la
+00017160: 7965 7273 2829 0a20 2020 2023 2072 6574  yers().    # ret
+00017170: 7572 6e20 6331 0a20 2020 2063 3220 3d20  urn c1.    c2 = 
+00017180: 6331 2e72 656d 6f76 655f 6c61 7965 7273  c1.remove_layers
+00017190: 285b 2831 3131 2c20 3029 5d29 0a20 2020  ([(111, 0)]).   
+000171a0: 2061 7373 6572 7420 6332 2e67 6574 5f6c   assert c2.get_l
+000171b0: 6179 6572 7328 2920 3d3d 207b 2832 2c20  ayers() == {(2, 
+000171c0: 3029 7d2c 2063 322e 6765 745f 6c61 7965  0)}, c2.get_laye
+000171d0: 7273 2829 0a0a 0a64 6566 205f 6669 6c74  rs()...def _filt
+000171e0: 6572 5f70 6f6c 7973 2870 6f6c 7967 6f6e  er_polys(polygon
+000171f0: 732c 206c 6179 6572 735f 6578 636c 293a  s, layers_excl):
+00017200: 0a20 2020 2072 6574 7572 6e20 5b0a 2020  .    return [.  
+00017210: 2020 2020 2020 706f 6c79 676f 6e0a 2020        polygon.  
+00017220: 2020 2020 2020 666f 7220 706f 6c79 676f        for polygo
+00017230: 6e2c 206c 6179 6572 2c20 6461 7461 7479  n, layer, dataty
+00017240: 7065 2069 6e20 7a69 7028 0a20 2020 2020  pe in zip(.     
+00017250: 2020 2020 2020 2070 6f6c 7967 6f6e 732e         polygons.
+00017260: 706f 6c79 676f 6e73 2c20 706f 6c79 676f  polygons, polygo
+00017270: 6e73 2e6c 6179 6572 732c 2070 6f6c 7967  ns.layers, polyg
+00017280: 6f6e 732e 6461 7461 7479 7065 730a 2020  ons.datatypes.  
+00017290: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000172a0: 6966 2028 6c61 7965 722c 2064 6174 6174  if (layer, datat
+000172b0: 7970 6529 206e 6f74 2069 6e20 6c61 7965  ype) not in laye
+000172c0: 7273 5f65 7863 6c0a 2020 2020 5d0a 0a0a  rs_excl.    ]...
+000172d0: 6465 6620 7265 6375 7273 655f 7374 7275  def recurse_stru
+000172e0: 6374 7572 6573 280a 2020 2020 636f 6d70  ctures(.    comp
+000172f0: 6f6e 656e 743a 2043 6f6d 706f 6e65 6e74  onent: Component
+00017300: 2c0a 2020 2020 6967 6e6f 7265 5f63 6f6d  ,.    ignore_com
+00017310: 706f 6e65 6e74 735f 7072 6566 6978 3a20  ponents_prefix: 
+00017320: 6c69 7374 5b73 7472 5d20 7c20 4e6f 6e65  list[str] | None
+00017330: 203d 204e 6f6e 652c 0a20 2020 2069 676e   = None,.    ign
+00017340: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+00017350: 6566 6978 3a20 6c69 7374 5b73 7472 5d20  efix: list[str] 
+00017360: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a29  | None = None,.)
+00017370: 202d 3e20 6469 6374 5b73 7472 2c20 416e   -> dict[str, An
+00017380: 795d 3a0a 2020 2020 2222 2252 6563 7572  y]:.    """Recur
+00017390: 7365 2063 6f6d 706f 6e65 6e74 2061 6e64  se component and
+000173a0: 2063 6f6d 706f 6e65 6e74 7320 7265 6665   components refe
+000173b0: 7265 6e63 6573 2072 6563 7572 7369 7665  rences recursive
+000173c0: 6c79 2e0a 0a20 2020 2041 7267 733a 0a20  ly...    Args:. 
+000173d0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+000173e0: 3a20 636f 6d70 6f6e 656e 7420 746f 2072  : component to r
+000173f0: 6563 7572 7365 2e0a 2020 2020 2020 2020  ecurse..        
+00017400: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
+00017410: 735f 7072 6566 6978 3a20 6c69 7374 206f  s_prefix: list o
+00017420: 6620 7072 6566 6978 2074 6f20 6967 6e6f  f prefix to igno
+00017430: 7265 2e0a 2020 2020 2020 2020 6967 6e6f  re..        igno
+00017440: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
+00017450: 6669 783a 206c 6973 7420 6f66 2070 7265  fix: list of pre
+00017460: 6669 7820 746f 2069 676e 6f72 652e 0a20  fix to ignore.. 
+00017470: 2020 2022 2222 0a20 2020 2069 676e 6f72     """.    ignor
+00017480: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
+00017490: 6978 203d 2069 676e 6f72 655f 6675 6e63  ix = ignore_func
+000174a0: 7469 6f6e 735f 7072 6566 6978 206f 7220  tions_prefix or 
+000174b0: 5b5d 0a20 2020 2069 676e 6f72 655f 636f  [].    ignore_co
+000174c0: 6d70 6f6e 656e 7473 5f70 7265 6669 7820  mponents_prefix 
+000174d0: 3d20 6967 6e6f 7265 5f63 6f6d 706f 6e65  = ignore_compone
+000174e0: 6e74 735f 7072 6566 6978 206f 7220 5b5d  nts_prefix or []
+000174f0: 0a0a 2020 2020 6966 2028 0a20 2020 2020  ..    if (.     
+00017500: 2020 2068 6173 6174 7472 2863 6f6d 706f     hasattr(compo
+00017510: 6e65 6e74 2c20 2266 756e 6374 696f 6e5f  nent, "function_
+00017520: 6e61 6d65 2229 0a20 2020 2020 2020 2061  name").        a
+00017530: 6e64 2063 6f6d 706f 6e65 6e74 2e66 756e  nd component.fun
+00017540: 6374 696f 6e5f 6e61 6d65 2069 6e20 6967  ction_name in ig
+00017550: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
+00017560: 7265 6669 780a 2020 2020 293a 0a20 2020  refix.    ):.   
+00017570: 2020 2020 2072 6574 7572 6e20 7b7d 0a0a       return {}..
+00017580: 2020 2020 6966 2068 6173 6174 7472 2863      if hasattr(c
+00017590: 6f6d 706f 6e65 6e74 2c20 226e 616d 6522  omponent, "name"
+000175a0: 2920 616e 6420 616e 7928 0a20 2020 2020  ) and any(.     
+000175b0: 2020 2063 6f6d 706f 6e65 6e74 2e6e 616d     component.nam
+000175c0: 652e 7374 6172 7473 7769 7468 2869 2920  e.startswith(i) 
+000175d0: 666f 7220 6920 696e 2069 676e 6f72 655f  for i in ignore_
+000175e0: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
+000175f0: 780a 2020 2020 293a 0a20 2020 2020 2020  x.    ):.       
+00017600: 2072 6574 7572 6e20 7b7d 0a0a 2020 2020   return {}..    
+00017610: 6f75 7470 7574 203d 207b 636f 6d70 6f6e  output = {compon
+00017620: 656e 742e 6e61 6d65 3a20 6469 6374 2863  ent.name: dict(c
+00017630: 6f6d 706f 6e65 6e74 2e73 6574 7469 6e67  omponent.setting
+00017640: 7329 7d0a 2020 2020 666f 7220 7265 6665  s)}.    for refe
+00017650: 7265 6e63 6520 696e 2063 6f6d 706f 6e65  rence in compone
+00017660: 6e74 2e72 6566 6572 656e 6365 733a 0a20  nt.references:. 
+00017670: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00017680: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
+00017690: 6365 2872 6566 6572 656e 6365 2c20 436f  ce(reference, Co
+000176a0: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+000176b0: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+000176c0: 6420 7265 6665 7265 6e63 652e 7265 665f  d reference.ref_
+000176d0: 6365 6c6c 2e6e 616d 6520 6e6f 7420 696e  cell.name not in
+000176e0: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
+000176f0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+00017700: 7574 7075 742e 7570 6461 7465 2872 6563  utput.update(rec
+00017710: 7572 7365 5f73 7472 7563 7475 7265 7328  urse_structures(
+00017720: 7265 6665 7265 6e63 652e 7265 665f 6365  reference.ref_ce
+00017730: 6c6c 2929 0a0a 2020 2020 7265 7475 726e  ll))..    return
+00017740: 206f 7574 7075 740a 0a0a 6465 6620 666c   output...def fl
+00017750: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
+00017760: 6673 5f72 6563 7572 7369 7665 280a 2020  fs_recursive(.  
+00017770: 2020 636f 6d70 6f6e 656e 743a 2043 6f6d    component: Com
+00017780: 706f 6e65 6e74 2c0a 2020 2020 6772 6964  ponent,.    grid
+00017790: 5f73 697a 653a 2066 6c6f 6174 207c 204e  _size: float | N
+000177a0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+000177b0: 7570 6461 7465 645f 636f 6d70 6f6e 656e  updated_componen
+000177c0: 7473 3d4e 6f6e 652c 0a20 2020 2074 7261  ts=None,.    tra
+000177d0: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+000177e0: 733d 4e6f 6e65 2c0a 293a 0a20 2020 2022  s=None,.):.    "
+000177f0: 2222 5265 6375 7273 6976 656c 7920 666c  ""Recursively fl
+00017800: 6174 7465 6e73 2063 6f6d 706f 6e65 6e74  attens component
+00017810: 2072 6566 6572 656e 6365 7320 7768 6963   references whic
+00017820: 6820 6861 7665 2069 6e76 616c 6964 2074  h have invalid t
+00017830: 7261 6e73 666f 726d 6174 696f 6e73 2028  ransformations (
+00017840: 692e 652e 206e 6f6e 2d39 3020 6465 6720  i.e. non-90 deg 
+00017850: 726f 7461 7469 6f6e 7320 6f72 2073 7562  rotations or sub
+00017860: 2d67 7269 6420 7472 616e 736c 6174 696f  -grid translatio
+00017870: 6e73 2920 616e 6420 7265 7475 726e 7320  ns) and returns 
+00017880: 6120 636f 7079 2069 6620 616e 7920 7375  a copy if any su
+00017890: 6263 656c 6c73 2068 6176 6520 6265 656e  bcells have been
+000178a0: 206d 6f64 6966 6965 642e 0a0a 2020 2020   modified...    
+000178b0: 5741 524e 494e 473a 2074 6869 7320 6675  WARNING: this fu
+000178c0: 6e63 7469 6f6e 2077 696c 6c20 7072 6f64  nction will prod
+000178d0: 7563 6520 7361 6d65 2d6e 616d 6520 636f  uce same-name co
+000178e0: 7069 6573 206f 6620 6365 6c6c 732e 2049  pies of cells. I
+000178f0: 7420 6973 2073 7472 6963 746c 7920 6d65  t is strictly me
+00017900: 616e 7420 746f 2062 6520 7573 6564 206f  ant to be used o
+00017910: 6e20 7772 6974 6520 6f66 2074 6865 2047  n write of the G
+00017920: 4453 2066 696c 6520 616e 640a 2020 2020  DS file and.    
+00017930: 7368 6f75 6c64 206e 6f74 2062 6520 6d69  should not be mi
+00017940: 7865 6420 7769 7468 206f 7468 6572 2063  xed with other c
+00017950: 656c 6c73 2c20 6f72 2079 6f75 2077 696c  ells, or you wil
+00017960: 6c20 6c69 6b65 6c79 2065 7870 6572 6965  l likely experie
+00017970: 6e63 6520 6973 7375 6573 2077 6974 6820  nce issues with 
+00017980: 6475 706c 6963 6174 6520 6365 6c6c 730a  duplicate cells.
+00017990: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+000179a0: 2020 2063 6f6d 706f 6e65 6e74 3a20 7468     component: th
+000179b0: 6520 636f 6d70 6f6e 656e 7420 746f 2066  e component to f
+000179c0: 6978 2028 696e 2070 6c61 6365 292e 0a20  ix (in place).. 
+000179d0: 2020 2020 2020 2067 7269 645f 7369 7a65         grid_size
+000179e0: 3a20 7468 6520 4744 5320 6772 6964 2073  : the GDS grid s
+000179f0: 697a 652c 2069 6e20 756d 2c20 6465 6661  ize, in um, defa
+00017a00: 756c 7473 2074 6f20 6163 7469 7665 2050  ults to active P
+00017a10: 444b 2e67 6574 5f67 7269 645f 7369 7a65  DK.get_grid_size
+00017a20: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
+00017a30: 6e79 2074 7261 6e73 6c61 7469 6f6e 7320  ny translations 
+00017a40: 7769 7468 2068 6967 6865 7220 7265 736f  with higher reso
+00017a50: 6c75 7469 6f6e 2074 6861 6e20 7468 6973  lution than this
+00017a60: 2061 7265 2063 6f6e 7369 6465 7265 6420   are considered 
+00017a70: 696e 7661 6c69 642e 0a20 2020 2020 2020  invalid..       
+00017a80: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
+00017a90: 6e74 733a 2074 6865 2072 756e 6e69 6e67  nts: the running
+00017aa0: 2064 6963 7469 6f6e 6172 7920 6f66 2063   dictionary of c
+00017ab0: 6f6d 706f 6e65 6e74 7320 7768 6963 6820  omponents which 
+00017ac0: 6861 7665 2062 6565 6e20 6d6f 6469 6669  have been modifi
+00017ad0: 6564 2062 7920 7468 6973 2074 7261 6e73  ed by this trans
+00017ae0: 666f 726d 6174 696f 6e2e 2053 686f 756c  formation. Shoul
+00017af0: 6420 616c 7761 7973 2062 6520 4e6f 6e65  d always be None
+00017b00: 2c20 6578 6365 7074 2066 6f72 2072 6563  , except for rec
+00017b10: 7572 7369 7665 2069 6e76 6f63 6174 696f  ursive invocatio
+00017b20: 6e73 2e0a 2020 2020 2020 2020 7472 6176  ns..        trav
+00017b30: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
+00017b40: 3a20 7468 6520 7365 7420 6f66 2063 6f6d  : the set of com
+00017b50: 706f 6e65 6e74 206e 616d 6573 2077 6869  ponent names whi
+00017b60: 6368 2068 6176 6520 6265 656e 2074 7261  ch have been tra
+00017b70: 7665 7273 6564 2e20 5368 6f75 6c64 2061  versed. Should a
+00017b80: 6c77 6179 7320 6265 204e 6f6e 652c 2065  lways be None, e
+00017b90: 7863 6570 7420 666f 7220 7265 6375 7273  xcept for recurs
+00017ba0: 6976 6520 696e 766f 6361 7469 6f6e 732e  ive invocations.
+00017bb0: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
+00017bc0: 6d20 6764 7366 6163 746f 7279 2e64 6563  m gdsfactory.dec
+00017bd0: 6f72 6174 6f72 7320 696d 706f 7274 2069  orators import i
+00017be0: 735f 696e 7661 6c69 645f 7265 660a 0a20  s_invalid_ref.. 
+00017bf0: 2020 2069 6e76 616c 6964 5f72 6566 7320     invalid_refs 
+00017c00: 3d20 5b5d 0a20 2020 2072 6566 7320 3d20  = [].    refs = 
+00017c10: 636f 6d70 6f6e 656e 742e 7265 6665 7265  component.refere
+00017c20: 6e63 6573 0a20 2020 2073 7562 6365 6c6c  nces.    subcell
+00017c30: 5f6d 6f64 6966 6965 6420 3d20 4661 6c73  _modified = Fals
+00017c40: 650a 2020 2020 6966 2075 7064 6174 6564  e.    if updated
+00017c50: 5f63 6f6d 706f 6e65 6e74 7320 6973 204e  _components is N
+00017c60: 6f6e 653a 0a20 2020 2020 2020 2075 7064  one:.        upd
+00017c70: 6174 6564 5f63 6f6d 706f 6e65 6e74 7320  ated_components 
+00017c80: 3d20 7b7d 0a20 2020 2069 6620 7472 6176  = {}.    if trav
+00017c90: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
+00017ca0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00017cb0: 2020 7472 6176 6572 7365 645f 636f 6d70    traversed_comp
+00017cc0: 6f6e 656e 7473 203d 2073 6574 2829 0a20  onents = set(). 
+00017cd0: 2020 2066 6f72 2072 6566 2069 6e20 7265     for ref in re
+00017ce0: 6673 3a0a 2020 2020 2020 2020 2320 6d61  fs:.        # ma
+00017cf0: 726b 2061 6e79 2069 6e76 616c 6964 2072  rk any invalid r
+00017d00: 6566 7320 666f 7220 666c 6174 7465 6e69  efs for flatteni
+00017d10: 6e67 0a20 2020 2020 2020 2023 206f 7468  ng.        # oth
+00017d20: 6572 7769 7365 2c20 6368 6563 6b20 6966  erwise, check if
+00017d30: 2074 6865 7265 2061 7265 2061 6e79 206d   there are any m
+00017d40: 6f64 6966 6965 6420 6365 6c6c 7320 6265  odified cells be
+00017d50: 6e65 6174 6820 2877 6520 6e65 6564 206e  neath (we need n
+00017d60: 6f74 2064 6f20 7468 6973 2069 6620 7468  ot do this if th
+00017d70: 6520 7265 6620 7769 6c6c 2062 6520 666c  e ref will be fl
+00017d80: 6174 7465 6e65 6420 616e 7977 6179 7329  attened anyways)
+00017d90: 0a20 2020 2020 2020 2069 6620 6973 5f69  .        if is_i
+00017da0: 6e76 616c 6964 5f72 6566 2872 6566 2c20  nvalid_ref(ref, 
+00017db0: 6772 6964 5f73 697a 6529 3a0a 2020 2020  grid_size):.    
+00017dc0: 2020 2020 2020 2020 696e 7661 6c69 645f          invalid_
+00017dd0: 7265 6673 2e61 7070 656e 6428 7265 662e  refs.append(ref.
+00017de0: 6e61 6d65 290a 2020 2020 2020 2020 656c  name).        el
+00017df0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017e00: 2320 6f74 6865 7277 6973 652c 2072 6563  # otherwise, rec
+00017e10: 7572 7369 7665 6c79 2066 6c61 7474 656e  ursively flatten
+00017e20: 2072 6566 7320 6966 2074 6865 2073 7562   refs if the sub
+00017e30: 6365 6c6c 2068 6173 206e 6f74 2061 6c72  cell has not alr
+00017e40: 6561 6479 2062 6565 6e20 7472 6176 6572  eady been traver
+00017e50: 7365 640a 2020 2020 2020 2020 2020 2020  sed.            
+00017e60: 6966 2072 6566 2e70 6172 656e 742e 6e61  if ref.parent.na
+00017e70: 6d65 206e 6f74 2069 6e20 7472 6176 6572  me not in traver
+00017e80: 7365 645f 636f 6d70 6f6e 656e 7473 3a0a  sed_components:.
 00017e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ea0: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
-00017eb0: 6e74 733d 7570 6461 7465 645f 636f 6d70  nts=updated_comp
-00017ec0: 6f6e 656e 7473 2c0a 2020 2020 2020 2020  onents,.        
-00017ed0: 2020 2020 2020 2020 2020 2020 7472 6176              trav
-00017ee0: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
-00017ef0: 3d74 7261 7665 7273 6564 5f63 6f6d 706f  =traversed_compo
-00017f00: 6e65 6e74 732c 0a20 2020 2020 2020 2020  nents,.         
-00017f10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00017f20: 2020 2020 2023 206e 6f77 2c20 6966 2074       # now, if t
-00017f30: 6865 2072 6566 2773 2063 656c 6c20 6265  he ref's cell be
-00017f40: 656e 206d 6f64 6966 6965 642c 206d 6172  en modified, mar
-00017f50: 6b20 6974 2061 7320 7375 6368 0a20 2020  k it as such.   
-00017f60: 2020 2020 2020 2020 2069 6620 7265 662e           if ref.
-00017f70: 7061 7265 6e74 2e6e 616d 6520 696e 2075  parent.name in u
-00017f80: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
-00017f90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00017fa0: 2020 2073 7562 6365 6c6c 5f6d 6f64 6966     subcell_modif
-00017fb0: 6965 6420 3d20 5472 7565 0a20 2020 2069  ied = True.    i
-00017fc0: 6620 696e 7661 6c69 645f 7265 6673 206f  f invalid_refs o
-00017fd0: 7220 7375 6263 656c 6c5f 6d6f 6469 6669  r subcell_modifi
-00017fe0: 6564 3a0a 2020 2020 2020 2020 6e65 775f  ed:.        new_
-00017ff0: 636f 6d70 6f6e 656e 7420 3d20 636f 6d70  component = comp
-00018000: 6f6e 656e 742e 636f 7079 2829 0a20 2020  onent.copy().   
-00018010: 2020 2020 206e 6577 5f63 6f6d 706f 6e65       new_compone
-00018020: 6e74 2e6e 616d 6520 3d20 636f 6d70 6f6e  nt.name = compon
-00018030: 656e 742e 6e61 6d65 0a20 2020 2020 2020  ent.name.       
-00018040: 2023 206d 616b 6520 7375 7265 2061 6c6c   # make sure all
-00018050: 206d 6f64 6966 6965 6420 6365 6c6c 7320   modified cells 
-00018060: 6861 7665 2074 6865 6972 2072 6566 6572  have their refer
-00018070: 656e 6365 7320 7570 6461 7465 640a 2020  ences updated.  
-00018080: 2020 2020 2020 6e65 775f 7265 6673 203d        new_refs =
-00018090: 206e 6577 5f63 6f6d 706f 6e65 6e74 2e72   new_component.r
-000180a0: 6566 6572 656e 6365 732e 636f 7079 2829  eferences.copy()
-000180b0: 0a20 2020 2020 2020 2066 6f72 2072 6566  .        for ref
-000180c0: 2069 6e20 6e65 775f 7265 6673 3a0a 2020   in new_refs:.  
-000180d0: 2020 2020 2020 2020 2020 6966 2072 6566            if ref
-000180e0: 2e6e 616d 6520 696e 2069 6e76 616c 6964  .name in invalid
-000180f0: 5f72 6566 733a 0a20 2020 2020 2020 2020  _refs:.         
-00018100: 2020 2020 2020 206e 6577 5f63 6f6d 706f         new_compo
-00018110: 6e65 6e74 2e66 6c61 7474 656e 5f72 6566  nent.flatten_ref
-00018120: 6572 656e 6365 2872 6566 290a 2020 2020  erence(ref).    
-00018130: 2020 2020 2020 2020 656c 6966 2028 0a20          elif (. 
-00018140: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018150: 6566 2e70 6172 656e 742e 6e61 6d65 2069  ef.parent.name i
-00018160: 6e20 7570 6461 7465 645f 636f 6d70 6f6e  n updated_compon
-00018170: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
-00018180: 2020 2020 2061 6e64 2072 6566 2e70 6172       and ref.par
-00018190: 656e 7420 6973 206e 6f74 2075 7064 6174  ent is not updat
-000181a0: 6564 5f63 6f6d 706f 6e65 6e74 735b 7265  ed_components[re
-000181b0: 662e 7061 7265 6e74 2e6e 616d 655d 0a20  f.parent.name]. 
-000181c0: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-000181d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000181e0: 662e 7061 7265 6e74 203d 2075 7064 6174  f.parent = updat
-000181f0: 6564 5f63 6f6d 706f 6e65 6e74 735b 7265  ed_components[re
-00018200: 662e 7061 7265 6e74 2e6e 616d 655d 0a20  f.parent.name]. 
-00018210: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00018220: 203d 206e 6577 5f63 6f6d 706f 6e65 6e74   = new_component
-00018230: 0a20 2020 2020 2020 2075 7064 6174 6564  .        updated
-00018240: 5f63 6f6d 706f 6e65 6e74 735b 636f 6d70  _components[comp
-00018250: 6f6e 656e 742e 6e61 6d65 5d20 3d20 6e65  onent.name] = ne
-00018260: 775f 636f 6d70 6f6e 656e 740a 2020 2020  w_component.    
-00018270: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
-00018280: 656e 7473 2e61 6464 2863 6f6d 706f 6e65  ents.add(compone
-00018290: 6e74 2e6e 616d 6529 0a20 2020 2072 6574  nt.name).    ret
-000182a0: 7572 6e20 636f 6d70 6f6e 656e 740a 0a0a  urn component...
-000182b0: 6465 6620 5f63 6865 636b 5f75 6e63 6163  def _check_uncac
-000182c0: 6865 645f 636f 6d70 6f6e 656e 7473 2863  hed_components(c
-000182d0: 6f6d 706f 6e65 6e74 2c20 6d6f 6465 293a  omponent, mode):
-000182e0: 0a20 2020 2076 616c 6964 5f6d 6f64 6573  .    valid_modes
-000182f0: 203d 205b 2277 6172 6e22 2c20 2265 7272   = ["warn", "err
-00018300: 6f72 222c 2022 6967 6e6f 7265 225d 0a0a  or", "ignore"]..
-00018310: 2020 2020 6966 206d 6f64 6520 3d3d 2022      if mode == "
-00018320: 6967 6e6f 7265 223a 0a20 2020 2020 2020  ignore":.       
-00018330: 2072 6574 7572 6e0a 2020 2020 656c 6966   return.    elif
-00018340: 206d 6f64 6520 6e6f 7420 696e 2076 616c   mode not in val
-00018350: 6964 5f6d 6f64 6573 3a0a 2020 2020 2020  id_modes:.      
-00018360: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00018370: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00018380: 6622 7b6d 6f64 657d 2069 7320 6e6f 7420  f"{mode} is not 
-00018390: 6120 7661 6c69 6420 7661 6c75 6520 666f  a valid value fo
-000183a0: 7220 6f6e 5f75 6e63 6163 6865 645f 636f  r on_uncached_co
-000183b0: 6d70 6f6e 656e 742e 2054 7279 206f 6e65  mponent. Try one
-000183c0: 206f 6620 7468 6573 653a 207b 7661 6c69   of these: {vali
-000183d0: 645f 6d6f 6465 737d 2e22 0a20 2020 2020  d_modes}.".     
-000183e0: 2020 2029 0a0a 2020 2020 666f 7220 7375     )..    for su
-000183f0: 625f 636f 6d70 6f6e 656e 7420 696e 2063  b_component in c
-00018400: 6f6d 706f 6e65 6e74 2e67 6574 5f64 6570  omponent.get_dep
-00018410: 656e 6465 6e63 6965 7328 7265 6375 7273  endencies(recurs
-00018420: 6976 653d 5472 7565 293a 0a20 2020 2020  ive=True):.     
-00018430: 2020 2069 6620 6e6f 7420 7375 625f 636f     if not sub_co
-00018440: 6d70 6f6e 656e 742e 5f6c 6f63 6b65 643a  mponent._locked:
-00018450: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
-00018460: 7361 6765 203d 2028 0a20 2020 2020 2020  sage = (.       
-00018470: 2020 2020 2020 2020 2066 2243 6f6d 706f           f"Compo
-00018480: 6e65 6e74 207b 7375 625f 636f 6d70 6f6e  nent {sub_compon
-00018490: 656e 742e 6e61 6d65 2172 7d20 7761 7320  ent.name!r} was 
-000184a0: 4e4f 5420 7072 6f70 6572 6c79 206c 6f63  NOT properly loc
-000184b0: 6b65 642e 2022 0a20 2020 2020 2020 2020  ked. ".         
-000184c0: 2020 2020 2020 2022 596f 7520 6e65 6564         "You need
-000184d0: 2074 6f20 7772 6974 6520 6974 2069 6e74   to write it int
-000184e0: 6f20 6120 6675 6e63 7469 6f6e 2074 6861  o a function tha
-000184f0: 7420 6861 7320 7468 6520 4063 656c 6c20  t has the @cell 
-00018500: 6465 636f 7261 746f 722e 220a 2020 2020  decorator.".    
-00018510: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00018520: 2020 2020 2020 6966 206d 6f64 6520 3d3d        if mode ==
-00018530: 2022 7761 726e 223a 0a20 2020 2020 2020   "warn":.       
-00018540: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00018550: 732e 7761 726e 286d 6573 7361 6765 2c20  s.warn(message, 
-00018560: 556e 6361 6368 6564 436f 6d70 6f6e 656e  UncachedComponen
-00018570: 7457 6172 6e69 6e67 2c20 7374 6163 6b6c  tWarning, stackl
-00018580: 6576 656c 3d33 290a 0a20 2020 2020 2020  evel=3)..       
-00018590: 2020 2020 2065 6c69 6620 6d6f 6465 203d       elif mode =
-000185a0: 3d20 2265 7272 6f72 223a 0a20 2020 2020  = "error":.     
-000185b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000185c0: 2055 6e63 6163 6865 6443 6f6d 706f 6e65   UncachedCompone
-000185d0: 6e74 4572 726f 7228 6d65 7373 6167 6529  ntError(message)
-000185e0: 0a0a 0a64 6566 2074 6573 745f 7361 6d65  ...def test_same
-000185f0: 5f75 6964 2829 202d 3e20 4e6f 6e65 3a0a  _uid() -> None:.
-00018600: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
-00018610: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
-00018620: 2063 203d 2043 6f6d 706f 6e65 6e74 2829   c = Component()
-00018630: 0a20 2020 2063 203c 3c20 6766 2e63 6f6d  .    c << gf.com
-00018640: 706f 6e65 6e74 732e 7265 6374 616e 676c  ponents.rectangl
-00018650: 6528 290a 2020 2020 6320 3c3c 2067 662e  e().    c << gf.
-00018660: 636f 6d70 6f6e 656e 7473 2e72 6563 7461  components.recta
-00018670: 6e67 6c65 2829 0a0a 2020 2020 7231 203d  ngle()..    r1 =
-00018680: 2063 2e72 6566 6572 656e 6365 735b 305d   c.references[0]
-00018690: 2e70 6172 656e 740a 2020 2020 7232 203d  .parent.    r2 =
-000186a0: 2063 2e72 6566 6572 656e 6365 735b 315d   c.references[1]
-000186b0: 2e70 6172 656e 740a 0a20 2020 2061 7373  .parent..    ass
-000186c0: 6572 7420 7231 2e75 6964 203d 3d20 7232  ert r1.uid == r2
-000186d0: 2e75 6964 2c20 6622 7b72 312e 7569 647d  .uid, f"{r1.uid}
-000186e0: 206d 7573 7420 6571 7561 6c20 7b72 322e   must equal {r2.
-000186f0: 7569 647d 220a 0a0a 6465 6620 7465 7374  uid}"...def test
-00018700: 5f6e 6574 6c69 7374 5f73 696d 706c 6528  _netlist_simple(
-00018710: 2920 2d3e 204e 6f6e 653a 0a20 2020 2069  ) -> None:.    i
-00018720: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
-00018730: 2061 7320 6766 0a0a 2020 2020 6320 3d20   as gf..    c = 
-00018740: 6766 2e43 6f6d 706f 6e65 6e74 2829 0a20  gf.Component(). 
-00018750: 2020 2063 3120 3d20 6320 3c3c 2067 662e     c1 = c << gf.
-00018760: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
-00018770: 6768 7428 6c65 6e67 7468 3d31 2c20 7769  ght(length=1, wi
-00018780: 6474 683d 3229 0a20 2020 2063 3220 3d20  dth=2).    c2 = 
-00018790: 6320 3c3c 2067 662e 636f 6d70 6f6e 656e  c << gf.componen
-000187a0: 7473 2e73 7472 6169 6768 7428 6c65 6e67  ts.straight(leng
-000187b0: 7468 3d32 2c20 7769 6474 683d 3229 0a20  th=2, width=2). 
-000187c0: 2020 2063 322e 636f 6e6e 6563 7428 706f     c2.connect(po
-000187d0: 7274 3d22 6f31 222c 2064 6573 7469 6e61  rt="o1", destina
-000187e0: 7469 6f6e 3d63 312e 706f 7274 735b 226f  tion=c1.ports["o
-000187f0: 3222 5d29 0a20 2020 2063 2e61 6464 5f70  2"]).    c.add_p
-00018800: 6f72 7428 226f 3122 2c20 706f 7274 3d63  ort("o1", port=c
-00018810: 312e 706f 7274 735b 226f 3122 5d29 0a20  1.ports["o1"]). 
-00018820: 2020 2063 2e61 6464 5f70 6f72 7428 226f     c.add_port("o
-00018830: 3222 2c20 706f 7274 3d63 322e 706f 7274  2", port=c2.port
-00018840: 735b 226f 3222 5d29 0a20 2020 206e 6574  s["o2"]).    net
-00018850: 6c69 7374 203d 2063 2e67 6574 5f6e 6574  list = c.get_net
-00018860: 6c69 7374 2829 0a20 2020 2023 2070 7269  list().    # pri
-00018870: 6e74 286e 6574 6c69 7374 2e70 7265 7474  nt(netlist.prett
-00018880: 7928 2929 0a20 2020 2061 7373 6572 7420  y()).    assert 
-00018890: 6c65 6e28 6e65 746c 6973 745b 2269 6e73  len(netlist["ins
-000188a0: 7461 6e63 6573 225d 2920 3d3d 2032 0a0a  tances"]) == 2..
-000188b0: 0a64 6566 2074 6573 745f 6e65 746c 6973  .def test_netlis
-000188c0: 745f 7369 6d70 6c65 5f77 6964 7468 5f6d  t_simple_width_m
-000188d0: 6973 6d61 7463 685f 7468 726f 7773 5f65  ismatch_throws_e
-000188e0: 7272 6f72 2829 202d 3e20 4e6f 6e65 3a0a  rror() -> None:.
-000188f0: 2020 2020 696d 706f 7274 2070 7974 6573      import pytes
-00018900: 740a 0a20 2020 2069 6d70 6f72 7420 6764  t..    import gd
-00018910: 7366 6163 746f 7279 2061 7320 6766 0a0a  sfactory as gf..
-00018920: 2020 2020 6320 3d20 6766 2e43 6f6d 706f      c = gf.Compo
-00018930: 6e65 6e74 2829 0a20 2020 2063 3120 3d20  nent().    c1 = 
-00018940: 6320 3c3c 2067 662e 636f 6d70 6f6e 656e  c << gf.componen
-00018950: 7473 2e73 7472 6169 6768 7428 6c65 6e67  ts.straight(leng
-00018960: 7468 3d31 2c20 7769 6474 683d 3129 0a20  th=1, width=1). 
-00018970: 2020 2063 3220 3d20 6320 3c3c 2067 662e     c2 = c << gf.
-00018980: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
-00018990: 6768 7428 6c65 6e67 7468 3d32 2c20 7769  ght(length=2, wi
-000189a0: 6474 683d 3229 0a20 2020 2063 322e 636f  dth=2).    c2.co
-000189b0: 6e6e 6563 7428 706f 7274 3d22 6f31 222c  nnect(port="o1",
-000189c0: 2064 6573 7469 6e61 7469 6f6e 3d63 312e   destination=c1.
-000189d0: 706f 7274 735b 226f 3222 5d29 0a20 2020  ports["o2"]).   
-000189e0: 2063 2e61 6464 5f70 6f72 7428 226f 3122   c.add_port("o1"
-000189f0: 2c20 706f 7274 3d63 312e 706f 7274 735b  , port=c1.ports[
-00018a00: 226f 3122 5d29 0a20 2020 2063 2e61 6464  "o1"]).    c.add
-00018a10: 5f70 6f72 7428 226f 3222 2c20 706f 7274  _port("o2", port
-00018a20: 3d63 322e 706f 7274 735b 226f 3222 5d29  =c2.ports["o2"])
-00018a30: 0a20 2020 2077 6974 6820 7079 7465 7374  .    with pytest
-00018a40: 2e72 6169 7365 7328 5661 6c75 6545 7272  .raises(ValueErr
-00018a50: 6f72 293a 0a20 2020 2020 2020 2063 2e67  or):.        c.g
-00018a60: 6574 5f6e 6574 6c69 7374 2829 0a0a 0a64  et_netlist()...d
-00018a70: 6566 2074 6573 745f 6e65 746c 6973 745f  ef test_netlist_
-00018a80: 636f 6d70 6c65 7828 2920 2d3e 204e 6f6e  complex() -> Non
-00018a90: 653a 0a20 2020 2069 6d70 6f72 7420 6764  e:.    import gd
-00018aa0: 7366 6163 746f 7279 2061 7320 6766 0a0a  sfactory as gf..
-00018ab0: 2020 2020 6320 3d20 6766 2e63 6f6d 706f      c = gf.compo
-00018ac0: 6e65 6e74 732e 6d7a 695f 6172 6d73 2829  nents.mzi_arms()
-00018ad0: 0a20 2020 206e 6574 6c69 7374 203d 2063  .    netlist = c
-00018ae0: 2e67 6574 5f6e 6574 6c69 7374 2829 0a20  .get_netlist(). 
-00018af0: 2020 2023 2070 7269 6e74 286e 6574 6c69     # print(netli
-00018b00: 7374 2e70 7265 7474 7928 2929 0a20 2020  st.pretty()).   
-00018b10: 2061 7373 6572 7420 6c65 6e28 6e65 746c   assert len(netl
-00018b20: 6973 745b 2269 6e73 7461 6e63 6573 225d  ist["instances"]
-00018b30: 2920 3d3d 2034 2c20 6c65 6e28 6e65 746c  ) == 4, len(netl
-00018b40: 6973 745b 2269 6e73 7461 6e63 6573 225d  ist["instances"]
-00018b50: 290a 0a0a 6465 6620 7465 7374 5f65 7874  )...def test_ext
-00018b60: 7261 6374 2829 202d 3e20 4e6f 6e65 3a0a  ract() -> None:.
-00018b70: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
-00018b80: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
-00018b90: 2063 203d 2067 662e 636f 6d70 6f6e 656e   c = gf.componen
-00018ba0: 7473 2e73 7472 6169 6768 7428 0a20 2020  ts.straight(.   
-00018bb0: 2020 2020 206c 656e 6774 683d 3130 2c0a       length=10,.
-00018bc0: 2020 2020 2020 2020 7769 6474 683d 302e          width=0.
-00018bd0: 352c 0a20 2020 2020 2020 2062 626f 785f  5,.        bbox_
-00018be0: 6c61 7965 7273 3d5b 6766 2e4c 4159 4552  layers=[gf.LAYER
-00018bf0: 2e57 4743 4c41 445d 2c0a 2020 2020 2020  .WGCLAD],.      
-00018c00: 2020 6262 6f78 5f6f 6666 7365 7473 3d5b    bbox_offsets=[
-00018c10: 335d 2c0a 2020 2020 2020 2020 7769 7468  3],.        with
-00018c20: 5f62 626f 783d 5472 7565 2c0a 2020 2020  _bbox=True,.    
-00018c30: 2020 2020 636c 6164 6469 6e67 5f6c 6179      cladding_lay
-00018c40: 6572 733d 4e6f 6e65 2c0a 2020 2020 2020  ers=None,.      
-00018c50: 2020 6164 645f 7069 6e73 3d4e 6f6e 652c    add_pins=None,
-00018c60: 0a20 2020 2020 2020 2061 6464 5f62 626f  .        add_bbo
-00018c70: 783d 4e6f 6e65 2c0a 2020 2020 290a 2020  x=None,.    ).  
-00018c80: 2020 6332 203d 2063 2e65 7874 7261 6374    c2 = c.extract
-00018c90: 286c 6179 6572 733d 5b67 662e 4c41 5945  (layers=[gf.LAYE
-00018ca0: 522e 5747 434c 4144 5d29 0a0a 2020 2020  R.WGCLAD])..    
-00018cb0: 6173 7365 7274 206c 656e 2863 2e70 6f6c  assert len(c.pol
-00018cc0: 7967 6f6e 7329 203d 3d20 322c 206c 656e  ygons) == 2, len
-00018cd0: 2863 2e70 6f6c 7967 6f6e 7329 0a20 2020  (c.polygons).   
-00018ce0: 2061 7373 6572 7420 6c65 6e28 6332 2e70   assert len(c2.p
-00018cf0: 6f6c 7967 6f6e 7329 203d 3d20 312c 206c  olygons) == 1, l
-00018d00: 656e 2863 322e 706f 6c79 676f 6e73 290a  en(c2.polygons).
-00018d10: 2020 2020 6173 7365 7274 2067 662e 4c41      assert gf.LA
-00018d20: 5945 522e 5747 434c 4144 2069 6e20 6332  YER.WGCLAD in c2
-00018d30: 2e6c 6179 6572 730a 0a0a 6465 6620 6861  .layers...def ha
-00018d40: 7368 5f66 696c 6528 6669 6c65 7061 7468  sh_file(filepath
-00018d50: 293a 0a20 2020 206d 6435 203d 2068 6173  ):.    md5 = has
-00018d60: 686c 6962 2e6d 6435 2829 0a20 2020 206d  hlib.md5().    m
-00018d70: 6435 2e75 7064 6174 6528 6669 6c65 7061  d5.update(filepa
-00018d80: 7468 2e72 6561 645f 6279 7465 7328 2929  th.read_bytes())
-00018d90: 0a20 2020 2072 6574 7572 6e20 6d64 352e  .    return md5.
-00018da0: 6865 7864 6967 6573 7428 290a 0a0a 6465  hexdigest()...de
-00018db0: 6620 7465 7374 5f62 626f 785f 7265 6665  f test_bbox_refe
-00018dc0: 7265 6e63 6528 2920 2d3e 204e 6f6e 653a  rence() -> None:
-00018dd0: 0a20 2020 2069 6d70 6f72 7420 6764 7366  .    import gdsf
-00018de0: 6163 746f 7279 2061 7320 6766 0a0a 2020  actory as gf..  
-00018df0: 2020 6320 3d20 6766 2e43 6f6d 706f 6e65    c = gf.Compone
-00018e00: 6e74 2829 0a20 2020 2063 3120 3d20 6320  nt().    c1 = c 
-00018e10: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
-00018e20: 2e72 6563 7461 6e67 6c65 2873 697a 653d  .rectangle(size=
-00018e30: 2831 2e35 652d 332c 2031 2e35 652d 3329  (1.5e-3, 1.5e-3)
-00018e40: 2c20 706f 7274 5f74 7970 653d 4e6f 6e65  , port_type=None
-00018e50: 290a 2020 2020 6332 203d 2063 203c 3c20  ).    c2 = c << 
-00018e60: 6766 2e63 6f6d 706f 6e65 6e74 732e 7265  gf.components.re
-00018e70: 6374 616e 676c 6528 7369 7a65 3d28 312e  ctangle(size=(1.
-00018e80: 3565 2d33 2c20 312e 3565 2d33 292c 2070  5e-3, 1.5e-3), p
-00018e90: 6f72 745f 7479 7065 3d4e 6f6e 6529 0a20  ort_type=None). 
-00018ea0: 2020 2063 322e 786d 696e 203d 2063 312e     c2.xmin = c1.
-00018eb0: 786d 6178 0a0a 2020 2020 6173 7365 7274  xmax..    assert
-00018ec0: 2063 322e 7873 697a 6520 3d3d 2031 2e35   c2.xsize == 1.5
-00018ed0: 652d 330a 0a0a 6465 6620 7465 7374 5f72  e-3...def test_r
-00018ee0: 656d 6f76 655f 6c61 6265 6c73 2829 202d  emove_labels() -
-00018ef0: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
-00018f00: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-00018f10: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
-00018f20: 632e 7374 7261 6967 6874 2829 0a20 2020  c.straight().   
-00018f30: 2063 2e72 656d 6f76 655f 6c61 6265 6c73   c.remove_labels
-00018f40: 2829 0a0a 2020 2020 6173 7365 7274 206c  ()..    assert l
-00018f50: 656e 2863 2e6c 6162 656c 7329 203d 3d20  en(c.labels) == 
-00018f60: 300a 0a0a 6465 6620 7465 7374 5f69 6d70  0...def test_imp
-00018f70: 6f72 745f 6764 735f 7365 7474 696e 6773  ort_gds_settings
-00018f80: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
-00018f90: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
-00018fa0: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
-00018fb0: 2067 662e 636f 6d70 6f6e 656e 7473 2e6d   gf.components.m
-00018fc0: 7a69 2829 0a20 2020 2067 6473 7061 7468  zi().    gdspath
-00018fd0: 203d 2063 2e77 7269 7465 5f67 6473 2877   = c.write_gds(w
-00018fe0: 6974 685f 6d65 7461 6461 7461 3d54 7275  ith_metadata=Tru
-00018ff0: 6529 0a20 2020 2063 3220 3d20 6766 2e69  e).    c2 = gf.i
-00019000: 6d70 6f72 745f 6764 7328 6764 7370 6174  mport_gds(gdspat
-00019010: 682c 206e 616d 653d 226d 7a69 5f73 616d  h, name="mzi_sam
-00019020: 706c 6522 2c20 7265 6164 5f6d 6574 6164  ple", read_metad
-00019030: 6174 613d 5472 7565 290a 2020 2020 6333  ata=True).    c3
-00019040: 203d 2067 662e 726f 7574 696e 672e 6164   = gf.routing.ad
-00019050: 645f 6669 6265 725f 7369 6e67 6c65 2863  d_fiber_single(c
-00019060: 3229 0a20 2020 2061 7373 6572 7420 6333  2).    assert c3
-00019070: 0a0a 0a69 6620 5f5f 6e61 6d65 5f5f 203d  ...if __name__ =
-00019080: 3d20 225f 5f6d 6169 6e5f 5f22 3a0a 2020  = "__main__":.  
-00019090: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
-000190a0: 6f72 7920 6173 2067 660a 0a20 2020 2063  ory as gf..    c
-000190b0: 203d 2067 662e 632e 6d7a 6928 290a 2020   = gf.c.mzi().  
-000190c0: 2020 632e 7070 7269 6e74 5f70 6f72 7473    c.pprint_ports
-000190d0: 2829 0a0a 2020 2020 2320 6320 3d20 6766  ()..    # c = gf
-000190e0: 2e43 6f6d 706f 6e65 6e74 2829 0a20 2020  .Component().   
-000190f0: 2023 2070 203d 2063 2e61 6464 5f70 6f6c   # p = c.add_pol
-00019100: 7967 6f6e 280a 2020 2020 2320 2020 2020  ygon(.    #     
-00019110: 5b28 2d38 2c20 362c 2037 2c20 3929 2c20  [(-8, 6, 7, 9), 
-00019120: 282d 362c 2038 2c20 3137 2c20 3529 5d2c  (-6, 8, 17, 5)],
-00019130: 206c 6179 6572 3d28 312c 2030 290a 2020   layer=(1, 0).  
-00019140: 2020 2320 2920 2023 2047 4453 206c 6179    # )  # GDS lay
-00019150: 6572 7320 6172 6520 7475 706c 6573 206f  ers are tuples o
-00019160: 6620 696e 7473 2028 6275 7420 6966 2077  f ints (but if w
-00019170: 6520 7573 6520 6f6e 6c79 206f 6e65 206e  e use only one n
-00019180: 756d 6265 7220 6974 2061 7373 756d 6573  umber it assumes
-00019190: 2074 6865 206f 7468 6572 206e 756d 6265   the other numbe
-000191a0: 7220 6973 2030 290a 2020 2020 2320 632e  r is 0).    # c.
-000191b0: 7772 6974 655f 6764 7328 2268 692e 6764  write_gds("hi.gd
-000191c0: 7322 290a 2020 2020 2320 632e 7368 6f77  s").    # c.show
-000191d0: 2829 0a20 2020 2023 2070 7269 6e74 2843  ().    # print(C
-000191e0: 4f4e 462e 6c61 7374 5f73 6176 6564 5f66  ONF.last_saved_f
-000191f0: 696c 6573 290a                           iles).
+00017ea0: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
+00017eb0: 7265 6673 5f72 6563 7572 7369 7665 280a  refs_recursive(.
+00017ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ed0: 2020 2020 7265 662e 7061 7265 6e74 2c0a      ref.parent,.
+00017ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ef0: 2020 2020 6772 6964 5f73 697a 653d 6772      grid_size=gr
+00017f00: 6964 5f73 697a 652c 0a20 2020 2020 2020  id_size,.       
+00017f10: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+00017f20: 6174 6564 5f63 6f6d 706f 6e65 6e74 733d  ated_components=
+00017f30: 7570 6461 7465 645f 636f 6d70 6f6e 656e  updated_componen
+00017f40: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00017f50: 2020 2020 2020 2020 7472 6176 6572 7365          traverse
+00017f60: 645f 636f 6d70 6f6e 656e 7473 3d74 7261  d_components=tra
+00017f70: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+00017f80: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00017f90: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00017fa0: 2023 206e 6f77 2c20 6966 2074 6865 2072   # now, if the r
+00017fb0: 6566 2773 2063 656c 6c20 6265 656e 206d  ef's cell been m
+00017fc0: 6f64 6966 6965 642c 206d 6172 6b20 6974  odified, mark it
+00017fd0: 2061 7320 7375 6368 0a20 2020 2020 2020   as such.       
+00017fe0: 2020 2020 2069 6620 7265 662e 7061 7265       if ref.pare
+00017ff0: 6e74 2e6e 616d 6520 696e 2075 7064 6174  nt.name in updat
+00018000: 6564 5f63 6f6d 706f 6e65 6e74 733a 0a20  ed_components:. 
+00018010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018020: 7562 6365 6c6c 5f6d 6f64 6966 6965 6420  ubcell_modified 
+00018030: 3d20 5472 7565 0a20 2020 2069 6620 696e  = True.    if in
+00018040: 7661 6c69 645f 7265 6673 206f 7220 7375  valid_refs or su
+00018050: 6263 656c 6c5f 6d6f 6469 6669 6564 3a0a  bcell_modified:.
+00018060: 2020 2020 2020 2020 6e65 775f 636f 6d70          new_comp
+00018070: 6f6e 656e 7420 3d20 636f 6d70 6f6e 656e  onent = componen
+00018080: 742e 636f 7079 2829 0a20 2020 2020 2020  t.copy().       
+00018090: 206e 6577 5f63 6f6d 706f 6e65 6e74 2e6e   new_component.n
+000180a0: 616d 6520 3d20 636f 6d70 6f6e 656e 742e  ame = component.
+000180b0: 6e61 6d65 0a20 2020 2020 2020 2023 206d  name.        # m
+000180c0: 616b 6520 7375 7265 2061 6c6c 206d 6f64  ake sure all mod
+000180d0: 6966 6965 6420 6365 6c6c 7320 6861 7665  ified cells have
+000180e0: 2074 6865 6972 2072 6566 6572 656e 6365   their reference
+000180f0: 7320 7570 6461 7465 640a 2020 2020 2020  s updated.      
+00018100: 2020 6e65 775f 7265 6673 203d 206e 6577    new_refs = new
+00018110: 5f63 6f6d 706f 6e65 6e74 2e72 6566 6572  _component.refer
+00018120: 656e 6365 732e 636f 7079 2829 0a20 2020  ences.copy().   
+00018130: 2020 2020 2066 6f72 2072 6566 2069 6e20       for ref in 
+00018140: 6e65 775f 7265 6673 3a0a 2020 2020 2020  new_refs:.      
+00018150: 2020 2020 2020 6966 2072 6566 2e6e 616d        if ref.nam
+00018160: 6520 696e 2069 6e76 616c 6964 5f72 6566  e in invalid_ref
+00018170: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00018180: 2020 206e 6577 5f63 6f6d 706f 6e65 6e74     new_component
+00018190: 2e66 6c61 7474 656e 5f72 6566 6572 656e  .flatten_referen
+000181a0: 6365 2872 6566 290a 2020 2020 2020 2020  ce(ref).        
+000181b0: 2020 2020 656c 6966 2028 0a20 2020 2020      elif (.     
+000181c0: 2020 2020 2020 2020 2020 2072 6566 2e70             ref.p
+000181d0: 6172 656e 742e 6e61 6d65 2069 6e20 7570  arent.name in up
+000181e0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
+000181f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018200: 2061 6e64 2072 6566 2e70 6172 656e 7420   and ref.parent 
+00018210: 6973 206e 6f74 2075 7064 6174 6564 5f63  is not updated_c
+00018220: 6f6d 706f 6e65 6e74 735b 7265 662e 7061  omponents[ref.pa
+00018230: 7265 6e74 2e6e 616d 655d 0a20 2020 2020  rent.name].     
+00018240: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00018250: 2020 2020 2020 2020 2020 7265 662e 7061            ref.pa
+00018260: 7265 6e74 203d 2075 7064 6174 6564 5f63  rent = updated_c
+00018270: 6f6d 706f 6e65 6e74 735b 7265 662e 7061  omponents[ref.pa
+00018280: 7265 6e74 2e6e 616d 655d 0a20 2020 2020  rent.name].     
+00018290: 2020 2063 6f6d 706f 6e65 6e74 203d 206e     component = n
+000182a0: 6577 5f63 6f6d 706f 6e65 6e74 0a20 2020  ew_component.   
+000182b0: 2020 2020 2075 7064 6174 6564 5f63 6f6d       updated_com
+000182c0: 706f 6e65 6e74 735b 636f 6d70 6f6e 656e  ponents[componen
+000182d0: 742e 6e61 6d65 5d20 3d20 6e65 775f 636f  t.name] = new_co
+000182e0: 6d70 6f6e 656e 740a 2020 2020 7472 6176  mponent.    trav
+000182f0: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
+00018300: 2e61 6464 2863 6f6d 706f 6e65 6e74 2e6e  .add(component.n
+00018310: 616d 6529 0a20 2020 2072 6574 7572 6e20  ame).    return 
+00018320: 636f 6d70 6f6e 656e 740a 0a0a 6465 6620  component...def 
+00018330: 5f63 6865 636b 5f75 6e63 6163 6865 645f  _check_uncached_
+00018340: 636f 6d70 6f6e 656e 7473 2863 6f6d 706f  components(compo
+00018350: 6e65 6e74 2c20 6d6f 6465 293a 0a20 2020  nent, mode):.   
+00018360: 2076 616c 6964 5f6d 6f64 6573 203d 205b   valid_modes = [
+00018370: 2277 6172 6e22 2c20 2265 7272 6f72 222c  "warn", "error",
+00018380: 2022 6967 6e6f 7265 225d 0a0a 2020 2020   "ignore"]..    
+00018390: 6966 206d 6f64 6520 3d3d 2022 6967 6e6f  if mode == "igno
+000183a0: 7265 223a 0a20 2020 2020 2020 2072 6574  re":.        ret
+000183b0: 7572 6e0a 2020 2020 656c 6966 206d 6f64  urn.    elif mod
+000183c0: 6520 6e6f 7420 696e 2076 616c 6964 5f6d  e not in valid_m
+000183d0: 6f64 6573 3a0a 2020 2020 2020 2020 7261  odes:.        ra
+000183e0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+000183f0: 2020 2020 2020 2020 2020 2020 6622 7b6d              f"{m
+00018400: 6f64 657d 2069 7320 6e6f 7420 6120 7661  ode} is not a va
+00018410: 6c69 6420 7661 6c75 6520 666f 7220 6f6e  lid value for on
+00018420: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
+00018430: 656e 742e 2054 7279 206f 6e65 206f 6620  ent. Try one of 
+00018440: 7468 6573 653a 207b 7661 6c69 645f 6d6f  these: {valid_mo
+00018450: 6465 737d 2e22 0a20 2020 2020 2020 2029  des}.".        )
+00018460: 0a0a 2020 2020 666f 7220 7375 625f 636f  ..    for sub_co
+00018470: 6d70 6f6e 656e 7420 696e 2063 6f6d 706f  mponent in compo
+00018480: 6e65 6e74 2e67 6574 5f64 6570 656e 6465  nent.get_depende
+00018490: 6e63 6965 7328 7265 6375 7273 6976 653d  ncies(recursive=
+000184a0: 5472 7565 293a 0a20 2020 2020 2020 2069  True):.        i
+000184b0: 6620 6e6f 7420 7375 625f 636f 6d70 6f6e  f not sub_compon
+000184c0: 656e 742e 5f6c 6f63 6b65 643a 0a20 2020  ent._locked:.   
+000184d0: 2020 2020 2020 2020 206d 6573 7361 6765           message
+000184e0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000184f0: 2020 2020 2066 2243 6f6d 706f 6e65 6e74       f"Component
+00018500: 207b 7375 625f 636f 6d70 6f6e 656e 742e   {sub_component.
+00018510: 6e61 6d65 2172 7d20 7761 7320 4e4f 5420  name!r} was NOT 
+00018520: 7072 6f70 6572 6c79 206c 6f63 6b65 642e  properly locked.
+00018530: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00018540: 2020 2022 596f 7520 6e65 6564 2074 6f20     "You need to 
+00018550: 7772 6974 6520 6974 2069 6e74 6f20 6120  write it into a 
+00018560: 6675 6e63 7469 6f6e 2074 6861 7420 6861  function that ha
+00018570: 7320 7468 6520 4063 656c 6c20 6465 636f  s the @cell deco
+00018580: 7261 746f 722e 220a 2020 2020 2020 2020  rator.".        
+00018590: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000185a0: 2020 6966 206d 6f64 6520 3d3d 2022 7761    if mode == "wa
+000185b0: 726e 223a 0a20 2020 2020 2020 2020 2020  rn":.           
+000185c0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+000185d0: 726e 286d 6573 7361 6765 2c20 556e 6361  rn(message, Unca
+000185e0: 6368 6564 436f 6d70 6f6e 656e 7457 6172  chedComponentWar
+000185f0: 6e69 6e67 2c20 7374 6163 6b6c 6576 656c  ning, stacklevel
+00018600: 3d33 290a 0a20 2020 2020 2020 2020 2020  =3)..           
+00018610: 2065 6c69 6620 6d6f 6465 203d 3d20 2265   elif mode == "e
+00018620: 7272 6f72 223a 0a20 2020 2020 2020 2020  rror":.         
+00018630: 2020 2020 2020 2072 6169 7365 2055 6e63         raise Unc
+00018640: 6163 6865 6443 6f6d 706f 6e65 6e74 4572  achedComponentEr
+00018650: 726f 7228 6d65 7373 6167 6529 0a0a 0a64  ror(message)...d
+00018660: 6566 2074 6573 745f 7361 6d65 5f75 6964  ef test_same_uid
+00018670: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00018680: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00018690: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+000186a0: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
+000186b0: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
+000186c0: 6e74 732e 7265 6374 616e 676c 6528 290a  nts.rectangle().
+000186d0: 2020 2020 6320 3c3c 2067 662e 636f 6d70      c << gf.comp
+000186e0: 6f6e 656e 7473 2e72 6563 7461 6e67 6c65  onents.rectangle
+000186f0: 2829 0a0a 2020 2020 7231 203d 2063 2e72  ()..    r1 = c.r
+00018700: 6566 6572 656e 6365 735b 305d 2e70 6172  eferences[0].par
+00018710: 656e 740a 2020 2020 7232 203d 2063 2e72  ent.    r2 = c.r
+00018720: 6566 6572 656e 6365 735b 315d 2e70 6172  eferences[1].par
+00018730: 656e 740a 0a20 2020 2061 7373 6572 7420  ent..    assert 
+00018740: 7231 2e75 6964 203d 3d20 7232 2e75 6964  r1.uid == r2.uid
+00018750: 2c20 6622 7b72 312e 7569 647d 206d 7573  , f"{r1.uid} mus
+00018760: 7420 6571 7561 6c20 7b72 322e 7569 647d  t equal {r2.uid}
+00018770: 220a 0a0a 6465 6620 7465 7374 5f6e 6574  "...def test_net
+00018780: 6c69 7374 5f73 696d 706c 6528 2920 2d3e  list_simple() ->
+00018790: 204e 6f6e 653a 0a20 2020 2069 6d70 6f72   None:.    impor
+000187a0: 7420 6764 7366 6163 746f 7279 2061 7320  t gdsfactory as 
+000187b0: 6766 0a0a 2020 2020 6320 3d20 6766 2e43  gf..    c = gf.C
+000187c0: 6f6d 706f 6e65 6e74 2829 0a20 2020 2063  omponent().    c
+000187d0: 3120 3d20 6320 3c3c 2067 662e 636f 6d70  1 = c << gf.comp
+000187e0: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+000187f0: 6c65 6e67 7468 3d31 2c20 7769 6474 683d  length=1, width=
+00018800: 3229 0a20 2020 2063 3220 3d20 6320 3c3c  2).    c2 = c <<
+00018810: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00018820: 7472 6169 6768 7428 6c65 6e67 7468 3d32  traight(length=2
+00018830: 2c20 7769 6474 683d 3229 0a20 2020 2063  , width=2).    c
+00018840: 322e 636f 6e6e 6563 7428 706f 7274 3d22  2.connect(port="
+00018850: 6f31 222c 2064 6573 7469 6e61 7469 6f6e  o1", destination
+00018860: 3d63 312e 706f 7274 735b 226f 3222 5d29  =c1.ports["o2"])
+00018870: 0a20 2020 2063 2e61 6464 5f70 6f72 7428  .    c.add_port(
+00018880: 226f 3122 2c20 706f 7274 3d63 312e 706f  "o1", port=c1.po
+00018890: 7274 735b 226f 3122 5d29 0a20 2020 2063  rts["o1"]).    c
+000188a0: 2e61 6464 5f70 6f72 7428 226f 3222 2c20  .add_port("o2", 
+000188b0: 706f 7274 3d63 322e 706f 7274 735b 226f  port=c2.ports["o
+000188c0: 3222 5d29 0a20 2020 206e 6574 6c69 7374  2"]).    netlist
+000188d0: 203d 2063 2e67 6574 5f6e 6574 6c69 7374   = c.get_netlist
+000188e0: 2829 0a20 2020 2023 2070 7269 6e74 286e  ().    # print(n
+000188f0: 6574 6c69 7374 2e70 7265 7474 7928 2929  etlist.pretty())
+00018900: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
+00018910: 6e65 746c 6973 745b 2269 6e73 7461 6e63  netlist["instanc
+00018920: 6573 225d 2920 3d3d 2032 0a0a 0a64 6566  es"]) == 2...def
+00018930: 2074 6573 745f 6e65 746c 6973 745f 7369   test_netlist_si
+00018940: 6d70 6c65 5f77 6964 7468 5f6d 6973 6d61  mple_width_misma
+00018950: 7463 685f 7468 726f 7773 5f65 7272 6f72  tch_throws_error
+00018960: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00018970: 696d 706f 7274 2070 7974 6573 740a 0a20  import pytest.. 
+00018980: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00018990: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+000189a0: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
+000189b0: 2829 0a20 2020 2063 3120 3d20 6320 3c3c  ().    c1 = c <<
+000189c0: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+000189d0: 7472 6169 6768 7428 6c65 6e67 7468 3d31  traight(length=1
+000189e0: 2c20 7769 6474 683d 3129 0a20 2020 2063  , width=1).    c
+000189f0: 3220 3d20 6320 3c3c 2067 662e 636f 6d70  2 = c << gf.comp
+00018a00: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+00018a10: 6c65 6e67 7468 3d32 2c20 7769 6474 683d  length=2, width=
+00018a20: 3229 0a20 2020 2063 322e 636f 6e6e 6563  2).    c2.connec
+00018a30: 7428 706f 7274 3d22 6f31 222c 2064 6573  t(port="o1", des
+00018a40: 7469 6e61 7469 6f6e 3d63 312e 706f 7274  tination=c1.port
+00018a50: 735b 226f 3222 5d29 0a20 2020 2063 2e61  s["o2"]).    c.a
+00018a60: 6464 5f70 6f72 7428 226f 3122 2c20 706f  dd_port("o1", po
+00018a70: 7274 3d63 312e 706f 7274 735b 226f 3122  rt=c1.ports["o1"
+00018a80: 5d29 0a20 2020 2063 2e61 6464 5f70 6f72  ]).    c.add_por
+00018a90: 7428 226f 3222 2c20 706f 7274 3d63 322e  t("o2", port=c2.
+00018aa0: 706f 7274 735b 226f 3222 5d29 0a20 2020  ports["o2"]).   
+00018ab0: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+00018ac0: 7365 7328 5661 6c75 6545 7272 6f72 293a  ses(ValueError):
+00018ad0: 0a20 2020 2020 2020 2063 2e67 6574 5f6e  .        c.get_n
+00018ae0: 6574 6c69 7374 2829 0a0a 0a64 6566 2074  etlist()...def t
+00018af0: 6573 745f 6e65 746c 6973 745f 636f 6d70  est_netlist_comp
+00018b00: 6c65 7828 2920 2d3e 204e 6f6e 653a 0a20  lex() -> None:. 
+00018b10: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00018b20: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+00018b30: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
+00018b40: 732e 6d7a 695f 6172 6d73 2829 0a20 2020  s.mzi_arms().   
+00018b50: 206e 6574 6c69 7374 203d 2063 2e67 6574   netlist = c.get
+00018b60: 5f6e 6574 6c69 7374 2829 0a20 2020 2023  _netlist().    #
+00018b70: 2070 7269 6e74 286e 6574 6c69 7374 2e70   print(netlist.p
+00018b80: 7265 7474 7928 2929 0a20 2020 2061 7373  retty()).    ass
+00018b90: 6572 7420 6c65 6e28 6e65 746c 6973 745b  ert len(netlist[
+00018ba0: 2269 6e73 7461 6e63 6573 225d 2920 3d3d  "instances"]) ==
+00018bb0: 2034 2c20 6c65 6e28 6e65 746c 6973 745b   4, len(netlist[
+00018bc0: 2269 6e73 7461 6e63 6573 225d 290a 0a0a  "instances"])...
+00018bd0: 6465 6620 7465 7374 5f65 7874 7261 6374  def test_extract
+00018be0: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00018bf0: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00018c00: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+00018c10: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00018c20: 7472 6169 6768 7428 0a20 2020 2020 2020  traight(.       
+00018c30: 206c 656e 6774 683d 3130 2c0a 2020 2020   length=10,.    
+00018c40: 2020 2020 7769 6474 683d 302e 352c 0a20      width=0.5,. 
+00018c50: 2020 2020 2020 2062 626f 785f 6c61 7965         bbox_laye
+00018c60: 7273 3d5b 6766 2e4c 4159 4552 2e57 4743  rs=[gf.LAYER.WGC
+00018c70: 4c41 445d 2c0a 2020 2020 2020 2020 6262  LAD],.        bb
+00018c80: 6f78 5f6f 6666 7365 7473 3d5b 335d 2c0a  ox_offsets=[3],.
+00018c90: 2020 2020 2020 2020 7769 7468 5f62 626f          with_bbo
+00018ca0: 783d 5472 7565 2c0a 2020 2020 2020 2020  x=True,.        
+00018cb0: 636c 6164 6469 6e67 5f6c 6179 6572 733d  cladding_layers=
+00018cc0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6164  None,.        ad
+00018cd0: 645f 7069 6e73 3d4e 6f6e 652c 0a20 2020  d_pins=None,.   
+00018ce0: 2020 2020 2061 6464 5f62 626f 783d 4e6f       add_bbox=No
+00018cf0: 6e65 2c0a 2020 2020 290a 2020 2020 6332  ne,.    ).    c2
+00018d00: 203d 2063 2e65 7874 7261 6374 286c 6179   = c.extract(lay
+00018d10: 6572 733d 5b67 662e 4c41 5945 522e 5747  ers=[gf.LAYER.WG
+00018d20: 434c 4144 5d29 0a0a 2020 2020 6173 7365  CLAD])..    asse
+00018d30: 7274 206c 656e 2863 2e70 6f6c 7967 6f6e  rt len(c.polygon
+00018d40: 7329 203d 3d20 322c 206c 656e 2863 2e70  s) == 2, len(c.p
+00018d50: 6f6c 7967 6f6e 7329 0a20 2020 2061 7373  olygons).    ass
+00018d60: 6572 7420 6c65 6e28 6332 2e70 6f6c 7967  ert len(c2.polyg
+00018d70: 6f6e 7329 203d 3d20 312c 206c 656e 2863  ons) == 1, len(c
+00018d80: 322e 706f 6c79 676f 6e73 290a 2020 2020  2.polygons).    
+00018d90: 6173 7365 7274 2067 662e 4c41 5945 522e  assert gf.LAYER.
+00018da0: 5747 434c 4144 2069 6e20 6332 2e6c 6179  WGCLAD in c2.lay
+00018db0: 6572 730a 0a0a 6465 6620 6861 7368 5f66  ers...def hash_f
+00018dc0: 696c 6528 6669 6c65 7061 7468 293a 0a20  ile(filepath):. 
+00018dd0: 2020 206d 6435 203d 2068 6173 686c 6962     md5 = hashlib
+00018de0: 2e6d 6435 2829 0a20 2020 206d 6435 2e75  .md5().    md5.u
+00018df0: 7064 6174 6528 6669 6c65 7061 7468 2e72  pdate(filepath.r
+00018e00: 6561 645f 6279 7465 7328 2929 0a20 2020  ead_bytes()).   
+00018e10: 2072 6574 7572 6e20 6d64 352e 6865 7864   return md5.hexd
+00018e20: 6967 6573 7428 290a 0a0a 6465 6620 7465  igest()...def te
+00018e30: 7374 5f62 626f 785f 7265 6665 7265 6e63  st_bbox_referenc
+00018e40: 6528 2920 2d3e 204e 6f6e 653a 0a20 2020  e() -> None:.   
+00018e50: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
+00018e60: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
+00018e70: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
+00018e80: 0a20 2020 2063 3120 3d20 6320 3c3c 2067  .    c1 = c << g
+00018e90: 662e 636f 6d70 6f6e 656e 7473 2e72 6563  f.components.rec
+00018ea0: 7461 6e67 6c65 2873 697a 653d 2831 2e35  tangle(size=(1.5
+00018eb0: 652d 332c 2031 2e35 652d 3329 2c20 706f  e-3, 1.5e-3), po
+00018ec0: 7274 5f74 7970 653d 4e6f 6e65 290a 2020  rt_type=None).  
+00018ed0: 2020 6332 203d 2063 203c 3c20 6766 2e63    c2 = c << gf.c
+00018ee0: 6f6d 706f 6e65 6e74 732e 7265 6374 616e  omponents.rectan
+00018ef0: 676c 6528 7369 7a65 3d28 312e 3565 2d33  gle(size=(1.5e-3
+00018f00: 2c20 312e 3565 2d33 292c 2070 6f72 745f  , 1.5e-3), port_
+00018f10: 7479 7065 3d4e 6f6e 6529 0a20 2020 2063  type=None).    c
+00018f20: 322e 786d 696e 203d 2063 312e 786d 6178  2.xmin = c1.xmax
+00018f30: 0a0a 2020 2020 6173 7365 7274 2063 322e  ..    assert c2.
+00018f40: 7873 697a 6520 3d3d 2031 2e35 652d 330a  xsize == 1.5e-3.
+00018f50: 0a0a 6465 6620 7465 7374 5f72 656d 6f76  ..def test_remov
+00018f60: 655f 6c61 6265 6c73 2829 202d 3e20 4e6f  e_labels() -> No
+00018f70: 6e65 3a0a 2020 2020 696d 706f 7274 2067  ne:.    import g
+00018f80: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
+00018f90: 0a20 2020 2063 203d 2067 662e 632e 7374  .    c = gf.c.st
+00018fa0: 7261 6967 6874 2829 0a20 2020 2063 2e72  raight().    c.r
+00018fb0: 656d 6f76 655f 6c61 6265 6c73 2829 0a0a  emove_labels()..
+00018fc0: 2020 2020 6173 7365 7274 206c 656e 2863      assert len(c
+00018fd0: 2e6c 6162 656c 7329 203d 3d20 300a 0a0a  .labels) == 0...
+00018fe0: 6465 6620 7465 7374 5f69 6d70 6f72 745f  def test_import_
+00018ff0: 6764 735f 7365 7474 696e 6773 2829 202d  gds_settings() -
+00019000: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
+00019010: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
+00019020: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
+00019030: 636f 6d70 6f6e 656e 7473 2e6d 7a69 2829  components.mzi()
+00019040: 0a20 2020 2067 6473 7061 7468 203d 2063  .    gdspath = c
+00019050: 2e77 7269 7465 5f67 6473 2877 6974 685f  .write_gds(with_
+00019060: 6d65 7461 6461 7461 3d54 7275 6529 0a20  metadata=True). 
+00019070: 2020 2063 3220 3d20 6766 2e69 6d70 6f72     c2 = gf.impor
+00019080: 745f 6764 7328 6764 7370 6174 682c 206e  t_gds(gdspath, n
+00019090: 616d 653d 226d 7a69 5f73 616d 706c 6522  ame="mzi_sample"
+000190a0: 2c20 7265 6164 5f6d 6574 6164 6174 613d  , read_metadata=
+000190b0: 5472 7565 290a 2020 2020 6333 203d 2067  True).    c3 = g
+000190c0: 662e 726f 7574 696e 672e 6164 645f 6669  f.routing.add_fi
+000190d0: 6265 725f 7369 6e67 6c65 2863 3229 0a20  ber_single(c2). 
+000190e0: 2020 2061 7373 6572 7420 6333 0a0a 0a69     assert c3...i
+000190f0: 6620 5f5f 6e61 6d65 5f5f 203d 3d20 225f  f __name__ == "_
+00019100: 5f6d 6169 6e5f 5f22 3a0a 2020 2020 696d  _main__":.    im
+00019110: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+00019120: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
+00019130: 662e 632e 6d7a 6928 290a 2020 2020 632e  f.c.mzi().    c.
+00019140: 7070 7269 6e74 5f70 6f72 7473 2829 0a0a  pprint_ports()..
+00019150: 2020 2020 2320 6320 3d20 6766 2e43 6f6d      # c = gf.Com
+00019160: 706f 6e65 6e74 2829 0a20 2020 2023 2070  ponent().    # p
+00019170: 203d 2063 2e61 6464 5f70 6f6c 7967 6f6e   = c.add_polygon
+00019180: 280a 2020 2020 2320 2020 2020 5b28 2d38  (.    #     [(-8
+00019190: 2c20 362c 2037 2c20 3929 2c20 282d 362c  , 6, 7, 9), (-6,
+000191a0: 2038 2c20 3137 2c20 3529 5d2c 206c 6179   8, 17, 5)], lay
+000191b0: 6572 3d28 312c 2030 290a 2020 2020 2320  er=(1, 0).    # 
+000191c0: 2920 2023 2047 4453 206c 6179 6572 7320  )  # GDS layers 
+000191d0: 6172 6520 7475 706c 6573 206f 6620 696e  are tuples of in
+000191e0: 7473 2028 6275 7420 6966 2077 6520 7573  ts (but if we us
+000191f0: 6520 6f6e 6c79 206f 6e65 206e 756d 6265  e only one numbe
+00019200: 7220 6974 2061 7373 756d 6573 2074 6865  r it assumes the
+00019210: 206f 7468 6572 206e 756d 6265 7220 6973   other number is
+00019220: 2030 290a 2020 2020 2320 632e 7772 6974   0).    # c.writ
+00019230: 655f 6764 7328 2268 692e 6764 7322 290a  e_gds("hi.gds").
+00019240: 2020 2020 2320 632e 7368 6f77 2829 0a20      # c.show(). 
+00019250: 2020 2023 2070 7269 6e74 2843 4f4e 462e     # print(CONF.
+00019260: 6c61 7374 5f73 6176 6564 5f66 696c 6573  last_saved_files
+00019270: 290a                                     ).
```

### Comparing `gdsfactory-7.1.3/gdsfactory/component_layout.py` & `gdsfactory-7.1.4/gdsfactory/component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/component_reference.py` & `gdsfactory-7.1.4/gdsfactory/component_reference.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/C.py` & `gdsfactory-7.1.4/gdsfactory/components/C.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/L.py` & `gdsfactory-7.1.4/gdsfactory/components/L.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/__init__.py` & `gdsfactory-7.1.4/gdsfactory/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/add_fiducials.py` & `gdsfactory-7.1.4/gdsfactory/components/add_fiducials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/add_grating_couplers.py` & `gdsfactory-7.1.4/gdsfactory/components/add_grating_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/add_trenches.py` & `gdsfactory-7.1.4/gdsfactory/components/add_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/align.py` & `gdsfactory-7.1.4/gdsfactory/components/align.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/array_component.py` & `gdsfactory-7.1.4/gdsfactory/components/array_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/array_with_fanout.py` & `gdsfactory-7.1.4/gdsfactory/components/array_with_fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/array_with_via.py` & `gdsfactory-7.1.4/gdsfactory/components/array_with_via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/awg.py` & `gdsfactory-7.1.4/gdsfactory/components/awg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bbox.py` & `gdsfactory-7.1.4/gdsfactory/components/bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bend_circular.py` & `gdsfactory-7.1.4/gdsfactory/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bend_circular_heater.py` & `gdsfactory-7.1.4/gdsfactory/components/bend_circular_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bend_euler.py` & `gdsfactory-7.1.4/gdsfactory/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bend_port.py` & `gdsfactory-7.1.4/gdsfactory/components/bend_port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bend_s.py` & `gdsfactory-7.1.4/gdsfactory/components/bend_s.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/bezier.py` & `gdsfactory-7.1.4/gdsfactory/components/bezier.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cavity.py` & `gdsfactory-7.1.4/gdsfactory/components/cavity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cdc.py` & `gdsfactory-7.1.4/gdsfactory/components/cdc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cdsem_all.py` & `gdsfactory-7.1.4/gdsfactory/components/cdsem_all.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cdsem_bend180.py` & `gdsfactory-7.1.4/gdsfactory/components/cdsem_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cdsem_coupler.py` & `gdsfactory-7.1.4/gdsfactory/components/cdsem_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cdsem_straight.py` & `gdsfactory-7.1.4/gdsfactory/components/cdsem_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cdsem_straight_density.py` & `gdsfactory-7.1.4/gdsfactory/components/cdsem_straight_density.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/circle.py` & `gdsfactory-7.1.4/gdsfactory/components/circle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coh_rx_dual_pol.py` & `gdsfactory-7.1.4/gdsfactory/components/coh_rx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coh_rx_single_pol.py` & `gdsfactory-7.1.4/gdsfactory/components/coh_rx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coh_tx_dual_pol.py` & `gdsfactory-7.1.4/gdsfactory/components/coh_tx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coh_tx_single_pol.py` & `gdsfactory-7.1.4/gdsfactory/components/coh_tx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/compass.py` & `gdsfactory-7.1.4/gdsfactory/components/compass.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/component_lattice.py` & `gdsfactory-7.1.4/gdsfactory/components/component_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/component_lattice_generic.py` & `gdsfactory-7.1.4/gdsfactory/components/component_lattice_generic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/component_sequence.py` & `gdsfactory-7.1.4/gdsfactory/components/component_sequence.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/copy_layers.py` & `gdsfactory-7.1.4/gdsfactory/components/copy_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler90.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler90.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler90bend.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler90bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_adiabatic.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_asymmetric.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_bent.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_bent.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_full.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_full.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_ring.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_straight.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_straight_asymmetric.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_straight_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/coupler_symmetric.py` & `gdsfactory-7.1.4/gdsfactory/components/coupler_symmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cross.py` & `gdsfactory-7.1.4/gdsfactory/components/cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/crossing_waveguide.py` & `gdsfactory-7.1.4/gdsfactory/components/crossing_waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv` & `gdsfactory-7.1.4/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cutback_2x2.py` & `gdsfactory-7.1.4/gdsfactory/components/cutback_2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cutback_bend.py` & `gdsfactory-7.1.4/gdsfactory/components/cutback_bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cutback_component.py` & `gdsfactory-7.1.4/gdsfactory/components/cutback_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/cutback_splitter.py` & `gdsfactory-7.1.4/gdsfactory/components/cutback_splitter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/dbr.py` & `gdsfactory-7.1.4/gdsfactory/components/dbr.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/dbr_tapered.py` & `gdsfactory-7.1.4/gdsfactory/components/dbr_tapered.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/delay_snake.py` & `gdsfactory-7.1.4/gdsfactory/components/delay_snake.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/delay_snake2.py` & `gdsfactory-7.1.4/gdsfactory/components/delay_snake2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/delay_snake3.py` & `gdsfactory-7.1.4/gdsfactory/components/delay_snake3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/delay_snake_sbend.py` & `gdsfactory-7.1.4/gdsfactory/components/delay_snake_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/dicing_lane.py` & `gdsfactory-7.1.4/gdsfactory/components/dicing_lane.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/die.py` & `gdsfactory-7.1.4/gdsfactory/components/die.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/die_bbox.py` & `gdsfactory-7.1.4/gdsfactory/components/die_bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/die_bbox_frame.py` & `gdsfactory-7.1.4/gdsfactory/components/die_bbox_frame.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/disk.py` & `gdsfactory-7.1.4/gdsfactory/components/disk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/edge_coupler_array.py` & `gdsfactory-7.1.4/gdsfactory/components/edge_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ellipse.py` & `gdsfactory-7.1.4/gdsfactory/components/ellipse.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/extend_ports_list.py` & `gdsfactory-7.1.4/gdsfactory/components/extend_ports_list.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/extension.py` & `gdsfactory-7.1.4/gdsfactory/components/extension.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/fiber.py` & `gdsfactory-7.1.4/gdsfactory/components/fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/fiber_array.py` & `gdsfactory-7.1.4/gdsfactory/components/fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/fiducial_squares.py` & `gdsfactory-7.1.4/gdsfactory/components/fiducial_squares.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ge_detector_straight_si_contacts.py` & `gdsfactory-7.1.4/gdsfactory/components/ge_detector_straight_si_contacts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_array.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_dual_pol.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical_arbitrary.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical_lumerical.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_elliptical_trenches.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_elliptical_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_functions.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_loss.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_loss.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_loss_fiber_single.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_loss_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_rectangular.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_rectangular_arbitrary.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_rectangular_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/grating_coupler_tree.py` & `gdsfactory-7.1.4/gdsfactory/components/grating_coupler_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/greek_cross.py` & `gdsfactory-7.1.4/gdsfactory/components/greek_cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/hline.py` & `gdsfactory-7.1.4/gdsfactory/components/hline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/interdigital_capacitor.py` & `gdsfactory-7.1.4/gdsfactory/components/interdigital_capacitor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/litho_calipers.py` & `gdsfactory-7.1.4/gdsfactory/components/litho_calipers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/litho_ruler.py` & `gdsfactory-7.1.4/gdsfactory/components/litho_ruler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/litho_steps.py` & `gdsfactory-7.1.4/gdsfactory/components/litho_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/logo.py` & `gdsfactory-7.1.4/gdsfactory/components/logo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/loop_mirror.py` & `gdsfactory-7.1.4/gdsfactory/components/loop_mirror.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mmi.py` & `gdsfactory-7.1.4/gdsfactory/components/mmi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mmi1x2.py` & `gdsfactory-7.1.4/gdsfactory/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mmi1x2_with_sbend.py` & `gdsfactory-7.1.4/gdsfactory/components/mmi1x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mmi2x2.py` & `gdsfactory-7.1.4/gdsfactory/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mmi2x2_with_sbend.py` & `gdsfactory-7.1.4/gdsfactory/components/mmi2x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mmi_90degree_hybrid.py` & `gdsfactory-7.1.4/gdsfactory/components/mmi_90degree_hybrid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mode_converter.py` & `gdsfactory-7.1.4/gdsfactory/components/mode_converter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzi.py` & `gdsfactory-7.1.4/gdsfactory/components/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzi_arm.py` & `gdsfactory-7.1.4/gdsfactory/components/mzi_arm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzi_arms.py` & `gdsfactory-7.1.4/gdsfactory/components/mzi_arms.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzi_lattice.py` & `gdsfactory-7.1.4/gdsfactory/components/mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzi_pads_center.py` & `gdsfactory-7.1.4/gdsfactory/components/mzi_pads_center.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzi_phase_shifter.py` & `gdsfactory-7.1.4/gdsfactory/components/mzi_phase_shifter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzit.py` & `gdsfactory-7.1.4/gdsfactory/components/mzit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzit_lattice.py` & `gdsfactory-7.1.4/gdsfactory/components/mzit_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/mzm.py` & `gdsfactory-7.1.4/gdsfactory/components/mzm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/nxn.py` & `gdsfactory-7.1.4/gdsfactory/components/nxn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/optimal_90deg.py` & `gdsfactory-7.1.4/gdsfactory/components/optimal_90deg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/optimal_hairpin.py` & `gdsfactory-7.1.4/gdsfactory/components/optimal_hairpin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/optimal_step.py` & `gdsfactory-7.1.4/gdsfactory/components/optimal_step.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/pack_doe.py` & `gdsfactory-7.1.4/gdsfactory/components/pack_doe.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/pad.py` & `gdsfactory-7.1.4/gdsfactory/components/pad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/pad_gsg.py` & `gdsfactory-7.1.4/gdsfactory/components/pad_gsg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/pads_shorted.py` & `gdsfactory-7.1.4/gdsfactory/components/pads_shorted.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/polarization_splitter_rotator.py` & `gdsfactory-7.1.4/gdsfactory/components/polarization_splitter_rotator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ramp.py` & `gdsfactory-7.1.4/gdsfactory/components/ramp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/rectangle.py` & `gdsfactory-7.1.4/gdsfactory/components/rectangle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/rectangle_with_slits.py` & `gdsfactory-7.1.4/gdsfactory/components/rectangle_with_slits.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/rectangular_ring.py` & `gdsfactory-7.1.4/gdsfactory/components/rectangular_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/regular_polygon.py` & `gdsfactory-7.1.4/gdsfactory/components/regular_polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/resistance_meander.py` & `gdsfactory-7.1.4/gdsfactory/components/resistance_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/resistance_sheet.py` & `gdsfactory-7.1.4/gdsfactory/components/resistance_sheet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring.py` & `gdsfactory-7.1.4/gdsfactory/components/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_crow.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_crow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_crow_couplers.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_crow_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_double.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_double_bend_coupler.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_double_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_double_heater.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_double_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_double_pn.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_double_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_section_based.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_section_based.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_single.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_single_array.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_single_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_single_bend_coupler.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_single_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_single_dut.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_single_dut.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_single_heater.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_single_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/ring_single_pn.py` & `gdsfactory-7.1.4/gdsfactory/components/ring_single_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/seal_ring.py` & `gdsfactory-7.1.4/gdsfactory/components/seal_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/snspd.py` & `gdsfactory-7.1.4/gdsfactory/components/snspd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/spiral_double.py` & `gdsfactory-7.1.4/gdsfactory/components/spiral_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/spiral_external_io.py` & `gdsfactory-7.1.4/gdsfactory/components/spiral_external_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/spiral_heater.py` & `gdsfactory-7.1.4/gdsfactory/components/spiral_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/spiral_inner_io.py` & `gdsfactory-7.1.4/gdsfactory/components/spiral_inner_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/splitter_chain.py` & `gdsfactory-7.1.4/gdsfactory/components/splitter_chain.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/splitter_tree.py` & `gdsfactory-7.1.4/gdsfactory/components/splitter_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight.py` & `gdsfactory-7.1.4/gdsfactory/components/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_array.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_heater_doped_rib.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_heater_doped_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_heater_doped_strip.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_heater_doped_strip.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_heater_meander.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_heater_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_heater_meander_doped.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_heater_meander_doped.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_heater_metal.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_pin.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_pin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_pin_slot.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_pin_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/straight_rib.py` & `gdsfactory-7.1.4/gdsfactory/components/straight_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/switch_tree.py` & `gdsfactory-7.1.4/gdsfactory/components/switch_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/taper.py` & `gdsfactory-7.1.4/gdsfactory/components/taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/taper_adiabatic.py` & `gdsfactory-7.1.4/gdsfactory/components/taper_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/taper_cross_section.py` & `gdsfactory-7.1.4/gdsfactory/components/taper_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/taper_from_csv.py` & `gdsfactory-7.1.4/gdsfactory/components/taper_from_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/taper_parabolic.py` & `gdsfactory-7.1.4/gdsfactory/components/taper_parabolic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/terminator.py` & `gdsfactory-7.1.4/gdsfactory/components/terminator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/text.py` & `gdsfactory-7.1.4/gdsfactory/components/text.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/text_freetype.py` & `gdsfactory-7.1.4/gdsfactory/components/text_freetype.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/text_rectangular.py` & `gdsfactory-7.1.4/gdsfactory/components/text_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/text_rectangular_font.py` & `gdsfactory-7.1.4/gdsfactory/components/text_rectangular_font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/triangles.py` & `gdsfactory-7.1.4/gdsfactory/components/triangles.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/verniers.py` & `gdsfactory-7.1.4/gdsfactory/components/verniers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/version_stamp.py` & `gdsfactory-7.1.4/gdsfactory/components/version_stamp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/via.py` & `gdsfactory-7.1.4/gdsfactory/components/via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/via_corner.py` & `gdsfactory-7.1.4/gdsfactory/components/via_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/via_cutback.py` & `gdsfactory-7.1.4/gdsfactory/components/via_cutback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/via_stack.py` & `gdsfactory-7.1.4/gdsfactory/components/via_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/via_stack_slot.py` & `gdsfactory-7.1.4/gdsfactory/components/via_stack_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/via_stack_with_offset.py` & `gdsfactory-7.1.4/gdsfactory/components/via_stack_with_offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/wafer.py` & `gdsfactory-7.1.4/gdsfactory/components/wafer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/wire.py` & `gdsfactory-7.1.4/gdsfactory/components/wire.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/components/wire_sbend.py` & `gdsfactory-7.1.4/gdsfactory/components/wire_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/config.py` & `gdsfactory-7.1.4/gdsfactory/config.py`

 * *Files 0% similar despite different names*

```diff
@@ -25,15 +25,15 @@
 from pydantic import BaseModel, BaseSettings, Field
 from rich.console import Console
 from rich.table import Table
 
 if TYPE_CHECKING:
     from loguru import Logger
 
-__version__ = "7.1.3"
+__version__ = "7.1.4"
 PathType = str | pathlib.Path
 
 home = pathlib.Path.home()
 cwd = pathlib.Path.cwd()
 module_path = pathlib.Path(__file__).parent.absolute()
 repo_path = module_path.parent
 home_path = pathlib.Path.home() / ".gdsfactory"
```

### Comparing `gdsfactory-7.1.3/gdsfactory/constants.py` & `gdsfactory-7.1.4/gdsfactory/constants.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/cross_section.py` & `gdsfactory-7.1.4/gdsfactory/cross_section.py`

 * *Files 1% similar despite different names*

```diff
@@ -82,14 +82,31 @@
 
     class Config:
         """pydantic basemodel config."""
 
         extra = "forbid"
 
 
+class ComponentAlongPath(BaseModel):
+    """A ComponentAlongPath object to place along an extruded path.
+
+    Parameters:
+        component: Component to repeat along the path. The unrotated version of
+            this object should be oriented for placement on a horizontal line.
+        spacing: distance between component placements
+        padding: minimum distance from the path start to the first component.
+        y_offset: offset in y direction (um).
+    """
+
+    component: object
+    spacing: float
+    padding: float = 0.0
+    offset: float = 0.0
+
+
 class CrossSection(BaseModel):
     """Waveguide information to extrude a path.
 
     cladding_layers follow path shape, while bbox_layers are rectangular.
 
     Parameters:
         layer: main Section layer. Main section name = '_default'.
@@ -123,14 +140,15 @@
         snap_to_grid: Optional snap points to grid when extruding paths (um).
         decorator: function when extruding component. For example add_pins.
         add_pins: Optional function to add pins.
         add_bbox: Optional function to add bounding box.
         info: dict with extra settings or useful information.
         name: cross_section name.
         mirror: if True, reflects the offsets.
+        vias: list of ComponentAlongPaths(component, spacing, padding, offset).
 
     Properties:
         aliases: dict of cross_section aliases.
     """
 
     layer: LayerSpec | None = None
     width: float | Callable
@@ -156,16 +174,17 @@
     snap_to_grid: float | None = None
     decorator: Callable | None = None
     add_pins: Callable | None = Field(default=None, exclude=True)
     add_bbox: Callable | None = Field(default=None, exclude=True)
     info: dict[str, Any] = Field(default_factory=dict)
     name: str | None = None
     mirror: bool = False
+    vias: list[ComponentAlongPath] = Field(default_factory=list)
 
-    def __init__(__pydantic_self__, **data: Any) -> None:
+    def __init__(self, **data: Any) -> None:
         """Extend BaseModel init to process mirroring."""
         super().__init__(**data)
 
         if "mirror" in data and data["mirror"]:
             data["offset"] *= -1
             if data["sections"]:
                 for section in data["sections"]:
@@ -2354,17 +2373,17 @@
     #     width=0.5,
     #     # gap_low_doping=0.05,
     #     # width_doping=2.0,
     #     # offset_low_doping=0,
     #     mirror=False,
     # )
     # xs = pn_with_trenches(width=0.3)
-    # xs = slot(width=0.3)
+    xs = slot(width=0.3)
     # xs = rib_with_trenches()
-    # p = gf.path.straight()
+    p = gf.path.straight()
     # c = p.extrude(xs)
     # xs = l_with_trenches(
     #     width=0.5,
     #     width_trench=2.0,
     #     width_slab=7.0,
     # )
     # p = gf.path.straight()
@@ -2372,13 +2391,13 @@
     # xs = l_wg_doped_with_trenches(
     #     layer="WG", width=0.5, width_trench=2.0, width_slab=7.0, gap_low_doping=0.1
     # )
     # p = gf.path.straight()
     # c = p.extrude(cross_section=xs)
     # xs = rib_with_trenches() # FIXME
     # c = gf.components.straight(cross_section=xs)
-    c = gf.components.straight(cross_section="strip")
+    # c = gf.components.straight(cross_section="strip")
 
     # xs = l_wg()
     # p = gf.path.straight()
-    # c = p.extrude(xs)
+    c = p.extrude(xs)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-7.1.3/gdsfactory/decorators.py` & `gdsfactory-7.1.4/gdsfactory/decorators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/difftest.py` & `gdsfactory-7.1.4/gdsfactory/difftest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/difftest_git.py` & `gdsfactory-7.1.4/gdsfactory/difftest_git.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/events.py` & `gdsfactory-7.1.4/gdsfactory/events.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/export/to_3d.py` & `gdsfactory-7.1.4/gdsfactory/export/to_3d.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/export/to_gerber.py` & `gdsfactory-7.1.4/gdsfactory/export/to_gerber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/export/to_np.py` & `gdsfactory-7.1.4/gdsfactory/export/to_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/export/to_stl.py` & `gdsfactory-7.1.4/gdsfactory/export/to_stl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/fill.py` & `gdsfactory-7.1.4/gdsfactory/fill.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/font.py` & `gdsfactory-7.1.4/gdsfactory/font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/functions.py` & `gdsfactory-7.1.4/gdsfactory/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/README.md` & `gdsfactory-7.1.4/gdsfactory/generic_tech/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/__init__.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/containers.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/containers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/get_klayout_pyxs.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/get_klayout_pyxs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/drc/errors.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/drc/errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/grain.xml`

 * *Files 1% similar despite different names*

#### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/grain.xml`

```diff
@@ -1,13 +1,13 @@
 <?xml version="1.0" encoding="utf-8"?>
 <salt-grain>
   <name>gdsfactory</name>
   <token/>
   <hidden>false</hidden>
-  <version>7.1.3</version>
+  <version>7.1.4</version>
   <api-version/>
   <title>gdsfactory</title>
   <doc>EDA tool to layout integrated circuits</doc>
   <doc-url>https://gdsfactory.github.io/gdsfactory/</doc-url>
   <url>https://github.com/gdsfactory/gdsfactory</url>
   <license>MIT</license>
   <author>Joaquin Matres</author>
```

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/icon_128x128.png` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/icon_128x128.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/icon_64x64.png` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/icon_64x64.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/README.md` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/run_lvs.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/run_lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

 * *Files 15% similar despite different names*

#### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

```diff
@@ -12,15 +12,15 @@
   <show-in-menu>false</show-in-menu>
   <group-name/>
   <menu-path>gdsfactory.begin</menu-path>
   <interpreter>python</interpreter>
   <dsl-interpreter-name/>
   <text>import pya
 
-__version__ = &quot;7.1.3&quot;
+__version__ = &quot;7.1.4&quot;
 
 
 def set_menu():
     menu = pya.Application.instance().main_window().menu()
 
     s0 = &quot;gdsfactory&quot;
     if not (menu.is_menu(s0)):
```

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/generic.layerstack` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/generic.layerstack`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/layers.lyp` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/layers.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/tech.lyt` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/tech.lyt`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs` & `gdsfactory-7.1.4/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/layer_map.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/layer_stack.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/layer_views.yaml` & `gdsfactory-7.1.4/gdsfactory/generic_tech/layer_views.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/generic_tech/simulation_settings.py` & `gdsfactory-7.1.4/gdsfactory/generic_tech/simulation_settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/__init__.py` & `gdsfactory-7.1.4/gdsfactory/geometry/__init__.py`

 * *Files 26% similar despite different names*

```diff
@@ -2,38 +2,28 @@
 
 from __future__ import annotations
 
 from gdsfactory.geometry import functions
 from gdsfactory.geometry.boolean import boolean
 from gdsfactory.geometry.boolean_klayout import boolean_klayout
 from gdsfactory.geometry.boolean_polygons import boolean_polygons
-from gdsfactory.geometry.check_duplicated_cells import check_duplicated_cells
-from gdsfactory.geometry.check_exclusion import check_exclusion
-from gdsfactory.geometry.check_inclusion import check_inclusion
-from gdsfactory.geometry.check_space import check_space
-from gdsfactory.geometry.check_width import check_width
 from gdsfactory.geometry.fillet import fillet
 from gdsfactory.geometry.invert import invert
 from gdsfactory.geometry.layer_priority import layer_priority
 from gdsfactory.geometry.manhattanize import manhattanize_polygon
 from gdsfactory.geometry.offset import offset
 from gdsfactory.geometry.outline import outline
 from gdsfactory.geometry.trim import trim
 from gdsfactory.geometry.union import union
 from gdsfactory.geometry.xor_diff import xor_diff
 
 __all__ = (
     "boolean",
     "boolean_klayout",
     "boolean_polygons",
-    "check_duplicated_cells",
-    "check_exclusion",
-    "check_inclusion",
-    "check_space",
-    "check_width",
     "fillet",
     "functions",
     "invert",
     "layer_priority",
     "manhattanize_polygon",
     "offset",
     "outline",
```

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/boolean.py` & `gdsfactory-7.1.4/gdsfactory/geometry/boolean.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/boolean_klayout.py` & `gdsfactory-7.1.4/gdsfactory/geometry/boolean_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/boolean_polygons.py` & `gdsfactory-7.1.4/gdsfactory/geometry/boolean_polygons.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/fill_klayout.py` & `gdsfactory-7.1.4/gdsfactory/geometry/fill_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/fill_tiled.py` & `gdsfactory-7.1.4/gdsfactory/geometry/fill_tiled.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/fillet.py` & `gdsfactory-7.1.4/gdsfactory/geometry/fillet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/functions.py` & `gdsfactory-7.1.4/gdsfactory/geometry/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/invert.py` & `gdsfactory-7.1.4/gdsfactory/geometry/invert.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/layer_priority.py` & `gdsfactory-7.1.4/gdsfactory/geometry/layer_priority.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/manhattanize.py` & `gdsfactory-7.1.4/gdsfactory/geometry/manhattanize.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 
 import gdsfactory as gf
 
 
 def manhattanize_polygon(
     p: Polygon,
     target_step: float = 0.05,
-):
+) -> Polygon:
     """Return a Manhattanized version of the input polygon (where non-x and non-y parallel segments are decomposed into a staircase of small x and y-parallel segments)
 
     Implemented in pure Python, and hence only suited to small polygons.
 
     Args:
         p: input polygon.
         target_step: target staircase step size.
```

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/maskprep.py` & `gdsfactory-7.1.4/gdsfactory/geometry/maskprep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/offset.py` & `gdsfactory-7.1.4/gdsfactory/geometry/offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/outline.py` & `gdsfactory-7.1.4/gdsfactory/geometry/outline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/trim.py` & `gdsfactory-7.1.4/gdsfactory/geometry/trim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/union.py` & `gdsfactory-7.1.4/gdsfactory/geometry/union.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/geometry/xor_diff.py` & `gdsfactory-7.1.4/gdsfactory/geometry/xor_diff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/get_factories.py` & `gdsfactory-7.1.4/gdsfactory/get_factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/get_netlist.py` & `gdsfactory-7.1.4/gdsfactory/get_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/get_netlist_flat.py` & `gdsfactory-7.1.4/gdsfactory/get_netlist_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/grid.py` & `gdsfactory-7.1.4/gdsfactory/grid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/install.py` & `gdsfactory-7.1.4/gdsfactory/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/klive.py` & `gdsfactory-7.1.4/gdsfactory/klive.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/labels/__init__.py` & `gdsfactory-7.1.4/gdsfactory/labels/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/labels/add_label_yaml.py` & `gdsfactory-7.1.4/gdsfactory/labels/add_label_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/labels/ehva.py` & `gdsfactory-7.1.4/gdsfactory/labels/ehva.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/labels/merge_test_metadata.py` & `gdsfactory-7.1.4/gdsfactory/labels/merge_test_metadata.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/labels/siepic.py` & `gdsfactory-7.1.4/gdsfactory/labels/siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/labels/write_labels.py` & `gdsfactory-7.1.4/gdsfactory/labels/write_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/name.py` & `gdsfactory-7.1.4/gdsfactory/name.py`

 * *Files 7% similar despite different names*

```diff
@@ -93,23 +93,32 @@
             f"Possible name collision! {kwargs.keys()} "
             f"repeats first letters {first_letters}"
             "you can separate your arguments with underscores"
             " (delta_length -> DL, delta_width -> DW"
         )
 
 
-def clean_name(name: str, remove_dots: bool = False) -> str:
+def clean_name(
+    name: str, remove_dots: bool = False, allowed_characters: list[str] | None = None
+) -> str:
     """Return a string with correct characters for a cell name.
 
     [a-zA-Z0-9]
 
     FIXME: only a few characters are currently replaced.
         This function has been updated only on case-by-case basis
 
+    Args:
+        name: to clean.
+        remove_dots: remove dots from name.
+        allowed_characters: list of allowed characters.
+
     """
+    allowed_characters = allowed_characters or []
+
     replace_map = {
         " ": "_",
         "!": "",
         "?": "",
         "#": "_",
         "%": "_",
         "(": "",
@@ -128,15 +137,16 @@
         "}": "",
         "$": "",
     }
 
     if remove_dots:
         replace_map["."] = ""
     for k, v in list(replace_map.items()):
-        name = name.replace(k, v)
+        if k not in allowed_characters:
+            name = name.replace(k, v)
     return name
 
 
 def clean_value(value: Any) -> str:
     from gdsfactory.serialization import clean_value_json
 
     return str(clean_value_json(value))
```

### Comparing `gdsfactory-7.1.3/gdsfactory/pack.py` & `gdsfactory-7.1.4/gdsfactory/pack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/path.py` & `gdsfactory-7.1.4/gdsfactory/path.py`

 * *Files 3% similar despite different names*

```diff
@@ -731,14 +731,73 @@
         sections=sections,
         width=max([X1.width, X2.width]),
         **kwargs,
     )
 
 
 @cell
+def along_path(
+    p: Path,
+    component: Component,
+    spacing: float,
+    padding: float,
+) -> Component:
+    """Returns Component containing many copies of `component` along `p`.
+
+    Places as many copies of `component` along each segment of `p` as possible
+    under the given constraints. `spacing` is always followed precisely, but
+    actual `padding` may exceed the provided value to place components evenly.
+
+    Args:
+        p: Path to place components along.
+        component: Component to repeat along the path. The unrotated version of
+            this object should be oriented for placement on a horizontal line.
+        spacing: distance between component placements.
+        padding: minimum distance from the path start to the first component.
+    """
+    length = p.length()
+    number = (length - 2 * padding) // spacing + 1
+
+    c = Component()
+
+    cum_dist = 0
+    next_component = (length - (number - 1) * spacing) / 2
+    stop = length - next_component
+
+    # Prepare in advance the rotation angle for each segment
+    angle_list = [
+        np.rad2deg(
+            np.arctan2(
+                (p.points[i + 1] - p.points[i])[1], (p.points[i + 1] - p.points[i])[0]
+            )
+        )
+        for i in range(len(p.points) - 1)
+    ]
+
+    for i, start_pt in enumerate(p.points[:-1]):
+        end_pt = p.points[i + 1]
+        segment_vector = end_pt - start_pt
+        segment_length = np.linalg.norm(segment_vector)
+        unit_vector = segment_vector / segment_length
+
+        # Get the pre-calculated angle for this segment
+        angle = angle_list[i]
+
+        while next_component <= cum_dist + segment_length and next_component <= stop:
+            added_dist = next_component - cum_dist
+            offset = added_dist * unit_vector
+            component_ref = c << component
+            component_ref.rotate(angle).move(start_pt + offset)
+            next_component += spacing
+        cum_dist += segment_length
+
+    return c
+
+
+@cell
 def extrude(
     p: Path,
     cross_section: CrossSectionSpec | None = None,
     layer: LayerSpec | None = None,
     width: float | None = None,
     widths: Float2 | None = None,
     simplify: float | None = None,
@@ -1007,14 +1066,29 @@
     if isinstance(x, CrossSection):
         if x.add_bbox:
             c = x.add_bbox(c)
         if x.add_pins:
             c = x.add_pins(c)
         if x.decorator:
             c = x.decorator(c) or c
+
+        for via in x.vias:
+            if via.offset:
+                points_offset = p._centerpoint_offset_curve(
+                    points,
+                    offset_distance=via.offset,
+                    start_angle=start_angle,
+                    end_angle=end_angle,
+                )
+                _p = Path(points_offset)
+            else:
+                _p = p
+            c << along_path(
+                p=_p, component=via.component, spacing=via.spacing, padding=via.padding
+            )
     return c
 
 
 def _rotated_delta(
     point: np.ndarray, center: np.ndarray, orientation: float
 ) -> np.ndarray:
     """Gets the rotated distance of a point from a center.
@@ -1505,50 +1579,28 @@
     c.show(show_ports=True)
 
 
 if __name__ == "__main__":
     import numpy as np
 
     import gdsfactory as gf
+    from gdsfactory.cross_section import ComponentAlongPath
 
-    # nm = 1e-3
-    # points = np.array([(20, 10), (40, 10), (20, 40), (50, 40), (50, 20), (70, 20)])
-    # p = smooth(points=points)
-    # p = arc(start_angle=0)
-    # c = p.extrude(layer=(1, 0), width=0.1, simplify=50 * nm)
-    p = straight()
-    # p.plot()
-
-    # c = p.extrude(layer=(1, 0), width=0.1)
-    s1 = gf.Section(width=2.2, offset=0, layer=(3, 0), name="etch")
-    s2 = gf.Section(width=1.1, offset=3, layer=(1, 0), name="wg2")
-    X1 = gf.CrossSection(
-        width=1.2,
-        offset=0,
-        layer=(2, 0),
-        name="wg",
-        port_names=("in1", "out1"),
-        sections=[s1, s2],
-    )
-
-    # Create the second CrossSection that we want to transition to
-    s1 = gf.Section(width=3.5, offset=0, layer=(3, 0), name="etch")
-    s2 = gf.Section(width=3, offset=5, layer=(1, 0), name="wg2")
-    X2 = gf.CrossSection(
-        width=1,
+    # Create the path
+    p = gf.path.straight()
+    p += gf.path.arc(10)
+    p += gf.path.straight()
+
+    # Define a cross-section with a via
+    via0 = ComponentAlongPath(component=gf.c.via1(), spacing=5, padding=2, offset=0)
+    via = ComponentAlongPath(component=gf.c.via1(), spacing=5, padding=2, offset=2)
+    x = gf.CrossSection(
+        width=0.5,
         offset=0,
-        layer=(2, 0),
-        name="wg",
-        port_names=("in1", "out1"),
-        sections=[s1, s2],
+        layer=(1, 0),
+        port_names=("in", "out"),
+        vias=[via0, via],
     )
 
-    Xtrans = gf.path.transition(cross_section1=X1, cross_section2=X2, width_type="sine")
-    c = p.extrude(cross_section=Xtrans)
-    # c = gf.components.splitter_tree(
-    #     noutputs=2**2,
-    #     spacing=(120.0, 50.0),
-    #     # bend_length=30,
-    #     # bend_s=None,
-    #     cross_section="rib_conformal2",
-    # )
+    # Combine the path with the cross-section
+    c = gf.path.extrude(p, cross_section=x)
     c.show()
```

### Comparing `gdsfactory-7.1.3/gdsfactory/pdk.py` & `gdsfactory-7.1.4/gdsfactory/pdk.py`

 * *Files 1% similar despite different names*

```diff
@@ -198,14 +198,17 @@
         default=MAX_NAME_LENGTH,
         description="Maximum length of the cell name.",
     )
     include_module: bool = Field(
         default=False,
         description="If true, will include the module in the autogenerated component name.",
     )
+    naming_style: Literal["default", "updk"] = Field(
+        default="default", description="Naming style for autogenerated component names."
+    )
 
 
 class Pdk(BaseModel):
     """Store layers, cross_sections, cell functions, simulation_settings ...
 
     only one Pdk can be active at a given time.
```

### Comparing `gdsfactory-7.1.3/gdsfactory/picmodel.py` & `gdsfactory-7.1.4/gdsfactory/picmodel.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/pixelate.py` & `gdsfactory-7.1.4/gdsfactory/pixelate.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/polygon.py` & `gdsfactory-7.1.4/gdsfactory/polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/port.py` & `gdsfactory-7.1.4/gdsfactory/port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/quickplotter.py` & `gdsfactory-7.1.4/gdsfactory/quickplotter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/__init__.py` & `gdsfactory-7.1.4/gdsfactory/read/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_dphox.py` & `gdsfactory-7.1.4/gdsfactory/read/from_dphox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_gdspaths.py` & `gdsfactory-7.1.4/gdsfactory/read/from_gdspaths.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_np.py` & `gdsfactory-7.1.4/gdsfactory/read/from_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_phidl.py` & `gdsfactory-7.1.4/gdsfactory/read/from_phidl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_updk.py` & `gdsfactory-7.1.4/gdsfactory/read/from_updk.py`

 * *Files 5% similar despite different names*

```diff
@@ -97,59 +97,72 @@
                     if hasattr(p, "min")
                 ]
             )
             if parameters
             else ""
         )
 
-        parameters = (
+        parameters_colon = (
             [f"{p_name}:{{{p_name}}}" for p_name in parameters] if parameters else []
         )
+        parameters_equal = (
+            [f"{p_name}={{{p_name}}}" for p_name in parameters] if parameters else []
+        )
 
         parameters_labels = (
             "\n".join(
                 [
-                    f"    c.add_label(text='{p_name}:{{{p_name}}}', position=(xc, yc-{i}/{len(parameters)}*ysize/2), layer=layer_label)"
-                    for i, p_name in enumerate(parameters)
+                    "    c.add_label(text=f'{}', position=(xc, yc-{}/{}/2*ysize), layer=layer_label)\n".format(
+                        p_name, i, len(parameters)
+                    )
+                    for i, p_name in enumerate(parameters_colon)
                 ]
             )
-            if layer_label and parameters
+            if layer_label and parameters_colon
             else ""
         )
 
         if parameters:
             doc = f'"""{block.doc}\n\n    Args:\n    {parameters_doc}\n    """'
         else:
             doc = f'"""{block.doc}"""'
 
+        cell_name = (
+            f"{block_name}:{','.join(parameters_equal)}"
+            if parameters_equal
+            else block_name
+        )
+
         points = str(block.bbox).replace("'", "")
         script += f"""
 @gf.cell
 def {block_name}({parameters_string})->gf.Component:
     {doc}
     c = gf.Component()
     p = c.add_polygon({points}, layer=layer_bbox)
     xc, yc = p.center
     ysize = p.ysize
-    name = f"{block_name}_{'_'.join(parameters)}"
+    name = f{cell_name!r}
 """
         script += parameters_labels
 
         for port_name, port in block.pins.items():
             port_type = (
                 "electrical" if port.xsection in electrical_xsections else "optical"
             )
-            cross_section = port.xsection if port.xsection != "None" else None
-            script += f"""
-    c.add_port(name={port_name!r}, width={port.width}, cross_section={cross_section!r}, center=({port.xya[0]}, {port.xya[1]}), orientation={port.xya[2]}, port_type={port_type!r})"""
+
+            if port.xsection != "None":
+                script += f"    c.add_port(name={port_name!r}, width={port.width}, cross_section={port.xsection!r}, center=({port.xya[0]}, {port.xya[1]}), orientation={port.xya[2]}, port_type={port_type!r})\n"
+            else:
+                script += f"    c.add_port(name={port_name!r}, width={port.width}, layer=(0, 0), center=({port.xya[0]}, {port.xya[1]}), orientation={port.xya[2]}, port_type={port_type!r})\n"
 
         if layers_text:
             for layer_text in layers_text:
-                script += f"""
-    c << gf.c.text(text=name, size={text_size}, position=(xc, yc), layer={layer_text},justify='center')\n"""
+                script += f"    text = c << gf.c.text(text=name, size={text_size}, position=(xc, yc), layer={layer_text},justify='center')\n"
+                script += "    c.absorb(text)\n"
 
         script += """
     c.name = name
     return c
 """
 
     if activate_pdk:
```

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_yaml.py` & `gdsfactory-7.1.4/gdsfactory/read/from_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/from_yaml_template.py` & `gdsfactory-7.1.4/gdsfactory/read/from_yaml_template.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/import_gds.py` & `gdsfactory-7.1.4/gdsfactory/read/import_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/read/labels.py` & `gdsfactory-7.1.4/gdsfactory/read/labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/route_info.py` & `gdsfactory-7.1.4/gdsfactory/route_info.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/__init__.py` & `gdsfactory-7.1.4/gdsfactory/routing/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/add_electrical_pads_shortest.py` & `gdsfactory-7.1.4/gdsfactory/routing/add_electrical_pads_shortest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/add_electrical_pads_top.py` & `gdsfactory-7.1.4/gdsfactory/routing/add_electrical_pads_top.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/add_electrical_pads_top_dc.py` & `gdsfactory-7.1.4/gdsfactory/routing/add_electrical_pads_top_dc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/add_fiber_array.py` & `gdsfactory-7.1.4/gdsfactory/routing/add_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/add_fiber_single.py` & `gdsfactory-7.1.4/gdsfactory/routing/add_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/add_pads.py` & `gdsfactory-7.1.4/gdsfactory/routing/add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/all_angle.py` & `gdsfactory-7.1.4/gdsfactory/routing/all_angle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/auto_taper.py` & `gdsfactory-7.1.4/gdsfactory/routing/auto_taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/factories.py` & `gdsfactory-7.1.4/gdsfactory/routing/factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/fanout.py` & `gdsfactory-7.1.4/gdsfactory/routing/fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/fanout2x2.py` & `gdsfactory-7.1.4/gdsfactory/routing/fanout2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle_corner.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle_from_steps.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle_from_waypoints.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle_from_waypoints.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle_path_length_match.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle_path_length_match.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle_sbend.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_bundle_u.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_bundle_u.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_input_labels.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_input_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_route.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_route.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_route_astar.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_route_astar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_route_from_steps.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_route_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_route_sbend.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_route_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_routes_bend180.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_routes_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/get_routes_straight.py` & `gdsfactory-7.1.4/gdsfactory/routing/get_routes_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/manhattan.py` & `gdsfactory-7.1.4/gdsfactory/routing/manhattan.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/path_length_matching.py` & `gdsfactory-7.1.4/gdsfactory/routing/path_length_matching.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/route_fiber_array.py` & `gdsfactory-7.1.4/gdsfactory/routing/route_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/route_fiber_single.py` & `gdsfactory-7.1.4/gdsfactory/routing/route_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/route_ports_to_side.py` & `gdsfactory-7.1.4/gdsfactory/routing/route_ports_to_side.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/route_quad.py` & `gdsfactory-7.1.4/gdsfactory/routing/route_quad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/route_sharp.py` & `gdsfactory-7.1.4/gdsfactory/routing/route_sharp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/route_south.py` & `gdsfactory-7.1.4/gdsfactory/routing/route_south.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/sort_ports.py` & `gdsfactory-7.1.4/gdsfactory/routing/sort_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/routing/utils.py` & `gdsfactory-7.1.4/gdsfactory/routing/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/01_component_pcell.py` & `gdsfactory-7.1.4/gdsfactory/samples/01_component_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/01_component_pcell_with_pins.py` & `gdsfactory-7.1.4/gdsfactory/samples/01_component_pcell_with_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/03_move.py` & `gdsfactory-7.1.4/gdsfactory/samples/03_move.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/04_connect.py` & `gdsfactory-7.1.4/gdsfactory/samples/04_connect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/05_remove_layers.py` & `gdsfactory-7.1.4/gdsfactory/samples/05_remove_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/06_remapping_layers.py` & `gdsfactory-7.1.4/gdsfactory/samples/06_remapping_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/07_flattening_device.py` & `gdsfactory-7.1.4/gdsfactory/samples/07_flattening_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/11_component_layout.py` & `gdsfactory-7.1.4/gdsfactory/samples/11_component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/12_component_refs.py` & `gdsfactory-7.1.4/gdsfactory/samples/12_component_refs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/13_component_netlist.py` & `gdsfactory-7.1.4/gdsfactory/samples/13_component_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/14_component_connectivity.py` & `gdsfactory-7.1.4/gdsfactory/samples/14_component_connectivity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/15_component_sequence1.py` & `gdsfactory-7.1.4/gdsfactory/samples/15_component_sequence1.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/16_component_sequence2.py` & `gdsfactory-7.1.4/gdsfactory/samples/16_component_sequence2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/17_ports.py` & `gdsfactory-7.1.4/gdsfactory/samples/17_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/20_components.py` & `gdsfactory-7.1.4/gdsfactory/samples/20_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/21_add_fiber_array.py` & `gdsfactory-7.1.4/gdsfactory/samples/21_add_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/22_add_fiber_single.py` & `gdsfactory-7.1.4/gdsfactory/samples/22_add_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/22_add_pads.py` & `gdsfactory-7.1.4/gdsfactory/samples/22_add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/23_reticle.py` & `gdsfactory-7.1.4/gdsfactory/samples/23_reticle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/23_reticle_passives_grid.py` & `gdsfactory-7.1.4/gdsfactory/samples/23_reticle_passives_grid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/23_reticle_passives_pack.py` & `gdsfactory-7.1.4/gdsfactory/samples/23_reticle_passives_pack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/24_doe_2.py` & `gdsfactory-7.1.4/gdsfactory/samples/24_doe_2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/24_doe_3.py` & `gdsfactory-7.1.4/gdsfactory/samples/24_doe_3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/30_lidar.py` & `gdsfactory-7.1.4/gdsfactory/samples/30_lidar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/30_lidar_pcell.py` & `gdsfactory-7.1.4/gdsfactory/samples/30_lidar_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/30_lidar_with_pads.py` & `gdsfactory-7.1.4/gdsfactory/samples/30_lidar_with_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing.py` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/big_device.py` & `gdsfactory-7.1.4/gdsfactory/samples/big_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/benchmark/fill_demo.py` & `gdsfactory-7.1.4/gdsfactory/samples/demo/benchmark/fill_demo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/mask.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/mask.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml` & `gdsfactory-7.1.4/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/drc_errors.py` & `gdsfactory-7.1.4/gdsfactory/samples/demo/drc_errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/layers.py` & `gdsfactory-7.1.4/gdsfactory/samples/demo/layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/lvs.py` & `gdsfactory-7.1.4/gdsfactory/samples/demo/lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/demo/pcell.py` & `gdsfactory-7.1.4/gdsfactory/samples/demo/pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/netlists/mzi.yml` & `gdsfactory-7.1.4/gdsfactory/samples/netlists/mzi.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/netlists/mzi_full.yml` & `gdsfactory-7.1.4/gdsfactory/samples/netlists/mzi_full.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/fab_c.py` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/fab_d/phase_shifters.py` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/fab_d/phase_shifters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c.py` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml` & `gdsfactory-7.1.4/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/serialization.py` & `gdsfactory-7.1.4/gdsfactory/serialization.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/show.py` & `gdsfactory-7.1.4/gdsfactory/show.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/simulation/__init__.py` & `gdsfactory-7.1.4/gdsfactory/simulation/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/snap.py` & `gdsfactory-7.1.4/gdsfactory/snap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/symbols.py` & `gdsfactory-7.1.4/gdsfactory/symbols.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/klayout_tech.py` & `gdsfactory-7.1.4/gdsfactory/technology/klayout_tech.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/layer_map.py` & `gdsfactory-7.1.4/gdsfactory/technology/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/layer_stack.py` & `gdsfactory-7.1.4/gdsfactory/technology/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/layer_views.py` & `gdsfactory-7.1.4/gdsfactory/technology/layer_views.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/processes.py` & `gdsfactory-7.1.4/gdsfactory/technology/processes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/xml_utils.py` & `gdsfactory-7.1.4/gdsfactory/technology/xml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/technology/yaml_utils.py` & `gdsfactory-7.1.4/gdsfactory/technology/yaml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/typings.py` & `gdsfactory-7.1.4/gdsfactory/typings.py`

 * *Files 1% similar despite different names*

```diff
@@ -189,15 +189,15 @@
 Layer = tuple[int, int]  # Tuple of integer (layer, datatype)
 Layers = tuple[Layer, ...]
 
 LayerSpec = (
     Layer | int | str | None
 )  # tuple of integers (layer, datatype), a integer (layer, 0) or a string (layer_name)
 
-LayerSpecs = tuple[LayerSpec, ...] | None
+LayerSpecs = list[LayerSpec] | tuple[LayerSpec, ...] | None
 ComponentFactory = Callable[..., Component]
 ComponentFactoryDict = dict[str, ComponentFactory]
 PathType = str | pathlib.Path
 PathTypes = tuple[PathType, ...]
 
 
 MaterialSpec = str | float | tuple[float, float] | Callable
```

### Comparing `gdsfactory-7.1.3/gdsfactory/watch.py` & `gdsfactory-7.1.4/gdsfactory/watch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/gdsfactory/write_cells.py` & `gdsfactory-7.1.4/gdsfactory/write_cells.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-7.1.3/pyproject.toml` & `gdsfactory-7.1.4/pyproject.toml`

 * *Files 1% similar despite different names*

```diff
@@ -36,15 +36,15 @@
 ]
 description = "python library to generate GDS layouts"
 keywords = ["eda", "photonics", "python"]
 license = {file = "LICENSE"}
 name = "gdsfactory"
 readme = "README.md"
 requires-python = ">=3.10"
-version = "7.1.3"
+version = "7.1.4"
 
 [project.optional-dependencies]
 cad = [
   "freetype-py",
   "ipycytoscape",
   "ipyevents",
   "ipykernel",
```

### Comparing `gdsfactory-7.1.3/PKG-INFO` & `gdsfactory-7.1.4/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gdsfactory
-Version: 7.1.3
+Version: 7.1.4
 Summary: python library to generate GDS layouts
 Keywords: eda,photonics,python
 Author-email: gdsfactory community <contact@gdsfactory.com>
 Requires-Python: >=3.10
 Description-Content-Type: text/markdown
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
@@ -66,15 +66,15 @@
 Requires-Dist: jupyter-book==0.15.1 ; extra == "docs"
 Requires-Dist: pydata_sphinx_theme==0.13.1 ; extra == "docs"
 Requires-Dist: plotly ; extra == "docs"
 Provides-Extra: cad
 Provides-Extra: dev
 Provides-Extra: docs
 
-# gdsfactory 7.1.3
+# gdsfactory 7.1.4
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![Downloads](https://pepy.tech/badge/gdsfactory)](https://pepy.tech/project/gdsfactory)
```

